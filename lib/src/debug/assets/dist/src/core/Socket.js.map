{"version":3,"file":"Socket.js","sourceRoot":"","sources":["../../../../../../../../../../TanhX/online/browser/src/core/Socket.js"],"names":[],"mappings":"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","sourcesContent":["/* -*- js-indent-level: 8; fill-column: 100 -*- */\n/*\n * Copyright the Collabora Online contributors.\n *\n * SPDX-License-Identifier: MPL-2.0\n *\n * This Source Code Form is subject to the terms of the Mozilla Public\n * License, v. 2.0. If a copy of the MPL was not distributed with this\n * file, You can obtain one at http://mozilla.org/MPL/2.0/.\n */\n/*\n * L.Socket contains methods for the communication with the server\n */\n\n/* global app JSDialog _ $ errorMessages Uint8Array brandProductName GraphicSelection TileManager */\n\napp.definitions.Socket = L.Class.extend({\n\tProtocolVersionNumber: '0.1',\n\tReconnectCount: 0,\n\tWasShownLimitDialog: false,\n\tWSDServer: {},\n\tIndirectSocketReconnectCount: 0,\n\n\t/// Whether Trace Event recording is enabled or not. (\"Enabled\" here means whether it can be\n\t/// turned on (and off again), not whether it is on.)\n\tenableTraceEventLogging: false,\n\n\t// Will be set from lokitversion message\n\tTunnelledDialogImageCacheSize: 0,\n\n\tgetParameterValue: function (s) {\n\t\tvar i = s.indexOf('=');\n\t\tif (i === -1)\n\t\t\treturn undefined;\n\t\treturn s.substring(i+1);\n\t},\n\n\tinitialize: function (map) {\n\t\twindow.app.console.debug('socket.initialize:');\n\t\tthis._map = map;\n\t\tthis._msgQueue = [];\n\t\tthis._delayedMessages = [];\n\t\tthis._handlingDelayedMessages = false;\n\t\tthis._inLayerTransaction = false;\n\t\tthis._slurpDuringTransaction = false;\n\t},\n\n\tgetWebSocketBaseURI: function(map) {\n\t\treturn window.makeWsUrlWopiSrc('/cool/', map.options.doc + '?' + $.param(map.options.docParams));\n\t},\n\n\tconnect: function(socket) {\n\t\tvar map = this._map;\n\t\tmap.options.docParams['permission'] = app.getPermission();\n\t\tif (this.socket) {\n\t\t\tthis.close();\n\t\t}\n\t\tif (socket && (socket.readyState === 1 || socket.readyState === 0)) {\n\t\t\tthis.socket = socket;\n\t\t} else if (window.ThisIsAMobileApp) {\n\t\t\t// We have already opened the FakeWebSocket or MobileSocket over in global.js\n\t\t\t// With the FakeWebSocket do we then set this.socket at all?\n\t\t\t// With the MobileSocket we definitely do - this is load-bearing for opening password protected documents\n\t\t} else\t{\n\t\t\ttry {\n\t\t\t\tthis.socket = window.createWebSocket(this.getWebSocketBaseURI(map));\n\t\t\t\twindow.socket = this.socket;\n\t\t\t} catch (e) {\n\t\t\t\tthis._map.fire('error', {msg: _('Oops, there is a problem connecting to {productname}: ').replace('{productname}', (typeof brandProductName !== 'undefined' ? brandProductName : 'Collabora Online Development Edition (unbranded)')) + e, cmd: 'socket', kind: 'failed', id: 3});\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\tthis.socket.onerror = L.bind(this._onSocketError, this);\n\t\tthis.socket.onclose = L.bind(this._onSocketClose, this);\n\t\tthis.socket.onopen = L.bind(this._onSocketOpen, this);\n\t\tthis.socket.onmessage = L.bind(this._slurpMessage, this);\n\t\tthis.socket.binaryType = 'arraybuffer';\n\t\tif (map.options.docParams.access_token && parseInt(map.options.docParams.access_token_ttl)) {\n\t\t\tvar tokenExpiryWarning = 900 * 1000; // Warn when 15 minutes remain\n\t\t\tclearTimeout(this._accessTokenExpireTimeout);\n\t\t\tthis._accessTokenExpireTimeout = setTimeout(L.bind(this._sessionExpiredWarning, this),\n\t\t\t                                            parseInt(map.options.docParams.access_token_ttl) - Date.now() - tokenExpiryWarning);\n\t\t}\n\n\t\t// process messages for early socket connection\n\t\tthis._emptyQueue();\n\t},\n\n\t_emptyQueue: function () {\n\t\tif (window.queueMsg && window.queueMsg.length > 0) {\n\t\t\tfor (var it = 0; it < window.queueMsg.length; it++) {\n\t\t\t\tthis._slurpMessage({data: window.queueMsg[it], textMsg: window.queueMsg[it]});\n\t\t\t}\n\t\t\twindow.queueMsg = [];\n\t\t}\n\t},\n\n\t_sessionExpiredWarning: function() {\n\t\tclearTimeout(this._accessTokenExpireTimeout);\n\t\tvar expirymsg = errorMessages.sessionexpiry;\n\t\tif (parseInt(this._map.options.docParams.access_token_ttl) - Date.now() <= 0) {\n\t\t\texpirymsg = errorMessages.sessionexpired;\n\t\t}\n\t\tvar dateTime = new Date(parseInt(this._map.options.docParams.access_token_ttl));\n\t\tvar dateOptions = { year: 'numeric', month: 'short', day: 'numeric', hour: '2-digit', minute: '2-digit' };\n\t\tvar timerepr = dateTime.toLocaleDateString(String.locale, dateOptions);\n\t\tthis._map.fire('warn', {msg: expirymsg.replace('{time}', timerepr)});\n\n\t\t// If user still doesn't refresh the session, warn again periodically\n\t\tthis._accessTokenExpireTimeout = setTimeout(L.bind(this._sessionExpiredWarning, this),\n\t\t                                            120 * 1000);\n\t},\n\n\tsetUnloading: function() {\n\t\twindow.prefs.sendPendingBrowserSettingsUpdate();\n\t\tif (this.socket.setUnloading)\n\t\t\tthis.socket.setUnloading();\n\t},\n\n\tclose: function () {\n\t\tthis.socket.onerror = function () {};\n\t\tthis.socket.onclose = function () {};\n\t\tthis.socket.onmessage = function () {};\n\t\tthis.socket.close();\n\n\t\t// Reset wopi's app loaded so that reconnecting again informs outerframe about initialization\n\t\tthis._map['wopi'].resetAppLoaded();\n\t\tthis._map.fire('docloaded', {status: false});\n\t\tclearTimeout(this._accessTokenExpireTimeout);\n\t},\n\n\tconnected: function() {\n\t\treturn this.socket && this.socket.readyState === 1;\n\t},\n\n\tsendMessage: function (msg) {\n\t\tif (this._map._debug.eventDelayWatchdog)\n\t\t\tthis._map._debug.timeEventDelay();\n\n\t\tif (this._map._fatal) {\n\t\t\t// Avoid communicating when we're in fatal state\n\t\t\treturn;\n\t\t}\n\n\t\tif (!app.idleHandler._active) {\n\t\t\t// Avoid communicating when we're inactive.\n\t\t\tif (typeof msg !== 'string')\n\t\t\t\treturn;\n\n\t\t\tif (!msg.startsWith('useractive') && !msg.startsWith('userinactive')) {\n\t\t\t\twindow.app.console.log('Ignore outgoing message due to inactivity: \"' + msg + '\"');\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\tif (this._map.uiManager && this._map.uiManager.isUIBlocked())\n\t\t\treturn;\n\n\t\tvar socketState = this.socket.readyState;\n\t\tif (socketState === 2 || socketState === 3) {\n\t\t\tthis._map.loadDocument();\n\t\t}\n\n\t\tif (socketState === 1) {\n\t\t\tthis._doSend(msg);\n\t\t}\n\t\telse {\n\t\t\t// push message while trying to connect socket again.\n\t\t\tthis._msgQueue.push(msg);\n\t\t}\n\t},\n\n\tsendTraceEvent: function(name, ph, timeRange, args, id, tid) {\n\t\tif (timeRange === undefined)\n\t\t\ttimeRange = 'ts=' + Math.round(performance.now() * 1000);\n\t\tif (!id)\n\t\t\tid = 1;\n\t\tif (!tid)\n\t\t\ttid = 1;\n\t\tthis.sendMessage('TRACEEVENT name=' + JSON.stringify(name) + ' ph=' + ph +\n\t\t\t\t ' ' + timeRange + ' id=' + id + ' tid=' + tid +\n\t\t\t\t this._stringifyArgs(args));\n\t},\n\n\t_doSend: function(msg) {\n\t\t// Only attempt to log text frames, not binary ones.\n\t\tif (typeof msg === 'string')\n\t\t\tthis._logSocket('OUTGOING', msg);\n\n\t\tthis.socket.send(msg);\n\t},\n\n\t_getParameterByName: function(url, name) {\n\t\tname = name.replace(/[\\[]/, '\\\\[').replace(/[\\]]/, '\\\\]');\n\t\tvar regex = new RegExp('[\\\\?&]' + name + '=([^&#]*)'), results = regex.exec(url);\n\t\treturn results === null ? '' : results[1].replace(/\\+/g, ' ');\n\t},\n\n\t_onSocketOpen: function () {\n\t\twindow.app.console.debug('_onSocketOpen:');\n\t\tapp.idleHandler._serverRecycling = false;\n\t\tapp.idleHandler._documentIdle = false;\n\n\t\t// Always send the protocol version number.\n\t\t// TODO: Move the version number somewhere sensible.\n\n\t\t// Note there are two socket \"onopen\" handlers, this one which ends up as part of\n\t\t// bundle.js and the other in browser/js/global.js. The global.js one attempts to\n\t\t// set up the connection early while bundle.js is still loading. If bundle.js\n\t\t// starts before global.js has connected, then this _onSocketOpen will do the\n\t\t// connection instead, after taking over the socket in \"connect\"\n\n\t\t// Typically in a \"make run\" scenario it is the global.js case that sends the\n\t\t// 'coolclient' and 'load' messages while currently in the \"WASM app\" case it is\n\t\t// this code that gets invoked.\n\n\t\t// Also send information about our performance timer epoch\n\t\tvar now0 = Date.now();\n\t\tvar now1 = performance.now();\n\t\tvar now2 = Date.now();\n\t\tthis._doSend('coolclient ' + this.ProtocolVersionNumber + ' ' + ((now0 + now2) / 2) + ' ' + now1);\n\n\t\tvar msg = 'load url=' + encodeURIComponent(this._map.options.doc);\n\t\tif (this._map._docLayer) {\n\t\t\tthis._reconnecting = true;\n\t\t\t// we are reconnecting after a lost connection\n\t\t\tmsg += ' part=' + this._map.getCurrentPartNumber();\n\t\t}\n\t\tif (this._map.options.timestamp) {\n\t\t\tmsg += ' timestamp=' + this._map.options.timestamp;\n\t\t}\n\t\tif (this._map._docPassword) {\n\t\t\tmsg += ' password=' + this._map._docPassword;\n\t\t}\n\t\tif (String.locale) {\n\t\t\tmsg += ' lang=' + String.locale;\n\t\t}\n\t\tif (window.deviceFormFactor) {\n\t\t\tmsg += ' deviceFormFactor=' + window.deviceFormFactor;\n\t\t}\n\n\t\tmsg += ' timezone=' + Intl.DateTimeFormat().resolvedOptions().timeZone;\n\n\t\tif (this._map.options.renderingOptions) {\n\t\t\tvar options = {\n\t\t\t\t'rendering': this._map.options.renderingOptions\n\t\t\t};\n\t\t\tmsg += ' options=' + JSON.stringify(options);\n\t\t}\n\t\tvar spellOnline = window.prefs.get('SpellOnline');\n\t\tif (spellOnline) {\n\t\t\tmsg += ' spellOnline=' + spellOnline;\n\t\t}\n\n\t\tconst darkTheme = window.prefs.getBoolean('darkTheme');\n\t\tmsg += ' darkTheme=' + darkTheme;\n\n\t\tconst darkBackground = window.prefs.getBoolean('darkBackgroundForTheme.' + (darkTheme ? 'dark' : 'light'), darkTheme);\n\t\tmsg += ' darkBackground=' + darkBackground;\n\t\tthis._map.uiManager.initDarkBackgroundUI(darkBackground);\n\n\t\tmsg += ' accessibilityState=' + window.getAccessibilityState();\n\n\t\tmsg += ' clientvisiblearea=' + window.makeClientVisibleArea();\n\n\t\tthis._doSend(msg);\n\t\tfor (var i = 0; i < this._msgQueue.length; i++) {\n\t\t\tthis._doSend(this._msgQueue[i]);\n\t\t}\n\t\tthis._msgQueue = [];\n\n\t\tapp.idleHandler._activate();\n\t},\n\n\t_utf8ToString: function (data) {\n\t\tvar strBytes = '';\n\t\tfor (var it = 0; it < data.length; it++) {\n\t\t\tstrBytes += String.fromCharCode(data[it]);\n\t\t}\n\t\treturn strBytes;\n\t},\n\n\t// Returns true if, and only if, we are ready to start loading\n\t// the tiles and rendering the document.\n\t_isReady: function() {\n\t\tif (window.bundlejsLoaded == false || window.fullyLoadedAndReady == false) {\n\t\t\treturn false;\n\t\t}\n\n\t\tif (typeof this._map == 'undefined' ||\n\t\t\tisNaN(this._map.options.tileWidthTwips) ||\n\t\t\tisNaN(this._map.options.tileHeightTwips)) {\n\t\t\treturn false;\n\t\t}\n\n\t\tvar center = this._map.getCenter();\n\t\tif (isNaN(center.lat) || isNaN(center.lng) || isNaN(this._map.getZoom())) {\n\t\t\treturn false;\n\t\t}\n\n\t\treturn true;\n\t},\n\n\t_logSocket: function(type, msg) {\n\t\tvar logMessage = this._map._debug.debugNeverStarted || this._map._debug.logIncomingMessages;\n\t\tif (!logMessage)\n\t\t\treturn;\n\n\t\tif (window.ThisIsTheGtkApp)\n\t\t\twindow.postMobileDebug(type + ' ' + msg);\n\n\t\tvar debugOn = this._map._debug.debugOn;\n\n\t\tif (this._map._debug.overlayOn) {\n\t\t\tthis._map._debug.setOverlayMessage('postMessage',type+': '+msg);\n\t\t}\n\n\t\tif (!debugOn && msg.length > 256) // for reasonable performance.\n\t\t\tmsg = msg.substring(0,256) + '<truncated ' + (msg.length - 256) + 'chars>';\n\n\t\tvar status = '';\n\t\tif (!window.fullyLoadedAndReady)\n\t\t\tstatus += '[!fullyLoadedAndReady]';\n\t\tif (!window.bundlejsLoaded)\n\t\t\tstatus += '[!bundlejsLoaded]';\n\n\t\tapp.Log.log(msg, type + status);\n\n\t\tif (!window.protocolDebug && !debugOn)\n\t\t\treturn;\n\n\t\tvar color = type === 'OUTGOING' ? 'color:red' : 'color:#2e67cf';\n\t\twindow.app.console.log(+new Date() + ' %c' + type + status + '%c: ' + msg.concat(' ').replace(' ', '%c '),\n\t\t\t     'background:#ddf;color:black', color, 'color:');\n\t},\n\n\t_queueSlurpEventEmission: function(delayMS) {\n\n\t\tif (this._slurpTimer && this._slurpTimerDelay != delayMS) {\n\t\t\t// The timer already exists, but now want to change timeout _slurpTimerDelay to delayMS.\n\t\t\t// Cancel it and reschedule by replacement with another timer using the desired delayMS\n\t\t\t// adjusted as if used at the original launch time.\n\t\t\tclearTimeout(this._slurpTimer);\n\t\t\tthis._slurpTimer = null;\n\t\t\tthis._slurpTimerDelay = delayMS;\n\n\t\t\tvar now = Date.now();\n\t\t\tvar sinceLaunchMS = now - this._slurpTimerLaunchTime;\n\t\t\tdelayMS -= sinceLaunchMS;\n\t\t\tif (delayMS <= 0)\n\t\t\t\tdelayMS = 1;\n\t\t}\n\n\t\tif (!this._slurpTimer)\n\t\t{\n\t\t\tvar that = this;\n\t\t\tif (!that._slurpTimerLaunchTime) {\n\t\t\t\t// The initial launch of the timer, rescheduling replacements retain\n\t\t\t\t// the launch time\n\t\t\t\tthat._slurpTimerLaunchTime = now;\n\t\t\t\tthat._slurpTimerDelay = delayMS;\n\t\t\t}\n\t\t\tthat._slurpTimer = setTimeout(function () {\n\t\t\t\tthat._slurpTimer = undefined;\n\t\t\t\tthat._slurpTimerLaunchTime = undefined;\n\t\t\t\tthat._slurpTimerDelay = undefined;\n\t\t\t\tif (that._inLayerTransaction) {\n\t\t\t\t\tthat._slurpDuringTransaction = true;\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tthat._emitSlurpedEvents();\n\t\t\t}, delayMS);\n\t\t}\n\t},\n\n\t_emitSlurpedEvents: function() {\n\t\tif (this._map._debug.eventDelayWatchdog)\n\t\t\tthis._map._debug.timeEventDelay();\n\n\t\tvar queueLength = this._slurpQueue.length;\n\t\tvar completeEventWholeFunction = this.createCompleteTraceEvent('emitSlurped-' + String(queueLength),\n\t\t\t\t\t\t\t\t\t       {'_slurpQueue.length' : String(queueLength)});\n\t\tif (this._map && this._map._docLayer) {\n\t\t\tTileManager.beginTransaction();\n\t\t\tthis._inLayerTransaction = true;\n\n\t\t\t// Queue an instant timeout early to try to measure the\n\t\t\t// re-rendering delay before we get back to the main-loop.\n\t\t\tif (this.traceEventRecordingToggle)\n\t\t\t{\n\t\t\t\tvar that = this;\n\t\t\t\tif (!that._renderEventTimer)\n\t\t\t\t\tthat._renderEventTimer = setTimeout(function() {\n\t\t\t\t\t\tvar now = performance.now();\n\t\t\t\t\t\tvar delta = now - that._renderEventTimerStart;\n\t\t\t\t\t\tif (delta >= 2 /* ms */) // significant\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthat.sendTraceEvent(name, 'X', 'ts=' + Math.round(that._renderEventTimerStart * 1000) +\n\t\t\t\t\t\t\t\t\t    ' dur=' + Math.round((now - that._renderEventTimerStart) * 1000));\n\t\t\t\t\t\t\tthat._renderEventTimerStart = undefined;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tthat._renderEventTimer = undefined;\n\t\t\t\t\t}, 0);\n\t\t\t}\n\t\t}\n\t\t// window.app.console.log('Slurp events ' + that._slurpQueue.length);\n\t\tvar complete = true;\n\t\ttry {\n\t\t\tfor (var i = 0; i < queueLength; ++i) {\n\t\t\t\tvar evt = this._slurpQueue[i];\n\n\t\t\t\tif (evt.isComplete()) {\n\t\t\t\t\tvar textMsg;\n\t\t\t\t\tif (typeof (evt.data) === 'string') {\n\t\t\t\t\t\ttextMsg = evt.data.replace(/\\s+/g, '.');\n\t\t\t\t\t}\n\t\t\t\t\telse if (typeof (evt.data) === 'object') {\n\t\t\t\t\t\ttextMsg = evt.textMsg.replace(/\\s+/g, '.');\n\t\t\t\t\t}\n\n\t\t\t\t\tvar completeEventOneMessage = this.createCompleteTraceEventFromEvent(textMsg);\n\t\t\t\t\ttry {\n\t\t\t\t\t\t// it is - are you ?\n\t\t\t\t\t\tthis._onMessage(evt);\n\t\t\t\t\t}\n\t\t\t\t\tcatch (e)\n\t\t\t\t\t{\n\t\t\t\t\t\t// unpleasant - but stops this one problem event\n\t\t\t\t\t\t// stopping an unknown number of others.\n\t\t\t\t\t\tlet msg = 'Exception ' + e + ' emitting event ' + evt.data + '\\n' + e.stack;\n\t\t\t\t\t\twindow.app.console.error(msg);\n\n\t\t\t\t\t\t// When debugging let QA know something is up.\n\t\t\t\t\t\tif (window.enableDebug || L.Browser.cypressTest)\n\t\t\t\t\t\t\tthis._map.uiManager.showInfoModal(\n\t\t\t\t\t\t\t\t'cool_alert', '', msg, '', _('Close'), function() { /* Do nothing. */ }, false);\n\n\t\t\t\t\t\t// If we're cypress testing, fail the run. Cypress will fail anyway, but this way we may get\n\t\t\t\t\t\t// a nice error in the logs rather than guessing that the run failed from our popup blocking input...\n\t\t\t\t\t\tif (L.Browser.cypressTest && window.parent !== window && e !== null) {\n\t\t\t\t\t\t\tconsole.log(\"Sending event error to Cypress...\", e);\n\t\t\t\t\t\t\twindow.parent.postMessage(e);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t}\n\t\t\t\t\tfinally {\n\t\t\t\t\t\tif (completeEventOneMessage)\n\t\t\t\t\t\t\tcompleteEventOneMessage.finish();\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\t// Stop emitting, re-start when we async images load.\n\t\t\t\t\tthis._slurpQueue = this._slurpQueue.slice(i, queueLength);\n\t\t\t\t\tcomplete = false;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tfinally {\n\t\t\tif (completeEventWholeFunction)\n\t\t\t\tcompleteEventWholeFunction.finish();\n\t\t}\n\n\t\tif (complete) // Finished all elements in the queue.\n\t\t\tthis._slurpQueue = [];\n\n\t\tif (this._map) {\n\t\t\tvar completeCallback = () => {\n\t\t\t\t// Let other layers / overlays catch up.\n\t\t\t\tthis._map.fire('messagesdone');\n\n\t\t\t\tthis._renderEventTimerStart = performance.now();\n\n\t\t\t\tthis._inLayerTransaction = false;\n\t\t\t\tif (this._slurpDuringTransaction) {\n\t\t\t\t\tthis._slurpDuringTransaction = false;\n\t\t\t\t\tthis._queueSlurpEventEmission(1);\n\t\t\t\t}\n\t\t\t};\n\n\t\t\tif (this._inLayerTransaction && this._map._docLayer) {\n\t\t\t\t// Resume with redraw if dirty due to previous _onMessage() calls.\n\t\t\t\tTileManager.endTransaction(completeCallback);\n\t\t\t} else {\n\t\t\t\tcompleteCallback();\n\t\t\t}\n\t\t}\n\t},\n\n\t// The problem: if we process one websocket message at a time, the\n\t// browser -loves- to trigger a re-render as we hit the main-loop,\n\t// this takes ~200ms on a large screen, and worse we get\n\t// producer/consumer issues that can fill a multi-second long\n\t// buffer of web-socket messages in the client that we can't\n\t// process so - slurp and then emit at idle - its faster to delay!\n\t_slurpMessage: function(e) {\n\t\tthis._extractTextImg(e);\n\n\t\t// Some messages - we want to process & filter early.\n\t\tvar docLayer = this._map ? this._map._docLayer : undefined;\n\t\tif (docLayer && docLayer.filterSlurpedMessage(e))\n\t\t\treturn;\n\n\t\tvar predictedTiles = TileManager.predictTilesToSlurp();\n\t\t// scale delay, to a max of 50ms, according to the number of\n\t\t// tiles predicted to arrive.\n\t\tvar delayMS = Math.max(Math.min(predictedTiles, 50), 1);\n\n\t\tif (!this._slurpQueue)\n\t\t\tthis._slurpQueue = [];\n\t\tthis._slurpQueue.push(e);\n\t\tthis._queueSlurpEventEmission(delayMS);\n\t},\n\n\t// make profiling easier\n\t_extractCopyObject: function(e) {\n\t\tvar index;\n\n\t\te.imgBytes = new Uint8Array(e.data);\n\n\t\t// search for the first newline which marks the end of the message\n\t\tindex = e.imgBytes.indexOf(10);\n\t\tif (index < 0)\n\t\t\tindex = e.imgBytes.length;\n\n\t\te.textMsg = String.fromCharCode.apply(null, e.imgBytes.subarray(0, index));\n\n\t\te.imgIndex = index + 1;\n\t},\n\n\t// convert to string of bytes without blowing the stack if data is large.\n\t_strFromUint8: function(prefix, data) {\n\t\tvar i, chunk = 4096;\n\t\tvar strBytes = prefix;\n\t\tfor (i = 0; i < data.length; i += chunk)\n\t\t\tstrBytes += String.fromCharCode.apply(null, data.slice(i, i + chunk));\n\t\tstrBytes += String.fromCharCode.apply(null, data.slice(i));\n\t\treturn strBytes;\n\t},\n\n\t_extractImage: function(e) {\n\t\tvar img;\n\t\tvar data = e.imgBytes.subarray(e.imgIndex);\n\t\tvar prefix = '';\n\t\t// FIXME: so we prepend the PNG pre-byte here having removed it in TileCache::appendBlob\n\t\tif (data[0] != 0x89)\n\t\t\tprefix = String.fromCharCode(0x89);\n\t\timg = 'data:image/png;base64,' + window.btoa(this._strFromUint8(prefix,data));\n\t\tif (L.Browser.cypressTest && window.prefs.getBoolean('image_validation_test')) {\n\t\t\tif (!window.imgDatas)\n\t\t\t\twindow.imgDatas = [];\n\t\t\twindow.imgDatas.push(img);\n\t\t}\n\t\treturn img;\n\t},\n\n\t_extractTextImg: function (e) {\n\n\t\tif ((window.ThisIsTheiOSApp || window.ThisIsTheEmscriptenApp) && typeof (e.data) === 'string') {\n\t\t\t// Another fix for issue #5843 limit splitting on the first newline\n\t\t\t// to only certain message types on iOS. Also, fix mangled UTF-8\n\t\t\t// text on iOS in jsdialogs when using languages like Greek and\n\t\t\t// Japanese by only setting the image bytes for only the same set\n\t\t\t// of message types.\n\t\t\tif (window.ThisIsTheEmscriptenApp ||\n\t\t\t\t\te.data.startsWith('tile:') ||\n\t\t\t\t\te.data.startsWith('tilecombine:') ||\n\t\t\t\t\te.data.startsWith('delta:') ||\n\t\t\t\t\te.data.startsWith('renderfont:') ||\n\t\t\t\t\te.data.startsWith('rendersearchlist:') ||\n\t\t\t\t\te.data.startsWith('slidelayer:') ||\n\t\t\t\t\te.data.startsWith('windowpaint:')) {\n\t\t\t\tvar index;\n\t\t\t\tindex = e.data.indexOf('\\n');\n\t\t\t\tif (index < 0)\n\t\t\t\t\tindex = e.data.length;\n\t\t\t\te.imgBytes = new Uint8Array(e.data.length);\n\t\t\t\tfor (var i = 0; i < e.data.length; i++) {\n\t\t\t\t\te.imgBytes[i] = e.data.charCodeAt(i);\n\t\t\t\t}\n\t\t\t\te.imgIndex = index + 1;\n\t\t\t\te.textMsg = e.data.substring(0, index);\n\t\t\t} else {\n\t\t\t\te.textMsg = e.data;\n\t\t\t}\n\t\t} else if (typeof (e.data) === 'string') {\n\t\t\te.textMsg = e.data;\n\t\t} else if (typeof (e.data) === 'object') {\n\t\t\tthis._extractCopyObject(e);\n\t\t}\n\t\te.isComplete = function () {\n\t\t\tif (this.image)\n\t\t\t\treturn !!this.imageIsComplete;\n\t\t\treturn true;\n\t\t};\n\n\t\tvar isTile = e.textMsg.startsWith('tile:');\n\t\tvar isDelta = e.textMsg.startsWith('delta:');\n\t\tif (!isTile && !isDelta &&\n\t\t    !e.textMsg.startsWith('renderfont:') &&\n\t\t\t!e.textMsg.startsWith('slidelayer:') &&\n\t\t    !e.textMsg.startsWith('windowpaint:'))\n\t\t\treturn;\n\n\t\tif (e.textMsg.indexOf(' nopng') !== -1)\n\t\t\treturn;\n\n\t\t// pass deltas through quickly.\n\t\tif (e.imgBytes && (isTile || isDelta) && e.imgBytes[e.imgIndex] != 80 /* P(ng) */)\n\t\t{\n\t\t\t// window.app.console.log('Passed through delta object');\n\t\t\te.image = { rawData: e.imgBytes.subarray(e.imgIndex),\n\t\t\t\t    isKeyframe: isTile };\n\t\t\te.imageIsComplete = true;\n\t\t\treturn;\n\t\t}\n\n\t\t// window.app.console.log('PNG preview');\n\n\t\t// lazy-loaded PNG slide previews\n\t\tvar img = this._extractImage(e);\n\t\tif (isTile) {\n\t\t\te.image = { src: img };\n\t\t\te.imageIsComplete = true;\n\t\t\treturn;\n\t\t}\n\n\t\t// PNG dialog bits\n\t\tvar that = this;\n\t\te.image = new Image();\n\t\te.image.onload = function() {\n\t\t\te.imageIsComplete = true;\n\t\t\tthat._queueSlurpEventEmission(1);\n\t\t\tif (e.image.completeTraceEvent)\n\t\t\t\te.image.completeTraceEvent.finish();\n\t\t};\n\t\te.image.onerror = function(err) {\n\t\t\twindow.app.console.log('Failed to load image ' + img + ' fun ' + err);\n\t\t\te.imageIsComplete = true;\n\t\t\tthat._queueSlurpEventEmission(1);\n\t\t\tif (e.image.completeTraceEvent)\n\t\t\t\te.image.completeTraceEvent.abort();\n\t\t};\n\t\te.image.completeTraceEvent = this.createAsyncTraceEvent('loadTile');\n\t\te.image.src = img;\n\t},\n\n\t_buildUnauthorizedMessage: function (command) {\n\t\tvar unauthorizedMsg = errorMessages.unauthorized;\n\t\tif (command.errorCode) {\n\t\t\t// X509_verify_cert_error_string output\n\t\t\tvar authError = window.atob(command.errorCode);\n\t\t\tvar verifyError = errorMessages.verificationerror.replace('{errormessage}', authError);\n\t\t\tunauthorizedMsg += ' ' + verifyError;\n\t\t}\n\t\treturn unauthorizedMsg;\n\t},\n\n\t_onMessage: function (e) {\n\t\tvar imgBytes, textMsg;\n\n\t\ttextMsg = e.textMsg;\n\t\timgBytes = e.imgBytes;\n\n\t\tif (window.L.Browser.cypressTest) {\n\t\t\twindow.L.initial._stubMessage(textMsg);\n\t\t}\n\n\t\tthis._logSocket('INCOMING', textMsg);\n\n\t\tvar command = this.parseServerCmd(textMsg);\n\n\t\tif (textMsg.startsWith('coolserver ')) {\n\t\t\t// This must be the first message, unless we reconnect.\n\t\t\tvar oldVersion = null;\n\t\t\tvar sameFile = true;\n\t\t\t// Check if we are reconnecting.\n\t\t\tif (this.WSDServer && this.WSDServer.Id) {\n\t\t\t\t// Yes we are reconnecting.\n\t\t\t\t// If our connection was lost and is ready again, we will not need to refresh the page.\n\t\t\t\toldVersion = this.WSDServer.Version;\n\n\t\t\t\twindow.app.console.assert(this._map.options.wopiSrc === window.wopiSrc,\n\t\t\t\t\t'wopiSrc mismatch!: ' + this._map.options.wopiSrc + ' != ' + window.wopiSrc);\n\t\t\t\t// If another file is opened, we will not refresh the page.\n\t\t\t\tif (this._map.options.previousWopiSrc && this._map.options.wopiSrc) {\n\t\t\t\t\tif (this._map.options.previousWopiSrc !== this._map.options.wopiSrc)\n\t\t\t\t\t\tsameFile = false;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tthis.WSDServer = JSON.parse(textMsg.substring(textMsg.indexOf('{')));\n\n\t\t\tif (oldVersion && sameFile) {\n\t\t\t\tif (this.WSDServer.Version !== oldVersion) {\n\t\t\t\t\tvar reloadMessage = _('Server is now reachable. We have to refresh the page now.');\n\t\t\t\t\tif (window.mode.isMobile())\n\t\t\t\t\t\treloadMessage = _('Server is now reachable...');\n\n\t\t\t\t\tvar reloadFunc = function() { window.location.reload(); };\n\t\t\t\t\tif (!this._map['wopi'].DisableInactiveMessages)\n\t\t\t\t\t\tthis._map.uiManager.showSnackbar(reloadMessage, _('RELOAD'), reloadFunc);\n\t\t\t\t\telse\n\t\t\t\t\t\tthis._map.fire('postMessage', {msgId: 'Reloading', args: {Reason: 'Reconnected'}});\n\t\t\t\t\tsetTimeout(reloadFunc, 5000);\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (window.indirectSocket) {\n\t\t\t\tif (window.expectedServerId && window.expectedServerId != this.WSDServer.Id) {\n\t\t\t\t\tif (this.IndirectSocketReconnectCount++ >= 3) {\n\t\t\t\t\t\tvar msg = errorMessages.clusterconfiguration.replace('{productname}', (typeof brandProductName !== 'undefined' ? brandProductName : 'Collabora Online Development Edition (unbranded)'));\n\t\t\t\t\t\tmsg = msg.replace('{0}', window.expectedServerId);\n\t\t\t\t\t\tmsg = msg.replace('{1}', window.routeToken);\n\t\t\t\t\t\tmsg = msg.replace('{2}', this.WSDServer.Id);\n\t\t\t\t\t\tthis._map.uiManager.showInfoModal('wrong-server-modal', _('Cluster configuration warning'), msg, '', _('OK'), null, false);\n\t\t\t\t\t\tthis.IndirectSocketReconnectCount = 0;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis._map.showBusy(_('Wrong server, reconnecting...'), false);\n\t\t\t\t\t\tthis.manualReconnect(3000);\n\t\t\t\t\t\t// request to indirection server to sanity check the tokens\n\t\t\t\t\t\tthis.sendMessage('routetokensanitycheck');\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tdocument.getElementById('coolwsd-version-label').textContent = _('COOLWSD version:');\n\t\t\tvar h = this.WSDServer.Hash;\n\t\t\tif (parseInt(h,16).toString(16) === h.toLowerCase().replace(/^0+/, '')) {\n\t\t\t\tconst anchor = document.createElement('a');\n\t\t\t\tanchor.setAttribute('href', 'https://github.com/CollaboraOnline/online/commits/' + h);\n\t\t\t\tanchor.setAttribute('target', '_blank');\n\t\t\t\tanchor.textContent = h;\n\n\t\t\t\tconst versionContainer = document.getElementById('coolwsd-version');\n\t\t\t\tversionContainer.replaceChildren();\n\n\t\t\t\tversionContainer.appendChild(document.createTextNode(this.WSDServer.Version));\n\n\t\t\t\tlet span = document.createElement('span');\n\t\t\t\tspan.appendChild(document.createTextNode('git hash:\\xA0'));\n\t\t\t\tspan.appendChild(anchor);\n\t\t\t\tspan.appendChild(document.createTextNode(this.WSDServer.Options));\n\t\t\t\tversionContainer.appendChild(span);\n\t\t\t}\n\t\t\telse {\n\t\t\t\tdocument.getElementById('coolwsd-version').textContent = this.WSDServer.Version;\n\t\t\t}\n\n\t\t\tif (!window.ThisIsAMobileApp) {\n\t\t\t\tvar idUri = window.makeHttpUrl('/hosting/discovery');\n\t\t\t\t$('#served-by-label').text(_('Served by:'));\n\t\t\t\t$('#coolwsd-id').html('<a target=\"_blank\" href=\"' + idUri + '\">' + this.WSDServer.Id + '</a>');\n\t\t\t}\n\n\t\t\t// TODO: For now we expect perfect match in protocol versions\n\t\t\tif (this.WSDServer.Protocol !== this.ProtocolVersionNumber) {\n\t\t\t\tthis._map.fire('error', {msg: _('Unsupported server version.')});\n\t\t\t}\n\t\t}\n\t\telse if (textMsg.startsWith('lokitversion ')) {\n\t\t\tdocument.getElementById('lokit-version-label').textContent = _('LOKit version:');\n\n\t\t\tconst lokitVersionObj = JSON.parse(textMsg.substring(textMsg.indexOf('{')));\n\n\t\t\tconst versionContainer = document.getElementById('lokit-version');\n\t\t\tversionContainer.replaceChildren();\n\t\t\tversionContainer.appendChild(document.createTextNode(lokitVersionObj.ProductName + '\\xA0' + lokitVersionObj.ProductVersion + lokitVersionObj.ProductExtension));\n\n\t\t\th = lokitVersionObj.BuildId.substring(0, 10);\n\t\t\tif (parseInt(h,16).toString(16) === h.toLowerCase().replace(/^0+/, '')) {\n\t\t\t\tconst anchor = document.createElement('a');\n\t\t\t\tanchor.setAttribute('target', '_blank');\n\t\t\t\tanchor.setAttribute('href', 'https://git.libreoffice.org/core/+log/' + lokitVersionObj.BuildId + '/');\n\t\t\t\tanchor.textContent = 'git hash: ' + h;\n\n\t\t\t\tconst span = document.createElement('span');\n\t\t\t\tspan.appendChild(anchor);\n\t\t\t\tversionContainer.appendChild(span);\n\t\t\t}\n\t\t\telse {\n\t\t\t\tconst span = document.createElement('span');\n\t\t\t\tspan.textContent = 'git hash:\\xA0' + h;\n\t\t\t\tversionContainer.appendChild(span);\n\t\t\t}\n\n\t\t\tthis.TunnelledDialogImageCacheSize = lokitVersionObj.tunnelled_dialog_image_cache_size;\n\t\t}\n\t\telse if (textMsg.startsWith('enabletraceeventlogging ')) {\n\t\t\tthis.enableTraceEventLogging = true;\n\t\t}\n\t\telse if (textMsg.startsWith('osinfo ')) {\n\t\t\tvar osInfo = textMsg.replace('osinfo ', '');\n\t\t\tvar osInfoElement = document.getElementById('os-info');\n\t\t\tif (osInfoElement)\n\t\t\t\tosInfoElement.innerText = osInfo;\n\t\t}\n\t\telse if (textMsg.startsWith('clipboardkey: ')) {\n\t\t\tvar key = textMsg.substring('clipboardkey: '.length);\n\t\t\tif (this._map._clip)\n\t\t\t\tthis._map._clip.setKey(key);\n\t\t}\n\t\telse if (textMsg.startsWith('perm:')) {\n\t\t\tvar perm = textMsg.substring('perm:'.length).trim();\n\n\t\t\t// Never make the permission more permissive than it originally was.\n\t\t\tif (!app.isReadOnly())\n\t\t\t\tapp.setPermission(perm);\n\n\t\t\tif (this._map._docLayer)\n\t\t\t\tthis._map.setPermission(app.file.permission);\n\n\t\t\tapp.file.disableSidebar = app.isReadOnly();\n\t\t\treturn;\n\t\t}\n\t\telse if (textMsg.startsWith('filemode:')) {\n\t\t\tvar json = JSON.parse(textMsg.substring('filemode:'.length).trim());\n\n\t\t\t// Never make the permission more permissive than it originally was.\n\t\t\tif (!app.isReadOnly() && json.readOnly)\n\t\t\t{\n\t\t\t\tapp.setPermission('readonly');\n\t\t\t}\n\n\t\t\tif (this._map._docLayer) {\n\t\t\t\tthis._map.setPermission(app.file.permission);\n\t\t\t}\n\n\t\t\tapp.setCommentEditingPermission(json.editComment); // May be allowed even in readonly mode.\n\t\t}\n\t\telse if (textMsg.startsWith('lockfailed:')) {\n\t\t\tthis._map.onLockFailed(textMsg.substring('lockfailed:'.length).trim());\n\t\t\treturn;\n\t\t}\n\t\telse if (textMsg.startsWith('wopi: ')) {\n\t\t\t// Handle WOPI related messages\n\t\t\tvar wopiInfo = JSON.parse(textMsg.substring(textMsg.indexOf('{')));\n\t\t\tthis._map.fire('wopiprops', wopiInfo);\n\t\t\treturn;\n\t\t}\n\t\telse if (textMsg.startsWith('loadstorage: ')) {\n\t\t\tif (textMsg.substring(textMsg.indexOf(':') + 2) === 'failed') {\n\t\t\t\twindow.app.console.debug('Loading document from a storage failed');\n\t\t\t\tthis._map.fire('postMessage', {\n\t\t\t\t\tmsgId: 'App_LoadingStatus',\n\t\t\t\t\targs: {\n\t\t\t\t\t\tStatus: 'Failed'\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t\telse if (textMsg.startsWith('lastmodtime: ')) {\n\t\t\tvar time = textMsg.substring(textMsg.indexOf(' ') + 1);\n\t\t\tthis._map.updateModificationIndicator(time);\n\t\t\treturn;\n\t\t}\n\t\telse if (textMsg.startsWith('commandresult: ')) {\n\t\t\tvar commandresult = JSON.parse(textMsg.substring(textMsg.indexOf('{')));\n\t\t\tif (commandresult['command'] === 'savetostorage' || commandresult['command'] === 'save') {\n\t\t\t\tvar postMessageObj = {\n\t\t\t\t\tsuccess: commandresult['success'],\n\t\t\t\t\tresult: commandresult['result'],\n\t\t\t\t\terrorMsg: commandresult['errorMsg']\n\t\t\t\t};\n\n\t\t\t\tthis._map.fire('postMessage', {msgId: 'Action_Save_Resp', args: postMessageObj});\n\t\t\t} else if (commandresult['command'] === 'load') {\n\t\t\t\tpostMessageObj = {\n\t\t\t\t\tsuccess: commandresult['success'],\n\t\t\t\t\tresult: commandresult['result'],\n\t\t\t\t\terrorMsg: commandresult['errorMsg']\n\t\t\t\t};\n\t\t\t\tthis._map.fire('postMessage', {msgId: 'Action_Load_Resp', args: postMessageObj});\n\t\t\t}\n\t\t\treturn;\n\t\t}\n\t\telse if (textMsg.startsWith('migrate:') && window.indirectSocket) {\n\t\t\tvar migrate = JSON.parse(textMsg.substring(textMsg.indexOf('{')));\n\t\t\tvar afterSave = migrate.afterSave;\n\t\t\tapp.idleHandler._serverRecycling = false;\n\t\t\tif (!afterSave) {\n\t\t\t\twindow.migrating = true;\n\t\t\t\tthis._map.uiManager.closeAll();\n\t\t\t\tif (this._map.isEditMode()) {\n\t\t\t\t\tthis._map.setPermission('view');\n\t\t\t\t\tthis._map.uiManager.showSnackbar(_('Document is getting migrated'), null, null, 3000);\n\t\t\t\t}\n\t\t\t\tif (migrate.saved) {\n\t\t\t\t\twindow.routeToken = migrate.routeToken;\n\t\t\t\t\twindow.expectedServerId = migrate.serverId;\n\t\t\t\t\tthis.manualReconnect(2000);\n\t\t\t\t}\n\t\t\t\treturn;\n\t\t\t}\n\t\t\t// even after save attempt, if document is unsaved reset the file permission\n\t\t\tif (migrate.saved) {\n\t\t\t\twindow.routeToken = migrate.routeToken;\n\t\t\t\twindow.expectedServerId = migrate.serverId;\n\t\t\t\tthis.manualReconnect(2000);\n\t\t\t} else {\n\t\t\t\tthis._map.setPermission(app.file.permission);\n\t\t\t\twindow.migrating = false;\n\t\t\t}\n\t\t\treturn;\n\t\t}\n\t\telse if (textMsg.startsWith('close: ')) {\n\t\t\ttextMsg = textMsg.substring('close: '.length);\n\t\t\tmsg = '';\n\t\t\tvar postMsgData = {};\n\t\t\tvar showMsgAndReload = false;\n\t\t\t// This is due to document owner terminating the session\n\t\t\tif (textMsg === 'ownertermination') {\n\t\t\t\tmsg = _('Session terminated by document owner');\n\t\t\t\tpostMsgData['Reason'] = 'OwnerTermination';\n\t\t\t}\n\t\t\telse if (textMsg === 'idle' || textMsg === 'oom') {\n\t\t\t\tapp.idleHandler._documentIdle = true;\n\t\t\t\tthis._map._docLayer._documentInfo = undefined;\n\t\t\t\tpostMsgData['Reason'] = 'DocumentIdle';\n\t\t\t\tif (textMsg === 'oom')\n\t\t\t\t\tpostMsgData['Reason'] = 'OOM';\n\t\t\t}\n\t\t\telse if (textMsg === 'shuttingdown') {\n\t\t\t\tmsg = _('Server is shutting down for maintenance (auto-saving)');\n\t\t\t\tpostMsgData['Reason'] = 'ShuttingDown';\n\t\t\t\tapp.idleHandler._active = false;\n\t\t\t\tapp.idleHandler._serverRecycling = true;\n\t\t\t}\n\t\t\telse if (textMsg === 'docdisconnected') {\n\t\t\t\tmsg = _('Oops, there is a problem connecting the document');\n\t\t\t\tpostMsgData['Reason'] = 'DocumentDisconnected';\n\t\t\t}\n\t\t\telse if (textMsg === 'recycling') {\n\t\t\t\tmsg = _('Server is down, restarting automatically. Please wait.');\n\t\t\t\tapp.idleHandler._active = false;\n\t\t\t\tapp.idleHandler._serverRecycling = true;\n\n\t\t\t\t// Prevent reconnecting the world at the same time.\n\t\t\t\tvar min = 5000;\n\t\t\t\tvar max = 10000;\n\t\t\t\tvar timeoutMs = Math.floor(Math.random() * (max - min) + min);\n\n\t\t\t\tvar socket = this;\n\t\t\t\tvar map = this._map;\n\t\t\t\tclearTimeout(this.timer);\n\t\t\t\tthis.timer = setInterval(function() {\n\t\t\t\t\tif (socket.connected()) {\n\t\t\t\t\t\t// We're connected: cancel timer and dialog.\n\t\t\t\t\t\tclearTimeout(this.timer);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\ttry {\n\t\t\t\t\t\tmap.loadDocument(map);\n\t\t\t\t\t} catch (error) {\n\t\t\t\t\t\twindow.app.console.warn('Cannot load document.');\n\t\t\t\t\t}\n\t\t\t\t}, timeoutMs);\n\t\t\t}\n\t\t\telse if (textMsg.startsWith('documentconflict')) {\n\t\t\t\tmsg = _('Document has changed in storage. Loading the new document. Your version is available as revision.');\n\t\t\t\tshowMsgAndReload = true;\n\t\t\t}\n\t\t\telse if (textMsg.startsWith('versionrestore:')) {\n\t\t\t\ttextMsg = textMsg.substring('versionrestore:'.length).trim();\n\t\t\t\tif (textMsg === 'prerestore_ack') {\n\t\t\t\t\tmsg = _('Restoring older revision. Any unsaved changes will be available in version history');\n\t\t\t\t\tthis._map.fire('postMessage', {msgId: 'App_VersionRestore', args: {Status: 'Pre_Restore_Ack'}});\n\t\t\t\t\tshowMsgAndReload = true;\n\t\t\t\t}\n\t\t\t}\n\t\t\telse if (textMsg.startsWith('reloadafterrename')) {\n\t\t\t\tmsg = _('Reloading the document after rename');\n\t\t\t\tshowMsgAndReload = true;\n\t\t\t}\n\n\t\t\tif (showMsgAndReload) {\n\t\t\t\tif (this._map._docLayer) {\n\t\t\t\t\tthis._map._docLayer.removeAllViews();\n\t\t\t\t}\n\t\t\t\t// Detach all the handlers from current socket, otherwise _onSocketClose tries to reconnect again\n\t\t\t\t// However, we want to reconnect manually here.\n\t\t\t\tthis.close();\n\n\t\t\t\t// Reload the document\n\t\t\t\tapp.idleHandler._active = false;\n\t\t\t\tmap = this._map;\n\t\t\t\tvar that = this;\n\t\t\t\tclearTimeout(this.timer);\n\t\t\t\tthis.timer = setInterval(function() {\n\t\t\t\t\ttry {\n\t\t\t\t\t\t// Activate and cancel timer and dialogs.\n\t\t\t\t\t\tapp.idleHandler._activate();\n\t\t\t\t\t\tthat._map.uiManager.documentNameInput.hideLoadingAnimation();\n\t\t\t\t\t} catch (error) {\n\t\t\t\t\t\twindow.app.console.warn('Cannot activate map');\n\t\t\t\t\t}\n\t\t\t\t}, 3000);\n\t\t\t}\n\n\t\t\t// Close any open dialogs first.\n\t\t\tthis._map.uiManager.closeAll();\n\n\t\t\tif (textMsg === 'idle' || textMsg === 'oom') {\n\t\t\t\tapp.idleHandler._dim();\n\t\t\t\tTileManager.discardAllCache();\n\t\t\t}\n\n\t\t\tif (postMsgData['Reason']) {\n\t\t\t\t// Tell WOPI host about it which should handle this situation\n\t\t\t\tthis._map.fire('postMessage', {msgId: 'Session_Closed', args: postMsgData});\n\t\t\t}\n\n\t\t\tif (textMsg === 'ownertermination') {\n\t\t\t\tthis._map.remove();\n\t\t\t}\n\n\t\t\treturn;\n\t\t}\n\t\telse if (textMsg.startsWith('error:')\n\t\t\t&& (command.errorCmd === 'storage'\n\t\t\t|| command.errorCmd === 'saveas')\n\t\t\t|| command.errorCmd === 'downloadas'\n\t\t\t|| command.errorCmd === 'exportas')  {\n\n\t\t\tif (command.errorCmd === 'saveas') {\n\t\t\t\tthis._map.fire('postMessage', {\n\t\t\t\t\tmsgId: 'Action_Save_Resp',\n\t\t\t\t\targs: {\n\t\t\t\t\t\tsuccess: false,\n\t\t\t\t\t\tresult: command.errorKind\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tthis._map.hideBusy();\n\t\t\tvar storageError;\n\t\t\tif (command.errorKind === 'savediskfull') {\n\t\t\t\tstorageError = errorMessages.storage.savediskfull;\n\t\t\t}\n\t\t\telse if (command.errorKind === 'savetoolarge') {\n\t\t\t\tstorageError = errorMessages.storage.savetoolarge;\n\t\t\t}\n\t\t\telse if (command.errorKind === 'savefailed') {\n\t\t\t\tstorageError = errorMessages.storage.savefailed;\n\t\t\t}\n\t\t\telse if (command.errorKind === 'renamefailed') {\n\t\t\t\tstorageError = errorMessages.storage.renamefailed;\n\t\t\t}\n\t\t\telse if (command.errorKind === 'saveunauthorized') {\n\t\t\t\tstorageError = errorMessages.storage.saveunauthorized;\n\t\t\t}\n\t\t\telse if (command.errorKind === 'saveasfailed') {\n\t\t\t\tstorageError = errorMessages.storage.saveasfailed;\n\t\t\t}\n\t\t\telse if (command.errorKind === 'loadfailed') {\n\t\t\t\tstorageError = errorMessages.storage.loadfailed;\n\t\t\t\t// Since this is a document load failure, wsd will disconnect the socket anyway,\n\t\t\t\t// better we do it first so that another error message doesn't override this one\n\t\t\t\t// upon socket close.\n\t\t\t\tthis.close();\n\t\t\t}\n\t\t\telse if (command.errorKind === 'documentconflict')\n\t\t\t{\n\t\t\t\tif (this._map.isReadOnlyMode())\n\t\t\t\t\treturn;\n\t\t\t\telse\n\t\t\t\t\tthis._showDocumentConflictPopUp();\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Skip empty errors (and allow for suppressing errors by making them blank).\n\t\t\tif (storageError && storageError != '') {\n\t\t\t\t// Parse the storage url as link\n\t\t\t\tvar tmpLink = document.createElement('a');\n\t\t\t\ttmpLink.href = this._map.options.doc;\n\t\t\t\t// Insert the storage server address to be more friendly\n\t\t\t\tstorageError = storageError.replace('%storageserver', tmpLink.host);\n\n\t\t\t\t// show message to the user in Control.AlertDialog\n\t\t\t\tthis._map.fire('warn', {msg: storageError});\n\n\t\t\t\t// send to wopi handler so we can respond\n\t\t\t\tvar postMessageObj = {\n\t\t\t\t\tsuccess: false,\n\t\t\t\t\tcmd: command.errorCmd,\n\t\t\t\t\tresult: command.errorKind,\n\t\t\t\t\terrorMsg: storageError\n\t\t\t\t};\n\n\t\t\t\tthis._map.fire('postMessage', {msgId: 'Action_Save_Resp', args: postMessageObj});\n\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\t\telse if (textMsg.startsWith('error:') && command.errorCmd === 'internal') {\n\t\t\tthis._map.hideBusy();\n\t\t\tthis._map._fatal = true;\n\t\t\tif (command.errorKind === 'diskfull') {\n\t\t\t\tthis._map.fire('error', {msg: errorMessages.diskfull});\n\t\t\t}\n\t\t\telse if (command.errorKind === 'unauthorized') {\n\t\t\t\tvar postMessageObj = {\n\t\t\t\t\terrorType: 'websocketunauthorized',\n\t\t\t\t\tsuccess: false,\n\t\t\t\t\terrorMsg: this._buildUnauthorizedMessage(command),\n\t\t\t\t\tresult: '',\n\t\t\t\t};\n\t\t\t\tthis._map.fire('postMessage', { msgId: 'Action_Load_Resp', args: postMessageObj });\n\t\t\t}\n\n\t\t\tif (this._map._docLayer) {\n\t\t\t\tthis._map._docLayer.removeAllViews();\n\t\t\t\tthis._map._docLayer._resetClientVisArea();\n\t\t\t}\n\t\t\tthis.close();\n\n\t\t\treturn;\n\t\t}\n\t\telse if (textMsg.startsWith('error:') && command.errorCmd === 'load') {\n\t\t\tthis._map.hideBusy();\n\t\t\tthis.close();\n\n\t\t\tvar errorKind = command.errorKind;\n\t\t\tvar passwordNeeded = false;\n\t\t\tif (errorKind.startsWith('passwordrequired')) {\n\t\t\t\tpasswordNeeded = true;\n\t\t\t\tvar msg = '';\n\t\t\t\tvar passwordType = errorKind.split(':')[1];\n\t\t\t\tif (passwordType === 'to-view') {\n\t\t\t\t\tmsg += _('Document requires password to view.');\n\t\t\t\t}\n\t\t\t\telse if (passwordType === 'to-modify') {\n\t\t\t\t\tmsg += _('Document requires password to modify.');\n\t\t\t\t\tmsg += ' ';\n\t\t\t\t\tmsg += _('Hit Cancel to open in view-only mode.');\n\t\t\t\t}\n\t\t\t} else if (errorKind.startsWith('wrongpassword')) {\n\t\t\t\tpasswordNeeded = true;\n\t\t\t\tmsg = _('Wrong password provided. Please try again.');\n\t\t\t} else if (errorKind.startsWith('faileddocloading')) {\n\t\t\t\tthis._map._fatal = true;\n\t\t\t\tthis._map.fire('error', {msg: errorMessages.faileddocloading});\n\t\t\t} else if (errorKind.startsWith('docloadtimeout')) {\n\t\t\t\tthis._map._fatal = true;\n\t\t\t\tthis._map.fire('error', {msg: errorMessages.docloadtimeout});\n\t\t\t} else if (errorKind.startsWith('docunloading')) {\n\t\t\t\t// The document is unloading. Have to wait a bit.\n\t\t\t\tapp.idleHandler._active = false;\n\n\t\t\t\tclearTimeout(this.timer);\n\t\t\t\tif (this.ReconnectCount++ >= 10) {\n\t\t\t\t\tthis._map.fire('error', {msg: errorMessages.docunloadinggiveup});\n\t\t\t\t\treturn; // Give up.\n\t\t\t\t}\n\n\t\t\t\tthis.timer = setInterval(function() {\n\t\t\t\t\ttry {\n\t\t\t\t\t\t// Activate and cancel timer and dialogs.\n\t\t\t\t\t\tapp.idleHandler._activate();\n\t\t\t\t\t} catch (error) {\n\t\t\t\t\t\twindow.app.console.warn('Cannot activate map');\n\t\t\t\t\t}\n\t\t\t\t// .5, 2, 4.5, 8, 12.5, 18, 24.5, 32, 40.5 seconds\n\t\t\t\t}, 500 * this.ReconnectCount * this.ReconnectCount); // Quadratic back-off.\n\n\t\t\t\tif (this.ReconnectCount > 1) {\n\t\t\t\t\tthis._map.showBusy(errorMessages.docunloadingretry, false);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (passwordNeeded) {\n\t\t\t\tthis._askForDocumentPassword(passwordType, msg);\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\t\telse if (textMsg.startsWith('error:') && command.errorCmd === 'dialogevent' && command.errorKind === 'cantchangepass') {\n\t\t\tvar msg = _('Only the document owner can change the password.');\n\t\t\tthis._map.uiManager.showInfoModal('cool_alert', '', msg, '', _('OK'));\n\t\t\treturn;\n\t\t}\n\t\telse if (textMsg.startsWith('error:') && !this._map._docLayer) {\n\t\t\ttextMsg = textMsg.substring(6);\n\t\t\tif (command.errorKind === 'hardlimitreached') {\n\n\t\t\t\ttextMsg = errorMessages.limitreachedprod;\n\t\t\t\ttextMsg = textMsg.replace('{0}', command.params[0]);\n\t\t\t\ttextMsg = textMsg.replace('{1}', command.params[1]);\n\t\t\t}\n\t\t\telse if (command.errorKind === 'serviceunavailable') {\n\t\t\t\ttextMsg = errorMessages.serviceunavailable;\n\t\t\t}\n\t\t\tthis._map._fatal = true;\n\t\t\tapp.idleHandler._active = false; // Practically disconnected.\n\t\t\tthis._map.fire('error', {msg: textMsg});\n\t\t}\n\t\telse if (textMsg.startsWith('fontsmissing:')) {\n\t\t\tvar fontsMissingObj = JSON.parse(textMsg.substring(textMsg.indexOf('{')));\n\t\t\tvar msg = ' ';\n\t\t\tfor (var i = 0; i < fontsMissingObj.fontsmissing.length; ++i) {\n\t\t\t\tif (i > 0)\n\t\t\t\t\tmsg += ', ';\n\t\t\t\tmsg += fontsMissingObj.fontsmissing[i];\n\t\t\t}\n\n\t\t\tif (this._map.welcome && !this._map.welcome.isGuest() && this._map.welcome.shouldWelcome() && window.autoShowWelcome)\n\t\t\t{\n\t\t\t\tsetTimeout(function() {\n\t\t\t\t\tthis._map.uiManager.showInfoModal('fontsmissing', _('Missing Fonts'), msg, null, _('Close'));\n\t\t\t\t}.bind(this), 60000);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis._map.uiManager.showInfoModal('fontsmissing', _('Missing Fonts'), msg, null, _('Close'));\n\t\t\t}\n\t\t}\n\t\telse if (textMsg.startsWith('info:') && command.errorCmd === 'socket') {\n\t\t\tif (command.errorKind === 'limitreached' && !this.WasShownLimitDialog) {\n\t\t\t\tthis.WasShownLimitDialog = true;\n\t\t\t\ttextMsg = errorMessages.limitreached;\n\t\t\t\ttextMsg = textMsg.replace('{docs}', command.params[0]);\n\t\t\t\ttextMsg = textMsg.replace('{connections}', command.params[1]);\n\t\t\t\ttextMsg = textMsg.replace('{productname}', (typeof brandProductName !== 'undefined' ?\n\t\t\t\t\tbrandProductName : 'Collabora Online Development Edition (unbranded)'));\n\t\t\t\tthis._map.fire('infobar',\n\t\t\t\t\t{\n\t\t\t\t\t\tmsg: textMsg,\n\t\t\t\t\t\taction: app.util.getProduct(),\n\t\t\t\t\t\tactionLabel: errorMessages.infoandsupport\n\t\t\t\t\t});\n\t\t\t}\n\t\t}\n\t\telse if (textMsg.startsWith('pong ') && this._map._debug.pingOn) {\n\t\t\tthis._map._debug.reportPong(command.rendercount);\n\t\t}\n\t\telse if (textMsg.startsWith('saveas:') || textMsg.startsWith('renamefile:')) {\n\t\t\tthis._renameOrSaveAsCallback(textMsg, command);\n\t\t}\n\t\telse if (textMsg.startsWith('exportas:')) {\n\t\t\tthis._exportAsCallback(command);\n\t\t}\n\t\telse if (textMsg.startsWith('warn:')) {\n\t\t\tvar len = 'warn: '.length;\n\t\t\ttextMsg = textMsg.substring(len);\n\t\t\tif (textMsg.startsWith('saveas:')) {\n\t\t\t\tvar userName = command.username ? command.username : _('Someone');\n\t\t\t\tvar message = _('{username} saved this document as {filename}. Do you want to join?').replace('{username}', userName).replace('{filename}', command.filename);\n\n\t\t\t\tthis._map.uiManager.showConfirmModal('save-as-warning', '', message, _('OK'), function() {\n\t\t\t\t\tthis._renameOrSaveAsCallback(textMsg, command);\n\t\t\t\t}.bind(this));\n\t\t\t}\n\t\t}\n\t\telse if (window.ThisIsAMobileApp && textMsg.startsWith('mobile:')) {\n\t\t\t// allow passing some events easily from the mobile app\n\t\t\tvar mobileEvent = textMsg.substring('mobile: '.length);\n\t\t\tthis._map.fire(mobileEvent);\n\t\t}\n\t\telse if (textMsg.startsWith('blockui:')) {\n\t\t\ttextMsg = textMsg.substring('blockui:'.length).trim();\n\t\t\tmsg = null;\n\n\t\t\tif (textMsg === 'rename') {\n\t\t\t\tmsg = _('The document is being renamed and will reload shortly');\n\t\t\t}\n\t\t\telse if (textMsg === 'switchingtooffline') {\n\t\t\t\tmsg = _('The document is switching to Offline mode and will reload shortly');\n\t\t\t}\n\n\t\t\tthis._map.fire('blockUI', {message: msg});\n\t\t\treturn;\n\t\t}\n\t\telse if (textMsg.startsWith('unblockui:')) {\n\t\t\tthis._map.fire('unblockUI');\n\t\t\treturn;\n\t\t}\n\t\telse if (textMsg.startsWith('featurelock: ')) {\n\t\t\t// Handle feature locking related messages\n\t\t\tvar lockInfo = JSON.parse(textMsg.substring(textMsg.indexOf('{')));\n\t\t\tthis._map._setLockProps(lockInfo);\n\t\t\treturn;\n\t\t}\n\t\telse if (textMsg.startsWith('restrictedCommands: ')) {\n\t\t\t// Handle restriction related messages\n\t\t\tvar restrictionInfo = JSON.parse(textMsg.substring(textMsg.indexOf('{')));\n\t\t\tthis._map._setRestrictions(restrictionInfo);\n\t\t\treturn;\n\t\t}\n\t\telse if (textMsg.startsWith('blockedcommand: ')) {\n\t\t\tvar blockedInfo = app.socket.parseServerCmd(textMsg.substring(16));\n\t\t\tif (blockedInfo.errorKind === 'restricted')\n\t\t\t\twindow.app.console.log('Restricted command \"' + blockedInfo.errorCmd + '\" was blocked');\n\t\t\telse if (blockedInfo.errorKind === 'locked')\n\t\t\t\tthis._map.openUnlockPopup(blockedInfo.errorCmd);\n\t\t\treturn;\n\t\t}\n\t\telse if (textMsg.startsWith('updateroutetoken') && window.indirectSocket) {\n\t\t\twindow.routeToken = textMsg.split(' ')[1];\n\t\t\twindow.app.console.log('updated routeToken: ' + window.routeToken);\n\t\t}\n\t\telse if (textMsg.startsWith('reload')) {\n\t\t\t// Switching modes.\n\t\t\twindow.location.reload(false);\n\t\t}\n\t\telse if (!textMsg.startsWith('tile:') && !textMsg.startsWith('delta:') &&\n\t\t\t     !textMsg.startsWith('renderfont:') && !textMsg.startsWith('slidelayer:') &&\n\t\t\t     !textMsg.startsWith('windowpaint:')) {\n\n\t\t\tif (imgBytes !== undefined) {\n\t\t\t\ttry {\n\t\t\t\t\t// if it's not a tile, parse the whole message\n\t\t\t\t\ttextMsg = String.fromCharCode.apply(null, imgBytes);\n\t\t\t\t} catch (error) {\n\t\t\t\t\t// big data string\n\t\t\t\t\ttextMsg = this._utf8ToString(imgBytes);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Decode UTF-8 in case it is binary frame. Disable this block\n\t\t\t// in the iOS app as the image data is not URL encoded.\n\t\t\tif (typeof e.data === 'object') {\n\t\t\t\t// FIXME: Not sure what this code is supposed to do. Doesn't\n\t\t\t\t// decodeURIComponent() exactly reverse what window.escape() (which\n\t\t\t\t// is a deprecated equivalent of encodeURIComponent()) does? In what\n\t\t\t\t// case is this code even hit? If somebody figures out what is going\n\t\t\t\t// on here, please replace this comment with an explanation.\n\t\t\t\ttextMsg = decodeURIComponent(window.escape(textMsg));\n\t\t\t}\n\t\t}\n\n\t\tif (textMsg.startsWith('status:')) {\n\t\t\tthis._onStatusMsg(textMsg, JSON.parse(textMsg.replace('status:', '').replace('statusupdate:', '')));\n\t\t\treturn;\n\t\t}\n\n\t\t// These can arrive very early during the startup, and never again.\n\t\tif (textMsg.startsWith('progress:')) {\n\t\t\tvar info = JSON.parse(textMsg.substring(textMsg.indexOf('{')));\n\t\t\tif (!info)\n\t\t\t{\n\t\t\t\twindow.app.console.error('Missing info in progress: message');\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tinfo.statusType = info.id;\n\t\t\tinfo.background = info.type == 'bg';\n\n\t\t\tif (info.id == 'find' || info.id == 'connect' || info.id == 'ready')\n\t\t\t{\n\t\t\t\tthis._map.showBusy(window.ThisIsAMobileApp? _('Loading...'): _('Connecting...'), true);\n\t\t\t\tif (info.id == \"ready\") {\n\t\t\t\t\t// We're connected: cancel timer and dialog.\n\t\t\t\t\tthis.ReconnectCount = 0;\n\t\t\t\t\tclearTimeout(this.timer);\n\t\t\t\t}\n\t\t\t} else if (info.id == 'start' || info.id == 'setvalue')\n\t\t\t\tthis._map.fire('statusindicator', info);\n\n\t\t\telse if (info.id == 'finish') {\n\t\t\t\tthis._map.fire('statusindicator', info);\n\t\t\t\tthis._map._fireInitComplete('statusindicatorfinish');\n\t\t\t\t// show shutting down popup after saving is finished\n\t\t\t\t// if we show the popup just after the shuttingdown message, it will be overwitten by save popup\n\t\t\t\tif (app.idleHandler._serverRecycling) {\n\t\t\t\t\tthis._map.showBusy(_('Server is shutting down'), false);\n\t\t\t\t}\n\t\t\t} else\n\t\t\t\twindow.app.console.error('Unknown progress status ' + info.id);\n\t\t\treturn;\n\t\t}\n\t\telse if (textMsg.startsWith('jsdialog:')) {\n\t\t\tthis._onJSDialog(textMsg, e.callback);\n\t\t}\n\t\telse if (textMsg.startsWith('hyperlinkclicked:')) {\n\t\t\tthis._onHyperlinkClickedMsg(textMsg);\n\t\t}\n\t\telse if (textMsg.startsWith('browsersetting:')) {\n\t\t\twindow.prefs._initializeBrowserSetting(textMsg);\n\t\t}\n\n\t\tif (textMsg.startsWith('downloadas:')) {\n\t\t\tvar postMessageObj = {\n\t\t\t\tsuccess: true,\n\t\t\t\tresult: 'exportas',\n\t\t\t\terrorMsg: ''\n\t\t\t};\n\n\t\t\tthis._map.fire('postMessage', {msgId: 'Action_Save_Resp', args: postMessageObj});\n\t\t\t// intentional falltrough\n\t\t}\n\n\t\tif (!this._map._docLayer || this._handlingDelayedMessages) {\n\t\t\tthis._delayMessage(textMsg);\n\t\t} else {\n\t\t\tthis._map._docLayer._onMessage(textMsg, e.image);\n\t\t}\n\t},\n\n\t_exportAsCallback: function(command) {\n\t\tthis._map.hideBusy();\n\t\tthis._map.uiManager.showInfoModal('exported-success', _('Exported to storage'), _('Successfully exported: ') + decodeURIComponent(command.filename), '', _('OK'));\n\t},\n\n\t_askForDocumentPassword: function(passwordType, msg) {\n\t\tthis._map.uiManager.showInputModal('password-popup', '', msg, '', _('OK'), function(data) {\n\t\t\tif (data) {\n\t\t\t\tthis._map._docPassword = data;\n\t\t\t\tif (window.ThisIsAMobileApp) {\n\t\t\t\t\twindow.postMobileMessage('loadwithpassword password=' + data);\n\t\t\t\t}\n\t\t\t\tthis._map.loadDocument();\n\t\t\t} else if (passwordType === 'to-modify') {\n\t\t\t\tthis._map._docPassword = '';\n\t\t\t\tthis._map.loadDocument();\n\t\t\t} else {\n\t\t\t\tthis._map.fire('postMessage', {msgId: 'UI_Cancel_Password'});\n\t\t\t\tthis._map.hideBusy();\n\t\t\t}\n\t\t}.bind(this), true /* password input */);\n\t},\n\n\t_showDocumentConflictPopUp: function() {\n\t\tvar buttonList = [];\n\t\tvar callbackList = [];\n\n\t\tbuttonList.push({ id: 'cancel-conflict-popup', text: _('Cancel') });\n\t\tcallbackList.push({ id: 'cancel-conflict-popup', func_: null });\n\n\t\tbuttonList.push({ id: 'discard-button', text: _('Discard') });\n\t\tbuttonList.push({ id: 'overwrite-button', text: _('Overwrite') });\n\n\t\tcallbackList.push({id: 'discard-button', func_: function() {\n\t\t\tthis.sendMessage('closedocument');\n\t\t}.bind(this) });\n\n\t\tcallbackList.push({id: 'overwrite-button', func_: function() {\n\t\t\tthis.sendMessage('savetostorage force=1'); }.bind(this)\n\t\t});\n\n\t\tif (!this._map['wopi'].UserCanNotWriteRelative) {\n\t\t\tbuttonList.push({ id: 'save-to-new-file', text: _('Save to new file') });\n\t\t\tcallbackList.push({ id: 'save-to-new-file', func_: function() {\n\t\t\t\tvar filename = this._map['wopi'].BaseFileName;\n\t\t\t\tif (filename) {\n\t\t\t\t\tfilename = app.LOUtil.generateNewFileName(filename, '_new');\n\t\t\t\t\tthis._map.saveAs(filename);\n\t\t\t\t}\n\t\t\t}.bind(this)});\n\t\t}\n\n\t\tvar title = _('Document has been changed');\n\t\tvar message = _('Document has been changed in storage. What would you like to do with your unsaved changes?');\n\n\t\tthis._map.uiManager.showModalWithCustomButtons('document-conflict-popup', title, message, false, buttonList, callbackList);\n\t},\n\n\t_renameOrSaveAsCallback: function(textMsg, command) {\n\t\tthis._map.hideBusy();\n\t\tif (command !== undefined && command.url !== undefined && command.url !== '') {\n\t\t\tvar url = command.url;\n\n\t\t\t// setup for loading the new document, and trigger the load\n\t\t\tvar docUrl = url.split('?')[0];\n\t\t\tthis._map.options.doc = docUrl;\n\t\t\tthis._map.options.previousWopiSrc = this._map.options.wopiSrc; // After save-as op, we may connect to another server, then code will think that server has restarted. In this case, we don't want to reload the page (detect the file name is different).\n\t\t\tthis._map.options.wopiSrc = docUrl;\n\t\t\twindow.wopiSrc = this._map.options.wopiSrc;\n\n\t\t\tif (textMsg.startsWith('renamefile:')) {\n\t\t\t\tthis._map.uiManager.documentNameInput.showLoadingAnimation();\n\t\t\t\tthis._map.fire('postMessage', {\n\t\t\t\t\tmsgId: 'File_Rename',\n\t\t\t\t\targs: {\n\t\t\t\t\t\tNewName: command.filename\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t} else if (textMsg.startsWith('saveas:')) {\n\t\t\t\tvar accessToken = this._getParameterByName(url, 'access_token');\n\t\t\t\tvar accessTokenTtl = this._getParameterByName(url, 'access_token_ttl');\n\t\t\t\tlet noAuthHeader = this._getParameterByName(url, 'no_auth_header');\n\n\t\t\t\tif (accessToken !== undefined) {\n\t\t\t\t\tif (accessTokenTtl === undefined) {\n\t\t\t\t\t\taccessTokenTtl = 0;\n\t\t\t\t\t}\n\t\t\t\t\tthis._map.options.docParams = { 'access_token': accessToken, 'access_token_ttl': accessTokenTtl, 'no_auth_header': noAuthHeader };\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tthis._map.options.docParams = {};\n\t\t\t\t}\n\n\t\t\t\t// if this is save-as, we need to load the document with edit permission\n\t\t\t\t// otherwise the user has to close the doc then re-open it again\n\t\t\t\t// in order to be able to edit.\n\t\t\t\tapp.setPermission('edit');\n\t\t\t\tthis.close();\n\t\t\t\tthis._map.loadDocument();\n\t\t\t\tthis._map.sendInitUNOCommands();\n\t\t\t\tthis._map.fire('postMessage', {\n\t\t\t\t\tmsgId: 'Action_Save_Resp',\n\t\t\t\t\targs: {\n\t\t\t\t\t\tsuccess: true,\n\t\t\t\t\t\tfileName: decodeURIComponent(command.filename)\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t\t// var name = command.name; - ignored, we get the new name via the wopi's BaseFileName\n\t},\n\n\t_delayMessage: function(textMsg) {\n\t\tvar message = {msg: textMsg};\n\t\tthis._delayedMessages.push(message);\n\t},\n\n\t_handleDelayedMessages: function(docLayer) {\n\t\tthis._handlingDelayedMessages = true;\n\n\t\twhile (this._delayedMessages.length) {\n\t\t\tvar message = this._delayedMessages.shift();\n\t\t\ttry {\n\t\t\t\tdocLayer._onMessage(message.msg);\n\t\t\t} catch (e) {\n\t\t\t\t// unpleasant - but stops this one problem\n\t\t\t\t// event stopping an unknown number of others.\n\t\t\t\twindow.app.console.error('Exception ' + e + ' emitting event ' + message, e.stack);\n\t\t\t}\n\t\t}\n\n\t\tthis._handlingDelayedMessages = false;\n\t},\n\n\t_onStatusMsg: function(textMsg, command) {\n\t\tvar that = this;\n\n\t\tif (!this._isReady()) {\n\t\t\t// Retry in a bit.\n\t\t\tsetTimeout(function() {\n\t\t\t\tthat._onStatusMsg(textMsg, command);\n\t\t\t}, 10);\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this._map._docLayer) {\n\t\t\t// initialize and append text input before doc layer\n\t\t\tthis._map.initTextInput(command.type);\n\n\t\t\t// Reinitialize the menubar and top toolbar if browser settings are enabled.\n\t\t\t// During the initial `initializeBasicUI` call, we don't know if compact mode is enabled.\n\t\t\t// Before `doclayerinit`, we recheck the compact mode setting and if conditions are met,\n\t\t\t// add the top toolbar and menubar controls to the map.\n\t\t\tif (window.prefs.useBrowserSetting) {\n\t\t\t\tif (!window.mode.isMobile() && this._map.uiManager.getCurrentMode() === 'notebookbar')\n\t\t\t\t\tthis._map.uiManager.removeClassicUI();\n\t\t\t\telse if (!this._map.menubar)\n\t\t\t\t\tthis._map.uiManager.initializeMenubarAndTopToolbar();\n\t\t\t}\n\n\t\t\t// first status message, we need to create the document layer\n\t\t\tvar tileWidthTwips = this._map.options.tileWidthTwips;\n\t\t\tvar tileHeightTwips = this._map.options.tileHeightTwips;\n\t\t\tif (this._map.options.zoom !== this._map.options.defaultZoom) {\n\t\t\t\tvar scale = this._map.options.crs.scale(this._map.options.defaultZoom - this._map.options.zoom);\n\t\t\t\ttileWidthTwips = Math.round(tileWidthTwips * scale);\n\t\t\t\ttileHeightTwips = Math.round(tileHeightTwips * scale);\n\t\t\t}\n\n\t\t\tvar docLayer = null;\n\t\t\tvar options = {\n\t\t\t\ttileWidthTwips: tileWidthTwips / app.dpiScale,\n\t\t\t\ttileHeightTwips: tileHeightTwips / app.dpiScale,\n\t\t\t\tdocType: command.type,\n\t\t\t\tviewId: command.viewid\n\t\t\t};\n\t\t\tif (command.type === 'text')\n\t\t\t\tdocLayer = new L.WriterTileLayer(options);\n\t\t\telse if (command.type === 'spreadsheet')\n\t\t\t\tdocLayer = new L.CalcTileLayer(options);\n\t\t\telse if (command.type === 'presentation' || command.type === 'drawing')\n\t\t\t\tdocLayer = new L.ImpressTileLayer(options);\n\n\t\t\tthis._map._docLayer = docLayer;\n\t\t\tthis._map.addLayer(docLayer);\n\t\t\tthis._map.fire('doclayerinit');\n\t\t}\n\t\telse if (this._reconnecting) {\n\t\t\t// we are reconnecting ...\n\t\t\tthis._map._docLayer._resetClientVisArea();\n\t\t\tTileManager.refreshTilesInBackground();\n\t\t\tthis._map.fire('statusindicator', { statusType: 'reconnected' });\n\n\t\t\tvar darkTheme = window.prefs.getBoolean('darkTheme');\n\t\t\tthis._map.uiManager.activateDarkModeInCore(darkTheme);\n\t\t\tthis._map.uiManager.applyInvert();\n\t\t\tthis._map.uiManager.setCanvasColorAfterModeChange();\n\n\t\t\tvar uiMode = this._map.uiManager.getCurrentMode();\n\t\t\tif (uiMode === 'notebookbar' && this._map.uiManager.notebookbar) {\n\t\t\t\tthis._map.uiManager.notebookbar.resetInCore();\n\t\t\t\tthis._map.uiManager.notebookbar.initializeInCore();\n\t\t\t}\n\t\t\t// close all the popups otherwise document textArea will not get focus\n\t\t\tthis._map.uiManager.closeAll();\n\t\t\tthis._map.setPermission(app.file.permission);\n\t\t\twindow.migrating = false;\n\t\t\tthis._map.uiManager.initializeSidebar();\n\t\t\tthis._map.uiManager.refreshTheme();\n\t\t}\n\n\t\tthis._map.fire('docloaded', {status: true});\n\t\tif (this._map._docLayer) {\n\t\t\tthis._map._docLayer._onMessage(textMsg);\n\n\t\t\t// call update view list viewId if it is not defined yet\n\t\t\tif (!this._map._docLayer._getViewId())\n\t\t\t\tthis._map.fire('updateviewslist');\n\n\t\t\tthis._reconnecting = false;\n\n\t\t\t// Applying delayed messages\n\t\t\t// note: delayed messages cannot be done before:\n\t\t\t// a) docLayer.map is set by map.addLayer(docLayer)\n\t\t\t// b) docLayer._onStatusMsg (via _docLayer._onMessage)\n\t\t\t// has set the viewid\n\t\t\tthis._handleDelayedMessages(docLayer);\n\t\t}\n\t},\n\n\t_onJSDialog: function(textMsg, callback) {\n\t\tvar msgData = JSON.parse(textMsg.substring('jsdialog:'.length + 1));\n\n\t\tif (msgData.children && !app.util.isArray(msgData.children)) {\n\t\t\twindow.app.console.warn('_onJSDialogMsg: The children\\'s data should be created of array type');\n\t\t\treturn;\n\t\t}\n\n\t\tJSDialog.MessageRouter.processMessage(msgData, callback);\n\t},\n\n\t_onHyperlinkClickedMsg: function (textMsg) {\n\t\tvar link = null;\n\t\tvar coords = null;\n\t\tvar hyperlinkMsgStart = 'hyperlinkclicked: ';\n\t\tvar coordinatesMsgStart = ' coordinates: ';\n\n\t\tif (textMsg.indexOf(coordinatesMsgStart) !== -1) {\n\t\t\tvar coordpos = textMsg.indexOf(coordinatesMsgStart);\n\t\t\tlink = textMsg.substring(hyperlinkMsgStart.length, coordpos);\n\t\t\tcoords = textMsg.substring(coordpos+coordinatesMsgStart.length);\n\t\t} else\n\t\t\tlink = textMsg.substring(hyperlinkMsgStart.length);\n\n\t\tthis._map.fire('hyperlinkclicked', {url: link, coordinates: coords});\n\t},\n\n\t_onSocketError: function (event) {\n\t\twindow.app.console.warn('_onSocketError:', event);\n\t\tthis._map.hideBusy();\n\t\t// Let onclose (_onSocketClose) report errors.\n\t},\n\n\t_onSocketClose: function (event) {\n\t\twindow.app.console.debug('_onSocketClose:');\n\t\tif (!this._map._docLoadedOnce && this.ReconnectCount === 0) {\n\t\t\tvar errorMsg, errorType = '';\n\t\t\tvar reason = event.reason;\n\t\t\tif (reason && reason.startsWith('error:')) {\n\t\t\t\tvar command = this.parseServerCmd(reason);\n\t\t\t\tif (command.errorCmd === 'internal' && command.errorKind === 'unauthorized') {\n\t\t\t\t\terrorType = 'websocketunauthorized';\n\t\t\t\t\terrorMsg = this._buildUnauthorizedMessage(command);\n\t\t\t\t} else if (command.errorCmd === 'storage' && command.errorKind === 'loadfailed') {\n\t\t\t\t\terrorType = 'websocketloadfailed';\n\t\t\t\t\terrorMsg = errorMessages.storage.loadfailed;\n\t\t\t\t} else {\n\t\t\t\t\terrorType = 'websocketgenericfailure';\n\t\t\t\t\terrorMsg = errorMessages.websocketgenericfailure;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\terrorType = 'websocketproxyfailure';\n\t\t\t\terrorMsg = errorMessages.websocketproxyfailure;\n\t\t\t}\n\t\t\tthis._map.fire('error', { msg: errorMsg, cmd: 'socket', kind: 'closed', id: 4 });\n\t\t\tvar postMessageObj = {\n\t\t\t\terrorType: errorType,\n\t\t\t\tsuccess: false,\n\t\t\t\terrorMsg: errorMsg,\n\t\t\t\tresult: '',\n\t\t\t};\n\t\t\tthis._map.fire('postMessage', { msgId: 'Action_Load_Resp', args: postMessageObj });\n\t\t\treturn;\n\t\t}\n\t\tif (this.ReconnectCount > 0)\n\t\t\treturn;\n\n\t\tvar isActive = app.idleHandler._active;\n\t\tthis._map.hideBusy();\n\t\tapp.idleHandler._active = false;\n\t\tapp.idleHandler._serverRecycling = false;\n\n\t\tif (this._map._docLayer) {\n\t\t\tthis._map._docLayer.removeAllViews();\n\t\t\tthis._map._docLayer._resetClientVisArea();\n\t\t\tif (GraphicSelection.hasActiveSelection())\n\t\t\t\tGraphicSelection.rectangle = null;\n\t\t\tif (this._map._docLayer._docType === 'presentation')\n\t\t\t\tapp.setCursorVisibility(false);\n\n\t\t\tthis._map._docLayer._resetCanonicalIdStatus();\n\t\t\tthis._map._docLayer._resetViewId();\n\t\t\tthis._map._docLayer._resetDocumentInfo();\n\t\t}\n\n\t\tif (isActive && this._reconnecting) {\n\t\t\t// Don't show this before first transparently trying to reconnect.\n\t\t\tthis._map.fire('error', {msg: _('Well, this is embarrassing, we cannot connect to your document. Please try again.'), cmd: 'socket', kind: 'closed', id: 4});\n\t\t}\n\n\t\t// Reset wopi's app loaded so that reconnecting again informs outerframe about initialization\n\t\tthis._map['wopi'].resetAppLoaded();\n\t\tthis._map.fire('docloaded', {status: false});\n\n\t\t// We need to make sure that the message slurping processes the\n\t\t// events first, because there could have been a message like\n\t\t// \"close: idle\" from the server.\n\t\t// Without the timeout, we'd immediately reconnect (because the\n\t\t// \"close: idle\" was not processed yet).\n\t\tvar that = this;\n\t\tsetTimeout(function () {\n\t\t\tif (!that._reconnecting) {\n\t\t\t\tthat._reconnecting = true;\n\t\t\t\tif (!app.idleHandler._documentIdle)\n\t\t\t\t\tthat._map.showBusy(_('Reconnecting...'), false);\n\t\t\t\tapp.idleHandler._activate();\n\t\t\t}\n\t\t}, 1 /* ms */);\n\n\t\tif (this._map.isEditMode()) {\n\t\t\tthis._map.setPermission('view');\n\t\t}\n\n\t\tif (!this._map['wopi'].DisableInactiveMessages && app.sectionContainer && !app.sectionContainer.testing)\n\t\t\tthis._map.uiManager.showSnackbar(_('The server has been disconnected.'));\n\t},\n\n\tparseServerCmd: function (msg) {\n\t\tvar tokens = msg.split(/[ \\n]+/);\n\t\tvar command = {};\n\t\tfor (var i = 0; i < tokens.length; i++) {\n\t\t\tif (tokens[i].substring(0, 9) === 'tileposx=') {\n\t\t\t\tcommand.x = parseInt(tokens[i].substring(9));\n\t\t\t}\n\t\t\telse if (tokens[i].substring(0, 9) === 'tileposy=') {\n\t\t\t\tcommand.y = parseInt(tokens[i].substring(9));\n\t\t\t}\n\t\t\telse if (tokens[i].substring(0, 2) === 'x=') {\n\t\t\t\tcommand.x = parseInt(tokens[i].substring(2));\n\t\t\t}\n\t\t\telse if (tokens[i].substring(0, 2) === 'y=') {\n\t\t\t\tcommand.y = parseInt(tokens[i].substring(2));\n\t\t\t}\n\t\t\telse if (tokens[i].substring(0, 10) === 'tilewidth=') {\n\t\t\t\tcommand.tileWidth = parseInt(tokens[i].substring(10));\n\t\t\t}\n\t\t\telse if (tokens[i].substring(0, 11) === 'tileheight=') {\n\t\t\t\tcommand.tileHeight = parseInt(tokens[i].substring(11));\n\t\t\t}\n\t\t\telse if (tokens[i].substring(0, 6) === 'width=') {\n\t\t\t\tcommand.width = parseInt(tokens[i].substring(6));\n\t\t\t}\n\t\t\telse if (tokens[i].substring(0, 7) === 'height=') {\n\t\t\t\tcommand.height = parseInt(tokens[i].substring(7));\n\t\t\t}\n\t\t\telse if (tokens[i].substring(0, 5) === 'part=') {\n\t\t\t\tcommand.part = parseInt(tokens[i].substring(5));\n\t\t\t}\n\t\t\telse if (tokens[i].substring(0, 6) === 'parts=') {\n\t\t\t\tcommand.parts = parseInt(tokens[i].substring(6));\n\t\t\t}\n\t\t\telse if (tokens[i].substring(0, 5) === 'mode=') {\n\t\t\t\tcommand.mode = parseInt(tokens[i].substring(5));\n\t\t\t}\n\t\t\telse if (tokens[i].substring(0, 8) === 'current=') {\n\t\t\t\tcommand.selectedPart = parseInt(tokens[i].substring(8));\n\t\t\t}\n\t\t\telse if (tokens[i].substring(0, 3) === 'id=') {\n\t\t\t\t// remove newline characters\n\t\t\t\tcommand.id = tokens[i].substring(3).replace(/(\\r\\n|\\n|\\r)/gm, '');\n\t\t\t}\n\t\t\telse if (tokens[i].substring(0, 5) === 'type=') {\n\t\t\t\t// remove newline characters\n\t\t\t\tcommand.type = tokens[i].substring(5).replace(/(\\r\\n|\\n|\\r)/gm, '');\n\t\t\t}\n\t\t\telse if (tokens[i].substring(0, 4) === 'cmd=') {\n\t\t\t\tcommand.errorCmd = tokens[i].substring(4);\n\t\t\t}\n\t\t\telse if (tokens[i].substring(0, 5) === 'code=') {\n\t\t\t\tcommand.errorCode = tokens[i].substring(5);\n\t\t\t}\n\t\t\telse if (tokens[i].substring(0, 5) === 'kind=') {\n\t\t\t\tcommand.errorKind = tokens[i].substring(5);\n\t\t\t}\n\t\t\telse if (tokens[i].substring(0, 5) === 'jail=') {\n\t\t\t\tcommand.jail = tokens[i].substring(5);\n\t\t\t}\n\t\t\telse if (tokens[i].substring(0, 4) === 'dir=') {\n\t\t\t\tcommand.dir = tokens[i].substring(4);\n\t\t\t}\n\t\t\telse if (tokens[i].substring(0, 11) === 'downloadid=') {\n\t\t\t\tcommand.downloadid = tokens[i].substring(11);\n\t\t\t}\n\t\t\telse if (tokens[i].substring(0, 5) === 'name=') {\n\t\t\t\tcommand.name = tokens[i].substring(5);\n\t\t\t}\n\t\t\telse if (tokens[i].substring(0, 9) === 'filename=') {\n\t\t\t\tcommand.filename = tokens[i].substring(9);\n\t\t\t}\n\t\t\telse if (tokens[i].substring(0, 5) === 'port=') {\n\t\t\t\tcommand.port = tokens[i].substring(5);\n\t\t\t}\n\t\t\telse if (tokens[i].substring(0, 5) === 'font=') {\n\t\t\t\tcommand.font = tokens[i].substring(5);\n\t\t\t}\n\t\t\telse if (tokens[i].substring(0, 5) === 'char=') {\n\t\t\t\tcommand.char = tokens[i].substring(5);\n\t\t\t}\n\t\t\telse if (tokens[i].substring(0, 4) === 'url=') {\n\t\t\t\tcommand.url = tokens[i].substring(4);\n\t\t\t}\n\t\t\telse if (tokens[i].substring(0, 7) === 'viewid=') {\n\t\t\t\tcommand.viewid = tokens[i].substring(7);\n\t\t\t}\n\t\t\telse if (tokens[i].substring(0, 8) === 'nviewid=') {\n\t\t\t\tcommand.nviewid = tokens[i].substring(8);\n\t\t\t}\n\t\t\telse if (tokens[i].substring(0, 7) === 'params=') {\n\t\t\t\tcommand.params = tokens[i].substring(7).split(',');\n\t\t\t}\n\t\t\telse if (tokens[i].substring(0, 12) === 'rendercount=') {\n\t\t\t\tcommand.rendercount = parseInt(tokens[i].substring(12));\n\t\t\t}\n\t\t\telse if (tokens[i].startsWith('wid=')) {\n\t\t\t\tcommand.wireId = this.getParameterValue(tokens[i]);\n\t\t\t}\n\t\t\telse if (tokens[i].substring(0, 6) === 'title=') {\n\t\t\t\tcommand.title = tokens[i].substring(6);\n\t\t\t}\n\t\t\telse if (tokens[i].substring(0, 12) === 'dialogwidth=') {\n\t\t\t\tcommand.dialogwidth = tokens[i].substring(12);\n\t\t\t}\n\t\t\telse if (tokens[i].substring(0, 13) === 'dialogheight=') {\n\t\t\t\tcommand.dialogheight = tokens[i].substring(13);\n\t\t\t}\n\t\t\telse if (tokens[i].substring(0, 10) === 'rectangle=') {\n\t\t\t\tcommand.rectangle = tokens[i].substring(10);\n\t\t\t}\n\t\t\telse if (tokens[i].substring(0, 12) === 'hiddenparts=') {\n\t\t\t\tvar hiddenparts = tokens[i].substring(12).split(',');\n\t\t\t\tcommand.hiddenparts = [];\n\t\t\t\thiddenparts.forEach(function (item) {\n\t\t\t\t\tcommand.hiddenparts.push(parseInt(item));\n\t\t\t\t});\n\t\t\t}\n\t\t\telse if (tokens[i].startsWith('rtlparts=')) {\n\t\t\t\tvar rtlParts = tokens[i].substring(9).split(',');\n\t\t\t\tcommand.rtlParts = [];\n\t\t\t\trtlParts.forEach(function (item) {\n\t\t\t\t\tcommand.rtlParts.push(parseInt(item));\n\t\t\t\t});\n\t\t\t}\n\t\t\telse if (tokens[i].startsWith('protectedparts=')) {\n\t\t\t\tvar protectedParts = tokens[i].substring(15).split(',');\n\t\t\t\tcommand.protectedParts = [];\n\t\t\t\tprotectedParts.forEach(function (item) {\n\t\t\t\t\tcommand.protectedParts.push(parseInt(item));\n\t\t\t\t});\n\t\t\t}\n\t\t\telse if (tokens[i].startsWith('hash=')) {\n\t\t\t\tcommand.hash = tokens[i].substring('hash='.length);\n\t\t\t}\n\t\t\telse if (tokens[i] === 'nopng') {\n\t\t\t\tcommand.nopng = true;\n\t\t\t}\n\t\t\telse if (tokens[i].substring(0, 9) === 'username=') {\n\t\t\t\tcommand.username = tokens[i].substring(9);\n\t\t\t}\n\t\t\telse if (tokens[i].startsWith('pagerectangles=')) {\n\t\t\t\tcommand.pageRectangleList = tokens[i].substring(15).split(';');\n\t\t\t\tcommand.pageRectangleList = command.pageRectangleList.map(function(element) {\n\t\t\t\t\telement = element.split(',');\n\t\t\t\t\treturn [parseInt(element[0]), parseInt(element[1]), parseInt(element[2]), parseInt(element[3])];\n\t\t\t\t});\n\t\t\t}\n\t\t\telse if (tokens[i].startsWith('lastcolumn=')) {\n\t\t\t\tcommand.lastcolumn = parseInt(tokens[i].substring(11));\n\t\t\t}\n\t\t\telse if (tokens[i].startsWith('lastrow=')) {\n\t\t\t\tcommand.lastrow = parseInt(tokens[i].substring(8));\n\t\t\t}\n\t\t\telse if (tokens[i].startsWith('readonly=')) {\n\t\t\t\tcommand.readonly = parseInt(tokens[i].substring(9));\n\t\t\t}\n\t\t}\n\t\tif (command.tileWidth && command.tileHeight && this._map._docLayer) {\n\t\t\tvar defaultZoom = this._map.options.zoom;\n\t\t\tvar scale = command.tileWidth / this._map._docLayer.options.tileWidthTwips;\n\t\t\t// scale = 1.2 ^ (defaultZoom - zoom)\n\t\t\t// zoom = defaultZoom -log(scale) / log(1.2)\n\t\t\tcommand.zoom = Math.round(defaultZoom - Math.log(scale) / Math.log(1.2));\n\t\t}\n\t\treturn command;\n\t},\n\n\tsetTraceEventLogging: function (enabled) {\n\t\tthis.traceEventRecordingToggle = enabled;\n\t\tthis.sendMessage('traceeventrecording ' + (this.traceEventRecordingToggle ? 'start' : 'stop'));\n\n\t\t// Just as a test, uncomment this to toggle SAL_WARN and\n\t\t// SAL_INFO selection between two states: 1) the default\n\t\t// as directed by the SAL_LOG environment variable, and\n\t\t// 2) all warnings on plus SAL_INFO for sc.\n\t\t//\n\t\t// (Note that coolwsd sets the SAL_LOG environment variable\n\t\t// to \"-WARN-INFO\", i.e. the default is that nothing is\n\t\t// logged from core.)\n\n\t\t// app.socket.sendMessage('sallogoverride ' + (app.socket.traceEventRecordingToggle ? '+WARN+INFO.sc' : 'default'));\n\t},\n\n\ttraceEventRecordingToggle: false,\n\n\t_stringifyArgs: function (args) {\n\t\treturn (args == null ? '' : (' args=' + JSON.stringify(args)));\n\t},\n\n\tasyncTraceEventCounter: 0,\n\n\t// simulate a threads per live async event to help the chrome renderer\n\tasyncTracePseudoThread: 1,\n\n\tcreateAsyncTraceEvent: function (name, args) {\n\t\tif (!this.traceEventRecordingToggle)\n\t\t\treturn null;\n\n\t\tvar result = {};\n\t\tresult.id = this.asyncTraceEventCounter++;\n\t\tresult.tid = this.asyncTracePseudoThread++;\n\t\tresult.active = true;\n\t\tresult.args = args;\n\n\t\tthis.sendTraceEvent(name, 'S', undefined, args, result.id, result.tid);\n\n\t\tvar that = this;\n\t\tresult.finish = function () {\n\t\t\tthat.asyncTracePseudoThread--;\n\t\t\tif (this.active) {\n\t\t\t\tthat.sendTraceEvent(name, 'F', undefined, this.args, this.id, this.tid);\n\t\t\t\tthis.active = false;\n\t\t\t}\n\t\t};\n\t\tresult.abort = function () {\n\t\t\tthat.asyncTracePseudoThread--;\n\t\t\tthis.active = false;\n\t\t};\n\t\treturn result;\n\t},\n\n\tcreateCompleteTraceEvent: function (name, args) {\n\t\tif (!this.traceEventRecordingToggle)\n\t\t\treturn null;\n\n\t\tvar result = {};\n\t\tresult.active = true;\n\t\tresult.begin = performance.now();\n\t\tresult.args = args;\n\t\tvar that = this;\n\t\tresult.finish = function () {\n\t\t\tif (this.active) {\n\t\t\t\tvar now = performance.now();\n\t\t\t\tthat.sendTraceEvent(name, 'X', 'ts=' + Math.round(this.begin * 1000) +\n\t\t\t\t\t\t    ' dur=' + Math.round((now - this.begin) * 1000),\n\t\t\t\t\t\t    args);\n\t\t\t\tthis.active = false;\n\t\t\t}\n\t\t};\n\t\tresult.abort = function () {\n\t\t\tthis.active = false;\n\t\t};\n\t\treturn result;\n\t},\n\n\t// something we can grok quickly in the trace viewer\n\tcreateCompleteTraceEventFromEvent: function(textMsg) {\n\t\tif (!this.traceEventRecordingToggle)\n\t\t\treturn null;\n\n\t\tvar pretty;\n\t\tif (!textMsg)\n\t\t\tpretty = 'blob';\n\t\telse {\n\t\t\tvar idx = textMsg.indexOf(':');\n\t\t\tif (idx > 0)\n\t\t\t\tpretty = textMsg.substring(0,idx);\n\t\t\telse if (textMsg.length < 25)\n\t\t\t\tpretty = textMsg;\n\t\t\telse\n\t\t\t\tpretty = textMsg.substring(0, 25);\n\t\t}\n\t\treturn this.createCompleteTraceEvent(pretty, { message: textMsg });\n\t},\n\n\tmanualReconnect: function(timeout) {\n\t\tif (this._map._docLayer) {\n\t\t\tthis._map._docLayer.removeAllViews();\n\t\t}\n\t\tapp.idleHandler._active = false;\n\t\tthis.close();\n\t\tclearTimeout(this.timer);\n\t\tsetTimeout(function () {\n\t\t\ttry {\n\t\t\t\tapp.idleHandler._activate();\n\t\t\t} catch (error) {\n\t\t\t\twindow.app.console.warn('Cannot activate map');\n\t\t\t}\n\t\t}, timeout);\n\t},\n\n\tthreadLocalLoggingLevelToggle: false\n});\n"]}