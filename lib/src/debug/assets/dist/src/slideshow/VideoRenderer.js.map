{"version":3,"file":"VideoRenderer.js","sourceRoot":"","sources":["../../../../../../../../../../TanhX/online/browser/src/slideshow/VideoRenderer.ts"],"names":[],"mappings":"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","sourcesContent":["// @ts-strict-ignore\n/* -*- js-indent-level: 8 -*- */\n\n/*\n * Copyright the Collabora Online contributors.\n *\n * SPDX-License-Identifier: MPL-2.0\n *\n * This Source Code Form is subject to the terms of the Mozilla Public\n * License, v. 2.0. If a copy of the MPL was not distributed with this\n * file, You can obtain one at http://mozilla.org/MPL/2.0/.\n */\n\ndeclare var SlideShow: any;\n\nclass VideoRenderInfo {\n\tprivate texture: WebGLTexture | ImageBitmap = null;\n\tpublic videoElement: HTMLVideoElement;\n\tprivate vao: WebGLVertexArrayObject = null;\n\tpublic pos2d: number[];\n\tpublic playing: boolean;\n\tpublic ended: boolean;\n\n\tpublic getTexture(): WebGLTexture {\n\t\treturn this.texture;\n\t}\n\n\tpublic replaceTexture(context: RenderContext, newtexture: WebGLTexture) {\n\t\tcontext.deleteTexture(this.texture);\n\t\tthis.texture = newtexture;\n\t}\n\n\tpublic getVao(): WebGLVertexArrayObject {\n\t\treturn this.vao;\n\t}\n\n\tpublic replaceVao(context: RenderContext, newVao: WebGLVertexArrayObject) {\n\t\tcontext.deleteVertexArray(this.vao);\n\t\tthis.vao = newVao;\n\t}\n\n\tpublic deleteResources(context: RenderContext) {\n\t\tthis.replaceTexture(context, null);\n\t\tthis.replaceVao(context, null);\n\t}\n}\n\nabstract class VideoRenderer {\n\tprotected sId: string;\n\tprotected _context: RenderContext;\n\tprotected _slideRenderer: SlideRenderer;\n\tprotected videoRenderInfo: VideoRenderInfo;\n\tpublic videoInfoId: number;\n\n\tconstructor(\n\t\tsId: string,\n\t\tcontext: RenderContext,\n\t\tslideRenderer: SlideRenderer,\n\t) {\n\t\tthis.sId = sId;\n\t\tthis._context = context;\n\t\tthis._slideRenderer = slideRenderer;\n\t}\n\n\tpublic isDisposed() {\n\t\treturn this._context && this._context.isDisposed();\n\t}\n\n\tpublic abstract prepareVideo(\n\t\tvideoInfo: VideoInfo,\n\t\tdocWidth: number,\n\t\tdocHeight: number,\n\t): void;\n\n\tpublic loadVideo() {\n\t\tif (!this.videoRenderInfo) return;\n\t\tthis.videoRenderInfo.videoElement.load();\n\t}\n\n\tpublic playVideo(reset: boolean = true) {\n\t\tif (!this.videoRenderInfo) return;\n\t\tif (reset) this.videoRenderInfo.videoElement.currentTime = 0;\n\t\tthis.videoRenderInfo.videoElement.play();\n\t}\n\n\tpublic pauseVideo() {\n\t\tif (!this.videoRenderInfo) return;\n\t\tconsole.debug('VideoRenderer.pauseVideo');\n\t\tthis.videoRenderInfo.videoElement.pause();\n\t}\n\n\tpublic deleteResources(): void {\n\t\tif (this.isDisposed()) return;\n\t\tthis.pauseVideo();\n\t\tthis.videoRenderInfo.deleteResources(this._context);\n\t}\n\n\tpublic handleClick(): void {\n\t\tif (this.videoRenderInfo.playing) {\n\t\t\tthis.pauseVideo();\n\t\t} else if (this.videoRenderInfo.ended) {\n\t\t\tthis.playVideo(true);\n\t\t} else {\n\t\t\tthis.playVideo(false);\n\t\t}\n\t}\n\n\tprotected setupVideo(\n\t\tvideoRenderInfo: VideoRenderInfo,\n\t\turl: string,\n\t): HTMLVideoElement {\n\t\tconst video = document.createElement('video');\n\n\t\tvideo.playsInline = true;\n\t\tvideo.crossOrigin = 'anonymous';\n\n\t\tvideo.addEventListener(\n\t\t\t'playing',\n\t\t\t() => {\n\t\t\t\tvideoRenderInfo.playing = true;\n\t\t\t\tvideoRenderInfo.ended = false;\n\t\t\t\tthis._slideRenderer.notifyVideoStarted(this.sId);\n\t\t\t},\n\t\t\ttrue,\n\t\t);\n\n\t\tvideo.addEventListener(\n\t\t\t'pause',\n\t\t\t() => {\n\t\t\t\tvideoRenderInfo.playing = false;\n\t\t\t\tthis._slideRenderer.notifyVideoEnded(this.sId);\n\t\t\t},\n\t\t\ttrue,\n\t\t);\n\n\t\tvideo.addEventListener(\n\t\t\t'ended',\n\t\t\t() => {\n\t\t\t\tvideoRenderInfo.playing = false;\n\t\t\t\tvideoRenderInfo.ended = true;\n\t\t\t\tthis._slideRenderer.notifyVideoEnded(this.sId);\n\t\t\t},\n\t\t\ttrue,\n\t\t);\n\n\t\tvideo.src = url;\n\t\treturn video;\n\t}\n\n\tprotected getDocumentPositions(\n\t\tx: number,\n\t\ty: number,\n\t\twidth: number,\n\t\theight: number,\n\t\tdocWidth: number,\n\t\tdocHeight: number,\n\t): number[] {\n\t\tconst xMin = x / docWidth;\n\t\tconst xMax = (x + width) / docWidth;\n\n\t\tconst yMin = y / docHeight;\n\t\tconst yMax = (y + height) / docHeight;\n\n\t\treturn [xMin, xMax, yMin, yMax];\n\t}\n\n\tpublic abstract render(): void;\n}\n\nclass VideoRenderer2d extends VideoRenderer {\n\tpublic prepareVideo(\n\t\tvideoInfo: VideoInfo,\n\t\tdocWidth: number,\n\t\tdocHeight: number,\n\t): void {\n\t\tthis.pauseVideo();\n\n\t\tconst video = new VideoRenderInfo();\n\t\tvideo.videoElement = this.setupVideo(video, videoInfo.url);\n\t\tvideo.pos2d = this.getDocumentPositions(\n\t\t\tvideoInfo.x,\n\t\t\tvideoInfo.y,\n\t\t\tvideoInfo.width,\n\t\t\tvideoInfo.height,\n\t\t\tdocWidth,\n\t\t\tdocHeight,\n\t\t);\n\t\tthis.videoRenderInfo = video;\n\t\tthis.videoInfoId = videoInfo.id;\n\t}\n\n\tpublic render(): void {\n\t\tif (this.isDisposed()) return;\n\t\tconst ctx = this._context.get2dGl();\n\t\tconst video = this.videoRenderInfo;\n\n\t\tconst width = ctx.canvas.width;\n\t\tconst height = ctx.canvas.height;\n\n\t\tctx.drawImage(\n\t\t\tvideo.videoElement,\n\t\t\tvideo.pos2d[0] * width,\n\t\t\tvideo.pos2d[2] * height,\n\t\t\tvideo.pos2d[1] * width - video.pos2d[0] * width,\n\t\t\tvideo.pos2d[3] * height - video.pos2d[2] * height,\n\t\t);\n\t}\n}\n\nclass VideoRendererGl extends VideoRenderer {\n\tprivate static _program: WebGLProgram;\n\tpublic static videoProgramInitialized: boolean = false;\n\n\tprivate static getVertexShader(): string {\n\t\treturn `#version 300 es\n\t\t\t\tin vec4 a_position;\n\t\t\t\tin vec2 a_texCoord;\n\t\t\t\tout vec2 v_texCoord;\n\n\t\t\t\tvoid main() {\n\t\t\t\t\tgl_Position = a_position;\n\t\t\t\t\tv_texCoord = a_texCoord;\n\t\t\t\t}\n\t\t\t\t`;\n\t}\n\n\tprivate static getFragmentShader(): string {\n\t\treturn `#version 300 es\n\t\t\t\tprecision mediump float;\n\n\t\t\t\tuniform sampler2D slideTexture;\n\n\t\t\t\tin vec2 v_texCoord;\n\t\t\t\tout vec4 outColor;\n\n\t\t\t\tvoid main() {\n\t\t\t\t\toutColor = texture(slideTexture, v_texCoord);\n\t\t\t\t}\n\t\t\t\t`;\n\t}\n\n\tpublic static createProgram(context: RenderContextGl) {\n\t\tif (context.is2dGl() || context.isDisposed()) return;\n\n\t\tconst vertexShader = context.createVertexShader(\n\t\t\tVideoRendererGl.getVertexShader(),\n\t\t);\n\t\tconst fragmentShader = context.createFragmentShader(\n\t\t\tVideoRendererGl.getFragmentShader(),\n\t\t);\n\n\t\tVideoRendererGl._program = context.createProgram(\n\t\t\tvertexShader,\n\t\t\tfragmentShader,\n\t\t);\n\n\t\tVideoRendererGl.videoProgramInitialized = true;\n\t}\n\n\tpublic static deleteProgram(context: RenderContextGl) {\n\t\tif (context.is2dGl() || context.isDisposed()) return;\n\t\tconst gl = context.getGl();\n\t\tgl.deleteProgram(VideoRendererGl._program);\n\t\tVideoRendererGl._program = null;\n\t\tVideoRendererGl.videoProgramInitialized = false;\n\t}\n\n\tpublic prepareVideo(\n\t\tvideoInfo: VideoInfo,\n\t\tdocWidth: number,\n\t\tdocHeight: number,\n\t) {\n\t\tthis.pauseVideo();\n\n\t\tconst video = new VideoRenderInfo();\n\t\tvideo.videoElement = this.setupVideo(video, videoInfo.url);\n\t\tvideo.replaceTexture(this._context, this.initTexture());\n\t\tvideo.replaceVao(\n\t\t\tthis._context,\n\t\t\tthis.setupRectangleInDocumentPositions(\n\t\t\t\tvideoInfo.x,\n\t\t\t\tvideoInfo.y,\n\t\t\t\tvideoInfo.width,\n\t\t\t\tvideoInfo.height,\n\t\t\t\tdocWidth,\n\t\t\t\tdocHeight,\n\t\t\t),\n\t\t);\n\t\tthis.videoRenderInfo = video;\n\t\tthis.videoInfoId = videoInfo.id;\n\t}\n\n\tprivate initTexture() {\n\t\tconst gl = this._context.getGl();\n\t\tconst texture = gl.createTexture();\n\t\tgl.bindTexture(gl.TEXTURE_2D, texture);\n\n\t\tconst pixel = new Uint8Array([0, 0, 255, 255]); // opaque blue\n\t\tgl.texImage2D(\n\t\t\tgl.TEXTURE_2D,\n\t\t\t0,\n\t\t\tgl.RGBA,\n\t\t\t1,\n\t\t\t1,\n\t\t\t0,\n\t\t\tgl.RGBA,\n\t\t\tgl.UNSIGNED_BYTE,\n\t\t\tpixel,\n\t\t);\n\n\t\tgl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\n\t\tgl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\n\t\tgl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR);\n\n\t\treturn texture;\n\t}\n\n\t// jscpd:ignore-start\n\tpublic setupPositions(\n\t\txMin: number,\n\t\txMax: number,\n\t\tyMin: number,\n\t\tyMax: number,\n\t): WebGLVertexArrayObject {\n\t\tif (this.isDisposed()) return null;\n\n\t\tif (this._context.is2dGl()) return;\n\n\t\tconst gl = this._context.getGl();\n\n\t\t// 5 numbers -> 3 x vertex X,Y,Z and 2x texture X,Y\n\t\tconst positions = new Float32Array([\n\t\t\t//    vX    vY   vZ   tX   tY\n\t\t\t...[xMin, -yMin, 0.0, 0.0, 1.0],\n\t\t\t...[xMax, -yMin, 0.0, 1.0, 1.0],\n\t\t\t...[xMin, -yMax, 0.0, 0.0, 0.0],\n\t\t\t...[xMax, -yMax, 0.0, 1.0, 0.0],\n\t\t]);\n\n\t\tconst buffer = gl.createBuffer();\n\t\tgl.bindBuffer(gl.ARRAY_BUFFER, buffer);\n\t\tgl.bufferData(gl.ARRAY_BUFFER, positions, gl.STATIC_DRAW);\n\n\t\tconst vao = gl.createVertexArray();\n\t\tgl.bindVertexArray(vao);\n\n\t\tconst program = VideoRendererGl._program;\n\t\tif (!program) {\n\t\t\tconsole.log('VideoRenderer: program is not valid');\n\t\t\treturn;\n\t\t}\n\n\t\tconst positionLocation = gl.getAttribLocation(program, 'a_position');\n\n\t\tgl.enableVertexAttribArray(positionLocation);\n\t\tgl.vertexAttribPointer(positionLocation, 3, gl.FLOAT, false, 5 * 4, 0);\n\n\t\tconst texCoordLocation = gl.getAttribLocation(program, 'a_texCoord');\n\n\t\tgl.enableVertexAttribArray(texCoordLocation);\n\t\tgl.vertexAttribPointer(texCoordLocation, 2, gl.FLOAT, false, 5 * 4, 3 * 4);\n\n\t\treturn vao;\n\t}\n\t// jscpd:ignore-end\n\n\tprivate setupRectangleInDocumentPositions(\n\t\tx: number,\n\t\ty: number,\n\t\twidth: number,\n\t\theight: number,\n\t\tdocWidth: number,\n\t\tdocHeight: number,\n\t): WebGLVertexArrayObject {\n\t\tconst positions = this.getDocumentPositions(\n\t\t\tx,\n\t\t\ty,\n\t\t\twidth,\n\t\t\theight,\n\t\t\tdocWidth,\n\t\t\tdocHeight,\n\t\t);\n\t\treturn this.setupPositions(\n\t\t\tpositions[0] * 2.0 - 1.0,\n\t\t\tpositions[1] * 2.0 - 1.0,\n\t\t\tpositions[2] * 2.0 - 1.0,\n\t\t\tpositions[3] * 2.0 - 1.0,\n\t\t);\n\t}\n\n\tprivate updateTexture(texture: WebGLTexture, video: HTMLVideoElement) {\n\t\tconst gl = this._context.getGl();\n\t\tgl.bindTexture(gl.TEXTURE_2D, texture);\n\t\tgl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, gl.RGBA, gl.UNSIGNED_BYTE, video);\n\t}\n\n\tpublic render() {\n\t\tif (this.isDisposed()) return;\n\n\t\tconsole.debug('SlideRendererGl.render');\n\t\tconst gl = this._context.getGl();\n\n\t\tif (!VideoRendererGl._program) {\n\t\t\tconsole.log('VideoRendererGl: program is not valid');\n\t\t\treturn;\n\t\t}\n\n\t\tgl.useProgram(VideoRendererGl._program);\n\t\tgl.activeTexture(gl.TEXTURE0);\n\n\t\tconst video = this.videoRenderInfo;\n\t\tif (!video.ended && video.videoElement.currentTime > 0) {\n\t\t\tgl.bindVertexArray(video.getVao());\n\t\t\tgl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL, true);\n\t\t\tthis.updateTexture(video.getTexture(), video.videoElement);\n\t\t\tgl.drawArrays(gl.TRIANGLE_STRIP, 0, 4);\n\t\t\tgl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL, false);\n\t\t}\n\t}\n}\n\nfunction makeVideoRenderer(\n\tsId: string,\n\tcontext: RenderContext,\n\tslideRenderer: SlideRenderer,\n): VideoRenderer {\n\treturn context.is2dGl()\n\t\t? new VideoRenderer2d(sId, context, slideRenderer)\n\t\t: new VideoRendererGl(sId, context, slideRenderer);\n}\n"]}