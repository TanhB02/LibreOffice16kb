{"version":3,"file":"FlipTilesTransition.js","sourceRoot":"","sources":["../../../../../../../../../../../TanhX/online/browser/src/slideshow/transition3d/FlipTilesTransition.ts"],"names":[],"mappings":"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","sourcesContent":["/* -*- js-indent-level: 8 -*- */\n\n/*\n * Copyright the Collabora Online contributors.\n *\n * SPDX-License-Identifier: MPL-2.0\n *\n * This Source Code Form is subject to the terms of the Mozilla Public\n * License, v. 2.0. If a copy of the MPL was not distributed with this\n * file, You can obtain one at http://mozilla.org/MPL/2.0/.\n */\n\ndeclare var SlideShow: any;\n\nclass FlipTilesTransition extends SimpleTransition {\n\tconstructor(transitionParameters: TransitionParameters3D) {\n\t\tsuper(transitionParameters);\n\t}\n\n\tpublic initWebglFlags(): void {\n\t\tthis.gl.enable(this.gl.DEPTH_TEST);\n\t\tthis.gl.depthFunc(this.gl.LEQUAL);\n\n\t\t// Enable face culling\n\t\tthis.gl.enable(this.gl.CULL_FACE);\n\t\tthis.gl.cullFace(this.gl.BACK);\n\n\t\t// Disable blending\n\t\tthis.gl.disable(this.gl.BLEND);\n\t}\n\n\tpublic processPrimitives(\n\t\tt: number,\n\t\ttexturePrimitive: Primitive[],\n\t\tapplyOperations: (t: number, operations: Operation[]) => void,\n\t): void {\n\t\tfor (const primitive of texturePrimitive) {\n\t\t\tthis.setBufferData(primitive.vertices);\n\t\t\tapplyOperations.call(this, t, primitive.operations);\n\t\t\tthis.gl.drawArrays(this.gl.TRIANGLES, 0, primitive.vertices.length);\n\t\t}\n\t}\n\n\tpublic displaySlides_(t: number): void {\n\t\tthis.applyAllOperation(t);\n\n\t\t// Render the entering slide primitives\n\t\tthis.gl.activeTexture(this.gl.TEXTURE0);\n\t\tthis.gl.bindTexture(this.gl.TEXTURE_2D, this.textures[1]);\n\t\tthis.gl.uniform1i(\n\t\t\tthis.gl.getUniformLocation(this.program, 'slideTexture'),\n\t\t\t0,\n\t\t);\n\t\tthis.processPrimitives(\n\t\t\tt,\n\t\t\tthis.enteringPrimitives,\n\t\t\tthis.applyEnteringOperations,\n\t\t);\n\n\t\t// Render the leaving slide primitives\n\t\tthis.gl.activeTexture(this.gl.TEXTURE0);\n\t\tthis.gl.bindTexture(this.gl.TEXTURE_2D, this.textures[0]);\n\t\tthis.gl.uniform1i(\n\t\t\tthis.gl.getUniformLocation(this.program, 'slideTexture'),\n\t\t\t0,\n\t\t);\n\t\tthis.processPrimitives(\n\t\t\tt,\n\t\t\tthis.leavingPrimitives,\n\t\t\tthis.applyLeavingOperations,\n\t\t);\n\t}\n}\n\nfunction vec(x: number, y: number, nx: number, ny: number): vec2 {\n\tx = x < 0.0 ? 0.0 : x;\n\tx = Math.min(x, nx);\n\ty = y < 0.0 ? 0.0 : y;\n\ty = Math.min(y, ny);\n\treturn [x / nx, y / ny];\n}\n\nfunction calculateMidpoint(vec1: vec3, vec2: vec3): vec3 {\n\treturn [\n\t\t(vec1[0] + vec2[0]) / 2.0, // X coordinate\n\t\t(vec1[1] + vec2[1]) / 2.0, // Y coordinate\n\t\t(vec1[2] + vec2[2]) / 2.0, // Z coordinate\n\t];\n}\n\nfunction makeFlipTilesTransition(\n\ttransitionParameters: TransitionParameters,\n\tn: number = 8,\n\tm: number = 6,\n) {\n\tconst aLeavingPrimitives: Primitive[] = [];\n\tconst aEnteringPrimitives: Primitive[] = [];\n\n\tfor (let x = 0; x < n; x++) {\n\t\tfor (let y = 0; y < n; y++) {\n\t\t\tconst aTile = new Primitive();\n\t\t\tconst x11 = vec(x, y, n, m);\n\t\t\tconst x12 = vec(x, y + 1, n, m);\n\t\t\tconst x21 = vec(x + 1, y, n, m);\n\t\t\tconst x22 = vec(x + 1, y + 1, n, m);\n\n\t\t\taTile.pushTriangle(x21, x11, x12);\n\t\t\taTile.pushTriangle(x22, x21, x12);\n\n\t\t\taTile.operations.push(\n\t\t\t\tmakeSRotate(\n\t\t\t\t\tvec3.fromValues(0, 1, 0),\n\t\t\t\t\tcalculateMidpoint(aTile.getVertex(1), aTile.getVertex(3)),\n\t\t\t\t\t180,\n\t\t\t\t\ttrue,\n\t\t\t\t\t(x11[0] * x11[1]) / 2.0,\n\t\t\t\t\t(x22[0] * x22[1] + 1.0) / 2.0,\n\t\t\t\t),\n\t\t\t);\n\t\t\taLeavingPrimitives.push(Primitive.cloneDeep(aTile));\n\n\t\t\taTile.operations.push(\n\t\t\t\tmakeSRotate(\n\t\t\t\t\tvec3.fromValues(0, 1, 0),\n\t\t\t\t\tcalculateMidpoint(aTile.getVertex(1), aTile.getVertex(3)),\n\t\t\t\t\t-180,\n\t\t\t\t\tfalse,\n\t\t\t\t\t(x11[0] * x11[1]) / 2.0,\n\t\t\t\t\t(x22[0] * x22[1] + 1.0) / 2.0,\n\t\t\t\t),\n\t\t\t);\n\t\t\taEnteringPrimitives.push(aTile);\n\t\t}\n\t}\n\n\tconst newTransitionParameters: TransitionParameters3D = {\n\t\t...transitionParameters,\n\t\tleavingPrimitives: aLeavingPrimitives,\n\t\tenteringPrimitives: aEnteringPrimitives,\n\t\tallOperations: [],\n\t};\n\n\treturn new FlipTilesTransition(newTransitionParameters);\n}\n\nSlideShow.makeFlipTilesTransition = makeFlipTilesTransition;\n"]}