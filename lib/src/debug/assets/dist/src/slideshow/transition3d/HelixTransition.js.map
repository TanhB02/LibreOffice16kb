{"version":3,"file":"HelixTransition.js","sourceRoot":"","sources":["../../../../../../../../../../../TanhX/online/browser/src/slideshow/transition3d/HelixTransition.ts"],"names":[],"mappings":"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","sourcesContent":["/* -*- js-indent-level: 8 -*- */\n\n/*\n * Copyright the Collabora Online contributors.\n *\n * SPDX-License-Identifier: MPL-2.0\n *\n * This Source Code Form is subject to the terms of the Mozilla Public\n * License, v. 2.0. If a copy of the MPL was not distributed with this\n * file, You can obtain one at http://mozilla.org/MPL/2.0/.\n */\n\ndeclare var SlideShow: any;\n\nclass HelixTransition extends SimpleTransition {\n\tconstructor(transitionParameters: TransitionParameters3D) {\n\t\tsuper(transitionParameters);\n\t}\n\n\tpublic displaySlides_(t: number): void {\n\t\tthis.applyAllOperation(t);\n\t\tif (t < 0.5)\n\t\t\tthis.displayPrimitive(\n\t\t\t\tt,\n\t\t\t\tthis.gl.TEXTURE0,\n\t\t\t\t0,\n\t\t\t\tthis.leavingPrimitives,\n\t\t\t\t'slideTexture',\n\t\t\t);\n\t\telse\n\t\t\tthis.displayPrimitive(\n\t\t\t\tt,\n\t\t\t\tthis.gl.TEXTURE0,\n\t\t\t\t1,\n\t\t\t\tthis.enteringPrimitives,\n\t\t\t\t'slideTexture',\n\t\t\t);\n\t}\n}\n\nfunction makeHelixTransition(\n\ttransitionParameters: TransitionParameters,\n\tnRows: number = 20,\n) {\n\tconst invN = 1.0 / nRows;\n\tconst delayFactor = 0.2; // Adjust this to control the delay between the leaving and entering operations\n\tlet iDn = 0.0;\n\tlet iPDn = invN;\n\tconst aLeavingPrimitives: Primitive[] = [];\n\tconst aEnteringPrimitives: Primitive[] = [];\n\tconst aOperations: Operation[] = [];\n\tfor (let i = 0; i < nRows; i++) {\n\t\tconst Tile = new Primitive();\n\n\t\tTile.pushTriangle([1.0, iDn], [0.0, iDn], [0.0, iPDn]);\n\t\tTile.pushTriangle([1.0, iPDn], [1.0, iDn], [0.0, iPDn]);\n\n\t\tconst leaveStartTime = Math.min(\n\t\t\tMath.max(((i - nRows / 2.0) * invN) / 2.0, 0.0),\n\t\t\t1.0,\n\t\t);\n\t\tconst leaveEndTime = Math.min(\n\t\t\tMath.max(((i + nRows / 2.0) * invN) / 2.0, 0.0),\n\t\t\t1.0,\n\t\t);\n\n\t\tTile.operations.push(\n\t\t\tmakeSRotate(\n\t\t\t\tvec3.fromValues(0, 1, 0),\n\t\t\t\tvec3.fromValues(0, 1, 0),\n\t\t\t\t180,\n\t\t\t\ttrue,\n\t\t\t\tleaveStartTime,\n\t\t\t\tleaveEndTime,\n\t\t\t),\n\t\t);\n\t\taLeavingPrimitives.push(Primitive.cloneDeep(Tile));\n\n\t\tconst enterStartTime = leaveEndTime + delayFactor * invN;\n\t\tconst enterEndTime = enterStartTime + (1.0 - leaveEndTime);\n\n\t\tTile.operations.push(\n\t\t\tmakeSRotate(\n\t\t\t\tvec3.fromValues(0, 1, 0),\n\t\t\t\tvec3.fromValues(0, 1, 0),\n\t\t\t\t-180,\n\t\t\t\ttrue,\n\t\t\t\tenterStartTime,\n\t\t\t\tenterEndTime,\n\t\t\t),\n\t\t);\n\t\taEnteringPrimitives.push(Tile);\n\t\tiDn += invN;\n\t\tiPDn += invN;\n\t}\n\n\tconst newTransitionParameters: TransitionParameters3D = {\n\t\t...transitionParameters,\n\t\tleavingPrimitives: aLeavingPrimitives,\n\t\tenteringPrimitives: aEnteringPrimitives,\n\t\tallOperations: aOperations,\n\t};\n\n\treturn new HelixTransition(newTransitionParameters);\n}\n\nSlideShow.makeHelixTransition = makeHelixTransition;\n"]}