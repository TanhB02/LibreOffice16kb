{"version":3,"file":"PermTextureTransition.js","sourceRoot":"","sources":["../../../../../../../../../../../TanhX/online/browser/src/slideshow/transition3d/PermTextureTransition.ts"],"names":[],"mappings":"AAAA,gCAAgC;;;;;;;;;;;;;;;;AAchC;IAAoC,yCAAgB;IAInD,+BAAY,oBAA4C;QAAxD,YACC,kBAAM,oBAAoB,CAAC,SAE3B;QA+BD,kBAAkB;QACV,oBAAc,GAAa;YAC5B,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,EAAG,EAAE,EAAG,EAAE,EAAE,GAAG;YACrC,EAAE,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,EAAG,EAAE,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG;YACtC,GAAG,EAAE,GAAG,EAAG,EAAE,EAAE,GAAG,EAAI,CAAC,EAAG,EAAE,EAAG,EAAE,EAAE,GAAG;YACrC,EAAE,EAAE,GAAG,EAAG,EAAE,EAAG,EAAE,EAAE,GAAG,EAAG,EAAE,EAAE,GAAG,EAAE,GAAG;YACrC,EAAE,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,EAAG,EAAE,EAAE,GAAG,EAAE,GAAG;YACrC,EAAE,EAAG,EAAE,EAAE,GAAG,EAAE,GAAG,EAAG,EAAE,EAAG,EAAE,EAAG,EAAE,EAAE,GAAG;YACtC,GAAG,EAAG,EAAE,EAAG,EAAE,EAAI,CAAC,EAAE,GAAG,EAAG,EAAE,EAAE,GAAG,EAAE,GAAG;YACtC,GAAG,EAAG,EAAE,EAAE,GAAG,EAAG,EAAE,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,EAAG,EAAE;YACtC,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,EAAG,EAAE,EAAE,GAAG,EAAE,GAAG;YACrC,EAAE,EAAG,EAAE,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG;YACtC,GAAG,EAAE,GAAG,EAAE,GAAG,EAAG,EAAE,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG;YACrC,EAAE,EAAE,GAAG,EAAG,EAAE,EAAG,EAAE,EAAG,EAAE,EAAE,GAAG,EAAE,GAAG,EAAG,EAAE;YACtC,GAAG,EAAG,EAAE,EAAG,EAAE,EAAE,GAAG,EAAE,GAAG,EAAG,EAAE,EAAE,GAAG,EAAG,EAAE;YACrC,EAAE,EAAE,GAAG,EAAG,EAAE,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,EAAG,EAAE,EAAG,EAAE;YACtC,GAAG,EAAG,EAAE,EAAG,EAAE,EAAE,GAAG,EAAG,EAAE,EAAG,EAAE,EAAG,EAAE,EAAG,EAAE;YACtC,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,EAAG,EAAE,EAAI,CAAC,EAAE,GAAG;YACrC,EAAE,EAAG,EAAE,EAAG,EAAE,EAAE,GAAG,EAAE,GAAG,EAAG,EAAE,EAAE,GAAG,EAAG,EAAE;YACtC,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,EAAI,CAAC,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG;YACtC,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,EAAG,EAAE,EAAE,GAAG,EAAG,EAAE,EAAE,GAAG;YACtC,GAAG,EAAG,EAAE,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,EAAG,EAAE,EAAE,GAAG,EAAI,CAAC;YACrC,EAAE,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,EAAG,EAAE;YACrC,EAAE,EAAE,GAAG,EAAG,EAAE,EAAG,EAAE,EAAG,EAAE,EAAG,EAAE,EAAE,GAAG,EAAE,GAAG;YACtC,GAAG,EAAE,GAAG,EAAG,EAAE,EAAE,GAAG,EAAE,GAAG,EAAG,EAAE,EAAE,GAAG,EAAE,GAAG;YACtC,GAAG,EAAE,GAAG,EAAG,EAAE,EAAG,EAAE,EAAG,EAAE,EAAE,GAAG,EAAE,GAAG,EAAG,EAAE;YACtC,GAAG,EAAE,GAAG,EAAE,GAAG,EAAG,EAAE,EAAE,GAAG,EAAG,EAAE,EAAG,EAAE,EAAE,GAAG;YACtC,GAAG,EAAG,EAAE,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,EAAG,EAAE,EAAG,EAAE;YACpC,CAAC,EAAG,EAAE,EAAE,GAAG,EAAG,EAAE,EAAE,GAAG,EAAE,GAAG,EAAI,CAAC,EAAE,GAAG;YACrC,EAAE,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG;YAC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","sourcesContent":["/* -*- js-indent-level: 8 -*- */\n\n/*\n * Copyright the Collabora Online contributors.\n *\n * SPDX-License-Identifier: MPL-2.0\n *\n * This Source Code Form is subject to the terms of the Mozilla Public\n * License, v. 2.0. If a copy of the MPL was not distributed with this\n * file, You can obtain one at http://mozilla.org/MPL/2.0/.\n */\n\ndeclare var SlideShow: any;\n\nclass PermTextureTransition extends SimpleTransition {\n\tpublic permTexture: any;\n\tpublic m_nHelperTexture: WebGLTexture | undefined;\n\n\tconstructor(transitionParameters: TransitionParameters3D) {\n\t\tsuper(transitionParameters);\n\t\tthis.permTexture = this.createPermTexture();\n\t}\n\n\tpublic createPermTexture(): WebGLTexture {\n\t\tconst gl = this.gl;\n\t\tconst permTex = gl.createTexture();\n\t\tgl.bindTexture(gl.TEXTURE_2D, permTex);\n\n\t\tgl.texStorage2D(gl.TEXTURE_2D, 1, gl.RGBA8, 256, 256);\n\n\t\tconst data = this.generatePermutationData();\n\t\tgl.texSubImage2D(\n\t\t\tgl.TEXTURE_2D,\n\t\t\t0,\n\t\t\t0,\n\t\t\t0,\n\t\t\t256,\n\t\t\t256,\n\t\t\tgl.RGBA,\n\t\t\tgl.UNSIGNED_BYTE,\n\t\t\tdata,\n\t\t);\n\n\t\tgl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST);\n\t\tgl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST);\n\n\t\tif (!permTex) {\n\t\t\tthrow new Error('Invalid extra texture object');\n\t\t}\n\t\treturn permTex;\n\t}\n\n\t// prettier-ignore\n\tprivate permutation256: number[] = [\n        215, 100, 200, 204, 233,  50,  85, 196,\n         71, 141, 122, 160,  93, 131, 243, 234,\n        162, 183,  36, 155,   4,  62,  35, 205,\n         40, 102,  33,  27, 255,  55, 214, 156,\n         75, 163, 134, 126, 249,  74, 197, 228,\n         72,  90, 206, 235,  17,  22,  49, 169,\n        227,  89,  16,   5, 117,  60, 248, 230,\n        217,  68, 138,  96, 194, 170, 136,  10,\n        112, 238, 184, 189, 176,  42, 225, 212,\n         84,  58, 175, 244, 150, 168, 219, 236,\n        101, 208, 123,  37, 164, 110, 158, 201,\n         78, 114,  57,  48,  70, 142, 106,  43,\n        232,  26,  32, 252, 239,  98, 191,  94,\n         59, 149,  39, 187, 203, 190,  19,  13,\n        133,  45,  61, 247,  23,  34,  20,  52,\n        118, 209, 146, 193, 222,  18,   1, 152,\n         46,  41,  91, 148, 115,  25, 135,  77,\n        254, 147, 224, 161,   9, 213, 223, 250,\n        231, 251, 127, 166,  63, 179,  81, 130,\n        139,  28, 120, 151, 241,  86, 111,   0,\n         88, 153, 172, 182, 159, 105, 178,  47,\n         51, 167,  65,  66,  92,  73, 198, 211,\n        245, 195,  31, 220, 140,  76, 221, 186,\n        154, 185,  56,  83,  38, 165, 109,  67,\n        124, 226, 132,  53, 229,  29,  12, 181,\n        121,  24, 207, 199, 177, 113,  30,  80,\n          3,  97, 188,  79, 216, 173,   8, 145,\n         87, 128, 180, 237, 240, 137, 125, 104,\n         15, 242, 119, 246, 103, 143,  95, 144,\n          2,  44,  69, 157, 192, 174,  14,  54,\n        218,  82,  64, 210,  11,   6, 129,  21,\n        116, 171,  99, 202,   7, 107, 253, 108\n    ];\n\n\tpublic generatePermutationData(): Uint8Array {\n\t\tconst a = new Uint8Array(256 * 256 * 4); // Multiplied by 4 for RGBA\n\t\tfor (let y = 0; y < 256; y++) {\n\t\t\tfor (let x = 0; x < 256; x++) {\n\t\t\t\tconst base = (x + y * 256) * 4;\n\t\t\t\tconst value = this.permutation256[(y + this.permutation256[x]) % 256];\n\t\t\t\ta[base] = value; // R\n\t\t\t\ta[base + 1] = value; // G (could be different for variety)\n\t\t\t\ta[base + 2] = value; // B (could be different for variety)\n\t\t\t\ta[base + 3] = 255; // A (alpha channel)\n\t\t\t}\n\t\t}\n\t\treturn a;\n\t}\n\n\tpublic displayPermSlide_(): void {\n\t\tthis.gl.activeTexture(this.gl.TEXTURE2);\n\t\tthis.gl.bindTexture(this.gl.TEXTURE_2D, this.permTexture);\n\t\tthis.gl.uniform1i(\n\t\t\tthis.gl.getUniformLocation(this.program, 'permTexture'),\n\t\t\t2,\n\t\t);\n\t}\n\n\tpublic displaySlides_(t: number): void {\n\t\tthis.gl.uniform1f(this.gl.getUniformLocation(this.program, 'time'), t);\n\n\t\tthis.setBufferData(this.leavingPrimitives[0].vertices);\n\t\tthis.gl.activeTexture(this.gl.TEXTURE0);\n\t\tthis.gl.bindTexture(this.gl.TEXTURE_2D, this.textures[0]);\n\t\tthis.gl.uniform1i(\n\t\t\tthis.gl.getUniformLocation(this.program, 'leavingSlideTexture'),\n\t\t\t0,\n\t\t);\n\n\t\tthis.gl.activeTexture(this.gl.TEXTURE1);\n\t\tthis.gl.bindTexture(this.gl.TEXTURE_2D, this.textures[1]);\n\t\tthis.gl.uniform1i(\n\t\t\tthis.gl.getUniformLocation(this.program, 'enteringSlideTexture'),\n\t\t\t1,\n\t\t);\n\t\tthis.gl.drawArrays(\n\t\t\tthis.gl.TRIANGLE_STRIP,\n\t\t\t0,\n\t\t\tthis.leavingPrimitives[0].vertices.length,\n\t\t);\n\n\t\tthis.displayPermSlide_();\n\t}\n}\n\nSlideShow.PermTextureTransition = PermTextureTransition;\n"]}