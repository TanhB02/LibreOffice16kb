{"version":3,"file":"StaticTextRenderer.js","sourceRoot":"","sources":["../../../../../../../../../../TanhX/online/browser/src/slideshow/StaticTextRenderer.ts"],"names":[],"mappings":"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","sourcesContent":["// @ts-strict-ignore\n/* -*- js-indent-level: 8 -*- */\n\n/*\n * Copyright the Collabora Online contributors.\n *\n * SPDX-License-Identifier: MPL-2.0\n *\n * This Source Code Form is subject to the terms of the Mozilla Public\n * License, v. 2.0. If a copy of the MPL was not distributed with this\n * file, You can obtain one at http://mozilla.org/MPL/2.0/.\n */\n\n/*\n * StaticTextRenderer is an empty canvas used to draw text, which we then load onto the WebGL canvas....\n * We are not rendering the text directly on the WebGL canvas. instead, we draw the text on a separate off-screen 2D canvas and use it as a texture in WebGL....\n */\n\ndeclare var SlideShow: any;\n\nclass StaticTextRenderer extends TextureAnimationBase {\n\tpublic textTexture: WebGLTexture;\n\n\tconstructor(canvasContext: RenderContextGl) {\n\t\tsuper(canvasContext);\n\t}\n\n\tpublic display(displayText: string) {\n\t\tif (this.context.isDisposed()) return;\n\n\t\tthis.textTexture = this.createTextTexture(displayText);\n\t\tthis.prepareTransition();\n\t\trequestAnimationFrame(this.animate.bind(this));\n\t}\n\n\tpublic animate(): void {\n\t\trequestAnimationFrame(this.render.bind(this));\n\t}\n\n\tpublic createTextTexture(displayText: string): WebGLTexture {\n\t\tconst textCanvas = this.create2DCanvasWithText(displayText);\n\t\treturn this.load2dCanvasToGlCanvas(textCanvas);\n\t}\n\n\t// Create an off-screen 2D canvas with text centered\n\tpublic create2DCanvasWithText(displayText: string): HTMLCanvasElement {\n\t\tif (this.context.isDisposed()) return null;\n\n\t\tconst canvas = document.createElement('canvas');\n\t\tcanvas.width = this.context.canvas.width;\n\t\tcanvas.height = this.context.canvas.height;\n\t\tconst ctx = canvas.getContext('2d');\n\n\t\t// Set background color\n\t\tctx.fillStyle = 'black';\n\t\tctx.fillRect(0, 0, canvas.width, canvas.height);\n\n\t\t// Set text attributes\n\t\tctx.fillStyle = 'white';\n\t\tctx.font = '20px sans-serif';\n\t\tctx.textAlign = 'center';\n\t\tctx.textBaseline = 'middle';\n\n\t\tctx.fillText(displayText, canvas.width / 2, canvas.height / 2);\n\n\t\treturn canvas;\n\t}\n\n\tpublic load2dCanvasToGlCanvas(canvas: HTMLCanvasElement): WebGLTexture {\n\t\tif (this.context.isDisposed()) return null;\n\n\t\tconst texture = this.gl.createTexture();\n\t\tif (!texture) {\n\t\t\tthrow new Error('Failed to create texture');\n\t\t}\n\t\tthis.gl.bindTexture(this.gl.TEXTURE_2D, texture);\n\t\tthis.gl.texImage2D(\n\t\t\tthis.gl.TEXTURE_2D,\n\t\t\t0,\n\t\t\tthis.gl.RGBA,\n\t\t\tthis.gl.RGBA,\n\t\t\tthis.gl.UNSIGNED_BYTE,\n\t\t\tcanvas,\n\t\t);\n\t\tthis.gl.texParameteri(\n\t\t\tthis.gl.TEXTURE_2D,\n\t\t\tthis.gl.TEXTURE_WRAP_S,\n\t\t\tthis.gl.CLAMP_TO_EDGE,\n\t\t);\n\t\tthis.gl.texParameteri(\n\t\t\tthis.gl.TEXTURE_2D,\n\t\t\tthis.gl.TEXTURE_WRAP_T,\n\t\t\tthis.gl.CLAMP_TO_EDGE,\n\t\t);\n\t\tthis.gl.texParameteri(\n\t\t\tthis.gl.TEXTURE_2D,\n\t\t\tthis.gl.TEXTURE_MIN_FILTER,\n\t\t\tthis.gl.LINEAR,\n\t\t);\n\t\tthis.gl.texParameteri(\n\t\t\tthis.gl.TEXTURE_2D,\n\t\t\tthis.gl.TEXTURE_MAG_FILTER,\n\t\t\tthis.gl.LINEAR,\n\t\t);\n\n\t\treturn texture;\n\t}\n\n\tpublic render(): void {\n\t\tif (this.context.isDisposed()) return;\n\n\t\tthis.gl.viewport(\n\t\t\t0,\n\t\t\t0,\n\t\t\tthis.context.canvas.width,\n\t\t\tthis.context.canvas.height,\n\t\t);\n\t\tthis.gl.clearColor(0.0, 0.0, 0.0, 1.0);\n\t\tthis.gl.clear(this.gl.COLOR_BUFFER_BIT);\n\n\t\tthis.gl.useProgram(this.program);\n\n\t\tthis.gl.activeTexture(this.gl.TEXTURE0);\n\t\tthis.gl.bindTexture(this.gl.TEXTURE_2D, this.textTexture);\n\n\t\tconst textureLocation = this.gl.getUniformLocation(\n\t\t\tthis.program,\n\t\t\t'u_texture',\n\t\t);\n\t\tthis.gl.uniform1i(textureLocation, 0);\n\n\t\tthis.gl.bindVertexArray(this.vao);\n\t\tthis.gl.drawArrays(this.gl.TRIANGLE_STRIP, 0, 4);\n\t}\n\n\tpublic getFragmentShader(): string {\n\t\treturn `#version 300 es\n\t\t\tprecision highp float;\n\t\t\tin vec2 v_texCoord;\n\t\t\tuniform sampler2D u_texture;\n\t\t\tout vec4 outColor;\n\n\t\t\tvoid main() {\n\t\t\t\toutColor = texture(u_texture, v_texCoord);\n\t\t\t}`;\n\t}\n}\n\nSlideShow.StaticTextRenderer = StaticTextRenderer;\n"]}