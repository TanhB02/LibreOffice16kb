{"version":3,"file":"Primitive.js","sourceRoot":"","sources":["../../../../../../../../../../TanhX/online/browser/src/slideshow/Primitive.ts"],"names":[],"mappings":"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","sourcesContent":["/* -*- js-indent-level: 8 -*- */\n\n/*\n * Copyright the Collabora Online contributors.\n *\n * SPDX-License-Identifier: MPL-2.0\n *\n * This Source Code Form is subject to the terms of the Mozilla Public\n * License, v. 2.0. If a copy of the MPL was not distributed with this\n * file, You can obtain one at http://mozilla.org/MPL/2.0/.\n */\n\n/* This file for handling Primitive */\n\ndeclare var SlideShow: any;\n\ninterface Vertex {\n\tposition: vec3;\n\tnormal: vec3;\n\ttexCoord: vec2;\n}\n\nclass Primitive {\n\tpublic vertices: Vertex[] = [];\n\tpublic operations: Operation[] = [];\n\n\tstatic cloneDeep(oldPrimitive: Primitive): Primitive {\n\t\tconst newPrimitive = new Primitive();\n\n\t\tnewPrimitive.vertices = [...oldPrimitive.vertices];\n\n\t\tnewPrimitive.operations = oldPrimitive.operations.map(\n\t\t\t(operation: Operation) => {\n\t\t\t\treturn operation;\n\t\t\t},\n\t\t);\n\n\t\treturn newPrimitive;\n\t}\n\n\tpublic pushTriangle(\n\t\tslideLocation0: vec2,\n\t\tslideLocation1: vec2,\n\t\tslideLocation2: vec2,\n\t): void {\n\t\tlet verts: vec3[] = [];\n\t\tconst texs: vec2[] = [];\n\n\t\tverts.push([2 * slideLocation0[0] - 1, -2 * slideLocation0[1] + 1, 0.0]);\n\t\tverts.push([2 * slideLocation1[0] - 1, -2 * slideLocation1[1] + 1, 0.0]);\n\t\tverts.push([2 * slideLocation2[0] - 1, -2 * slideLocation2[1] + 1, 0.0]);\n\n\t\tconst normal = this.cross(\n\t\t\tthis.subtract(verts[0], verts[1]),\n\t\t\tthis.subtract(verts[1], verts[2]),\n\t\t);\n\t\tconst isFacingUs = normal[2] >= 0.0;\n\n\t\tif (isFacingUs) {\n\t\t\ttexs.push(slideLocation0);\n\t\t\ttexs.push(slideLocation1);\n\t\t\ttexs.push(slideLocation2);\n\t\t} else {\n\t\t\ttexs.push(slideLocation0);\n\t\t\ttexs.push(slideLocation2);\n\t\t\ttexs.push(slideLocation1);\n\t\t\tverts = [];\n\t\t\tverts.push([2 * slideLocation0[0] - 1, -2 * slideLocation0[1] + 1, 0.0]);\n\t\t\tverts.push([2 * slideLocation2[0] - 1, -2 * slideLocation2[1] + 1, 0.0]);\n\t\t\tverts.push([2 * slideLocation1[0] - 1, -2 * slideLocation1[1] + 1, 0.0]);\n\t\t}\n\n\t\tthis.vertices.push(\n\t\t\t{ position: verts[0], normal: [0, 0, 1], texCoord: texs[0] },\n\t\t\t{ position: verts[1], normal: [0, 0, 1], texCoord: texs[1] },\n\t\t\t{ position: verts[2], normal: [0, 0, 1], texCoord: texs[2] },\n\t\t);\n\t}\n\n\tpublic getVertex(n: number): vec3 {\n\t\treturn this.vertices[n].position;\n\t}\n\n\tprivate subtract(a: vec3, b: vec3): vec3 {\n\t\treturn [a[0] - b[0], a[1] - b[1], a[2] - b[2]];\n\t}\n\n\tprivate cross(a: vec3, b: vec3): vec3 {\n\t\treturn [\n\t\t\ta[1] * b[2] - a[2] * b[1],\n\t\t\ta[2] * b[0] - a[0] * b[2],\n\t\t\ta[0] * b[1] - a[1] * b[0],\n\t\t];\n\t}\n\n\tpublic clear(): void {\n\t\tthis.operations = [];\n\t}\n}\n\nSlideShow.Primitive = Primitive;\n"]}