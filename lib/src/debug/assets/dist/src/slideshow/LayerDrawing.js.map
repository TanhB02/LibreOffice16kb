{"version":3,"file":"LayerDrawing.js","sourceRoot":"","sources":["../../../../../../../../../../TanhX/online/browser/src/slideshow/LayerDrawing.ts"],"names":[],"mappings":"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","sourcesContent":["// @ts-strict-ignore\n/* -*- js-indent-level: 8 -*- */\n\n/*\n * Copyright the Collabora Online contributors.\n *\n * SPDX-License-Identifier: MPL-2.0\n *\n * This Source Code Form is subject to the terms of the Mozilla Public\n * License, v. 2.0. If a copy of the MPL was not distributed with this\n * file, You can obtain one at http://mozilla.org/MPL/2.0/.\n */\n\n/*\n * LayerDrawing is handling the slideShow action\n */\n\ndeclare var SlideShow: any;\n// These are defined in browser/js/global.js\ndeclare var ThisIsTheAndroidApp: any;\ndeclare var ThisIsTheiOSApp: any;\ndeclare var makeHttpUrl: any;\ndeclare var coolParams: any;\n\ntype LayerContentType =\n\t| ImageInfo\n\t| PlaceholderInfo\n\t| AnimatedShapeInfo\n\t| TextFieldInfo;\n\ntype TextFieldsType = 'SlideNumber' | 'Footer' | 'DateTime';\n\ntype TextFields = {\n\tSlideNumber: string;\n\tDateTime: string;\n\tFooter: string;\n};\n\ninterface TextFieldInfo {\n\ttype: TextFieldsType;\n\thash: string;\n\tcontent: ImageInfo;\n}\n\ninterface ImageInfo {\n\ttype: 'png' | 'zstd';\n\tchecksum: string;\n\tdata?: any;\n}\n\ninterface AnimatedShapeInfo {\n\thash: string;\n\tinitVisible: boolean;\n\ttype: 'bitmap' | 'svg';\n\tcontent: ImageInfo | SVGElement;\n\tbounds: BoundingBoxType;\n\tfillColor?: string;\n\tlineColor?: string;\n\tfontColor?: string;\n}\n\ninterface PlaceholderInfo {\n\ttype: TextFieldsType;\n\thash: string;\n}\n\ninterface LayerInfo {\n\tgroup: 'Background' | 'MasterPage' | 'DrawPage' | 'TextFields';\n\tslideHash: string;\n\tindex?: number;\n\ttype?: 'bitmap' | 'placeholder' | 'animated';\n\tcontent: LayerContentType;\n\tisField?: boolean;\n}\n\ninterface LayerEntry {\n\ttype: 'bitmap' | 'placeholder' | 'animated';\n\tcontent: LayerContentType;\n\tisField?: boolean;\n}\n\nclass LayerDrawing {\n\tprivate map: any = null;\n\tprivate helper: LayersCompositor;\n\n\tprivate slideCache: SlideCache = new SlideCache();\n\tprivate requestedSlideHash: string = null;\n\tprivate prefetchedSlideHash: string = null;\n\tprivate nextRequestedSlideHash: string = null;\n\tprivate nextPrefetchedSlideHash: string = null;\n\tprivate slideRequestTimeout: any = null;\n\tprivate resolutionWidth: number = 960;\n\tprivate resolutionHeight: number = 540;\n\tprivate canvasWidth: number = 0;\n\tprivate canvasHeight: number = 0;\n\tprivate backgroundChecksums: Map<string, string> = new Map();\n\tprivate cachedBackgrounds: Map<string, ImageInfo> = new Map();\n\tprivate cachedMasterPages: Map<string, Array<LayerEntry>> = new Map();\n\tprivate cachedDrawPages: Map<string, Array<LayerEntry>> = new Map();\n\tprivate cachedTextFields: Map<string, TextFieldInfo> = new Map();\n\tprivate slideTextFieldsMap: Map<string, Map<string, string>> = new Map();\n\tprivate offscreenCanvas: OffscreenCanvas = null;\n\tprivate onSlideRenderingCompleteCallback: VoidFunction = null;\n\tprivate layerRenderer: LayerRenderer;\n\tprivate videoRenderers: Map<string, Array<VideoRenderer>> = new Map();\n\tprivate isTransitionActive: boolean = false;\n\tprivate queuedLayers: any[] = [];\n\n\tconstructor(mapObj: any, helper: LayersCompositor) {\n\t\tthis.map = mapObj;\n\t\tthis.helper = helper;\n\t}\n\n\taddHooks() {\n\t\tthis.map.on('slidelayer', this.onSlideLayerMsg, this);\n\t\tthis.map.on('sliderenderingcomplete', this.onSlideRenderingComplete, this);\n\t}\n\n\tremoveHooks() {\n\t\tthis.map.off('slidelayer', this.onSlideLayerMsg, this);\n\t\tthis.map.off('sliderenderingcomplete', this.onSlideRenderingComplete, this);\n\t}\n\n\tpublic isDisposed() {\n\t\treturn this.layerRenderer && this.layerRenderer.isDisposed();\n\t}\n\tpublic deleteResources() {\n\t\tthis.requestedSlideHash = null;\n\t\tthis.prefetchedSlideHash = null;\n\t\tthis.nextRequestedSlideHash = null;\n\t\tthis.nextPrefetchedSlideHash = null;\n\t\tthis.deleteVideosResources();\n\t\tthis.layerRenderer.dispose();\n\t}\n\n\tprivate getSlideInfo(slideHash: string): SlideInfo {\n\t\treturn this.helper.getSlideInfo(slideHash);\n\t}\n\n\tpublic getSlide(slideNumber: number): ImageBitmap {\n\t\tconst startSlideHash = this.helper.getSlideHash(slideNumber);\n\t\treturn this.slideCache.get(startSlideHash);\n\t}\n\n\tpublic getLayerBounds(\n\t\tslideHash: string,\n\t\ttargetElement: string,\n\t): BoundingBoxType {\n\t\tconst layers = this.cachedDrawPages.get(slideHash);\n\t\tif (!layers) return null;\n\t\tfor (const i in layers) {\n\t\t\tconst animatedInfo = layers[i].content as AnimatedShapeInfo;\n\t\t\tif (\n\t\t\t\tanimatedInfo &&\n\t\t\t\tanimatedInfo.hash === targetElement &&\n\t\t\t\tanimatedInfo.content\n\t\t\t)\n\t\t\t\treturn animatedInfo.bounds;\n\t\t}\n\t\treturn null;\n\t}\n\n\tpublic getAnimatedSlide(slideIndex: number): ImageBitmap {\n\t\tconsole.debug('LayerDrawing.getAnimatedSlide: slide index: ' + slideIndex);\n\t\tconst slideHash = this.helper.getSlideHash(slideIndex);\n\t\tthis.composeLayers(slideHash);\n\t\treturn this.offscreenCanvas.transferToImageBitmap();\n\t}\n\n\tpublic composeLayers(slideHash: string): void {\n\t\tif (this.isDisposed()) return;\n\n\t\tthis.drawBackground(slideHash);\n\t\tthis.drawMasterPage(slideHash);\n\t\tthis.drawDrawPage(slideHash);\n\t\tthis.drawVideos(slideHash);\n\t}\n\n\tprivate handleVideos(slideHash: string) {\n\t\tconst slideInfo = this.getSlideInfo(slideHash);\n\t\tconst videosInfo = slideInfo.videos;\n\t\tif (!videosInfo || videosInfo.length === 0) return;\n\t\tthis.videoRenderers.set(slideHash, []);\n\n\t\tif (\n\t\t\t!this.layerRenderer.getRenderContext().is2dGl() &&\n\t\t\t!VideoRendererGl.videoProgramInitialized\n\t\t) {\n\t\t\tVideoRendererGl.createProgram(this.layerRenderer.getRenderContext());\n\t\t}\n\n\t\tfor (let i = 0; i < videosInfo.length; ++i) {\n\t\t\tconst videoInfo = videosInfo[i];\n\t\t\tthis.handleVideo(i, slideHash, videoInfo);\n\t\t}\n\t}\n\n\tprivate handleVideo(index: number, slideHash: string, videoInfo: VideoInfo) {\n\t\tconst slideShowPresenter = app.map.slideShowPresenter;\n\t\tconst slideRenderer = slideShowPresenter._slideRenderer;\n\t\tconst metaPres = slideShowPresenter._metaPresentation;\n\n\t\tconst videoId = slideHash + index;\n\t\tconst videoRenderer = makeVideoRenderer(\n\t\t\tvideoId,\n\t\t\tthis.layerRenderer.getRenderContext(),\n\t\t\tslideRenderer,\n\t\t);\n\t\tvideoRenderer.prepareVideo(\n\t\t\tvideoInfo,\n\t\t\tmetaPres.docWidth,\n\t\t\tmetaPres.docHeight,\n\t\t);\n\n\t\tthis.videoRenderers.get(slideHash).push(videoRenderer);\n\t}\n\n\tprivate drawVideos(slideHash: string) {\n\t\tconst videoRenderers = this.videoRenderers.get(slideHash);\n\t\tif (!videoRenderers) return;\n\n\t\tfor (const videoRenderer of videoRenderers) {\n\t\t\tvideoRenderer.render();\n\t\t}\n\t}\n\n\tpublic loadVideos(slideHash: string) {\n\t\tconst videoRenderers = this.videoRenderers.get(slideHash);\n\t\tif (!videoRenderers) return;\n\n\t\tfor (const videoRenderer of videoRenderers) {\n\t\t\tvideoRenderer.loadVideo();\n\t\t}\n\t}\n\n\tpublic pauseVideos(slideHash: string) {\n\t\tconst videoRenderers = this.videoRenderers.get(slideHash);\n\t\tif (!videoRenderers) return;\n\n\t\tfor (const videoRenderer of videoRenderers) {\n\t\t\tvideoRenderer.pauseVideo();\n\t\t}\n\t}\n\n\tpublic getVideoRenderer(\n\t\tslideHash: string,\n\t\tvideoInfo: VideoInfo,\n\t): VideoRenderer {\n\t\tconst videoRenderers = this.videoRenderers.get(slideHash);\n\n\t\tfor (const videoRenderer of videoRenderers) {\n\t\t\tif (videoRenderer.videoInfoId === videoInfo.id) {\n\t\t\t\treturn videoRenderer;\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate deleteVideosResources() {\n\t\tthis.videoRenderers.forEach((videoRenderers) => {\n\t\t\tfor (const videoRenderer of videoRenderers) {\n\t\t\t\tvideoRenderer.deleteResources();\n\t\t\t}\n\t\t});\n\t\tVideoRendererGl.deleteProgram(this.layerRenderer.getRenderContext());\n\t}\n\n\tpublic getAnimatedLayerInfo(\n\t\tslideHash: string,\n\t\ttargetElement: string,\n\t): AnimatedShapeInfo {\n\t\tconsole.debug(\n\t\t\t`LayerDrawing.getAnimatedLayerInfo(${slideHash}, ${targetElement})`,\n\t\t);\n\t\tconst layers = this.cachedDrawPages.get(slideHash);\n\t\tif (!layers) return null;\n\t\tfor (const i in layers) {\n\t\t\tconst animatedInfo = layers[i].content as AnimatedShapeInfo;\n\t\t\tif (animatedInfo && animatedInfo.hash === targetElement)\n\t\t\t\treturn animatedInfo;\n\t\t}\n\t\treturn null;\n\t}\n\n\tpublic getLayerImage(slideHash: string, targetElement: string): ImageBitmap {\n\t\tconst layers = this.cachedDrawPages.get(slideHash);\n\t\tif (!layers) return null;\n\t\tfor (const i in layers) {\n\t\t\tconst animatedInfo = layers[i].content as AnimatedShapeInfo;\n\t\t\tif (\n\t\t\t\tanimatedInfo &&\n\t\t\t\tanimatedInfo.hash === targetElement &&\n\t\t\t\tanimatedInfo.content\n\t\t\t)\n\t\t\t\treturn (animatedInfo.content as ImageInfo).data;\n\t\t}\n\t\treturn null;\n\t}\n\n\tpublic invalidateAll(): void {\n\t\tthis.slideCache.invalidateAll();\n\t\tthis.slideTextFieldsMap.clear();\n\t\tthis.cachedTextFields.clear();\n\t\tthis.cachedBackgrounds.clear();\n\t\tthis.cachedMasterPages.clear();\n\t\tthis.cachedDrawPages.clear();\n\t\tthis.videoRenderers.clear();\n\t}\n\n\tpublic getCanvasSize(): [number, number] {\n\t\treturn [this.canvasWidth, this.canvasHeight];\n\t}\n\n\tpublic onUpdatePresentationInfo() {\n\t\tthis.computeInitialResolution();\n\t\tthis.initializeCanvas();\n\t}\n\n\tpublic requestSlide(slideNumber: number, callback: VoidFunction) {\n\t\tthis.onSlideRenderingCompleteCallback = callback;\n\n\t\tconst startSlideHash = this.helper.getSlideHash(slideNumber);\n\t\tthis.requestSlideImpl(startSlideHash);\n\t}\n\n\tprivate initializeCanvas() {\n\t\tthis.computeCanvasSize(this.resolutionWidth, this.resolutionHeight);\n\t\tthis.createRenderingCanvas();\n\t}\n\n\tprivate createRenderingCanvas() {\n\t\tthis.offscreenCanvas = new OffscreenCanvas(\n\t\t\tthis.canvasWidth,\n\t\t\tthis.canvasHeight,\n\t\t);\n\n\t\ttry {\n\t\t\tthis.layerRenderer = new SlideShow.LayerRendererGl(this.offscreenCanvas);\n\t\t} catch (error) {\n\t\t\tconsole.log('LayerDrawing: WebGl offscreen rendering not supported');\n\t\t\tthis.layerRenderer = new SlideShow.LayerRenderer2d(this.offscreenCanvas);\n\t\t}\n\t}\n\n\tprivate requestSlideImpl(slideHash: string, prefetch: boolean = false) {\n\t\tif (this.isDisposed()) return;\n\n\t\tconsole.debug(\n\t\t\t'LayerDrawing.requestSlideImpl: slide hash: ' +\n\t\t\t\tslideHash +\n\t\t\t\t', prefetching: ' +\n\t\t\t\tprefetch,\n\t\t);\n\t\tconst slideInfo = this.getSlideInfo(slideHash);\n\t\tif (!slideInfo) {\n\t\t\twindow.app.console.log(\n\t\t\t\t'LayerDrawing.requestSlideImpl: No info for requested slide: hash: ' +\n\t\t\t\t\tslideHash,\n\t\t\t);\n\t\t\treturn;\n\t\t}\n\t\tif (\n\t\t\tslideHash === this.requestedSlideHash ||\n\t\t\tslideHash === this.prefetchedSlideHash ||\n\t\t\tslideHash === this.nextRequestedSlideHash ||\n\t\t\tslideHash === this.nextPrefetchedSlideHash\n\t\t) {\n\t\t\tconsole.debug(\n\t\t\t\t'LayerDrawing.requestSlideImpl: no need to fetch slide again',\n\t\t\t);\n\t\t\treturn;\n\t\t}\n\n\t\tif (\n\t\t\tthis.requestedSlideHash ||\n\t\t\tthis.prefetchedSlideHash ||\n\t\t\tthis.slideRequestTimeout\n\t\t) {\n\t\t\tif (!prefetch || !this.slideRequestTimeout) {\n\t\t\t\tif (!prefetch) {\n\t\t\t\t\t// maybe user has switched to a new slide\n\t\t\t\t\tclearTimeout(this.slideRequestTimeout);\n\t\t\t\t\tthis.nextRequestedSlideHash = slideHash;\n\t\t\t\t\tthis.nextPrefetchedSlideHash = null;\n\t\t\t\t} else {\n\t\t\t\t\t// prefetching and nothing already queued\n\t\t\t\t\tthis.nextPrefetchedSlideHash = slideHash;\n\t\t\t\t}\n\t\t\t\tthis.slideRequestTimeout = setTimeout(() => {\n\t\t\t\t\tif (!this.helper.isSlideShowPlaying()) return;\n\t\t\t\t\tthis.slideRequestTimeout = null;\n\t\t\t\t\tthis.nextRequestedSlideHash = null;\n\t\t\t\t\tthis.nextPrefetchedSlideHash = null;\n\n\t\t\t\t\tthis.requestSlideImpl(slideHash, prefetch);\n\t\t\t\t}, 500);\n\t\t\t}\n\t\t\treturn;\n\t\t}\n\n\t\tif (prefetch) {\n\t\t\tthis.prefetchedSlideHash = slideHash;\n\t\t\tthis.requestedSlideHash = null;\n\t\t} else {\n\t\t\tthis.requestedSlideHash = slideHash;\n\t\t\tthis.prefetchedSlideHash = null;\n\t\t}\n\n\t\tif (this.slideCache.has(slideHash)) {\n\t\t\tthis.onSlideRenderingComplete({ success: true });\n\t\t\treturn;\n\t\t}\n\n\t\tconst backgroundRendered = this.drawBackground(slideHash);\n\t\tconst masterPageRendered = this.drawMasterPage(slideHash);\n\t\tif (backgroundRendered && masterPageRendered) {\n\t\t\tif (this.drawDrawPage(slideHash)) {\n\t\t\t\tthis.onSlideRenderingComplete({ success: true });\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\tapp.socket.sendMessage(\n\t\t\t`getslide hash=${slideInfo.hash} part=${slideInfo.index} width=${this.canvasWidth} height=${this.canvasHeight} ` +\n\t\t\t\t`renderBackground=${backgroundRendered ? 0 : 1} renderMasterPage=${masterPageRendered ? 0 : 1} devicePixelRatio=${window.devicePixelRatio}`,\n\t\t);\n\t}\n\n\tonSlideLayerMsg(e: any) {\n\t\tif (this.isDisposed()) return;\n\n\t\tif (this.isTransitionActive) {\n\t\t\tthis.queuedLayers.push(e);\n\t\t\treturn;\n\t\t}\n\t\tconst info = e.message;\n\t\tif (!info) {\n\t\t\twindow.app.console.log(\n\t\t\t\t'LayerDrawing.onSlideLayerMsg: no json data available.',\n\t\t\t);\n\t\t\treturn;\n\t\t}\n\t\tif (!this.getSlideInfo(info.slideHash)) {\n\t\t\twindow.app.console.log(\n\t\t\t\t'LayerDrawing.onSlideLayerMsg: no slide info available for ' +\n\t\t\t\t\tinfo.slideHash +\n\t\t\t\t\t'.',\n\t\t\t);\n\t\t\treturn;\n\t\t}\n\t\tif (!info.content) {\n\t\t\twindow.app.console.log(\n\t\t\t\t'LayerDrawing.onSlideLayerMsg: no layer content available.',\n\t\t\t);\n\t\t\treturn;\n\t\t}\n\n\t\tswitch (info.group) {\n\t\t\tcase 'Background':\n\t\t\t\tthis.handleBackgroundMsg(info, e.image);\n\t\t\t\tbreak;\n\t\t\tcase 'MasterPage':\n\t\t\t\tthis.handleMasterPageLayerMsg(info, e.image);\n\t\t\t\tbreak;\n\t\t\tcase 'DrawPage':\n\t\t\t\tthis.handleDrawPageLayerMsg(info, e.image);\n\t\t\t\tbreak;\n\t\t\tcase 'TextFields':\n\t\t\t\tthis.handleTextFieldMsg(info, e.image);\n\t\t}\n\t}\n\n\thandleTextFieldMsg(info: LayerInfo, img: any) {\n\t\tconst textFieldInfo = info.content as TextFieldInfo;\n\t\tconst imageInfo = textFieldInfo.content;\n\t\tif (!this.checkAndAttachImageData(imageInfo, img)) return;\n\n\t\tlet textFields = this.slideTextFieldsMap.get(info.slideHash);\n\t\tif (!textFields) {\n\t\t\ttextFields = new Map<string, string>();\n\t\t\tthis.slideTextFieldsMap.set(info.slideHash, textFields);\n\t\t}\n\t\ttextFields.set(textFieldInfo.hash, imageInfo.checksum);\n\n\t\tthis.cachedTextFields.set(imageInfo.checksum, textFieldInfo);\n\t}\n\n\tprivate handleBackgroundMsg(info: LayerInfo, img: any) {\n\t\tconst slideInfo = this.getSlideInfo(info.slideHash);\n\t\tif (!slideInfo.background) {\n\t\t\treturn;\n\t\t}\n\t\tif (info.type === 'bitmap') {\n\t\t\tconst imageInfo = info.content as ImageInfo;\n\t\t\tif (!this.checkAndAttachImageData(imageInfo, img)) return;\n\n\t\t\tconst pageHash = slideInfo.background.isCustom\n\t\t\t\t? info.slideHash\n\t\t\t\t: slideInfo.masterPage;\n\t\t\tthis.backgroundChecksums.set(pageHash, imageInfo.checksum);\n\t\t\tthis.cachedBackgrounds.set(imageInfo.checksum, imageInfo);\n\n\t\t\tthis.clearCanvas();\n\t\t\tthis.drawBitmap(imageInfo);\n\t\t}\n\t}\n\n\tprivate handleMasterPageLayerMsg(info: LayerInfo, img: any) {\n\t\tconst slideInfo = this.getSlideInfo(info.slideHash);\n\t\tif (!slideInfo.masterPageObjectsVisibility) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (info.index === 0 || !this.cachedMasterPages.get(slideInfo.masterPage))\n\t\t\tthis.cachedMasterPages.set(slideInfo.masterPage, new Array<LayerEntry>());\n\n\t\tconst layers = this.cachedMasterPages.get(slideInfo.masterPage);\n\t\tif (layers.length !== info.index) {\n\t\t\twindow.app.console.log(\n\t\t\t\t'LayerDrawing.handleMasterPageLayerMsg: missed any layers ?',\n\t\t\t);\n\t\t}\n\t\tconst layerEntry: LayerEntry = {\n\t\t\ttype: info.type,\n\t\t\tcontent: info.content,\n\t\t\tisField: info.isField,\n\t\t};\n\t\tif (info.type === 'bitmap') {\n\t\t\tif (!this.checkAndAttachImageData(layerEntry.content as ImageInfo, img))\n\t\t\t\treturn;\n\t\t}\n\t\tlayers.push(layerEntry);\n\n\t\tthis.drawMasterPageLayer(layerEntry, info.slideHash);\n\t}\n\n\tprivate handleDrawPageLayerMsg(info: LayerInfo, img: any) {\n\t\tif (info.index === 0 || !this.cachedDrawPages.get(info.slideHash)) {\n\t\t\tthis.cachedDrawPages.set(info.slideHash, new Array<LayerEntry>());\n\t\t}\n\t\tconst layers = this.cachedDrawPages.get(info.slideHash);\n\t\tif (layers.length !== info.index) {\n\t\t\twindow.app.console.log(\n\t\t\t\t'LayerDrawing.handleDrawPageLayerMsg: missed any layers ?',\n\t\t\t);\n\t\t}\n\t\tconst layerEntry: LayerEntry = {\n\t\t\ttype: info.type,\n\t\t\tcontent: info.content,\n\t\t};\n\t\tif (info.type === 'bitmap') {\n\t\t\tif (!this.checkAndAttachImageData(layerEntry.content as ImageInfo, img))\n\t\t\t\treturn;\n\t\t} else if (info.type === 'animated') {\n\t\t\tconst content = layerEntry.content as AnimatedShapeInfo;\n\t\t\tif (content.type === 'bitmap') {\n\t\t\t\tif (!this.checkAndAttachImageData(content.content as ImageInfo, img))\n\t\t\t\t\treturn;\n\t\t\t\tconst animatedElement = this.helper.getAnimatedElement(\n\t\t\t\t\tinfo.slideHash,\n\t\t\t\t\tcontent.hash,\n\t\t\t\t);\n\t\t\t\tif (animatedElement) {\n\t\t\t\t\tanimatedElement.updateAnimationInfo(content);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tlayers.push(layerEntry);\n\n\t\tthis.drawDrawPageLayer(info.slideHash, layerEntry);\n\t}\n\n\tprivate clearCanvas() {\n\t\tthis.layerRenderer.clearCanvas();\n\t}\n\tprivate drawBackground(slideHash: string) {\n\t\tthis.clearCanvas();\n\n\t\tconst slideInfo = this.getSlideInfo(slideHash);\n\n\t\tif (this.layerRenderer.fillColor(slideInfo)) return true;\n\n\t\tconst pageHash = slideInfo.background.isCustom\n\t\t\t? slideHash\n\t\t\t: slideInfo.masterPage;\n\t\tconst checksum = this.backgroundChecksums.get(pageHash);\n\t\tif (!checksum) return false;\n\n\t\tconst imageInfo = this.cachedBackgrounds.get(checksum);\n\t\tif (!imageInfo) {\n\t\t\twindow.app.console.log(\n\t\t\t\t'LayerDrawing: no cached background for slide: ' + slideHash,\n\t\t\t);\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.drawBitmap(imageInfo);\n\t\treturn true;\n\t}\n\n\tprivate drawMasterPage(slideHash: string) {\n\t\tconst slideInfo = this.getSlideInfo(slideHash);\n\t\tif (!slideInfo.masterPageObjectsVisibility) return true;\n\n\t\tconst layers = this.cachedMasterPages.get(slideInfo.masterPage);\n\t\tif (!layers || layers.length === 0) {\n\t\t\twindow.app.console.log(\n\t\t\t\t'LayerDrawing: No layer cached for master page: ' +\n\t\t\t\t\tslideInfo.masterPage,\n\t\t\t);\n\t\t\treturn false;\n\t\t}\n\n\t\tfor (const layer of layers) {\n\t\t\tthis.drawMasterPageLayer(layer, slideHash);\n\t\t}\n\n\t\treturn true;\n\t}\n\n\tprivate drawMasterPageLayer(layer: LayerEntry, slideHash: string) {\n\t\tif (layer.type === 'bitmap') {\n\t\t\tthis.drawBitmap(layer.content as ImageInfo);\n\t\t} else if (layer.type === 'placeholder') {\n\t\t\tconst placeholder = layer.content as PlaceholderInfo;\n\t\t\tconst slideTextFields = this.slideTextFieldsMap.get(slideHash);\n\t\t\tconst checksum = slideTextFields\n\t\t\t\t? slideTextFields.get(placeholder.hash)\n\t\t\t\t: null;\n\t\t\tif (!checksum) {\n\t\t\t\twindow.app.console.log(\n\t\t\t\t\t'LayerDrawing: No content found for text field placeholder, type: ' +\n\t\t\t\t\t\tplaceholder.type,\n\t\t\t\t);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tconst imageInfo = this.cachedTextFields.get(checksum).content;\n\t\t\tthis.drawBitmap(imageInfo);\n\t\t}\n\t}\n\n\tprivate drawDrawPage(slideHash: string) {\n\t\tconst slideInfo = this.getSlideInfo(slideHash);\n\t\tif (slideInfo.empty) {\n\t\t\treturn true;\n\t\t}\n\n\t\tconst layers = this.cachedDrawPages.get(slideHash);\n\t\tif (!layers || layers.length === 0) {\n\t\t\twindow.app.console.log(\n\t\t\t\t'LayerDrawing: No layer cached for draw page: ' + slideHash,\n\t\t\t);\n\t\t\treturn false;\n\t\t}\n\n\t\tfor (const layer of layers) {\n\t\t\tthis.drawDrawPageLayer(slideHash, layer);\n\t\t}\n\t\treturn true;\n\t}\n\n\tprivate drawDrawPageLayer(slideHash: string, layer: LayerEntry) {\n\t\tif (layer.type === 'bitmap') {\n\t\t\tthis.drawBitmap(layer.content as ImageInfo);\n\t\t} else if (layer.type === 'animated') {\n\t\t\tconst content = layer.content as AnimatedShapeInfo;\n\t\t\tif (content.type === 'bitmap') {\n\t\t\t\tconst animatedElement = this.helper.getAnimatedElement(\n\t\t\t\t\tslideHash,\n\t\t\t\t\tcontent.hash,\n\t\t\t\t);\n\t\t\t\tif (animatedElement) {\n\t\t\t\t\tconsole.debug(\n\t\t\t\t\t\t'LayerDrawing.drawDrawPageLayer: retrieved animatedElement',\n\t\t\t\t\t);\n\t\t\t\t\tif (animatedElement.isValid()) {\n\t\t\t\t\t\tanimatedElement.renderLayer(this.layerRenderer);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tthis.drawBitmap(content.content as ImageInfo);\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate drawBitmap(imageInfo: ImageInfo | ImageBitmap) {\n\t\tthis.layerRenderer.drawBitmap(imageInfo);\n\t}\n\n\tonSlideRenderingComplete(e: any) {\n\t\tif (this.isDisposed()) return;\n\n\t\tif (!e.success) {\n\t\t\tconst slideHash = this.requestedSlideHash || this.prefetchedSlideHash;\n\t\t\tconst slideInfo = this.getSlideInfo(slideHash);\n\t\t\tconst index = slideInfo ? slideInfo.index : undefined;\n\t\t\tthis.requestedSlideHash = null;\n\t\t\tthis.prefetchedSlideHash = null;\n\t\t\tconsole.debug(\n\t\t\t\t'LayerDrawing.onSlideRenderingComplete: rendering failed for slide: ' +\n\t\t\t\t\tindex,\n\t\t\t);\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.prefetchedSlideHash) {\n\t\t\tthis.prefetchedSlideHash = null;\n\t\t\treturn;\n\t\t}\n\t\tconst reqSlideInfo = this.getSlideInfo(this.requestedSlideHash);\n\n\t\tthis.cacheAndNotify();\n\t\t// fetch next slide and draw it on offscreen canvas\n\t\tif (reqSlideInfo.next && !this.slideCache.has(reqSlideInfo.next)) {\n\t\t\tthis.requestSlideImpl(reqSlideInfo.next, true);\n\t\t}\n\t}\n\n\tprivate cacheAndNotify() {\n\t\tif (!this.offscreenCanvas) {\n\t\t\twindow.app.console.log(\n\t\t\t\t'LayerDrawing.onSlideRenderingComplete: no offscreen canvas available.',\n\t\t\t);\n\t\t\treturn;\n\t\t}\n\t\tif (!this.slideCache.has(this.requestedSlideHash)) {\n\t\t\tconst renderedSlide = this.offscreenCanvas.transferToImageBitmap();\n\t\t\tthis.slideCache.set(this.requestedSlideHash, renderedSlide);\n\t\t}\n\t\tthis.requestedSlideHash = null;\n\n\t\tconst oldCallback = this.onSlideRenderingCompleteCallback;\n\t\tthis.onSlideRenderingCompleteCallback = null;\n\t\tif (oldCallback)\n\t\t\t// if we already closed presentation it is missing\n\t\t\toldCallback.call(this.helper);\n\t}\n\n\tprivate checkAndAttachImageData(imageInfo: ImageInfo, img: any): boolean {\n\t\tif (!img || (imageInfo.type === 'png' && !img.src)) {\n\t\t\twindow.app.console.log(\n\t\t\t\t'LayerDrawing.checkAndAttachImageData: no bitmap available.',\n\t\t\t);\n\t\t\treturn false;\n\t\t}\n\t\timageInfo.data = img;\n\t\treturn true;\n\t}\n\n\tprivate computeInitialResolution() {\n\t\tconst viewWidth = window.screen.width;\n\t\tconst viewHeight = window.screen.height;\n\t\tthis.computeResolution(viewWidth, viewHeight);\n\t}\n\n\tprivate computeResolution(viewWidth: number, viewHeight: number) {\n\t\t[this.resolutionWidth, this.resolutionHeight] =\n\t\t\tthis.helper.computeLayerResolution(viewWidth, viewHeight);\n\t}\n\n\tprivate computeCanvasSize(resWidth: number, resHeight: number) {\n\t\t[this.canvasWidth, this.canvasHeight] = this.helper.computeLayerSize(\n\t\t\tresWidth,\n\t\t\tresHeight,\n\t\t);\n\t}\n\n\tpublic getLayerRendererContext(): RenderContext {\n\t\treturn this.layerRenderer.getRenderContext();\n\t}\n\n\tpublic notifyTransitionStart() {\n\t\tthis.isTransitionActive = true;\n\t\tthis.queuedLayers = [];\n\t}\n\n\tpublic notifyTransitionEnd(slideHash: string) {\n\t\tthis.isTransitionActive = false;\n\t\twhile (this.queuedLayers.length > 0) {\n\t\t\tconst layer = this.queuedLayers.shift();\n\t\t\tthis.onSlideLayerMsg(layer);\n\t\t}\n\n\t\tthis.handleVideos(slideHash);\n\t\tif (this.videoRenderers.has(slideHash)) {\n\t\t\tthis.loadVideos(slideHash);\n\t\t}\n\t}\n}\n\nSlideShow.LayerDrawing = LayerDrawing;\n"]}