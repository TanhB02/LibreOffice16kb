{"version":3,"file":"FadeTransition.js","sourceRoot":"","sources":["../../../../../../../../../../../TanhX/online/browser/src/slideshow/transition/FadeTransition.ts"],"names":[],"mappings":"AAAA,gCAAgC;;;;;;;;;;;;;;;;AAchC,IAAK,WAIJ;AAJD,WAAK,WAAW;IACf,+DAAa,CAAA;IACb,+DAAa,CAAA;IACb,qDAAQ,CAAA;AACT,CAAC,EAJI,WAAW,KAAX,WAAW,QAIf;AAED;IAA6B,kCAAsB;IAGlD,wBAAY,oBAA0C;QAAtD,YACC,kBAAM,oBAAoB,CAAC,SAC3B;QAJO,sBAAgB,GAAW,CAAC,CAAC;;IAIrC,CAAC;IAEM,8BAAK,GAAZ;QACC,IAAM,iBAAiB,GAAG,IAAI,CAAC,oBAAoB,CAAC,iBAAiB,CAAC;QAEtE,IAAI,CAAC,gBAAgB,GAAG,WAAW,CAAC,aAAa,CAAC,CAAC,UAAU;QAE7D,IAAI,iBAAiB,IAAI,iBAAiB,CAAC,SAAS,EAAE;YACrD,IAAI,CAAC,gBAAgB,GAAG,WAAW,CAAC,QAAQ,CAAC;SAC7C;aAAM,IACN,iBAAiB,IAAI,iBAAiB,CAAC,aAAa;YACpD,IAAI,CAAC,oBAAoB,CAAC,SAAS;YACnC,IAAI,CAAC,oBAAoB,CAAC,SAAS,CAAC,WAAW,EAAE,KAAK,SAAS,EAC9D;YACD,IAAI,CAAC,gBAAgB,GAAG,WAAW,CAAC,aAAa,CAAC;SAClD;QAED,IAAI,CAAC,eAAe,EAAE,CAAC;IACxB,CAAC;IAEM,2CAAkB,GAAzB;QACC,IAAI,CAAC,EAAE,CAAC,SAAS,CAChB,IAAI,CAAC,EAAE,CAAC,kBAAkB,CAAC,IAAI,CAAC,OAAO,EAAE,YAAY,CAAC,EACtD,IAAI,CAAC,gBAAgB,CACrB,CAAC;IACH,CAAC;IAEM,0CAAiB,GAAxB;QACC,OAAO,+tCAmCJ,CAAC;IACL,CAAC;IACF,qBAAC;AAAD,CAAC,AAtED,CAA6B,SAAS,CAAC,YAAY,GAsElD;AAED,SAAS,CAAC,cAAc,GAAG,cAAc,CAAC","sourcesContent":["/* -*- js-indent-level: 8 -*- */\n\n/*\n * Copyright the Collabora Online contributors.\n *\n * SPDX-License-Identifier: MPL-2.0\n *\n * This Source Code Form is subject to the terms of the Mozilla Public\n * License, v. 2.0. If a copy of the MPL was not distributed with this\n * file, You can obtain one at http://mozilla.org/MPL/2.0/.\n */\n\ndeclare var SlideShow: any;\n\nenum FadeSubType {\n\tFADEOVERBLACK,\n\tFADEOVERWHITE,\n\tSMOOTHLY,\n}\n\nclass FadeTransition extends SlideShow.Transition2d {\n\tprivate effectTransition: number = 0;\n\n\tconstructor(transitionParameters: TransitionParameters) {\n\t\tsuper(transitionParameters);\n\t}\n\n\tpublic start(): void {\n\t\tconst transitionSubType = this.transitionFilterInfo.transitionSubtype;\n\n\t\tthis.effectTransition = FadeSubType.FADEOVERBLACK; // default\n\n\t\tif (transitionSubType == TransitionSubType.CROSSFADE) {\n\t\t\tthis.effectTransition = FadeSubType.SMOOTHLY;\n\t\t} else if (\n\t\t\ttransitionSubType == TransitionSubType.FADEOVERCOLOR &&\n\t\t\tthis.transitionFilterInfo.fadeColor &&\n\t\t\tthis.transitionFilterInfo.fadeColor.toUpperCase() === '#FFFFFF'\n\t\t) {\n\t\t\tthis.effectTransition = FadeSubType.FADEOVERWHITE;\n\t\t}\n\n\t\tthis.startTransition();\n\t}\n\n\tpublic renderUniformValue(): void {\n\t\tthis.gl.uniform1i(\n\t\t\tthis.gl.getUniformLocation(this.program, 'effectType'),\n\t\t\tthis.effectTransition,\n\t\t);\n\t}\n\n\tpublic getFragmentShader(): string {\n\t\treturn `#version 300 es\n\t\t\t\tprecision mediump float;\n\n\t\t\t\tuniform sampler2D leavingSlideTexture;\n\t\t\t\tuniform sampler2D enteringSlideTexture;\n\t\t\t\tuniform float time;\n\t\t\t\tuniform int effectType; // 0: Fade through black, 1: Fade through white, 2: Smooth fade\n\n\t\t\t\tin vec2 v_texCoord;\n\t\t\t\tout vec4 outColor;\n\n\t\t\t\tvoid main() {\n\t\t\t\t\tvec4 color0 = texture(leavingSlideTexture, v_texCoord);\n\t\t\t\t\tvec4 color1 = texture(enteringSlideTexture, v_texCoord);\n\t\t\t\t\tvec4 transitionColor;\n\n\t\t\t\t\tif (effectType == 0) {\n\t\t\t\t\t\t// Fade through black\n\t\t\t\t\t\ttransitionColor = vec4(0.0, 0.0, 0.0, 1.0);\n\t\t\t\t\t} else if (effectType == 1) {\n\t\t\t\t\t\t// Fade through white\n\t\t\t\t\t\ttransitionColor = vec4(1.0, 1.0, 1.0, 1.0);\n\t\t\t\t\t}\n\t\t\t\t\tif (effectType == 2) {\n\t\t\t\t\t\t// Smooth fade\n\t\t\t\t\t\tfloat smoothTime = smoothstep(0.0, 1.0, time);\n\t\t\t\t\t\toutColor = mix(color0, color1, smoothTime);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tif (time < 0.5) {\n\t\t\t\t\t\t\toutColor = mix(color0, transitionColor, time * 2.0);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\toutColor = mix(transitionColor, color1, (time - 0.5) * 2.0);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t`;\n\t}\n}\n\nSlideShow.FadeTransition = FadeTransition;\n"]}