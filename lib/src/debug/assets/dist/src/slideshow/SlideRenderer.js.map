{"version":3,"file":"SlideRenderer.js","sourceRoot":"","sources":["../../../../../../../../../../TanhX/online/browser/src/slideshow/SlideRenderer.ts"],"names":[],"mappings":"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","sourcesContent":["// @ts-strict-ignore\n/* -*- js-indent-level: 8 -*- */\n\n/*\n * Copyright the Collabora Online contributors.\n *\n * SPDX-License-Identifier: MPL-2.0\n *\n * This Source Code Form is subject to the terms of the Mozilla Public\n * License, v. 2.0. If a copy of the MPL was not distributed with this\n * file, You can obtain one at http://mozilla.org/MPL/2.0/.\n */\n\ndeclare var SlideShow: any;\n\nabstract class SlideRenderer {\n\tpublic _context: RenderContext = null;\n\tprotected _slideTexture: WebGLTexture | ImageBitmap;\n\tprotected _canvas: HTMLCanvasElement;\n\tprotected _renderedSlideIndex: number = undefined;\n\tprotected _requestAnimationFrameId: number = null;\n\tprivate _activeLayers: Set<string> = new Set();\n\tprivate _playingVideos: Set<string> = new Set();\n\n\tprotected constructor(canvas: HTMLCanvasElement) {\n\t\tthis._canvas = canvas;\n\t}\n\n\tpublic isDisposed() {\n\t\treturn this._context && this._context.isDisposed();\n\t}\n\n\tpublic get lastRenderedSlideIndex() {\n\t\treturn this._renderedSlideIndex;\n\t}\n\n\tpublic getSlideTexture(): WebGLTexture {\n\t\treturn this._slideTexture;\n\t}\n\n\tpublic getAnimatedSlideImage(): ImageBitmap {\n\t\tconst presenter: SlideShowPresenter = app.map.slideShowPresenter;\n\t\treturn presenter._slideCompositor.getAnimatedSlide(\n\t\t\tthis._renderedSlideIndex,\n\t\t);\n\t}\n\n\tpublic abstract deleteResources(): void;\n\n\tpublic renderSlide(\n\t\tcurrentSlideTexture: WebGLTexture | ImageBitmap,\n\t\tslideInfo: SlideInfo,\n\t) {\n\t\tthis.deleteCurrentSlideTexture();\n\t\tthis._activeLayers.clear();\n\t\tthis._renderedSlideIndex = slideInfo.indexInSlideShow;\n\t\tthis._slideTexture = currentSlideTexture;\n\t\trequestAnimationFrame(this.render.bind(this));\n\t}\n\n\tpublic abstract createTexture(\n\t\timage: ImageBitmap,\n\t\tisMipMapEnable?: boolean,\n\t): WebGLTexture | ImageBitmap;\n\n\tpublic abstract deleteCurrentSlideTexture(): void;\n\n\tprotected abstract render(): void;\n\n\tpublic createEmptyTexture(): WebGLTexture | ImageBitmap {\n\t\treturn null;\n\t}\n\n\tpublic notifyAnimationStarted(sId: string) {\n\t\tconst isAnyLayerActive = this.isAnyLayerActive();\n\t\tthis._activeLayers.add(sId);\n\t\tif (!isAnyLayerActive) {\n\t\t\tthis._requestAnimationFrameId = requestAnimationFrame(\n\t\t\t\tthis.render.bind(this),\n\t\t\t);\n\t\t}\n\t}\n\n\tpublic notifyAnimationEnded(sId: string) {\n\t\tthis._activeLayers.delete(sId);\n\t}\n\n\tpublic isAnyLayerActive(): boolean {\n\t\treturn this._activeLayers.size > 0;\n\t}\n\n\tpublic notifyVideoStarted(sId: string) {\n\t\tconst isAnyVideoAlreadyPlaying = this.isAnyVideoPlaying;\n\t\tthis._playingVideos.add(sId);\n\t\tif (!isAnyVideoAlreadyPlaying) {\n\t\t\tthis._requestAnimationFrameId = requestAnimationFrame(\n\t\t\t\tthis.render.bind(this),\n\t\t\t);\n\t\t}\n\t}\n\n\tpublic notifyVideoEnded(sId: string) {\n\t\tthis._playingVideos.delete(sId);\n\t}\n\n\tpublic get isAnyVideoPlaying(): boolean {\n\t\treturn this._playingVideos.size > 0;\n\t}\n}\n\nclass SlideRenderer2d extends SlideRenderer {\n\tconstructor(canvas: HTMLCanvasElement) {\n\t\tsuper(canvas);\n\t\tthis._context = new RenderContext2d(canvas);\n\t}\n\n\tpublic createTexture(image: ImageBitmap, _isMipMapsEnable?: boolean) {\n\t\treturn image;\n\t}\n\n\tpublic deleteCurrentSlideTexture(): void {\n\t\treturn;\n\t}\n\n\tpublic deleteResources(): void {\n\t\treturn;\n\t}\n\n\tprotected render() {\n\t\tif (this.isDisposed()) return;\n\n\t\tconst gl = this._context.get2dGl();\n\t\tgl.clearRect(0, 0, gl.canvas.width, gl.canvas.height);\n\n\t\tconst slideImage = this.getAnimatedSlideImage();\n\t\tapp.map.fire('newslideshowframe', {\n\t\t\tframe: slideImage,\n\t\t});\n\n\t\tgl.drawImage(slideImage, 0, 0);\n\t\tslideImage.close();\n\n\t\tgl.setTransform(1, 0, 0, 1, 0, 0);\n\n\t\tif (this.isAnyLayerActive() || this.isAnyVideoPlaying) {\n\t\t\tthis._requestAnimationFrameId = requestAnimationFrame(\n\t\t\t\tthis.render.bind(this),\n\t\t\t);\n\t\t}\n\t}\n}\n\nclass SlideRendererGl extends SlideRenderer {\n\tprivate readonly _program: WebGLProgram = null;\n\tprivate readonly _vao: WebGLVertexArrayObject = null;\n\n\tconstructor(canvas: HTMLCanvasElement) {\n\t\tsuper(canvas);\n\t\tthis._context = new RenderContextGl(canvas);\n\n\t\tconst vertexShader = this._context.createVertexShader(\n\t\t\tthis.getVertexShader(),\n\t\t);\n\t\tconst fragmentShader = this._context.createFragmentShader(\n\t\t\tthis.getFragmentShader(),\n\t\t);\n\n\t\tthis._program = this._context.createProgram(vertexShader, fragmentShader);\n\n\t\tthis._vao = this.setupPositions(-1.0, 1.0, 1.0, -1.0);\n\t\tthis._context.getGl().useProgram(this._program);\n\t}\n\n\tpublic getVertexShader(): string {\n\t\treturn `#version 300 es\n\t\t\t\tin vec4 a_position;\n\t\t\t\tin vec2 a_texCoord;\n\t\t\t\tout vec2 v_texCoord;\n\n\t\t\t\tvoid main() {\n\t\t\t\t\tgl_Position = a_position;\n\t\t\t\t\tv_texCoord = a_texCoord;\n\t\t\t\t}\n\t\t\t\t`;\n\t}\n\n\tpublic getFragmentShader(): string {\n\t\treturn `#version 300 es\n\t\t\t\tprecision mediump float;\n\n\t\t\t\tuniform sampler2D slideTexture;\n\n\t\t\t\tin vec2 v_texCoord;\n\t\t\t\tout vec4 outColor;\n\n\t\t\t\tvoid main() {\n\t\t\t\t\toutColor = texture(slideTexture, v_texCoord);\n\t\t\t\t}\n\t\t\t\t`;\n\t}\n\n\tprivate updateTexture(\n\t\ttexture: WebGLTexture,\n\t\tvideo: HTMLVideoElement | ImageBitmap,\n\t) {\n\t\tconst gl = this._context.getGl();\n\t\tgl.bindTexture(gl.TEXTURE_2D, texture);\n\t\tgl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, gl.RGBA, gl.UNSIGNED_BYTE, video);\n\t}\n\n\tpublic setupPositions(\n\t\txMin: number,\n\t\txMax: number,\n\t\tyMin: number,\n\t\tyMax: number,\n\t): WebGLVertexArrayObject {\n\t\tif (this.isDisposed()) return null;\n\n\t\tif (this._context.is2dGl()) return;\n\n\t\tconst gl = this._context.getGl();\n\n\t\t// 5 numbers -> 3 x vertex X,Y,Z and 2x texture X,Y\n\t\tconst positions = new Float32Array([\n\t\t\t//    vX    vY   vZ   tX   tY\n\t\t\t...[xMin, -yMin, 0.0, 0.0, 1.0],\n\t\t\t...[xMax, -yMin, 0.0, 1.0, 1.0],\n\t\t\t...[xMin, -yMax, 0.0, 0.0, 0.0],\n\t\t\t...[xMax, -yMax, 0.0, 1.0, 0.0],\n\t\t]);\n\n\t\tconst buffer = gl.createBuffer();\n\t\tgl.bindBuffer(gl.ARRAY_BUFFER, buffer);\n\t\tgl.bufferData(gl.ARRAY_BUFFER, positions, gl.STATIC_DRAW);\n\n\t\tconst vao = gl.createVertexArray();\n\t\tgl.bindVertexArray(vao);\n\n\t\tconst positionLocation = gl.getAttribLocation(this._program, 'a_position');\n\n\t\tgl.enableVertexAttribArray(positionLocation);\n\t\tgl.vertexAttribPointer(positionLocation, 3, gl.FLOAT, false, 5 * 4, 0);\n\n\t\tconst texCoordLocation = gl.getAttribLocation(this._program, 'a_texCoord');\n\n\t\tgl.enableVertexAttribArray(texCoordLocation);\n\t\tgl.vertexAttribPointer(texCoordLocation, 2, gl.FLOAT, false, 5 * 4, 3 * 4);\n\n\t\treturn vao;\n\t}\n\n\tprivate getNextTexture(): WebGLTexture {\n\t\tconst slideImage = this.getAnimatedSlideImage();\n\t\tapp.map.fire('newslideshowframe', {\n\t\t\tframe: slideImage,\n\t\t});\n\t\tthis.updateTexture(this._slideTexture, slideImage);\n\t\tslideImage.close();\n\t\treturn this._slideTexture;\n\t}\n\n\tpublic createTexture(image: ImageBitmap, isMipMapsEnable: boolean = false) {\n\t\treturn this._context.loadTexture(<any>image, isMipMapsEnable);\n\t}\n\n\tpublic createEmptyTexture(): WebGLTexture | ImageBitmap {\n\t\treturn this._context.createEmptySlide();\n\t}\n\n\tpublic deleteCurrentSlideTexture(): void {\n\t\tthis._context.deleteTexture(this._slideTexture);\n\t\tthis._slideTexture = null;\n\t}\n\n\tpublic deleteResources(): void {\n\t\tif (this.isDisposed()) return;\n\n\t\tthis.deleteCurrentSlideTexture();\n\t\tif (this._context) this._context.clear();\n\t}\n\n\tprotected render() {\n\t\tif (this.isDisposed()) return;\n\n\t\tconst gl = this._context.getGl();\n\t\tgl.viewport(0, 0, this._canvas.width, this._canvas.height);\n\t\tgl.clearColor(0.0, 0.0, 0.0, 1.0);\n\t\tgl.clear(gl.COLOR_BUFFER_BIT);\n\n\t\tgl.useProgram(this._program);\n\n\t\tgl.activeTexture(gl.TEXTURE0);\n\t\tgl.bindTexture(gl.TEXTURE_2D, this.getNextTexture());\n\t\tgl.uniform1i(gl.getUniformLocation(this._program, 'slideTexture'), 0);\n\n\t\tgl.bindVertexArray(this._vao);\n\t\tgl.drawArrays(gl.TRIANGLE_STRIP, 0, 4);\n\n\t\tif (this.isAnyLayerActive() || this.isAnyVideoPlaying)\n\t\t\tthis._requestAnimationFrameId = requestAnimationFrame(\n\t\t\t\tthis.render.bind(this),\n\t\t\t);\n\t}\n}\n"]}