{"version":3,"file":"RotateAndScaleDepth.js","sourceRoot":"","sources":["../../../../../../../../../../../TanhX/online/browser/src/slideshow/operation/RotateAndScaleDepth.ts"],"names":[],"mappings":"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","sourcesContent":["/* -*- js-indent-level: 8 -*- */\n\n/*\n * Copyright the Collabora Online contributors.\n *\n * SPDX-License-Identifier: MPL-2.0\n *\n * This Source Code Form is subject to the terms of the Mozilla Public\n * License, v. 2.0. If a copy of the MPL was not distributed with this\n * file, You can obtain one at http://mozilla.org/MPL/2.0/.\n */\n\ndeclare var glMatrix: any;\ndeclare var SlideShow: any;\n\nvar { vec3, mat4 } = glMatrix;\n\nclass RotateAndScaleDepth extends Operation {\n\tprivate axis: vec3 = vec3.create();\n\tprivate origin: vec3 = vec3.create();\n\tprivate angle: number = 0.0;\n\tprivate scale: boolean = false;\n\tprivate mbInterpolate: boolean = false;\n\tprivate mnT0: number = 0.0;\n\tprivate mnT1: number = 0.0;\n\tprivate isDepthByWidth: boolean = true;\n\n\tconstructor(\n\t\taxis: vec3,\n\t\torigin: vec3,\n\t\tangle: number,\n\t\tscale: boolean,\n\t\tmbInterpolate: boolean,\n\t\tmnT0: number,\n\t\tmnT1: number,\n\t\tisDepthByWidth: boolean,\n\t) {\n\t\tsuper();\n\t\tthis.axis = axis;\n\t\tthis.origin = origin;\n\t\tthis.angle = OpsHelper.deg2rad(angle);\n\t\tthis.scale = scale;\n\t\tthis.mbInterpolate = mbInterpolate;\n\t\tthis.mnT0 = mnT0;\n\t\tthis.mnT1 = mnT1;\n\t\tthis.isDepthByWidth = isDepthByWidth;\n\t}\n\n\tpublic interpolate(\n\t\tmatrix: mat4,\n\t\tt: number,\n\t\tSlideWidthScale: number,\n\t\tSlideHeightScale: number,\n\t): mat4 {\n\t\tif (t <= this.mnT0) {\n\t\t\treturn matrix;\n\t\t}\n\t\tif (!this.mbInterpolate || t > this.mnT1) {\n\t\t\tt = this.mnT1;\n\t\t}\n\t\tt = OpsHelper.intervalInter(t, this.mnT0, this.mnT1);\n\t\tconst translationVector = vec3.fromValues(\n\t\t\tSlideWidthScale * this.origin[0],\n\t\t\tSlideHeightScale * this.origin[1],\n\t\t\t(this.isDepthByWidth ? SlideWidthScale : SlideHeightScale) *\n\t\t\t\tthis.origin[2],\n\t\t);\n\t\tconst scaleVector = vec3.fromValues(\n\t\t\tSlideWidthScale * SlideWidthScale,\n\t\t\tSlideHeightScale * SlideHeightScale,\n\t\t\t1,\n\t\t);\n\t\tmat4.translate(matrix, matrix, translationVector);\n\t\tif (this.scale) {\n\t\t\tmat4.scale(matrix, matrix, scaleVector);\n\t\t}\n\t\tmat4.rotate(matrix, matrix, this.angle * t, this.axis);\n\t\tif (this.scale) {\n\t\t\tmat4.scale(\n\t\t\t\tmatrix,\n\t\t\t\tmatrix,\n\t\t\t\tvec3.fromValues(\n\t\t\t\t\t1 / scaleVector[0],\n\t\t\t\t\t1 / scaleVector[1],\n\t\t\t\t\t1 / scaleVector[2],\n\t\t\t\t),\n\t\t\t);\n\t\t}\n\t\tmat4.translate(\n\t\t\tmatrix,\n\t\t\tmatrix,\n\t\t\tvec3.negate(vec3.create(), translationVector),\n\t\t);\n\t\treturn matrix;\n\t}\n}\n\nfunction makeRotateAndScaleDepthByWidth(\n\taxis: vec3,\n\torigin: vec3,\n\tangle: number,\n\tscale: boolean,\n\tmbInterpolate: boolean,\n\tmnT0: number,\n\tmnT1: number,\n) {\n\treturn new RotateAndScaleDepth(\n\t\taxis,\n\t\torigin,\n\t\tangle,\n\t\tscale,\n\t\tmbInterpolate,\n\t\tmnT0,\n\t\tmnT1,\n\t\ttrue,\n\t);\n}\n\nfunction makeRotateAndScaleDepthByHeight(\n\taxis: vec3,\n\torigin: vec3,\n\tangle: number,\n\tscale: boolean,\n\tmbInterpolate: boolean,\n\tmnT0: number,\n\tmnT1: number,\n) {\n\treturn new RotateAndScaleDepth(\n\t\taxis,\n\t\torigin,\n\t\tangle,\n\t\tscale,\n\t\tmbInterpolate,\n\t\tmnT0,\n\t\tmnT1,\n\t\tfalse,\n\t);\n}\n\nSlideShow.makeRotateAndScaleDepthByWidth = makeRotateAndScaleDepthByWidth;\nSlideShow.makeRotateAndScaleDepthByHeight = makeRotateAndScaleDepthByHeight;\n"]}