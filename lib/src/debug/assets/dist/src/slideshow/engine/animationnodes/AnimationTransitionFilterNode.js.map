{"version":3,"file":"AnimationTransitionFilterNode.js","sourceRoot":"","sources":["../../../../../../../../../../../../TanhX/online/browser/src/slideshow/engine/animationnodes/AnimationTransitionFilterNode.ts"],"names":[],"mappings":"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","sourcesContent":["// @ts-strict-ignore\n/* -*- tab-width: 4 -*- */\n\n/*\n * Copyright the Collabora Online contributors.\n *\n * SPDX-License-Identifier: MPL-2.0\n *\n * This Source Code Form is subject to the terms of the Mozilla Public\n * License, v. 2.0. If a copy of the MPL was not distributed with this\n * file, You can obtain one at http://mozilla.org/MPL/2.0/.\n */\n\nclass TransitionFilterInfo {\n\ttransitionType: TransitionType = null;\n\ttransitionSubtype: TransitionSubType = null;\n\tisDirectionForward: boolean = true;\n\tisModeIn: boolean = true;\n\tfadeColor?: string = null;\n\n\tconstructor(\n\t\ttype?: TransitionType,\n\t\tsubtype?: TransitionSubType,\n\t\tisDirectionForward: boolean = true,\n\t\tisModeIn: boolean = true,\n\t\tfadeColor?: string,\n\t) {\n\t\tthis.transitionType = type;\n\t\tthis.transitionSubtype = subtype;\n\t\tthis.isDirectionForward = isDirectionForward;\n\t\tthis.isModeIn = isModeIn;\n\t\tthis.fadeColor = fadeColor;\n\t}\n\n\tstatic fromSlideInfo(slideInfo: SlideInfo): TransitionFilterInfo {\n\t\tconst transitionFilterInfo = new TransitionFilterInfo();\n\t\tif (!slideInfo) return null;\n\n\t\tif (slideInfo.transitionType)\n\t\t\ttransitionFilterInfo.transitionType =\n\t\t\t\tstringToTransitionTypeMap[slideInfo.transitionType];\n\t\tif (slideInfo.transitionSubtype)\n\t\t\ttransitionFilterInfo.transitionSubtype =\n\t\t\t\tstringToTransitionSubTypeMap[slideInfo.transitionSubtype];\n\t\tif (typeof slideInfo.transitionDirection === 'boolean')\n\t\t\ttransitionFilterInfo.isDirectionForward = slideInfo.transitionDirection;\n\t\tif (slideInfo.transitionFadeColor)\n\t\t\ttransitionFilterInfo.fadeColor = slideInfo.transitionFadeColor;\n\n\t\treturn transitionFilterInfo;\n\t}\n}\n\nclass AnimationTransitionFilterNode extends AnimationBaseNode {\n\tprivate eTransitionType: TransitionType;\n\tprivate eTransitionSubType: TransitionSubType;\n\tprivate bIsReverseDirection: boolean = false;\n\tprivate eTransitionMode: TransitionMode;\n\n\tconstructor(\n\t\taNodeInfo: AnimationNodeInfo,\n\t\taParentNode: BaseContainerNode,\n\t\taNodeContext: NodeContext,\n\t) {\n\t\tsuper(aNodeInfo, aParentNode, aNodeContext);\n\t\tthis.sClassName = 'AnimationTransitionFilterNode';\n\t}\n\n\tpublic parseNodeInfo() {\n\t\tsuper.parseNodeInfo();\n\n\t\tlet bIsValidTransition = true;\n\t\tconst aNodeInfo = this.aNodeInfo as TransitionFilterNodeInfo;\n\n\t\t// type property\n\t\tthis.eTransitionType = undefined;\n\t\tif (\n\t\t\taNodeInfo.transitionType &&\n\t\t\tstringToTransitionTypeMap[aNodeInfo.transitionType] in TransitionType\n\t\t) {\n\t\t\tthis.eTransitionType =\n\t\t\t\tstringToTransitionTypeMap[aNodeInfo.transitionType];\n\t\t} else {\n\t\t\tbIsValidTransition = false;\n\t\t\twindow.app.console.log(\n\t\t\t\t'AnimationTransitionFilterNode.parseElement: transition type not valid: ' +\n\t\t\t\t\taNodeInfo.transitionType,\n\t\t\t);\n\t\t}\n\n\t\t// subtype property\n\t\tthis.eTransitionSubType = undefined;\n\t\tif (!aNodeInfo.transitionSubType) aNodeInfo.transitionSubType = 'Default';\n\t\tif (\n\t\t\tstringToTransitionSubTypeMap[aNodeInfo.transitionSubType] in\n\t\t\tTransitionSubType\n\t\t) {\n\t\t\tthis.eTransitionSubType =\n\t\t\t\tstringToTransitionSubTypeMap[aNodeInfo.transitionSubType];\n\t\t} else {\n\t\t\tbIsValidTransition = false;\n\t\t\twindow.app.console.log(\n\t\t\t\t'AnimationTransitionFilterNode.parseElement: transition subtype not valid: ' +\n\t\t\t\t\taNodeInfo.transitionSubType,\n\t\t\t);\n\t\t}\n\n\t\t// if we do not support the requested transition type we fall back to crossfade transition;\n\t\t// note: if we do not provide an alternative transition and we set the state of the animation node to 'invalid'\n\t\t// the animation engine stops itself;\n\t\tif (!bIsValidTransition) {\n\t\t\tthis.eTransitionType = TransitionType.FADE;\n\t\t\tthis.eTransitionSubType = TransitionSubType.CROSSFADE;\n\t\t\twindow.app.console.log(\n\t\t\t\t'AnimationTransitionFilterNode.parseElement: in place of the invalid transition a crossfade transition is used',\n\t\t\t);\n\t\t}\n\n\t\tthis.bIsReverseDirection = aNodeInfo.transitionDirection === 'reverse';\n\n\t\tthis.eTransitionMode = TransitionMode.in;\n\t\tif (\n\t\t\taNodeInfo.transitionMode &&\n\t\t\taNodeInfo.transitionMode in TransitionMode\n\t\t) {\n\t\t\tconst sMode = aNodeInfo.transitionMode as keyof typeof TransitionMode;\n\t\t\tthis.eTransitionMode = TransitionMode[sMode];\n\t\t}\n\t}\n\n\tpublic createActivity(): AnimationActivity {\n\t\tconst aActivityParamSet = this.fillActivityParams();\n\n\t\t// in the 2d context case map any transition to cross-fade\n\t\tif (!this.aNodeContext.aContext.aSlideShowHandler.isGlSupported()) {\n\t\t\tconst bModeIn = this.getTransitionMode() == TransitionMode.in;\n\t\t\treturn createCrossFadeTransition(\n\t\t\t\taActivityParamSet,\n\t\t\t\tthis.getAnimatedElement(),\n\t\t\t\tthis.aNodeContext.aContext.nSlideWidth,\n\t\t\t\tthis.aNodeContext.aContext.nSlideHeight,\n\t\t\t\tbModeIn,\n\t\t\t);\n\t\t}\n\n\t\treturn createShapeTransition(\n\t\t\taActivityParamSet,\n\t\t\tthis.getAnimatedElement(),\n\t\t\tthis.aNodeContext.aContext.nSlideWidth,\n\t\t\tthis.aNodeContext.aContext.nSlideHeight,\n\t\t\tthis,\n\t\t);\n\t}\n\n\tpublic getTransitionType() {\n\t\treturn this.eTransitionType;\n\t}\n\n\tpublic getTransitionSubtype() {\n\t\treturn this.eTransitionSubType;\n\t}\n\n\tpublic getTransitionMode() {\n\t\treturn this.eTransitionMode;\n\t}\n\n\tpublic getReverseDirection() {\n\t\treturn this.bIsReverseDirection;\n\t}\n\n\tpublic info(verbose: boolean = false): string {\n\t\tlet sInfo = super.info(verbose);\n\n\t\tif (verbose) {\n\t\t\tif (this.getTransitionType())\n\t\t\t\tsInfo += '; type: ' + TransitionType[this.getTransitionType()];\n\n\t\t\tif (this.getTransitionSubtype())\n\t\t\t\tsInfo += '; subtype: ' + TransitionSubType[this.getTransitionSubtype()];\n\n\t\t\tsInfo += '; is reverse direction: ' + this.getReverseDirection();\n\n\t\t\tsInfo += '; mode: ' + TransitionMode[this.getTransitionMode()];\n\t\t}\n\t\treturn sInfo;\n\t}\n}\n"]}