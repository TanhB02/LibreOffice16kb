{"version":3,"file":"SlideAnimations.js","sourceRoot":"","sources":["../../../../../../../../../../../TanhX/online/browser/src/slideshow/engine/SlideAnimations.ts"],"names":[],"mappings":"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","sourcesContent":["// @ts-strict-ignore\n/* -*- tab-width: 4 -*- */\n/*\n * Copyright the Collabora Online contributors.\n *\n * SPDX-License-Identifier: MPL-2.0\n *\n * This Source Code Form is subject to the terms of the Mozilla Public\n * License, v. 2.0. If a copy of the MPL was not distributed with this\n * file, You can obtain one at http://mozilla.org/MPL/2.0/.\n */\n\ntype AnimationNodeMap = Map<string, BaseNode>;\n\nenum AnimationNodeType {\n\tCustom,\n\tPar,\n\tSeq,\n\tIterate,\n\tAnimate,\n\tSet,\n\tAnimateMotion,\n\tAnimateColor,\n\tAnimateTransform,\n\tTransitionFilter,\n\tAudio,\n\tCommand,\n}\n\nfunction getAnimationNodeType(aNodeInfo: AnimationNodeInfo) {\n\tconst typeStr = aNodeInfo.nodeName as keyof typeof AnimationNodeType;\n\treturn AnimationNodeType[typeStr];\n}\n\nfunction getNodeChildren(aNode: ContainerNodeInfo): Array<AnimationNodeInfo> {\n\treturn aNode.children || [];\n}\n\nfunction isAttributeSupported(aNodeInfo: AnimateNodeInfo) {\n\tif (!aNodeInfo.attributeName) {\n\t\tconsole.error('slideshow: missing attributeName');\n\t\treturn false;\n\t}\n\t// return true;\n\treturn AnimatedElement.SupportedProperties.has(\n\t\taNodeInfo.attributeName.toLowerCase(),\n\t);\n}\n\nfunction isTransformSupported(aNodeInfo: AnimateTransformNodeInfo) {\n\tif (!aNodeInfo.transformType) {\n\t\tconsole.error('slideshow: missing transformType');\n\t\treturn false;\n\t}\n\t// return true;\n\treturn AnimatedElement.SupportedTransformations.has(\n\t\taNodeInfo.transformType.toLowerCase(),\n\t);\n}\n\nfunction createAnimationTree(\n\taAnimationRoot: AnimationNodeInfo,\n\taNodeContext: NodeContext,\n): BaseNode {\n\treturn createAnimationNode(aAnimationRoot, null, aNodeContext);\n}\n\nfunction createAnimationNode(\n\taNodeInfo: AnimationNodeInfo,\n\taParentNode: BaseContainerNode,\n\taNodeContext: NodeContext,\n): BaseNode {\n\tassert(aNodeInfo, 'createAnimationNode: invalid animation node');\n\n\tconst eAnimationNodeType = getAnimationNodeType(aNodeInfo);\n\tlet aCreatedNode = null;\n\tlet aCreatedContainer = null;\n\n\tswitch (eAnimationNodeType) {\n\t\tcase AnimationNodeType.Par:\n\t\t\taCreatedNode = aCreatedContainer = new ParallelTimeContainer(\n\t\t\t\taNodeInfo,\n\t\t\t\taParentNode,\n\t\t\t\taNodeContext,\n\t\t\t);\n\t\t\tbreak;\n\t\tcase AnimationNodeType.Iterate:\n\t\t\twindow.app.console.log('createAnimationNode: Iterate not implemented');\n\t\t\treturn null;\n\t\tcase AnimationNodeType.Seq:\n\t\t\taCreatedNode = aCreatedContainer = new SequentialTimeContainer(\n\t\t\t\taNodeInfo,\n\t\t\t\taParentNode,\n\t\t\t\taNodeContext,\n\t\t\t);\n\t\t\tbreak;\n\t\tcase AnimationNodeType.Animate:\n\t\t\tif (isAttributeSupported(aNodeInfo)) {\n\t\t\t\taCreatedNode = new PropertyAnimationNode(\n\t\t\t\t\taNodeInfo,\n\t\t\t\t\taParentNode,\n\t\t\t\t\taNodeContext,\n\t\t\t\t);\n\t\t\t\tbreak;\n\t\t\t} else {\n\t\t\t\tconst attrName = (aNodeInfo as AnimateNodeInfo).attributeName;\n\t\t\t\twindow.app.console.log(\n\t\t\t\t\t`createAnimationNode: PropertyAnimationNode: attribute '${attrName}' not supported`,\n\t\t\t\t);\n\t\t\t\treturn null;\n\t\t\t}\n\t\tcase AnimationNodeType.Set:\n\t\t\tif (isAttributeSupported(aNodeInfo)) {\n\t\t\t\taCreatedNode = new AnimationSetNode(\n\t\t\t\t\taNodeInfo,\n\t\t\t\t\taParentNode,\n\t\t\t\t\taNodeContext,\n\t\t\t\t);\n\t\t\t\tbreak;\n\t\t\t} else {\n\t\t\t\tconst attrName = (aNodeInfo as AnimateNodeInfo).attributeName;\n\t\t\t\twindow.app.console.log(\n\t\t\t\t\t`createAnimationNode: AnimationSetNode: attribute '${attrName}' not supported`,\n\t\t\t\t);\n\t\t\t\treturn null;\n\t\t\t}\n\t\tcase AnimationNodeType.AnimateMotion:\n\t\t\taCreatedNode = new AnimationPathMotionNode(\n\t\t\t\taNodeInfo,\n\t\t\t\taParentNode,\n\t\t\t\taNodeContext,\n\t\t\t);\n\t\t\t// window.app.console.log(\n\t\t\t// \t'createAnimationNode: AnimateMotion not implemented',\n\t\t\t// );\n\t\t\t//return null;\n\t\t\tbreak;\n\t\tcase AnimationNodeType.AnimateColor:\n\t\t\taCreatedNode = new AnimationColorNode(\n\t\t\t\taNodeInfo,\n\t\t\t\taParentNode,\n\t\t\t\taNodeContext,\n\t\t\t);\n\t\t\tbreak;\n\t\tcase AnimationNodeType.AnimateTransform:\n\t\t\tif (isTransformSupported(aNodeInfo as AnimateTransformNodeInfo)) {\n\t\t\t\taCreatedNode = new AnimationTransformNode(\n\t\t\t\t\taNodeInfo,\n\t\t\t\t\taParentNode,\n\t\t\t\t\taNodeContext,\n\t\t\t\t);\n\t\t\t\tbreak;\n\t\t\t} else {\n\t\t\t\tconst transfType = (aNodeInfo as AnimateTransformNodeInfo)\n\t\t\t\t\t.transformType;\n\t\t\t\twindow.app.console.log(\n\t\t\t\t\t`createAnimationNode: AnimationTransformNode: transform '${transfType}' not supported`,\n\t\t\t\t);\n\t\t\t\treturn null;\n\t\t\t}\n\t\tcase AnimationNodeType.TransitionFilter: {\n\t\t\taCreatedNode = new AnimationTransitionFilterNode(\n\t\t\t\taNodeInfo,\n\t\t\t\taParentNode,\n\t\t\t\taNodeContext,\n\t\t\t);\n\t\t\tbreak;\n\t\t}\n\t\tcase AnimationNodeType.Audio:\n\t\t\twindow.app.console.log('createAnimationNode: Audio not implemented');\n\t\t\treturn null;\n\t\tcase AnimationNodeType.Command:\n\t\t\twindow.app.console.log('createAnimationNode: Command not implemented');\n\t\t\treturn null;\n\t\tdefault:\n\t\t\twindow.app.console.log(\n\t\t\t\t'createAnimationNode: invalid Animation Node Type: ' +\n\t\t\t\t\teAnimationNodeType,\n\t\t\t);\n\t\t\treturn null;\n\t}\n\n\tif (aCreatedContainer) {\n\t\tconst aChildrenArray = getNodeChildren(aNodeInfo);\n\t\tfor (let i = 0; i < aChildrenArray.length; ++i) {\n\t\t\tif (\n\t\t\t\t!createChildNode(aChildrenArray[i], aCreatedContainer, aNodeContext)\n\t\t\t) {\n\t\t\t\t// Discard the whole effect except animation node is a Set node and\n\t\t\t\t// it's not the only node included into the effect.\n\t\t\t\tif (\n\t\t\t\t\t!(\n\t\t\t\t\t\taChildrenArray.length !== 1 &&\n\t\t\t\t\t\tgetAnimationNodeType(aChildrenArray[i]) === AnimationNodeType.Set\n\t\t\t\t\t)\n\t\t\t\t) {\n\t\t\t\t\taCreatedContainer.removeAllChildrenNodes();\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\treturn aCreatedNode;\n}\n\nfunction createChildNode(\n\taNodeInfo: AnimationNodeInfo,\n\taParentNode: BaseContainerNode,\n\taNodeContext: NodeContext,\n): boolean {\n\tconst aChildNode = createAnimationNode(aNodeInfo, aParentNode, aNodeContext);\n\n\tif (!aChildNode) {\n\t\twindow.app.console.log('createChildNode: child node creation failed');\n\t\treturn false;\n\t} else {\n\t\tif (aChildNode.isContainer() && !aChildNode.isMainSequenceRootNode()) {\n\t\t\tconst aContainer = aChildNode as BaseContainerNode;\n\t\t\t// an empty effect should be removed, but sibling effects shouldn't, so don't report failure\n\t\t\tif (aContainer.isEmpty()) {\n\t\t\t\twindow.app.console.log(\n\t\t\t\t\t`createChildNode: child-node(${aContainer.getId()}) is empty`,\n\t\t\t\t);\n\t\t\t\treturn true; // neither append, nor fail\n\t\t\t}\n\t\t}\n\t\taParentNode.appendChildNode(aChildNode);\n\t\treturn true;\n\t}\n}\n\nclass SlideAnimations {\n\tprivate aRootNode: BaseNode;\n\tprivate aContext: NodeContext;\n\tprivate aSlideShowHandler: SlideShowHandler;\n\tprivate aAnimationNodeMap: AnimationNodeMap;\n\tprivate aAnimatedElementMap: Map<string, AnimatedElement>;\n\tprivate aSourceEventElementMap: Map<string, SourceEventElement>;\n\tprivate aNextEffectEventArray: NextEffectEventArray;\n\tprivate aInteractiveAnimationSequenceMap: InteractiveAnimationSequenceMap;\n\tprivate aEventMultiplexer: EventMultiplexer;\n\tprivate bElementsParsed: boolean;\n\n\tconstructor(aSlideShowContext: SlideShowContext, metaSlide: MetaSlide) {\n\t\tthis.aContext = new NodeContext(aSlideShowContext);\n\t\tthis.aSlideShowHandler = aSlideShowContext.aSlideShowHandler;\n\t\tthis.aAnimationNodeMap = new Map();\n\t\tthis.aAnimatedElementMap = new Map();\n\t\tthis.aSourceEventElementMap = new Map();\n\t\tthis.aNextEffectEventArray = new NextEffectEventArray();\n\t\tthis.aInteractiveAnimationSequenceMap = new Map();\n\t\tthis.aEventMultiplexer = new EventMultiplexer(\n\t\t\taSlideShowContext.aTimerEventQueue,\n\t\t);\n\t\tthis.aRootNode = null;\n\t\tthis.bElementsParsed = false;\n\n\t\tthis.aContext.metaSlide = metaSlide;\n\t\tthis.aContext.aAnimationNodeMap = this.aAnimationNodeMap;\n\t\tthis.aContext.aAnimatedElementMap = this.aAnimatedElementMap;\n\t\tthis.aContext.aSourceEventElementMap = this.aSourceEventElementMap;\n\t}\n\n\tpublic importAnimations(aAnimationRoot: AnimationNodeInfo): boolean {\n\t\tif (!aAnimationRoot) return false;\n\n\t\tthis.aRootNode = createAnimationTree(aAnimationRoot, this.aContext);\n\t\treturn !!this.aRootNode;\n\t}\n\n\tpublic parseInfo() {\n\t\tif (!this.aRootNode) return false;\n\n\t\tthis.aRootNode.parseNodeInfo();\n\t\tthis.bElementsParsed = true;\n\t}\n\n\tpublic elementsParsed() {\n\t\treturn this.bElementsParsed;\n\t}\n\n\tpublic info(verbose: boolean) {\n\t\tif (this.aRootNode) return this.aRootNode.info(verbose);\n\t}\n\n\tisFirstRun() {\n\t\treturn this.aContext.bFirstRun;\n\t}\n\n\tisAnimated() {\n\t\tif (!this.bElementsParsed) return false;\n\n\t\treturn this.aRootNode.hasPendingAnimation();\n\t}\n\n\tstart() {\n\t\tif (!this.bElementsParsed) return false;\n\n\t\tthis.chargeSourceEvents();\n\t\tthis.chargeInterAnimEvents();\n\n\t\tthis.aSlideShowHandler.setSlideEvents(\n\t\t\tthis.aNextEffectEventArray,\n\t\t\tthis.aInteractiveAnimationSequenceMap,\n\t\t\tthis.aEventMultiplexer,\n\t\t);\n\n\t\tif (this.aContext.bFirstRun === undefined) this.aContext.bFirstRun = true;\n\t\telse if (this.aContext.bFirstRun) this.aContext.bFirstRun = false;\n\n\t\t// init all nodes\n\t\tthis.aContext.bIsInvalid = !this.aRootNode.init();\n\t\tif (this.aContext.bIsInvalid) {\n\t\t\tANIMDBG.print('SlideAnimationsthis.start: aContext.bIsInvalid');\n\t\t\treturn false;\n\t\t}\n\n\t\t// resolve root node\n\t\treturn this.aRootNode.resolve();\n\t}\n\n\tend(bLeftEffectsSkipped: boolean) {\n\t\tif (!this.bElementsParsed) return; // no animations there\n\n\t\t// end root node\n\t\tthis.aRootNode.deactivate();\n\t\tthis.aRootNode.end();\n\n\t\tif (bLeftEffectsSkipped && this.isFirstRun()) {\n\t\t\t// in case this is the first run and left events have been skipped\n\t\t\t// some next effect events for the slide could not be collected\n\t\t\t// so the next time we should behave as it was the first run again\n\t\t\tthis.aContext.bFirstRun = undefined;\n\t\t} else if (this.isFirstRun()) {\n\t\t\tthis.aContext.bFirstRun = false;\n\t\t}\n\n\t\tthis.aContext.bIsInvalid = false;\n\t}\n\n\tdispose() {\n\t\tif (this.aRootNode) {\n\t\t\tthis.aRootNode.dispose();\n\t\t}\n\t\tif (this.aEventMultiplexer) {\n\t\t\tthis.aEventMultiplexer.clear();\n\t\t}\n\t}\n\n\tclearNextEffectEvents() {\n\t\tANIMDBG.print('SlideAnimations.clearNextEffectEvents');\n\t\tthis.aNextEffectEventArray.clear();\n\t\tthis.aContext.bFirstRun = undefined;\n\t}\n\n\tchargeSourceEvents() {\n\t\tthis.aSourceEventElementMap.forEach((aSourceEventElement) => {\n\t\t\taSourceEventElement.charge();\n\t\t});\n\t}\n\n\tchargeInterAnimEvents() {\n\t\tthis.aInteractiveAnimationSequenceMap.forEach(\n\t\t\t(aInteractiveAnimationSequence) => {\n\t\t\t\taInteractiveAnimationSequence.chargeEvents();\n\t\t\t},\n\t\t);\n\t}\n\n\tpublic getAnimationsTree() {\n\t\treturn this.aRootNode;\n\t}\n\n\tpublic getAnimatedElementMap(): Map<string, AnimatedElement> {\n\t\treturn this.aAnimatedElementMap;\n\t}\n\n\tpublic get eventMultiplexer(): EventMultiplexer {\n\t\treturn this.aEventMultiplexer;\n\t}\n}\n"]}