{"version":3,"file":"ActivityBase.js","sourceRoot":"","sources":["../../../../../../../../../../../../TanhX/online/browser/src/slideshow/engine/activities/ActivityBase.ts"],"names":[],"mappings":"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","sourcesContent":["// @ts-strict-ignore\n/* -*- js-indent-level: 8 -*- */\n\n/*\n * Copyright the Collabora Online contributors.\n *\n * SPDX-License-Identifier: MPL-2.0\n *\n * This Source Code Form is subject to the terms of the Mozilla Public\n * License, v. 2.0. If a copy of the MPL was not distributed with this\n * file, You can obtain one at http://mozilla.org/MPL/2.0/.\n */\n\nabstract class ActivityBase extends AnimationActivity {\n\tprivate aTargetElement: null;\n\tprivate aEndEvent: DelayEvent;\n\tprivate aTimerEventQueue: TimerEventQueue;\n\tprivate nRepeats: number;\n\tprivate nAccelerationFraction: number;\n\tprivate nDecelerationFraction: number;\n\tprivate bAutoReverse: boolean;\n\tprivate bFirstPerformCall: boolean;\n\tprivate bIsActive: boolean;\n\n\tprotected constructor(aCommonParamSet: ActivityParamSet) {\n\t\tsuper();\n\n\t\tthis.aTargetElement = null;\n\t\tthis.aEndEvent = aCommonParamSet.aEndEvent;\n\t\tthis.aTimerEventQueue = aCommonParamSet.aTimerEventQueue;\n\t\tthis.nRepeats = aCommonParamSet.nRepeatCount;\n\t\tthis.nAccelerationFraction = aCommonParamSet.nAccelerationFraction;\n\t\tthis.nDecelerationFraction = aCommonParamSet.nDecelerationFraction;\n\t\tthis.bAutoReverse = aCommonParamSet.bAutoReverse;\n\n\t\tthis.bFirstPerformCall = true;\n\t\tthis.bIsActive = true;\n\t}\n\n\tpublic activate(aEndEvent: DelayEvent) {\n\t\tthis.aEndEvent = aEndEvent;\n\t\tthis.bFirstPerformCall = true;\n\t\tthis.bIsActive = true;\n\t}\n\n\tpublic dispose() {\n\t\t// deactivate\n\t\tthis.bIsActive = false;\n\n\t\t// dispose event\n\t\tif (this.aEndEvent) this.aEndEvent.dispose();\n\n\t\tthis.aEndEvent = null;\n\t}\n\n\tpublic perform() {\n\t\t// still active?\n\t\tif (!this.isActive()) return false; // no, early exit.\n\n\t\tassert(\n\t\t\t!this.bFirstPerformCall,\n\t\t\t'ActivityBase.perform: assertion (!this.FirstPerformCall) failed',\n\t\t);\n\n\t\treturn true;\n\t}\n\n\tpublic calcTimeLag() {\n\t\t// TODO: implement different init process!\n\t\tif (this.isActive() && this.bFirstPerformCall) {\n\t\t\tthis.bFirstPerformCall = false;\n\n\t\t\t// notify derived classes that we're\n\t\t\t// starting now\n\t\t\tthis.startAnimation();\n\t\t}\n\t\treturn 0.0;\n\t}\n\n\tpublic isActive() {\n\t\treturn this.bIsActive;\n\t}\n\n\tpublic isDisposed() {\n\t\treturn !this.bIsActive && !this.aEndEvent;\n\t}\n\n\tpublic dequeued() {\n\t\tif (!this.isActive()) this.endAnimation();\n\t}\n\n\tpublic setTargets(aTargetElement: any) {\n\t\tassert(\n\t\t\taTargetElement,\n\t\t\t'ActivityBase.setTargets: target element is not valid',\n\t\t);\n\n\t\tthis.aTargetElement = aTargetElement;\n\t}\n\n\t// public abstract startAnimation(): void;\n\tpublic startAnimation(): void {\n\t\tthrow 'ActivityBase.startAnimation: abstract method invoked';\n\t}\n\n\tpublic abstract endAnimation(): void;\n\t// public endAnimation(): void {\n\t// \t// TODO throw abstract\n\t// }\n\n\tpublic endActivity() {\n\t\t// this is a regular activity end\n\t\tthis.bIsActive = false;\n\n\t\t// Activity is ending, queue event, then\n\t\tif (this.aEndEvent) this.aTimerEventQueue.addEvent(this.aEndEvent);\n\n\t\tthis.aEndEvent = null;\n\t}\n\n\tpublic calcAcceleratedTime(nT: number) {\n\t\t// Handle acceleration/deceleration\n\n\t\t// clamp nT to permissible [0,1] range\n\t\tnT = clampN(nT, 0.0, 1.0);\n\n\t\t// take acceleration/deceleration into account. if the sum\n\t\t// of nAccelerationFraction and nDecelerationFraction\n\t\t// exceeds 1.0, ignore both (that's according to SMIL spec)\n\t\tif (\n\t\t\t(this.nAccelerationFraction > 0.0 || this.nDecelerationFraction > 0.0) &&\n\t\t\tthis.nAccelerationFraction + this.nDecelerationFraction <= 1.0\n\t\t) {\n\t\t\tconst nC =\n\t\t\t\t1.0 -\n\t\t\t\t0.5 * this.nAccelerationFraction -\n\t\t\t\t0.5 * this.nDecelerationFraction;\n\n\t\t\t// this variable accumulates the new time value\n\t\t\tlet nTPrime = 0.0;\n\n\t\t\tif (nT < this.nAccelerationFraction) {\n\t\t\t\tnTPrime += (0.5 * nT * nT) / this.nAccelerationFraction; // partial first interval\n\t\t\t} else {\n\t\t\t\tnTPrime += 0.5 * this.nAccelerationFraction; // full first interval\n\n\t\t\t\tif (nT <= 1.0 - this.nDecelerationFraction) {\n\t\t\t\t\tnTPrime += nT - this.nAccelerationFraction; // partial second interval\n\t\t\t\t} else {\n\t\t\t\t\tnTPrime +=\n\t\t\t\t\t\t1.0 - this.nAccelerationFraction - this.nDecelerationFraction; // full second interval\n\n\t\t\t\t\tconst nTRelative = nT - 1.0 + this.nDecelerationFraction;\n\n\t\t\t\t\tnTPrime +=\n\t\t\t\t\t\tnTRelative -\n\t\t\t\t\t\t(0.5 * nTRelative * nTRelative) / this.nDecelerationFraction;\n\t\t\t\t}\n\t\t\t}\n\t\t\t// normalize, and assign to work variable\n\t\t\tnT = nTPrime / nC;\n\t\t}\n\t\treturn nT;\n\t}\n\n\tpublic getEventQueue() {\n\t\treturn this.aTimerEventQueue;\n\t}\n\n\tpublic getTargetElement() {\n\t\treturn this.aTargetElement;\n\t}\n\n\tpublic isRepeatCountValid() {\n\t\treturn !!this.nRepeats; // first ! convert to bool\n\t}\n\n\tpublic getRepeatCount() {\n\t\treturn this.nRepeats;\n\t}\n\n\tpublic isAutoReverse() {\n\t\treturn this.bAutoReverse;\n\t}\n\n\tpublic end() {\n\t\tif (!this.isActive() || this.isDisposed()) return;\n\n\t\t// assure animation is started:\n\t\tif (this.bFirstPerformCall) {\n\t\t\tthis.bFirstPerformCall = false;\n\t\t\t// notify derived classes that we're starting now\n\t\t\tthis.startAnimation();\n\t\t}\n\n\t\tthis.performEnd();\n\t\tthis.endAnimation();\n\t\tthis.endActivity();\n\t}\n\n\tpublic abstract performEnd(): void;\n\t// public performEnd(): void {\n\t// \t// TODO throw abstract\n\t// }\n}\n"]}