{"version":3,"file":"ActivityFactory.js","sourceRoot":"","sources":["../../../../../../../../../../../TanhX/online/browser/src/slideshow/engine/ActivityFactory.ts"],"names":[],"mappings":"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","sourcesContent":["// @ts-strict-ignore\n/* -*- tab-width: 4 -*- */\n/*\n * Copyright the Collabora Online contributors.\n *\n * SPDX-License-Identifier: MPL-2.0\n *\n * This Source Code Form is subject to the terms of the Mozilla Public\n * License, v. 2.0. If a copy of the MPL was not distributed with this\n * file, You can obtain one at http://mozilla.org/MPL/2.0/.\n */\n\nfunction createActivity(\n\taActivityParamSet: ActivityParamSet,\n\taAnimationNode: AnimationBaseNode3,\n\taAnimation: AnimationBase,\n\taInterpolator: PropertyInterpolatorType,\n): AnimationActivity {\n\tconst eCalcMode = aAnimationNode.getCalcMode();\n\n\tconst sAttributeName = aAnimationNode.getAttributeName();\n\tconst sKey = sAttributeName as PropertyGetterSetterMapKeyType;\n\tconst aAttributeProp = aPropertyGetterSetterMap[sKey];\n\n\tconst eValueType: PropertyValueType = aAttributeProp['type'];\n\n\t// do we need to get an interpolator ?\n\tif (!aInterpolator) {\n\t\taInterpolator = PropertyInterpolator.getInterpolator(eValueType);\n\t}\n\n\t// is it cumulative ?\n\tconst bAccumulate =\n\t\taAnimationNode.getAccumulate() === AccumulateMode.Sum &&\n\t\t!(\n\t\t\teValueType === PropertyValueType.Bool ||\n\t\t\teValueType === PropertyValueType.String ||\n\t\t\teValueType === PropertyValueType.Enum\n\t\t);\n\n\tif (aAnimationNode.getFormula()) {\n\t\tlet sFormula: string = aAnimationNode.getFormula();\n\t\tconst reMath = /abs|sqrt|asin|acos|atan|sin|cos|tan|exp|log|min|max/g;\n\t\tsFormula = sFormula.replace(reMath, 'Math.$&');\n\t\tsFormula = sFormula.replace(/pi(?!\\w)/g, 'Math.PI');\n\t\tsFormula = sFormula.replace(/e(?!\\w)/g, 'Math.E');\n\t\tsFormula = sFormula.replace(/\\$/g, '__PARAM0__');\n\n\t\tconst aAnimatedElement = aAnimationNode.getAnimatedElement();\n\t\tconst aBBox = aAnimatedElement.getBaseBBox();\n\n\t\t// the following variable are used for evaluating sFormula\n\t\t/* eslint-disable no-unused-vars */\n\t\tconst width = aBBox.width / aActivityParamSet.nSlideWidth;\n\t\tconst height = aBBox.height / aActivityParamSet.nSlideHeight;\n\t\tconst x = (aBBox.x + aBBox.width / 2) / aActivityParamSet.nSlideWidth;\n\t\tconst y = (aBBox.y + aBBox.height / 2) / aActivityParamSet.nSlideHeight;\n\n\t\taActivityParamSet.aFormula = function (__PARAM0__: any) {\n\t\t\treturn eval(sFormula);\n\t\t};\n\t\t/* eslint-enable no-unused-vars */\n\t}\n\n\taActivityParamSet.aDiscreteTimes = aAnimationNode.getKeyTimes();\n\n\t// do we have a value list ?\n\tconst aValueSet = aAnimationNode.getValues();\n\tconst nValueSetSize = aValueSet.length;\n\n\tif (nValueSetSize != 0) {\n\t\t// Value list activity\n\t\tif (aActivityParamSet.aDiscreteTimes.length == 0) {\n\t\t\tfor (let i = 0; i < nValueSetSize; ++i)\n\t\t\t\taActivityParamSet.aDiscreteTimes.push(i / nValueSetSize);\n\t\t}\n\n\t\tswitch (eCalcMode) {\n\t\t\tcase CalcMode.Discrete:\n\t\t\t\taActivityParamSet.aWakeupEvent = new WakeupEvent(\n\t\t\t\t\taActivityParamSet.aTimerEventQueue.getTimer(),\n\t\t\t\t\taActivityParamSet.aActivityQueue,\n\t\t\t\t);\n\n\t\t\t\treturn createValueListActivity(\n\t\t\t\t\taActivityParamSet,\n\t\t\t\t\taAnimationNode,\n\t\t\t\t\taAnimation,\n\t\t\t\t\taInterpolator,\n\t\t\t\t\tDiscreteValueListActivity,\n\t\t\t\t\tbAccumulate,\n\t\t\t\t\teValueType,\n\t\t\t\t);\n\t\t\tdefault:\n\t\t\t\twindow.app.console.log(\n\t\t\t\t\t'createActivity: unexpected calculation mode: ' + CalcMode[eCalcMode],\n\t\t\t\t);\n\t\t\t// FALLTHROUGH intended\n\t\t\tcase CalcMode.Paced:\n\t\t\tcase CalcMode.Spline:\n\t\t\tcase CalcMode.Linear:\n\t\t\t\treturn createValueListActivity(\n\t\t\t\t\taActivityParamSet,\n\t\t\t\t\taAnimationNode,\n\t\t\t\t\taAnimation,\n\t\t\t\t\taInterpolator,\n\t\t\t\t\tLinearValueListActivity,\n\t\t\t\t\tbAccumulate,\n\t\t\t\t\teValueType,\n\t\t\t\t);\n\t\t}\n\t} else {\n\t\t// FromToBy activity\n\t\tswitch (eCalcMode) {\n\t\t\tcase CalcMode.Discrete:\n\t\t\t\taActivityParamSet.aWakeupEvent = new WakeupEvent(\n\t\t\t\t\taActivityParamSet.aTimerEventQueue.getTimer(),\n\t\t\t\t\taActivityParamSet.aActivityQueue,\n\t\t\t\t);\n\t\t\t\treturn createFromToByActivity(\n\t\t\t\t\taActivityParamSet,\n\t\t\t\t\taAnimationNode,\n\t\t\t\t\taAnimation,\n\t\t\t\t\taInterpolator,\n\t\t\t\t\tDiscreteFromToByActivity,\n\t\t\t\t\tbAccumulate,\n\t\t\t\t\teValueType,\n\t\t\t\t);\n\n\t\t\tdefault:\n\t\t\t\twindow.app.console.log(\n\t\t\t\t\t'createActivity: unexpected calculation mode: ' + CalcMode[eCalcMode],\n\t\t\t\t);\n\t\t\t// FALLTHROUGH intended\n\t\t\tcase CalcMode.Paced:\n\t\t\tcase CalcMode.Spline:\n\t\t\tcase CalcMode.Linear:\n\t\t\t\treturn createFromToByActivity(\n\t\t\t\t\taActivityParamSet,\n\t\t\t\t\taAnimationNode,\n\t\t\t\t\taAnimation,\n\t\t\t\t\taInterpolator,\n\t\t\t\t\tLinearFromToByActivity,\n\t\t\t\t\tbAccumulate,\n\t\t\t\t\teValueType,\n\t\t\t\t);\n\t\t}\n\t}\n}\n\nfunction createValueListActivity(\n\taActivityParamSet: ActivityParamSet,\n\taAnimationNode: AnimationBaseNode3,\n\taAnimation: AnimationBase,\n\taInterpolator: PropertyInterpolatorType,\n\tValueListActivityCtor: ValueListActivityCtorType,\n\tbAccumulate: boolean,\n\teValueType: PropertyValueType,\n): AnimationActivity {\n\tconst aAnimatedElement = aAnimationNode.getAnimatedElement();\n\tconst aOperatorSet = aOperatorSetMap.get(eValueType);\n\tassert(aOperatorSet, 'createValueListActivity: no operator set found');\n\n\tconst aValueSet = aAnimationNode.getValues();\n\n\tconst aValueList: any[] = [];\n\n\textractAttributeValues(\n\t\teValueType,\n\t\taValueList,\n\t\taValueSet,\n\t\taAnimatedElement.getBaseBBox(),\n\t\taActivityParamSet.nSlideWidth,\n\t\taActivityParamSet.nSlideHeight,\n\t);\n\n\tfor (let i = 0; i < aValueList.length; ++i) {\n\t\tANIMDBG.print(\n\t\t\t'createValueListActivity: value[' + i + '] = ' + aValueList[i],\n\t\t);\n\t}\n\n\treturn new ValueListActivityCtor(\n\t\taValueList,\n\t\taActivityParamSet,\n\t\taAnimation,\n\t\taInterpolator,\n\t\taOperatorSet,\n\t\tbAccumulate,\n\t);\n}\n\nfunction createFromToByActivity(\n\taActivityParamSet: ActivityParamSet,\n\taAnimationNode: AnimationBaseNode3,\n\taAnimation: any,\n\taInterpolator: PropertyInterpolatorType,\n\tClassTemplateInstance: FromToByActivityCtorType,\n\tbAccumulate: boolean,\n\teValueType: PropertyValueType,\n) {\n\tconst aAnimatedElement = aAnimationNode.getAnimatedElement();\n\tconst aOperatorSet = aOperatorSetMap.get(eValueType);\n\tassert(aOperatorSet, 'createFromToByActivity: no operator set found');\n\n\tconst aValueSet = [];\n\taValueSet[0] = aAnimationNode.getFromValue();\n\taValueSet[1] = aAnimationNode.getToValue();\n\taValueSet[2] = aAnimationNode.getByValue();\n\n\tANIMDBG.print(\n\t\t'createFromToByActivity: value type: ' +\n\t\t\tPropertyValueType[eValueType] +\n\t\t\t', aFrom = ' +\n\t\t\taValueSet[0] +\n\t\t\t', aTo = ' +\n\t\t\taValueSet[1] +\n\t\t\t', aBy = ' +\n\t\t\taValueSet[2],\n\t);\n\n\tconst aValueList: any[] = [];\n\n\textractAttributeValues(\n\t\teValueType,\n\t\taValueList,\n\t\taValueSet,\n\t\taAnimatedElement.getBaseBBox(),\n\t\taActivityParamSet.nSlideWidth,\n\t\taActivityParamSet.nSlideHeight,\n\t);\n\n\tANIMDBG.print(\n\t\t'createFromToByActivity: ' +\n\t\t\t', aFrom = ' +\n\t\t\taValueList[0] +\n\t\t\t', aTo = ' +\n\t\t\taValueList[1] +\n\t\t\t', aBy = ' +\n\t\t\taValueList[2],\n\t);\n\n\treturn new ClassTemplateInstance(\n\t\taValueList[0],\n\t\taValueList[1],\n\t\taValueList[2],\n\t\taActivityParamSet,\n\t\taAnimation,\n\t\taInterpolator,\n\t\taOperatorSet,\n\t\tbAccumulate,\n\t);\n}\n\nfunction extractAttributeValues(\n\teValueType: PropertyValueType,\n\taValueList: any[],\n\taValueSet: any[],\n\taBBox: DOMRect,\n\tnSlideWidth: number,\n\tnSlideHeight: number,\n) {\n\tlet i: number;\n\tswitch (eValueType) {\n\t\tcase PropertyValueType.Number:\n\t\t\tevalValuesAttribute(\n\t\t\t\taValueList,\n\t\t\t\taValueSet,\n\t\t\t\taBBox,\n\t\t\t\tnSlideWidth,\n\t\t\t\tnSlideHeight,\n\t\t\t);\n\t\t\tbreak;\n\t\tcase PropertyValueType.Bool:\n\t\t\tfor (i = 0; i < aValueSet.length; ++i) {\n\t\t\t\tconst aValue = booleanParser(aValueSet[i]);\n\t\t\t\taValueList.push(aValue);\n\t\t\t}\n\t\t\tbreak;\n\t\tcase PropertyValueType.String:\n\t\t\tfor (i = 0; i < aValueSet.length; ++i) {\n\t\t\t\taValueList.push(aValueSet[i]);\n\t\t\t}\n\t\t\tbreak;\n\t\tcase PropertyValueType.Enum:\n\t\t\tfor (i = 0; i < aValueSet.length; ++i) {\n\t\t\t\taValueList.push(aValueSet[i]);\n\t\t\t}\n\t\t\tbreak;\n\t\tcase PropertyValueType.Color:\n\t\t\tfor (i = 0; i < aValueSet.length; ++i) {\n\t\t\t\tconst aValue = colorParser(aValueSet[i]);\n\t\t\t\taValueList.push(aValue);\n\t\t\t}\n\t\t\tbreak;\n\t\tcase PropertyValueType.TupleNumber:\n\t\t\tfor (i = 0; i < aValueSet.length; ++i) {\n\t\t\t\tif (typeof aValueSet[i] === 'string') {\n\t\t\t\t\tconst aTuple = aValueSet[i].split(',');\n\t\t\t\t\tconst aValue: number[] = [];\n\t\t\t\t\tevalValuesAttribute(aValue, aTuple, aBBox, nSlideWidth, nSlideHeight);\n\t\t\t\t\taValueList.push(aValue);\n\t\t\t\t} else {\n\t\t\t\t\taValueList.push(undefined);\n\t\t\t\t}\n\t\t\t}\n\t\t\tbreak;\n\t\tdefault:\n\t\t\twindow.app.console.log(\n\t\t\t\t'createValueListActivity: unexpected value type: ' + eValueType,\n\t\t\t);\n\t}\n}\n\nfunction evalValuesAttribute(\n\taValueList: number[],\n\taValueSet: any[],\n\taBBox: DOMRect,\n\tnSlideWidth: number,\n\tnSlideHeight: number,\n) {\n\t// the following variables are used for evaluating sValue later\n\t/* eslint-disable no-unused-vars */\n\tconst width = aBBox.width / nSlideWidth;\n\tconst height = aBBox.height / nSlideHeight;\n\tconst x = (aBBox.x + aBBox.width / 2) / nSlideWidth;\n\tconst y = (aBBox.y + aBBox.height / 2) / nSlideHeight;\n\t/* eslint-enable no-unused-vars */\n\n\tconst reMath = /abs|sqrt|asin|acos|atan|sin|cos|tan|exp|log|min|max/g;\n\n\tfor (let i = 0; i < aValueSet.length; ++i) {\n\t\tlet sValue: string = aValueSet[i];\n\t\tif (sValue) {\n\t\t\tsValue = sValue.replace(reMath, 'Math.$&');\n\t\t\tsValue = sValue.replace(/pi(?!\\w)/g, 'Math.PI');\n\t\t\tsValue = sValue.replace(/e(?!\\w)/g, 'Math.E');\n\t\t}\n\t\tconst aValue = eval(sValue);\n\t\taValueList.push(aValue);\n\t}\n}\n"]}