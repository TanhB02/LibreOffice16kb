{"version":3,"file":"ValueListActivity.js","sourceRoot":"","sources":["../../../../../../../../../../../../TanhX/online/browser/src/slideshow/engine/activities/ValueListActivity.ts"],"names":[],"mappings":"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","sourcesContent":["// @ts-strict-ignore\n/* -*- js-indent-level: 8 -*- */\n\n/*\n * Copyright the Collabora Online contributors.\n *\n * SPDX-License-Identifier: MPL-2.0\n *\n * This Source Code Form is subject to the terms of the Mozilla Public\n * License, v. 2.0. If a copy of the MPL was not distributed with this\n * file, You can obtain one at http://mozilla.org/MPL/2.0/.\n */\n\nfunction ValueListActivityTemplate<T extends AGConstructor<ActivityBase>>(\n\tBaseType: T,\n) {\n\tabstract class ValueListActivity extends BaseType {\n\t\tprivate aValueList: any[];\n\t\tprivate aAnimation: AnimationBase;\n\t\tprivate aInterpolator: PropertyInterpolatorType;\n\t\tprivate add: (a: any, b: any) => any;\n\t\tprivate scale: (k: any, v: any) => any;\n\t\tprivate bCumulative: boolean;\n\t\tprivate aLastValue: any;\n\t\tprivate aFormula: (x: any) => any;\n\n\t\tconstructor(...args: any[]) {\n\t\t\tassert(\n\t\t\t\targs.length === 6,\n\t\t\t\t'ValueListActivity, constructor args length is wrong',\n\t\t\t);\n\n\t\t\tconst aValueList: any[] = args[0];\n\t\t\tconst aActivityParamSet: ActivityParamSet = args[1];\n\t\t\tconst aAnimation: AnimationBase = args[2];\n\t\t\tconst aInterpolator: PropertyInterpolatorType = args[3];\n\t\t\tconst aOperatorSet: PropertyOperatorSet = args[4];\n\t\t\tconst bAccumulate: boolean = args[5];\n\n\t\t\tassert(\n\t\t\t\taAnimation,\n\t\t\t\t'ValueListActivity constructor: invalid animation object',\n\t\t\t);\n\t\t\tassert(aValueList.length != 0, 'ValueListActivity: value list is empty');\n\n\t\t\tsuper(\n\t\t\t\taValueList,\n\t\t\t\taActivityParamSet,\n\t\t\t\taAnimation,\n\t\t\t\taInterpolator,\n\t\t\t\taOperatorSet,\n\t\t\t\tbAccumulate,\n\t\t\t);\n\n\t\t\tthis.aValueList = aValueList;\n\t\t\tthis.aAnimation = aAnimation;\n\t\t\tthis.aInterpolator = aInterpolator;\n\t\t\tthis.add = aOperatorSet.add;\n\t\t\tthis.scale = aOperatorSet.scale;\n\t\t\tthis.bCumulative = bAccumulate;\n\t\t\tthis.aLastValue = this.aValueList[this.aValueList.length - 1];\n\t\t\tthis.aFormula = aActivityParamSet.aFormula;\n\t\t}\n\n\t\tpublic activate(aEndEvent: DelayEvent) {\n\t\t\tsuper.activate(aEndEvent);\n\t\t\tfor (let i = 0; i < this.aValueList.length; ++i) {\n\t\t\t\tANIMDBG.print(\n\t\t\t\t\t'ValueListActivity.activate: value[' +\n\t\t\t\t\t\ti +\n\t\t\t\t\t\t'] = ' +\n\t\t\t\t\t\tthis.aValueList[i],\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\n\t\tpublic initAnimatedElement() {\n\t\t\tif (this.aAnimation) {\n\t\t\t\tlet aValue = this.aValueList[0];\n\t\t\t\taValue = this.aFormula ? this.aFormula(aValue) : aValue;\n\t\t\t\tthis.aAnimation.perform(aValue);\n\t\t\t}\n\t\t}\n\n\t\tpublic startAnimation() {\n\t\t\tif (this.isDisposed() || !this.aAnimation) {\n\t\t\t\twindow.app.console.log(\n\t\t\t\t\t'ValueListActivity.startAnimation: activity disposed or not valid animation',\n\t\t\t\t);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tsuper.startAnimation();\n\n\t\t\tthis.aAnimation.start(this.getTargetElement());\n\t\t}\n\n\t\tpublic endAnimation() {\n\t\t\tif (this.aAnimation) this.aAnimation.end();\n\t\t}\n\n\t\t// perform hook override for ContinuousKeyTimeActivityBase base\n\t\tpublic performContinuousHook(\n\t\t\tnIndex: number,\n\t\t\tnFractionalIndex: number,\n\t\t\tnRepeatCount: number,\n\t\t) {\n\t\t\tif (this.isDisposed() || !this.aAnimation) {\n\t\t\t\twindow.app.console.log(\n\t\t\t\t\t'ValueListActivity.performContinuousHook: activity disposed or not valid animation',\n\t\t\t\t);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tassert(\n\t\t\t\tnIndex + 1 < this.aValueList.length,\n\t\t\t\t'ValueListActivity.performContinuousHook: assertion (nIndex + 1 < this.aValueList.length) failed',\n\t\t\t);\n\n\t\t\t// interpolate between nIndex and nIndex+1 values\n\n\t\t\tlet aValue = this.aInterpolator(\n\t\t\t\tthis.aValueList[nIndex],\n\t\t\t\tthis.aValueList[nIndex + 1],\n\t\t\t\tnFractionalIndex,\n\t\t\t);\n\n\t\t\tif (this.bCumulative) {\n\t\t\t\t//aValue = aValue + nRepeatCount * this.aLastValue;\n\t\t\t\taValue = this.add(aValue, this.scale(nRepeatCount, this.aLastValue));\n\t\t\t}\n\n\t\t\taValue = this.aFormula ? this.aFormula(aValue) : aValue;\n\t\t\tthis.aAnimation.perform(aValue);\n\t\t}\n\n\t\t// perform hook override for DiscreteActivityBase base\n\t\tprotected performDiscreteHook(nFrame: number, nRepeatCount: number) {\n\t\t\tif (this.isDisposed() || !this.aAnimation) {\n\t\t\t\twindow.app.console.log(\n\t\t\t\t\t'ValueListActivity.performDiscreteHook: activity disposed or not valid animation',\n\t\t\t\t);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tassert(\n\t\t\t\tnFrame < this.aValueList.length,\n\t\t\t\t'ValueListActivity.performDiscreteHook: assertion ( nFrame < this.aValueList.length) failed',\n\t\t\t);\n\n\t\t\t// this is discrete, thus no lerp here.\n\t\t\tlet aValue = this.aValueList[nFrame];\n\n\t\t\tif (this.bCumulative) {\n\t\t\t\taValue = this.add(aValue, this.scale(nRepeatCount, this.aLastValue));\n\t\t\t\t// for numbers:   aValue = aValue + nRepeatCount * this.aLastValue;\n\t\t\t\t// for enums, bools or strings:   aValue = aValue;\n\t\t\t}\n\n\t\t\taValue = this.aFormula ? this.aFormula(aValue) : aValue;\n\t\t\tthis.aAnimation.perform(aValue);\n\t\t}\n\n\t\tpublic performEnd() {\n\t\t\tif (this.aAnimation) {\n\t\t\t\tconst aValue = this.aFormula\n\t\t\t\t\t? this.aFormula(this.aLastValue)\n\t\t\t\t\t: this.aLastValue;\n\t\t\t\tthis.aAnimation.perform(aValue);\n\t\t\t}\n\t\t}\n\n\t\tpublic dispose() {\n\t\t\tsuper.dispose();\n\t\t}\n\t}\n\n\treturn ValueListActivity;\n}\n\nabstract class ContinuousKeyTimeActivityBaseValueListCtor extends ContinuousKeyTimeActivityBase {\n\tconstructor(\n\t\taValueList: any[],\n\t\taActivityParamSet: ActivityParamSet,\n\t\taAnimation: AnimationBase,\n\t\taInterpolator: PropertyInterpolatorType,\n\t\taOperatorSet: PropertyOperatorSet,\n\t\tbAccumulate: boolean,\n\t) {\n\t\tsuper(aActivityParamSet);\n\t}\n}\n\nconst AbstractLinearValueListActivity = ValueListActivityTemplate(\n\tContinuousKeyTimeActivityBaseValueListCtor,\n);\n\nclass LinearValueListActivity extends AbstractLinearValueListActivity {}\n\nabstract class DiscreteActivityBaserValueListCtor extends DiscreteActivityBase {\n\tconstructor(\n\t\taValueList: any[],\n\t\taActivityParamSet: ActivityParamSet,\n\t\taAnimation: AnimationBase,\n\t\taInterpolator: PropertyInterpolatorType,\n\t\taOperatorSet: PropertyOperatorSet,\n\t\tbAccumulate: boolean,\n\t) {\n\t\tsuper(aActivityParamSet);\n\t}\n}\n\nconst AbstractDiscreteValueListActivity = ValueListActivityTemplate(\n\tDiscreteActivityBaserValueListCtor,\n);\n\nclass DiscreteValueListActivity extends AbstractDiscreteValueListActivity {}\n\ntype ValueListActivityCtorType = new (\n\taValueList: any[],\n\taActivityParamSet: ActivityParamSet,\n\taAnimation: AnimationBase,\n\taInterpolator: PropertyInterpolatorType,\n\taOperatorSet: PropertyOperatorSet,\n\tbAccumulate: boolean,\n) => ActivityBase;\n"]}