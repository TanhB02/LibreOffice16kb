{"version":3,"file":"TimerEventQueue.js","sourceRoot":"","sources":["../../../../../../../../../../../TanhX/online/browser/src/slideshow/engine/TimerEventQueue.ts"],"names":[],"mappings":"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","sourcesContent":["/* -*- js-indent-level: 8 -*- */\n\n/*\n * Copyright the Collabora Online contributors.\n *\n * SPDX-License-Identifier: MPL-2.0\n *\n * This Source Code Form is subject to the terms of the Mozilla Public\n * License, v. 2.0. If a copy of the MPL was not distributed with this\n * file, You can obtain one at http://mozilla.org/MPL/2.0/.\n */\n\nclass TimerEventQueue {\n\tprivate aTimer: ElapsedTime;\n\tprivate aEventSet: PriorityQueue;\n\n\tconstructor(aTimer: ElapsedTime) {\n\t\tthis.aTimer = aTimer;\n\t\tthis.aEventSet = new PriorityQueue(EventEntry.compare);\n\t}\n\n\taddEvent(aEvent: EventBase) {\n\t\tthis.DBG(\n\t\t\t'TimerEventQueue.addEvent event(' + aEvent.getId() + ') appended.',\n\t\t);\n\t\tif (!aEvent) {\n\t\t\twindow.app.console.log('TimerEventQueue.addEvent: null event');\n\t\t\treturn false;\n\t\t}\n\n\t\tconst nTime = aEvent.getActivationTime(this.aTimer.getElapsedTime());\n\t\tconst aEventEntry = new EventEntry(aEvent, nTime);\n\t\tthis.aEventSet.push(aEventEntry);\n\n\t\treturn true;\n\t}\n\n\tforceEmpty() {\n\t\tthis.process_(true);\n\t}\n\n\tprocess() {\n\t\tthis.process_(false);\n\t}\n\n\tprocess_(bFireAllEvents: boolean) {\n\t\tconst nCurrentTime = this.aTimer.getElapsedTime();\n\n\t\twhile (\n\t\t\t!this.isEmpty() &&\n\t\t\t(bFireAllEvents || this.aEventSet.top().nActivationTime <= nCurrentTime)\n\t\t) {\n\t\t\tconst aEventEntry = this.aEventSet.top();\n\t\t\tthis.aEventSet.pop();\n\n\t\t\tconst aEvent = aEventEntry.aEvent;\n\t\t\tif (aEvent.isCharged()) aEvent.fire();\n\t\t}\n\t}\n\n\tisEmpty() {\n\t\treturn this.aEventSet.isEmpty();\n\t}\n\n\tnextTimeout() {\n\t\tlet nTimeout = Number.MAX_VALUE;\n\t\tconst nCurrentTime = this.aTimer.getElapsedTime();\n\t\tif (!this.isEmpty())\n\t\t\tnTimeout = this.aEventSet.top().nActivationTime - nCurrentTime;\n\t\treturn nTimeout;\n\t}\n\n\tclear() {\n\t\tthis.DBG('TimerEventQueue.clear invoked');\n\t\tthis.aEventSet.clear();\n\t}\n\n\tgetTimer() {\n\t\treturn this.aTimer;\n\t}\n\n\tDBG(sMessage: string, nTime?: number) {\n\t\taTimerEventQueueDebugPrinter.print(sMessage, nTime);\n\t}\n}\n\nclass EventEntry {\n\tpublic aEvent: EventBase;\n\tprivate nActivationTime: number;\n\n\tconstructor(aEvent: EventBase, nTime: number) {\n\t\tthis.aEvent = aEvent;\n\t\tthis.nActivationTime = nTime;\n\t}\n\n\tstatic compare(aLhsEventEntry: EventEntry, aRhsEventEntry: EventEntry) {\n\t\tif (aLhsEventEntry.nActivationTime > aRhsEventEntry.nActivationTime) {\n\t\t\treturn -1;\n\t\t} else if (\n\t\t\taLhsEventEntry.nActivationTime < aRhsEventEntry.nActivationTime\n\t\t) {\n\t\t\treturn 1;\n\t\t} else {\n\t\t\treturn 0;\n\t\t}\n\t}\n}\n"]}