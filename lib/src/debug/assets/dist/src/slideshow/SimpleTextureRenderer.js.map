{"version":3,"file":"SimpleTextureRenderer.js","sourceRoot":"","sources":["../../../../../../../../../../TanhX/online/browser/src/slideshow/SimpleTextureRenderer.ts"],"names":[],"mappings":"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","sourcesContent":["// @ts-strict-ignore\n/* -*- js-indent-level: 8 -*- */\n\n/*\n * Copyright the Collabora Online contributors.\n *\n * SPDX-License-Identifier: MPL-2.0\n *\n * This Source Code Form is subject to the terms of the Mozilla Public\n * License, v. 2.0. If a copy of the MPL was not distributed with this\n * file, You can obtain one at http://mozilla.org/MPL/2.0/.\n */\n\nabstract class SimpleTextureRenderer {\n\tprotected gl: WebGL2RenderingContext;\n\tprotected program: WebGLProgram;\n\tprotected vao!: WebGLVertexArrayObject | null;\n\tprotected context: RenderContextGl;\n\tprotected positionBuffer: WebGLBuffer;\n\n\tconstructor(canvasContext: RenderContextGl, createProgram: boolean = true) {\n\t\tthis.context = canvasContext;\n\t\tthis.gl = this.context.getGl();\n\n\t\tif (createProgram) this.createProgram();\n\t}\n\n\t// eslint-disable-next-line @typescript-eslint/no-empty-function\n\tprotected initProgramTemplateParams(): void {}\n\n\tprotected createProgram() {\n\t\tif (this.context.isDisposed()) return;\n\n\t\tthis.initProgramTemplateParams();\n\n\t\tconst vertexShaderSource = this.getVertexShader();\n\t\tconst fragmentShaderSource = this.getFragmentShader();\n\n\t\tconst vertexShader = this.context.createVertexShader(vertexShaderSource);\n\t\tconst fragmentShader =\n\t\t\tthis.context.createFragmentShader(fragmentShaderSource);\n\n\t\tthis.program = this.context.createProgram(vertexShader, fragmentShader);\n\t}\n\n\tprotected getVertexShader(): string {\n\t\treturn `#version 300 es\n\t\t\t\tin vec4 a_position;\n\t\t\t\tin vec2 a_texCoord;\n\t\t\t\tout vec2 v_texCoord;\n\n\t\t\t\tvoid main() {\n\t\t\t\t\tgl_Position = a_position;\n\t\t\t\t\tv_texCoord = a_texCoord;\n\t\t\t\t}\n\t\t\t\t`;\n\t}\n\n\tprotected abstract getFragmentShader(): string;\n\n\tprotected prepareTransition(): void {\n\t\tif (this.context.isDisposed()) return;\n\n\t\tthis.initBuffers();\n\t\tthis.initUniforms();\n\t}\n\n\tprotected initUniforms(): void {\n\t\tif (this.context.isDisposed()) return;\n\n\t\tthis.gl.useProgram(this.program);\n\t\t// Add more uniform here if needed.\n\t}\n\n\tprivate initBuffers(): void {\n\t\tconst positions = new Float32Array([\n\t\t\t...[-1.0, -1.0, 0, 0, 1],\n\t\t\t...[1.0, -1.0, 0, 1, 1],\n\t\t\t...[-1.0, 1.0, 0, 0, 0],\n\t\t\t...[1.0, 1.0, 0, 1, 0],\n\t\t]);\n\n\t\tthis.positionBuffer = this.gl.createBuffer();\n\t\tthis.gl.bindBuffer(this.gl.ARRAY_BUFFER, this.positionBuffer);\n\t\tthis.gl.bufferData(this.gl.ARRAY_BUFFER, positions, this.gl.STATIC_DRAW);\n\n\t\tthis.vao = this.gl.createVertexArray();\n\t\tthis.gl.bindVertexArray(this.vao);\n\n\t\tconst positionLocation = this.gl.getAttribLocation(\n\t\t\tthis.program,\n\t\t\t'a_position',\n\t\t);\n\t\tconst texCoordLocation = this.gl.getAttribLocation(\n\t\t\tthis.program,\n\t\t\t'a_texCoord',\n\t\t);\n\n\t\tif (positionLocation !== -1) {\n\t\t\tthis.gl.enableVertexAttribArray(positionLocation);\n\t\t\tthis.gl.vertexAttribPointer(\n\t\t\t\tpositionLocation,\n\t\t\t\t3,\n\t\t\t\tthis.gl.FLOAT,\n\t\t\t\tfalse,\n\t\t\t\t5 * 4,\n\t\t\t\t0,\n\t\t\t);\n\t\t}\n\t\tif (texCoordLocation !== -1) {\n\t\t\tthis.gl.enableVertexAttribArray(texCoordLocation);\n\t\t\tthis.gl.vertexAttribPointer(\n\t\t\t\ttexCoordLocation,\n\t\t\t\t2,\n\t\t\t\tthis.gl.FLOAT,\n\t\t\t\tfalse,\n\t\t\t\t5 * 4,\n\t\t\t\t3 * 4,\n\t\t\t);\n\t\t}\n\t}\n\n\tpublic abstract render(nT: number): void;\n}\n\n// handle animation timing too\nabstract class TextureAnimationBase extends SimpleTextureRenderer {\n\tprotected time: number = 0;\n\tprotected startTime: number | null = null;\n\n\tconstructor(canvasContext: RenderContextGl) {\n\t\tsuper(canvasContext);\n\t}\n\n\tpublic abstract render(): void;\n}\n"]}