{"version":3,"file":"LayerRenderer.js","sourceRoot":"","sources":["../../../../../../../../../../TanhX/online/browser/src/slideshow/LayerRenderer.ts"],"names":[],"mappings":"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","sourcesContent":["// @ts-strict-ignore\n/* -*- js-indent-level: 8 -*- */\n\n/*\n * Copyright the Collabora Online contributors.\n *\n * SPDX-License-Identifier: MPL-2.0\n *\n * This Source Code Form is subject to the terms of the Mozilla Public\n * License, v. 2.0. If a copy of the MPL was not distributed with this\n * file, You can obtain one at http://mozilla.org/MPL/2.0/.\n */\n\n/*\n *\n */\n\ndeclare var SlideShow: any;\n\ninterface LayerRenderer {\n\tinitialize(): void;\n\tclearCanvas(): void;\n\tdrawBitmap(\n\t\timageInfo: ImageInfo | ImageBitmap,\n\t\tproperties?: AnimatedElementRenderProperties,\n\t): void;\n\tdispose(): void;\n\tisDisposed(): boolean;\n\tfillColor(slideInfo: SlideInfo): boolean;\n\tisGlRenderer(): boolean;\n\tgetRenderContext(): RenderContext;\n}\n\ninterface RenderUniforms {\n\tbounds: BoundsType | null;\n\talpha: number;\n\tfromFillColor: Float32Array;\n\ttoFillColor: Float32Array;\n\tfromLineColor: Float32Array;\n\ttoLineColor: Float32Array;\n}\n\nclass LayerRendererGl implements LayerRenderer {\n\tprivate static readonly DefaultVertices = [-1, -1, 1, -1, -1, 1, 1, 1];\n\tprivate static readonly DefaultFromColor = new Float32Array([0, 0, 0, 0]);\n\tprivate static readonly DefaultToColor = new Float32Array([0, 0, 0, 0]);\n\tprivate offscreenCanvas: OffscreenCanvas;\n\tprivate glContext: RenderContextGl;\n\tprivate gl: WebGL2RenderingContext;\n\tprivate program: WebGLProgram;\n\tprivate vao: WebGLVertexArrayObject;\n\tprivate positionBuffer: WebGLBuffer;\n\tprivate texCoordBuffer: WebGLBuffer;\n\tprivate positionLocation: number;\n\tprivate texCoordLocation: number;\n\tprivate samplerLocation: WebGLUniformLocation;\n\tprivate imageBitmapIdCounter = 0;\n\tprivate textureCache: Map<string, WebGLTexture> = new Map();\n\tprivate imageBitmapIdMap = new WeakMap<ImageBitmap, number>();\n\tprivate disposed: boolean;\n\n\tconstructor(offscreenCanvas: OffscreenCanvas) {\n\t\tthis.offscreenCanvas = offscreenCanvas;\n\t\tthis.glContext = new RenderContextGl(this.offscreenCanvas);\n\t\tthis.gl = this.glContext.getGl();\n\t\tthis.initializeWebGL();\n\t\tthis.disposed = false;\n\t}\n\n\tinitialize(): void {\n\t\t// do nothing!\n\t}\n\n\tisGlRenderer(): boolean {\n\t\treturn true;\n\t}\n\n\tisDisposed(): boolean {\n\t\treturn this.disposed;\n\t}\n\n\tpublic getRenderContext(): RenderContextGl {\n\t\treturn this.glContext;\n\t}\n\n\tprivate vertexShaderSource = `\n\t\t\tattribute vec2 a_position;\n\t\t\tattribute vec2 a_texCoord;\n\t\t\tvarying vec2 v_texCoord;\n\t\t\tvoid main() {\n\t\t\t\tgl_Position = vec4(a_position, 0, 1);\n\t\t\t\tv_texCoord = a_texCoord;\n\t\t\t}\n\t\t`;\n\n\tprivate fragmentShaderSource = `\n\t\tprecision mediump float;\n\t\tuniform vec4 fromFillColor;\n\t\tuniform vec4 toFillColor;\n\t\tuniform vec4 fromLineColor;\n\t\tuniform vec4 toLineColor;\n\t\tuniform float alpha;\n\t\tvarying vec2 v_texCoord;\n\t\tuniform sampler2D u_sampler;\n\n\t\t${GlHelpers.nearestPointOnSegment}\n\t\t${GlHelpers.computeColor}\n\n\t\tvoid main() {\n\t\t\tvec4 color = texture2D(u_sampler, v_texCoord);\n\t\t\tcolor = computeColor(color);\n\t\t\tcolor = color * alpha;\n\t\t\tgl_FragColor = color;\n\t\t}\n\t\t`;\n\n\tprivate initializeWebGL() {\n\t\tconst gl = this.gl;\n\n\t\t// Compile shaders using RenderContextGl\n\t\tconst vertexShader = this.glContext.createVertexShader(\n\t\t\tthis.vertexShaderSource,\n\t\t);\n\t\tconst fragmentShader = this.glContext.createFragmentShader(\n\t\t\tthis.fragmentShaderSource,\n\t\t);\n\n\t\t// Link program using RenderContextGl\n\t\tthis.program = this.glContext.createProgram(vertexShader, fragmentShader);\n\n\t\t// Get attribute and uniform locations\n\t\tthis.positionLocation = gl.getAttribLocation(this.program, 'a_position');\n\t\tthis.texCoordLocation = gl.getAttribLocation(this.program, 'a_texCoord');\n\t\tthis.samplerLocation = gl.getUniformLocation(this.program, 'u_sampler');\n\n\t\t// Create buffers\n\t\tthis.positionBuffer = gl.createBuffer();\n\n\t\tthis.texCoordBuffer = gl.createBuffer();\n\t\tgl.bindBuffer(gl.ARRAY_BUFFER, this.texCoordBuffer);\n\t\tconst texCoords = new Float32Array([0, 1, 1, 1, 0, 0, 1, 0]);\n\t\tgl.bufferData(gl.ARRAY_BUFFER, texCoords, gl.STATIC_DRAW);\n\n\t\tthis.vao = gl.createVertexArray();\n\t\tgl.bindVertexArray(this.vao);\n\n\t\tgl.bindBuffer(gl.ARRAY_BUFFER, this.positionBuffer);\n\t\tgl.enableVertexAttribArray(this.positionLocation);\n\t\tgl.vertexAttribPointer(this.positionLocation, 2, gl.FLOAT, false, 0, 0);\n\n\t\tgl.bindBuffer(gl.ARRAY_BUFFER, this.texCoordBuffer);\n\t\tgl.enableVertexAttribArray(this.texCoordLocation);\n\t\tgl.vertexAttribPointer(this.texCoordLocation, 2, gl.FLOAT, false, 0, 0);\n\n\t\tgl.enable(gl.BLEND);\n\t\tgl.blendFunc(gl.ONE, gl.ONE_MINUS_SRC_ALPHA);\n\t\tgl.pixelStorei(gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL, true);\n\t\tthis.gl.disable(this.gl.DEPTH_TEST);\n\t}\n\n\tprivate initPositionBuffer(bounds: BoundsType) {\n\t\tconst gl = this.gl;\n\n\t\tlet vertices = LayerRendererGl.DefaultVertices;\n\t\tif (bounds) {\n\t\t\tvertices = [];\n\t\t\t// convert [0,1] => [-1,1]\n\t\t\tfor (let i = 0; i < bounds.length; ++i) {\n\t\t\t\tconst x = 2 * bounds[i].x - 1;\n\t\t\t\tvertices.push(x);\n\t\t\t\t// flip y coordinates\n\t\t\t\tconst y = -(2 * bounds[i].y - 1);\n\t\t\t\tvertices.push(y);\n\t\t\t}\n\t\t}\n\n\t\tgl.bindBuffer(gl.ARRAY_BUFFER, this.positionBuffer);\n\t\tconst positions = new Float32Array(vertices);\n\t\tgl.bufferData(gl.ARRAY_BUFFER, positions, gl.STATIC_DRAW);\n\t}\n\n\tclearCanvas(): void {\n\t\tif (!this.disposed) {\n\t\t\tconst gl = this.gl;\n\t\t\tgl.clearColor(1.0, 1.0, 1.0, 1.0); // Clear to white\n\t\t\tgl.clear(gl.COLOR_BUFFER_BIT);\n\t\t}\n\t}\n\n\tpublic static computeColor(\n\t\tproperties?: AnimatedElementRenderProperties,\n\t): RenderUniforms {\n\t\tlet bounds: BoundsType = null;\n\t\tlet alpha = 1.0;\n\t\tlet fromFillColor = LayerRendererGl.DefaultFromColor;\n\t\tlet toFillColor = LayerRendererGl.DefaultToColor;\n\t\tlet fromLineColor = LayerRendererGl.DefaultFromColor;\n\t\tlet toLineColor = LayerRendererGl.DefaultToColor;\n\t\tif (properties) {\n\t\t\tbounds = properties.bounds;\n\t\t\talpha = properties.alpha;\n\t\t\tconst colorMap = properties.colorMap;\n\t\t\tif (colorMap) {\n\t\t\t\tif (colorMap.fromFillColor && colorMap.toFillColor) {\n\t\t\t\t\tfromFillColor = colorMap.fromFillColor.toFloat32Array();\n\t\t\t\t\ttoFillColor = colorMap.toFillColor.toFloat32Array();\n\t\t\t\t}\n\t\t\t\tif (colorMap.fromLineColor && colorMap.toLineColor) {\n\t\t\t\t\tfromLineColor = colorMap.fromLineColor.toFloat32Array();\n\t\t\t\t\ttoLineColor = colorMap.toLineColor.toFloat32Array();\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn {\n\t\t\tbounds,\n\t\t\talpha,\n\t\t\tfromFillColor,\n\t\t\ttoFillColor,\n\t\t\tfromLineColor,\n\t\t\ttoLineColor,\n\t\t};\n\t}\n\n\tdrawBitmap(\n\t\timageInfo: ImageInfo | ImageBitmap,\n\t\tproperties?: AnimatedElementRenderProperties,\n\t): void {\n\t\tif (this.disposed) {\n\t\t\tconsole.log('LayerRenderer is disposed');\n\t\t\treturn;\n\t\t}\n\t\tif (!imageInfo) {\n\t\t\tconsole.log('LayerRenderer.drawBitmap: no image');\n\t\t\treturn;\n\t\t}\n\n\t\tconst {\n\t\t\tbounds,\n\t\t\talpha,\n\t\t\tfromFillColor,\n\t\t\ttoFillColor,\n\t\t\tfromLineColor,\n\t\t\ttoLineColor,\n\t\t} = LayerRendererGl.computeColor(properties);\n\n\t\tlet texture: WebGLTexture;\n\t\tlet textureKey: string;\n\n\t\tif (imageInfo instanceof ImageBitmap) {\n\t\t\tif (!this.imageBitmapIdMap.has(imageInfo)) {\n\t\t\t\tthis.imageBitmapIdMap.set(imageInfo, this.imageBitmapIdCounter++);\n\t\t\t}\n\t\t\ttextureKey = `imageBitmap_${this.imageBitmapIdMap.get(imageInfo)}`;\n\t\t} else {\n\t\t\ttextureKey = imageInfo.checksum;\n\t\t}\n\n\t\tif (this.textureCache.has(textureKey)) {\n\t\t\ttexture = this.textureCache.get(textureKey);\n\t\t\t// console.debug(`LayerDrawing.drawBitmap: cache hit: key: ${textureKey}`);\n\t\t} else {\n\t\t\tif (imageInfo instanceof ImageBitmap) {\n\t\t\t\ttexture = this.glContext.loadTexture(imageInfo);\n\t\t\t} else {\n\t\t\t\ttexture = this.glContext.loadTexture(\n\t\t\t\t\timageInfo.data as HTMLImageElement,\n\t\t\t\t);\n\t\t\t}\n\t\t\tthis.textureCache.set(textureKey, texture);\n\t\t}\n\n\t\tthis.gl.useProgram(this.program);\n\t\tthis.gl.bindVertexArray(this.vao);\n\n\t\tthis.initPositionBuffer(bounds);\n\n\t\tthis.gl.uniform1f(this.gl.getUniformLocation(this.program, 'alpha'), alpha);\n\t\tthis.gl.uniform4fv(\n\t\t\tthis.gl.getUniformLocation(this.program, 'fromFillColor'),\n\t\t\tfromFillColor,\n\t\t);\n\t\tthis.gl.uniform4fv(\n\t\t\tthis.gl.getUniformLocation(this.program, 'toFillColor'),\n\t\t\ttoFillColor,\n\t\t);\n\t\tthis.gl.uniform4fv(\n\t\t\tthis.gl.getUniformLocation(this.program, 'fromLineColor'),\n\t\t\tfromLineColor,\n\t\t);\n\t\tthis.gl.uniform4fv(\n\t\t\tthis.gl.getUniformLocation(this.program, 'toLineColor'),\n\t\t\ttoLineColor,\n\t\t);\n\n\t\tthis.gl.activeTexture(this.gl.TEXTURE0);\n\t\tthis.gl.bindTexture(this.gl.TEXTURE_2D, texture);\n\t\tthis.gl.uniform1i(this.samplerLocation, 0);\n\n\t\tthis.gl.drawArrays(this.gl.TRIANGLE_STRIP, 0, 4);\n\t}\n\n\tdispose(): void {\n\t\tthis.gl = null;\n\t\tthis.offscreenCanvas = null;\n\t\tthis.disposed = true;\n\t}\n\n\thexToRgb(hex: string): { r: number; g: number; b: number } | null {\n\t\thex = hex.replace(/^#/, '');\n\t\tlet bigint: number;\n\t\tif (hex.length === 3) {\n\t\t\tconst r = parseInt(hex.charAt(0) + hex.charAt(0), 16);\n\t\t\tconst g = parseInt(hex.charAt(1) + hex.charAt(1), 16);\n\t\t\tconst b = parseInt(hex.charAt(2) + hex.charAt(2), 16);\n\t\t\treturn { r, g, b };\n\t\t} else if (hex.length === 6) {\n\t\t\tbigint = parseInt(hex, 16);\n\t\t\tconst r = (bigint >> 16) & 255;\n\t\t\tconst g = (bigint >> 8) & 255;\n\t\t\tconst b = bigint & 255;\n\t\t\treturn { r, g, b };\n\t\t} else {\n\t\t\treturn null;\n\t\t}\n\t}\n\n\tfillColor(slideInfo: SlideInfo): boolean {\n\t\tif (this.disposed) return true; // done\n\n\t\tif (slideInfo.background && slideInfo.background.fillColor) {\n\t\t\tconst fillColor = slideInfo.background.fillColor;\n\t\t\tconst rgb = this.hexToRgb(fillColor);\n\t\t\tif (rgb) {\n\t\t\t\tthis.gl.clearColor(rgb.r / 255, rgb.g / 255, rgb.b / 255, 1.0);\n\t\t\t} else {\n\t\t\t\tthis.gl.clearColor(1.0, 1.0, 1.0, 1.0);\n\t\t\t}\n\t\t\tthis.gl.clear(this.gl.COLOR_BUFFER_BIT);\n\t\t} else {\n\t\t\tthis.gl.clearColor(1.0, 1.0, 1.0, 1.0);\n\t\t\tthis.gl.clear(this.gl.COLOR_BUFFER_BIT);\n\t\t}\n\n\t\tif (!slideInfo.background) return true;\n\t\treturn false;\n\t}\n}\n\nclass LayerRenderer2d implements LayerRenderer {\n\tprivate offscreenCanvas: OffscreenCanvas;\n\tprivate offscreenContext: OffscreenCanvasRenderingContext2D;\n\tprivate context2d: RenderContext2d;\n\tprivate disposed: boolean;\n\n\tconstructor(offscreenCanvas: OffscreenCanvas) {\n\t\tthis.offscreenCanvas = offscreenCanvas;\n\t\tthis.context2d = new RenderContext2d(this.offscreenCanvas);\n\t\tthis.offscreenContext = this.context2d.get2dOffscreen();\n\t\tif (!this.offscreenContext) {\n\t\t\tthrow new Error('2D Canvas context not available');\n\t\t}\n\t\tthis.disposed = false;\n\t}\n\n\tinitialize(): void {\n\t\t// Initialization is handled in the constructor\n\t}\n\n\tisGlRenderer(): boolean {\n\t\treturn false;\n\t}\n\n\tisDisposed(): boolean {\n\t\treturn this.disposed;\n\t}\n\n\tgetRenderContext(): RenderContext {\n\t\treturn this.context2d;\n\t}\n\n\tclearCanvas(): void {\n\t\tif (this.disposed) return;\n\t\tthis.offscreenContext.clearRect(\n\t\t\t0,\n\t\t\t0,\n\t\t\tthis.offscreenCanvas.width,\n\t\t\tthis.offscreenCanvas.height,\n\t\t);\n\t\tthis.offscreenContext.fillStyle = '#FFFFFF';\n\t\tthis.offscreenContext.fillRect(\n\t\t\t0,\n\t\t\t0,\n\t\t\tthis.offscreenCanvas.width,\n\t\t\tthis.offscreenCanvas.height,\n\t\t);\n\t}\n\n\tdrawBitmap(\n\t\timageInfo: ImageInfo | ImageBitmap,\n\t\tproperties?: AnimatedElementRenderProperties,\n\t): void {\n\t\tif (this.disposed) return;\n\t\tif (!imageInfo) {\n\t\t\tconsole.log('Canvas2DRenderer.drawBitmap: no image');\n\t\t\treturn;\n\t\t}\n\t\tif (imageInfo instanceof ImageBitmap) {\n\t\t\tthis.offscreenContext.drawImage(imageInfo, 0, 0);\n\t\t} else if (imageInfo.type === 'png') {\n\t\t\tthis.offscreenContext.drawImage(imageInfo.data as HTMLImageElement, 0, 0);\n\t\t}\n\t}\n\n\tdispose(): void {\n\t\t// Cleanup references\n\t\tthis.disposed = true;\n\t\tthis.offscreenContext = null;\n\t\tthis.offscreenCanvas = null;\n\t}\n\n\tfillColor(slideInfo: SlideInfo): boolean {\n\t\tif (this.disposed) return;\n\n\t\t// always draw a solid white rectangle behind the background\n\t\tthis.offscreenContext.fillStyle = '#FFFFFF';\n\t\tthis.offscreenContext.fillRect(\n\t\t\t0,\n\t\t\t0,\n\t\t\tthis.offscreenCanvas.width,\n\t\t\tthis.offscreenCanvas.height,\n\t\t);\n\n\t\tif (!slideInfo.background) return true;\n\t\tif (slideInfo.background.fillColor) {\n\t\t\tthis.offscreenContext.fillStyle = '#' + slideInfo.background.fillColor;\n\t\t\twindow.app.console.log(\n\t\t\t\t'LayerDrawing.drawBackground: ' + this.offscreenContext.fillStyle,\n\t\t\t);\n\t\t\tthis.offscreenContext.fillRect(\n\t\t\t\t0,\n\t\t\t\t0,\n\t\t\t\tthis.offscreenCanvas.width,\n\t\t\t\tthis.offscreenCanvas.height,\n\t\t\t);\n\t\t\treturn true;\n\t\t}\n\n\t\treturn false;\n\t}\n}\n\nSlideShow.LayerRendererGl = LayerRendererGl;\nSlideShow.LayerRenderer2d = LayerRenderer2d;\n"]}