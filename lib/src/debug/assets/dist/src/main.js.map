{"version":3,"file":"main.js","sourceRoot":"","sources":["../../../../../../../../../TanhX/online/browser/src/main.js"],"names":[],"mappings":"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","sourcesContent":["/* -*- js-indent-level: 8 -*- */\n\n/*\n * Copyright the Collabora Online contributors.\n *\n * SPDX-License-Identifier: MPL-2.0\n *\n * This Source Code Form is subject to the terms of the Mozilla Public\n * License, v. 2.0. If a copy of the MPL was not distributed with this\n * file, You can obtain one at http://mozilla.org/MPL/2.0/.\n */\n\n/* global errorMessages accessToken accessTokenTTL noAuthHeader accessHeader createOnlineModule */\n/* global app $ L host idleTimeoutSecs outOfFocusTimeoutSecs _ LocaleService LayoutingService */\n/*eslint indent: [error, \"tab\", { \"outerIIFEBody\": 0 }]*/\n\n(function (global) {\n\n\nvar wopiParams = {};\nvar wopiSrc = global.coolParams.get('WOPISrc');\n\nif (wopiSrc !== '' && accessToken !== '') {\n\twopiParams = { 'access_token': accessToken, 'access_token_ttl': accessTokenTTL, 'no_auth_header': noAuthHeader };\n}\nelse if (wopiSrc !== '' && accessHeader !== '') {\n\twopiParams = { 'access_header': accessHeader };\n}\n\nif (window.ThisIsTheEmscriptenApp)\n\t// Temporary hack\n\tvar filePath = 'file:///sample.docx';\nelse\n\tvar filePath = global.coolParams.get('file_path');\n\napp.localeService = new LocaleService();\napp.setPermission(global.coolParams.get('permission') || 'edit');\napp.layoutingService = new LayoutingService();\n\nvar timestamp = global.coolParams.get('timestamp');\nvar target = global.coolParams.get('target') || '';\n// Should the document go inactive or not\nvar alwaysActive = global.coolParams.get('alwaysactive');\n// Cool Debug mode\nvar debugMode = global.coolParams.get('debug');\n\nvar docURL, docParams;\nvar isWopi = false;\nif (wopiSrc != '') {\n\tdocURL = decodeURIComponent(wopiSrc);\n\tdocParams = wopiParams;\n\tisWopi = true;\n} else {\n\tdocURL = filePath;\n\tdocParams = {};\n}\n\nvar notWopiButIframe = global.coolParams.get('NotWOPIButIframe') != '';\nvar map = L.map('map', {\n\tserver: host,\n\tdoc: docURL,\n\tdocParams: docParams,\n\ttimestamp: timestamp,\n\tdocTarget: target,\n\tdocumentContainer: 'document-container',\n\tdebug: debugMode,\n\t// the wopi and wopiSrc properties are in sync: false/true : empty/non-empty\n\twopi: isWopi,\n\twopiSrc: wopiSrc,\n\tnotWopiButIframe: notWopiButIframe,\n\talwaysActive: alwaysActive,\n\tidleTimeoutSecs: idleTimeoutSecs,  // Dim when user is idle.\n\toutOfFocusTimeoutSecs: outOfFocusTimeoutSecs, // Dim after switching tabs.\n});\n\n////// Controls /////\n\nmap.uiManager = L.control.uiManager();\nmap.addControl(map.uiManager);\nif (!L.Browser.cypressTest)\n\tmap.tooltip = L.control.tooltip();\n\nmap.uiManager.initializeBasicUI();\n\nif (wopiSrc === '' && filePath === '' && !window.ThisIsAMobileApp) {\n\tmap.uiManager.showInfoModal('wrong-wopi-src-modal', '', errorMessages.wrongwopisrc, '', _('OK'), null, false);\n}\nif (host === '' && !window.ThisIsAMobileApp) {\n\tmap.uiManager.showInfoModal('empty-host-url-modal', '', errorMessages.emptyhosturl, '', _('OK'), null, false);\n}\n\nL.Map.THIS = map;\napp.map = map;\napp.idleHandler.map = map;\n\nif (window.ThisIsTheEmscriptenApp) {\n\tvar docParamsString = $.param(docParams);\n\t// The URL may already contain a query (e.g., 'http://server.tld/foo/wopi/files/bar?desktop=baz') - then just append more params\n\tvar docParamsPart = docParamsString ? (docURL.includes('?') ? '&' : '?') + docParamsString : '';\n\tvar encodedWOPI = encodeURIComponent(docURL + docParamsPart);\n\n\tvar Module = {\n\t\tonRuntimeInitialized: function() {\n\t\t\tmap.loadDocument(global.socket);\n\t\t},\n\t\tprint: function (text) {\n\t\t\tif (arguments.length > 1) text = Array.prototype.slice.call(arguments).join(' ');\n\t\t\tconsole.warn(text);\n\t\t},\n\t\tprintErr: function (text) {\n\t\t\tif (arguments.length > 1) text = Array.prototype.slice.call(arguments).join(' ');\n\t\t\tconsole.error(text);\n\t\t},\n\t\targuments_: [docURL, encodedWOPI, isWopi ? 'true' : 'false'],\n\t\targuments: [docURL, encodedWOPI, isWopi ? 'true' : 'false'],\n\t};\n\tcreateOnlineModule(Module);\n\tapp.HandleCOOLMessage = Module['_handle_cool_message'];\n\tapp.AllocateUTF8 = Module['allocateUTF8'];\n} else {\n\tmap.loadDocument(global.socket);\n}\n\nwindow.addEventListener('beforeunload', function () {\n\tif (map && app.socket) {\n\t\tif (app.socket.setUnloading)\n\t\t\tapp.socket.setUnloading();\n\t\tapp.socket.close();\n\t}\n});\n\nwindow.bundlejsLoaded = true;\n\n\n////// Unsupported Browser Warning /////\n\nvar uaLowerCase = navigator.userAgent.toLowerCase();\nif (uaLowerCase.indexOf('msie') != -1 || uaLowerCase.indexOf('trident') != -1) {\n\tmap.uiManager.showInfoModal(\n\t\t'browser-not-supported-modal', '',\n\t\t_('Warning! The browser you are using is not supported.'),\n\t\t'', _('OK'), null, false);\n}\n\n}(window));\n"]}