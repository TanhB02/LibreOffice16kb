{"version":3,"file":"Map.StateChanges.js","sourceRoot":"","sources":["../../../../../../../../../../../TanhX/online/browser/src/map/handler/Map.StateChanges.js"],"names":[],"mappings":"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","sourcesContent":["/* -*- js-indent-level: 8 -*- */\n/*\n * L.Map.StateChanges stores the state changes commands coming from core\n * LOK_CALLBACK_STATE_CHANGED callback\n */\n/* global $ app */\n/*eslint no-extend-native:0*/\nL.Map.mergeOptions({\n\tstateChangeHandler: true\n});\n\nL.Map.StateChangeHandler = L.Handler.extend({\n\n\tinitialize: function (map) {\n\t\tthis._map = map;\n\t\t// Contains the items for which state will be tracked\n\t\t// Stores the last received value from core ('true', 'false', 'enabled', 'disabled')\n\t\tthis._items = {};\n\t},\n\n\taddHooks: function () {\n\t\tthis._map.on('commandstatechanged', this._onStateChanged, this);\n\t},\n\n\tremoveHooks: function () {\n\t\tthis._map.off('commandstatechanged', this._onStateChanged, this);\n\t},\n\n\t_onStateChanged: function(e) {\n\t\tvar slideMasterPageItem = this._map['stateChangeHandler'].getItemValue('.uno:SlideMasterPage');\n\t\tvar state;\n\n\t\tif (typeof (e.state) == 'object') {\n\t\t\tstate = e.state;\n\t\t} else if (typeof (e.state) == 'string') {\n\t\t\tvar firstIndex = e.state.indexOf('{');\n\t\t\tvar lastIndex = e.state.lastIndexOf('}');\n\n\t\t\tif (firstIndex !== -1 && lastIndex !== -1) {\n\t\t\t\tstate = JSON.parse(e.state.substring(firstIndex, lastIndex + 1));\n\t\t\t} else {\n\t\t\t\tstate = e.state;\n\t\t\t}\n\t\t}\n\t\tconst commandName = this.ensureUnoCommandPrefix(e.commandName);\n\n\t\tthis._items[commandName] = state;\n\t\tif (e.commandName === '.uno:CurrentTrackedChangeId') {\n\t\t\tvar redlineId = 'change-' + state;\n\t\t\tconst annotations = app.sectionContainer.getSectionWithName(L.CSections.CommentList.name);\n\t\t\tif (annotations) annotations.selectById(redlineId);\n\t\t\telse console.error('_onStateChanged: section \"CommentList\" missing');\n\t\t}\n\n\t\tif (e.commandName === '.uno:SlideMasterPage') {\n\t\t\tthis._map._docLayer._selectedMode = (state === true || state === 'true') ? 1 : 0;\n\t\t}\n\n\t\tif (e.commandName === '.uno:FormatPaintbrush') {\n\t\t\tif (state === 'true')\n\t\t\t\t$('.leaflet-pane.leaflet-map-pane').addClass('bucket-cursor');\n\t\t\telse\n\t\t\t\t$('.leaflet-pane.leaflet-map-pane').removeClass('bucket-cursor');\n\t\t}\n\n\t\tif (e.commandName === '.uno:StartWithPresentation' && (state === true || state === 'true')) {\n\t\t\tlet startPresentationParam = window.coolParams.get('startPresentation');\n\t\t\tif (startPresentationParam === '' || startPresentationParam === 'true' || startPresentationParam === '1') {\n\t\t\t\tapp.dispatcher.dispatch('presentation');\n\t\t\t}\n\t\t}\n\n\t\t$('#document-container').removeClass('slide-master-mode');\n\t\t$('#document-container').addClass('slide-normal-mode');\n\t\tif (slideMasterPageItem) {\n\t\t\t$('#document-container').removeClass('slide-normal-mode');\n\t\t\t$('#document-container').addClass('slide-master-mode');\n\t\t}\n\t\tif (!slideMasterPageItem || slideMasterPageItem == 'false' || slideMasterPageItem == 'undefined') {\n\t\t\t$('#document-container').removeClass('slide-master-mode');\n\t\t\t$('#document-container').addClass('slide-normal-mode');\n\t\t}\n\t},\n\n\tgetItems: function() {\n\t\treturn this._items;\n\t},\n\n\tgetItemValue: function(unoCmd) {\n\t\tunoCmd = this.ensureUnoCommandPrefix(unoCmd);\n\n\t\treturn this._items[unoCmd];\n\t},\n\n\tsetItemValue: function(unoCmd, value) {\n\t\tunoCmd = this.ensureUnoCommandPrefix(unoCmd);\n\n\t\tthis._items[unoCmd] = value;\n\t},\n\n\tensureUnoCommandPrefix(unoCmd) {\n\t\tif (unoCmd && unoCmd.substring(0, 5) !== '.uno:') {\n\t\t\treturn '.uno:' + unoCmd;\n\t\t}\n\t\treturn unoCmd;\n\t}\n});\n\nL.Map.addInitHook('addHandler', 'stateChangeHandler', L.Map.StateChangeHandler);\n"]}