{"version":3,"file":"Map.TouchGesture.js","sourceRoot":"","sources":["../../../../../../../../../../../TanhX/online/browser/src/map/handler/Map.TouchGesture.js"],"names":[],"mappings":"AAAA,kDAAkD;AAClD,gBAAgB;AAChB;;GAEG;AAEH,CAAC,CAAC,GAAG,CAAC,YAAY,CAAC;IAClB,YAAY,EAAE,IAAI;CAClB,CAAC,CAAC;AAEH,sDAAsD;AACtD,CAAC,CAAC,GAAG,CAAC,YAAY,GAAG,CAAC,CAAC,OAAO,CAAC,MAAM,CAAC;IACrC,OAAO,EAAE;QACR,GAAG,EAAE,CAAC;QACN,MAAM,EAAE,CAAC;QACT,OAAO,EAAE,CAAC;QACV,MAAM,EAAE,CAAC;QACT,KAAK,EAAE,EAAE;KACT;IAED,UAAU,EAAE,UAAU,GAAG;QACxB,CAAC,CAAC,OAAO,CAAC,SAAS,CAAC,UAAU,CAAC,IAAI,CAAC,IAAI,EAAE,GAAG,CAAC,CAAC;QAC/C,IAAI,CAAC,MAAM,GAAG,CAAC,CAAC,GAAG,CAAC,YAAY,CAAC,GAAG,CAAC;QAErC,IAAI,CAAC,IAAI,CAAC,OAAO,EAAE;YAClB,IAAI,CAAC,OAAO,GAAG,IAAI,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;YAC9C,IAAI,CAAC,OAAO,CAAC,GAAG,CAAC,OAAO,CAAC,CAAC,GAAG,CAAC;gBAC7B,SAAS,EAAE,MAAM,CAAC,aAAa;aAC/B,CAAC,CAAC;YACH,IAAI,CAAC,OAAO,CAAC,GAAG,CAAC,KAAK,CAAC,CAAC,GAAG,CAAC;gBAC3B,SAAS,EAAE,MAAM,CAAC,aAAa;aAC/B,CAAC,CAAC;YACH,IAAI,CAAC,OAAO,CAAC,GAAG,CAAC,OAAO,CAAC,CAAC,GAAG,CAAC;gBAC7B,MAAM,EAAE,IAAI;aACZ,CAAC,CAAC;YACH,6FAA6F;YAC7F,IAAI,CAAC,OAAO,CAAC,GAAG,CAAC,OAAO,CAAC,CAAC,GAAG,CAAC;gBAC7B,IAAI,EAAE,GAAG;aACT,CAAC,CAAC;YAEH,IAAI,CAAC,OAAO,CAAC,GAAG,CAAC,OAAO,CAAC,CAAC,GAAG,CAAC;gBAC7B,SAAS,EAAE,CAAC;aACZ,CAAC,CAAC;YAEH,IAAI,SAAS,GAAG,IAAI,CAAC,OAAO,CAAC,GAAG,CAAC,KAAK,CAAC,CAAC;YACxC,IAAI,SAAS,GAAG,IAAI,CAAC,OAAO,CAAC,GAAG,CAAC,WAAW,CAAC,CAAC;YAE9C,+DAA+D;YAC/D,kEAAkE;YAClE,iEAAiE;YACjE,IAAI,YAAY,GAAG,GAAG,CAAC;YACvB,SAAS,CAAC,OAAO,CAAC,YAAY,GAAG,YAAY,CAAC;YAE9C,IAAI,SAAS,GAAG,IAAI,MAAM,CAAC,GAAG,CAAC,EAAC,KAAK,EAAE,WAAW,EAAE,IAAI,EAAE,CAAC,EAAE,YAAY,EAAE,YAAY,EAAE,CAAC,CAAC;YAC3F,IAAI,CAAC,OAAO,CAAC,GAAG,CAAC,SAAS,CAAC,CAAC;YAC5B,SAAS,CAAC,aAAa,CAAC,CAAC,SAAS,EAAE,SAAS,CAAC,CAAC,CAAC;YAChD,IAAI,MAAM,GAAG,IAAI,CAAC,OAAO,CAAC;YAC1B,CAAC,CAAC,QAAQ,CAAC,EAAE,CAAC,IAAI,CAAC,IAAI,CAAC,QAAQ,EAAE,kCAAkC,EAAE,MAAM,CAAC,KAAK,CAAC,SAAS,CAAC,CAAC,CAAC,QAAQ,CAAC,cAAc,CAAC,CAAC,CAAC;YACzH,CAAC,CAAC,QAAQ,CAAC,EAAE,CAAC,IAAI,CAAC,IAAI,CAAC,QAAQ,EAAE,UAAU,EAAE,MAAM,CAAC,KAAK,CAAC,SAAS,CAAC,UAAS,CAAC;gBAC9E,sFAAsF;gBACtF,6DAA6D;gBAC7D,sDAAsD;gBACtD,IAAI,MAAM,CAAC,KAAK,EAAE;oBACjB,IAAI,MAAM,CAAC,KAAK,CAAC,KAAK,EAAG;wBACxB,MAAM,CAAC,KAAK,CAAC,KAAK,GAAG,EAAE,CAAC;qBACxB;iBACD;gBACD,CAAC,CAAC,QAAQ,CAAC,cAAc,CAAC,CAAC,CAAC,CAAC;YAC9B,CAAC,CAAC,CAAC,CAAC;YAEJ,IAAI,MAAM,CAAC,QAAQ,CAAC,MAAM,EAAE,cAAc,CAAC,KAAK,SAAS,EAAE;gBAC1D,CAAC,CAAC,QAAQ,CAAC,EAAE,CAAC,IAAI,CAAC,IAAI,CAAC,QAAQ,EAAE,iDAAiD,EAAE,MAAM,CAAC,KAAK,CAAC,SAAS,CAAC,CAAC,CAAC,QAAQ,CAAC,cAAc,CAAC,CAAC,CAAC;aACxI;YAED,gDAAgD;YAChD,IAAI,MAAM,CAAC,cAAc,IAAI,CAAC,MAAM,CAAC,YAAY,EAAE;gBAClD,CAAC,CAAC,QAAQ,CAAC,EAAE,CAAC,IAAI,CAAC,IAAI,CAAC,QAAQ,EAAE,yDAAyD,EAAE,MAAM,CAAC,KAAK,CAAC,SAAS,CAAC,CAAC,CAAC,QAAQ,CAAC,cAAc,CAAC,CAAC,CAAC;aAChJ;YAED,CAAC,CAAC,QAAQ,CAAC,EAAE,CAAC,IAAI,CAAC,IAAI,CAAC,QAAQ,EAAE,6BAA6B,EAAE,CAAC,CAAC,QAAQ,CAAC,cAAc,CAAC,CAAC;YAC5F,CAAC,CAAC,QAAQ,CAAC,EAAE,CAAC,QAAQ,EAAE,WAAW,EAAE,CAAC,CAAC,QAAQ,CAAC,cAAc,CAAC,CAAC;SAChE;QAED,KAAK,IAAI,MAAM,IAAI,CAAC,CAAC,SAAS,CAAC,IAAI,EAAE;YACpC,CAAC,CAAC,QAAQ,CAAC,EAAE,CAAC,QAAQ,EAAE,CAAC,CAAC,SAAS,CAAC,GAAG,CAAC,MAAM,CAAC,EAAE,IAAI,CAAC,QAAQ,EAAE,IAAI,CAAC,CAAC;SACtE;QAED,mDAAmD;QACnD,+CAA+C;QAC/C,IAAI,IAAI,CAAC,OAAO,CAAC,KAAK,YAAY,MAAM,CAAC,UAAU,EAAE;YACpD,IAAI,IAAI,GAAG,CAAC,CAAC,QAAQ,CAAC,CAAC;YACvB,IAAI,CAAC,EAAE,CAAC,mBAAmB,EAAE,oBAAoB,EAAE,UAAU,CAAC;gBAC7D,IAAI,KAAK,GAAG,CAAC,CAAC,IAAI,CAAC,CAAC;gBAEpB,IAAI,KAAK,CAAC,IAAI,EAAE,CAAC,WAAW,CAAC,QAAQ,KAAK,gBAAgB,EAAE;oBAC3D,CAAC,CAAC,WAAW,CAAC,MAAM,CAAC,SAAS,CAAC,KAAK,CAAC,IAAI,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC;iBAChD;YACF,CAAC,CAAC,CAAC;SACH;IACF,CAAC;IAED,QAAQ,EAAE;QACT,IAAI,CAAC,OAAO,CAAC,EAAE,CAAC,cAAc,EAAE,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,SAAS,CAAC,IAAI,CAAC,SAAS,CAAC,EAAE,IAAI,CAAC,CAAC,CAAC;QAChG,IAAI,CAAC,OAAO,CAAC,EAAE,CAAC,KAAK,EAAE,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,SAAS,CAAC,IAAI,CAAC,MAAM,CAAC,EAAE,IAAI,CAAC,CAAC,CAAC;QACpF,IAAI,CAAC,OAAO,CAAC,EAAE,CAAC,UAAU,EAAE,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,SAAS,CAAC,IAAI,CAAC,WAAW,CAAC,EAAE,IAAI,CAAC,CAAC,CAAC;QAC9F,IAAI,CAAC,OAAO,CAAC,EAAE,CAAC,KAAK,EAAE,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,SAAS,CAAC,IAAI,CAAC,MAAM,CAAC,EAAE,IAAI,CAAC,CAAC,CAAC;QACpF,IAAI,CAAC,OAAO,CAAC,EAAE,CAAC,QAAQ,EAAE,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,SAAS,CAAC,IAAI,CAAC,SAAS,CAAC,EAAE,IAAI,CAAC,CAAC,CAAC;QAC1F,IAAI,CAAC,OAAO,CAAC,EAAE,CAAC,YAAY,EAAE,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,SAAS,CAAC,IAAI,CAAC,aAAa,CAAC,EAAE,IAAI,CAAC,CAAC,CAAC;QAClG,IAAI,CAAC,OAAO,CAAC,EAAE,CAAC,WAAW,EAAE,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,SAAS,CAAC,IAAI,CAAC,QAAQ,CAAC,EAAE,IAAI,CAAC,CAAC,CAAC;QAC5F,IAAI,CAAC,OAAO,CAAC,EAAE,CAAC,UAAU,EAAE,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,SAAS,CAAC,IAAI,CAAC,WAAW,CAAC,EAAE,IAAI,CAAC,CAAC,CAAC;QAC9F,IAAI,CAAC,OAAO,CAAC,EAAE,CAAC,WAAW,EAAE,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,SAAS,CAAC,IAAI,CAAC,YAAY,CAAC,EAAE,IAAI,CAAC,CAAC,CAAC;QAChG,IAAI,CAAC,OAAO,CAAC,EAAE,CAAC,OAAO,EAAE,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,SAAS,CAAC,IAAI,CAAC,QAAQ,CAAC,EAAE,IAAI,CAAC,CAAC,CAAC;QACxF,GAAG,CAAC,MAAM,CAAC,EAAE,CAAC,kBAAkB,EAAE,IAAI,CAAC,aAAa,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC;QACjE,IAAI,CAAC,aAAa,CAAC,EAAE,MAAM,EAAE,EAAE,IAAI,EAAE,IAAI,CAAC,IAAI,CAAC,WAAW,EAAE,EAAE,CAAC,CAAC;IACjE,CAAC;IAED,WAAW,EAAE;QACZ,IAAI,CAAC,OAAO,CAAC,GAAG,CAAC,cAAc,EAAE,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,SAAS,CAAC,IAAI,CAAC,SAAS,CAAC,EAAE,IAAI,CAAC,CAAC,CAAC;QACjG,IAAI,CAAC,OAAO,CAAC,GAAG,CAAC,KAAK,EAAE,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,SAAS,CAAC,IAAI,CAAC,MAAM,CAAC,EAAE,IAAI,CAAC,CAAC,CAAC;QACrF,IAAI,CAAC,OAAO,CAAC,GAAG,CAAC,UAAU,EAAE,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,SAAS,CAAC,IAAI,CAAC,WAAW,CAAC,EAAE,IAAI,CAAC,CAAC,CAAC;QAC/F,IAAI,CAAC,OAAO,CAAC,GAAG,CAAC,KAAK,EAAE,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,SAAS,CAAC,IAAI,CAAC,MAAM,CAAC,EAAE,IAAI,CAAC,CAAC,CAAC;QACrF,IAAI,CAAC,OAAO,CAAC,GAAG,CAAC,QAAQ,EAAE,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,SAAS,CAAC,IAAI,CAAC,SAAS,CAAC,EAAE,IAAI,CAAC,CAAC,CAAC;QAC3F,IAAI,CAAC,OAAO,CAAC,GAAG,CAAC,YAAY,EAAE,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,SAAS,CAAC,IAAI,CAAC,aAAa,CAAC,EAAE,IAAI,CAAC,CAAC,CAAC;QACnG,IAAI,CAAC,OAAO,CAAC,GAAG,CAAC,WAAW,EAAE,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,SAAS,CAAC,IAAI,CAAC,QAAQ,CAAC,EAAE,IAAI,CAAC,CAAC,CAAC;QAC7F,IAAI,CAAC,OAAO,CAAC,GAAG,CAAC,UAAU,EAAE,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,SAAS,CAAC,IAAI,CAAC,WAAW,CAAC,EAAE,IAAI,CAAC,CAAC,CAAC;QAC/F,IAAI,CAAC,OAAO,CAAC,GAAG,CAAC,WAAW,EAAE,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,SAAS,CAAC,IAAI,CAAC,YAAY,CAAC,EAAE,IAAI,CAAC,CAAC,CAAC;QACjG,IAAI,CAAC,OAAO,CAAC,GAAG,CAAC,OAAO,EAAE,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,SAAS,CAAC,IAAI,CAAC,QAAQ,CAAC,EAAE,IAAI,CAAC,CAAC,CAAC;QACzF,IAAI,CAAC,OAAO,CAAC,GAAG,CAAC,WAAW,EAAE,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,SAAS,CAAC,IAAI,CAAC,YAAY,CAAC,EAAE,IAAI,CAAC,CAAC,CAAC;QACjG,IAAI,CAAC,OAAO,CAAC,GAAG,CAAC,OAAO,EAAE,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,SAAS,CAAC,IAAI,CAAC,QAAQ,CAAC,EAAE,IAAI,CAAC,CAAC,CAAC;IAC1F,CAAC;IAED,aAAa,EAAE,UAAU,CAAC;QACzB,IAAI,CAAC,CAAC,MAAM,CAAC,IAAI,IAAI,MAAM,EAAE;YAC5B,IAAI,CAAC,OAAO,CAAC,EAAE,CAAC,WAAW,EAAE,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,SAAS,CAAC,IAAI,CAAC,YAAY,CAAC,EAAE,IAAI,CAAC,CAAC,CAAC;YAChG,IAAI,CAAC,OAAO,CAAC,EAAE,CAAC,OAAO,EAAE,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,SAAS,CAAC,IAAI,CAAC,QAAQ,CAAC,EAAE,IAAI,CAAC,CAAC,CAAC;SACxF;aAAM;YACN,IAAI,CAAC,OAAO,CAAC,GAAG,CAAC,WAAW,EAAE,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,SAAS,CAAC,IAAI,CAAC,YAAY,CAAC,EAAE,IAAI,CAAC,CAAC,CAAC;YACjG,IAAI,CAAC,OAAO,CAAC,GAAG,CAAC,OAAO,EAAE,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,SAAS,CAAC,IAAI,CAAC,QAAQ,CAAC,EAAE,IAAI,CAAC,CAAC,CAAC;SACzF;IACF,CAAC;IAED,SAAS,EAAE,UAAU,CAAC;QACrB,IAAI,IAAI,CAAC,IAAI,CAAC,SAAS,CAAC,WAAW,EAAE;YACpC,OAAO;QAER,GAAG,CAAC,WAAW,CAAC,YAAY,EAAE,CAAC;QAE/B,sEAAsE;QACtE,kDAAkD;QAClD,sEAAsE;QACtE,oEAAoE;QACpE,oDAAoD;QACpD,SAAS,qBAAqB,CAAE,GAAG;YAClC,KAAK,IAAI,CAAC,IAAI,GAAG,CAAC,IAAI,CAAC,OAAO,EAAE;gBAC/B,IAAI,GAAG,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC,OAAO,IAAI,GAAG,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC,OAAO,CAAC,SAAS;uBACpE,GAAG,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC,OAAO,CAAC,WAAW,EAAE;oBAC5C,IAAI,GAAG,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC,OAAO,CAAC,SAAS,KAAK,SAAS;2BACnD,GAAG,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC,OAAO,CAAC,WAAW,KAAK,IAAI,EAAE;wBACrD,OAAO,GAAG,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC,OAAO,CAAC;qBACnC;iBACD;aACD;QACF,CAAC;QAED,IAAI,CAAC,CAAC,OAAO,EAAE;YACd,IAAI,KAAK,GAAG,CAAC,CAAC,QAAQ,CAAC,CAAC,CAAC,EACrB,cAAc,GAAG,IAAI,CAAC,IAAI,CAAC,0BAA0B,CAAC,KAAK,CAAC,EAC5D,UAAU,GAAG,IAAI,CAAC,IAAI,CAAC,0BAA0B,CAAC,cAAc,CAAC,EACjE,MAAM,GAAG,IAAI,CAAC,IAAI,CAAC,kBAAkB,CAAC,UAAU,CAAC,EACrD,qBAAqB,GAAG,qBAAqB,CAAC,IAAI,CAAC,CAAC;YAEpD,IAAI,UAAU,GAAG,IAAI,CAAC,IAAI,CAAC,SAAS,CAAC,cAAc,CAAC,MAAM,CAAC,CAAC;YAC5D,UAAU,GAAG,IAAI,GAAG,CAAC,WAAW,CAAC,WAAW,CAAC,UAAU,CAAC,CAAC,EAAE,UAAU,CAAC,CAAC,CAAC,CAAC;YAEzE,IAAI,GAAG,CAAC,IAAI,CAAC,iBAAiB,IAAI,GAAG,CAAC,IAAI,CAAC,mBAAmB,CAAC,aAAa,CAAC,UAAU,CAAC,OAAO,EAAE,CAAC,EAAE;gBACnG,IAAI,CAAC,MAAM,GAAG,CAAC,CAAC,GAAG,CAAC,YAAY,CAAC,MAAM,CAAC;aACxC;iBAAM,IAAI,GAAG,CAAC,IAAI,CAAC,iBAAiB,IAAI,qBAAqB,IAAI,qBAAqB,CAAC,QAAQ,CAAC,MAAM,CAAC,EAAE;gBACzG,IAAI,CAAC,MAAM,GAAG,CAAC,CAAC,GAAG,CAAC,YAAY,CAAC,MAAM,CAAC;aACxC;iBAAM;gBACN,IAAI,CAAC,MAAM,GAAG,CAAC,CAAC,GAAG,CAAC,YAAY,CAAC,GAAG,CAAC;aACrC;YACD,IAAI,CAAC,OAAO,GAAG,KAAK,CAAC;SACrB;QAED,IAAI,CAAC,CAAC,MAAM,IAAI,IAAI,CAAC,MAAM,KAAK,CAAC,CAAC,GAAG,CAAC,YAAY,CAAC,GAAG,EAAE;YACvD,IAAI,CAAC,MAAM,GAAG,CAAC,CAAC,GAAG,CAAC,YAAY,CAAC,OAAO,CAAC,GAAG,CAAC;YAC7C,IAAI,CAAC,OAAO,GAAG,KAAK,CAAC;SACrB;QAED,IAAI,CAAC,CAAC,CAAC,CAAC,QAAQ,CAAC,MAAM,CAAC,CAAC,GAAG,CAAC,IAAI,CAAC,IAAI,CAAC,QAAQ,CAAC,EAAE;YACjD,CAAC,CAAC,QAAQ,CAAC,cAAc,CAAC,CAAC,CAAC,QAAQ,CAAC,CAAC;YACtC,CAAC,CAAC,QAAQ,CAAC,eAAe,CAAC,CAAC,CAAC,QAAQ,CAAC,CAAC;SACvC;IACF,CAAC;IAED,QAAQ,EAAE;QACT,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,YAAY,CAAC,OAAO,EAAE,EAAE;YACtC,IAAI,CAAC,IAAI,CAAC,YAAY,CAAC,MAAM,EAAE,CAAC;SAChC;QAED,MAAM,CAAC,aAAa,GAAG,SAAS,CAAC;IAClC,CAAC;IAED,QAAQ,EAAE,UAAU,CAAC;QACpB,IAAI,IAAI,CAAC,IAAI,CAAC,SAAS,CAAC,WAAW,EAAE;YACpC,OAAO;QAER,IAAI,KAAK,GAAG,CAAC,CAAC,QAAQ,CAAC,CAAC,CAAC,EACrB,cAAc,GAAG,IAAI,CAAC,IAAI,CAAC,0BAA0B,CAAC,KAAK,CAAC,EAC5D,UAAU,GAAG,IAAI,CAAC,IAAI,CAAC,0BAA0B,CAAC,cAAc,CAAC,EACjE,MAAM,GAAG,IAAI,CAAC,IAAI,CAAC,kBAAkB,CAAC,UAAU,CAAC,EACjD,QAAQ,GAAG,IAAI,CAAC,IAAI,CAAC,SAAS,CAAC,cAAc,CAAC,MAAM,CAAC,CAAC;QAE1D,IAAI,UAAU,GAAG,IAAI,GAAG,CAAC,WAAW,CAAC,WAAW,CAAC,QAAQ,CAAC,CAAC,EAAE,QAAQ,CAAC,CAAC,CAAC,CAAC;QAEzE,IAAI,IAAI,CAAC,OAAO,EAAE;YACjB,OAAO;SACP;QAED,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,aAAa,CAAC,CAAC;QAE9B,IAAI,IAAI,GAAG,IAAI,CAAC;QAChB,IAAI,QAAQ,GAAG,IAAI,CAAC,IAAI,CAAC,SAAS,CAAC;QAEnC,IAAI,WAAW,GAAG;YACjB,QAAQ,CAAC,eAAe,CAAC,YAAY,EAAE,QAAQ,CAAC,CAAC,EAAE,QAAQ,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC,CAAC;YACxE,QAAQ,CAAC,eAAe,CAAC,UAAU,EAAE,QAAQ,CAAC,CAAC,EAAE,QAAQ,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC,CAAC;QACvE,CAAC,CAAC;QAEF,IAAI,WAAW,GAAG;YACjB,QAAQ,CAAC,eAAe,CAAC,YAAY,EAAE,QAAQ,CAAC,CAAC,EAAE,QAAQ,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC,CAAC;YACxE,QAAQ,CAAC,eAAe,CAAC,UAAU,EAAE,QAAQ,CAAC,CAAC,EAAE,QAAQ,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC,CAAC;QACvE,CAAC,CAAC;QAEF,IAAI,UAAU,GAAG;YAChB,4FAA4F;YAC5F,QAAQ,CAAC,eAAe,CAAC,YAAY,EAAE,QAAQ,CAAC,CAAC,EAAE,QAAQ,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC,CAAC;QACzE,CAAC,CAAC;QAEF,IAAI,mBAAmB,GAAG;YACzB,6BAA6B;YAC7B,IAAI,gBAAgB,GAAG,gBAAgB,CAAC,SAAS,CAAC;YAClD,IAAI,CAAC,QAAQ,CAAC,sBAAsB;mBAChC,CAAC,CAAC,gBAAgB,IAAI,CAAC,gBAAgB,CAAC,aAAa,CAAC,UAAU,CAAC,OAAO,EAAE,CAAC,CAAC;mBAC5E,CAAC,CAAC,GAAG,CAAC,IAAI,CAAC,iBAAiB,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,mBAAmB,CAAC,aAAa,CAAC,UAAU,CAAC,OAAO,EAAE,CAAC,CAAC,EAAE;gBACvG,qBAAqB;gBACrB,WAAW,EAAE,CAAC;aACd;YACD,4CAA4C;YAC5C,IAAI,CAAC,IAAI,CAAC,YAAY,CAAC,YAAY,CAAC,EAAC,aAAa,EAAE,CAAC,CAAC,QAAQ,EAAC,CAAC,CAAC;YACjE,UAAU,EAAE,CAAC;QACd,CAAC,CAAC;QAEF,gFAAgF;QAChF,qFAAqF;QACrF,iFAAiF;QACjF,gFAAgF;QAChF,oFAAoF;QACpF,2CAA2C;QAC3C,wFAAwF;QACxF,8FAA8F;QAC9F,iFAAiF;QACjF,uDAAuD;QACvD,IAAI,gBAAgB,GAAG,gBAAgB,CAAC,SAAS,CAAC;QAClD,IAAI,YAAY,GAAG,KAAK,CAAC;QACzB,IAAI,GAAG,CAAC,IAAI,CAAC,iBAAiB;YAC7B,YAAY,GAAG,QAAQ,CAAC,iBAAiB,CAAC,MAAM,CAAC,CAAC;QACnD,IAAI,aAAa,CAAC;QAClB,IAAI,QAAQ,CAAC,iBAAiB,CAAC,KAAK,CAAC,SAAS,IAAI,QAAQ,CAAC,iBAAiB,CAAC,GAAG,CAAC,SAAS,EAAE;YAC3F,2CAA2C;YAC3C,aAAa,GAAG,IAAI,GAAG,CAAC,WAAW,CAAC,eAAe,CAAC,CAAC,EAAE,QAAQ,CAAC,iBAAiB,CAAC,GAAG,CAAC,SAAS,CAAC,EAAE,EAAE,GAAG,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC;YACxH,aAAa,CAAC,MAAM,GAAG,QAAQ,CAAC,iBAAiB,CAAC,GAAG,CAAC,SAAS,CAAC,EAAE,GAAG,QAAQ,CAAC,iBAAiB,CAAC,KAAK,CAAC,SAAS,CAAC,EAAE,CAAC;SACnH;QAED,IAAI,CAAC,aAAa,IAAI,aAAa,CAAC,aAAa,CAAC,UAAU,CAAC,OAAO,EAAE,CAAC,CAAC;eACpE,CAAC,gBAAgB,IAAI,gBAAgB,CAAC,aAAa,CAAC,UAAU,CAAC,OAAO,EAAE,CAAC,CAAC;eAC1E,CAAC,GAAG,CAAC,IAAI,CAAC,iBAAiB,IAAI,GAAG,CAAC,IAAI,CAAC,mBAAmB,CAAC,aAAa,CAAC,UAAU,CAAC,OAAO,EAAE,CAAC,CAAC,IAAI,YAAY,EAAE;YACrH,0CAA0C;YAC1C,4CAA4C;YAC5C,IAAI,CAAC,IAAI,CAAC,YAAY,CAAC,YAAY,CAAC,EAAC,aAAa,EAAE,CAAC,CAAC,QAAQ,EAAC,CAAC,CAAC;YACjE,UAAU,EAAE,CAAC;SACb;aACI;YACJ,yDAAyD;YACzD,WAAW,EAAE,CAAC;YACd,UAAU,CAAC,mBAAmB,EAAE,GAAG,CAAC,CAAC;SACrC;QAED,GAAG,CAAC,WAAW,CAAC,YAAY,EAAE,CAAC;QAC/B,CAAC,CAAC,cAAc,EAAE,CAAC;IACpB,CAAC;IAED,MAAM,EAAE,UAAU,CAAC;QAClB,IAAI,IAAI,CAAC,IAAI,CAAC,SAAS,CAAC,WAAW,EAAE;YACpC,OAAO;QAER,8DAA8D;QAC9D,2DAA2D;QAC3D,2DAA2D;QAC3D,wDAAwD;QACxD,wDAAwD;QACxD,8DAA8D;QAC9D,gEAAgE;QAChE,mDAAmD;QACnD,+DAA+D;QAC/D,2DAA2D;QAC3D,IAAI,CAAC,CAAC,QAAQ,GAAG,CAAC;YACjB,OAAO;QAER,IAAI,KAAK,GAAG,CAAC,CAAC,QAAQ,CAAC,CAAC,CAAC,EACrB,cAAc,GAAG,IAAI,CAAC,IAAI,CAAC,0BAA0B,CAAC,KAAK,CAAC,EAC5D,UAAU,GAAG,IAAI,CAAC,IAAI,CAAC,0BAA0B,CAAC,cAAc,CAAC,EACjE,MAAM,GAAG,IAAI,CAAC,IAAI,CAAC,kBAAkB,CAAC,UAAU,CAAC,EACjD,QAAQ,GAAG,IAAI,CAAC,IAAI,CAAC,SAAS,CAAC,cAAc,CAAC,MAAM,CAAC,CAAC;QAE1D,IAAI,UAAU,GAAG,IAAI,GAAG,CAAC,WAAW,CAAC,WAAW,CAAC,QAAQ,CAAC,CAAC,EAAE,QAAQ,CAAC,CAAC,CAAC,CAAC;QAEzE,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,mBAAmB,CAAC,CAAC;QAEpC,4IAA4I;QAC5I,IAAI,eAAe,CAAC;QACpB,IAAI,IAAI,CAAC,IAAI,CAAC,SAAS,CAAC,QAAQ,EAAE,EAAE;YACnC,eAAe,GAAG,QAAQ,CAAC,sBAAsB,CAAC,6CAA6C,CAAC,CAAC;SACjG;aAAM,IAAI,IAAI,CAAC,IAAI,CAAC,SAAS,CAAC,MAAM,EAAE,EAAE;YACxC,eAAe,GAAG,QAAQ,CAAC,sBAAsB,CAAC,kDAAkD,CAAC,CAAC;SACtG;QACD,IAAI,eAAe,IAAI,eAAe,CAAC,MAAM,IAAI,CAAC,IAAI,eAAe,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,MAAM,EAAE;YACrF,IAAI,CAAC,CAAC,MAAM,IAAI,eAAe,CAAC,CAAC,CAAC;gBACjC,OAAO,CAAC,qCAAqC;iBACzC;gBACJ,IAAI,OAAO,GAAG,GAAG,CAAC,gBAAgB,CAAC,kBAAkB,CAAC,CAAC,CAAC,SAAS,CAAC,cAAc,CAAC,IAAI,CAAC,CAAC;gBAEvF,IAAI,OAAO,EAAE;oBACZ,OAAO,GAAG,OAAO,CAAC,iBAAiB,CAAC,eAAe,CAAC;oBACpD,IAAI,OAAO,IAAI,OAAO,CAAC,aAAa,CAAC,UAAU,CAAC,QAAQ,EAAE,CAAC,EAAE;wBAC5D,OAAO,CAAC,OAAO,EAAE,CAAC;wBAClB,OAAO,CAAC,qCAAqC;qBAC7C;iBACD;aACD;SACD;QAED,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,aAAa,CAAC,CAAC;QAC9B,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,gBAAgB,CAAC,CAAC;QAEjC,IAAI,QAAQ,GAAG,IAAI,CAAC,IAAI,CAAC,SAAS,CAAC;QAEnC,2CAA2C;QAC3C,IAAI,GAAG,CAAC,gBAAgB,CAAC,gBAAgB,CAAC,CAAC,CAAC,SAAS,CAAC,WAAW,CAAC,IAAI,CAAC,EAAE;YACxE,GAAG,CAAC,gBAAgB,CAAC,kBAAkB,CAAC,CAAC,CAAC,SAAS,CAAC,WAAW,CAAC,IAAI,CAAC,CAAC,QAAQ,EAAE,CAAC;SACjF;QAED,IAAI,CAAC,IAAI,CAAC,YAAY,CAAC,YAAY,CAAC,EAAC,aAAa,EAAE,CAAC,CAAC,QAAQ,EAAC,CAAC,CAAC;QAEjE,IAAI,WAAW,GAAG,KAAK,CAAC,CAAC,0BAA0B;QACnD,IAAI,eAAe,GAAG,IAAI,CAAC,CAAC,sCAAsC;QAClE,IAAI,QAAQ,EAAE;YACb,IAAI,gBAAgB,CAAC,kBAAkB,EAAE,EAAE;gBAC1C,wCAAwC;gBACxC,WAAW,GAAG,GAAG,CAAC,IAAI,CAAC,UAAU,CAAC,OAAO,CAAC;aAC1C;iBAAM,IAAI,QAAQ,CAAC,QAAQ,KAAK,MAAM,EAAE;gBACxC,WAAW,GAAG,IAAI,CAAC,CAAC,6CAA6C;aACjE;iBAAM,IAAI,QAAQ,CAAC,QAAQ,KAAK,aAAa,EAAE;gBAC/C,oDAAoD;gBACpD,WAAW,GAAG,CAAC,GAAG,CAAC,IAAI,CAAC,iBAAiB,IAAI,GAAG,CAAC,IAAI,CAAC,mBAAmB,CAAC,aAAa,CAAC,UAAU,CAAC,OAAO,EAAE,CAAC,CAAC,CAAC;gBAC/G,IAAI,WAAW,EAAE;oBAChB,yDAAyD;oBACzD,IAAI,IAAI,CAAC,IAAI,CAAC,UAAU,EAAE,EAAE;wBAC3B,QAAQ,CAAC,iBAAiB,CAAC,OAAO,EAAE,CAAC,EAAE,GAAG,CAAC,CAAC,CAAC,KAAK;wBAClD,eAAe,GAAG,KAAK,CAAC,CAAC,uCAAuC;qBAChE;iBAED;aACD;SACD;QAED,IAAI,eAAe,EAAE;YACpB,QAAQ,CAAC,eAAe,CAAC,YAAY,EAAE,QAAQ,CAAC,CAAC,EAAE,QAAQ,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC,CAAC;YACxE,QAAQ,CAAC,eAAe,CAAC,UAAU,EAAE,QAAQ,CAAC,CAAC,EAAE,QAAQ,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC,CAAC;SACtE;QAED,IAAI,CAAC,iBAAiB,GAAG,IAAI,CAAC;QAE9B,gDAAgD;QAChD,mDAAmD;QACnD,IAAI,CAAC,IAAI,CAAC,KAAK,CAAC,WAAW,CAAC,CAAC;IAC9B,CAAC;IAED,YAAY,EAAE,UAAU,CAAC;QACxB,IAAI,IAAI,CAAC,IAAI,CAAC,SAAS,CAAC,WAAW,EAAE;YACpC,OAAO;QAER,IAAI,KAAK,GAAG,CAAC,CAAC,QAAQ,CAAC,CAAC,CAAC,EACrB,cAAc,GAAG,IAAI,CAAC,IAAI,CAAC,0BAA0B,CAAC,KAAK,CAAC,EAC5D,UAAU,GAAG,IAAI,CAAC,IAAI,CAAC,0BAA0B,CAAC,cAAc,CAAC,EACjE,MAAM,GAAG,IAAI,CAAC,IAAI,CAAC,kBAAkB,CAAC,UAAU,CAAC,EACjD,QAAQ,GAAG,IAAI,CAAC,IAAI,CAAC,SAAS,CAAC,cAAc,CAAC,MAAM,CAAC,CAAC;QAE1D,IAAI,QAAQ,GAAG,IAAI,CAAC,IAAI,CAAC,SAAS,CAAC;QACnC,IAAI,QAAQ,EAAE;YACb,IAAI,QAAQ,CAAC,QAAQ,KAAK,aAAa,IAAI,CAAC,gBAAgB,CAAC,kBAAkB,EAAE,EAAE;gBAClF,gDAAgD;gBAChD,IAAI,IAAI,CAAC,IAAI,CAAC,UAAU,EAAE,EAAE;oBAC3B,QAAQ,CAAC,iBAAiB,CAAC,OAAO,EAAE,CAAC,EAAE,GAAG,CAAC,CAAC,CAAC,KAAK;iBAClD;aACD;iBAAM;gBACN,QAAQ,CAAC,eAAe,CAAC,YAAY,EAAE,QAAQ,CAAC,CAAC,EAAE,QAAQ,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC,CAAC;gBACxE,QAAQ,CAAC,eAAe,CAAC,UAAU,EAAE,QAAQ,CAAC,CAAC,EAAE,QAAQ,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC,CAAC;aACtE;YAED,kEAAkE;YAClE,IAAI,WAAW,GAAG,CAAC,gBAAgB,CAAC,kBAAkB,EAAE,IAAI,GAAG,CAAC,IAAI,CAAC,UAAU,CAAC,OAAO,CAAC;YAExF,IAAI,SAAS,CAAC,QAAQ,KAAK,QAAQ,IAAI,QAAQ,CAAC,QAAQ,KAAK,cAAc;gBAC1E,WAAW,GAAG,IAAI,CAAC;YAEpB,IAAI,CAAC,IAAI,CAAC,KAAK,CAAC,WAAW,CAAC,CAAC;SAC7B;IACF,CAAC;IAED,YAAY,EAAE,UAAU,CAAC;QACxB,IAAI,IAAI,CAAC,IAAI,CAAC,SAAS,CAAC,WAAW,EAAE;YACpC,OAAO;QAER,IAAI,KAAK,GAAG,CAAC,CAAC,QAAQ,CAAC,CAAC,CAAC,EACrB,cAAc,GAAG,IAAI,CAAC,IAAI,CAAC,0BAA0B,CAAC,KAAK,CAAC,EAC5D,UAAU,GAAG,IAAI,CAAC,IAAI,CAAC,0BAA0B,CAAC,cAAc,CAAC,EACjE,MAAM,GAAG,IAAI,CAAC,IAAI,CAAC,kBAAkB,CAAC,UAAU,CAAC,EACjD,QAAQ,GAAG,IAAI,CAAC,IAAI,CAAC,SAAS,CAAC,cAAc,CAAC,MAAM,CAAC,CAAC;QAE1D,IAAI,CAAC,IAAI,CAAC,SAAS,CAAC,eAAe,CAAC,YAAY,EAAE,QAAQ,CAAC,CAAC,EAAE,QAAQ,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,IAAI,CAAC,CAAC;QACtF,IAAI,CAAC,IAAI,CAAC,SAAS,CAAC,eAAe,CAAC,UAAU,EAAE,QAAQ,CAAC,CAAC,EAAE,QAAQ,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,IAAI,CAAC,CAAC;IACrF,CAAC;IAED,WAAW,EAAE,UAAU,CAAC;QACvB,IAAI,IAAI,CAAC,IAAI,CAAC,SAAS,CAAC,WAAW,EAAE;YACpC,OAAO;QAER,IAAI,MAAM,CAAC,aAAa;YACvB,OAAO;QAER,GAAG,CAAC,IAAI,CAAC,eAAe,CAAC,IAAI,CAAC,iBAAiB,CAAC,CAAC;QACjD,IAAI,KAAK,GAAG,CAAC,CAAC,QAAQ,CAAC,CAAC,CAAC,EACrB,cAAc,GAAG,IAAI,CAAC,IAAI,CAAC,0BAA0B,CAAC,KAAK,CAAC,EAC5D,UAAU,GAAG,IAAI,CAAC,IAAI,CAAC,0BAA0B,CAAC,cAAc,CAAC,EACjE,MAAM,GAAG,IAAI,CAAC,IAAI,CAAC,kBAAkB,CAAC,UAAU,CAAC,EACjD,QAAQ,GAAG,IAAI,CAAC,IAAI,CAAC,SAAS,CAAC,cAAc,CAAC,MAAM,CAAC,CAAC;QAE1D,IAAI,UAAU,GAAG,IAAI,GAAG,CAAC,WAAW,CAAC,WAAW,CAAC,QAAQ,CAAC,CAAC,EAAE,QAAQ,CAAC,CAAC,CAAC,CAAC;QAEzE,IAAI,aAAa,GAAG,IAAI,CAAC;QACzB,IAAI,mBAAmB,GAAG,IAAI,CAAC;QAC/B,IAAI,GAAG,CAAC,IAAI,CAAC,iBAAiB,EAAE;YAC/B,mBAAmB,GAAG,GAAG,CAAC,IAAI,CAAC,mBAAmB,CAAC,KAAK,EAAE,CAAC;YAC3D,mBAAmB,CAAC,EAAE,IAAI,mBAAmB,CAAC,MAAM,GAAG,aAAa,CAAC;YACrE,mBAAmB,CAAC,EAAE,IAAI,mBAAmB,CAAC,MAAM,GAAG,aAAa,CAAC;SACrE;QAED,IAAI,mBAAmB,IAAI,mBAAmB,CAAC,aAAa,CAAC,UAAU,CAAC,OAAO,EAAE,CAAC,EAAE;YACnF,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,mBAAmB,CAAC,aAAa,CAAC,UAAU,CAAC,OAAO,EAAE,CAAC,EAAE;gBACtE,IAAI,CAAC,GAAG,UAAU,CAAC,CAAC,CAAC;gBACrB,IAAI,CAAC,GAAG,UAAU,CAAC,CAAC,CAAC;gBAErB,IAAI,YAAY,GAAG,IAAI,CAAC,GAAG,CAAC,GAAG,CAAC,IAAI,CAAC,mBAAmB,CAAC,OAAO,CAAC,GAAG,aAAa,CAAC;gBAElF,IAAI,CAAC,GAAG,GAAG,CAAC,IAAI,CAAC,mBAAmB,CAAC,EAAE,EAAE;oBACxC,CAAC,GAAG,CAAC,GAAG,YAAY,CAAC;iBACrB;gBAED,IAAI,CAAC,GAAG,GAAG,CAAC,IAAI,CAAC,mBAAmB,CAAC,EAAE,EAAE;oBACxC,CAAC,GAAG,CAAC,GAAG,YAAY,CAAC;iBACrB;gBAED,QAAQ,GAAG,IAAI,CAAC,CAAC,KAAK,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC;aAC7B;SACD;QAED,IAAI,IAAI,CAAC,MAAM,KAAK,CAAC,CAAC,GAAG,CAAC,YAAY,CAAC,MAAM,EAAE;YAC9C,IAAI,CAAC,IAAI,CAAC,SAAS,CAAC,eAAe,CAAC,YAAY,EAAE,QAAQ,CAAC,CAAC,EAAE,QAAQ,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC,CAAC;SACnF;aAAM;YACN,IAAI,CAAC,IAAI,CAAC,QAAQ,CAAC,UAAU,CAAC,OAAO,CAAC,IAAI,CAAC,mBAAmB,CAAC,KAAK,EAAE,WAAW,CAAC,CAAC,CAAC;SACpF;QAED,+BAA+B;QAC/B,IAAI,WAAW,GAAG,IAAI,CAAC,IAAI,CAAC,sBAAsB,EAAE,CAAC;QACrD,IAAI,CAAC,IAAI,CAAC,KAAK,CAAC,WAAW,CAAC,CAAC;IAC9B,CAAC;IAED,MAAM,EAAE,UAAU,CAAC;QAClB,IAAI,IAAI,CAAC,IAAI,CAAC,SAAS,CAAC,WAAW,EAAE;YACpC,OAAO;QAER,IAAI,MAAM,CAAC,aAAa;YACvB,OAAO;QAER,IAAI,IAAI,CAAC,cAAc,IAAK,IAAI,CAAC,GAAG,CAAC,CAAC,CAAC,QAAQ,CAAC,GAAG,IAAI,CAAC,OAAO,CAAC,GAAG,CAAC,OAAO,CAAC,CAAC,OAAO,CAAC,QAAQ,EAAE;YAC9F,IAAI,CAAC,oBAAoB,EAAE,CAAC;SAC5B;QAED,IAAI,KAAK,GAAG,CAAC,CAAC,QAAQ,CAAC,CAAC,CAAC,EACxB,cAAc,GAAG,IAAI,CAAC,IAAI,CAAC,0BAA0B,CAAC,KAAK,CAAC,EAC5D,UAAU,GAAG,IAAI,CAAC,IAAI,CAAC,0BAA0B,CAAC,cAAc,CAAC,EACjE,MAAM,GAAG,IAAI,CAAC,IAAI,CAAC,kBAAkB,CAAC,UAAU,CAAC,EACjD,QAAQ,GAAG,IAAI,CAAC,IAAI,CAAC,SAAS,CAAC,cAAc,CAAC,MAAM,CAAC,CAAC;QACvD,IAAI,IAAI,CAAC,MAAM,KAAK,CAAC,CAAC,GAAG,CAAC,YAAY,CAAC,MAAM,EAAE;YAC9C,IAAI,CAAC,IAAI,CAAC,SAAS,CAAC,eAAe,CAAC,MAAM,EAAE,QAAQ,CAAC,CAAC,EAAE,QAAQ,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC,CAAC;SAC7E;aAAM,IAAI,IAAI,CAAC,IAAI,CAAC,kBAAkB,KAAK,KAAK,EAAE;YAClD,IAAI,CAAC,IAAI,CAAC,QAAQ,CAAC,UAAU,CAAC,OAAO,CAAC,IAAI,CAAC,mBAAmB,CAAC,KAAK,EAAE,WAAW,CAAC,CAAC,CAAC;SACpF;QAED,GAAG,CAAC,WAAW,CAAC,YAAY,EAAE,CAAC;IAChC,CAAC;IAED,SAAS,EAAE,UAAU,CAAC;QACrB,IAAI,IAAI,CAAC,IAAI,CAAC,SAAS,CAAC,WAAW,EAAE;YACpC,OAAO;QAER,IAAI,MAAM,CAAC,aAAa;YACvB,OAAO;QAER,IAAI,KAAK,GAAG,CAAC,CAAC,QAAQ,CAAC,CAAC,CAAC,EACrB,cAAc,GAAG,IAAI,CAAC,IAAI,CAAC,0BAA0B,CAAC,KAAK,CAAC,EAC5D,UAAU,GAAG,IAAI,CAAC,IAAI,CAAC,0BAA0B,CAAC,cAAc,CAAC,EACjE,MAAM,GAAG,IAAI,CAAC,IAAI,CAAC,kBAAkB,CAAC,UAAU,CAAC,EACjD,QAAQ,GAAG,IAAI,CAAC,IAAI,CAAC,SAAS,CAAC,cAAc,CAAC,MAAM,CAAC,CAAC;QAE1D,IAAI,IAAI,CAAC,MAAM,KAAK,CAAC,CAAC,GAAG,CAAC,YAAY,CAAC,MAAM,EAAE;YAC9C,IAAI,CAAC,IAAI,CAAC,SAAS,CAAC,eAAe,CAAC,UAAU,EAAE,QAAQ,CAAC,CAAC,EAAE,QAAQ,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC,CAAC;SACjF;aAAM;YACN,IAAI,CAAC,IAAI,CAAC,QAAQ,CAAC,UAAU,CAAC,KAAK,CAAC,IAAI,CAAC,mBAAmB,CAAC,KAAK,EAAE,SAAS,CAAC,CAAC,CAAC;SAChF;QAED,+BAA+B;QAC/B,IAAI,WAAW,GAAG,IAAI,CAAC,IAAI,CAAC,sBAAsB,EAAE,CAAC;QACrD,IAAI,CAAC,IAAI,CAAC,KAAK,CAAC,WAAW,CAAC,CAAC;IAC9B,CAAC;IAED,aAAa,EAAE,UAAU,CAAC;QACzB,IAAI,IAAI,CAAC,IAAI,CAAC,SAAS,CAAC,WAAW,EAAE;YACpC,OAAO;QAER,IAAI,IAAI,CAAC,cAAc,EAAE;YACxB,IAAI,CAAC,oBAAoB,EAAE,CAAC;SAC5B;QAED,IAAI,KAAK,CAAC,CAAC,CAAC,MAAM,CAAC,CAAC,CAAC,IAAI,KAAK,CAAC,CAAC,CAAC,MAAM,CAAC,CAAC,CAAC;YACzC,OAAO;QAER,IAAI,CAAC,iBAAiB,GAAG,EAAE,CAAC,EAAE,CAAC,CAAC,MAAM,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC,MAAM,CAAC,CAAC,EAAE,CAAC;QAC1D,IAAM,iBAAiB,GAAG,IAAI,CAAC,IAAI,CAAC,kBAAkB,CAAC,EAAE,OAAO,EAAE,CAAC,CAAC,MAAM,CAAC,CAAC,EAAE,OAAO,EAAE,CAAC,CAAC,MAAM,CAAC,CAAC,EAAE,CAAC,CAAC;QACrG,IAAI,CAAC,IAAI,CAAC,SAAS,CAAC,gBAAgB,CAAC,iBAAiB,CAAC,CAAC;IACzD,CAAC;IAED,QAAQ,EAAE,UAAU,CAAC;QACpB,IAAI,IAAI,CAAC,IAAI,CAAC,SAAS,CAAC,WAAW,EAAE;YACpC,OAAO;QAER,IAAI,CAAC,IAAI,CAAC,iBAAiB,IAAI,KAAK,CAAC,CAAC,CAAC,MAAM,CAAC,CAAC,CAAC,IAAI,KAAK,CAAC,CAAC,CAAC,MAAM,CAAC,CAAC,CAAC;YACpE,OAAO;QAER,6EAA6E;QAC7E,IAAI,MAAM,GAAG,EAAC,CAAC,EAAE,CAAC,CAAC,MAAM,CAAC,CAAC,GAAG,IAAI,CAAC,iBAAiB,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC,MAAM,CAAC,CAAC,GAAG,IAAI,CAAC,iBAAiB,CAAC,CAAC,EAAC,CAAC;QAClG,IAAI,MAAM,GAAG,EAAC,CAAC,EAAE,IAAI,CAAC,iBAAiB,CAAC,CAAC,GAAG,MAAM,CAAC,CAAC,EAAE,CAAC,EAAE,IAAI,CAAC,iBAAiB,CAAC,CAAC,GAAG,MAAM,CAAC,CAAC,EAAC,CAAC;QAC9F,IAAI,CAAC,KAAK,GAAG,IAAI,CAAC,IAAI,CAAC,UAAU,CAAC,IAAI,CAAC,IAAI,CAAC,YAAY,CAAC,CAAC,CAAC,KAAK,CAAC,CAAC,CAAC;QACnE,IAAI,CAAC,WAAW,GAAG,IAAI,CAAC,IAAI,CAAC,kBAAkB,CAAC,EAAC,OAAO,EAAE,MAAM,CAAC,CAAC,EAAE,OAAO,EAAE,MAAM,CAAC,CAAC,EAAC,CAAC,CAAC;QAGxF,IAAI,IAAI,CAAC,IAAI,CAAC,SAAS,CAAC,QAAQ,EAAE;YACjC,IAAI,CAAC,IAAI,CAAC,SAAS,CAAC,QAAQ,CAAC,IAAI,CAAC,KAAK,EAAE,IAAI,CAAC,WAAW,CAAC,CAAC;SAC3D;QAED,GAAG,CAAC,WAAW,CAAC,YAAY,EAAE,CAAC;IAChC,CAAC;IAED,WAAW,EAAE;QACZ,IAAI,IAAI,CAAC,IAAI,CAAC,SAAS,CAAC,WAAW,EAAE;YACpC,OAAO;QAER,IAAI,CAAC,IAAI,CAAC,iBAAiB;YAC1B,OAAO;QAER,IAAI,OAAO,GAAG,IAAI,CAAC,IAAI,CAAC,OAAO,EAAE,CAAC;QAClC,IAAI,SAAS,GAAG,IAAI,CAAC,KAAK,GAAG,OAAO,CAAC;QACrC,IAAI,SAAS,GAAG,IAAI,CAAC,IAAI,CAAC,UAAU,CAAC,SAAS,GAAG,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC,CAAC;QAErG,IAAI,CAAC,iBAAiB,GAAG,SAAS,CAAC;QAEnC,IAAI,IAAI,CAAC,IAAI,CAAC,SAAS,CAAC,WAAW,EAAE;YACpC,IAAI,OAAO,GAAG,IAAI,CAAC;YACnB,IAAI,CAAC,IAAI,CAAC,SAAS,CAAC,WAAW,CAAC,SAAS,EAAE,IAAI,CAAC,WAAW,EAC1D,UAAU,YAAY;gBACrB,OAAO,CAAC,IAAI,CAAC,OAAO,CAAC,YAAY,EAAE,SAAS,CAAC,CAAC;YAC/C,CAAC;YACD,cAAc;YACd;gBACC,OAAO,CAAC,IAAI,CAAC,SAAS,CAAC,iBAAiB,EAAE,CAAC;YAC5C,CAAC,CAAC,CAAC;SACJ;IACF,CAAC;IAED,mBAAmB,EAAE,UAAU,GAAG,EAAE,IAAI;QACvC,IAAI,OAAO,GAAG;YACb,IAAI,EAAE,IAAI;YACV,SAAS,EAAE,KAAK;YAChB,UAAU,EAAE,IAAI;YAChB,OAAO,EAAE,GAAG,CAAC,OAAO;YACpB,OAAO,EAAE,GAAG,CAAC,OAAO;YACpB,OAAO,EAAE,GAAG,CAAC,OAAO;YACpB,OAAO,EAAE,GAAG,CAAC,OAAO;YACpB,OAAO,EAAE,KAAK;YACd,MAAM,EAAE,KAAK;YACb,QAAQ,EAAE,KAAK;YACf,OAAO,EAAE,KAAK;YACd,MAAM,EAAE,CAAC;YACT,MAAM,EAAE,GAAG,CAAC,MAAM;YAClB,cAAc,EAAE,cAAa,CAAC;SAC9B,CAAC;QAEF,OAAO,OAAO,CAAC;IAChB,CAAC;IAED,wEAAwE;IACxE,+DAA+D;IAC/D,4EAA4E;IAE5E,QAAQ,EAAE,UAAU,CAAC;QACpB,IAAI,IAAI,CAAC,IAAI,CAAC,SAAS,CAAC,WAAW,EAAE;YACpC,OAAO;QAER,IAAI,MAAM,CAAC,aAAa;YACvB,OAAO;QAER,IAAI,SAAS,GAAG,IAAI,CAAC,IAAI,CAAC,SAAS,CAAC,SAAS,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,SAAS,CAAC,CAAC,CAAC,CAAC,CAAC,SAAS,CAAC;QAC7E,IAAI,aAAa,GAAG,IAAI,CAAC,CAAC,KAAK,CAAC,SAAS,EAAE,CAAC,CAAC,SAAS,CAAC,CAAC;QACxD,IAAI,IAAI,CAAC,cAAc,EAAE;YACxB,IAAI,CAAC,SAAS,GAAG,IAAI,CAAC,SAAS,CAAC,GAAG,CAAC,aAAa,CAAC,CAAC;SACnD;aACI;YACJ,IAAI,CAAC,SAAS,GAAG,aAAa,CAAC;SAC/B;QACD,IAAI,CAAC,UAAU,GAAG,IAAI,CAAC,SAAS,CAAC,UAAU,CAAC,EAAE,CAAC,CAAC;QAChD,IAAI,CAAC,OAAO,GAAG,CAAC,CAAC,OAAO,CAAC,WAAW,CAAC,IAAI,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;QACzD,IAAI,GAAG,GAAG,IAAI,CAAC,mBAAmB,CAAC;YAClC,OAAO,EAAE,CAAC,CAAC,MAAM,CAAC,CAAC;YACnB,OAAO,EAAE,CAAC,CAAC,MAAM,CAAC,CAAC;YACnB,MAAM,EAAE,IAAI,CAAC,IAAI,CAAC,QAAQ;SAC1B,EAAC,WAAW,CAAC,CAAC;QACf,IAAI,CAAC,gBAAgB,GAAG,IAAI,CAAC,CAAC,KAAK,CAAC,GAAG,CAAC,OAAO,EAAE,GAAG,CAAC,OAAO,CAAC,CAAC;QAC9D,IAAI,CAAC,IAAI,CAAC,QAAQ,CAAC,UAAU,CAAC,OAAO,CAAC,GAAG,CAAC,CAAC;QAC3C,IAAI,CAAC,UAAU,GAAG,IAAI,CAAC,GAAG,EAAE,CAAC;QAC7B,IAAI,CAAC,cAAc,GAAG,IAAI,CAAC;QAC3B,IAAI,CAAC,iBAAiB,GAAG,GAAG,CAAC,IAAI,CAAC,gBAAgB,CAAC,IAAI,CAAC,WAAW,EAAE,IAAI,CAAC,CAAC;QAE3E,GAAG,CAAC,WAAW,CAAC,YAAY,EAAE,CAAC;IAChC,CAAC;IAED,oBAAoB,EAAE;QACrB,IAAI,CAAC,iBAAiB,GAAG,KAAK,CAAC;QAC/B,IAAI,CAAC,cAAc,GAAG,KAAK,CAAC;QAC5B,IAAI,GAAG,CAAC,IAAI,CAAC,aAAa;YACzB,IAAI,CAAC,IAAI,CAAC,SAAS,CAAC,kBAAkB,EAAE,CAAC;QAC1C,GAAG,CAAC,IAAI,CAAC,eAAe,CAAC,IAAI,CAAC,iBAAiB,CAAC,CAAC;QACjD,OAAO;IACR,CAAC;IAED,WAAW,EAAE;QACZ,IAAI,IAAI,CAAC,iBAAiB,KAAK,IAAI,EAAE;YACpC,IAAI,CAAC,oBAAoB,EAAE,CAAC;YAC5B,OAAO;SACP;QAED,IAAI,OAAO,EAAE,KAAK,CAAC;QAEnB,OAAO,GAAG,IAAI,CAAC,GAAG,EAAE,GAAG,IAAI,CAAC,UAAU,CAAC;QACvC,KAAK,GAAG,IAAI,CAAC,UAAU,CAAC,UAAU,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC,OAAO,GAAG,GAAG,CAAC,CAAC,CAAC;QAC7D,IAAI,CAAC,GAAG,IAAI,CAAC,mBAAmB,CAAC;YAChC,OAAO,EAAE,KAAK,CAAC,CAAC,GAAG,IAAI,CAAC,gBAAgB,CAAC,CAAC;YAC1C,OAAO,EAAE,KAAK,CAAC,CAAC,GAAG,IAAI,CAAC,gBAAgB,CAAC,CAAC;YAC1C,MAAM,EAAE,IAAI,CAAC,IAAI,CAAC,QAAQ;SAC1B,EAAE,WAAW,CAAC,CAAC;QAChB,CAAC,CAAC,UAAU,GAAG,IAAI,CAAC;QACpB,IAAI,KAAK,CAAC,CAAC,GAAG,GAAG,IAAI,KAAK,CAAC,CAAC,GAAG,CAAC,GAAG,IAAI,KAAK,CAAC,CAAC,GAAG,GAAG,IAAI,KAAK,CAAC,CAAC,GAAG,CAAC,GAAG,EAAE;YACvE,IAAI,GAAG,GAAG,IAAI,CAAC,IAAI,CAAC,cAAc,EAAE,CAAC;YACrC,IAAI,OAAO,GAAG,IAAI,CAAC,IAAI,CAAC,iBAAiB,EAAE,CAAC,OAAO,EAAE,CAAC,QAAQ,CAAC,IAAI,CAAC,IAAI,CAAC,OAAO,EAAE,CAAC,CAAC;YACpF,IAAI,aAAa,EAAE,WAAW,CAAC;YAE/B,IAAI,IAAI,CAAC,IAAI,CAAC,UAAU,EAAE,CAAC,CAAC,GAAG,IAAI,CAAC,IAAI,CAAC,OAAO,EAAE,CAAC,CAAC,EAAE;gBACrD,qDAAqD;gBACrD,KAAK,CAAC,CAAC,GAAG,CAAC,CAAC;gBACZ,aAAa,GAAG,IAAI,CAAC;aACrB;iBAAM;gBACN,aAAa,GAAG,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,GAAG,CAAC,GAAG,CAAC,CAAC,EAAE,IAAI,CAAC,OAAO,CAAC,CAAC,CAAC,EAAE,GAAG,CAAC,CAAC,GAAG,IAAI,CAAC,GAAG,CAAC,OAAO,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,KAAK,IAAI,CAAC,OAAO,CAAC,CAAC,CAAC;aAC7G;YAED,IAAI,IAAI,CAAC,IAAI,CAAC,UAAU,EAAE,CAAC,CAAC,GAAG,IAAI,CAAC,IAAI,CAAC,OAAO,EAAE,CAAC,CAAC,EAAE;gBACrD,mDAAmD;gBACnD,KAAK,CAAC,CAAC,GAAG,CAAC,CAAC;gBACZ,WAAW,GAAG,IAAI,CAAC;aACnB;iBAAM;gBACN,WAAW,GAAG,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,GAAG,CAAC,GAAG,CAAC,CAAC,EAAE,IAAI,CAAC,OAAO,CAAC,CAAC,CAAC,EAAE,GAAG,CAAC,CAAC,GAAG,IAAI,CAAC,GAAG,CAAC,OAAO,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,KAAK,IAAI,CAAC,OAAO,CAAC,CAAC,CAAC;aAC3G;YAED,IAAI,CAAC,IAAI,CAAC,QAAQ,CAAC,UAAU,CAAC,WAAW,GAAG,IAAI,CAAC,gBAAgB,CAAC;YAClE,IAAI,CAAC,IAAI,CAAC,QAAQ,CAAC,UAAU,CAAC,SAAS,GAAG,IAAI,CAAC,OAAO,CAAC;YACvD,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;YAEzB,IAAI,CAAC,IAAI,CAAC,QAAQ,CAAC,UAAU,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC;YAEzC,6GAA6G;YAC7G,WAAW,CAAC,aAAa,EAAE,CAAC;YAC5B,WAAW,CAAC,aAAa,CAAC,IAAI,CAAC,qBAAqB,CAAC,CAAC;YAEtD,IAAI,CAAC,aAAa,IAAI,CAAC,WAAW,EAAE;gBACnC,IAAI,CAAC,iBAAiB,GAAG,GAAG,CAAC,IAAI,CAAC,gBAAgB,CAAC,IAAI,CAAC,WAAW,EAAE,IAAI,CAAC,CAAC;aAC3E;iBAAM;gBACN,IAAI,CAAC,cAAc,GAAG,KAAK,CAAC;gBAC5B,IAAI,GAAG,CAAC,IAAI,CAAC,aAAa;oBACzB,IAAI,CAAC,IAAI,CAAC,SAAS,CAAC,kBAAkB,EAAE,CAAC;aAC1C;SACD;aACI;YACJ,IAAI,CAAC,IAAI,CAAC,QAAQ,CAAC,UAAU,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC;YACvC,IAAI,CAAC,cAAc,GAAG,KAAK,CAAC;YAC5B,IAAI,GAAG,CAAC,IAAI,CAAC,aAAa;gBACzB,IAAI,CAAC,IAAI,CAAC,SAAS,CAAC,kBAAkB,EAAE,CAAC;SAC1C;IACF,CAAC;CACD,CAAC,CAAC","sourcesContent":["/* -*- js-indent-level: 8; fill-column: 100 -*- */\n/* global app */\n/*\n * L.Map.CalcTap is used to enable mobile taps.\n */\n\nL.Map.mergeOptions({\n\ttouchGesture: true,\n});\n\n/* global Hammer app $ GraphicSelection TileManager */\nL.Map.TouchGesture = L.Handler.extend({\n\tstatics: {\n\t\tMAP: 1,\n\t\tCURSOR: 2,\n\t\tGRAPHIC: 4,\n\t\tMARKER: 8,\n\t\tTABLE: 16\n\t},\n\n\tinitialize: function (map) {\n\t\tL.Handler.prototype.initialize.call(this, map);\n\t\tthis._state = L.Map.TouchGesture.MAP;\n\n\t\tif (!this._hammer) {\n\t\t\tthis._hammer = new Hammer(this._map._mapPane);\n\t\t\tthis._hammer.get('swipe').set({\n\t\t\t\tdirection: Hammer.DIRECTION_ALL\n\t\t\t});\n\t\t\tthis._hammer.get('pan').set({\n\t\t\t\tdirection: Hammer.DIRECTION_ALL\n\t\t\t});\n\t\t\tthis._hammer.get('pinch').set({\n\t\t\t\tenable: true\n\t\t\t});\n\t\t\t// avoid to trigger the context menu too early so the user can start panning in a relaxed way\n\t\t\tthis._hammer.get('press').set({\n\t\t\t\ttime: 500\n\t\t\t});\n\n\t\t\tthis._hammer.get('swipe').set({\n\t\t\t\tthreshold: 5\n\t\t\t});\n\n\t\t\tvar singleTap = this._hammer.get('tap');\n\t\t\tvar doubleTap = this._hammer.get('doubletap');\n\n\t\t\t// Multi-tap detection tolerates a slight change in coordinates\n\t\t\t// between the taps. The default of 10 is too small for our needs.\n\t\t\t// So we use something more sensible to make it easier for users.\n\t\t\tvar posThreshold = 100;\n\t\t\tdoubleTap.options.posThreshold = posThreshold;\n\n\t\t\tvar tripleTap = new Hammer.Tap({event: 'tripletap', taps: 3, posThreshold: posThreshold });\n\t\t\tthis._hammer.add(tripleTap);\n\t\t\ttripleTap.recognizeWith([doubleTap, singleTap]);\n\t\t\tvar hammer = this._hammer;\n\t\t\tL.DomEvent.on(this._map._mapPane, 'touchstart touchmove touchcancel', window.touch.touchOnly(L.DomEvent.preventDefault));\n\t\t\tL.DomEvent.on(this._map._mapPane, 'touchend', window.touch.touchOnly(function(e) {\n\t\t\t\t// sometimes inputs get stuck in hammer and further events get mixed with the old ones\n\t\t\t\t// this causes to a failure to use all the gestures properly.\n\t\t\t\t// This is a workaround until it is fixed by hammer.js\n\t\t\t\tif (hammer.input) {\n\t\t\t\t\tif (hammer.input.store)  {\n\t\t\t\t\t\thammer.input.store = [];\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tL.DomEvent.preventDefault(e);\n\t\t\t}));\n\n\t\t\tif (Hammer.prefixed(window, 'PointerEvent') !== undefined) {\n\t\t\t\tL.DomEvent.on(this._map._mapPane, 'pointerdown pointermove pointerup pointercancel', window.touch.touchOnly(L.DomEvent.preventDefault));\n\t\t\t}\n\n\t\t\t// IE10 has prefixed support, and case-sensitive\n\t\t\tif (window.MSPointerEvent && !window.PointerEvent) {\n\t\t\t\tL.DomEvent.on(this._map._mapPane, 'MSPointerDown MSPointerMove MSPointerUp MSPointerCancel', window.touch.touchOnly(L.DomEvent.preventDefault));\n\t\t\t}\n\n\t\t\tL.DomEvent.on(this._map._mapPane, 'mousedown mousemove mouseup', L.DomEvent.preventDefault);\n\t\t\tL.DomEvent.on(document, 'touchmove', L.DomEvent.preventDefault);\n\t\t}\n\n\t\tfor (var events in L.Draggable.MOVE) {\n\t\t\tL.DomEvent.on(document, L.Draggable.END[events], this._onDocUp, this);\n\t\t}\n\n\t\t/// $.contextMenu does not support touch events so,\n\t\t/// attach 'touchend' menu clicks event handler\n\t\tif (this._hammer.input instanceof Hammer.TouchInput) {\n\t\t\tvar $doc = $(document);\n\t\t\t$doc.on('click.contextMenu', '.context-menu-item', function (e) {\n\t\t\t\tvar $elem = $(this);\n\n\t\t\t\tif ($elem.data().contextMenu.selector === '.leaflet-layer') {\n\t\t\t\t\t$.contextMenu.handle.itemClick.apply(this, [e]);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t},\n\n\taddHooks: function () {\n\t\tthis._hammer.on('hammer.input', window.memo.bind(window.touch.touchOnly(this._onHammer), this));\n\t\tthis._hammer.on('tap', window.memo.bind(window.touch.touchOnly(this._onTap), this));\n\t\tthis._hammer.on('panstart', window.memo.bind(window.touch.touchOnly(this._onPanStart), this));\n\t\tthis._hammer.on('pan', window.memo.bind(window.touch.touchOnly(this._onPan), this));\n\t\tthis._hammer.on('panend', window.memo.bind(window.touch.touchOnly(this._onPanEnd), this));\n\t\tthis._hammer.on('pinchstart', window.memo.bind(window.touch.touchOnly(this._onPinchStart), this));\n\t\tthis._hammer.on('pinchmove', window.memo.bind(window.touch.touchOnly(this._onPinch), this));\n\t\tthis._hammer.on('pinchend', window.memo.bind(window.touch.touchOnly(this._onPinchEnd), this));\n\t\tthis._hammer.on('tripletap', window.memo.bind(window.touch.touchOnly(this._onTripleTap), this));\n\t\tthis._hammer.on('swipe', window.memo.bind(window.touch.touchOnly(this._onSwipe), this));\n\t\tapp.events.on('updatepermission', this._onPermission.bind(this));\n\t\tthis._onPermission({ detail: { perm: this._map._permission } });\n\t},\n\n\tremoveHooks: function () {\n\t\tthis._hammer.off('hammer.input', window.memo.bind(window.touch.touchOnly(this._onHammer), this));\n\t\tthis._hammer.off('tap', window.memo.bind(window.touch.touchOnly(this._onTap), this));\n\t\tthis._hammer.off('panstart', window.memo.bind(window.touch.touchOnly(this._onPanStart), this));\n\t\tthis._hammer.off('pan', window.memo.bind(window.touch.touchOnly(this._onPan), this));\n\t\tthis._hammer.off('panend', window.memo.bind(window.touch.touchOnly(this._onPanEnd), this));\n\t\tthis._hammer.off('pinchstart', window.memo.bind(window.touch.touchOnly(this._onPinchStart), this));\n\t\tthis._hammer.off('pinchmove', window.memo.bind(window.touch.touchOnly(this._onPinch), this));\n\t\tthis._hammer.off('pinchend', window.memo.bind(window.touch.touchOnly(this._onPinchEnd), this));\n\t\tthis._hammer.off('doubletap', window.memo.bind(window.touch.touchOnly(this._onDoubleTap), this));\n\t\tthis._hammer.off('press', window.memo.bind(window.touch.touchOnly(this._onPress), this));\n\t\tthis._hammer.off('tripletap', window.memo.bind(window.touch.touchOnly(this._onTripleTap), this));\n\t\tthis._hammer.off('swipe', window.memo.bind(window.touch.touchOnly(this._onSwipe), this));\n\t},\n\n\t_onPermission: function (e) {\n\t\tif (e.detail.perm == 'edit') {\n\t\t\tthis._hammer.on('doubletap', window.memo.bind(window.touch.touchOnly(this._onDoubleTap), this));\n\t\t\tthis._hammer.on('press', window.memo.bind(window.touch.touchOnly(this._onPress), this));\n\t\t} else {\n\t\t\tthis._hammer.off('doubletap', window.memo.bind(window.touch.touchOnly(this._onDoubleTap), this));\n\t\t\tthis._hammer.off('press', window.memo.bind(window.touch.touchOnly(this._onPress), this));\n\t\t}\n\t},\n\n\t_onHammer: function (e) {\n\t\tif (this._map.uiManager.isUIBlocked())\n\t\t\treturn;\n\n\t\tapp.idleHandler.notifyActive();\n\n\t\t// Function/Formula Wizard keeps the formula cell active all the time,\n\t\t// so the usual range selection doesn't work here.\n\t\t// Instead, the cells are highlighted with a certain color and opacity\n\t\t// to mark as selection. And that's why we are checking for it here.\n\t\t// FIXME: JS-ify. This code is written by a C++ dev.\n\t\tfunction getFuncWizRangeBounds (obj) {\n\t\t\tfor (var i in obj._map._layers) {\n\t\t\t\tif (obj._map._layers[i].options && obj._map._layers[i].options.fillColor\n\t\t\t\t\t&& obj._map._layers[i].options.fillOpacity) {\n\t\t\t\t\tif (obj._map._layers[i].options.fillColor === '#ef0fff'\n\t\t\t\t\t\t&& obj._map._layers[i].options.fillOpacity === 0.25) {\n\t\t\t\t\t\treturn obj._map._layers[i]._bounds;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (e.isFirst) {\n\t\t\tvar point = e.pointers[0],\n\t\t\t    containerPoint = this._map.mouseEventToContainerPoint(point),\n\t\t\t    layerPoint = this._map.containerPointToLayerPoint(containerPoint),\n\t\t\t    latlng = this._map.layerPointToLatLng(layerPoint),\n\t\t\tfuncWizardRangeBounds = getFuncWizRangeBounds(this);\n\n\t\t\tlet twipsPoint = this._map._docLayer._latLngToTwips(latlng);\n\t\t\ttwipsPoint = new app.definitions.simplePoint(twipsPoint.x, twipsPoint.y);\n\n\t\t\tif (app.calc.cellCursorVisible && app.calc.cellCursorRectangle.containsPoint(twipsPoint.toArray())) {\n\t\t\t\tthis._state = L.Map.TouchGesture.CURSOR;\n\t\t\t} else if (app.calc.cellCursorVisible && funcWizardRangeBounds && funcWizardRangeBounds.contains(latlng)) {\n\t\t\t\tthis._state = L.Map.TouchGesture.CURSOR;\n\t\t\t} else {\n\t\t\t\tthis._state = L.Map.TouchGesture.MAP;\n\t\t\t}\n\t\t\tthis._moving = false;\n\t\t}\n\n\t\tif (e.isLast && this._state !== L.Map.TouchGesture.MAP) {\n\t\t\tthis._state = L.Map.TouchGesture.hitTest.MAP;\n\t\t\tthis._moving = false;\n\t\t}\n\n\t\tif ($(e.srcEvent.target).has(this._map._mapPane)) {\n\t\t\tL.DomEvent.preventDefault(e.srcEvent);\n\t\t\tL.DomEvent.stopPropagation(e.srcEvent);\n\t\t}\n\t},\n\n\t_onDocUp: function () {\n\t\tif (!this._map.touchGesture.enabled()) {\n\t\t\tthis._map.touchGesture.enable();\n\t\t}\n\n\t\twindow.IgnorePanning = undefined;\n\t},\n\n\t_onPress: function (e) {\n\t\tif (this._map.uiManager.isUIBlocked())\n\t\t\treturn;\n\n\t\tvar point = e.pointers[0],\n\t\t    containerPoint = this._map.mouseEventToContainerPoint(point),\n\t\t    layerPoint = this._map.containerPointToLayerPoint(containerPoint),\n\t\t    latlng = this._map.layerPointToLatLng(layerPoint),\n\t\t    mousePos = this._map._docLayer._latLngToTwips(latlng);\n\n\t\tlet posInTwips = new app.definitions.simplePoint(mousePos.x, mousePos.y);\n\n\t\tif (this._moving) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis._map.fire('closepopups');\n\n\t\tvar that = this;\n\t\tvar docLayer = this._map._docLayer;\n\n\t\tvar singleClick = function () {\n\t\t\tdocLayer._postMouseEvent('buttondown', mousePos.x, mousePos.y, 1, 1, 0);\n\t\t\tdocLayer._postMouseEvent('buttonup', mousePos.x, mousePos.y, 1, 1, 0);\n\t\t};\n\n\t\tvar doubleClick = function () {\n\t\t\tdocLayer._postMouseEvent('buttondown', mousePos.x, mousePos.y, 2, 1, 0);\n\t\t\tdocLayer._postMouseEvent('buttonup', mousePos.x, mousePos.y, 2, 1, 0);\n\t\t};\n\n\t\tvar rightClick = function () {\n\t\t\t// We will only send \"buttondown\" event because core side fires \"buttonup\" event internally.\n\t\t\tdocLayer._postMouseEvent('buttondown', mousePos.x, mousePos.y, 1, 4, 0);\n\t\t};\n\n\t\tvar waitForSelectionMsg = function () {\n\t\t\t// check new selection if any\n\t\t\tvar graphicSelection = GraphicSelection.rectangle;\n\t\t\tif (!docLayer._cursorAtMispelledWord\n\t\t\t\t&& (!graphicSelection || !graphicSelection.containsPoint(posInTwips.toArray()))\n\t\t\t\t&& (!app.calc.cellCursorVisible || !app.calc.cellCursorRectangle.containsPoint(posInTwips.toArray()))) {\n\t\t\t\t// try to select text\n\t\t\t\tdoubleClick();\n\t\t\t}\n\t\t\t// send right click to trigger context menus\n\t\t\tthat._map._contextMenu._onMouseDown({originalEvent: e.srcEvent});\n\t\t\trightClick();\n\t\t};\n\n\t\t// we want to select the long touched object before triggering the context menu;\n\t\t// for selecting text we need to simulate a double click, anyway for a graphic object\n\t\t// a single click is enough, while a double click can lead to switch to edit mode\n\t\t// (not only for an embedded ole object, even for entering text inside a shape);\n\t\t// a similar problem regards spreadsheet cell: a single click moves the cell cursor,\n\t\t// while a double click enables text input;\n\t\t// in order to avoid these cases, we send a single click and wait for a few milliseconds\n\t\t// before checking if we received a possible selection message; if no such message is received\n\t\t// we simulate a double click for trying to select text and finally, in any case,\n\t\t// we trigger the context menu by sending a right click\n\t\tvar graphicSelection = GraphicSelection.rectangle;\n\t\tvar bContainsSel = false;\n\t\tif (app.calc.cellCursorVisible)\n\t\t\tbContainsSel = docLayer.containsSelection(latlng);\n\t\tvar textSelection;\n\t\tif (docLayer._selectionHandles.start.rectangle && docLayer._selectionHandles.end.rectangle) {\n\t\t\t// Oversimplication. See \"inBand\" function.\n\t\t\ttextSelection = new app.definitions.simpleRectangle(0, docLayer._selectionHandles.end.rectangle.y1, app.file.size.x, 0);\n\t\t\ttextSelection.height = docLayer._selectionHandles.end.rectangle.y2 - docLayer._selectionHandles.start.rectangle.y1;\n\t\t}\n\n\t\tif ((textSelection && textSelection.containsPoint(posInTwips.toArray()))\n\t\t\t|| (graphicSelection && graphicSelection.containsPoint(posInTwips.toArray()))\n\t\t\t|| (app.calc.cellCursorVisible && app.calc.cellCursorRectangle.containsPoint(posInTwips.toArray())) || bContainsSel) {\n\t\t\t// long touched an already selected object\n\t\t\t// send right click to trigger context menus\n\t\t\tthis._map._contextMenu._onMouseDown({originalEvent: e.srcEvent});\n\t\t\trightClick();\n\t\t}\n\t\telse {\n\t\t\t// try to select a graphic object or move the cell cursor\n\t\t\tsingleClick();\n\t\t\tsetTimeout(waitForSelectionMsg, 300);\n\t\t}\n\n\t\tapp.idleHandler.notifyActive();\n\t\te.preventDefault();\n\t},\n\n\t_onTap: function (e) {\n\t\tif (this._map.uiManager.isUIBlocked())\n\t\t\treturn;\n\n\t\t// We receive each tap here, even when double- and triple-taps\n\t\t// are detected. This is undesirable as the subsequent taps\n\t\t// processed here interfere with the double- and triple-tap\n\t\t// handlers, confusing Core (and the user) as the result\n\t\t// is not what's expected (objects not getting selected,\n\t\t// edit mode not entered, or toggled, keyboard toggles, etc.).\n\t\t// We only process the first tap and subsequent ones are handled\n\t\t// by the double-tap and triple-tap handlers below.\n\t\t// Note: Hammer has requireFailure() which suppresses this call\n\t\t// when multi-taps are detected. This isn't working for us.\n\t\tif (e.tapCount > 1)\n\t\t\treturn;\n\n\t\tvar point = e.pointers[0],\n\t\t    containerPoint = this._map.mouseEventToContainerPoint(point),\n\t\t    layerPoint = this._map.containerPointToLayerPoint(containerPoint),\n\t\t    latlng = this._map.layerPointToLatLng(layerPoint),\n\t\t    mousePos = this._map._docLayer._latLngToTwips(latlng);\n\n\t\tlet posInTwips = new app.definitions.simplePoint(mousePos.x, mousePos.y);\n\n\t\tthis._map.fire('closemobilewizard');\n\n\t\t// The validity and content control dropdown marker icon (exists in calc and writer) needs to be notified of tap events if it is the target.\n\t\tvar dropDownMarkers;\n\t\tif (this._map._docLayer.isWriter()) {\n\t\t\tdropDownMarkers = document.getElementsByClassName('html-object-section writer-drop-down-marker');\n\t\t} else if (this._map._docLayer.isCalc()) {\n\t\t\tdropDownMarkers = document.getElementsByClassName('leaflet-marker-icon spreadsheet-drop-down-marker');\n\t\t}\n\t\tif (dropDownMarkers && dropDownMarkers.length == 1 && dropDownMarkers[0] && e.target) {\n\t\t\tif (e.target == dropDownMarkers[0])\n\t\t\t\treturn; // don't send the mouse-event to core\n\t\t\telse {\n\t\t\t\tlet section = app.sectionContainer.getSectionWithName(L.CSections.ContentControl.name);\n\n\t\t\t\tif (section) {\n\t\t\t\t\tsection = section.sectionProperties.dropdownSection;\n\t\t\t\t\tif (section && section.containsPoint(posInTwips.pToArray())) {\n\t\t\t\t\t\tsection.onClick();\n\t\t\t\t\t\treturn; // don't send the mouse-event to core\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tthis._map.fire('closepopups');\n\t\tthis._map.fire('editorgotfocus');\n\n\t\tvar docLayer = this._map._docLayer;\n\n\t\t// unselect if anything is selected already\n\t\tif (app.sectionContainer.doesSectionExist(L.CSections.CommentList.name)) {\n\t\t\tapp.sectionContainer.getSectionWithName(L.CSections.CommentList.name).unselect();\n\t\t}\n\n\t\tthis._map._contextMenu._onMouseDown({originalEvent: e.srcEvent});\n\n\t\tvar acceptInput = false; // No keyboard by default.\n\t\tvar sendMouseEvents = true; // By default, this is a single-click.\n\t\tif (docLayer) {\n\t\t\tif (GraphicSelection.hasActiveSelection()) {\n\t\t\t\t// Need keyboard when cursor is visible.\n\t\t\t\tacceptInput = app.file.textCursor.visible;\n\t\t\t} else if (docLayer._docType === 'text') {\n\t\t\t\tacceptInput = true; // Always show the keyboard in Writer on tap.\n\t\t\t} else if (docLayer._docType === 'spreadsheet') {\n\t\t\t\t// If the tap is in the current cell, start editing.\n\t\t\t\tacceptInput = (app.calc.cellCursorVisible && app.calc.cellCursorRectangle.containsPoint(posInTwips.toArray()));\n\t\t\t\tif (acceptInput) {\n\t\t\t\t\t// Enter cell-edit mode on second tap of a selected cell.\n\t\t\t\t\tif (this._map.isEditMode()) {\n\t\t\t\t\t\tdocLayer.postKeyboardEvent('input', 0, 769); // F2\n\t\t\t\t\t\tsendMouseEvents = false; // Mouse events will exit editing mode.\n\t\t\t\t\t}\n\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (sendMouseEvents) {\n\t\t\tdocLayer._postMouseEvent('buttondown', mousePos.x, mousePos.y, 1, 1, 0);\n\t\t\tdocLayer._postMouseEvent('buttonup', mousePos.x, mousePos.y, 1, 1, 0);\n\t\t}\n\n\t\tthis._cancelAutoScroll = true;\n\n\t\t// Always move the focus to the document on tap,\n\t\t// but only show the keyboard when we need editing.\n\t\tthis._map.focus(acceptInput);\n\t},\n\n\t_onDoubleTap: function (e) {\n\t\tif (this._map.uiManager.isUIBlocked())\n\t\t\treturn;\n\n\t\tvar point = e.pointers[0],\n\t\t    containerPoint = this._map.mouseEventToContainerPoint(point),\n\t\t    layerPoint = this._map.containerPointToLayerPoint(containerPoint),\n\t\t    latlng = this._map.layerPointToLatLng(layerPoint),\n\t\t    mousePos = this._map._docLayer._latLngToTwips(latlng);\n\n\t\tvar docLayer = this._map._docLayer;\n\t\tif (docLayer) {\n\t\t\tif (docLayer._docType === 'spreadsheet' && !GraphicSelection.hasActiveSelection()) {\n\t\t\t\t// Enter cell-edit mode on double-taping a cell.\n\t\t\t\tif (this._map.isEditMode()) {\n\t\t\t\t\tdocLayer.postKeyboardEvent('input', 0, 769); // F2\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tdocLayer._postMouseEvent('buttondown', mousePos.x, mousePos.y, 2, 1, 0);\n\t\t\t\tdocLayer._postMouseEvent('buttonup', mousePos.x, mousePos.y, 2, 1, 0);\n\t\t\t}\n\n\t\t\t// Show keyboard when no graphic selection, or  cursor is visible.\n\t\t\tvar acceptInput = !GraphicSelection.hasActiveSelection() || app.file.textCursor.visible;\n\n\t\t\tif (navigator.platform === 'iPhone' && docLayer._docType === 'presentation')\n\t\t\t\tacceptInput = true;\n\n\t\t\tthis._map.focus(acceptInput);\n\t\t}\n\t},\n\n\t_onTripleTap: function (e) {\n\t\tif (this._map.uiManager.isUIBlocked())\n\t\t\treturn;\n\n\t\tvar point = e.pointers[0],\n\t\t    containerPoint = this._map.mouseEventToContainerPoint(point),\n\t\t    layerPoint = this._map.containerPointToLayerPoint(containerPoint),\n\t\t    latlng = this._map.layerPointToLatLng(layerPoint),\n\t\t    mousePos = this._map._docLayer._latLngToTwips(latlng);\n\n\t\tthis._map._docLayer._postMouseEvent('buttondown', mousePos.x, mousePos.y, 1, 1, 8192);\n\t\tthis._map._docLayer._postMouseEvent('buttonup', mousePos.x, mousePos.y, 1, 1, 8192);\n\t},\n\n\t_onPanStart: function (e) {\n\t\tif (this._map.uiManager.isUIBlocked())\n\t\t\treturn;\n\n\t\tif (window.IgnorePanning)\n\t\t\treturn;\n\n\t\tapp.util.cancelAnimFrame(this.autoscrollAnimReq);\n\t\tvar point = e.pointers[0],\n\t\t    containerPoint = this._map.mouseEventToContainerPoint(point),\n\t\t    layerPoint = this._map.containerPointToLayerPoint(containerPoint),\n\t\t    latlng = this._map.layerPointToLatLng(layerPoint),\n\t\t    mousePos = this._map._docLayer._latLngToTwips(latlng);\n\n\t\tlet posInTwips = new app.definitions.simplePoint(mousePos.x, mousePos.y);\n\n\t\tlet increaseRatio = 0.40;\n\t\tlet increasedCellCursor = null;\n\t\tif (app.calc.cellCursorVisible) {\n\t\t\tincreasedCellCursor = app.calc.cellCursorRectangle.clone();\n\t\t\tincreasedCellCursor.y1 -= increasedCellCursor.height * increaseRatio;\n\t\t\tincreasedCellCursor.y2 += increasedCellCursor.height * increaseRatio;\n\t\t}\n\n\t\tif (increasedCellCursor && increasedCellCursor.containsPoint(posInTwips.toArray())) {\n\t\t\tif (!app.calc.cellCursorRectangle.containsPoint(posInTwips.toArray())) {\n\t\t\t\tlet y = posInTwips.y;\n\t\t\t\tlet x = posInTwips.x;\n\n\t\t\t\tlet heightBuffer = Math.abs(app.calc.cellCursorRectangle.pHeight) * increaseRatio;\n\n\t\t\t\tif (y < app.calc.cellCursorRectangle.y2) {\n\t\t\t\t\ty = y + heightBuffer;\n\t\t\t\t}\n\n\t\t\t\tif (y > app.calc.cellCursorRectangle.y1) {\n\t\t\t\t\ty = y - heightBuffer;\n\t\t\t\t}\n\n\t\t\t\tmousePos = new L.Point(x, y);\n\t\t\t}\n\t\t}\n\n\t\tif (this._state === L.Map.TouchGesture.CURSOR) {\n\t\t\tthis._map._docLayer._postMouseEvent('buttondown', mousePos.x, mousePos.y, 1, 1, 0);\n\t\t} else {\n\t\t\tthis._map.dragging._draggable._onDown(this._constructFakeEvent(point, 'mousedown'));\n\t\t}\n\n\t\t// Keep the same keyboard state\n\t\tvar acceptInput = this._map.canAcceptKeyboardInput();\n\t\tthis._map.focus(acceptInput);\n\t},\n\n\t_onPan: function (e) {\n\t\tif (this._map.uiManager.isUIBlocked())\n\t\t\treturn;\n\n\t\tif (window.IgnorePanning)\n\t\t\treturn;\n\n\t\tif (this._inSwipeAction &&  Math.abs(e.velocity) < this._hammer.get('swipe').options.velocity) {\n\t\t\tthis._cancelAutoscrollRAF();\n\t\t}\n\n\t\tvar point = e.pointers[0],\n\t\t\tcontainerPoint = this._map.mouseEventToContainerPoint(point),\n\t\t\tlayerPoint = this._map.containerPointToLayerPoint(containerPoint),\n\t\t\tlatlng = this._map.layerPointToLatLng(layerPoint),\n\t\t\tmousePos = this._map._docLayer._latLngToTwips(latlng);\n\t\tif (this._state === L.Map.TouchGesture.CURSOR) {\n\t\t\tthis._map._docLayer._postMouseEvent('move', mousePos.x, mousePos.y, 1, 1, 0);\n\t\t} else if (this._map.scrollingIsHandled === false) {\n\t\t\tthis._map.dragging._draggable._onMove(this._constructFakeEvent(point, 'mousemove'));\n\t\t}\n\n\t\tapp.idleHandler.notifyActive();\n\t},\n\n\t_onPanEnd: function (e) {\n\t\tif (this._map.uiManager.isUIBlocked())\n\t\t\treturn;\n\n\t\tif (window.IgnorePanning)\n\t\t\treturn;\n\n\t\tvar point = e.pointers[0],\n\t\t    containerPoint = this._map.mouseEventToContainerPoint(point),\n\t\t    layerPoint = this._map.containerPointToLayerPoint(containerPoint),\n\t\t    latlng = this._map.layerPointToLatLng(layerPoint),\n\t\t    mousePos = this._map._docLayer._latLngToTwips(latlng);\n\n\t\tif (this._state === L.Map.TouchGesture.CURSOR) {\n\t\t\tthis._map._docLayer._postMouseEvent('buttonup', mousePos.x, mousePos.y, 1, 1, 0);\n\t\t} else {\n\t\t\tthis._map.dragging._draggable._onUp(this._constructFakeEvent(point, 'mouseup'));\n\t\t}\n\n\t\t// Keep the same keyboard state\n\t\tvar acceptInput = this._map.canAcceptKeyboardInput();\n\t\tthis._map.focus(acceptInput);\n\t},\n\n\t_onPinchStart: function (e) {\n\t\tif (this._map.uiManager.isUIBlocked())\n\t\t\treturn;\n\n\t\tif (this._inSwipeAction) {\n\t\t\tthis._cancelAutoscrollRAF();\n\t\t}\n\n\t\tif (isNaN(e.center.x) || isNaN(e.center.y))\n\t\t\treturn;\n\n\t\tthis._pinchStartCenter = { x: e.center.x, y: e.center.y };\n\t\tconst _pinchStartLatLng = this._map.mouseEventToLatLng({ clientX: e.center.x, clientY: e.center.y });\n\t\tthis._map._docLayer.preZoomAnimation(_pinchStartLatLng);\n\t},\n\n\t_onPinch: function (e) {\n\t\tif (this._map.uiManager.isUIBlocked())\n\t\t\treturn;\n\n\t\tif (!this._pinchStartCenter || isNaN(e.center.x) || isNaN(e.center.y))\n\t\t\treturn;\n\n\t\t// we need to invert the offset or the map is moved in the opposite direction\n\t\tvar offset = {x: e.center.x - this._pinchStartCenter.x, y: e.center.y - this._pinchStartCenter.y};\n\t\tvar center = {x: this._pinchStartCenter.x - offset.x, y: this._pinchStartCenter.y - offset.y};\n\t\tthis._zoom = this._map._limitZoom(this._map.getScaleZoom(e.scale));\n\t\tthis._origCenter = this._map.mouseEventToLatLng({clientX: center.x, clientY: center.y});\n\n\n\t\tif (this._map._docLayer.zoomStep) {\n\t\t\tthis._map._docLayer.zoomStep(this._zoom, this._origCenter);\n\t\t}\n\n\t\tapp.idleHandler.notifyActive();\n\t},\n\n\t_onPinchEnd: function () {\n\t\tif (this._map.uiManager.isUIBlocked())\n\t\t\treturn;\n\n\t\tif (!this._pinchStartCenter)\n\t\t\treturn;\n\n\t\tvar oldZoom = this._map.getZoom();\n\t\tvar zoomDelta = this._zoom - oldZoom;\n\t\tvar finalZoom = this._map._limitZoom(zoomDelta > 0 ? Math.ceil(this._zoom) : Math.floor(this._zoom));\n\n\t\tthis._pinchStartCenter = undefined;\n\n\t\tif (this._map._docLayer.zoomStepEnd) {\n\t\t\tvar thisObj = this;\n\t\t\tthis._map._docLayer.zoomStepEnd(finalZoom, this._origCenter,\n\t\t\t\tfunction (newMapCenter) { // mapUpdater\n\t\t\t\t\tthisObj._map.setView(newMapCenter, finalZoom);\n\t\t\t\t},\n\t\t\t\t// showMarkers\n\t\t\t\tfunction () {\n\t\t\t\t\tthisObj._map._docLayer.postZoomAnimation();\n\t\t\t\t});\n\t\t}\n\t},\n\n\t_constructFakeEvent: function (evt, type) {\n\t\tvar fakeEvt = {\n\t\t\ttype: type,\n\t\t\tcanBubble: false,\n\t\t\tcancelable: true,\n\t\t\tscreenX: evt.screenX,\n\t\t\tscreenY: evt.screenY,\n\t\t\tclientX: evt.clientX,\n\t\t\tclientY: evt.clientY,\n\t\t\tctrlKey: false,\n\t\t\taltKey: false,\n\t\t\tshiftKey: false,\n\t\t\tmetaKey: false,\n\t\t\tbutton: 0,\n\t\t\ttarget: evt.target,\n\t\t\tpreventDefault: function () {}\n\t\t};\n\n\t\treturn fakeEvt;\n\t},\n\n\t// Code and maths for the ergonomic scrolling is inspired by formulas at\n\t// https://ariya.io/2013/11/javascript-kinetic-scrolling-part-2\n\t// Some constants are changed based on the testing/experimenting/trial-error\n\n\t_onSwipe: function (e) {\n\t\tif (this._map.uiManager.isUIBlocked())\n\t\t\treturn;\n\n\t\tif (window.IgnorePanning)\n\t\t\treturn;\n\n\t\tlet velocityX = this._map._docLayer.isCalcRTL() ? -e.velocityX : e.velocityX;\n\t\tlet pointVelocity = new L.Point(velocityX, e.velocityY);\n\t\tif (this._inSwipeAction) {\n\t\t\tthis._velocity = this._velocity.add(pointVelocity);\n\t\t}\n\t\telse {\n\t\t\tthis._velocity = pointVelocity;\n\t\t}\n\t\tthis._amplitude = this._velocity.multiplyBy(32);\n\t\tthis._newPos = L.DomUtil.getPosition(this._map._mapPane);\n\t\tvar evt = this._constructFakeEvent({\n\t\t\tclientX: e.center.x,\n\t\t\tclientY: e.center.y,\n\t\t\ttarget: this._map._mapPane\n\t\t},'mousedown');\n\t\tthis._startSwipePoint = new L.Point(evt.clientX, evt.clientY);\n\t\tthis._map.dragging._draggable._onDown(evt);\n\t\tthis._timeStamp = Date.now();\n\t\tthis._inSwipeAction = true;\n\t\tthis.autoscrollAnimReq = app.util.requestAnimFrame(this._autoscroll, this);\n\n\t\tapp.idleHandler.notifyActive();\n\t},\n\n\t_cancelAutoscrollRAF: function () {\n\t\tthis._cancelAutoScroll = false;\n\t\tthis._inSwipeAction = false;\n\t\tif (app.file.fileBasedView)\n\t\t\tthis._map._docLayer._checkSelectedPart();\n\t\tapp.util.cancelAnimFrame(this.autoscrollAnimReq);\n\t\treturn;\n\t},\n\n\t_autoscroll: function() {\n\t\tif (this._cancelAutoScroll === true) {\n\t\t\tthis._cancelAutoscrollRAF();\n\t\t\treturn;\n\t\t}\n\n\t\tvar elapsed, delta;\n\n\t\telapsed = Date.now() - this._timeStamp;\n\t\tdelta = this._amplitude.multiplyBy(Math.exp(-elapsed / 650));\n\t\tvar e = this._constructFakeEvent({\n\t\t\tclientX: delta.x + this._startSwipePoint.x,\n\t\t\tclientY: delta.y + this._startSwipePoint.y,\n\t\t\ttarget: this._map._mapPane,\n\t\t}, 'mousemove');\n\t\te.autoscroll = true;\n\t\tif (delta.x > 0.2 || delta.x < -0.2 || delta.y > 0.2 || delta.y < -0.2) {\n\t\t\tvar org = this._map.getPixelOrigin();\n\t\t\tvar docSize = this._map.getLayerMaxBounds().getSize().subtract(this._map.getSize());\n\t\t\tvar horizontalEnd, verticalEnd;\n\n\t\t\tif (this._map.getDocSize().x < this._map.getSize().x) {\n\t\t\t\t//don't scroll horizontally if document fits the view\n\t\t\t\tdelta.x = 0;\n\t\t\t\thorizontalEnd = true;\n\t\t\t} else {\n\t\t\t\thorizontalEnd = Math.max(Math.min(org.x, this._newPos.x), org.x - Math.max(docSize.x, 0)) !== this._newPos.x;\n\t\t\t}\n\n\t\t\tif (this._map.getDocSize().y < this._map.getSize().y) {\n\t\t\t\t//don't scroll vertically if document fits the view\n\t\t\t\tdelta.y = 0;\n\t\t\t\tverticalEnd = true;\n\t\t\t} else {\n\t\t\t\tverticalEnd = Math.max(Math.min(org.y, this._newPos.y), org.y - Math.max(docSize.y, 0)) !== this._newPos.y;\n\t\t\t}\n\n\t\t\tthis._map.dragging._draggable._startPoint = this._startSwipePoint;\n\t\t\tthis._map.dragging._draggable._startPos = this._newPos;\n\t\t\tthis._newPos._add(delta);\n\n\t\t\tthis._map.dragging._draggable._onMove(e);\n\n\t\t\t// Prefetch border tiles for the current visible area after cancelling any scheduled calls to the prefetcher.\n\t\t\tTileManager.clearPreFetch();\n\t\t\tTileManager.preFetchTiles(true /* forceBorderCalc */);\n\n\t\t\tif (!horizontalEnd || !verticalEnd) {\n\t\t\t\tthis.autoscrollAnimReq = app.util.requestAnimFrame(this._autoscroll, this);\n\t\t\t} else {\n\t\t\t\tthis._inSwipeAction = false;\n\t\t\t\tif (app.file.fileBasedView)\n\t\t\t\t\tthis._map._docLayer._checkSelectedPart();\n\t\t\t}\n\t\t}\n\t\telse {\n\t\t\tthis._map.dragging._draggable._onUp(e);\n\t\t\tthis._inSwipeAction = false;\n\t\t\tif (app.file.fileBasedView)\n\t\t\t\tthis._map._docLayer._checkSelectedPart();\n\t\t}\n\t}\n});\n"]}