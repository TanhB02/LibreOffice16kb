{"version":3,"file":"Map.VersionBar.js","sourceRoot":"","sources":["../../../../../../../../../../../TanhX/online/browser/src/map/handler/Map.VersionBar.js"],"names":[],"mappings":"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","sourcesContent":["/* -*- js-indent-level: 8 -*- */\n/*\n * Copyright the Collabora Online contributors.\n *\n * SPDX-License-Identifier: MPL-2.0\n *\n * This Source Code Form is subject to the terms of the Mozilla Public\n * License, v. 2.0. If a copy of the MPL was not distributed with this\n * file, You can obtain one at http://mozilla.org/MPL/2.0/.\n */\n/*\n * L.Map.VersionBar.\n */\n/* global app _ */\n\nL.Map.VersionBar = L.Handler.extend({\n\tonAdd: function () {\n\t\tthis._map.on('adminuser', this.onUpdateInfo, this);\n\t\tthis._map.on('versionbar', this.onversionbar, this);\n\t},\n\n\tonRemove: function () {\n\t\tthis._map.off('versionbar', this.onversionbar, this);\n\t\tthis._map.off('adminuser', this.onUpdateInfo, this);\n\t},\n\n\tonUpdateInfo: function () {\n\t\tif (app.isAdminUser) {\n\t\t\tvar laterDate = new Date();\n\t\t\tvar currentDate = new Date();\n\t\t\tvar timeValue = window.prefs.getNumber('InfoBarLaterDate');\n\t\t\tif (isNaN(timeValue)) {\n\t\t\t\t/* - 5 seconds */\n\t\t\t\tlaterDate.setTime(currentDate.getTime() - 5000);\n\t\t\t} else {\n\t\t\t\t/* + 5 days (432,000,000 Milliseconds) */\n\t\t\t\ttimeValue = Number(timeValue);\n\t\t\t\tlaterDate.setTime(timeValue + 432000000);\n\t\t\t}\n\n\t\t\tif (currentDate > laterDate)\n\t\t\t\tapp.socket.sendMessage('versionbar');\n\t\t}\n\t},\n\n\tonversionbar: function (e) {\n\t\tif (e && e.coolwsd_version) {\n\t\t\tvar latestVersion = e.coolwsd_version.split('.');\n\t\t\tvar currentVersion = app.socket.WSDServer.Version.split('.');\n\t\t\tvar snackbarMessage = _('Your Collabora Online server needs updating. Version {0} is available.');\n\t\t\tvar length = Math.max(latestVersion.length, currentVersion.length);\n\t\t\tfor (var i = 0; i < length; i++) {\n\t\t\t\tvar v1 = i < latestVersion.length ? parseInt(latestVersion[i]) : 0;\n\t\t\t\tvar v2 = i < currentVersion.length ? parseInt(currentVersion[i]) : 0;\n\n\t\t\t\tif (v1 > v2) {\n\t\t\t\t\tvar currentDate = new Date();\n\t\t\t\t\twindow.prefs.set('InfoBarLaterDate', currentDate.getTime());\n\t\t\t\t\tsnackbarMessage = snackbarMessage.replace('{0}', e.coolwsd_version);\n\t\t\t\t\tthis._map.uiManager.showSnackbar(snackbarMessage);\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tif (v1 < v2) {\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n});\n\nif (window.prefs.canPersist) {\n\tL.Map.versionBar = new L.Map.VersionBar();\n}\n"]}