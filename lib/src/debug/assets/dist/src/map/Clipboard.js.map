{"version":3,"file":"Clipboard.js","sourceRoot":"","sources":["../../../../../../../../../../TanhX/online/browser/src/map/Clipboard.js"],"names":[],"mappings":"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","sourcesContent":["/* -*- js-indent-level: 8 -*- */\n/*\n * Copyright the Collabora Online contributors.\n *\n * SPDX-License-Identifier: MPL-2.0\n *\n * This Source Code Form is subject to the terms of the Mozilla Public\n * License, v. 2.0. If a copy of the MPL was not distributed with this\n * file, You can obtain one at http://mozilla.org/MPL/2.0/.\n */\n/*\n * L.Clipboard is used to abstract our storage and management of\n * local & remote clipboard data.\n */\n\n/* global app DocUtil _ brandProductName $ ClipboardItem Promise GraphicSelection cool */\n\n// Get all interesting clipboard related events here, and handle\n// download logic in one place ...\n// We keep track of the current selection content if it is simple\n// So we can do synchronous copy/paste in the callback if possible.\nL.Clipboard = L.Class.extend({\n\tinitialize: function(map) {\n\t\tthis._map = map;\n\t\tthis._selectionContent = '';\n\t\tthis._selectionPlainTextContent = '';\n\t\tthis._selectionType = null;\n\t\tthis._accessKey = [ '', '' ];\n\t\tthis._clipboardSerial = 0; // incremented on each operation\n\t\tthis._failedTimer = null;\n\t\tthis._dummyDivName = 'copy-paste-container';\n\t\tthis._unoCommandForCopyCutPaste = null;\n\t\t// Tracks if we're in paste special mode for the navigator.clipboard case\n\t\tthis._navigatorClipboardPasteSpecial = false;\n\n\t\tvar div = document.createElement('div');\n\t\tthis._dummyDiv = div;\n\t\tthis._dummyPlainDiv = null;\n\t\tthis._dummyClipboard = {};\n\n\t\t// Tracks waiting for UNO commands to complete\n\t\tthis._commandCompletion = [];\n\t\tthis._map.on('commandresult', this._onCommandResult, this);\n\t\tthis._map.on('clipboardchanged', this._onCommandResult, this);\n\n\t\tdiv.setAttribute('id', this._dummyDivName);\n\t\tdiv.style.userSelect = 'text !important';\n\t\tdiv.style.opacity = '0';\n\t\tdiv.setAttribute('contenteditable', 'true');\n\t\tdiv.setAttribute('type', 'text');\n\t\tdiv.style.position = 'fixed';\n\t\tdiv.style.left = '0px';\n\t\tdiv.style.top = '-200px';\n\t\tdiv.style.width = '15000px';\n\t\tdiv.style.height = '200px';\n\t\tdiv.style.overflow = 'hidden';\n\t\tdiv.style.zIndex = '-1000';\n\t\tdiv.style['-webkit-user-select'] = 'text !important';\n\t\tdiv.style.display = 'block';\n\t\tdiv.style.fontSize = '6pt';\n\n\t\t// so we get events to where we want them.\n\t\tvar parent = document.getElementById('map');\n\t\tparent.appendChild(div);\n\n\t\tif (L.Browser.cypressTest) {\n\t\t\tthis._dummyPlainDiv = document.createElement('div');\n\t\t\tthis._dummyPlainDiv.id = 'copy-plain-container';\n\t\t\tthis._dummyPlainDiv.style = 'position: fixed; left: 0px; top: -400px; width: 15000px; height: 200px; ' +\n\t\t\t\t'overflow: hidden; z-index: -1000; -webkit-user-select: text !important; display: block; ' +\n\t\t\t\t'font-size: 6pt';\n\t\t\tparent.appendChild(this._dummyPlainDiv);\n\t\t}\n\n\t\t// sensible default content.\n\t\tthis._resetDiv();\n\n\t\tvar that = this;\n\t\tvar beforeSelect = function(ev) { return that._beforeSelect(ev); };\n\n\t\tdocument.oncut = function(ev)   { return that.cut(ev); };\n\t\tdocument.oncopy = function(ev)  { return that.copy(ev); };\n\t\tdocument.onpaste = function(ev) { return that.paste(ev); };\n\t\tdocument.onbeforecut = beforeSelect;\n\t\tdocument.onbeforecopy = beforeSelect;\n\t\tdocument.onbeforepaste = beforeSelect;\n\t},\n\n\t// Decides if `html` effectively contains just an image.\n\tisHtmlImage: function(html) {\n\t\tconst startsWithMeta = html.substring(0, 5) == '<meta';\n\t\tif (startsWithMeta) {\n\t\t\t// Ignore leading <meta>.\n\t\t\tconst metaEnd = html.indexOf('>');\n\t\t\tif (metaEnd != -1) {\n\t\t\t\t// Start after '>'.\n\t\t\t\thtml = html.substring(metaEnd + 1);\n\t\t\t}\n\t\t}\n\n\t\t// Starts with an <img> element.\n\t\tif (html.substring(0, 4) === '<img') {\n\t\t\treturn true;\n\t\t}\n\n\t\treturn false;\n\t},\n\n\n\tsetKey: function(key) {\n\t\tif (this._accessKey[0] === key)\n\t\t\treturn;\n\t\tthis._accessKey[1] = this._accessKey[0];\n\t\tthis._accessKey[0] = key;\n\t},\n\n\tgetMetaBase: function() {\n\t\tif (window.ThisIsAMobileApp) {\n\t\t\treturn 'collabora-online-mobile'; // makeHttpUrl does not work with the file:// protocol used in mobile apps...\n\t\t}\n\t\treturn window.makeHttpUrl('');\n\t},\n\n\tgetMetaPath: function(idx) {\n\t\tif (!idx)\n\t\t\tidx = 0;\n\t\tif (this._accessKey[idx] === '')\n\t\t\treturn '';\n\n\t\tvar metaPath = '/cool/clipboard?WOPISrc=' + encodeURIComponent(this._map.options.doc) +\n\t\t\t'&ServerId=' + app.socket.WSDServer.Id +\n\t\t\t'&ViewId=' + this._map._docLayer._viewId +\n\t\t\t'&Tag=' + this._accessKey[idx];\n\n\t\tif (window.routeToken !== '')\n\t\t\tmetaPath += '&RouteToken='+window.routeToken;\n\n\t\treturn metaPath;\n\t},\n\n\tgetMetaURL: function(idx) {\n\t\treturn this.getMetaBase() + this.getMetaPath(idx);\n\t},\n\n\t// Returns the marker used to identify stub messages.\n\t_getHtmlStubMarker: function() {\n\t\treturn '<title>Stub HTML Message</title>';\n\t},\n\n\t// Returns true if the argument is a stub html.\n\t_isStubHtml: function(text) {\n\t\treturn text.indexOf(this._getHtmlStubMarker()) > 0;\n\t},\n\n\t// wrap some content with our stub magic\n\t_originWrapBody: function(body, isStub) {\n\t\tvar lang = 'en_US'; // FIXME: l10n\n\t\tvar encodedOrigin = encodeURIComponent(this.getMetaURL());\n\t\tvar text =  '<!DOCTYPE HTML PUBLIC \"-//W3C//DTD HTML 4.0 Transitional//EN\">\\n' +\n\t\t            '<html>\\n' +\n\t\t            '  <head>\\n';\n\t\tif (isStub)\n\t\t\ttext += '    ' + this._getHtmlStubMarker() + '\\n';\n\t\ttext +=     '    <meta http-equiv=\"content-type\" content=\"text/html; charset=utf-8\"/>\\n' +\n\t\t\t    '  </head>\\n' +\n\t\t\t    '  <body lang=\"' + lang + '\" dir=\"ltr\"><div id=\"meta-origin\" data-coolorigin=\"' + encodedOrigin + '\">\\n' +\n\t\t\t    body +\n\t\t\t    '  </div></body>\\n' +\n\t\t\t'</html>';\n\t\treturn text;\n\t},\n\n\t// what an empty clipboard has on it\n\t_getStubHtml: function() {\n\t\treturn this._substProductName(this._originWrapBody(\n\t\t    '    <p>' + _('To paste outside {productname}, please first click the \\'download\\' button') + '</p>\\n',\n\t\t    true\n\t\t));\n\t},\n\n\t// used for DisableCopy mode to fill the clipboard\n\t_getDisabledCopyStubHtml: function() {\n\t\treturn this._substProductName(this._originWrapBody(\n\t\t    '    <p>' + _('Copying from the document disabled') + '</p>\\n',\n\t\t    true\n\t\t));\n\t},\n\n\t_getMetaOrigin: function (html, prefix) {\n\t\tvar start = html.indexOf(prefix);\n\t\tif (start < 0) {\n\t\t\treturn '';\n\t\t}\n\t\tvar end = html.indexOf('\"', start + prefix.length);\n\t\tif (end < 0) {\n\t\t\treturn '';\n\t\t}\n\t\tvar meta = html.substring(start + prefix.length, end);\n\n\t\t// quick sanity checks that it one of ours.\n\t\tif (meta.indexOf('%2Fclipboard%3FWOPISrc%3D') >= 0 &&\n\t\t    meta.indexOf('%26ServerId%3D') > 0 &&\n\t\t    meta.indexOf('%26ViewId%3D') > 0 &&\n\t\t    meta.indexOf('%26Tag%3D') > 0)\n\t\t\treturn decodeURIComponent(meta);\n\t\telse\n\t\t\twindow.app.console.log('Mis-understood foreign origin: \"' + meta + '\"');\n\t\treturn '';\n\t},\n\n\t_encodeHtmlToBlob: function(text) {\n\t\tvar content = [];\n\t\tvar data = new Blob([text]);\n\t\tcontent.push('text/html\\n');\n\t\tcontent.push(data.size.toString(16) + '\\n');\n\t\tcontent.push(data);\n\t\tcontent.push('\\n');\n\t\treturn new Blob(content);\n\t},\n\n\t_readContentSyncToBlob: function(dataTransfer) {\n\t\tvar content = [];\n\t\tvar types = dataTransfer.types;\n\t\tfor (var t = 0; t < types.length; ++t) {\n\t\t\tif (types[t] === 'Files')\n\t\t\t\tcontinue; // images handled elsewhere.\n\t\t\tvar dataStr = dataTransfer.getData(types[t]);\n\t\t\t// Avoid types that has no content.\n\t\t\tif (!dataStr.length)\n\t\t\t\tcontinue;\n\t\t\tvar data = new Blob([dataStr]);\n\t\t\twindow.app.console.log('type ' + types[t] + ' length ' + data.size +\n\t\t\t\t    ' -> 0x' + data.size.toString(16) + '\\n');\n\t\t\tcontent.push((types[t] === 'text' ? 'text/plain' : types[t]) + '\\n');\n\t\t\tcontent.push(data.size.toString(16) + '\\n');\n\t\t\tcontent.push(data);\n\t\t\tcontent.push('\\n');\n\t\t}\n\t\tif (content.length > 0)\n\t\t\treturn new Blob(content, {type : 'application/octet-stream', endings: 'transparent'});\n\t\telse\n\t\t\treturn null;\n\t},\n\n\t// Abstract async post & download for our progress wrappers\n\t// type: GET or POST\n\t// url:  where to get / send the data\n\t// optionalFormData: used for POST for form data\n\t// forClipboard: a boolean telling if we need the \"Confirm copy to clipboard\" link in the end\n\t// completeFn: called on completion - with response.\n\t// progressFn: allows splitting the progress bar up.\n\t_doAsyncDownload: async function(type,url,optionalFormData,forClipboard,progressFn,) {\n\t\tvar request = new XMLHttpRequest();\n\n\t\t// avoid to invoke the following code if the download widget depends on user interaction\n\t\tif (!this._downloadProgress || this._downloadProgress.isClosed()) {\n\t\t\tthis._startProgress(false);\n\t\t\tthis._downloadProgress.startProgressMode();\n\t\t}\n\n\t\treturn await new Promise((resolve, reject) => {\n\t\t\trequest.onload = () => {\n\t\t\t\tthis._downloadProgress._onComplete();\n\t\t\t\tif (!forClipboard) {\n\t\t\t\t\tthis._downloadProgress._onClose();\n\t\t\t\t}\n\n\t\t\t\t// For some reason 400 error from the server doesn't\n\t\t\t\t// invoke onerror callback, but we do get here with\n\t\t\t\t// size==0, which signifies no response from the server.\n\t\t\t\t// So we check the status code instead.\n\t\t\t\tif (request.status == 200) {\n\t\t\t\t\tresolve(request.response);\n\t\t\t\t} else {\n\t\t\t\t\treject(request.response);\n\t\t\t\t}\n\t\t\t};\n\t\t\trequest.onerror = (error) => {\n\t\t\t\treject(error);\n\t\t\t\tthis._downloadProgress._onComplete();\n\t\t\t\tthis._downloadProgress._onClose();\n\t\t\t};\n\n\t\t\trequest.ontimeout = () => {\n\t\t\t\tthis._map.uiManager.showSnackbar(_('warning: copy/paste request timed out'));\n\t\t\t\tthis._downloadProgress._onClose();\n\t\t\t\treject('request timed out');\n\t\t\t};\n\n\t\t\trequest.upload.addEventListener('progress', (e) => {\n\t\t\t\tif (e.lengthComputable) {\n\t\t\t\t\tvar percent = progressFn(e.loaded / e.total * 100);\n\t\t\t\t\tvar progress = { statusType: 'setvalue', value: percent };\n\t\t\t\t\tthis._downloadProgress._onUpdateProgress(progress);\n\t\t\t\t}\n\t\t\t}, false);\n\n\t\t\tif ('processCoolUrl' in window) {\n\t\t\t\turl = window.processCoolUrl({ url: url, type: 'clipboard' });\n\t\t\t}\n\n\t\t\trequest.open(type, url, true /* isAsync */);\n\t\t\trequest.timeout = 30 * 1000; // 30 secs ...\n\t\t\trequest.responseType = 'blob';\n\t\t\tif (optionalFormData !== null)\n\t\t\t\trequest.send(optionalFormData);\n\t\t\telse\n\t\t\t\trequest.send();\n\t\t});\n\t},\n\n\t// Suck the data from one server to another asynchronously ...\n\t_dataTransferDownloadAndPasteAsync: async function(src, fallbackHtml) {\n\t\t// FIXME: add a timestamp in the links (?) ignore old / un-responsive servers (?)\n\t\tlet response;\n\n\t\ttry {\n\t\t\tresponse = await this._doAsyncDownload(\n\t\t\t\t'GET', src, null, false,\n\t\t\t\tfunction(progress) { return progress/2; },\n\t\t\t);\n\t\t} catch (_error) {\n\t\t\twindow.app.console.log('failed to download clipboard using fallback html');\n\n\t\t\t// If it's the stub, avoid pasting.\n\t\t\tif (this._isStubHtml(fallbackHtml))\n\t\t\t{\n\t\t\t\t// Let the user know they haven't really copied document content.\n\t\t\t\tthis._map.uiManager.showInfoModal('data transfer warning', '', _('Failed to download clipboard, please re-copy'));\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tvar formData = new FormData();\n\t\t\tlet commandName = null;\n\t\t\tif (this._checkAndDisablePasteSpecial()) {\n\t\t\t\tcommandName = '.uno:PasteSpecial';\n\t\t\t} else {\n\t\t\t\tcommandName = '.uno:Paste';\n\t\t\t}\n\t\t\tconst data = JSON.stringify({\n\t\t\t\turl: src,\n\t\t\t\tcommandName: commandName,\n\t\t\t});\n\t\t\tformData.append('data', new Blob([data]), 'clipboard');\n\t\t\ttry {\n\t\t\t\tawait this._doAsyncDownload(\n\t\t\t\t\t'POST', this.getMetaURL(), formData, false,\n\t\t\t\t\tfunction(progress) { return 50 + progress/2; },\n\t\t\t\t);\n\t\t\t} catch (_error) {\n\t\t\t\tawait this.dataTransferToDocumentFallback(null, fallbackHtml);\n\t\t\t}\n\t\t\treturn;\n\t\t}\n\n\t\twindow.app.console.log('download done - response ' + response);\n\t\tvar formData = new FormData();\n\t\tformData.append('data', response, 'clipboard');\n\n\t\tawait this._doAsyncDownload(\n\t\t\t'POST', this.getMetaURL(), formData, false,\n\t\t\tfunction(progress) { return 50 + progress/2; }\n\t\t);\n\n\t\tif (this._checkAndDisablePasteSpecial()) {\n\t\t\twindow.app.console.log('up-load done, now paste special');\n\t\t\tapp.socket.sendMessage('uno .uno:PasteSpecial');\n\t\t} else {\n\t\t\twindow.app.console.log('up-load done, now paste');\n\t\t\tapp.socket.sendMessage('uno .uno:Paste');\n\t\t}\n\t},\n\n\t_onImageLoadFunc: function (file) {\n\t\tvar that = this;\n\t\treturn function(e) {\n\t\t\tthat._pasteTypedBlob(file.type, e.target.result);\n\t\t};\n\t},\n\n\t// Sends a paste event with the specified mime type and content\n\t_pasteTypedBlob: function(fileType, fileBlob) {\n\t\tvar blob = new Blob(['paste mimetype=' + fileType + '\\n', fileBlob]);\n\t\tapp.socket.sendMessage(blob);\n\t},\n\n\t_asyncReadPasteFile: function (file) {\n\t\tif (file.type.match(/image.*/)) {\n\t\t\treturn this._asyncReadPasteImage(file);\n\t\t}\n\t\tif (file.type.match(/audio.*/) || file.type.match(/video.*/)) {\n\t\t\treturn this._asyncReadPasteAVMedia(file);\n\t\t}\n\t\treturn false;\n\t},\n\n\t_asyncReadPasteImage: function (file) {\n\t\tvar reader = new FileReader();\n\t\treader.onload = this._onImageLoadFunc(file);\n\t\treader.readAsArrayBuffer(file);\n\t\treturn true;\n\t},\n\n\t_asyncReadPasteAVMedia: function (file) {\n\t\tthis._map.insertMultimedia(file);\n\t\treturn true;\n\t},\n\n\t// Returns true if it finished synchronously, and false if it have started an async operation\n\t// that will likely end at a later time (required to avoid closing progress bar in paste(ev))\n\t// FIXME: This comment is a lie if dataTransferToDocumentFallback is called, as it calls _doAsyncDownload\n\tdataTransferToDocument: function (dataTransfer, preferInternal, htmlText, usePasteKeyEvent) {\n\t\t// Look for our HTML meta magic.\n\t\t//   cf. ClientSession.cpp /textselectioncontent:/\n\n\t\tvar meta = this._getMetaOrigin(htmlText, '<div id=\"meta-origin\" data-coolorigin=\"');\n\t\tvar id = this.getMetaPath(0);\n\t\tvar idOld = this.getMetaPath(1);\n\n\t\t// for the paste, we always prefer the internal LOK's copy/paste\n\t\tif (preferInternal === true &&\n\t\t\t((id !== '' && meta.indexOf(id) >= 0) || (idOld !== '' && meta.indexOf(idOld) >= 0)))\n\t\t{\n\t\t\t// Home from home: short-circuit internally.\n\t\t\twindow.app.console.log('short-circuit, internal paste');\n\t\t\tthis._doInternalPaste(this._map, usePasteKeyEvent);\n\t\t\treturn true;\n\t\t}\n\n\t\t// Do we have a remote Online we can suck rich data from ?\n\t\tif (meta !== '')\n\t\t{\n\t\t\twindow.app.console.log('Transfer between servers\\n\\t\"' + meta + '\" vs. \\n\\t\"' + id + '\"');\n\t\t\tthis._dataTransferDownloadAndPasteAsync(meta, htmlText);\n\t\t\treturn false; // just started async operation - did not finish yet\n\t\t}\n\n\t\t// Fallback.\n\t\tthis.dataTransferToDocumentFallback(dataTransfer, htmlText, usePasteKeyEvent);\n\t\treturn true;\n\t},\n\n\t_sendToInternalClipboard: async function (content) {\n\t\tif (window.ThisIsTheiOSApp) {\n\t\t\tawait window.webkit.messageHandlers.clipboard.postMessage(`sendToInternal ${await content.text()}`); // no need to base64 in this direction...\n\t\t} else {\n\t\t\tvar formData = new FormData();\n\t\t\tformData.append('file', content);\n\n\t\t\treturn await this._doAsyncDownload('POST', this.getMetaURL(), formData, false,\n\t\t\t\tfunction(progress) { return progress; }\n\t\t\t);\n\t\t}\n\t},\n\n\tdataTransferToDocumentFallback: async function(dataTransfer, htmlText, usePasteKeyEvent) {\n\t\tvar content;\n\t\tif (dataTransfer) {\n\t\t\t// Suck HTML content out of dataTransfer now while it feels like working.\n\t\t\tcontent = this._readContentSyncToBlob(dataTransfer);\n\t\t}\n\n\t\t// Fallback on the html.\n\t\tif (!content && htmlText != '') {\n\t\t\tcontent = this._encodeHtmlToBlob(htmlText);\n\t\t}\n\n\t\t// FIXME: do we want this section ?\n\n\t\t// Images get a look in only if we have no content and are async (used in the Ctrl-V\n\t\t// case)\n\t\tif (((content == null && htmlText === '') || this.isHtmlImage(htmlText)) && dataTransfer != null)\n\t\t{\n\t\t\tvar types = dataTransfer.types;\n\n\t\t\twindow.app.console.log('Attempting to paste image(s)');\n\n\t\t\t// first try to transfer images\n\t\t\t// TODO if we have both Files and a normal mimetype, should we handle\n\t\t\t// both, or prefer one or the other?\n\t\t\tfor (var t = 0; t < types.length; ++t) {\n\t\t\t\twindow.app.console.log('\\ttype' + types[t]);\n\t\t\t\tif (types[t] === 'Files') {\n\t\t\t\t\tvar files = dataTransfer.files;\n\t\t\t\t\tif (files !== null)\n\t\t\t\t\t{\n\t\t\t\t\t\tfor (var f = 0; f < files.length; ++f)\n\t\t\t\t\t\t\tthis._asyncReadPasteFile(files[f]);\n\t\t\t\t\t} // IE / Edge\n\t\t\t\t\telse this._asyncReadPasteFile(dataTransfer.items[t].getAsFile());\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// If any paste special dialog is open, close it here, because we won't call\n\t\t\t// _doInternalPaste() that would do the closing.\n\t\t\tthis._checkAndDisablePasteSpecial();\n\n\t\t\treturn;\n\t\t}\n\n\t\tif (content == null) {\n\t\t\twindow.app.console.log('Nothing we can paste on the clipboard');\n\t\t\treturn;\n\t\t}\n\n\t\twindow.app.console.log('Normal HTML, so smart paste not possible');\n\n\t\tawait this._sendToInternalClipboard(content);\n\n\t\twindow.app.console.log('clipboard: Sent ' + content.size + ' bytes successfully');\n\n\t\tthis._doInternalPaste(this._map, usePasteKeyEvent);\n\t},\n\n\t_checkSelection: function() {\n\t\tvar checkSelect = document.getSelection();\n\t\tif (checkSelect && checkSelect.isCollapsed)\n\t\t\twindow.app.console.log('Error: collapsed selection - cannot copy/paste');\n\t},\n\n\t_getHtmlForClipboard: function() {\n\t\tvar text;\n\n\t\tif (this._selectionType === 'complex' || GraphicSelection.hasActiveSelection()) {\n\t\t\twindow.app.console.log('Copy/Cut with complex/graphical selection');\n\t\t\tif (this._selectionType === 'text' && this._selectionContent !== '')\n\t\t\t{ // back here again having downloaded it ...\n\t\t\t\ttext = this._selectionContent; // Not sure if we hit these lines. Last else block seems to catch the downloaded content (selection type is not \"complex\" while copying to clipboard).\n\t\t\t\twindow.app.console.log('Use downloaded selection.');\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\twindow.app.console.log('Downloaded that selection.');\n\t\t\t\ttext = this._getStubHtml();\n\t\t\t\tthis._onDownloadOnLargeCopyPaste();\n\t\t\t\tthis._downloadProgress.setURI( // richer, bigger HTML ...\n\t\t\t\t\tthis.getMetaURL() + '&MimeType=text/html,text/plain;charset=utf-8');\n\t\t\t}\n\t\t} else if (this._selectionType === null) {\n\t\t\twindow.app.console.log('Copy/Cut with no selection!');\n\t\t\ttext = this._getStubHtml();\n\t\t} else {\n\t\t\twindow.app.console.log('Copy/Cut with simple text selection');\n\t\t\ttext = this._selectionContent;\n\t\t}\n\t\treturn text;\n\t},\n\n\t// returns whether we should stop processing the event\n\tpopulateClipboard: function(ev) {\n\t\t// If the copy paste API is not supported, we download the content as a fallback method.\n\t\tvar text = this._getHtmlForClipboard();\n\n\t\tvar plainText = DocUtil.stripHTML(text);\n\t\tif (text == this._selectionContent && this._selectionPlainTextContent != '') {\n\t\t\tplainText = this._selectionPlainTextContent;\n\t\t}\n\t\tif (ev.clipboardData) { // Standard\n\t\t\tif (this._unoCommandForCopyCutPaste === '.uno:CopyHyperlinkLocation') {\n\t\t\t\tvar ess = 's';\n\t\t\t\tvar re = new RegExp('^(.*)(<a href=\")([^\"]+)(\">.*</a>)(</p>\\n</body>\\n</html>)$', ess);\n\t\t\t\tvar match = re.exec(text);\n\t\t\t\tif (match !== null && match.length === 6) {\n\t\t\t\t\ttext = match[1] + match[3] + match[5];\n\t\t\t\t\tplainText = DocUtil.stripHTML(text);\n\t\t\t\t}\n\t\t\t}\n\t\t\t// if copied content is graphical then plainText is null and it does not work on mobile.\n\t\t\tev.clipboardData.setData('text/plain', plainText ? plainText: ' ');\n\t\t\tev.clipboardData.setData('text/html', text);\n\t\t\twindow.app.console.log('Put \"' + text + '\" on the clipboard');\n\t\t\tthis._clipboardSerial++;\n\t\t}\n\t},\n\n\t_isAnyInputFieldSelected: function(forCopy = false) {\n\t\tif ($('#search-input').is(':focus'))\n\t\t\treturn true;\n\n\t\tif ($('.ui-edit').is(':focus'))\n\t\t\treturn true;\n\n\t\tif ($('.ui-textarea').is(':focus'))\n\t\t\treturn true;\n\n\t\tif ($('input.ui-combobox-content').is(':focus'))\n\t\t\treturn true;\n\n\t\tif (this._map.uiManager.isAnyDialogOpen()\n\t\t\t&& !this.isCopyPasteDialogReadyForCopy()\n\t\t\t&& !this.isPasteSpecialDialogOpen())\n\t\t\treturn true;\n\n\t\tif (cool.Comment.isAnyFocus())\n\t\t    return true;\n\n\t\tif (forCopy) {\n\t\t\tlet selection = window.getSelection();\n\t\t\tselection = selection && selection.toString();\n\t\t\tif (selection && selection.length !== 0)\n\t\t\t\treturn true;\n\t\t}\n\n\t\treturn false;\n\t},\n\n\t_isFormulabarSelected: function() {\n\t\tif ($('#sc_input_window').is(':focus'))\n\t\t\treturn true;\n\t\treturn false;\n\t},\n\n\t// Does the selection of text before an event comes in\n\t_beforeSelect: function(ev) {\n\t\twindow.app.console.log('Got event ' + ev.type + ' setting up selection');\n\n\t\tif (this._isAnyInputFieldSelected(ev.type === 'beforecopy'))\n\t\t\treturn;\n\n\t\tthis._beforeSelectImpl();\n\t},\n\n\t_beforeSelectImpl: function() {\n\t\tif (this._map.getDocType() === 'presentation' && this._map._docLayer._preview.partsFocused)\n\t\t\treturn;\n\n\t\t// We need some spaces in there ...\n\t\tthis._resetDiv();\n\n\t\tvar sel = document.getSelection();\n\t\tif (!sel)\n\t\t\treturn;\n\n\t\tvar selected = false;\n\t\tvar selectRange;\n\n\t\tif (!selected)\n\t\t{\n\t\t\tsel.removeAllRanges();\n\t\t\tselectRange = document.createRange();\n\t\t\tselectRange.selectNodeContents(this._dummyDiv);\n\t\t\tsel.addRange(selectRange);\n\n\t\t\tvar checkSelect = document.getSelection();\n\t\t\tif (checkSelect.isCollapsed)\n\t\t\t\twindow.app.console.log('Error: failed to select - cannot copy/paste');\n\t\t}\n\n\t\treturn false;\n\t},\n\n\t_resetDiv: function() {\n\t\t// cleanup the content:\n\t\tthis._dummyDiv.replaceChildren();\n\n\t\tlet bElement = document.createElement('b');\n\t\tbElement.style.fontWeight = 'normal';\n\t\tbElement.style.backgroundColor = 'transparent';\n\t\tbElement.style.color = 'transparent';\n\n\t\tlet span = document.createElement('span');\n\t\tspan.textContent = '  ';\n\n\t\tbElement.appendChild(span);\n\t\tthis._dummyDiv.appendChild(bElement);\n\t},\n\n\t// Try-harder fallbacks for emitting cut/copy/paste events.\n\t_execOnElement: function(operation) {\n\t\tvar serial = this._clipboardSerial;\n\n\t\tthis._resetDiv();\n\n\t\tvar success = false;\n\t\tvar active = null;\n\n\t\t// selection can change focus.\n\t\tactive = document.activeElement;\n\n\t\tsuccess = (document.execCommand(operation) &&\n\t\t\t   serial !== this._clipboardSerial);\n\n\t\t// try to restore focus if we need to.\n\t\tif (active !== null && active !== document.activeElement)\n\t\t\tactive.focus();\n\n\t\twindow.app.console.log('fallback ' + operation + ' ' + (success?'success':'fail'));\n\n\t\treturn success;\n\t},\n\n\t// Encourage browser(s) to actually execute the command\n\t_execCopyCutPaste: function(operation, cmd, params) {\n\t\tvar serial = this._clipboardSerial;\n\n\t\tthis._unoCommandForCopyCutPaste = cmd;\n\n\t\tif (operation !== 'paste' && cmd !== undefined && this._navigatorClipboardWrite(params)) {\n\t\t\t// This is the codepath where an UNO command initiates the clipboard\n\t\t\t// operation.\n\t\t\treturn;\n\t\t}\n\n\t\tif (!window.ThisIsTheiOSApp && // in mobile apps, we want to drop straight to navigatorClipboardRead as execCommand will require user interaction...\n\t\t\tdocument.execCommand(operation) &&\n\t\t\tserial !== this._clipboardSerial) {\n\t\t\twindow.app.console.log('copied successfully');\n\t\t\tthis._unoCommandForCopyCutPaste = null;\n\t\t\treturn;\n\t\t}\n\n\t\tif (operation == 'paste' && this._navigatorClipboardRead(false)) {\n\t\t\t// execCommand(paste) failed, the new clipboard API is available, tried that\n\t\t\t// way.\n\t\t\treturn;\n\t\t}\n\n\t\tthis._afterCopyCutPaste(operation);\n\t},\n\n\t_afterCopyCutPaste: function(operation) {\n\t\tvar serial = this._clipboardSerial;\n\t\tthis._unoCommandForCopyCutPaste = null;\n\n\t\t// try a hidden div\n\t\tif (this._execOnElement(operation)) {\n\t\t\twindow.app.console.log('copied on element successfully');\n\t\t\treturn;\n\t\t}\n\n\t\t// see if we have help for paste\n\t\tif (operation === 'paste')\n\t\t{\n\t\t\ttry {\n\t\t\t\twindow.app.console.warn('Asked parent for a paste event');\n\t\t\t\tthis._map.fire('postMessage', {msgId: 'UI_Paste'});\n\t\t\t} catch (error) {\n\t\t\t\twindow.app.console.warn('Failed to post-message: ' + error);\n\t\t\t}\n\t\t}\n\n\t\t// wait and see if we get some help\n\t\tvar that = this;\n\t\tclearTimeout(this._failedTimer);\n\t\tsetTimeout(function() {\n\t\t\tif (that._clipboardSerial !== serial)\n\t\t\t{\n\t\t\t\twindow.app.console.log('successful ' + operation);\n\t\t\t\tif (operation === 'paste')\n\t\t\t\t\tthat._stopHideDownload();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\twindow.app.console.log('help did not arrive for ' + operation);\n\t\t\t\tthat._warnCopyPaste();\n\t\t\t}\n\t\t}, 150 /* ms */);\n\t},\n\n\t// ClipboardContent.getType() callback: used with the Paste button\n\t_navigatorClipboardGetTypeCallback: async function(clipboardContent, blob, type) {\n\t\tif (type == 'image/png') {\n\t\t\tthis._pasteTypedBlob(type, blob);\n\t\t\treturn;\n\t\t}\n\n\t\tlet text;\n\t\ttry {\n\t\t\ttext = await blob.text();\n\t\t} catch (error) {\n\t\t\twindow.app.console.log('blob.text() failed: ' + error.message);\n\t\t\treturn;\n\t\t}\n\n\t\tif (type !== 'text/html' || !this.isHtmlImage(text)) {\n\t\t\tthis._navigatorClipboardTextCallback(text, type);\n\t\t\treturn;\n\t\t}\n\n\t\t// Got an image, work with that directly.\n\t\tlet image;\n\t\ttry {\n\t\t\timage = await clipboardContent.getType('image/png');\n\t\t} catch (error) {\n\t\t\twindow.app.console.log('clipboardContent.getType(image/png) failed: ' + error.message);\n\t\t\treturn;\n\t\t}\n\n\t\tthis._navigatorClipboardGetTypeCallback(clipboardContent, image, 'image/png');\n\t},\n\n\t// Clipboard blob text() callback for the text/html and text/plain cases\n\t_navigatorClipboardTextCallback: function(text, textType) {\n\t\t// paste() wants to work with a paste event, so construct one.\n\t\tvar ev = {\n\t\t\tclipboardData: {\n\t\t\t\t// Used early by paste().\n\t\t\t\tgetData: function(type) {\n\t\t\t\t\tif (type === textType) {\n\t\t\t\t\t\treturn text;\n\t\t\t\t\t}\n\n\t\t\t\t\treturn '';\n\t\t\t\t},\n\t\t\t\t// Used by _readContentSyncToBlob().\n\t\t\t\ttypes: [textType],\n\t\t\t},\n\t\t\tpreventDefault: function() {\n\t\t\t},\n\t\t};\n\n\t\t// Invoke paste(), which knows how to recognize our HTML vs external HTML.\n\t\tthis.paste(ev);\n\t},\n\n\t// Gets status of a copy/paste command from the remote Kit\n    _onCommandResult: function(e) {\n        if (e.commandName === '.uno:Copy' || e.commandName === '.uno:Cut' || e.commandName === '.uno:CopyHyperlinkLocation' || e.commandName === '.uno:CopySlide') {\n\t\t\twindow.app.console.log('Resolve clipboard command promise ' + e.commandName);\n\t\t\twhile (this._commandCompletion.length > 0)\n\t\t\t{\n\t\t\t\tlet a = this._commandCompletion.shift();\n\t\t\t\ta.resolve();\n\t\t\t}\n\t\t}\n\t},\n\n\t_sendCommandAndWaitForCompletion: function(command, params) {\n\t\tif (command !== '.uno:Copy' && command !== '.uno:Cut' && command !== '.uno:CopyHyperlinkLocation' && command !== '.uno:CopySlide') {\n\t\t\tconsole.error(`_sendCommandAndWaitForCompletion was called with '${command}', but anything except Copy or Cut will never complete`);\n\t\t\treturn null;\n\t\t}\n\n\t\tif (this._commandCompletion.length > 0) {\n\t\t\tconsole.warn('Already have ' + this._commandCompletion.length + ' pending clipboard command(s)');\n\t\t\treturn null;\n\t\t}\n\n\t\tif (!params) app.socket.sendMessage('uno ' + command);\n\t\telse app.map.sendUnoCommand(command, params);\n\n\t\treturn new Promise((resolve, reject) => {\n\t\t\twindow.app.console.log('New ' + command + ' promise');\n\t\t\t// FIXME: add a timeout cleanup too ...\n\t\t\tthis._commandCompletion.push({\n\t\t\t\tresolve: resolve,\n\t\t\t\treject: reject,\n\t\t\t});\n\t\t});\n\t},\n\n\t_parseClipboardFetchResult: async function(text, mimetype, shorttype) {\n\t\tconst content = this.parseClipboard(await text)[shorttype];\n\t\tconst blob = new Blob([content], { 'type': mimetype });\n\t\tconsole.log('Generate blob of type ' + mimetype + ' from ' + shorttype + ' text: ' + content);\n\t\treturn blob;\n\t},\n\n\t// Executes the navigator.clipboard.write() call, if it's available.\n\t_navigatorClipboardWrite: function(params) {\n\t\tif (!L.Browser.clipboardApiAvailable && !window.ThisIsTheiOSApp) {\n\t\t\treturn false;\n\t\t}\n\n\t\tif (this._selectionType !== 'text') {\n\t\t\treturn false;\n\t\t}\n\n\t\tthis._asyncAttemptNavigatorClipboardWrite(params);\n\t\treturn true;\n\t},\n\n\t_asyncAttemptNavigatorClipboardWrite: async function(params) {\n\t\tconst command = this._unoCommandForCopyCutPaste;\n\t\tconst check_ = this._sendCommandAndWaitForCompletion(command, params);\n\n\t\t// I strongly disrecommend awaiting before the clipboard.write line in the non-iOS-app path\n\t\t// It turns out there are some rather precarious conditions for copy/paste to be allowed in Safari on mobile - and awaiting seems to tip us over into \"too late to copy/paste\"\n\t\t// Deferring like this is kinda horrible - it certainly looks gross in places - but it's absolutely necessary to avoid errors on the clipboard.write line\n\t\t// I don't like it either :). If you change this make sure to thoroughly test cross-browser and cross-device!\n\n\t\tif (window.ThisIsTheiOSApp) {\n\t\t\t// This is sent down the fakewebsocket which can race with the\n\t\t\t// native message - so first step is to wait for the result of\n\t\t\t// that command so we are sure the clipboard is set before\n\t\t\t// fetching it.\n\t\t\tif (await check_ === null)\n\t\t\t\treturn; // Either wrong command or a pending event.\n\n\t\t\tawait window.webkit.messageHandlers.clipboard.postMessage(`write`);\n\t\t} else {\n\t\t\tconst url = this.getMetaURL() + '&MimeType=text/html,text/plain;charset=utf-8';\n\n\t\t\tconst text = (async () => {\n\t\t\t\tif (await check_ === null)\n\t\t\t\t\tthrow new Error('Failed check, either wrong command or pending event');\n\t\t\t\t\t// We need to throw an error here rather than just returning so that a failure halts copying the ClipboardItem to the clipboard\n\n\t\t\t\tconst result = await fetch(url);\n\t\t\t\treturn await result.text();\n\t\t\t})();\n\n\t\t\tconst clipboardItem = new ClipboardItem({\n\t\t\t\t'text/html': this._parseClipboardFetchResult(text, 'text/html', 'html'),\n\t\t\t\t'text/plain': this._parseClipboardFetchResult(text, 'text/plain', 'plain'),\n\t\t\t});\n\t\t\t// Again, despite fetch(url), this._parseClipboardFetchResult(...) and check_ all being promises, we need to let browser internals await them after we have safely succeeded in calling clipboard.write\n\t\t\t// We throw an error if our checks fail before returning our text to cause these promises to reject - that way everything can be deferred for later, with failures causing the clipboard write to fail later\n\t\t\t// We define the text promise outside to allow us to reuse the fetch rather than fetching twice (as in Ic23f7f817cc855ff08f25a2afefcd73d6fc3472b)\n\n\t\t\tlet clipboard = navigator.clipboard;\n\t\t\tif (L.Browser.cypressTest) {\n\t\t\t\tclipboard = this._dummyClipboard;\n\t\t\t}\n\n\t\t\ttry {\n\t\t\t\tawait clipboard.write([clipboardItem]);\n\t\t\t} catch (error) {\n\t\t\t\t// When document is not focused, writing to clipboard is not allowed. But this error shouldn't stop the usage of clipboard API.\n\t\t\t\tif (!document.hasFocus()) {\n\t\t\t\t\twindow.app.console.warn('navigator.clipboard.write() failed: ' + error.message);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\t// Similarly, we'll get an error that is identical to the permission error if our `text` promise rejects\n\t\t\t\t// But this is really a check failure - if we can see that check failed we don't need to act on the bogus permission error\n\t\t\t\tif (await check_ === null) {\n\t\t\t\t\t window.app.console.warn('navigator.clipboard.write() failed due to a failing check');\n\t\t\t\t\t return;\n\t\t\t\t}\n\n\t\t\t\twindow.app.console.error('navigator.clipboard.write() failed: ' + error.message);\n\t\t\t\t// Warn that the copy failed.\n\t\t\t\tthis._warnCopyPaste();\n\t\t\t\t// Once broken, always broken.\n\t\t\t\tL.Browser.clipboardApiAvailable = false;\n\t\t\t\twindow.prefs.set('clipboardApiAvailable', false);\n\t\t\t\t// Prefetch selection, so next time copy will work with the keyboard.\n\t\t\t\tapp.socket.sendMessage('gettextselection mimetype=text/html,text/plain;charset=utf-8');\n\t\t\t}\n\t\t}\n\t},\n\n\t// Parses the result from the clipboard endpoint into HTML and plain text.\n\tparseClipboard: function(text) {\n\t\tlet textHtml;\n\t\tlet textPlain = '';\n\t\tif (text.startsWith('{')) {\n\t\t\tlet textJson = JSON.parse(text);\n\t\t\ttextHtml = textJson['text/html'];\n\t\t\ttextPlain = textJson['text/plain;charset=utf-8'];\n\t\t} else {\n\t\t\tvar idx = text.indexOf('<!DOCTYPE HTML');\n\t\t\tif (idx === -1) {\n\t\t\t\tidx = text.indexOf('<!DOCTYPE html');\n\t\t\t}\n\t\t\tif (idx > 0)\n\t\t\t\ttext = text.substring(idx, text.length);\n\t\t\ttextHtml = text;\n\t\t}\n\n\t\tif (!app.sectionContainer.testing)\n\t\t\ttextHtml = DocUtil.stripStyle(textHtml);\n\n\t\treturn {\n\t\t\t'html': textHtml,\n\t\t\t'plain': textPlain\n\t\t};\n\t},\n\n\t// Executes the navigator.clipboard.read() call, if it's available.\n\t_navigatorClipboardRead: function(isSpecial) {\n\t\tif (!L.Browser.clipboardApiAvailable && !window.ThisIsTheiOSApp) {\n\t\t\treturn false;\n\t\t}\n\n\t\tthis._asyncAttemptNavigatorClipboardRead(isSpecial);\n\t\treturn true;\n\t},\n\n\t_iOSReadClipboard: async function() {\n\t\tconst encodedClipboardData = await window.webkit.messageHandlers.clipboard.postMessage('read');\n\n\t\tif (encodedClipboardData === \"(internal)\") {\n\t\t\treturn null;\n\t\t}\n\n\t\tconst clipboardData = Array.from(\n\t\t\tencodedClipboardData.split(' '),\n\t\t).map((encoded) =>\n\t\t\t(encoded === '(null)' ? '' : window.b64d(encoded)),\n\t\t);\n\n\t\tconst dataByMimeType = {};\n\n\t\tif (clipboardData[0]) {\n\t\t\tdataByMimeType['text/plain'] = new Blob([clipboardData[0]]);\n\t\t}\n\n\t\tif (clipboardData[1]) {\n\t\t\tdataByMimeType['text/html'] = new Blob([clipboardData[1]]);\n\t\t}\n\n\t\tif (Object.keys(dataByMimeType).length === 0) {\n\t\t\treturn [];\n\t\t}\n\n\t\treturn [new ClipboardItem(dataByMimeType)];\n\t},\n\n\t_asyncAttemptNavigatorClipboardRead: async function(isSpecial) {\n\t\tvar clipboard = navigator.clipboard;\n\t\tif (L.Browser.cypressTest) {\n\t\t\tclipboard = this._dummyClipboard;\n\t\t}\n\t\tlet clipboardContents;\n\t\ttry {\n\t\t\tclipboardContents = window.ThisIsTheiOSApp\n\t\t\t\t? await this._iOSReadClipboard()\n\t\t\t\t: await clipboard.read();\n\n\t\t\tif (clipboardContents === null) {\n\t\t\t\tthis._doInternalPaste(this._map, false);\n\t\t\t\treturn; // Internal paste, skip the rest of the browser paste code\n\t\t\t}\n\t\t} catch (error) {\n\t\t\twindow.app.console.log('navigator.clipboard.read() failed: ' + error.message);\n\t\t\tif (isSpecial) {\n\t\t\t\t// Fallback to the old code, as in filterExecCopyPaste().\n\t\t\t\tthis._openPasteSpecialPopup();\n\t\t\t} else {\n\t\t\t\t// Fallback to the old code, as in _execCopyCutPaste().\n\t\t\t\tthis._afterCopyCutPaste('paste');\n\t\t\t}\n\t\t\treturn;\n\t\t}\n\n\t\tif (isSpecial) {\n\t\t\tthis._navigatorClipboardPasteSpecial = true;\n\t\t}\n\n\t\tif (clipboardContents.length < 1) {\n\t\t\twindow.app.console.log('clipboard has no items');\n\t\t\treturn;\n\t\t}\n\n\t\tvar clipboardContent = clipboardContents[0];\n\n\t\tif (clipboardContent.types.includes('text/html')) {\n\t\t\tlet blob;\n\t\t\ttry {\n\t\t\t\tblob = await clipboardContent.getType('text/html');\n\t\t\t} catch (error) {\n\t\t\t\twindow.app.console.log('clipboardContent.getType(text/html) failed: ' + error.message);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tthis._navigatorClipboardGetTypeCallback(clipboardContent, blob, 'text/html');\n\t\t} else if (clipboardContent.types.includes('text/plain')) {\n\t\t\tlet blob;\n\t\t\ttry {\n\t\t\t\tblob = await clipboardContent.getType('text/plain');\n\t\t\t} catch (error) {\n\t\t\t\twindow.app.console.log('clipboardContent.getType(text/plain) failed: ' + error.message);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tthis._navigatorClipboardGetTypeCallback(clipboardContent, blob, 'text/plain');\n\t\t} else {\n\t\t\twindow.app.console.log('navigator.clipboard has no text/html or text/plain');\n\t\t\treturn;\n\t\t}\n\t},\n\n\t// Pull UNO clipboard commands out from menus and normal user input.\n\t// We try to massage and re-emit these, to get good security event / credentials.\n\tfilterExecCopyPaste: function(cmd, params) {\n\t\tif (this._map['wopi'].DisableCopy && (cmd === '.uno:Copy' || cmd === '.uno:Cut' || cmd === '.uno:CopyHyperlinkLocation')) {\n\t\t\t// perform internal operations\n\t\t\tapp.socket.sendMessage('uno ' + cmd);\n\t\t\treturn true;\n\t\t}\n\n\t\tif (window.ThisIsTheAndroidApp) {\n\t\t\t// perform internal operations\n\t\t\tapp.socket.sendMessage('uno ' + cmd);\n\t\t\treturn true;\n\t\t}\n\n\t\tif (cmd === '.uno:Copy' || cmd === '.uno:CopyHyperlinkLocation' || cmd === '.uno:CopySlide') {\n\t\t\tthis._execCopyCutPaste('copy', cmd, params);\n\t\t} else if (cmd === '.uno:Cut') {\n\t\t\tthis._execCopyCutPaste('cut', cmd);\n\t\t} else if (cmd === '.uno:Paste') {\n\t\t\tthis._execCopyCutPaste('paste', cmd);\n\t\t} else if (cmd === '.uno:PasteSpecial') {\n\t\t\tif (this._navigatorClipboardRead(true)) {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t\tthis._openPasteSpecialPopup();\n\t\t} else {\n\t\t\treturn false;\n\t\t}\n\t\twindow.app.console.log('filtered uno command ' + cmd);\n\t\treturn true;\n\t},\n\n\t_doCopyCut: function(ev, unoName) {\n\t\tif (this._map.getDocType() === 'presentation' && this._map._docLayer._preview.partsFocused) {\n\t\t\tunoName = 'CopySlide';\n\t\t}\n\t\twindow.app.console.log(unoName);\n\n\t\tif (this._isAnyInputFieldSelected(unoName === 'Copy'))\n\t\t\treturn;\n\n\t\tif (this._downloadProgressStatus() === 'downloadButton')\n\t\t\tthis._stopHideDownload(); // Terminate pending confirmation\n\n\t\tvar preventDefault = true;\n\n\t\tif (this._map['wopi'].DisableCopy === true)\n\t\t{\n\t\t\tvar text = this._getDisabledCopyStubHtml();\n\t\t\tvar plainText = DocUtil.stripHTML(text);\n\t\t\tif (ev.clipboardData) {\n\t\t\t\twindow.app.console.log('Copying disabled: put stub message on the clipboard');\n\t\t\t\tev.clipboardData.setData('text/plain', plainText ? plainText: ' ');\n\t\t\t\tev.clipboardData.setData('text/html', text);\n\t\t\t\tthis._clipboardSerial++;\n\t\t\t}\n\t\t} else {\n\t\t\tthis._unoCommandForCopyCutPaste = `.uno:${unoName}`;\n\t\t\tthis._checkSelection();\n\n\t\t\t// This is the codepath (_navigatorClipboardWrite) where the browser initiates the clipboard operation, e.g. the keyboard is used.\n\t\t\tif (!this._navigatorClipboardWrite()) {\n\t\t\t\tapp.socket.sendMessage('uno .uno:' + unoName);\n\t\t\t\tthis.populateClipboard(ev);\n\t\t\t}\n\t\t}\n\n\t\tif (ev.clipboardData && unoName === 'Cut') {\n\t\t\t// Cut text is not removed from the editable area,\n\t\t\t// so we need to request the focused paragraph.\n\t\t\tthis._map._textInput._abortComposition(ev);\n\t\t}\n\n\t\tif (preventDefault) {\n\t\t\tev.preventDefault();\n\t\t\treturn false;\n\t\t}\n\t},\n\n\t_doInternalPaste: function(map, usePasteKeyEvent) {\n\t\tif (usePasteKeyEvent) {\n\t\t\t// paste into dialog\n\t\t\tvar KEY_PASTE = 1299;\n\t\t\tmap._textInput._sendKeyEvent(0, KEY_PASTE);\n\t\t} else if (this._checkAndDisablePasteSpecial()) {\n\t\t\tapp.socket.sendMessage('uno .uno:PasteSpecial');\n\t\t} else {\n\t\t\t// paste into document\n\t\t\tapp.socket.sendMessage('uno .uno:Paste');\n\t\t}\n\t},\n\n\tcut:  function(ev) { return this._doCopyCut(ev, 'Cut'); },\n\n\tcopy: function(ev) { return this._doCopyCut(ev, 'Copy'); },\n\n\tpaste: function(ev) {\n\t\tif (this._map.isReadOnlyMode())\n\t\t\treturn;\n\n\t\twindow.app.console.log('Paste');\n\n\t\tif (this._isAnyInputFieldSelected() && !this._isFormulabarSelected())\n\t\t\treturn;\n\n\t\t// If the focus is in the search box, paste there.\n\t\tif (this._map.isSearching())\n\t\t\treturn;\n\n\t\tif (this._downloadProgressStatus() === 'downloadButton')\n\t\t\tthis._stopHideDownload(); // Terminate pending confirmation\n\n\t\tif (this._map._activeDialog)\n\t\t\tev.usePasteKeyEvent = true;\n\n\t\tif (ev.clipboardData) {\n\t\t\tev.preventDefault();\n\t\t\tvar usePasteKeyEvent = ev.usePasteKeyEvent;\n\t\t\t// Always capture the html content separate as we may lose it when we\n\t\t\t// pass the clipboard data to a different context (async calls, f.e.).\n\t\t\tvar htmlText = ev.clipboardData.getData('text/html');\n\t\t\tvar hasFinished = this.dataTransferToDocument(ev.clipboardData, /* preferInternal = */ true, htmlText, usePasteKeyEvent);\n\t\t\tthis._map._textInput._abortComposition(ev);\n\t\t\tthis._clipboardSerial++;\n\t\t\tif (hasFinished)\n\t\t\t\tthis._stopHideDownload();\n\t\t}\n\t\treturn false;\n\t},\n\n\tclearSelection: function() {\n\t\tthis._selectionContent = '';\n\t\tthis._selectionPlainTextContent = '';\n\t\tthis._selectionType = null;\n\t\tthis._scheduleHideDownload();\n\t},\n\n\t// textselectioncontent: message\n\tsetTextSelectionHTML: function(html, plainText = '') {\n\t\tthis._selectionType = 'text';\n\t\tthis._selectionContent = html;\n\t\tthis._selectionPlainTextContent = plainText;\n\t\tif (L.Browser.cypressTest) {\n\t\t\tthis._dummyDiv.innerHTML = html;\n\t\t\tthis._dummyPlainDiv.innerText = plainText;\n\t\t}\n\t\tthis._scheduleHideDownload();\n\t},\n\n\t// Sets the selection type without having the selection content (async clipboard).\n\tsetTextSelectionType: function(selectionType) {\n\t\tthis._selectionType = selectionType;\n\t},\n\n\t// sets the selection to some (cell formula) text)\n\tsetTextSelectionText: function(text) {\n\t\t// Usually 'text' is what we see in the formulabar\n\t\t// In case of actual formula we don't wish to put formula into client clipboard\n\t\t// Putting formula in clipboard means user will paste formula outside of online\n\t\t// Pasting inside online is handled by internal paste\n\t\tif (this._map.getDocType() === 'spreadsheet' && text.startsWith('=')) {\n\t\t\tapp.socket.sendMessage('gettextselection mimetype=text/html');\n\t\t\treturn;\n\t\t}\n\t\tthis._selectionType = 'text';\n\t\tthis._selectionContent = this._originWrapBody(text);\n\t\tthis._selectionPlainTextContent = text;\n\t\tthis._scheduleHideDownload();\n\t},\n\n\t// complexselection: message\n\tonComplexSelection: function (/*text*/) {\n\t\t// Mark this selection as complex.\n\t\tthis._selectionType = 'complex';\n\t\tthis._scheduleHideDownload();\n\t},\n\n\t_startProgress: function(isLargeCopy) {\n\t\tif (!this._downloadProgress) {\n\t\t\tthis._downloadProgress = L.control.downloadProgress();\n\t\t\tthis._map.addControl(this._downloadProgress);\n\t\t}\n\t\tthis._downloadProgress.show(isLargeCopy);\n\t},\n\n\t_onDownloadOnLargeCopyPaste: function () {\n\t\tif (this._downloadProgress && this._downloadProgress.isStarted()) {\n\t\t\t// Need to show this only when a download is really in progress and we block it.\n\t\t\t// Otherwise, it's easier to flash the widget or something.\n\t\t\tthis._warnLargeCopyPasteAlreadyStarted();\n\t\t} else {\n\t\t\tthis._startProgress(true);\n\t\t}\n\t},\n\n\t_downloadProgressStatus: function() {\n\t\tif (this._downloadProgress)\n\t\t\treturn this._downloadProgress.currentStatus();\n\t},\n\n\t// Download button is still shown after selection changed -> user has changed their mind...\n\t_scheduleHideDownload: function() {\n\t\tif (!this._downloadProgress || this._downloadProgress.isClosed())\n\t\t\treturn;\n\n\t\tif (['downloadButton', 'confirmPasteButton'].includes(this._downloadProgressStatus()))\n\t\t\tthis._stopHideDownload();\n\t},\n\n\t// useful if we did an internal paste already and don't want that.\n\t_stopHideDownload: function() {\n\t\tif (!this._downloadProgress || this._downloadProgress.isClosed())\n\t\t\treturn;\n\t\tthis._downloadProgress._onClose();\n\t},\n\n\t_warnCopyPaste: function() {\n\t\tvar id = 'copy_paste_warning';\n\t\tthis._map.uiManager.showYesNoButton(id + '-box', '', '', _('OK'), null, null, null, true);\n\t\tthis._warnCopyPasteImpl(id);\n\t},\n\n\t_warnCopyPasteImpl: function (id) {\n\t\tvar box = document.getElementById(id + '-box');\n\n\t\t// TODO: do it JSDialog native...\n\t\tif (!box) {\n\t\t\tsetTimeout(() => { this._warnCopyPasteImpl(id) }, 10);\n\t\t\treturn;\n\t\t}\n\n\t\tvar innerDiv = L.DomUtil.create('div', '', null);\n\t\tbox.insertBefore(innerDiv, box.firstChild);\n\n\t\tif (window.mode.isMobile() || window.mode.isTablet()) {\n\t\t\tconst p = document.createElement('p');\n\t\t\tp.textContent = _('Your browser has very limited access to the clipboard, so please use the paste buttons on your on-screen keyboard instead.');\n\t\t\tinnerDiv.appendChild(p);\n\t\t}\n\t\telse {\n\t\t\tconst ctrlText = app.util.replaceCtrlAltInMac('Ctrl');\n\t\t\tconst p = document.createElement('p');\n\t\t\tp.textContent = 'Your browser has very limited access to the clipboard, so use these keyboard shortcuts:';\n\t\t\tinnerDiv.appendChild(p);\n\n\t\t\tconst table = document.createElement('table');\n\t\t\ttable.className = 'warn-copy-paste';\n\t\t\tinnerDiv.appendChild(table);\n\n\t\t\tlet row = document.createElement('tr');\n\t\t\ttable.appendChild(row);\n\n\t\t\t// Add three cells for copy & cut & paste.\n\t\t\tfor (let i = 0; i < 3; i++) {\n\t\t\t\tconst cell = document.createElement('td');\n\t\t\t\trow.appendChild(cell);\n\n\t\t\t\tlet kbd = document.createElement('kbd');\n\t\t\t\tkbd.textContent = ctrlText;\n\t\t\t\tcell.appendChild(kbd);\n\n\t\t\t\tconst span = document.createElement('span');\n\t\t\t\tspan.textContent = '+';\n\t\t\t\tspan.className = 'kbd--plus';\n\t\t\t\tcell.appendChild(span);\n\n\t\t\t\tkbd = document.createElement('kbd');\n\t\t\t\tkbd.textContent = i === 0 ? 'C': (i === 1 ? 'X': 'V');\n\t\t\t\tcell.appendChild(kbd);\n\t\t\t}\n\n\t\t\t// Add table headers as second row.\n\t\t\trow = document.createElement('tr');\n\t\t\ttable.appendChild(row);\n\t\t\tfor (let i = 0; i < 3; i++) {\n\t\t\t\tconst cell = document.createElement('td');\n\t\t\t\tcell.textContent = i === 0 ? 'Copy': (i === 1 ? 'Cut': 'Paste');\n\t\t\t\trow.appendChild(cell);\n\t\t\t}\n\t\t}\n\t},\n\n\t_substProductName: function (msg) {\n\t\tvar productName = (typeof brandProductName !== 'undefined') ? brandProductName : 'Collabora Online Development Edition (unbranded)';\n\t\treturn msg.replace('{productname}', productName);\n\t},\n\n\t_warnLargeCopyPasteAlreadyStarted: function () {\n\t\tthis._map.uiManager.showInfoModal('large copy paste started warning');\n\t\tconst container = document.getElementById('large copy paste started warning');\n\t\tcontainer.replaceChildren();\n\t\tconst p = document.createElement('p');\n\t\tp.textContent = _('A download due to a large copy/paste operation has already started. Please, wait for the current download or cancel it before starting a new one');\n\t\tcontainer.appendChild(p);\n\t},\n\n\tisPasteSpecialDialogOpen: function() {\n\t\tif (!this.pasteSpecialDialogId)\n\t\t\treturn false;\n\t\telse {\n\t\t\tvar result = document.getElementById(this.pasteSpecialDialogId);\n\t\t\treturn result !== undefined && result !== null ? true: false;\n\t\t}\n\t},\n\n\tisCopyPasteDialogReadyForCopy: function () {\n\t\treturn this._downloadProgress && this._downloadProgress.isComplete();\n\t},\n\n\t_openPasteSpecialPopup: function () {\n\t\t// We will use this for closing the dialog.\n\t\tthis.pasteSpecialDialogId = this._map.uiManager.generateModalId('paste_special_dialog') + '-box';\n\n\t\tvar id = 'paste_special_dialog';\n\t\tthis._map.uiManager.showYesNoButton(id + '-box', /*title=*/'', /*message=*/'', /*yesButtonText=*/_('Paste from this document'), /*noButtonText=*/_('Cancel paste special'), /*yesFunction=*/function() {\n\t\t\tapp.socket.sendMessage('uno .uno:PasteSpecial');\n\t\t}, /*noFunction=*/null, /*cancellable=*/true);\n\n\t\tthis._openPasteSpecialPopupImpl(id);\n\t},\n\n\t_openPasteSpecialPopupImpl: function (id) {\n\t\tvar box = document.getElementById(id + '-box');\n\n\t\t// TODO: do it JSDialog native...\n\t\tif (!box) {\n\t\t\tsetTimeout(() => { this._openPasteSpecialPopupImpl(id) }, 10);\n\t\t\treturn;\n\t\t}\n\n\t\tvar innerDiv = L.DomUtil.create('div', '', null);\n\t\tbox.insertBefore(innerDiv, box.firstChild);\n\n\t\tconst ctrlText = app.util.replaceCtrlAltInMac('Ctrl');\n\n\t\tlet p = document.createElement('p');\n\t\tp.textContent = _('Your browser has very limited access to the clipboard');\n\t\tinnerDiv.appendChild(p);\n\t\tp = document.createElement('p');\n\t\tinnerDiv.appendChild(p);\n\t\tconst bold = document.createElement('b');\n\t\tbold.textContent = _('Please use following combination to see more options:');\n\t\tp.appendChild(bold);\n\n\t\tp = document.createElement('p');\n\t\tinnerDiv.appendChild(p);\n\t\tlet kbd = document.createElement('kbd');\n\t\tkbd.textContent = ctrlText;\n\t\tp.appendChild(kbd);\n\t\tconst span = document.createElement('span');\n\t\tspan.className = 'kbd--plus';\n\t\tspan.textContent = '+';\n\t\tp.appendChild(span);\n\t\tkbd = document.createElement('kbd');\n\t\tkbd.textContent = 'V';\n\t\tp.appendChild(kbd);\n\n\t\tp = document.createElement('p');\n\t\tinnerDiv.appendChild(p);\n\t\tp.textContent = _('Close popup to ignore paste special');\n\n\t\t// Drop the not wanted whitespace between the dialog body and the button row at the\n\t\t// bottom.\n\t\tvar label = document.getElementById('modal-dialog-' + id + '-box-label');\n\t\tlabel.style.display = 'none';\n\t},\n\n\t// Check if the paste special mode is enabled, and if so disable it.\n\t_checkAndDisablePasteSpecial: function() {\n\t\tif (this._navigatorClipboardPasteSpecial) {\n\t\t\tthis._navigatorClipboardPasteSpecial = false;\n\t\t\treturn true;\n\t\t}\n\n\t\tif (this.isPasteSpecialDialogOpen()) {\n\t\t\tthis._map.jsdialog.closeDialog(this.pasteSpecialDialogId, false);\n\t\t\treturn true;\n\t\t}\n\n\t\treturn false;\n\t},\n});\n\nL.clipboard = function(map) {\n\tif (window.ThisIsTheAndroidApp)\n\t\twindow.app.console.log('======> Assertion failed!? No L.Clipboard object should be needed in the Android app');\n\treturn new L.Clipboard(map);\n};\n"]}