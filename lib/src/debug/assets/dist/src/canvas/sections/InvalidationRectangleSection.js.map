{"version":3,"file":"InvalidationRectangleSection.js","sourceRoot":"","sources":["../../../../../../../../../../../TanhX/online/browser/src/canvas/sections/InvalidationRectangleSection.ts"],"names":[],"mappings":"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","sourcesContent":["/* -*- js-indent-level: 8 -*- */\n\n/*\n * Copyright the Collabora Online contributors.\n *\n * SPDX-License-Identifier: MPL-2.0\n *\n * This Source Code Form is subject to the terms of the Mozilla Public\n * License, v. 2.0. If a copy of the MPL was not distributed with this\n * file, You can obtain one at http://mozilla.org/MPL/2.0/.\n */\n\nconst sectionName = 'TileInvalidationRectangle';\n\nclass InvalidationRectangleSection extends CanvasSectionObject {\n\tname: string = sectionName;\n\n\t/*\n\t\tWe don't want visibility issues.\n\t\tSince there will be more than one rectangles in this section, position property (thus document section) is not useful anymore.\n\t*/\n\twindowSection: boolean = true;\n\tshowSection: boolean = true;\n\tzIndex: number = L.CSections.DefaultForDocumentObjects.zIndex;\n\tdrawingOrder: number = L.CSections.DefaultForDocumentObjects.drawingOrder;\n\tprocessingOrder: number =\n\t\tL.CSections.DefaultForDocumentObjects.processingOrder;\n\tinteractable: boolean = false;\n\n\tconstructor() {\n\t\tsuper();\n\t\tthis.sectionProperties.rectangleList = [];\n\t}\n\n\taddRectangle(x: number, y: number, width: number, height: number) {\n\t\tconst rectangleList: Array<any> = this.sectionProperties\n\t\t\t.rectangleList as Array<any>;\n\n\t\tif (rectangleList.length === 5) rectangleList.pop();\n\n\t\trectangleList.unshift([x, y, width, height]);\n\t}\n\n\tonDraw(\n\t\tframeCount?: number,\n\t\telapsedTime?: number,\n\t\tsubsetBounds?: Bounds,\n\t): void {\n\t\tconst rectangleList: Array<any> = this.sectionProperties\n\t\t\t.rectangleList as Array<any>;\n\t\tthis.context.strokeStyle = 'red';\n\n\t\tconst anchor: number[] = this.containerObject.getDocumentAnchor();\n\t\tconst xDiff = anchor[0] - this.documentTopLeft[0];\n\t\tconst yDiff = anchor[1] - this.documentTopLeft[1];\n\n\t\tfor (let i = 0; i < rectangleList.length; i++) {\n\t\t\tthis.context.globalAlpha = 1 - 0.15 * i;\n\t\t\tthis.context.strokeRect(\n\t\t\t\txDiff + rectangleList[i][0],\n\t\t\t\tyDiff + rectangleList[i][1],\n\t\t\t\trectangleList[i][2],\n\t\t\t\trectangleList[i][3],\n\t\t\t);\n\t\t}\n\t\tthis.context.globalAlpha = 1;\n\t}\n\n\tcheckDeletion() {\n\t\tif (this.sectionProperties.rectangleList.length > 0) {\n\t\t\tthis.sectionProperties.rectangleList.pop();\n\t\t\tsetTimeout(() => {\n\t\t\t\tthis.checkDeletion();\n\t\t\t}, 1000);\n\t\t} else {\n\t\t\tapp.sectionContainer.removeSection(this.name);\n\t\t}\n\t}\n\n\tprivate static getSection(): InvalidationRectangleSection {\n\t\tlet section: InvalidationRectangleSection;\n\t\tif (app.sectionContainer.doesSectionExist(sectionName))\n\t\t\tsection = app.sectionContainer.getSectionWithName(\n\t\t\t\tsectionName,\n\t\t\t) as InvalidationRectangleSection;\n\t\telse {\n\t\t\tsection = new InvalidationRectangleSection();\n\t\t\tapp.sectionContainer.addSection(section);\n\t\t\tsetTimeout(() => {\n\t\t\t\tsection.checkDeletion();\n\t\t\t}, 2000); // Start the cycle.\n\t\t}\n\n\t\treturn section;\n\t}\n\n\tpublic static setRectangle(\n\t\tx: number,\n\t\ty: number,\n\t\twidth: number,\n\t\theight: number,\n\t) {\n\t\tconst section = this.getSection();\n\t\tsection.addRectangle(x, y, width, height);\n\t}\n}\n"]}