{"version":3,"file":"ShapeHandleAnchorSubSection.js","sourceRoot":"","sources":["../../../../../../../../../../../TanhX/online/browser/src/canvas/sections/ShapeHandleAnchorSubSection.ts"],"names":[],"mappings":"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","sourcesContent":["// @ts-strict-ignore\n/* global Proxy _ */\n/*\n * Copyright the Collabora Online contributors.\n *\n * SPDX-License-Identifier: MPL-2.0\n *\n * This Source Code Form is subject to the terms of the Mozilla Public\n * License, v. 2.0. If a copy of the MPL was not distributed with this\n * file, You can obtain one at http://mozilla.org/MPL/2.0/.\n*/\n\n/*\n\tThis class is for the sub sections (handles) of ShapeHandlesSection.\n\tShape is rendered on the core side. Only the handles are drawn here and modification commands are sent to the core side.\n*/\n\nclass ShapeHandleAnchorSubSection extends HTMLObjectSection {\n\tstatic tableAnchorIconSize = [20, 20]; // CSS pixels.\n\n\tconstructor (parentHandlerSection: ShapeHandlesSection, sectionName: string, size: number[], documentPosition: cool.SimplePoint, ownInfo: any) {\n        super(sectionName, size[0], size[1], documentPosition, 'anchor-marker');\n\n\t\tthis.getHTMLObject().style.opacity = 1;\n\t\tthis.getHTMLObject().remove();\n\t\tdocument.getElementById('map').appendChild(this.getHTMLObject());\n\n\t\tapp.definitions.shapeHandlesSection.mirrorEventsFromSourceToCanvasSectionContainer(this.getHTMLObject());\n\n        this.sectionProperties.parentHandlerSection = parentHandlerSection;\n\t\tthis.sectionProperties.ownInfo = ownInfo;\n\t\tthis.sectionProperties.mouseIsInside = false;\n\t}\n\n\tonMouseEnter() {\n\t\tthis.backgroundColor = 'grey';\n\t\tthis.containerObject.requestReDraw();\n\t}\n\n\tonMouseLeave() {\n\t\tthis.backgroundColor = null;\n\t\tthis.containerObject.requestReDraw();\n\t}\n\n\ttableMouseUp(point: number[], e: MouseEvent) {\n\t\tconst parameters = {\n\t\t\t'TransformPosX': {\n\t\t\t\t'type': 'long',\n\t\t\t\t'value': Math.round((point[0] + this.position[0]) * app.pixelsToTwips)\n\t\t\t},\n\t\t\t'TransformPosY': {\n\t\t\t\t'type': 'long',\n\t\t\t\t'value': Math.round((point[1] + this.position[1]) * app.pixelsToTwips)\n\t\t\t}\n\t\t};\n\n\t\tapp.map.sendUnoCommand('.uno:TransformDialog', parameters);\n\t}\n\n\tshapeMouseUp(point: number[], e: MouseEvent) {\n\t\tconst parameters = {\n\t\t\t'HandleNum': {\n\t\t\t\t'type': 'long',\n\t\t\t\t'value': this.sectionProperties.ownInfo.id\n\t\t\t},\n\t\t\t'NewPosX': {\n\t\t\t\t'type': 'long',\n\t\t\t\t'value': Math.round((point[0] + this.position[0]) * app.pixelsToTwips)\n\t\t\t},\n\t\t\t'NewPosY': {\n\t\t\t\t'type': 'long',\n\t\t\t\t'value': Math.round((point[1] + this.position[1]) * app.pixelsToTwips)\n\t\t\t}\n\t\t};\n\n\t\tapp.map.sendUnoCommand('.uno:MoveShapeHandle', parameters);\n\t}\n\n\tonMouseUp(point: number[], e: MouseEvent): void {\n\t\tif (this.containerObject.isDraggingSomething()) {\n\t\t\t// Tables don't have parent sections. This is used for separating table anchors from other anchors.\n\t\t\tif (this.sectionProperties.parentHandlerSection) {\n\t\t\t\tthis.shapeMouseUp(point, e);\n\t\t\t}\n\t\t\telse {\n\t\t\t\tthis.tableMouseUp(point, e);\n\t\t\t}\n\t\t}\n\t}\n\n\tonMouseMove(point: Array<number>, dragDistance: Array<number>, e: MouseEvent) {\n\t\tif (this.containerObject.isDraggingSomething()) {\n\t\t\t// Show preview in its final position.\n\t\t\tlet svg;\n\t\t\tlet initialPosition;\n\t\t\tif (this.sectionProperties.parentHandlerSection) {\n\t\t\t\tthis.sectionProperties.parentHandlerSection.showSVG();\n\t\t\t\tsvg = this.sectionProperties.parentHandlerSection.sectionProperties.svg;\n\t\t\t\tinitialPosition = this.sectionProperties.parentHandlerSection.sectionProperties.svgPosition;\n\t\t\t}\n\t\t\telse {\n\t\t\t\t// Table..\n\t\t\t\tsvg = document.getElementById('canvas-container').querySelector('svg');\n\t\t\t\tsvg.style.display = '';\n\t\t\t\tif (!this.sectionProperties.initialPosition) {\n\t\t\t\t\tthis.sectionProperties.initialPosition = [parseFloat(svg.style.left.replace('px', '')) * app.dpiScale, parseFloat(svg.style.top.replace('px', '')) * app.dpiScale];\n\t\t\t\t}\n\t\t\t\tinitialPosition = this.sectionProperties.initialPosition;\n\t\t\t}\n\t\t\tsvg.style.left = (dragDistance[0] + initialPosition[0]) / app.dpiScale + 'px';\n\t\t\tsvg.style.top = (dragDistance[1] + initialPosition[1]) / app.dpiScale + 'px';\n\n\t\t\tthis.stopPropagating();\n\t\t\te.stopPropagation();\n\t\t}\n\t}\n}\n\napp.definitions.shapeHandleAnchorSubSection = ShapeHandleAnchorSubSection;\n"]}