{"version":3,"file":"CommentListSection.js","sourceRoot":"","sources":["../../../../../../../../../../../TanhX/online/browser/src/canvas/sections/CommentListSection.ts"],"names":[],"mappings":"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","sourcesContent":["// @ts-strict-ignore\n/* -*- js-indent-level: 8 -*- */\n\n/*\n * Copyright the Collabora Online contributors.\n *\n * SPDX-License-Identifier: MPL-2.0\n *\n * This Source Code Form is subject to the terms of the Mozilla Public\n * License, v. 2.0. If a copy of the MPL was not distributed with this\n * file, You can obtain one at http://mozilla.org/MPL/2.0/.\n */\n/* eslint-disable @typescript-eslint/explicit-module-boundary-types */\n\n/* See CanvasSectionContainer.ts for explanations. */\n\nL.Map.include({\n\tinsertComment: function() {\n\t\tif (this.stateChangeHandler.getItemValue('InsertAnnotation') === 'disabled')\n\t\t\treturn;\n\t\tif (cool.Comment.isAnyEdit()) {\n\t\t\tcool.CommentSection.showCommentEditingWarning();\n\t\t\treturn;\n\t\t}\n\t\tvar avatar = undefined;\n\t\tvar author = this.getViewName(this._docLayer._viewId);\n\t\tif (author in this._viewInfoByUserName) {\n\t\t\tavatar = this._viewInfoByUserName[author].userextrainfo.avatar;\n\t\t}\n\t\tthis._docLayer.newAnnotation({\n\t\t\ttext: '',\n\t\t\ttextrange: '',\n\t\t\tauthor: author,\n\t\t\tdateTime: new Date().toISOString(),\n\t\t\tid: 'new', // 'new' only when added by us\n\t\t\tavatar: avatar\n\t\t});\n\t},\n\n\tshowResolvedComments: function(on: any) {\n\t\tvar unoCommand = '.uno:ShowResolvedAnnotations';\n\t\tthis.sendUnoCommand(unoCommand);\n\t\tapp.sectionContainer.getSectionWithName(L.CSections.CommentList.name).setViewResolved(on);\n\t\tthis.uiManager.setDocTypePref('ShowResolved', on ? true : false);\n\t},\n\n\tshowComments: function(on: any) {\n\t\tapp.sectionContainer.getSectionWithName(L.CSections.CommentList.name).setView(on);\n\t\tthis.uiManager.setDocTypePref('showannotations', on ? true : false);\n\t\tthis.fire('commandstatechanged', {commandName : 'showannotations', state : on ? 'true': 'false'});\n\t\tthis.fire('showannotationschanged', {state: on ? 'true': 'false'});\n\t}\n});\n\n\ndeclare var L: any;\ndeclare var JSDialog: any;\n\nnamespace cool {\n\nexport class CommentSection extends CanvasSectionObject {\n\tname: string = L.CSections.CommentList.name;\n\tbackgroundColor: string = app.sectionContainer.clearColor;\n\texpand: string[] = ['bottom'];\n\tprocessingOrder: number = L.CSections.CommentList.processingOrder;\n\tdrawingOrder: number = L.CSections.CommentList.drawingOrder;\n\tzIndex: number = L.CSections.CommentList.zIndex;\n\tinteractable: boolean = false;\n\tsectionProperties: {\n\t\tcommentList: Array<Comment>;\n\t\tselectedComment: Comment | null;\n\t\tcalcCurrentComment: Comment | null;\n\t\tmarginY: number;\n\t\toffset: number;\n\t\twidth: number;\n\t\tcommentWidth: number;\n\t\tcollapsedMarginToTheEdge: number;\n\t\tdeflectionOfSelectedComment: number;\n\t\tshowSelectedBigger: boolean;\n\t\tcommentsAreListed: boolean;\n\t\t[key: string]: any;\n\t};\n\tdisableLayoutAnimation: boolean = false;\n\tmobileCommentId: string = 'new-annotation-dialog';\n\tmobileCommentModalId: string;\n\n\tmap: any;\n\tstatic autoSavedComment: cool.Comment;\n\tstatic needFocus: cool.Comment;\n\tstatic commentWasAutoAdded: boolean = false;\n\tstatic pendingImport: boolean = false;\n\tstatic importingComments: boolean = false; // active during comments insertion, disable scroll\n\n\t// To associate comment id with its index in commentList array.\n\tprivate idIndexMap: Map<any, number>;\n\n\tprivate annotationMinSize: number;\n\tprivate annotationMaxSize: number;\n\n\tconstructor () {\n\t\tsuper();\n\n\t\tthis.map = L.Map.THIS;\n\t\tthis.anchor = ['top', 'right'];\n\t\tthis.sectionProperties.docLayer = this.map._docLayer;\n\t\tthis.sectionProperties.commentList = new Array(0);\n\t\tthis.sectionProperties.selectedComment = null;\n\t\tthis.sectionProperties.arrow = null;\n\t\tthis.sectionProperties.show = null;\n\t\tthis.sectionProperties.showResolved = null;\n\t\tthis.sectionProperties.marginY = 10 * app.dpiScale;\n\t\tthis.sectionProperties.offset = 5 * app.dpiScale;\n\t\tthis.sectionProperties.width = Math.round(1 * app.dpiScale); // Configurable variable.\n\t\tthis.sectionProperties.scrollAnnotation = null; // For impress, when 1 or more comments exist.\n\t\tthis.sectionProperties.commentWidth = 200 * 1.3; // CSS pixels.\n\t\tthis.sectionProperties.collapsedMarginToTheEdge = 120; // CSS pixels.\n\t\tthis.sectionProperties.deflectionOfSelectedComment = 160; // CSS pixels.\n\t\tthis.sectionProperties.showSelectedBigger = false;\n\t\tthis.sectionProperties.calcCurrentComment = null; // We don't automatically show a Calc comment when cursor is on its cell. But we remember it to show if user presses Alt+C keys.\n\t\tthis.sectionProperties.pendingUpdate = false;\n\t\tthis.sectionProperties.reLayout = true;\n\n\t\t// This (commentsAreListed) variable means that comments are shown as a list on the right side of the document.\n\t\tthis.sectionProperties.commentsAreListed = (app.map._docLayer._docType === 'text' || app.map._docLayer._docType === 'presentation' || app.map._docLayer._docType === 'drawing') && !(<any>window).mode.isMobile();\n\t\tthis.idIndexMap = new Map<any, number>();\n\t\tthis.mobileCommentModalId = this.map.uiManager.generateModalId(this.mobileCommentId);\n\t\tthis.annotationMinSize = Number(getComputedStyle(document.documentElement).getPropertyValue('--annotation-min-size'));\n\t\tthis.annotationMaxSize = Number(getComputedStyle(document.documentElement).getPropertyValue('--annotation-max-size'));\n\t}\n\n\tpublic onInitialize (): void {\n\t\tthis.checkCollapseState();\n\n\t\tthis.map.on('RedlineAccept', this.onRedlineAccept, this);\n\t\tthis.map.on('RedlineReject', this.onRedlineReject, this);\n\t\tthis.map.on('updateparts', this.showHideComments, this);\n\t\tthis.map.on('AnnotationScrollUp', this.onAnnotationScrollUp, this);\n\t\tthis.map.on('AnnotationScrollDown', this.onAnnotationScrollDown, this);\n\n\t\tthis.map.on('commandstatechanged', function (event: any) {\n\t\t\tif (event.commandName === '.uno:ShowResolvedAnnotations')\n\t\t\t\tthis.setViewResolved(event.state === 'true');\n\t\t\telse if (event.commandName === 'showannotations')\n\t\t\t\tthis.setView(event.state === 'true');\n\t\t\telse if (event.commandName === '.uno:ShowTrackedChanges' && event.state === 'true')\n\t\t\t\tapp.socket.sendMessage('commandvalues command=.uno:ViewAnnotations');\n\t\t}, this);\n\n\t\tthis.map.on('zoomend', function() {\n\t\t\tthis.checkCollapseState();\n\t\t\tthis.layout(true);\n\t\t}, this);\n\n\t\tthis.backgroundColor = this.containerObject.getClearColor();\n\t\tthis.initializeContextMenus();\n\n\t\tif ((<any>window).mode.isMobile()) {\n\t\t\tthis.setShowSection(false);\n\t\t\tthis.size[0] = 0;\n\t\t}\n\t}\n\n\tpublic static showCommentEditingWarning (): void {\n\t\tL.Map.THIS.uiManager.showInfoModal('annotation-editing', _('A comment is being edited'),\n\t\t_('Please save or discard the comment currently being edited.'), null, _('Close'));\n\t}\n\n\tprivate checkCollapseState(): void {\n\t\tif (!(<any>window).mode.isMobile() && app.map._docLayer._docType !== 'spreadsheet') {\n\t\t\tif (this.shouldCollapse()) {\n\t\t\t\tthis.sectionProperties.deflectionOfSelectedComment = 180;\n\t\t\t\tthis.setCollapsed();\n\t\t\t}\n\t\t\telse {\n\t\t\t\tthis.sectionProperties.deflectionOfSelectedComment = 70;\n\t\t\t\tthis.setExpanded();\n\t\t\t}\n\n\t\t\tif (app.map._docLayer._docType === 'presentation' || app.map._docLayer._docType === 'drawing')\n\t\t\t\tthis.showHideComments();\n\t\t}\n\t}\n\n\tprivate findNextPartWithComment (currentPart: number): number {\n\t\tfor (var i = 0;  i < this.sectionProperties.commentList.length; i++) {\n\t\t\tif (this.sectionProperties.commentList[i].sectionProperties.partIndex > currentPart) {\n\t\t\t\treturn this.sectionProperties.commentList[i].sectionProperties.partIndex;\n\t\t\t}\n\t\t}\n\t\treturn -1;\n\t}\n\n\tprivate findPreviousPartWithComment (currentPart: number): number {\n\t\tfor (var i = this.sectionProperties.commentList.length - 1;  i > -1; i--) {\n\t\t\tif (this.sectionProperties.commentList[i].sectionProperties.partIndex < currentPart) {\n\t\t\t\treturn this.sectionProperties.commentList[i].sectionProperties.partIndex;\n\t\t\t}\n\t\t}\n\t\treturn -1;\n\t}\n\n\tpublic onAnnotationScrollDown (): void {\n\t\tvar index = this.findNextPartWithComment(app.map._docLayer._selectedPart);\n\t\tif (index >= 0) {\n\t\t\tthis.map.setPart(index);\n\t\t}\n\t}\n\n\tpublic onAnnotationScrollUp (): void {\n\t\tvar index = this.findPreviousPartWithComment(app.map._docLayer._selectedPart);\n\t\tif (index >= 0) {\n\t\t\tthis.map.setPart(index);\n\t\t}\n\t}\n\n\tprivate checkSize (): void {\n\t\t// When there is no comment || file is a spreadsheet || view type is mobile, we set this section's size to [0, 0].\n\t\tif (app.map._docLayer._docType === 'spreadsheet' || (<any>window).mode.isMobile() || this.sectionProperties.commentList.length === 0)\n\t\t{\n\t\t\tif (app.map._docLayer._docType === 'presentation' && this.sectionProperties.scrollAnnotation) {\n\t\t\t\tthis.map.removeControl(this.sectionProperties.scrollAnnotation);\n\t\t\t\tthis.sectionProperties.scrollAnnotation = null;\n\t\t\t}\n\t\t}\n\t\telse if (app.map._docLayer._docType === 'presentation') { // If there are comments but none of them are on the selected part.\n\t\t\tif (!this.sectionProperties.scrollAnnotation) {\n\t\t\t\tthis.sectionProperties.scrollAnnotation = L.control.scrollannotation();\n\t\t\t\tthis.sectionProperties.scrollAnnotation.addTo(this.map);\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate isEditing(): boolean {\n\t\tconst textBoxes = this.sectionProperties.commentList\n\t\t\t.flatMap((section: any) => [section.sectionProperties.nodeModifyText, section.sectionProperties.nodeReplyText])\n\t\t\t.filter((textBox: any) => textBox !== undefined);\n\n\t\treturn textBoxes.includes(document.activeElement);\n\t}\n\n\tpublic getActiveEdit(): Comment {\n\t\tif (!this.sectionProperties.selectedComment) {\n\t\t\treturn null;\n\t\t}\n\t\tif (this.sectionProperties.selectedComment.isEdit()) {\n\t\t\treturn this.sectionProperties.selectedComment;\n\t\t}\n\t\tvar openArray: Comment[] = [];\n\t\tthis.getChildren(this.sectionProperties.selectedComment, openArray);\n\t\tfor (var i = 0; i < openArray.length; i++) {\n\t\t\tif (openArray[i].isEdit()) {\n\t\t\t\treturn openArray[i];\n\t\t\t}\n\t\t}\n\t\treturn null;\n\t}\n\n\tpublic setCollapsed(): void {\n\t\tif (this.isEditing()) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.isCollapsed = true;\n\t\tthis.unselect();\n\t\tfor (var i: number = 0; i < this.sectionProperties.commentList.length; i++) {\n\t\t\tif (this.sectionProperties.commentList[i].sectionProperties.data.id !== 'new')\n\t\t\t\tthis.sectionProperties.commentList[i].setCollapsed();\n\t\t\t\t$(this.sectionProperties.commentList[i].sectionProperties.container).addClass('collapsed-comment');\n\t\t\tif (this.sectionProperties.commentList[i].isRootComment())\n\t\t\t\tthis.collapseReplies(i, this.sectionProperties.commentList[i].sectionProperties.data.id);\n\t\t}\n\t}\n\n\tpublic setExpanded(): void {\n\t\tthis.isCollapsed = false;\n\t\tfor (var i: number = 0; i < this.sectionProperties.commentList.length; i++) {\n\t\t\tthis.sectionProperties.commentList[i].setExpanded();\n\t\t\t$(this.sectionProperties.commentList[i].sectionProperties.container).removeClass('collapsed-comment');\n\t\t}\n\t}\n\n\tprivate calculateAvailableSpace() {\n\t\tvar availableSpace = (this.containerObject.getDocumentAnchorSection().size[0] - app.file.size.pX) * 0.5;\n\t\tavailableSpace = Math.round(availableSpace / app.dpiScale);\n\t\treturn availableSpace;\n\t}\n\n\tpublic shouldCollapse (): boolean {\n\t\tif (!this.containerObject.getDocumentAnchorSection() || app.map._docLayer._docType === 'spreadsheet' || (<any>window).mode.isMobile())\n\t\t\treturn false;\n\n\t\treturn this.calculateAvailableSpace() < this.sectionProperties.commentWidth;\n\t}\n\n\tpublic hideAllComments (): void {\n\t\tfor (var i: number = 0; i < this.sectionProperties.commentList.length; i++) {\n\t\t\tthis.sectionProperties.commentList[i].hide();\n\t\t\tvar part = app.map._docLayer._selectedPart;\n\t\t\tif (app.map._docLayer._docType === 'spreadsheet') {\n\t\t\t\t// Change drawing order so they don't prevent each other from being shown.\n\t\t\t\tif (parseInt(this.sectionProperties.commentList[i].sectionProperties.data.tab) === part) {\n\t\t\t\t\tthis.sectionProperties.commentList[i].drawingOrder = 2;\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tthis.sectionProperties.commentList[i].drawingOrder = 1;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (app.map._docLayer._docType === 'spreadsheet')\n\t\t\tthis.containerObject.applyDrawingOrders();\n\t}\n\n\t// Mobile.\n\tprivate getChildren(comment: any, array: Array<any>) {\n\t\tfor (var i = 0; i < comment.sectionProperties.children.length; i++) {\n\t\t\tarray.push(comment.sectionProperties.children[i]);\n\t\t\tif (comment.sectionProperties.children[i].sectionProperties.children.length > 0)\n\t\t\t\tthis.getChildren(comment.sectionProperties.children[i], array);\n\t\t}\n\t}\n\n\t// Mobile.\n\tprivate getCommentListOneDimensionalArray() {\n\t\t// 1 dimensional array of ordered comments.\n\t\tvar openArray = [];\n\n\t\tfor (var i = 0; i < this.sectionProperties.commentList.length; i++) {\n\t\t\tif (this.sectionProperties.commentList[i].isRootComment()) {\n\t\t\t\topenArray.push(this.sectionProperties.commentList[i]);\n\t\t\t\tif (this.sectionProperties.commentList[i].sectionProperties.children.length > 0)\n\t\t\t\t\tthis.getChildren(this.sectionProperties.commentList[i], openArray);\n\t\t\t}\n\t\t}\n\t\treturn openArray;\n\t}\n\n\tprivate createCommentStructureWriter (menuStructure: any, threadOnly: any): void {\n\t\tvar rootComment, comment;\n\t\tvar commentList = this.getCommentListOneDimensionalArray();\n\t\tvar showResolved = this.sectionProperties.showResolved;\n\n\t\tif (threadOnly) {\n\t\t\tif (!threadOnly.sectionProperties.data.trackchange && threadOnly.sectionProperties.data.parent !== '0')\n\t\t\t\tthreadOnly = commentList[this.getIndexOf(threadOnly.sectionProperties.data.parent)];\n\t\t}\n\n\t\tfor (var i = 0; i < commentList.length; i++) {\n\t\t\tif (commentList[i].isRootComment() || commentList[i].sectionProperties.data.trackchange) {\n\t\t\t\tvar commentThread = [];\n\t\t\t\tdo {\n\t\t\t\t\tcomment = {\n\t\t\t\t\t\tid: 'comment' + commentList[i].sectionProperties.data.id,\n\t\t\t\t\t\tenable: true,\n\t\t\t\t\t\tdata: commentList[i].sectionProperties.data,\n\t\t\t\t\t\ttype: 'comment',\n\t\t\t\t\t\ttext: commentList[i].sectionProperties.data.text,\n\t\t\t\t\t\tannotation: commentList[i],\n\t\t\t\t\t\tchildren: []\n\t\t\t\t\t};\n\n\t\t\t\t\tif (showResolved || comment.data.resolved !== 'true') {\n\t\t\t\t\t\tcommentThread.unshift(comment);\n\t\t\t\t\t}\n\t\t\t\t\ti++;\n\t\t\t\t} while (commentList[i] && commentList[i].sectionProperties.data.parent !== '0');\n\t\t\t\ti--;\n\n\t\t\t\tif (commentThread.length > 0)\n\t\t\t\t{\n\t\t\t\t\trootComment = {\n\t\t\t\t\t\tid: commentThread[commentThread.length - 1].id,\n\t\t\t\t\t\tenable: true,\n\t\t\t\t\t\tdata: commentThread[commentThread.length - 1].data,\n\t\t\t\t\t\ttype: 'rootcomment',\n\t\t\t\t\t\ttext: commentThread[commentThread.length - 1].data.text,\n\t\t\t\t\t\tannotation: commentThread[commentThread.length - 1].annotation,\n\t\t\t\t\t\tchildren: commentThread\n\t\t\t\t\t};\n\n\t\t\t\t\tvar matchingThread = threadOnly && threadOnly.sectionProperties.data.id === commentThread[0].data.id;\n\t\t\t\t\tif (matchingThread)\n\t\t\t\t\t\tmenuStructure['children'] = commentThread;\n\t\t\t\t\telse if (!threadOnly)\n\t\t\t\t\t\tmenuStructure['children'].push(rootComment);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tpublic createCommentStructureImpress (menuStructure: any, threadOnly: any): void {\n\t\tvar rootComment;\n\n\t\tfor (var i in this.sectionProperties.commentList) {\n\t\t\tvar matchingThread = !threadOnly || (threadOnly && threadOnly.sectionProperties.data.id === this.sectionProperties.commentList[i].sectionProperties.data.id);\n\t\t\tif (matchingThread && (this.sectionProperties.commentList[i].sectionProperties.partIndex === app.map._docLayer._selectedPart || app.file.fileBasedView)) {\n\t\t\t\trootComment = {\n\t\t\t\t\tid: 'comment' + this.sectionProperties.commentList[i].sectionProperties.data.id,\n\t\t\t\t\tenable: true,\n\t\t\t\t\tdata: this.sectionProperties.commentList[i].sectionProperties.data,\n\t\t\t\t\ttype: threadOnly ? 'comment' : 'rootcomment',\n\t\t\t\t\ttext: this.sectionProperties.commentList[i].sectionProperties.data.text,\n\t\t\t\t\tannotation: this.sectionProperties.commentList[i],\n\t\t\t\t\tchildren: []\n\t\t\t\t};\n\t\t\t\tmenuStructure['children'].push(rootComment);\n\t\t\t}\n\t\t}\n\t}\n\n\tpublic createCommentStructureCalc (menuStructure: any, threadOnly: any): void {\n\t\tvar rootComment;\n\t\tvar commentList = this.sectionProperties.commentList;\n\t\tvar selectedTab = app.map._docLayer._selectedPart;\n\n\t\tfor (var i: number = 0; i < commentList.length; i++) {\n\t\t\tvar matchingThread = !threadOnly || (threadOnly && threadOnly.sectionProperties.data.id === commentList[i].sectionProperties.data.id);\n\t\t\tif (parseInt(commentList[i].sectionProperties.data.tab) === selectedTab && matchingThread) {\n\t\t\t\trootComment = {\n\t\t\t\t\tid: 'comment' + commentList[i].sectionProperties.data.id,\n\t\t\t\t\tenable: true,\n\t\t\t\t\tdata: commentList[i].sectionProperties.data,\n\t\t\t\t\ttype: threadOnly ? 'comment' : 'rootcomment',\n\t\t\t\t\ttext: commentList[i].sectionProperties.data.text,\n\t\t\t\t\tannotation: commentList[i],\n\t\t\t\t\tchildren: []\n\t\t\t\t};\n\t\t\t\tmenuStructure['children'].push(rootComment);\n\t\t\t}\n\t\t}\n\t}\n\n\t// threadOnly - takes annotation indicating which thread will be generated\n\tpublic createCommentStructure (menuStructure: any, threadOnly: any): void {\n\t\tif (app.map._docLayer._docType === 'text') {\n\t\t\tthis.createCommentStructureWriter(menuStructure, threadOnly);\n\t\t}\n\t\telse if (app.map._docLayer._docType === 'presentation' || app.map._docLayer._docType === 'drawing') {\n\t\t\tthis.createCommentStructureImpress(menuStructure, threadOnly);\n\t\t}\n\t\telse if (app.map._docLayer._docType === 'spreadsheet') {\n\t\t\tthis.createCommentStructureCalc(menuStructure, threadOnly);\n\t\t}\n\t}\n\n\tpublic isMobileCommentActive (): boolean {\n\t\tconst newComment = document.getElementById(this.mobileCommentId);\n\t\tif (!newComment)\n\t\t\treturn false;\n\t\treturn newComment.style.display !== 'none'\n\t}\n\n\tpublic getMobileCommentModalId (): string {\n\t\treturn this.mobileCommentModalId;\n\t}\n\n\tpublic newAnnotationMobile (comment: any, addCommentFn: any, isMod: any): void {\n\t\tvar commentData = comment.sectionProperties.data;\n\n\t\tvar callback = function(div: HTMLDivElement) {\n\t\t\tif (div.textContent || div.innerHTML) {\n\t\t\t\tvar annotation = comment;\n\n\t\t\t\tannotation.sectionProperties.data.text = div.textContent;\n\t\t\t\tannotation.sectionProperties.data.html = div.innerHTML;\n\t\t\t\tcomment.text = div.textContent;\n\n\t\t\t\taddCommentFn.call(annotation, annotation, comment);\n\t\t\t\tif (!isMod)\n\t\t\t\t\tthis.containerObject.removeSection(annotation);\n\t\t\t}\n\t\t\telse {\n\t\t\t\tthis.cancel(comment);\n\t\t\t}\n\t\t}.bind(this);\n\n\t\tlet listId = 'mentionPopupList';\n\t\tif (this.map.mention)\n\t\t\tlistId = this.map.mention.getPopupId() + 'List';\n\t\tvar json = this.map.uiManager._modalDialogJSON(this.mobileCommentId, '', true, [\n\t\t\t{\n\t\t\t\tid: 'input-modal-input',\n\t\t\t\ttype: 'multilineedit',\n\t\t\t\ttext: (commentData.text && isMod ? commentData.text: ''),\n\t\t\t\thtml: (commentData.html && isMod ? commentData.html: ''),\n\t\t\t\tcontenteditable: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tid: listId,\n\t\t\t\ttype: 'treelistbox',\n\t\t\t\ttext: '',\n\t\t\t\tenabled: true,\n\t\t\t\tsingleclickactivate: false,\n\t\t\t\tfireKeyEvents: true,\n\t\t\t\thideIfEmpty: true,\n\t\t\t\tentries: [] as Array<TreeEntryJSON>,\n\t\t\t},\n\t\t\t{\n\t\t\t\tid: '',\n\t\t\t\ttype: 'buttonbox',\n\t\t\t\ttext: '',\n\t\t\t\tenabled: true,\n\t\t\t\tchildren: [\n\t\t\t\t\t{\n\t\t\t\t\t\tid: 'response-cancel',\n\t\t\t\t\t\ttype: 'pushbutton',\n\t\t\t\t\t\ttext: _('Cancel'),\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tid: 'response-ok',\n\t\t\t\t\t\ttype: 'pushbutton',\n\t\t\t\t\t\ttext: _('Save'),\n\t\t\t\t\t\t'has_default': true,\n\t\t\t\t\t}\n\t\t\t\t],\n\t\t\t\tvertical: false,\n\t\t\t\tlayoutstyle: 'end'\n\t\t\t},\n\t\t]);\n\n\t\tvar cancelFunction = function() {\n\t\t\tthis.cancel(comment);\n\t\t\tthis.map.uiManager.closeModal(this.mobileCommentModalId);\n\t\t}.bind(this);\n\n\t\tconst mentionListCallback = function(objectType: any, eventType: any, object: any, index: number) {\n\t\t\t\tconst mention = this.map.mention;\n\t\t\t\tif (eventType === 'close')\n\t\t\t\t\tmention.closeMentionPopup(false);\n\t\t\t\telse if (eventType === 'select' || eventType === 'activate') {\n\t\t\t\t\tconst item = mention.getMentionUserData(index);\n\t\t\t\t\tconst replacement = '@' + mention.getPartialMention();\n\t\t\t\t\tconst uid = item.label ?? item.username\n\t\t\t\t\tif (uid !== '' && item.profile !== '')\n\t\t\t\t\t\tcomment.autoCompleteMention(uid, item.profile, replacement)\n\t\t\t\t\tmention.closeMentionPopup(false);\n\t\t\t\t}\n\t\t}.bind(this);\n\n\t\tthis.map.uiManager.showModal(json, [\n\t\t\t{id: 'response-ok', func: function() {\n\t\t\t\tif (typeof callback === 'function') {\n\t\t\t\t\tvar input = document.getElementById('input-modal-input') as HTMLDivElement;\n\t\t\t\t\tcallback(input);\n\t\t\t\t}\n\t\t\t\tthis.map.uiManager.closeModal(this.mobileCommentModalId);\n\t\t\t}.bind(this)},\n\t\t\t{id: 'response-cancel', func: cancelFunction},\n\t\t\t{id: '__POPOVER__', func: cancelFunction},\n\t\t\t{id: '__DIALOG__', func: cancelFunction},\n\t\t\t{id: listId, func: mentionListCallback}\n\t\t]);\n\n\t\tapp.layoutingService.appendLayoutingTask(() => {\n\t\t\tconst multilineEditDiv = document.getElementById('input-modal-input');\n\t\t\tmultilineEditDiv.addEventListener('input', function(ev: any){\n\t\t\t\tif (ev && app.map._docLayer._docType === 'text') {\n\t\t\t\t\t// special handling for mentions\n\t\t\t\t\tthis.map?.mention.handleMentionInput(ev, comment.isNewPara());\n\t\t\t\t}\n\t\t\t}.bind(this));\n\n\t\t\tconst tagTd = 'td',\n\t\t\tempty = '',\n\t\t\ttagDiv = 'div';\n\t\t\tconst author = L.DomUtil.create('table', 'cool-annotation-table');\n\t\t\tconst tbody = L.DomUtil.create('tbody', empty, author);\n\t\t\tconst tr = L.DomUtil.create('tr', empty, tbody);\n\t\t\tconst tdImg = L.DomUtil.create(tagTd, 'cool-annotation-img', tr);\n\t\t\tconst tdAuthor = L.DomUtil.create(tagTd, 'cool-annotation-author', tr);\n\t\t\tconst imgAuthor = L.DomUtil.create('img', 'avatar-img', tdImg);\n\t\t\tconst user = this.map.getViewId(commentData.author);\n\t\t\tapp.LOUtil.setUserImage(imgAuthor, this.map, user);\n\t\t\timgAuthor.setAttribute('width', 32);\n\t\t\timgAuthor.setAttribute('height', 32);\n\t\t\tconst authorAvatarImg = imgAuthor;\n\t\t\tconst contentAuthor = L.DomUtil.create(tagDiv, 'cool-annotation-content-author', tdAuthor);\n\t\t\tconst contentDate = L.DomUtil.create(tagDiv, 'cool-annotation-date', tdAuthor);\n\n\t\t\t$(contentAuthor).text(commentData.author);\n\t\t\t$(authorAvatarImg).attr('src', commentData.avatar);\n\t\t\tif (user >= 0) {\n\t\t\t\tconst color = app.LOUtil.rgbToHex(this.map.getViewColor(user));\n\t\t\t\t$(authorAvatarImg).css('border-color', color);\n\t\t\t}\n\n\t\t\tif (commentData.dateTime) {\n\t\t\t\tconst d = new Date(commentData.dateTime.replace(/,.*/, 'Z'));\n\t\t\t\tconst dateOptions = { weekday: 'short', year: 'numeric', month: 'short', day: 'numeric' };\n\t\t\t\t$(contentDate).text(isNaN(d.getTime()) ? comment.dateTime: d.toLocaleDateString((<any>String).locale, <any>dateOptions));\n\t\t\t}\n\n\t\t\tconst newAnnotationDialog = document.getElementById(this.mobileCommentId);\n\t\t\t$(newAnnotationDialog).css('width', '100%');\n\t\t\tconst dialogInput = newAnnotationDialog.children[0];\n\t\t\t$(dialogInput).css('height', '30vh');\n\t\t\tconst parent = newAnnotationDialog.parentElement;\n\t\t\tparent.insertBefore(author, parent.childNodes[0]);\n\t\t\tdocument.getElementById('input-modal-input').focus();\n\t\t});\n\t}\n\n\tpublic highlightComment (comment: any): void {\n\t\tthis.removeHighlighters();\n\n\t\tvar commentList = this.sectionProperties.commentList;\n\n\t\tvar lastChild: any = this.getLastChildIndexOf(comment.sectionProperties.data.id);\n\n\t\twhile (true && lastChild >= 0) {\n\t\t\tcommentList[lastChild].highlight();\n\n\t\t\tif (commentList[lastChild].isRootComment())\n\t\t\t\tbreak;\n\n\t\t\tlastChild = this.getIndexOf(commentList[lastChild].sectionProperties.data.parent);\n\t\t}\n\t}\n\n\tpublic removeHighlighters (): void {\n\t\tvar commentList = this.sectionProperties.commentList;\n\t\tfor (var i: number = 0; i < commentList.length; i++) {\n\t\t\tif (commentList[i].sectionProperties.isHighlighted) {\n\t\t\t\tcommentList[i].removeHighlight();\n\t\t\t}\n\t\t}\n\t}\n\n\tpublic removeItem (id: any): void {\n\t\tvar annotation;\n\t\tfor (var i = 0; i < this.sectionProperties.commentList.length; i++) {\n\t\t\tannotation = this.sectionProperties.commentList[i];\n\t\t\tif (annotation.sectionProperties.data.id === id) {\n\t\t\t\tthis.containerObject.removeSection(annotation.name);\n\t\t\t\tthis.sectionProperties.commentList.splice(i, 1);\n\t\t\t\tthis.updateIdIndexMap();\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\tthis.checkSize();\n\t}\n\n\tpublic click (annotation: any): void {\n\t\tthis.select(annotation);\n\t}\n\n\tpublic save (annotation: any): void {\n\t\tvar comment;\n\t\tif (annotation.sectionProperties.data.id === 'new') {\n\t\t\tcomment = {\n\t\t\t\tAuthor: {\n\t\t\t\t\ttype: 'string',\n\t\t\t\t\tvalue: annotation.sectionProperties.data.author\n\t\t\t\t},\n\t\t\t\t// send if html exists, and it's writer send just html, otherwise text\n\t\t\t\t... (app.map._docLayer._docType === 'text' &&\n\t\t\t\t     annotation.sectionProperties.data.html) ?\n\t\t\t\t\t{ Html: {\n\t\t\t\t\t\ttype: 'string',\n\t\t\t\t\t\tvalue: annotation.sectionProperties.data.html\n\t\t\t\t\t} } :\n\t\t\t\t\t{ Text: {\n\t\t\t\t\t\ttype: 'string',\n\t\t\t\t\t\tvalue: annotation.sectionProperties.data.text\n\t\t\t\t\t} }\n\t\t\t};\n\t\t\tif (app.file.fileBasedView) {\n\t\t\t\tthis.map.setPart(app.map._docLayer._selectedPart, false);\n\t\t\t\tthis.map.sendUnoCommand('.uno:InsertAnnotation', comment, true /* force */);\n\t\t\t\tthis.map.setPart(0, false);\n\t\t\t}\n\t\t\telse {\n\t\t\t\tthis.map.sendUnoCommand('.uno:InsertAnnotation', comment, true /* force */);\n\t\t\t}\n\n\t\t\t// Object is later removed in onACKComment when newly inserted comment object is available\n\t\t\t// It's to reduce the flicker when using comment autosave\n\t\t\tif (!CommentSection.autoSavedComment)\n\t\t\t\tthis.removeItem(annotation.sectionProperties.data.id);\n\t\t} else if (annotation.sectionProperties.data.trackchange) {\n\t\t\tcomment = {\n\t\t\t\tChangeTrackingId: {\n\t\t\t\t\ttype: 'long',\n\t\t\t\t\tvalue: annotation.sectionProperties.data.index\n\t\t\t\t},\n\t\t\t\tText: {\n\t\t\t\t\ttype: 'string',\n\t\t\t\t\tvalue: annotation.sectionProperties.data.text\n\t\t\t\t}\n\t\t\t};\n\t\t\tthis.map.sendUnoCommand('.uno:CommentChangeTracking', comment, true /* force */);\n\t\t} else {\n\t\t\tcomment = {\n\t\t\t\tId: {\n\t\t\t\t\ttype: 'string',\n\t\t\t\t\tvalue: annotation.sectionProperties.data.id\n\t\t\t\t},\n\t\t\t\tAuthor: {\n\t\t\t\t\ttype: 'string',\n\t\t\t\t\tvalue: annotation.sectionProperties.data.author\n\t\t\t\t},\n\t\t\t\t// send if html exists, and it's writer send just html, otherwise text\n\t\t\t\t... (app.map._docLayer._docType === 'text' &&\n\t\t\t\t     annotation.sectionProperties.data.html) ?\n\t\t\t\t\t{ Html: {\n\t\t\t\t\t\ttype: 'string',\n\t\t\t\t\t\tvalue: annotation.sectionProperties.data.html\n\t\t\t\t\t} } :\n\t\t\t\t\t{ Text: {\n\t\t\t\t\t\ttype: 'string',\n\t\t\t\t\t\tvalue: annotation.sectionProperties.data.text\n\t\t\t\t\t} }\n\t\t\t};\n\t\t\tthis.map.sendUnoCommand('.uno:EditAnnotation', comment, true /* force */);\n\t\t}\n\t\tthis.unselect();\n\t\tthis.map.focus();\n\t}\n\n\tpublic reply (annotation: any): void {\n\t\tif (cool.Comment.isAnyEdit()) {\n\t\t\tcool.CommentSection.showCommentEditingWarning();\n\t\t\treturn;\n\t\t}\n\t\tif ((<any>window).mode.isMobile()) {\n\t\t\tvar avatar = undefined;\n\t\t\tvar author = this.map.getViewName(app.map._docLayer._viewId);\n\t\t\tif (author in this.map._viewInfoByUserName) {\n\t\t\t\tavatar = this.map._viewInfoByUserName[author].userextrainfo.avatar;\n\t\t\t}\n\n\t\t\tif (app.map._docLayer._docType === 'presentation' || app.map._docLayer._docType === 'drawing') {\n\t\t\t\tthis.newAnnotationMobile(annotation, annotation.onReplyClick, /* isMod */ false);\n\t\t\t}\n\t\t\telse {\n\t\t\t\tvar replyAnnotation = {\n\t\t\t\t\ttext: '',\n\t\t\t\t\ttextrange: '',\n\t\t\t\t\tauthor: author,\n\t\t\t\t\tdateTime: new Date().toDateString(),\n\t\t\t\t\tid: annotation.sectionProperties.data.id,\n\t\t\t\t\tavatar: avatar,\n\t\t\t\t\tparent: annotation.sectionProperties.data.parent,\n\t\t\t\t\tanchorPos: [annotation.sectionProperties.data.anchorPos[0], annotation.sectionProperties.data.anchorPos[1]],\n\t\t\t\t};\n\n\t\t\t\tvar replyAnnotationSection = new cool.Comment(replyAnnotation, replyAnnotation.id === 'new' ? {noMenu: true} : {}, this);\n\t\t\t\treplyAnnotationSection.name += '-reply';\n\n\t\t\t\tthis.newAnnotationMobile(replyAnnotationSection, annotation.onReplyClick, /* isMod */ false);\n\t\t\t}\n\t\t}\n\t\telse {\n\t\t\tannotation.reply();\n\t\t\tthis.select(annotation, true);\n\t\t\tannotation.focus();\n\t\t}\n\t}\n\n\tpublic modify (annotation: any): void {\n\t\tif (cool.Comment.isAnyEdit()) {\n\t\t\tcool.CommentSection.showCommentEditingWarning();\n\t\t\treturn;\n\t\t}\n\t\tif ((<any>window).mode.isMobile()) {\n\t\t\tthis.newAnnotationMobile(annotation, function(annotation: any) {\n\t\t\t\tthis.save(annotation);\n\t\t\t}.bind(this), /* isMod */ true);\n\t\t}\n\t\telse {\n\t\t\t// Make sure that comment is not transitioning and comment menu is not open.\n\t\t\tvar tempFunction = function() {\n\t\t\t\tsetTimeout(function() {\n\t\t\t\t\tif (annotation.sectionProperties.container && annotation.sectionProperties.contextMenu === true\n\t\t\t\t\t) {\n\t\t\t\t\t\ttempFunction();\n\t\t\t\t\t}\n\t\t\t\t\telse {\n\t\t\t\t\t\tannotation.edit();\n\t\t\t\t\t\tthis.select(annotation, true);\n\t\t\t\t\t\tannotation.focus();\n\t\t\t\t\t}\n\t\t\t\t}.bind(this), 1);\n\t\t\t}.bind(this);\n\t\t\ttempFunction();\n\t\t}\n\t}\n\n\tprivate showCollapsedReplies(rootIndex: number) {\n\t\tif (!this.sectionProperties.commentList.length)\n\t\t\treturn;\n\t\tvar lastIndex = this.getLastChildIndexOf(this.sectionProperties.commentList[rootIndex].sectionProperties.data.id);\n\t\tvar rootComment = this.sectionProperties.commentList[rootIndex];\n\n\t\twhile (rootIndex <= lastIndex) {\n\t\t\tthis.sectionProperties.commentList[rootIndex].sectionProperties.container.style.display = '';\n\t\t\tthis.sectionProperties.commentList[rootIndex].sectionProperties.container.style.visibility = '';\n\t\t\t$(this.sectionProperties.commentList[rootIndex].sectionProperties.container).removeClass('collapsed-comment');\n\t\t\trootIndex++;\n\t\t}\n\t\trootComment.updateThreadInfoIndicator();\n\t}\n\n\tprivate collapseReplies(rootIndex: number, rootId: number) {\n\t\tvar lastChild = this.getLastChildIndexOf(rootId);\n\n\t\t$(this.sectionProperties.commentList[rootIndex].sectionProperties.container).addClass('collapsed-comment');\n\t\tfor (var i = lastChild; i > rootIndex; i--) {\n\t\t\tthis.sectionProperties.commentList[i].sectionProperties.container.style.display = 'none';\n\t\t\t$(this.sectionProperties.commentList[i].sectionProperties.container).addClass('collapsed-comment');\n\t\t}\n\t\tthis.sectionProperties.commentList[i].updateThreadInfoIndicator();\n\t}\n\n\tprivate cssToCorePixels(cssPixels: number) {\n\t\treturn cssPixels * app.dpiScale;\n\t}\n\n\tpublic select (annotation: Comment, force: boolean = false): void {\n\t\tif (force\n\t\t\t|| (annotation && !annotation.pendingInit && annotation !== this.sectionProperties.selectedComment\n\t\t\t&& (annotation.sectionProperties.data.resolved !== 'true' || this.sectionProperties.showResolved)\n\t\t\t)) {\n\t\t\t// Select the root comment\n\t\t\tvar idx = this.getRootIndexOf(annotation.sectionProperties.data.id);\n\n\t\t\t// no need to reselect comment, it will cause to scroll to root comment unnecessarily\n\t\t\tif (this.sectionProperties.selectedComment === this.sectionProperties.commentList[idx]) {\n\t\t\t\tthis.update();\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Unselect first if there anything selected\n\t\t\tif (this.sectionProperties.selectedComment)\n\t\t\t\tthis.unselect();\n\n\t\t\tthis.sectionProperties.selectedComment = this.sectionProperties.commentList[idx];\n\n\t\t\tif (this.sectionProperties.selectedComment && !$(this.sectionProperties.selectedComment.sectionProperties.container).hasClass('annotation-active')) {\n\t\t\t\t$(this.sectionProperties.selectedComment.sectionProperties.container).addClass('annotation-active');\n\t\t\t}\n\n\t\t\tif (app.map._docLayer._docType === 'text' && this.sectionProperties.showSelectedBigger) {\n\t\t\t\tthis.setThreadPopup(this.sectionProperties.selectedComment, true);\n\t\t\t}\n\n\t\t\tthis.scrollCommentIntoView(annotation);\n\n\t\t\tconst selectedComment = this.sectionProperties.selectedComment;\n\t\t\tif (this.isCollapsed) {\n\t\t\t\tthis.showCollapsedReplies(idx);\n\t\t\t\tselectedComment.updateThreadInfoIndicator();\n\t\t\t}\n\n\t\t\tthis.update();\n\t\t}\n\t}\n\n\tprivate scrollCommentIntoView (comment: Comment) {\n\t\tif (CommentSection.importingComments)\n\t\t\treturn;\n\n\t\tconst docType = app.map._docLayer._docType;\n\t\tlet anchorPosition: Array<number> = null;\n\t\tconst rootComment = this.sectionProperties.commentList[this.getRootIndexOf(comment.sectionProperties.data.id)];\n\n\t\tswitch (docType) {\n\t\t\tcase 'text':\n\t\t\t{\n\t\t\t\tanchorPosition = this.numberArrayToCorePixFromTwips(\n\t\t\t\t\trootComment.sectionProperties.data.anchorPos, 0, 2);\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tcase 'spreadsheet':\n\t\t\t{\n\t\t\t\t// in calc comments are not visible on canvas, anchor vertical position is always 1\n\t\t\t\t// position is already in core pixels\n\t\t\t\tanchorPosition = rootComment.getPosition();\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tdefault:\n\t\t\t\tbreak;\n\t\t}\n\n\t\tif (anchorPosition && anchorPosition[1] > 0) {\n\t\t\tlet annotationTop = anchorPosition[1];\n\t\t\tconst firstIdx = this.getIndexOf(rootComment.sectionProperties.data.id);\n\t\t\tconst lastIdx = this.getIndexOf(comment.sectionProperties.data.id);\n\t\t\tfor (let i = firstIdx; i < lastIdx; i++) {\n\t\t\t\tannotationTop += this.cssToCorePixels(this.sectionProperties.commentList[i].getCommentHeight());\n\t\t\t}\n\t\t\tconst annotationBottom = annotationTop + this.cssToCorePixels(comment.getCommentHeight());\n\n\t\t\tif (!this.isInViewPort([annotationTop, annotationBottom])) {\n\t\t\t\tconst scrollSection = app.sectionContainer.getSectionWithName(L.CSections.Scroll.name);\n\t\t\t\tconst screenTopBottom = this.getScreenTopBottom();\n\n\t\t\t\tif (annotationTop < screenTopBottom[0]) {\n\t\t\t\t\tscrollSection.scrollVerticalWithOffset(annotationTop - screenTopBottom[0]);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t\tscrollSection.scrollVerticalWithOffset(annotationBottom - screenTopBottom[1]);\n\n\t\t\t\tif (docType === 'spreadsheet' && rootComment) {\n\t\t\t\t\trootComment.positionCalcComment();\n\t\t\t\t\trootComment.focus();\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\t/// returns canvas top and bottom position in core pixels\n\tpublic getScreenTopBottom(): Array<number> {\n\t\tconst scrollSection = app.sectionContainer.getSectionWithName(L.CSections.Scroll.name);\n\t\tconst screenTop = scrollSection.containerObject.getDocumentTopLeft()[1];\n\t\tconst screenBottom = screenTop + this.cssToCorePixels($('#map').height());\n\n\t\treturn [screenTop, screenBottom];\n\t}\n\n\t/// checks if vertical top and bottom point (in core pixels) is shown on the screen currently\n\tprivate isInViewPort(positionTopBotton: Array<number>): boolean {\n\t\tconst screenTopBottom = this.getScreenTopBottom();\n\t\tconst top = positionTopBotton[0];\n\t\tconst bottom = positionTopBotton[1];\n\n\t\treturn (\n\t\t\tscreenTopBottom[0] <= top &&\n\t\t\tscreenTopBottom[1] >= bottom\n\t\t);\n\t}\n\n\tpublic unselect (): void {\n\t\tif (this.sectionProperties.selectedComment && this.sectionProperties.selectedComment.sectionProperties.data.id != 'new') {\n\t\t\tif (this.sectionProperties.selectedComment && $(this.sectionProperties.selectedComment.sectionProperties.container).hasClass('annotation-active'))\n\t\t\t\t$(this.sectionProperties.selectedComment.sectionProperties.container).removeClass('annotation-active');\n\n\t\t\tif (app.map._docLayer._docType === 'spreadsheet')\n\t\t\t\tthis.sectionProperties.selectedComment.hide();\n\n\t\t\tif (this.sectionProperties.commentsAreListed && this.isCollapsed) {\n\t\t\t\tthis.sectionProperties.selectedComment.setCollapsed();\n\t\t\t\tthis.collapseReplies(this.getRootIndexOf(this.sectionProperties.selectedComment.sectionProperties.data.id), this.sectionProperties.selectedComment.sectionProperties.data.id);\n\t\t\t}\n\t\t\tif (app.map._docLayer._docType === 'text' && this.sectionProperties.showSelectedBigger) {\n\t\t\t\tthis.setThreadPopup(this.sectionProperties.selectedComment, false);\n\t\t\t\tthis.sectionProperties.showSelectedBigger = false;\n\t\t\t}\n\t\t\tthis.sectionProperties.selectedComment = null;\n\n\t\t\tthis.update();\n\t\t}\n\t}\n\n\tprivate setThreadPopup (comment: Comment, popup: boolean) {\n\t\tif (popup && !$(comment.sectionProperties.container).hasClass('annotation-pop-up'))\n\t\t\t$(comment.sectionProperties.container).addClass('annotation-pop-up');\n\t\telse if (!popup && $(comment.sectionProperties.container).hasClass('annotation-pop-up'))\n\t\t\t$(comment.sectionProperties.container).removeClass('annotation-pop-up');\n\n\t\tfor (const childComment of comment.sectionProperties.children) {\n\t\t\tthis.setThreadPopup(childComment, popup);\n\t\t}\n\t}\n\n\tpublic toggleShowBigger (comment: Comment) {\n\t\tconst rootComment = this.sectionProperties.commentList[this.getRootIndexOf(comment.sectionProperties.data.id)];\n\t\tconst isSelected = this.sectionProperties.selectedComment === rootComment;\n\t\tif (this.sectionProperties.showSelectedBigger && isSelected) {\n\t\t\tthis.sectionProperties.showSelectedBigger = false;\n\t\t\tthis.setThreadPopup(this.sectionProperties.selectedComment, false);\n\t\t}\n\t\telse if (!isSelected) {\n\t\t\tif (this.sectionProperties.selectedComment)\n\t\t\t\tthis.unselect();\n\t\t\tthis.sectionProperties.showSelectedBigger = true;\n\t\t\tthis.select(comment);\n\t\t}\n\t\telse {\n\t\t\tthis.sectionProperties.showSelectedBigger = true;\n\t\t\tthis.setThreadPopup(rootComment, true);\n\t\t\tthis.scrollCommentIntoView(comment);\n\t\t}\n\t\tthis.update();\n\t}\n\n\tpublic saveReply (annotation: any): void {\n\t\tvar comment = {\n\t\t\tId: {\n\t\t\t\ttype: 'string',\n\t\t\t\tvalue: annotation.sectionProperties.data.id\n\t\t\t},\n\t\t\t// send if html exists, and it's writer send just html, otherwise text\n\t\t\t... (app.map._docLayer._docType === 'text' &&\n\t\t\t     annotation.sectionProperties.data.html) ?\n\t\t\t\t{ Html: {\n\t\t\t\t\ttype: 'string',\n\t\t\t\t\tvalue: annotation.sectionProperties.data.html\n\t\t\t\t} } :\n\t\t\t\t{ Text: {\n\t\t\t\t\ttype: 'string',\n\t\t\t\t\tvalue: annotation.sectionProperties.data.reply\n\t\t\t\t} }\n\t\t};\n\n\t\tif (app.map._docLayer._docType === 'text' || app.map._docLayer._docType === 'spreadsheet')\n\t\t\tthis.map.sendUnoCommand('.uno:ReplyComment', comment);\n\t\telse if (app.map._docLayer._docType === 'presentation')\n\t\t\tthis.map.sendUnoCommand('.uno:ReplyToAnnotation', comment);\n\n\t\tthis.unselect();\n\t\tthis.map.focus();\n\t}\n\n\tpublic cancel (annotation: any): void {\n\t\tif (annotation.sectionProperties.data.id === 'new') {\n\t\t\tthis.removeItem(annotation.sectionProperties.data.id);\n\t\t}\n\t\tif (this.sectionProperties.selectedComment === annotation) {\n\t\t\tthis.unselect();\n\t\t} else {\n\t\t\tthis.update();\n\t\t}\n\t\tthis.map.focus();\n\t}\n\n\tpublic onRedlineAccept (e: any): void {\n\t\tvar command = {\n\t\t\tAcceptTrackedChange: {\n\t\t\t\ttype: 'unsigned short',\n\t\t\t\tvalue: e.id.substring('change-'.length)\n\t\t\t}\n\t\t};\n\t\tthis.map.sendUnoCommand('.uno:AcceptTrackedChange', command);\n\t\tthis.unselect();\n\t\tthis.map.focus();\n\t}\n\n\tpublic onRedlineReject (e: any): void {\n\t\tvar command = {\n\t\t\tRejectTrackedChange: {\n\t\t\t\ttype: 'unsigned short',\n\t\t\t\tvalue: e.id.substring('change-'.length)\n\t\t\t}\n\t\t};\n\t\tthis.map.sendUnoCommand('.uno:RejectTrackedChange', command);\n\t\tthis.unselect();\n\t\tthis.map.focus();\n\t}\n\n\tpublic remove (id: any): void {\n\t\tvar comment = {\n\t\t\tId: {\n\t\t\t\ttype: 'string',\n\t\t\t\tvalue: id\n\t\t\t}\n\t\t};\n\n\t\tvar removedComment = this.getComment(id);\n\t\tremovedComment.sectionProperties.selfRemoved = true;\n\t\tif (app.file.fileBasedView) // We have to set the part from which the comment will be removed as selected part before the process.\n\t\t\tthis.map.setPart(app.map._docLayer._selectedPart, false);\n\n\t\tif (app.map._docLayer._docType === 'text')\n\t\t\tthis.map.sendUnoCommand('.uno:DeleteComment', comment);\n\t\telse if (app.map._docLayer._docType === 'presentation' || app.map._docLayer._docType === 'drawing')\n\t\t\tthis.map.sendUnoCommand('.uno:DeleteAnnotation', comment);\n\t\telse if (app.map._docLayer._docType === 'spreadsheet')\n\t\t\tthis.map.sendUnoCommand('.uno:DeleteNote', comment);\n\n\t\tif (app.file.fileBasedView)\n\t\t\tthis.map.setPart(0, false);\n\n\t\tthis.unselect();\n\t\tthis.map.focus();\n\t}\n\n\tpublic removeThread (id: any): void {\n\t\tvar comment = {\n\t\t\tId: {\n\t\t\t\ttype: 'string',\n\t\t\t\tvalue: id\n\t\t\t}\n\t\t};\n\t\tthis.map.sendUnoCommand('.uno:DeleteCommentThread', comment);\n\t\tthis.unselect();\n\t\tthis.map.focus();\n\t}\n\n\tpublic resolve (annotation: any): void {\n\t\tvar comment = {\n\t\t\tId: {\n\t\t\t\ttype: 'string',\n\t\t\t\tvalue: annotation.sectionProperties.data.id\n\t\t\t}\n\t\t};\n\t\tthis.map.sendUnoCommand('.uno:ResolveComment', comment);\n\t}\n\n\tpublic resolveThread (annotation: any): void {\n\t\tvar comment = {\n\t\t\tId: {\n\t\t\t\ttype: 'string',\n\t\t\t\tvalue: annotation.sectionProperties.data.id\n\t\t\t}\n\t\t};\n\t\tthis.map.sendUnoCommand('.uno:ResolveCommentThread', comment);\n\t}\n\n\tpublic promote(annotation: any): void {\n\t\tvar comment = {\n\t\t\tId: {\n\t\t\t\ttype: 'string',\n\t\t\t\tvalue: annotation.sectionProperties.data.id\n\t\t\t}\n\t\t};\n\t\tthis.map.sendUnoCommand('.uno:PromoteComment', comment);\n\t}\n\n\tpublic getIndexOf (id: any): number {\n\t\tconst index = this.idIndexMap.get(id);\n\t\treturn (index === undefined) ? -1 : index;\n\t}\n\n\tpublic isThreadResolved (annotation: any): boolean {\n\t\t// If comment has children.\n\t\tif (annotation.sectionProperties.children.length > 0) {\n\t\t\tfor (var i = 0; i < annotation.sectionProperties.children.length; i++) {\n\t\t\t\tif (annotation.sectionProperties.children[i].sectionProperties.data.resolved !== 'true')\n\t\t\t\t\treturn false;\n\t\t\t}\n\t\t\treturn true;\n\t\t}\n\t\t// If it has a parent.\n\t\telse if (annotation.sectionProperties.data.parent !== '0') {\n\t\t\tvar index = this.getSubRootIndexOf(annotation.sectionProperties.data.parent);\n\t\t\tvar comment = this.sectionProperties.commentList[index];\n\t\t\tif (comment.sectionProperties.data.resolved !== 'true')\n\t\t\t\treturn false;\n\t\t\telse if (comment.sectionProperties.children.length > 0) {\n\t\t\t\tfor (var i = 0; i < comment.sectionProperties.children.length; i++) {\n\t\t\t\t\tif (comment.sectionProperties.children[i].sectionProperties.data.resolved !== 'true')\n\t\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate initializeContextMenus (): void {\n\t\tvar docLayer = app.map._docLayer;\n\t\tL.installContextMenu({\n\t\t\tselector: '.cool-annotation-menu',\n\t\t\ttrigger: 'none',\n\t\t\tzIndex: 1500,\n\t\t\tclassName: 'cool-font',\n\t\t\tbuild: function ($trigger: any) {\n\t\t\t\tconst blockChangeFromDifferentAuthor = this.map.isReadOnlyMode() && docLayer._docType === 'text' && this.map.getViewName(docLayer._viewId) !== $trigger[0].annotation.sectionProperties.data.author;\n\t\t\t\tconst isShownBig = this.sectionProperties.showSelectedBigger && this.sectionProperties.selectedComment === this.sectionProperties.commentList[this.getRootIndexOf($trigger[0].annotation.sectionProperties.data.id)];\n\t\t\t\treturn {\n\t\t\t\t\tautoHide: true,\n\t\t\t\t\titems: {\n\t\t\t\t\t\tmodify: blockChangeFromDifferentAuthor ? undefined : {\n\t\t\t\t\t\t\tname: _('Modify'),\n\t\t\t\t\t\t\tcallback: function (key: any, options: any) {\n\t\t\t\t\t\t\t\tthis.modify.call(this, options.$trigger[0].annotation);\n\t\t\t\t\t\t\t}.bind(this)\n\t\t\t\t\t\t},\n\t\t\t\t\t\treply: (docLayer._docType !== 'text' && docLayer._docType !== 'presentation') ? undefined : {\n\t\t\t\t\t\t\tname: _('Reply'),\n\t\t\t\t\t\t\tcallback: function (key: any, options: any) {\n\t\t\t\t\t\t\t\tthis.reply.call(this, options.$trigger[0].annotation);\n\t\t\t\t\t\t\t}.bind(this)\n\t\t\t\t\t\t},\n\t\t\t\t\t\tremove: blockChangeFromDifferentAuthor ? undefined : {\n\t\t\t\t\t\t\tname: _('Remove'),\n\t\t\t\t\t\t\tcallback: function (key: any, options: any) {\n\t\t\t\t\t\t\t\tthis.remove.call(this, options.$trigger[0].annotation.sectionProperties.data.id);\n\t\t\t\t\t\t\t}.bind(this)\n\t\t\t\t\t\t},\n\t\t\t\t\t\tremoveThread: docLayer._docType !== 'text' || !$trigger[0].annotation.isRootComment() || blockChangeFromDifferentAuthor ? undefined : {\n\t\t\t\t\t\t\tname: _('Remove Thread'),\n\t\t\t\t\t\t\tcallback: function (key: any, options: any) {\n\t\t\t\t\t\t\t\tthis.removeThread.call(this, options.$trigger[0].annotation.sectionProperties.data.id);\n\t\t\t\t\t\t\t}.bind(this)\n\t\t\t\t\t\t},\n\t\t\t\t\t\tresolve: docLayer._docType !== 'text' ? undefined : {\n\t\t\t\t\t\t\tname: $trigger[0].annotation.sectionProperties.data.resolved === 'false' ? _('Resolve') : _('Unresolve'),\n\t\t\t\t\t\t\tcallback: function (key: any, options: any) {\n\t\t\t\t\t\t\t\tthis.resolve.call(this, options.$trigger[0].annotation);\n\t\t\t\t\t\t\t}.bind(this)\n\t\t\t\t\t\t},\n\t\t\t\t\t\tresolveThread: docLayer._docType !== 'text' || !$trigger[0].annotation.isRootComment() ? undefined : {\n\t\t\t\t\t\t\tname: this.isThreadResolved($trigger[0].annotation) ? _('Unresolve Thread') : _('Resolve Thread'),\n\t\t\t\t\t\t\tcallback: function (key: any, options: any) {\n\t\t\t\t\t\t\t\tthis.resolveThread.call(this, options.$trigger[0].annotation);\n\t\t\t\t\t\t\t}.bind(this)\n\t\t\t\t\t\t},\n\t\t\t\t\t\tpromote: docLayer._docType !== 'text' || $trigger[0].annotation.isRootComment() || blockChangeFromDifferentAuthor ? undefined : {\n\t\t\t\t\t\t\tname: _('Promote to top comment'),\n\t\t\t\t\t\t\tcallback: function (key: any, options: any) {\n\t\t\t\t\t\t\t\tthis.promote.call(this, options.$trigger[0].annotation);\n\t\t\t\t\t\t\t}.bind(this)\n\t\t\t\t\t\t},\n\t\t\t\t\t\tshowBigger: docLayer._docType !== 'text' || (<any>window).mode.isMobile() ? undefined : {\n\t\t\t\t\t\t\tname: isShownBig ? _('Show on the side') : _('Open in full view'),\n\t\t\t\t\t\t\tcallback: function (key: any, options: any) {\n\t\t\t\t\t\t\t\tthis.toggleShowBigger.call(this, options.$trigger[0].annotation);\n\t\t\t\t\t\t\t}.bind(this)\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t};\n\t\t\t}.bind(this),\n\t\t\tevents: {\n\t\t\t\tshow: function (options: any) {\n\t\t\t\t\toptions.$trigger[0].annotation.sectionProperties.contextMenu = true;\n\t\t\t\t\tsetTimeout(function() {\n\t\t\t\t\t\toptions.items.modify.$node[0].tabIndex = 0;\n\t\t\t\t\t\toptions.items.modify.$node[0].focus();\n\t\t\t\t\t}.bind(this), 10);\n\t\t\t\t},\n\t\t\t\thide: function (options: any) {\n\t\t\t\t\toptions.$trigger[0].annotation.sectionProperties.contextMenu = false;\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t\tL.installContextMenu({\n\t\t\tselector: '.cool-annotation-menu-redline',\n\t\t\ttrigger: 'none',\n\t\t\tzIndex: 1500,\n\t\t\tclassName: 'cool-font',\n\t\t\titems: {\n\t\t\t\tmodify: {\n\t\t\t\t\tname: _('Comment'),\n\t\t\t\t\tcallback: function (key: any, options: any) {\n\t\t\t\t\t\tthis.modify.call(this, options.$trigger[0].annotation);\n\t\t\t\t\t}.bind(this)\n\t\t\t\t}\n\t\t\t},\n\t\t\tevents: {\n\t\t\t\tshow: function (options: any) {\n\t\t\t\t\toptions.$trigger[0].annotation.sectionProperties.contextMenu = true;\n\t\t\t\t},\n\t\t\t\thide: function (options: any) {\n\t\t\t\t\toptions.$trigger[0].annotation.sectionProperties.contextMenu = false;\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\n\tpublic onResize (): void {\n\t\tthis.checkCollapseState();\n\t\t// When window is resized, it may mean that comment wizard is closed. So we hide the highlights.\n\t\tthis.removeHighlighters();\n\t\tthis.update();\n\t}\n\n\tpublic onNewDocumentTopLeft (): void {\n\t\tif (app.map._docLayer._docType === 'spreadsheet') {\n\t\t\tif (this.sectionProperties.selectedComment)\n\t\t\t\tthis.sectionProperties.selectedComment.hide();\n\t\t}\n\n\t\tvar previousAnimationState = this.disableLayoutAnimation;\n\t\tthis.disableLayoutAnimation = true;\n\t\tthis.update(false);\n\t\tthis.disableLayoutAnimation = previousAnimationState;\n\t}\n\n\tprivate showHideComments (): void {\n\t\tfor (var i: number = 0; i < this.sectionProperties.commentList.length; i++) {\n\t\t\tthis.showHideComment(this.sectionProperties.commentList[i]);\n\t\t}\n\t}\n\n\tpublic showHideComment (annotation: any): void {\n\t\t// This manually shows/hides comments\n\t\tif (!this.sectionProperties.showResolved && app.map._docLayer._docType === 'text') {\n\t\t\tif (annotation.isContainerVisible() && annotation.sectionProperties.data.resolved === 'true') {\n\t\t\t\tif (this.sectionProperties.selectedComment == annotation) {\n\t\t\t\t\tthis.unselect();\n\t\t\t\t}\n\t\t\t\tannotation.hide();\n\t\t\t\tannotation.update();\n\t\t\t} else if (!annotation.isContainerVisible() && annotation.sectionProperties.data.resolved === 'false') {\n\t\t\t\tannotation.show();\n\t\t\t\tannotation.update();\n\t\t\t}\n\t\t\tthis.update();\n\t\t}\n\t\telse if (app.map._docLayer._docType === 'presentation' || app.map._docLayer._docType === 'drawing') {\n\t\t\tif (annotation.sectionProperties.partIndex === app.map._docLayer._selectedPart || app.file.fileBasedView) {\n\t\t\t\tif (!annotation.isContainerVisible()) {\n\t\t\t\t\tannotation.show();\n\t\t\t\t\tannotation.update();\n\t\t\t\t\tthis.update();\n\t\t\t\t}\n\t\t\t}\n\t\t\telse {\n\t\t\t\tannotation.hide();\n\t\t\t\tannotation.update();\n\t\t\t\tthis.update();\n\t\t\t}\n\t\t}\n\t}\n\n\tpublic add (comment: any): cool.Comment {\n\t\tif (!comment.sectionProperties) {\n\t\t\tconst temp = new cool.Comment(comment, comment.id === 'new' ? {noMenu: true} : {}, this);\n\t\t\ttemp.sectionProperties.data = comment;\n\t\t\tcomment = temp;\n\t\t}\n\n\t\tcomment.sectionProperties.noMenu  = comment.sectionProperties.data.id === 'new' ? true : false;\n\n\t\t/*\n\t\t\tRemove if a comment with the same id exists.\n\t\t\tWhen user deletes a parent and a child of that parent and undoes the operation respectively:\n\t\t\t\t* The first undo: Core side sends the deleted child - this is fine.\n\t\t\t\t* The second undo: Core side sends parent and child together - which is not fine. We already had the child with the first undo command.\n\t\t\tSo, delete if a comment already exists and trust core side about the ids of the comments.\n\t\t*/\n\t\tif (this.containerObject.doesSectionExist(comment.name))\n\t\t\tthis.removeItem(comment.name);\n\n\t\tthis.containerObject.addSection(comment);\n\t\tthis.sectionProperties.commentList.push(comment);\n\n\t\tthis.adjustParentAdd(comment);\n\t\tthis.orderCommentList(); // Also updates the index map.\n\t\tthis.checkSize();\n\n\t\tif (this.isCollapsed && comment.sectionProperties.data.id !== 'new')\n\t\t\tcomment.setCollapsed();\n\t\telse\n\t\tcomment.setExpanded();\n\n\t\t// check if we are the author\n\t\t// then select it so it does not get lost in a long list of comments and replies.\n\t\tconst authorName = this.map.getViewName(app.map._docLayer._viewId);\n\t\tconst newComment = comment.sectionProperties.data.id === 'new';\n\t\tif (!newComment && (authorName === comment.sectionProperties.data.author)) {\n\t\t\tthis.select(comment);\n\t\t}\n\n\t\treturn comment;\n\t}\n\n\tpublic adjustRedLine (redline: any): boolean {\n\t\t// All sane values ?\n\t\tif (!redline.textRange) {\n\t\t\tconsole.warn('Redline received has invalid textRange');\n\t\t\treturn false;\n\t\t}\n\n\t\t// transform change tracking index into an id\n\t\tredline.id = 'change-' + redline.index;\n\t\tredline.parent = '0'; // Redlines don't have parents, we need to specify this for consistency.\n\t\tredline.anchorPos = this.stringToRectangles(redline.textRange)[0];\n\t\tredline.anchorPix = this.numberArrayToCorePixFromTwips(redline.anchorPos, 0, 2);\n\t\tredline.trackchange = true;\n\t\tredline.text = redline.comment;\n\t\tvar rectangles = L.PolyUtil.rectanglesToPolygons(app.LOUtil.stringToRectangles(redline.textRange), app.map._docLayer);\n\t\tif (rectangles.length > 0) {\n\t\t\tredline.textSelected = L.polygon(rectangles, {\n\t\t\t\tpointerEvents: 'all',\n\t\t\t\tinteractive: false,\n\t\t\t\tfillOpacity: 0,\n\t\t\t\topacity: 0\n\t\t\t});\n\t\t\tredline.textSelected.addEventParent(this.map);\n\t\t\tredline.textSelected.on('click', function() {\n\t\t\t\tthis.selectById(redline.id);\n\t\t\t}, this);\n\t\t}\n\n\t\treturn true;\n\t}\n\n\tpublic getComment (id: any): any {\n\t\tconst index = this.getIndexOf(id);\n\t\treturn index == -1 ? null : this.sectionProperties.commentList[index];\n\t}\n\n\tprivate checkIfCommentHasPreAssignedChildren(comment: CommentSection) {\n\t\tfor (var i = 0; i < this.sectionProperties.commentList.length; i++) {\n\t\t\tvar possibleChild: Comment = this.sectionProperties.commentList[i];\n\t\t\tif (possibleChild.sectionProperties.possibleParentCommentId !== null) {\n\t\t\t\tif (possibleChild.sectionProperties.possibleParentCommentId === comment.sectionProperties.data.id) {\n\t\t\t\t\tif (!comment.sectionProperties.children.includes(possibleChild))\n\t\t\t\t\t\tcomment.sectionProperties.children.push(possibleChild);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\t// Adjust parent-child relationship, if required, after `comment` is added\n\tpublic adjustParentAdd (comment: any): void {\n\t\tif (comment.sectionProperties.data.parent === undefined)\n\t\t\tcomment.sectionProperties.data.parent = '0';\n\n\t\tif (comment.sectionProperties.data.parent !== '0') {\n\t\t\tvar parentIdx = this.getIndexOf(comment.sectionProperties.data.parent);\n\t\t\tif (parentIdx === -1) {\n\t\t\t\tconsole.warn('adjustParentAdd: No parent comment to attach received comment to. ' +\n\t\t\t\t\t'Parent comment ID sought is :' + comment.sectionProperties.data.parent + ' for current comment with ID : ' + comment.sectionProperties.data.id);\n\t\t\t\tcomment.sectionProperties.possibleParentCommentId = comment.sectionProperties.data.parent; // Save the proposed parentId so we can remember if such parent appears.\n\t\t\t\tcomment.setAsRootComment(); // Set this to default since there is no such parent at the moment.\n\t\t\t}\n\t\t\telse {\n\t\t\t\tvar parentComment = this.sectionProperties.commentList[parentIdx];\n\t\t\t\tif (parentComment && !parentComment.sectionProperties.children.includes(comment))\n\t\t\t\t\tparentComment.sectionProperties.children.unshift(comment);\n\t\t\t}\n\t\t}\n\n\t\t// Check if any of the child comments targets the newly added comment as parent.\n\t\tthis.checkIfCommentHasPreAssignedChildren(comment);\n\t}\n\n\t// Adjust parent-child relationship, if required, after `comment` is removed\n\tpublic adjustParentRemove (comment: any): void {\n\t\tvar parentIdx = this.getIndexOf(comment.getParentCommentId());\n\n\t\t// If a child comment is removed.\n\t\tvar parentComment = this.sectionProperties.commentList[parentIdx];\n\t\tif (parentComment) {\n\t\t\tvar index = parentComment.getIndexOfChild(comment);\n\t\t\tif (index >= 0)\n\t\t\t\tparentComment.removeChildByIndex(index); // Removed comment has a parent. Remove the comment also from its parent's list.\n\t\t}\n\n\t\t// If a parent comment is removed.\n\t\tfor (var i = 0; i < comment.getChildrenLength(); i++) { // Loop over removed comment's children.\n\t\t\tvar childComment = comment.getChildByIndex(i);\n\t\t\tif (childComment)\n\t\t\t\tchildComment.setAsRootComment(); // The children have no parent comment any more.\n\t\t}\n\t}\n\n\tpublic overWriteCommentChanges(obj: any, editComment: Comment) {\n\t\tthis.clearAutoSaveStatus();\n\t\teditComment.onCancelClick(null);\n\t\tthis.onACKComment(obj);\n\t}\n\n\tpublic handleCommentConflict(obj: any, editComment: Comment) {\n\t\tif (document.getElementById(this.map.uiManager.generateModalId('comments-update')))\n\t\t\treturn;\n\n\t\tif (obj.comment.action === 'Remove' || obj.comment.action === 'RedlinedDeletion') {\n\t\t\tJSDialog.showInfoModalWithOptions(\n\t\t\t\t'comments-update', {\n\t\t\t\t'title':_('Comments Updated'),\n\t\t\t\t'messages': [_('Another user has removed this comment.')],\n\t\t\t\t'buttons': [{'text': _('OK'),\n\t\t\t\t'callback': () => {\n\t\t\t\t\tthis.overWriteCommentChanges(obj, editComment);\n\t\t\t\t}}],\n\t\t\t\t'withCancel': false}\n\t\t\t);\n\t\t\treturn;\n\t\t}\n\n\t\tthis.map.uiManager.showYesNoButton(\n\t\t\t'comments-update',\n\t\t\t_('Comments Updated'),\n\t\t\t_('Another user has updated the comment. Would you like to overwrite those changes?'),\n\t\t\t_('Overwrite'),\n\t\t\t_('Update'),\n\t\t\tnull,\n\t\t\t() => {\n\t\t\t\tthis.overWriteCommentChanges(obj, editComment);\n\t\t\t}, false\n\t\t);\n\t}\n\n\tpublic checkIfOnlyAnchorPosChanged(obj: any, editComment: Comment): boolean {\n\t\tif (obj.comment.action !== 'Modify')\n\t\t\treturn false;\n\n\t\tvar newComment = obj.comment;\n\t\tvar editCommentData = editComment.sectionProperties.data;\n\n\t\tif (newComment.author !== editCommentData.author\n\t\t|| newComment.dateTime !== editCommentData.dateTime\n\t\t|| newComment.html !== editCommentData.html\n\t\t|| newComment.layoutStatus !== editCommentData.layoutStatus.toString()\n\t\t|| newComment.parentId !== editCommentData.parentId\n\t\t|| newComment.resolved !== editCommentData.resolved\n\t\t|| newComment.textRange !== editCommentData.textRange)\n\t\t\treturn false;\n\n\t\tif (newComment.anchorPos.replaceAll(\" \", '') !== editCommentData.anchorPos.toString())\n\t\t\treturn true;\n\t\treturn false;\n\t}\n\n\tprivate actionPerformedByCurrentUser(obj: any): boolean {\n\t\treturn obj.comment.author === this.map._viewInfo[this.map._docLayer._editorId].username;\n\t}\n\n\tpublic onACKComment (obj: any): void {\n\t\tvar id;\n\t\tconst anyEdit = Comment.isAnyEdit();\n\t\tif (anyEdit\n\t\t\t&& !this.checkIfOnlyAnchorPosChanged(obj, anyEdit)\n\t\t\t&& !anyEdit.sectionProperties.selfRemoved\n\t\t\t&& anyEdit.sectionProperties.data.id === obj.comment.id\n\t\t\t&& CommentSection.autoSavedComment !== anyEdit\n\t\t\t&& !this.actionPerformedByCurrentUser(obj)) {\n\t\t\tthis.handleCommentConflict(obj, anyEdit);\n\t\t\treturn;\n\t\t}\n\t\tvar changetrack = obj.redline ? true : false;\n\t\tvar dataroot = changetrack ? 'redline' : 'comment';\n\t\tif (changetrack) {\n\t\t\tobj.redline.id = 'change-' + obj.redline.index;\n\t\t}\n\t\tvar action = changetrack ? obj.redline.action : obj.comment.action;\n\n\t\tif (!changetrack && obj.comment.parent === undefined) {\n\t\t\tif (obj.comment.parentId)\n\t\t\t\tobj.comment.parent = String(obj.comment.parentId);\n\t\t\telse\n\t\t\t\tobj.comment.parent = '0';\n\t\t}\n\n\t\tif (changetrack && obj.redline.author in this.map._viewInfoByUserName) {\n\t\t\tobj.redline.avatar = this.map._viewInfoByUserName[obj.redline.author].userextrainfo.avatar;\n\t\t}\n\t\telse if (!changetrack && obj.comment.author in this.map._viewInfoByUserName) {\n\t\t\tobj.comment.avatar = this.map._viewInfoByUserName[obj.comment.author].userextrainfo.avatar;\n\t\t}\n\n\t\tif ((<any>window).mode.isMobile()) {\n\t\t\tvar annotation = this.sectionProperties.commentList[this.getRootIndexOf(obj[dataroot].id)];\n\t\t\tif (!annotation)\n\t\t\t\tannotation = this.sectionProperties.commentList[this.getRootIndexOf(obj[dataroot].parent)]; //this is required for reload after reply in writer\n\t\t}\n\t\tif (action === 'Add') {\n\t\t\tif (changetrack) {\n\t\t\t\tif (!this.adjustRedLine(obj.redline)) {\n\t\t\t\t\t// something wrong in this redline\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tthis.add(obj.redline);\n\t\t\t} else {\n\t\t\t\tconst currentComment = this.getComment(obj[dataroot].id);\n\t\t\t\tif (currentComment !== null) {\n\t\t\t\t\tif (obj[dataroot].layoutStatus !== undefined) {\n\t\t\t\t\t\tcurrentComment.sectionProperties.data.layoutStatus = parseInt(obj[dataroot].layoutStatus);\n\t\t\t\t\t\tcurrentComment.setLayoutClass();\n\t\t\t\t\t}\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tthis.adjustComment(obj.comment);\n\t\t\t\tannotation = this.add(obj.comment);\n\t\t\t\tif (app.map._docLayer._docType === 'spreadsheet')\n\t\t\t\t\tannotation.hide();\n\n\t\t\t\tvar autoSavedComment = CommentSection.autoSavedComment;\n\t\t\t\tif (autoSavedComment) {\n\t\t\t\t\tvar isOurComment = annotation.isAutoSaved();\n\t\t\t\t\tif (isOurComment) {\n\t\t\t\t\t\tif (app.definitions.CommentSection.needFocus) {\n\t\t\t\t\t\t\tapp.definitions.CommentSection.needFocus = annotation;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tannotation.sectionProperties.container.style.visibility = 'visible';\n\t\t\t\t\t\tannotation.sectionProperties.autoSave.innerText = _('Autosaved');\n\t\t\t\t\t\tif (app.map._docLayer._docType === 'spreadsheet')\n\t\t\t\t\t\t\tannotation.show();\n\t\t\t\t\t\tif (autoSavedComment.sectionProperties.data.id === 'new')\n\t\t\t\t\t\t\tthis.removeItem(autoSavedComment.sectionProperties.data.id);\n\t\t\t\t\t\tannotation.edit();\n\t\t\t\t\t\tif(this.shouldCollapse())\n\t\t\t\t\t\t\tannotation.setCollapsed();\n\t\t\t\t\t\tCommentSection.autoSavedComment = null;\n\t\t\t\t\t\tCommentSection.commentWasAutoAdded = true;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (this.sectionProperties.selectedComment && !this.sectionProperties.selectedComment.isEdit()) {\n\t\t\t\tthis.map.focus();\n\t\t\t}\n\t\t} else if (action === 'Remove') {\n\t\t\tid = obj[dataroot].id;\n\t\t\tvar removed = this.getComment(id);\n\t\t\tif (removed) {\n\t\t\t\tthis.adjustParentRemove(removed);\n\t\t\t\tif (this.sectionProperties.selectedComment === removed) {\n\t\t\t\t\tthis.unselect();\n\t\t\t\t\tthis.removeItem(id);\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tthis.removeItem(id);\n\t\t\t\t\tthis.update();\n\t\t\t\t}\n\t\t\t}\n\t\t} else if (action === 'RedlinedDeletion') {\n\t\t\tid = obj[dataroot].id;\n\t\t\tvar _redlined = this.getComment(id);\n\t\t\tif (_redlined && _redlined.sectionProperties.data.layoutStatus === CommentLayoutStatus.INSERTED) {\n\t\t\t\t// Do normal removal if comment was added while recording was on\n\t\t\t\t// No need to keep the deleted comment\n\t\t\t\tobj[dataroot].action = 'Remove';\n\t\t\t\tthis.onACKComment(obj);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (_redlined) {\n\t\t\t\t_redlined.sectionProperties.data.layoutStatus = CommentLayoutStatus.DELETED;\n\t\t\t\t_redlined.setLayoutClass();\n\t\t\t}\n\t\t} else if (action === 'Modify') {\n\t\t\tid = obj[dataroot].id;\n\t\t\tvar modified = this.getComment(id);\n\t\t\tif (modified) {\n\t\t\t\tvar modifiedObj;\n\t\t\t\tif (changetrack) {\n\t\t\t\t\tif (!this.adjustRedLine(obj.redline)) {\n\t\t\t\t\t\t// something wrong in this redline\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\tmodifiedObj = obj.redline;\n\t\t\t\t} else {\n\t\t\t\t\tthis.adjustComment(obj.comment);\n\t\t\t\t\tmodifiedObj = obj.comment;\n\t\t\t\t}\n\t\t\t\tconst oldParent = modified.getParentCommentId();\n\t\t\t\tmodified.setData(modifiedObj);\n\t\t\t\tmodified.update();\n\t\t\t\tif (oldParent !== null && modified.isRootComment()) {\n\t\t\t\t\tconst parentIdx = this.getIndexOf(oldParent);\n\t\t\t\t\tconst parentComment = this.sectionProperties.commentList[parentIdx];\n\t\t\t\t\tif (parentComment) {\n\t\t\t\t\t\tconst index = parentComment.getIndexOfChild(modified);\n\t\t\t\t\t\tif (index >= 0)\n\t\t\t\t\t\t\tparentComment.removeChildByIndex(index);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tthis.update();\n\n\t\t\t\tif (CommentSection.autoSavedComment) {\n\t\t\t\t\tCommentSection.autoSavedComment.sectionProperties.autoSave.innerText = _('Autosaved');\n\t\t\t\t\tif (app.map._docLayer._docType === 'spreadsheet')\n\t\t\t\t\t\tmodified.show();\n\t\t\t\t\tmodified.edit();\n\t\t\t\t\tif(this.shouldCollapse())\n\t\t\t\t\t\tmodified.setCollapsed();\n\t\t\t\t}\n\t\t\t}\n\t\t} else if (action === 'Resolve') {\n\t\t\tid = obj[dataroot].id;\n\t\t\tvar resolved = this.getComment(id);\n\t\t\tif (resolved) {\n\t\t\t\tvar resolvedObj;\n\t\t\t\tif (changetrack) {\n\t\t\t\t\tif (!this.adjustRedLine(obj.redline)) {\n\t\t\t\t\t\t// something wrong in this redline\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\tresolvedObj = obj.redline;\n\t\t\t\t} else {\n\t\t\t\t\tthis.adjustComment(obj.comment);\n\t\t\t\t\tresolvedObj = obj.comment;\n\t\t\t\t}\n\t\t\t\tresolved.setData(resolvedObj);\n\t\t\t\tresolved.update();\n\t\t\t\tthis.showHideComment(resolved);\n\t\t\t\tthis.update();\n\t\t\t}\n\t\t}\n\t\tif ((<any>window).mode.isMobile()) {\n\t\t\tvar shouldOpenWizard = false;\n\t\t\tvar wePerformedAction = obj.comment.author === this.map.getViewName(app.map._docLayer._viewId);\n\n\t\t\tif ((<any>window).commentWizard || (action === 'Add' && wePerformedAction))\n\t\t\t\tshouldOpenWizard = true;\n\n\t\t\tif (shouldOpenWizard) {\n\t\t\t\tapp.map._docLayer._openCommentWizard(annotation);\n\t\t\t}\n\t\t}\n\n\t\tif (app.map._docLayer._docType === 'text') {\n\t\t\tthis.updateThreadInfoIndicator();\n\t\t}\n\n\t\tif (CommentSection.pendingImport) {\n\t\t\tapp.socket.sendMessage('commandvalues command=.uno:ViewAnnotations');\n\t\t\tCommentSection.pendingImport = false;\n\t\t}\n\t}\n\n\tpublic selectById (commentId: any): void {\n\t\tvar idx = this.getRootIndexOf(commentId);\n\t\tvar annotation = this.sectionProperties.commentList[idx];\n\t\tthis.select(annotation);\n\t}\n\n\tpublic stringToRectangles (str: string): number[][] {\n\t\tvar strString = typeof str !== 'string' ? String(str) : str;\n\t\tvar matches = strString.match(/\\d+/g);\n\t\tvar rectangles: number[][] = [];\n\t\tif (matches !== null) {\n\t\t\tfor (var i: number = 0; i < matches.length; i += 4) {\n\t\t\t\trectangles.push([parseInt(matches[i]), parseInt(matches[i + 1]), parseInt(matches[i + 2]), parseInt(matches[i + 3])]);\n\t\t\t}\n\t\t}\n\t\treturn rectangles;\n\t}\n\n\tpublic onPartChange (): void {\n\t\tfor (var i: number = 0; i < this.sectionProperties.commentList.length; i++) {\n\t\t\tthis.showHideComment(this.sectionProperties.commentList[i]);\n\t\t}\n\t\tif (this.sectionProperties.selectedComment)\n\t\t\tthis.sectionProperties.selectedComment.onCancelClick(null);\n\n\t\tthis.checkSize();\n\t}\n\n\t// This converts the specified number of values into core pixels from twips.\n\t// Returns a new array with the length of specified numbers.\n\tprivate numberArrayToCorePixFromTwips (numberArray: Array<number>, startIndex: number = 0, length: number = null): Array<number> {\n\t\tif (!length)\n\t\t\tlength = numberArray.length;\n\n\t\tif (startIndex < 0)\n\t\t\tstartIndex = 0;\n\n\t\tif (length < 0)\n\t\t\tlength = 0;\n\n\t\tif (startIndex + length > numberArray.length)\n\t\t\tlength = numberArray.length - startIndex;\n\n\t\tvar result = new Array(length);\n\n\t\tfor (var i = startIndex; i < length; i++) {\n\t\t\tresult[i] = Math.round(numberArray[i] * app.twipsToPixels);\n\t\t}\n\n\t\treturn result;\n\t}\n\n\t// In file based view, we need to move comments to their part's position.\n\t// Because all parts are drawn on the screen. Core side doesn't have this feature.\n\t// Core side sends the information in part coordinates.\n\t// When a coordinate like [0, 0] is inside 2nd part for example, that coordinate should correspond to a value like (just guessing) [0, 45646].\n\t// See that y value is different. Because there is 1st part above the 2nd one in the view.\n\t// We will add their part's position to comment's variables.\n\t// When we are saving their position, we will remove the additions before sending the information.\n\tprivate adjustCommentFileBasedView (comment: any): void {\n\t\t// Below calculations are the same with the ones we do while drawing tiles in fileBasedView.\n\t\tvar partHeightTwips = app.map._docLayer._partHeightTwips + app.map._docLayer._spaceBetweenParts;\n\t\tvar index = app.impress.getIndexFromSlideHash(parseInt(comment.parthash));\n\t\tvar yAddition = index * partHeightTwips;\n\t\tcomment.yAddition = yAddition; // We'll use this while we save the new position of the comment.\n\n\t\tcomment.trackchange = false;\n\n\t\tcomment.rectangles = this.stringToRectangles(comment.textRange || comment.anchorPos || comment.rectangle); // Simple array of point arrays [x1, y1, x2, y2].\n\t\tcomment.rectangles[0][1] += yAddition; // There is only one rectangle for our case.\n\n\t\tcomment.rectanglesOriginal = this.stringToRectangles(comment.textRange || comment.anchorPos || comment.rectangle); // This unmodified version will be kept for re-calculations.\n\t\tcomment.rectanglesOriginal[0][1] += yAddition;\n\n\t\tcomment.anchorPos = this.stringToRectangles(comment.anchorPos || comment.rectangle)[0];\n\t\tcomment.anchorPos[1] += yAddition;\n\n\t\tif (comment.rectangle) {\n\t\t\tcomment.rectangle = this.stringToRectangles(comment.rectangle)[0]; // This is the position of the marker.\n\t\t\tcomment.rectangle[1] += yAddition;\n\t\t}\n\n\t\tcomment.anchorPix = this.numberArrayToCorePixFromTwips(comment.anchorPos, 0, 2);\n\n\t\tcomment.parthash = comment.parthash ? comment.parthash: null;\n\n\t\tvar viewId = this.map.getViewId(comment.author);\n\t\tvar color = viewId >= 0 ? app.LOUtil.rgbToHex(this.map.getViewColor(viewId)) : '#43ACE8';\n\t\tcomment.color = color;\n\t}\n\n\t// Normally, a comment's position information is the same with the desktop version.\n\t// So we can use it directly.\n\tprivate adjustCommentNormal (comment: any): void {\n\t\tcomment.trackchange = false;\n\n\t\tif (comment.cellRange) {\n\t\t\t// turn cell range string into cell bounds\n\t\t\tcomment.cellRange = app.map._docLayer._parseCellRange(comment.cellRange);\n\t\t}\n\n\t\tvar cellPos = comment.cellRange ? app.map._docLayer._cellRangeToTwipRect(comment.cellRange).toRectangle() : null;\n\t\tcomment.rectangles = this.stringToRectangles(comment.textRange || comment.anchorPos || comment.rectangle || cellPos); // Simple array of point arrays [x1, y1, x2, y2].\n\t\tcomment.rectanglesOriginal = this.stringToRectangles(comment.textRange || comment.anchorPos || comment.rectangle || cellPos); // This unmodified version will be kept for re-calculations.\n\t\tcomment.anchorPos = this.stringToRectangles(comment.anchorPos || comment.rectangle || cellPos)[0];\n\t\tcomment.anchorPix = this.numberArrayToCorePixFromTwips(comment.anchorPos, 0, 2);\n\t\tcomment.parthash = comment.parthash ? comment.parthash: null;\n\t\tcomment.tab = (comment.tab || comment.tab === 0) ? comment.tab: null;\n\t\tcomment.layoutStatus = comment.layoutStatus !== undefined ? parseInt(comment.layoutStatus): null;\n\n\t\tif (comment.parentId)\n\t\t\tcomment.parent = String(comment.parentId);\n\n\t\tif (comment.rectangle) {\n\t\t\tcomment.rectangle = this.stringToRectangles(comment.rectangle)[0]; // This is the position of the marker (Impress & Draw).\n\t\t}\n\n\t\tvar viewId = this.map.getViewId(comment.author);\n\t\tvar color = viewId >= 0 ? app.LOUtil.rgbToHex(this.map.getViewColor(viewId)) : '#43ACE8';\n\t\tcomment.color = color;\n\t}\n\n\tprivate adjustComment (comment: any): void {\n\t\tif (!app.file.fileBasedView)\n\t\t\tthis.adjustCommentNormal(comment);\n\t\telse\n\t\t\tthis.adjustCommentFileBasedView(comment);\n\t}\n\n\t// Returns the last comment id of comment thread containing the given id\n\tprivate getLastChildIndexOf (id: any): number {\n\t\tvar index = this.getIndexOf(id);\n\t\tindex = this.getRootIndexOf(this.sectionProperties.commentList[index].sectionProperties.data.id);\n\n\t\twhile\n\t\t(\n\t\t\tthis.sectionProperties.commentList[index + 1] &&\n\t\t\tindex + 1 < this.sectionProperties.commentList.length &&\n\t\t\tthis.sectionProperties.commentList[index + 1].sectionProperties.data.parent !== '0'\n\t\t) {\n\t\t\tindex++;\n\t\t}\n\n\t\treturn index;\n\t}\n\n\t// If the file type is presentation or drawing then we shall check the selected part in order to hide comments from other parts.\n\t// But if file is in fileBasedView, then we will not hide any comments from not-selected/viewed parts.\n\tprivate mustCheckSelectedPart (): boolean {\n\t\treturn (app.map._docLayer._docType === 'presentation' || app.map._docLayer._docType === 'drawing') && !app.file.fileBasedView;\n\t}\n\n\tprivate layoutUp (subList: Array<Comment>, actualPosition: Array<number>, lastY: number, relayout: boolean = true): number {\n\t\tvar height: number;\n\t\tfor (var i = 0; i < subList.length; i++) {\n\t\t\theight = subList[i].getCommentHeight(relayout);\n\t\t\tlastY = subList[i].sectionProperties.data.anchorPix[1] + height < lastY ? subList[i].sectionProperties.data.anchorPix[1]: lastY - (height * app.dpiScale);\n\n\t\t\tsubList[i].sectionProperties.container.style.left = String(Math.round(actualPosition[0] / app.dpiScale)) + 'px';\n\t\t\tsubList[i].sectionProperties.container.style.top = String(Math.round(lastY / app.dpiScale)) + 'px';\n\n\t\t\tif (!subList[i].isEdit())\n\t\t\t\tsubList[i].show();\n\t\t}\n\t\treturn lastY;\n\t}\n\n\tprivate loopUp (startIndex: number, x: number, startY: number, relayout: boolean = true): number {\n\t\tvar tmpIdx = 0;\n\t\tvar checkSelectedPart: boolean = this.mustCheckSelectedPart();\n\t\tstartY -= this.sectionProperties.marginY;\n\t\t// Pass over all comments present\n\t\tfor (var i = startIndex; i > -1;) {\n\t\t\tvar subList = [];\n\t\t\ttmpIdx = i;\n\t\t\tdo {\n\t\t\t\tthis.sectionProperties.commentList[tmpIdx].sectionProperties.data.anchorPix = this.numberArrayToCorePixFromTwips(this.sectionProperties.commentList[tmpIdx].sectionProperties.data.anchorPos, 0, 2);\n\t\t\t\tthis.sectionProperties.commentList[tmpIdx].sectionProperties.data.anchorPix[1] -= this.documentTopLeft[1];\n\t\t\t\t// Add this item to the list of comments.\n\t\t\t\tif (this.sectionProperties.commentList[tmpIdx].sectionProperties.data.resolved !== 'true' || this.sectionProperties.showResolved) {\n\t\t\t\t\tif (!checkSelectedPart || app.map._docLayer._selectedPart === this.sectionProperties.commentList[tmpIdx].sectionProperties.partIndex)\n\t\t\t\t\t\tsubList.push(this.sectionProperties.commentList[tmpIdx]);\n\t\t\t\t}\n\t\t\t\ttmpIdx = tmpIdx - 1;\n\t\t\t\t// Continue this loop, until we reach the last item, or an item which is not a direct descendant of the previous item.\n\t\t\t} while (tmpIdx > -1 && this.sectionProperties.commentList[tmpIdx].sectionProperties.data.parent === this.sectionProperties.commentList[tmpIdx + 1].sectionProperties.data.id);\n\n\t\t\tif (subList.length > 0) {\n\t\t\t\tstartY = this.layoutUp(subList, [x, subList[0].sectionProperties.data.anchorPix[1]], startY, relayout);\n\t\t\t\ti = i - subList.length;\n\t\t\t} else {\n\t\t\t\ti = tmpIdx;\n\t\t\t}\n\t\t\tstartY -= this.sectionProperties.marginY;\n\t\t}\n\t\treturn startY;\n\t}\n\n\tprivate layoutDown (subList: any, actualPosition: Array<number>, lastY: number, relayout: boolean = true): number {\n\t\tvar selectedComment = subList[0] === this.sectionProperties.selectedComment;\n\t\tfor (var i = 0; i < subList.length; i++) {\n\t\t\tlastY = subList[i].sectionProperties.data.anchorPix[1] > lastY ? subList[i].sectionProperties.data.anchorPix[1]: lastY;\n\n\t\t\tvar isRTL = document.documentElement.dir === 'rtl';\n\n\t\t\tif (selectedComment) {\n\t\t\t\t// FIXME: getBoundingClientRect is expensive and this is a hot path (called continuously during animations and scrolling)\n\t\t\t\tconst posX = (this.sectionProperties.showSelectedBigger ?\n\t\t\t\t\t\t\t\tMath.round((document.getElementById('document-container').getBoundingClientRect().width - subList[i].sectionProperties.container.getBoundingClientRect().width)/2) :\n\t\t\t\t\t\t\t\tMath.round(actualPosition[0] / app.dpiScale) - this.sectionProperties.deflectionOfSelectedComment * (isRTL ? -1 : 1));\n\n\t\t\t\tsubList[i].sectionProperties.container.style.left = String(posX) + 'px';\n\t\t\t\tsubList[i].sectionProperties.container.style.top = String(Math.round(lastY / app.dpiScale)) + 'px';\n\t\t\t}\n\t\t\telse {\n\t\t\t\tsubList[i].sectionProperties.container.style.left = String(Math.round(actualPosition[0] / app.dpiScale)) + 'px';\n\t\t\t\tsubList[i].sectionProperties.container.style.top = String(Math.round(lastY / app.dpiScale)) + 'px';\n\t\t\t}\n\n\t\t\tlastY += (subList[i].getCommentHeight(relayout) * app.dpiScale);\n\t\t\tif (!subList[i].isEdit())\n\t\t\t\tsubList[i].show();\n\t\t}\n\t\treturn lastY;\n\t}\n\n\tprivate loopDown (startIndex: number, x: number, startY: number, relayout: boolean = true): number {\n\t\tvar tmpIdx = 0;\n\t\tvar checkSelectedPart: boolean = this.mustCheckSelectedPart();\n\t\t// Pass over all comments present\n\t\tfor (var i = startIndex; i < this.sectionProperties.commentList.length;) {\n\t\t\tvar subList = [];\n\t\t\ttmpIdx = i;\n\t\t\tdo {\n\t\t\t\tthis.sectionProperties.commentList[tmpIdx].sectionProperties.data.anchorPix = this.numberArrayToCorePixFromTwips(this.sectionProperties.commentList[tmpIdx].sectionProperties.data.anchorPos, 0, 2);\n\t\t\t\tthis.sectionProperties.commentList[tmpIdx].sectionProperties.data.anchorPix[1] -= this.documentTopLeft[1];\n\t\t\t\t// Add this item to the list of comments.\n\t\t\t\tif (this.sectionProperties.commentList[tmpIdx].sectionProperties.data.resolved !== 'true' || this.sectionProperties.showResolved) {\n\t\t\t\t\tif (!checkSelectedPart || app.map._docLayer._selectedPart === this.sectionProperties.commentList[tmpIdx].sectionProperties.partIndex)\n\t\t\t\t\t\tsubList.push(this.sectionProperties.commentList[tmpIdx]);\n\t\t\t\t}\n\t\t\t\ttmpIdx = tmpIdx + 1;\n\t\t\t\t// Continue this loop, until we reach the last item, or an item which is not a direct descendant of the previous item.\n\t\t\t} while (tmpIdx < this.sectionProperties.commentList.length && this.sectionProperties.commentList[tmpIdx].sectionProperties.data.parent !== '0');\n\n\t\t\tif (subList.length > 0) {\n\t\t\t\tstartY = this.layoutDown(subList, [x, subList[0].sectionProperties.data.anchorPix[1]], startY, relayout);\n\t\t\t\ti = i + subList.length;\n\t\t\t} else {\n\t\t\t\ti = tmpIdx;\n\t\t\t}\n\t\t\tstartY += this.sectionProperties.marginY;\n\t\t}\n\t\treturn startY;\n\t}\n\n\tpublic hideArrow (): void {\n\t\tif (this.sectionProperties.arrow) {\n\t\t\tdocument.getElementById('document-container').removeChild(this.sectionProperties.arrow);\n\t\t\tthis.sectionProperties.arrow = null;\n\t\t\tapp.sectionContainer.requestReDraw();\n\t\t}\n\t}\n\n\tprivate showArrow (startPoint: Array<number>, endPoint: Array<number>): void {\n\t\tvar anchorSection = this.containerObject.getDocumentAnchorSection();\n\t\tstartPoint[0] -= anchorSection.myTopLeft[0] + this.documentTopLeft[0];\n\t\tstartPoint[1] -= anchorSection.myTopLeft[1] + this.documentTopLeft[1];\n\t\tendPoint[1] -= anchorSection.myTopLeft[1] + this.documentTopLeft[1];\n\n\t\tstartPoint[0] = Math.floor(startPoint[0] / app.dpiScale);\n\t\tstartPoint[1] = Math.floor(startPoint[1] / app.dpiScale);\n\t\tendPoint[0] = Math.floor(endPoint[0] / app.dpiScale);\n\t\tendPoint[1] = Math.floor(endPoint[1] / app.dpiScale);\n\n\t\tif (this.sectionProperties.arrow !== null) {\n\t\t\tvar line: SVGLineElement = <SVGLineElement>(this.sectionProperties.arrow.firstElementChild);\n\t\t\tline.setAttribute('x1', String(startPoint[0]));\n\t\t\tline.setAttribute('y1', String(startPoint[1]));\n\t\t\tline.setAttribute('x2', String(endPoint[0]));\n\t\t\tline.setAttribute('y2', String(endPoint[1]));\n\t\t}\n\t\telse {\n\t\t\tvar svg: SVGElement = (<any>document.createElementNS('http://www.w3.org/2000/svg', 'svg'));\n\t\t\tsvg.setAttribute('version', '1.1');\n\t\t\tsvg.style.zIndex = '9';\n\t\t\tsvg.id = 'comment-arrow-container';\n\t\t\tsvg.style.position = 'absolute';\n\t\t\tsvg.style.top = svg.style.left = svg.style.right = svg.style.bottom = '0';\n\t\t\tsvg.setAttribute('width', String(this.context.canvas.width));\n\t\t\tsvg.setAttribute('height', String(this.context.canvas.height));\n\t\t\tvar line  = document.createElementNS('http://www.w3.org/2000/svg','line');\n\t\t\tline.id = 'comment-arrow-line';\n\t\t\tline.setAttribute('x1', String(startPoint[0]));\n\t\t\tline.setAttribute('y1', String(startPoint[1]));\n\t\t\tline.setAttribute('x2', String(endPoint[0]));\n\t\t\tline.setAttribute('y2', String(endPoint[1]));\n\t\t\tline.setAttribute('stroke', 'darkblue');\n\t\t\tline.setAttribute('stroke-width', '1');\n\t\t\tsvg.appendChild(line);\n\t\t\tdocument.getElementById('document-container').appendChild(svg);\n\t\t\tthis.sectionProperties.arrow = svg;\n\t\t}\n\t}\n\n\tprivate layout (relayout: boolean = true): void {\n\t\tif ((<any>window).mode.isMobile() || app.map._docLayer._docType === 'spreadsheet') {\n\t\t\tif (this.sectionProperties.commentList.length > 0)\n\t\t\t\tthis.orderCommentList();\n\t\t\treturn; // No adjustments for Calc, since only one comment can be shown at a time and that comment is shown at its belonging cell.\n\t\t}\n\n\t\tif (this.sectionProperties.commentList.length > 0) {\n\t\t\tthis.orderCommentList();\n\t\t\tif (relayout)\n\t\t\t\tthis.resetCommentsSize();\n\n\t\t\tvar isRTL = document.documentElement.dir === 'rtl';\n\n\t\t\tvar topRight: Array<number> = [this.myTopLeft[0], this.myTopLeft[1] + this.sectionProperties.marginY - this.documentTopLeft[1]];\n\t\t\tvar yOrigin = null;\n\t\t\tvar selectedIndex = null;\n\t\t\tvar x = isRTL ? 0 : topRight[0];\n\t\t\tvar availableSpace = this.calculateAvailableSpace();\n\n\t\t\tif (availableSpace > this.sectionProperties.commentWidth) {\n\t\t\t\tif (isRTL)\n\t\t\t\t\tx = Math.round((this.containerObject.getDocumentAnchorSection().size[0] - app.file.size.pX) * 0.5) - this.containerObject.getDocumentAnchorSection().size[0];\n\t\t\t\telse\n\t\t\t\t\tx = topRight[0] - Math.round((this.containerObject.getDocumentAnchorSection().size[0] - app.file.size.pX) * 0.5);\n\t\t\t} else if (isRTL)\n\t\t\t\tx = -this.containerObject.getDocumentAnchorSection().size[0];\n\t\t\telse\n\t\t\t\tx -= this.sectionProperties.collapsedMarginToTheEdge;\n\n\t\t\tif (this.sectionProperties.selectedComment) {\n\t\t\t\tselectedIndex = this.getRootIndexOf(this.sectionProperties.selectedComment.sectionProperties.data.id);\n\t\t\t\tthis.sectionProperties.commentList[selectedIndex].sectionProperties.data.anchorPix = this.numberArrayToCorePixFromTwips(this.sectionProperties.commentList[selectedIndex].sectionProperties.data.anchorPos, 0, 2);\n\t\t\t\tthis.sectionProperties.commentList[selectedIndex].sectionProperties.data.anchorPix[1];\n\t\t\t\tyOrigin = this.sectionProperties.commentList[selectedIndex].sectionProperties.data.anchorPix[1] - this.documentTopLeft[1];\n\t\t\t\tvar tempCrd: Array<number> = this.sectionProperties.commentList[selectedIndex].sectionProperties.data.anchorPix;\n\t\t\t\tvar resolved:string = this.sectionProperties.commentList[selectedIndex].sectionProperties.data.resolved;\n\t\t\t\tif (!resolved || resolved === 'false' || this.sectionProperties.showResolved) {\n\t\t\t\t\tvar posX = isRTL ? (this.containerObject.getDocumentAnchorSection().size[0] + x + 15) : x;\n\t\t\t\t\tthis.showArrow([tempCrd[0], tempCrd[1]], [posX, tempCrd[1]]);\n\t\t\t\t}\n\t\t\t}\n\t\t\telse\n\t\t\t\tthis.hideArrow();\n\n\t\t\tvar lastY = 0;\n\t\t\tif (selectedIndex) {\n\t\t\t\tthis.loopUp(selectedIndex - 1, x, yOrigin, relayout);\n\t\t\t\tlastY = this.loopDown(selectedIndex, x, yOrigin, relayout);\n\t\t\t}\n\t\t\telse {\n\t\t\t\tlastY = this.loopDown(0, x, topRight[1], relayout);\n\t\t\t}\n\t\t}\n\t\tif (relayout)\n\t\t\tthis.resizeComments();\n\n\t\tlastY += this.containerObject.getDocumentTopLeft()[1];\n\t\tif (lastY > app.file.size.pY) {\n\t\t\tapp.view.size.pY = lastY;\n\t\t\tthis.containerObject.requestReDraw();\n\t\t}\n\t\telse\n\t\t\tapp.view.size.pY = app.file.size.pY;\n\n\t\tthis.disableLayoutAnimation = false;\n\t}\n\n\tprivate update (reLayout: boolean = true): void {\n\t\tthis.sectionProperties.pendingUpdate = true;\n\t\tthis.sectionProperties.reLayout = reLayout;\n\t\tthis.containerObject.requestReDraw();\n\t}\n\n\tpublic onUpdateDOM(): void {\n\t\tif (!this.sectionProperties.pendingUpdate)\n\t\t\treturn\n\n\t\tif (this.sectionProperties.reLayout && app.map._docLayer._docType === 'text')\n\t\t\tthis.updateThreadInfoIndicator();\n\n\t\tthis.layout(this.sectionProperties.reLayout);\n\t\tthis.sectionProperties.pendingUpdate = false;\n\t\tthis.sectionProperties.reLayout = true;\n\t}\n\n\tprivate updateThreadInfoIndicator(): void {\n\t\tfor (var i = 0; i < this.sectionProperties.commentList.length; i++) {\n\t\t\tvar comment = this.sectionProperties.commentList[i];\n\t\t\tvar replyCount = 0;\n\t\t\tvar anyEdit = false;\n\n\t\t\tif (comment && comment.isRootComment()) {\n\t\t\t\tvar lastIndex = this.getLastChildIndexOf(comment.sectionProperties.data.id);\n\t\t\t\tvar j = i;\n\t\t\t\twhile (this.sectionProperties.commentList[j] && j <= lastIndex) {\n\t\t\t\t\tanyEdit = this.sectionProperties.commentList[j].isEdit() || anyEdit;\n\t\t\t\t\tif (this.sectionProperties.commentList[j].sectionProperties.data.parent !== '0') {\n\t\t\t\t\t\tif ((this.sectionProperties.commentList[j].sectionProperties.data.layoutStatus !== CommentLayoutStatus.DELETED ||\n\t\t\t\t\t\t\tthis.map['stateChangeHandler'].getItemValue('.uno:ShowTrackedChanges') === 'true') &&\n\t\t\t\t\t\t\tthis.sectionProperties.commentList[j].sectionProperties.data.resolved !== 'true') {\n\t\t\t\t\t\t\treplyCount++;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tj++;\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (anyEdit)\n\t\t\t\tcomment.updateThreadInfoIndicator('!');\n\t\t\telse\n\t\t\t\tcomment.updateThreadInfoIndicator(replyCount);\n\t\t}\n\t}\n\n\tprivate updateChildLines () : void {\n\t\tfor (let i = 0; i < this.sectionProperties.commentList.length; i++) {\n\t\t\tthis.sectionProperties.commentList[i].updateChildLines();\n\t\t}\n\t}\n\n\t// Returns the root comment index of given id\n\tprivate getRootIndexOf (id: any): number {\n\t\tvar index = this.getIndexOf(id);\n\n\t\twhile (index >= 0) {\n\t\t\tif (this.sectionProperties.commentList[index].sectionProperties.data.parent !== '0')\n\t\t\t\tindex--;\n\t\t\telse\n\t\t\t\tbreak;\n\t\t}\n\n\t\treturn index;\n\t}\n\n\t// Returns the sub-root comment index of given id\n\tprivate getSubRootIndexOf (id: any): number {\n\t\tvar index = this.getIndexOf(id);\n\n\t\tif (index !== -1)\n\t\t{\n\t\t\tvar comment = this.sectionProperties.commentList[index];\n\t\t\tvar parentId = comment.sectionProperties.data.parent;\n\n\t\t\twhile (index >= 0) {\n\t\t\t\tif (this.sectionProperties.commentList[index].sectionProperties.data.id !== parentId && this.sectionProperties.commentList[index].sectionProperties.data.parent !== '0')\n\t\t\t\t\tindex--;\n\t\t\t\telse\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\treturn index;\n\t}\n\n\tpublic setViewResolved (state: any): void {\n\t\tthis.sectionProperties.showResolved = state;\n\n\t\tfor (var idx = 0; idx < this.sectionProperties.commentList.length;idx++) {\n\t\t\tif (this.sectionProperties.commentList[idx].sectionProperties.data.resolved === 'true') {\n\t\t\t\tif (state==false) {\n\t\t\t\t\tif (this.sectionProperties.selectedComment == this.sectionProperties.commentList[idx]) {\n\t\t\t\t\t\tthis.unselect();\n\t\t\t\t\t}\n\t\t\t\t\tthis.sectionProperties.commentList[idx].hide();\n\t\t\t\t} else {\n\t\t\t\t\tthis.sectionProperties.commentList[idx].show();\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis.sectionProperties.commentList[idx].update();\n\t\t}\n\t\tthis.update();\n\t}\n\n\tpublic setView (state: any): void {\n\t\tthis.sectionProperties.show = state;\n\t\tfor (var idx = 0; idx < this.sectionProperties.commentList.length;idx++) {\n\t\t\tif (state == false)\n\t\t\t\tthis.sectionProperties.commentList[idx].hide();\n\t\t\telse\n\t\t\t\tthis.sectionProperties.commentList[idx].show();\n\t\t}\n\t}\n\n\tprivate orderCommentList (): void {\n\t\tthis.sectionProperties.commentList.sort(function(a: any, b: any) {\n\t\t\treturn Math.abs(a.sectionProperties.data.anchorPos[1]) - Math.abs(b.sectionProperties.data.anchorPos[1]) ||\n\t\t\t\tMath.abs(a.sectionProperties.data.anchorPos[0]) - Math.abs(b.sectionProperties.data.anchorPos[0]);\n\t\t});\n\n\t\tif (app.map._docLayer._docType === 'text')\n\t\t\tthis.orderTextComments();\n\n\t\t// idIndexMap is now invalid, update it.\n\t\tthis.updateIdIndexMap();\n\t}\n\n\t// reset theis size to default (100px text)\n\tprivate resetCommentsSize (): void {\n\t\tif (app.map._docLayer._docType === 'text') {\n\t\t\tfor (var i = 0; i < this.sectionProperties.commentList.length;i++) {\n\t\t\t\tif (this.sectionProperties.commentList[i].sectionProperties.contentNode.style.display !== 'none') {\n\t\t\t\t\tconst maxHeight = (this.sectionProperties.commentList[i] === this.sectionProperties.selectedComment) ?\n\t\t\t\t\t\tthis.annotationMaxSize : this.annotationMinSize;\n\t\t\t\t\tthis.sectionProperties.commentList[i].sectionProperties.contentNode.style.maxHeight = maxHeight + 'px';\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\t// grow comments size if they have more text, and there is enough space between other comments\n\tprivate resizeComments (): void {\n\t\t// Change it true, if comments are allowed to grow up direction.\n\t\t// Now it is disabled, because without constant indicator of the comments anchor, it can be confusing.\n\t\tvar growUp = false;\n\t\tif (app.map._docLayer._docType === 'text') {\n\t\t\tconst minMaxHeight = Number(getComputedStyle(document.documentElement).getPropertyValue('--annotation-min-size'));\n\t\t\tconst maxMaxHeight = Number(getComputedStyle(document.documentElement).getPropertyValue('--annotation-max-size'));\n\t\t\tfor (var i = 0; i < this.sectionProperties.commentList.length;i++) {\n\t\t\t\t// Only if ContentNode is displayed.\n\t\t\t\tif (this.sectionProperties.commentList[i].sectionProperties.contentNode.style.display !== 'none'\n\t\t\t\t&& !this.sectionProperties.commentList[i].isEdit()) {\n\t\t\t\t\t// act commentText height\n\t\t\t\t\tvar actHeight = this.sectionProperties.commentList[i].sectionProperties.contentText.getBoundingClientRect().height;\n\t\t\t\t\t// if the comment is taller then minimal, we may want to make it taller\n\t\t\t\t\tif (actHeight > minMaxHeight) {\n\t\t\t\t\t\t// but we don't want to make it taller then the maximum\n\t\t\t\t\t\tif (actHeight > maxMaxHeight) {\n\t\t\t\t\t\t\tactHeight = maxMaxHeight;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (i + 1 >= this.sectionProperties.commentList.length) {\n\t\t\t\t\t\t\t// check if there is more space after this comment.\n\t\t\t\t\t\t\tvar maxSize = maxMaxHeight;\n\t\t\t\t\t\t\tif (i + 1 < this.sectionProperties.commentList.length)\n\t\t\t\t\t\t\t\t// max size of text should be the space between comments - size of non text parts\n\t\t\t\t\t\t\t\tmaxSize = this.sectionProperties.commentList[i + 1].getContainerPosY()\n\t\t\t\t\t\t\t\t\t- this.sectionProperties.commentList[i].getContainerPosY()\n\t\t\t\t\t\t\t\t\t- this.sectionProperties.commentList[i].sectionProperties.author.getBoundingClientRect().height\n\t\t\t\t\t\t\t\t\t- 3 * this.sectionProperties.marginY //top/bottom of comment window + space between comments\n\t\t\t\t\t\t\t\t\t- 2; // not sure why\n\n\t\t\t\t\t\t\tif (maxSize > maxMaxHeight) {\n\t\t\t\t\t\t\t\tmaxSize = maxMaxHeight;\n\t\t\t\t\t\t\t} else if (growUp && actHeight > maxSize) {\n\t\t\t\t\t\t\t\t// if more space needed as we have after the comment\n\t\t\t\t\t\t\t\t// check it there is any space before the comment\n\t\t\t\t\t\t\t\tvar spaceBefore = this.sectionProperties.commentList[i].getContainerPosY();\n\t\t\t\t\t\t\t\tif (i > 0) {\n\t\t\t\t\t\t\t\t\tspaceBefore -= this.sectionProperties.commentList[i - 1].getContainerPosY()\n\t\t\t\t\t\t\t\t\t\t+ this.sectionProperties.commentList[i - 1].getCommentHeight()\n\t\t\t\t\t\t\t\t\t\t+ this.sectionProperties.marginY;\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tspaceBefore += this.documentTopLeft[1];\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t// if there is more space\n\t\t\t\t\t\t\t\tif (spaceBefore > 0) {\n\t\t\t\t\t\t\t\t\tvar moveUp = 0;\n\t\t\t\t\t\t\t\t\tif (actHeight - maxSize < spaceBefore) {\n\t\t\t\t\t\t\t\t\t\t// there is enough space, move up as much as we can;\n\t\t\t\t\t\t\t\t\t\tmoveUp = actHeight - maxSize;\n\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t// there is not enough space\n\t\t\t\t\t\t\t\t\t\tmoveUp = spaceBefore;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t// move up\n\t\t\t\t\t\t\t\t\tconst posX = this.sectionProperties.commentList[i].getContainerPosX();\n\t\t\t\t\t\t\t\t\tconst posY = this.sectionProperties.commentList[i].getContainerPosY() - moveUp;\n\t\t\t\t\t\t\t\t\tthis.sectionProperties.commentList[i].sectionProperties.container.style.left = Math.round(posX) + 'px';\n\t\t\t\t\t\t\t\t\tthis.sectionProperties.commentList[i].sectionProperties.container.style.top = Math.round(posY) + 'px';\n\t\t\t\t\t\t\t\t\t// increase comment height\n\t\t\t\t\t\t\t\t\tmaxSize += moveUp;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif (maxSize > minMaxHeight)\n\t\t\t\t\t\t\t\tthis.sectionProperties.commentList[i].sectionProperties.contentNode.style.maxHeight = Math.round(maxSize) + 'px';\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis.updateChildLines();\n\t\t}\n\t}\n\n\tprivate updateIdIndexMap(): void {\n\t\tthis.idIndexMap.clear();\n\t\tconst commentList = this.sectionProperties.commentList;\n\t\tfor (var idx = 0; idx < commentList.length; idx++) {\n\t\t\tconst comment = commentList[idx];\n\t\t\tconsole.assert(comment.sectionProperties && comment.sectionProperties.data, 'no sectionProperties.data!');\n\t\t\tthis.idIndexMap.set(comment.sectionProperties.data.id, idx);\n\t\t}\n\t}\n\n\tprivate turnIntoAList (commentList: any): any[] {\n\t\tvar newArray;\n\t\tif (!Array.isArray(commentList)) {\n\t\t\tnewArray = new Array(0);\n\t\t\tfor (var prop in commentList) {\n\t\t\t\tif (Object.prototype.hasOwnProperty.call(commentList, prop)) {\n\t\t\t\t\tnewArray.push(commentList[prop]);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\telse {\n\t\t\tnewArray = commentList;\n\t\t}\n\t\treturn newArray;\n\t}\n\n\tprivate addUpdateChildGroups() {\n\t\tvar parentCommentList: Array<any> = [];\n\t\tfor (var i = 0; i < this.sectionProperties.commentList.length; i++) {\n\t\t\tvar comment = this.sectionProperties.commentList[i];\n\t\t\tcomment.sectionProperties.children = [];\n\t\t\tif (comment.sectionProperties.data.parent !== '0')\n\t\t\t{\n\t\t\t\tif (!parentCommentList.includes(comment.sectionProperties.data.parent))\n\t\t\t\t\tparentCommentList.push(comment.sectionProperties.data.parent);\n\t\t\t}\n\t\t}\n\n\t\tfor (var i = 0; i < parentCommentList.length; i++) {\n\t\t\tvar parentComment;\n\t\t\tfor (var j = 0; j < this.sectionProperties.commentList.length; j++) {\n\t\t\t\tif (this.sectionProperties.commentList[j].sectionProperties.data.id === parentCommentList[i]) {\n\t\t\t\t\tparentComment = this.sectionProperties.commentList[j];\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (parentComment) {\n\t\t\t\tfor (var j = 0; j < this.sectionProperties.commentList.length; j++) {\n\t\t\t\t\tif (this.sectionProperties.commentList[j].sectionProperties.data.parent === parentCommentList[i])\n\t\t\t\t\t\tparentComment.sectionProperties.children.push(this.sectionProperties.commentList[j]);\n\t\t\t\t}\n\t\t\t}\n\t\t\telse\n\t\t\t\tconsole.warn('Couldn\\'t find parent comment.');\n\t\t}\n\t}\n\n\tprivate addChildrenCommentsToList(comment: any, newOrder: Array<any>) {\n\t\tcomment.sectionProperties.children.forEach(function(element: any) {\n\t\t\tnewOrder.push(element);\n\t\t\tif (element.sectionProperties.children.length > 0)\n\t\t\t\tthis.addChildrenCommentsToList(element, newOrder);\n\t\t}.bind(this));\n\t}\n\n\tprivate orderTextComments() {\n\t\tvar newOrder = [];\n\n\t\tfor (var i = 0; i < this.sectionProperties.commentList.length; i++) {\n\t\t\tvar comment = this.sectionProperties.commentList[i];\n\n\t\t\tif (comment.isRootComment()) {\n\t\t\t\tnewOrder.push(comment);\n\n\t\t\t\tif (comment.sectionProperties.children.length > 0)\n\t\t\t\t\tthis.addChildrenCommentsToList(comment, newOrder);\n\t\t\t}\n\t\t}\n\n\t\tthis.sectionProperties.commentList = newOrder;\n\t}\n\n\tpublic importComments (commentList: any): void {\n\t\tthis.disableLayoutAnimation = true;\n\t\tvar comment;\n\t\tif (Comment.isAnyEdit()) {\n\t\t\tCommentSection.pendingImport = true;\n\t\t\treturn;\n\t\t}\n\n\t\tCommentSection.importingComments = true;\n\n\t\tthis.clearList();\n\t\tcommentList = this.turnIntoAList(commentList);\n\n\t\tif (commentList.length > 0) {\n\t\t\tfor (var i = 0; i < commentList.length; i++) {\n\t\t\t\tcomment = commentList[i];\n\n\t\t\t\tthis.adjustComment(comment);\n\t\t\t\tif (comment.author in this.map._viewInfoByUserName) {\n\t\t\t\t\tcomment.avatar = this.map._viewInfoByUserName[comment.author].userextrainfo.avatar;\n\t\t\t\t}\n\t\t\t\tvar commentSection = new cool.Comment(comment, {}, this);\n\t\t\t\tif (!this.containerObject.addSection(commentSection))\n\t\t\t\t\tcontinue;\n\t\t\t\tthis.sectionProperties.commentList.push(commentSection);\n\t\t\t\tthis.idIndexMap.set(commentSection.sectionProperties.data.id, i);\n\t\t\t}\n\n\t\t\tif (app.map._docLayer._docType === 'text')\n\t\t\t\tthis.addUpdateChildGroups();\n\n\t\t\tthis.orderCommentList();\n\t\t\tthis.checkSize();\n\t\t\tthis.update();\n\t\t}\n\n\t\tvar show = this.map.stateChangeHandler.getItemValue('showannotations');\n\t\tthis.setView(show === true || show === 'true');\n\n\t\tvar showResolved = this.map.stateChangeHandler.getItemValue('ShowResolvedAnnotations');\n\t\tthis.setViewResolved(showResolved === true || showResolved === 'true');\n\n\t\tif (app.map._docLayer._docType === 'spreadsheet')\n\t\t\tthis.hideAllComments(); // Apply drawing orders.\n\n\t\tif ((app.map._docLayer._docType === 'presentation' || app.map._docLayer._docType === 'drawing'))\n\t\t\tthis.showHideComments();\n\n\t\tthis.sectionProperties.reLayout = true;\n\t\tthis.onUpdateDOM();\n\n\t\tCommentSection.importingComments = false;\n\t}\n\n\t// Accepts redlines/changes comments.\n\tpublic importChanges (changesList: any): void {\n\t\tvar changeComment;\n\t\tthis.clearChanges();\n\t\tchangesList = this.turnIntoAList(changesList);\n\n\t\tif (changesList.length > 0) {\n\t\t\tfor (var i = 0; i < changesList.length; i++) {\n\t\t\t\tchangeComment = changesList[i];\n\t\t\t\tif (!this.adjustRedLine(changeComment))\n\t\t\t\t\t// something wrong in this redline, skip this one\n\t\t\t\t\tcontinue;\n\n\t\t\t\tif (changeComment.author in this.map._viewInfoByUserName) {\n\t\t\t\t\tchangeComment.avatar = this.map._viewInfoByUserName[changeComment.author].userextrainfo.avatar;\n\t\t\t\t}\n\t\t\t\tvar commentSection = new cool.Comment(changeComment, {}, this);\n\t\t\t\tif (!this.containerObject.addSection(commentSection))\n\t\t\t\t\tcontinue;\n\t\t\t\tthis.sectionProperties.commentList.push(commentSection);\n\t\t\t}\n\n\t\t\tthis.orderCommentList();\n\t\t\tthis.checkSize();\n\t\t\tthis.update();\n\t\t}\n\n\t\tif (app.map._docLayer._docType === 'spreadsheet')\n\t\t\tthis.hideAllComments(); // Apply drawing orders.\n\t}\n\n\t// Remove redline comments.\n\tprivate clearChanges(): void {\n\t\tthis.containerObject.pauseDrawing();\n\t\tfor (var i: number = this.sectionProperties.commentList.length -1; i > -1; i--) {\n\t\t\tif (this.sectionProperties.commentList[i].sectionProperties.data.trackchange) {\n\t\t\t\tthis.containerObject.removeSection(this.sectionProperties.commentList[i].name);\n\t\t\t\tthis.sectionProperties.commentList.splice(i, 1);\n\t\t\t}\n\t\t}\n\t\tthis.updateIdIndexMap();\n\t\tthis.containerObject.resumeDrawing();\n\n\t\tthis.sectionProperties.selectedComment = null;\n\t\tthis.checkSize();\n\t}\n\n\tprivate clearAutoSaveStatus () {\n\t\tCommentSection.autoSavedComment = null;\n\t\tCommentSection.commentWasAutoAdded = false;\n\t}\n\n\t// Remove only text comments from the document (excluding change tracking comments)\n\tprivate clearList (): void {\n\t\tthis.containerObject.pauseDrawing();\n\t\tfor (var i: number = this.sectionProperties.commentList.length -1; i > -1; i--) {\n\t\t\tif (!this.sectionProperties.commentList[i].sectionProperties.data.trackchange) {\n\t\t\t\tthis.containerObject.removeSection(this.sectionProperties.commentList[i].name);\n\t\t\t\tthis.sectionProperties.commentList.splice(i, 1);\n\t\t\t}\n\t\t}\n\t\tthis.updateIdIndexMap();\n\t\tthis.containerObject.resumeDrawing();\n\n\t\tthis.sectionProperties.selectedComment = null;\n\t\tthis.checkSize();\n\t\tthis.clearAutoSaveStatus();\n\t}\n\n\tpublic onCommentsDataUpdate(): void {\n\t\tfor (var i: number = this.sectionProperties.commentList.length -1; i > -1; i--) {\n\t\t\tvar comment = this.sectionProperties.commentList[i];\n\t\t\tif (!comment.valid && comment.sectionProperties.data.id !== 'new') {\n\t\t\t\tcomment.sectionProperties.commentListSection.removeItem(comment.sectionProperties.data.id);\n\t\t\t}\n\t\t\tcomment.onCommentDataUpdate();\n\t\t}\n\t}\n\n\tpublic rejectAllTrackedCommentChanges(): void {\n\t\tfor (var i = 0; i < this.sectionProperties.commentList.length; i++) {\n\t\t\tvar comment = this.sectionProperties.commentList[i];\n\t\t\tif (comment.sectionProperties.data.layoutStatus === CommentLayoutStatus.DELETED) {\n\t\t\t\tcomment.sectionProperties.data.layoutStatus = CommentLayoutStatus.VISIBLE;\n\t\t\t\tcomment.sectionProperties.container.classList.remove('tracked-deleted-comment-show');\n\t\t\t}\n\t\t}\n\t}\n\n\tpublic hasAnyComments(): boolean {\n\t\treturn this.sectionProperties.commentList.length > 0;\n\t}\n}\n\n}\n\napp.definitions.CommentSection = cool.CommentSection;\n"]}