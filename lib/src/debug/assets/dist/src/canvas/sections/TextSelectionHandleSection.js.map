{"version":3,"file":"TextSelectionHandleSection.js","sourceRoot":"","sources":["../../../../../../../../../../../TanhX/online/browser/src/canvas/sections/TextSelectionHandleSection.ts"],"names":[],"mappings":"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","sourcesContent":["// @ts-strict-ignore\n/* global Proxy _ */\n/*\n * Copyright the Collabora Online contributors.\n *\n * SPDX-License-Identifier: MPL-2.0\n *\n * This Source Code Form is subject to the terms of the Mozilla Public\n * License, v. 2.0. If a copy of the MPL was not distributed with this\n * file, You can obtain one at http://mozilla.org/MPL/2.0/.\n*/\n\nclass TextSelectionHandle extends HTMLObjectSection {\n\tpublic rectangle: cool.SimpleRectangle = null; // This is the rectangle sent from the core side.\n\n\tconstructor (sectionName: string, objectWidth: number, objectHeight: number, documentPosition: cool.SimplePoint,  extraClass: string = \"\", showSection: boolean = false) {\n\t\tsuper(sectionName, objectWidth, objectHeight, documentPosition, extraClass, showSection);\n\t}\n\n\tonDrag(point: number[]) {\n\t\t(<any>window).IgnorePanning = true;\n\t\tconst candidateX = Math.round((this.myTopLeft[0] + point[0]) / app.dpiScale);\n\t\tconst candidateY = Math.round((this.myTopLeft[1] + point[1]) / app.dpiScale);\n\n\t\tthis.sectionProperties.objectDiv.style.left = candidateX + 'px';\n\t\tthis.sectionProperties.objectDiv.style.top = candidateY + 'px';\n\n\t\tapp.map.fire('handleautoscroll', {pos: { x: candidateX, y: candidateY }, map: app.map});\n\t}\n\n\tsetOpacity(value: number) {\n\t\tthis.getHTMLObject().style.opacity = value;\n\t}\n\n\tonDragEnd(point: number[]) {\n\t\t(<any>window).IgnorePanning = undefined;\n\n\t\tlet x = this.position[0] + point[0];\n\t\tconst y = this.position[1] + point[1];\n\t\tthis.setPosition(x, y);\n\n\t\tapp.map.fire('scrollvelocity', {vx: 0, vy: 0});\n\t\tconst type = this.name === 'selection_start_handle' ? 'start' : 'end';\n\n\t\tif (type === 'start')\n\t\t\tx += 30 / app.dpiScale;\n\n\t\tif (!app.map._docLayer.isCalcRTL()) {\n\t\t\tapp.map._docLayer._postSelectTextEvent(type, Math.round(x * app.pixelsToTwips), Math.round(y * app.pixelsToTwips));\n\t\t}\n\t\telse {\n\t\t\tconst referenceX = app.file.viewedRectangle.pX1 + (app.file.viewedRectangle.pX2 - this.position[0]);\n\t\t\tapp.map._docLayer._postSelectTextEvent(type, Math.round(referenceX * app.pixelsToTwips), Math.round(y * app.pixelsToTwips));\n\t\t}\n\t}\n\n\tonMouseMove(point: number[], dragDistance: number[], e: MouseEvent): void {\n\t\te.stopPropagation();\n\t\tif (this.containerObject.isDraggingSomething()) {\n\t\t\tthis.stopPropagating();\n\t\t\tthis.onDrag(point);\n\t\t}\n\t}\n\n\tonDocumentObjectVisibilityChange(): void {\n\t\tif (this.showSection && this.isVisible)\n\t\t\tthis.sectionProperties.objectDiv.style.display = '';\n\t\telse\n\t\t\tthis.sectionProperties.objectDiv.style.display = 'none';\n\t}\n\n\tonClick(point: number[], e: MouseEvent): void {\n\t\te.stopPropagation();\n\t\tthis.stopPropagating();\n\t}\n\n\tonMouseDown(point: number[], e: MouseEvent): void {\n\t\te.stopPropagation();\n\t\tthis.stopPropagating();\n\t}\n\n\tonMouseUp(point: number[], e: MouseEvent): void {\n\t\te.stopPropagation();\n\t\tif (this.containerObject.isDraggingSomething()) {\n\t\t\tthis.stopPropagating();\n\t\t\tthis.onDragEnd(point);\n\t\t}\n\t}\n}\n\napp.definitions.textSelectionHandleSection = TextSelectionHandle;\n"]}