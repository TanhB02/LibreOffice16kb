{"version":3,"file":"ScrollSection.js","sourceRoot":"","sources":["../../../../../../../../../../../TanhX/online/browser/src/canvas/sections/ScrollSection.ts"],"names":[],"mappings":"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","sourcesContent":["// @ts-strict-ignore\n/* -*- js-indent-level: 8 -*- */\n\n/*\n * Copyright the Collabora Online contributors.\n *\n * SPDX-License-Identifier: MPL-2.0\n *\n * This Source Code Form is subject to the terms of the Mozilla Public\n * License, v. 2.0. If a copy of the MPL was not distributed with this\n * file, You can obtain one at http://mozilla.org/MPL/2.0/.\n */\n/* See CanvasSectionContainer.ts for explanations. */\n\n// We will keep below definitions until we use tsconfig.json.\ndeclare var L: any;\n\nnamespace cool {\n\nexport class ScrollSection extends CanvasSectionObject {\n\t// Scrolling animation constants. Unlabelled units are fractions of the line\n\t// height, so that they're somewhat DPI-independent.\n\tstatic readonly scrollAnimationAcceleration: number = 0.2;\n\tstatic readonly scrollAnimationMaxVelocity: number = 2.5;\n\tstatic readonly scrollAnimationMaxDelta: number = 75;\n\tstatic readonly scrollDirectTimeoutMs: number = 100;\n\n\t// The number of lines a scroll-wheel tick should travel\n\tstatic readonly scrollWheelDelta: number = 20;\n\n\tname: string = L.CSections.Scroll.name;\n\tprocessingOrder: number = L.CSections.Scroll.processingOrder\n\tdrawingOrder: number = L.CSections.Scroll.drawingOrder;\n\tzIndex: number = L.CSections.Scroll.zIndex;\n\twindowSection: boolean = true; // This section covers the entire canvas.\n\n\tmap: any;\n\tautoScrollTimer: any;\n\tpendingScrollEvent: any = null;\n\tstepByStepScrolling: boolean = false; // quick scroll will move \"page up/down\" not \"jump to\"\n\n\tisRTL: () => boolean;\n\n\tconstructor (isRTL?: () => boolean) {\n\t\tsuper();\n\n\t\tthis.map = L.Map.THIS;\n\n\t\tthis.isRTL = isRTL ?? (() => false);\n\n\t\tthis.map.on('scrollby', this.onScrollBy, this);\n\t\tthis.map.on('scrollvelocity', this.onScrollVelocity, this);\n\t\tthis.map.on('handleautoscroll', this.onHandleAutoScroll, this);\n\t}\n\n\tpublic onInitialize (): void {\n\t\tthis.sectionProperties.docLayer = this.map._docLayer;\n\t\tthis.sectionProperties.mapPane = (<HTMLElement>(document.querySelectorAll('.leaflet-map-pane')[0]));\n\t\tthis.sectionProperties.defaultCursorStyle = this.sectionProperties.mapPane.style.cursor;\n\n\t\tthis.sectionProperties.yMax = 0;\n\t\tthis.sectionProperties.yMin = 0;\n\t\tthis.sectionProperties.xMax = 0;\n\t\tthis.sectionProperties.xMin = 0;\n\n\t\tthis.sectionProperties.previousDragDistance = null;\n\n\t\tthis.sectionProperties.usableThickness = 20 * app.roundedDpiScale;\n\t\tthis.sectionProperties.scrollBarThickness = 6 * app.roundedDpiScale;\n\t\tthis.sectionProperties.edgeOffset = 0;\n\n\t\tthis.sectionProperties.drawScrollBarRailway = true;\n\t\tthis.sectionProperties.scrollBarRailwayThickness = 12 * app.roundedDpiScale;\n\t\tthis.sectionProperties.scrollBarRailwayAlpha = this.map._docLayer._docType === 'spreadsheet' ? 1.0 : 0.5;\n\t\tthis.sectionProperties.scrollBarRailwayColor = '#EFEFEF';\n\n\t\tthis.sectionProperties.drawVerticalScrollBar = ((<any>window).mode.isDesktop() ? true: false);\n\t\tthis.sectionProperties.drawHorizontalScrollBar = ((<any>window).mode.isDesktop() ? true: false);\n\n\t\tthis.sectionProperties.clickScrollVertical = false; // true when user presses on the scroll bar drawing.\n\t\tthis.sectionProperties.clickScrollHorizontal = false;\n\n\t\tthis.sectionProperties.mouseIsOnVerticalScrollBar = false;\n\t\tthis.sectionProperties.mouseIsOnHorizontalScrollBar = false;\n\n\t\tthis.sectionProperties.minimumScrollSize = 80 * app.roundedDpiScale;\n\n\t\tthis.sectionProperties.circleSliderRadius = 24 * app.roundedDpiScale; // Radius of the mobile vertical circular slider.\n\t\tthis.sectionProperties.arrowCornerLength = 10 * app.roundedDpiScale; // Corner length of the arrows inside circular slider.\n\n\t\t// Opacity.\n\t\tthis.sectionProperties.alphaWhenVisible = 0.5; // Scroll bar is visible but not being used.\n\t\tthis.sectionProperties.alphaWhenBeingUsed = 0.8; // Scroll bar is being used.\n\t\tthis.sectionProperties.currentAlpha = 1.0; // This variable will be updated while animating. When not animating, this will be equal to one of the above variables.\n\n\t\t// Durations.\n\t\tthis.sectionProperties.idleDuration = 2000; // In milliseconds. Scroll bar will be visible for this period of time after being used.\n\t\tthis.sectionProperties.fadeOutStartingTime = 1800; // After this period, scroll bar starts to disappear. This duration is included in \"idleDuration\".\n\t\tthis.sectionProperties.fadeOutDuration = this.sectionProperties.idleDuration - this.sectionProperties.fadeOutStartingTime;\n\n\t\tthis.sectionProperties.yOffset = 0;\n\t\tthis.sectionProperties.xOffset = 0;\n\n\t\tthis.sectionProperties.horizontalScrollRightOffset = this.sectionProperties.usableThickness * 2; // To prevent overlapping of the scroll bars.\n\n\t\tthis.sectionProperties.animatingVerticalScrollBar = false;\n\t\tthis.sectionProperties.animatingHorizontalScrollBar = false;\n\t\tthis.sectionProperties.animatingScroll = false;\n\n\t\tthis.sectionProperties.animateWheelScroll = (<any>window).mode.isDesktop();\n\t\tthis.sectionProperties.lastElapsedTime = 0;\n\t\tthis.sectionProperties.scrollAnimationDelta = [0, 0];\n\t\tthis.sectionProperties.scrollAnimationAcc = [0, 0];\n\t\tthis.sectionProperties.scrollAnimationVelocity = [0, 0];\n\t\tthis.sectionProperties.scrollAnimationDisableTimeout = null;\n\t\tthis.sectionProperties.scrollWheelDelta = [0, 0];\t// Used for non-animated scrolling\n\n\t\tthis.sectionProperties.pointerSyncWithVerticalScrollBar = true;\n\t\tthis.sectionProperties.pointerSyncWithHorizontalScrollBar = true;\n\t\tthis.sectionProperties.pointerReCaptureSpacer = null; // Clicked point of the scroll bar.\n\n\t\t// Step by step scrolling interval in ms\n\t\tthis.sectionProperties.stepDuration = 50;\n\t\tthis.sectionProperties.quickScrollHorizontalTimer = null;\n\n\t\t// Chrome's mouse-wheel events are extremely inconsistent between platforms and they don't\n\t\t// use the deltaMode property, so we need to apply heuristics to determine when a wheel event\n\t\t// comes from a mouse-wheel or a touchpad.\n\t\tthis.sectionProperties.scrollQuirks = true;\n\n\t\tthis.sectionProperties.moveMapBy = null; // Move map this amount [x, y] (CSS pixels) when updating the DOM.\n\t}\n\n\tpublic completePendingScroll(): void {\n\t\tif (this.pendingScrollEvent) {\n\t\t\tthis.onScrollTo(this.pendingScrollEvent, true /* force */);\n\t\t\tthis.pendingScrollEvent = null;\n\t\t}\n\t}\n\n\t// eslint-disable-next-line @typescript-eslint/explicit-module-boundary-types\n\tpublic onScrollTo (e: any, force: boolean = false): void {\n\t\tif (!force && !this.containerObject.drawingAllowed()) {\n\t\t\t// Only remember the last scroll-to position.\n\t\t\tthis.pendingScrollEvent = e;\n\t\t\treturn;\n\t\t}\n\t\t// Triggered by the document (e.g. search result out of the viewing area).\n\t\tif (this.map.panBy) {\n\t\t\tthis.moveMapBy(e.x - app.file.viewedRectangle.cX1, e.y - app.file.viewedRectangle.cY1, true);\n\t\t}\n\t}\n\n\tpublic moveMapBy(cX: number, cY: number, reset: boolean = false): void {\n\t\tif (this.sectionProperties.moveMapBy !== null) {\n\t\t\tthis.sectionProperties.moveMapBy[0] = reset === false ? this.sectionProperties.moveMapBy[0] + cX : cX;\n\t\t\tthis.sectionProperties.moveMapBy[1] = reset === false ? this.sectionProperties.moveMapBy[1] + cY : cY;\n\t\t}\n\t\telse {\n\t\t\tthis.sectionProperties.moveMapBy = [cX, cY];\n\t\t}\n\n\t\tthis.containerObject.requestReDraw();\n\t}\n\n\t// eslint-disable-next-line @typescript-eslint/explicit-module-boundary-types\n\tpublic onScrollBy (e: any): void {\n\t\tif (this.map._docLayer._docType !== 'spreadsheet') {\n\t\t\tthis.scrollVerticalWithOffset(e.y);\n\t\t\tthis.scrollHorizontalWithOffset(e.x);\n\t\t} else {\n\t\t\t// For Calc, top position shouldn't be below zero, for others, we can activate a similar check if needed (while keeping in mind that top position may be below zero for others).\n\t\t\tvar docTopLef = this.containerObject.getDocumentTopLeft();\n\n\t\t\t// Some early exits.\n\t\t\tif (e.y < 0 && docTopLef[1] === 0) // Don't scroll to negative values.\n\t\t\t\treturn;\n\n\t\t\tif (e.x < 0 && docTopLef[0] === 0)\n\t\t\t\treturn;\n\n\t\t\tvar diff = Math.round(e.y * app.dpiScale);\n\n\t\t\tif (docTopLef[1] + diff < 0) {\n\t\t\t\te.y = Math.round(-1 * docTopLef[1] / app.dpiScale);\n\t\t\t}\n\n\t\t\tdiff = Math.round(e.x * app.dpiScale);\n\t\t\tif (docTopLef[0] + diff < 0) {\n\t\t\t\te.x = Math.round(-1 * docTopLef[0] / app.dpiScale);\n\t\t\t}\n\n\t\t\tthis.moveMapBy(e.x, e.y);\n\t\t}\n\t}\n\n\t// eslint-disable-next-line @typescript-eslint/explicit-module-boundary-types\n\tpublic onScrollVelocity (e: any): void {\n\t\tif (e.vx === 0 && e.vy === 0) {\n\t\t\tclearInterval(this.autoScrollTimer);\n\t\t\tthis.autoScrollTimer = null;\n\t\t\tthis.map.isAutoScrolling = false;\n\t\t} else {\n\t\t\tclearInterval(this.autoScrollTimer);\n\t\t\tthis.map.isAutoScrolling = true;\n\t\t\tthis.autoScrollTimer = setInterval(L.bind(function() {\n\t\t\t\tthis.onScrollBy({x: e.vx, y: e.vy});\n\t\t\t\t// Unfortunately, dragging outside the map doesn't work for the map element.\n\t\t\t\t// We will keep this until we remove leaflet.\n\t\t\t\tif (L.Map.THIS.mouse\n\t\t\t\t&& L.Map.THIS.mouse._mouseDown\n\t\t\t\t&& this.containerObject.targetBoundSectionListContains(L.CSections.Tiles.name)\n\t\t\t\t&& (<any>window).mode.isDesktop()\n\t\t\t\t&& this.containerObject.isDraggingSomething()\n\t\t\t\t&& L.Map.THIS._docLayer._docType === 'spreadsheet') {\n\t\t\t\t\tvar temp = [e.pos.x, e.pos.y];\n\t\t\t\t\tvar tempPos = [(this.isRTL() ? this.map._size.x - temp[0] : temp[0]) * app.dpiScale, temp[1] * app.dpiScale];\n\t\t\t\t\tvar docTopLeft = app.sectionContainer.getDocumentTopLeft();\n\t\t\t\t\ttempPos = [tempPos[0] + docTopLeft[0], tempPos[1] + docTopLeft[1]];\n\t\t\t\t\ttempPos = [Math.round(tempPos[0] * app.pixelsToTwips), Math.round(tempPos[1] * app.pixelsToTwips)];\n\t\t\t\t\tL.Map.THIS._docLayer._postMouseEvent('move', tempPos[0], tempPos[1], 1, 1, 0);\n\t\t\t\t}\n\t\t\t}, this), 100);\n\t\t}\n\t}\n\n\t// eslint-disable-next-line @typescript-eslint/explicit-module-boundary-types\n\tpublic onHandleAutoScroll (e :any): void {\n\t\tvar vx = 0;\n\t\tvar vy = 0;\n\n\t\tif (e.pos.y > e.map._size.y - 50) {\n\t\t\tvy = 50;\n\t\t} else if (e.pos.y < 50 && e.map._getTopLeftPoint().y > 50) {\n\t\t\tvy = -50;\n\t\t}\n\n\t\tconst mousePosX: number = this.isRTL() ? e.map._size.x - e.pos.x : e.pos.x;\n\t\tconst mapLeft: number = this.isRTL() ? e.map._size.x - e.map._getTopLeftPoint().x : e.map._getTopLeftPoint().x;\n\t\tif (mousePosX > e.map._size.x - 50) {\n\t\t\tvx = 50;\n\t\t} else if (mousePosX < 50 && mapLeft > 50) {\n\t\t\tvx = -50;\n\t\t}\n\n\t\tthis.onScrollVelocity({ vx: vx, vy: vy, pos: e.pos });\n\t}\n\n\tprivate getVerticalScrollLength (): number {\n\t\tvar result: number = this.containerObject.getDocumentAnchorSection().size[1];\n\t\tthis.sectionProperties.yOffset = this.containerObject.getDocumentAnchorSection().myTopLeft[1];\n\n\t\tif (this.map._docLayer._docType !== 'spreadsheet') {\n\t\t\treturn result;\n\t\t}\n\t\telse {\n\t\t\tvar splitPanesContext: any = this.map.getSplitPanesContext();\n\t\t\tvar splitPos = {x: 0, y: 0};\n\t\t\tif (splitPanesContext) {\n\t\t\t\tsplitPos = splitPanesContext.getSplitPos().clone();\n\t\t\t\tsplitPos.y = Math.round(splitPos.y * app.dpiScale);\n\t\t\t}\n\n\t\t\tthis.sectionProperties.yOffset += splitPos.y;\n\t\t\treturn result - splitPos.y;\n\t\t}\n\t}\n\n\tprivate calculateVerticalScrollSize (scrollLength: number) :number {\n\t\tvar scrollSize = Math.round(scrollLength * scrollLength / app.view.size.pY);\n\t\treturn Math.round(scrollSize);\n\t}\n\n\tprivate calculateYMinMax () {\n\t\tvar diff: number = Math.round(app.view.size.pY - this.containerObject.getDocumentAnchorSection().size[1]);\n\n\t\tif (diff >= 0) {\n\t\t\tthis.sectionProperties.yMin = 0;\n\t\t\tthis.sectionProperties.yMax = diff;\n\t\t\tif ((<any>window).mode.isDesktop())\n\t\t\t\tthis.sectionProperties.drawVerticalScrollBar = true;\n\t\t}\n\t\telse {\n\t\t\tdiff = Math.round((app.view.size.pY - this.containerObject.getDocumentAnchorSection().size[1]) * 0.5);\n\t\t\tthis.sectionProperties.yMin = app.map.getDocType() === 'spreadsheet' ? 0 : diff;\n\t\t\tthis.sectionProperties.yMax = diff;\n\t\t\tif (app.view.size.pY > 0) {\n\t\t\t\tif (this.map._docLayer._docType !== 'spreadsheet' || !(<any>window).mode.isDesktop())\n\t\t\t\t\tthis.sectionProperties.drawVerticalScrollBar = false;\n\t\t\t}\n\t\t}\n\t}\n\n\t// eslint-disable-next-line @typescript-eslint/explicit-module-boundary-types\n\tpublic getVerticalScrollProperties (): any {\n\t\tthis.calculateYMinMax();\n\t\tvar result: any = {};\n\t\tresult.scrollLength = this.getVerticalScrollLength(); // The length of the railway that the scroll bar moves on up & down.\n\t\tresult.scrollSize = this.calculateVerticalScrollSize(result.scrollLength); // Size of the scroll bar.\n\n\t\tif (result.scrollSize < this.sectionProperties.minimumScrollSize) {\n\t\t\tvar diff: number = this.sectionProperties.minimumScrollSize - result.scrollSize;\n\t\t\tresult.scrollLength -= diff;\n\t\t\tresult.scrollSize = this.sectionProperties.minimumScrollSize;\n\t\t}\n\n\t\tresult.ratio = app.view.size.pY / result.scrollLength; // 1px scrolling = xpx document height.\n\t\tresult.startY = Math.round(this.documentTopLeft[1] / result.ratio + this.sectionProperties.yOffset);\n\n\t\tresult.verticalScrollStep = this.size[1] / 2;\n\n\t\treturn result;\n\t}\n\n\tprivate getHorizontalScrollLength (): number {\n\t\tvar result: number = this.containerObject.getDocumentAnchorSection().size[0];\n\t\tthis.sectionProperties.xOffset = this.containerObject.getDocumentAnchorSection().myTopLeft[0];\n\n\t\tif (this.map._docLayer._docType !== 'spreadsheet') {\n\t\t\treturn result - this.sectionProperties.horizontalScrollRightOffset;\n\t\t}\n\t\telse {\n\t\t\tvar splitPanesContext: any = this.map.getSplitPanesContext();\n\t\t\tvar splitPos = {x: 0, y: 0};\n\t\t\tif (splitPanesContext) {\n\t\t\t\tsplitPos = splitPanesContext.getSplitPos().clone();\n\t\t\t\tsplitPos.x = Math.round(splitPos.x * app.dpiScale);\n\t\t\t}\n\n\t\t\tthis.sectionProperties.xOffset += splitPos.x;\n\t\t\treturn result - splitPos.x - this.sectionProperties.horizontalScrollRightOffset;\n\t\t}\n\t}\n\n\tprivate calculateHorizontalScrollSize (scrollLength: number): number {\n\t\tvar scrollSize = Math.round(scrollLength * scrollLength / app.view.size.pX);\n\t\treturn scrollSize;\n\t}\n\n\tprivate calculateXMinMax (): void {\n\t\tvar diff: number = Math.round(app.view.size.pX - this.containerObject.getDocumentAnchorSection().size[0]);\n\n\t\tif (diff >= 0) {\n\t\t\tthis.sectionProperties.xMin = 0;\n\t\t\tthis.sectionProperties.xMax = diff;\n\t\t\tif ((<any>window).mode.isDesktop())\n\t\t\t\tthis.sectionProperties.drawHorizontalScrollBar = true;\n\t\t}\n\t\telse {\n\t\t\tdiff = Math.round((app.view.size.pX - this.containerObject.getDocumentAnchorSection().size[0]) * 0.5);\n\t\t\tthis.sectionProperties.xMin = diff;\n\t\t\tthis.sectionProperties.xMax = diff;\n\t\t\tif (app.view.size.pX >  0) {\n\t\t\t\tif (this.map._docLayer._docType !== 'spreadsheet' || !(<any>window).mode.isDesktop())\n\t\t\t\t\tthis.sectionProperties.drawHorizontalScrollBar = false;\n\t\t\t}\n\t\t}\n\t}\n\n\t// eslint-disable-next-line @typescript-eslint/explicit-module-boundary-types\n\tpublic getHorizontalScrollProperties (): any {\n\t\tthis.calculateXMinMax();\n\t\tvar result: any = {};\n\t\tresult.scrollLength = this.getHorizontalScrollLength(); // The length of the railway that the scroll bar moves on left & right.\n\t\tresult.scrollSize = this.calculateHorizontalScrollSize(result.scrollLength); // Width of the scroll bar.\n\n\t\tif (result.scrollSize < this.sectionProperties.minimumScrollSize) {\n\t\t\tvar diff: number = this.sectionProperties.minimumScrollSize - result.scrollSize;\n\t\t\tresult.scrollLength -= diff;\n\t\t\tresult.scrollSize = this.sectionProperties.minimumScrollSize;\n\t\t}\n\n\t\tresult.ratio = app.view.size.pX / result.scrollLength;\n\t\tresult.startX = Math.round(this.documentTopLeft[0] / result.ratio + this.sectionProperties.xOffset);\n\n\t\tresult.horizontalScrollStep = this.size[0] / 2;\n\n\t\treturn result;\n\t}\n\n\tpublic onUpdateScrollOffset (): void {\n\t\tif (this.map._docLayer._docType === 'spreadsheet') {\n\t\t\tthis.map._docLayer.refreshViewData();\n\t\t\tthis.map._docLayer._restrictDocumentSize();\n\t\t}\n\t}\n\n\tprivate DrawVerticalScrollBarMobile (): void {\n\t\tvar scrollProps: any = this.getVerticalScrollProperties();\n\n\t\tif (this.sectionProperties.animatingVerticalScrollBar)\n\t\t\tthis.context.globalAlpha = this.sectionProperties.currentAlpha;\n\t\telse\n\t\t\tthis.context.globalAlpha = this.sectionProperties.clickScrollVertical ? this.sectionProperties.alphaWhenBeingUsed: this.sectionProperties.alphaWhenVisible;\n\n\t\tthis.context.strokeStyle = '#7E8182';\n\t\tthis.context.fillStyle = 'white';\n\n\t\tvar circleStartY = scrollProps.startY + this.sectionProperties.circleSliderRadius;\n\t\tvar circleStartX = this.isRTL()\n\t\t\t? this.sectionProperties.circleSliderRadius * 0.5\n\t\t\t: this.size[0] - this.sectionProperties.circleSliderRadius * 0.5;\n\n\t\tthis.context.beginPath();\n\t\tthis.context.arc(circleStartX, circleStartY, this.sectionProperties.circleSliderRadius, 0, Math.PI * 2, true);\n\t\tthis.context.fill();\n\t\tthis.context.stroke();\n\n\t\tthis.context.fillStyle = '#7E8182';\n\t\tthis.context.beginPath();\n\t\tvar x: number = circleStartX - this.sectionProperties.arrowCornerLength * 0.5;\n\t\tvar y: number = circleStartY - 5 * app.roundedDpiScale;\n\t\tthis.context.moveTo(x, y);\n\t\tx += this.sectionProperties.arrowCornerLength;\n\t\tthis.context.lineTo(x, y);\n\t\tx -= this.sectionProperties.arrowCornerLength * 0.5;\n\t\ty -= Math.sin(Math.PI / 3) * this.sectionProperties.arrowCornerLength;\n\t\tthis.context.lineTo(x, y);\n\t\tx -= this.sectionProperties.arrowCornerLength * 0.5;\n\t\ty += Math.sin(Math.PI / 3) * this.sectionProperties.arrowCornerLength;\n\t\tthis.context.lineTo(x, y);\n\t\tthis.context.fill();\n\n\t\tx = circleStartX - this.sectionProperties.arrowCornerLength * 0.5;\n\t\ty = circleStartY + 5 * app.roundedDpiScale;\n\t\tthis.context.moveTo(x, y);\n\t\tx += this.sectionProperties.arrowCornerLength;\n\t\tthis.context.lineTo(x, y);\n\t\tx -= this.sectionProperties.arrowCornerLength * 0.5;\n\t\ty += Math.sin(Math.PI / 3) * this.sectionProperties.arrowCornerLength;\n\t\tthis.context.lineTo(x, y);\n\t\tx -= this.sectionProperties.arrowCornerLength * 0.5;\n\t\ty -= Math.sin(Math.PI / 3) * this.sectionProperties.arrowCornerLength;\n\t\tthis.context.lineTo(x, y);\n\t\tthis.context.fill();\n\n\t\tthis.context.globalAlpha = 1.0;\n\t}\n\n\tprivate drawVerticalScrollBar (): void {\n\t\tvar scrollProps: any = this.getVerticalScrollProperties();\n\t\tconst isDarkBackground = this.map.uiManager.isBackgroundDark();\n\t\tconst docType = this.sectionProperties.docLayer._docType;\n\n\t\tvar startX = this.isRTL() ? this.sectionProperties.edgeOffset : this.size[0] - this.sectionProperties.scrollBarThickness - this.sectionProperties.edgeOffset;\n\n\t\tif (isDarkBackground && (docType === 'text' || docType === 'drawing')) {\n\t\t\tthis.sectionProperties.scrollBarRailwayColor = 'transparent';\n\t\t}\n\n\t\tif (this.sectionProperties.drawScrollBarRailway) {\n\t\t\tthis.context.globalAlpha = this.sectionProperties.scrollBarRailwayAlpha;\n\t\t\tthis.context.fillStyle = this.sectionProperties.scrollBarRailwayColor;\n\t\t\tthis.context.fillRect(\n\t\t\t\tstartX,\n\t\t\t\tthis.sectionProperties.yMin + this.sectionProperties.yOffset,\n\t\t\t\tthis.sectionProperties.scrollBarRailwayThickness,\n\t\t\t\tthis.sectionProperties.yMax - this.sectionProperties.yMin - this.sectionProperties.yOffset\n\t\t\t);\n\t\t}\n\n\t\tif (this.sectionProperties.animatingVerticalScrollBar) {\n\t\t\tthis.context.globalAlpha = this.sectionProperties.currentAlpha;\n\t\t} else {\n\t\t\tthis.context.globalAlpha = this.sectionProperties.clickScrollVertical ? this.sectionProperties.alphaWhenBeingUsed: this.sectionProperties.alphaWhenVisible;\n\t\t}\n\n\t\tthis.context.fillStyle = '#7E8182';\n\n\n\t\tthis.context.fillRect(startX, scrollProps.startY, this.sectionProperties.scrollBarThickness, scrollProps.scrollSize - this.sectionProperties.scrollBarThickness);\n\n\t\tthis.context.globalAlpha = 1.0;\n\n\t\tif (this.containerObject.testing) {\n\t\t\tvar element: HTMLDivElement = <HTMLDivElement>document.getElementById('test-div-vertical-scrollbar');\n\t\t\tif (!element) {\n\t\t\t\telement = document.createElement('div');\n\t\t\t\telement.id = 'test-div-vertical-scrollbar';\n\t\t\t\tdocument.body.appendChild(element);\n\t\t\t}\n\t\t\telement.textContent = String(scrollProps.startY);\n\t\t\telement.style.display = 'none';\n\t\t\telement.style.position = 'fixed';\n\t\t\telement.style.zIndex = '-1';\n\t\t}\n\t}\n\n\tprivate drawHorizontalScrollBar (): void {\n\t\tvar scrollProps: any = this.getHorizontalScrollProperties();\n\n\t\tvar startY = this.size[1] - this.sectionProperties.scrollBarThickness - this.sectionProperties.edgeOffset;\n\n\t\tconst sizeX = scrollProps.scrollSize - this.sectionProperties.scrollBarThickness;\n\t\tconst docWidth: number = this.map.getPixelBoundsCore().getSize().x;\n\t\tconst startX = this.isRTL() ? docWidth - scrollProps.startX - sizeX : scrollProps.startX;\n\n\t\tif (this.sectionProperties.drawScrollBarRailway) {\n\t\t\tthis.context.globalAlpha = this.sectionProperties.scrollBarRailwayAlpha;\n\t\t\tthis.context.fillStyle = this.sectionProperties.scrollBarRailwayColor;\n\t\t\tthis.context.fillRect(\n\t\t\t\tthis.sectionProperties.xMin + this.sectionProperties.xOffset,\n\t\t\t\tstartY,\n\t\t\t\tthis.sectionProperties.xMax - this.sectionProperties.xMin - this.sectionProperties.xOffset,\n\t\t\t\tthis.sectionProperties.scrollBarRailwayThickness\n\t\t\t);\n\t\t}\n\n\t\tif (this.sectionProperties.animatingHorizontalScrollBar)\n\t\t\tthis.context.globalAlpha = this.sectionProperties.currentAlpha;\n\t\telse\n\t\t\tthis.context.globalAlpha = this.sectionProperties.clickScrollHorizontal ? this.sectionProperties.alphaWhenBeingUsed: this.sectionProperties.alphaWhenVisible;\n\n\t\tthis.context.fillStyle = '#7E8182';\n\n\n\t\tthis.context.fillRect(startX, startY, sizeX, this.sectionProperties.scrollBarThickness);\n\n\t\tthis.context.globalAlpha = 1.0;\n\n\t\tif (this.containerObject.testing) {\n\t\t\tvar element: HTMLDivElement = <HTMLDivElement>document.getElementById('test-div-horizontal-scrollbar');\n\t\t\tif (!element) {\n\t\t\t\telement = document.createElement('div');\n\t\t\t\telement.id = 'test-div-horizontal-scrollbar';\n\t\t\t\tdocument.body.appendChild(element);\n\t\t\t}\n\t\t\telement.textContent = String(scrollProps.startX);\n\t\t\telement.style.display = 'none';\n\t\t\telement.style.position = 'fixed';\n\t\t\telement.style.zIndex = '-1';\n\t\t}\n\n\t}\n\n\tprivate calculateCurrentAlpha (elapsedTime: number): void {\n\t\tif (elapsedTime >= this.sectionProperties.fadeOutStartingTime) {\n\t\t\tthis.sectionProperties.currentAlpha = Math.max((1 - ((elapsedTime - this.sectionProperties.fadeOutStartingTime) / this.sectionProperties.fadeOutDuration)) * this.sectionProperties.alphaWhenVisible, 0.1);\n\t\t}\n\t\telse {\n\t\t\tthis.sectionProperties.currentAlpha = this.sectionProperties.alphaWhenVisible;\n\t\t}\n\t}\n\n\tpublic onDraw (frameCount: number, elapsedTime: number): void {\n\t\tif (this.isAnimating && frameCount >= 0)\n\t\t\tthis.calculateCurrentAlpha(elapsedTime);\n\n\t\tif ((this.sectionProperties.drawVerticalScrollBar || this.sectionProperties.animatingVerticalScrollBar)) {\n\t\t\tif ((<any>window).mode.isMobile())\n\t\t\t\tthis.DrawVerticalScrollBarMobile();\n\t\t\telse\n\t\t\t\tthis.drawVerticalScrollBar();\n\t\t}\n\n\t\tif ((this.sectionProperties.drawHorizontalScrollBar || this.sectionProperties.animatingHorizontalScrollBar)) {\n\t\t\tthis.drawHorizontalScrollBar();\n\t\t}\n\n\t\tif (this.sectionProperties.moveMapBy !== null) {\n\t\t\tthis.map.panBy(new L.Point(this.sectionProperties.moveMapBy[0], this.sectionProperties.moveMapBy[1]));\n\t\t\tthis.sectionProperties.moveMapBy = null;\n\t\t\tthis.onUpdateScrollOffset();\n\n\t\t\tif (app && app.file.fileBasedView === true)\n\t\t\t\tapp.map._docLayer._checkSelectedPart();\n\t\t}\n\t}\n\n\tpublic onAnimate(frameCount: number, elapsedTime: number): void {\n\t\tif (this.sectionProperties.animatingScroll) {\n\t\t\tconst lineHeight = this.containerObject.getScrollLineHeight();\n\t\t\t// Smoothness will be affected by Firefox bug #1967935\n\t\t\tconst timeDelta = (elapsedTime - this.sectionProperties.lastElapsedTime) / (1000/60);\n\t\t\tconst accel = lineHeight * ScrollSection.scrollAnimationAcceleration * timeDelta * app.dpiScale;\n\t\t\tconst maxVelocity = lineHeight * ScrollSection.scrollAnimationMaxVelocity * timeDelta * app.dpiScale;\n\t\t\tconst maxDelta = lineHeight * ScrollSection.scrollAnimationMaxDelta * app.dpiScale;\n\n\t\t\t// Calculate horizontal and vertical scroll deltas for this animation step\n\t\t\tconst deltas = [0, 0];\n\t\t\tfor (let i = 0; i < 2; ++i) {\n\t\t\t\tthis.sectionProperties.scrollAnimationAcc[i] += this.sectionProperties.scrollAnimationDelta[i];\n\t\t\t\tthis.sectionProperties.scrollAnimationDelta[i] = 0;\n\n\t\t\t\t// Don't let the accumulated delta get too big, or the user will be able to\n\t\t\t\t// accumulate a long scrolling animation and it'd feel weird.\n\t\t\t\tconst sign = this.sectionProperties.scrollAnimationAcc[i] > 0 ? 1 : -1;\n\t\t\t\tif (Math.abs(this.sectionProperties.scrollAnimationAcc[i]) > maxDelta)\n\t\t\t\t\tthis.sectionProperties.scrollAnimationAcc[i] = sign * maxDelta;\n\t\t\t\tthis.sectionProperties.scrollAnimationVelocity[i] += accel * sign;\n\n\t\t\t\tdeltas[i] = Math.round(Math.min(Math.abs(this.sectionProperties.scrollAnimationVelocity[i]), maxVelocity) * sign);\n\t\t\t\tif (Math.abs(deltas[i]) >= Math.abs(this.sectionProperties.scrollAnimationAcc[i])) {\n\t\t\t\t\tdeltas[i] = this.sectionProperties.scrollAnimationAcc[i];\n\t\t\t\t\tthis.sectionProperties.scrollAnimationAcc[i] = 0;\n\t\t\t\t\tthis.sectionProperties.scrollAnimationVelocity[i] = 0;\n\t\t\t\t} else\n\t\t\t\t\tthis.sectionProperties.scrollAnimationAcc[i] -= deltas[i];\n\t\t\t}\n\n\t\t\t// Perform scrolling, if necessary\n\t\t\tif (deltas[0] !== 0)\n\t\t\t\tthis.scrollHorizontalWithOffset(deltas[0]);\n\t\t\tif (deltas[1] !== 0)\n\t\t\t\tthis.scrollVerticalWithOffset(deltas[1]);\n\t\t} else {\n\t\t\tif (this.sectionProperties.scrollWheelDelta[0] !== 0) {\n\t\t\t\tconst delta = this.sectionProperties.scrollWheelDelta[0];\n\t\t\t\tthis.sectionProperties.scrollWheelDelta[0] = 0;\n\t\t\t\tthis.scrollHorizontalWithOffset(delta);\n\t\t\t}\n\t\t\tif (this.sectionProperties.scrollWheelDelta[1] !== 0) {\n\t\t\t\tconst delta = this.sectionProperties.scrollWheelDelta[1];\n\t\t\t\tthis.sectionProperties.scrollWheelDelta[1] = 0;\n\t\t\t\tthis.scrollVerticalWithOffset(delta);\n\t\t\t}\n\t\t}\n\n\t\tthis.sectionProperties.lastElapsedTime = elapsedTime;\n\n\t\tconst animatingScrollbar =\n\t\t\t(this.sectionProperties.animatingHorizontalScrollBar\n\t\t\t|| this.sectionProperties.animatingVerticalScrollBar) &&\n\t\t\telapsedTime && (elapsedTime < this.sectionProperties.fadeOutDuration);\n\t\tconst animatingScroll = this.sectionProperties.animatingScroll\n\t\t\t&& this.sectionProperties.scrollAnimationAcc.reduce((a: number, x: number) => a + x, 0) !== 0;\n\t\tif (!animatingScrollbar && !animatingScroll) this.containerObject.stopAnimating();\n\t}\n\n\tpublic onAnimationEnded (frameCount: number, elapsedTime: number): void {\n\t\tthis.sectionProperties.animatingVerticalScrollBar = false;\n\t\tthis.sectionProperties.animatingHorizontalScrollBar = false;\n\t\tthis.sectionProperties.animatingScroll = false;\n\t\tthis.sectionProperties.scrollAnimationAcc = [0, 0];\n\t\tthis.sectionProperties.scrollAnimationVelocity = [0, 0];\n\t}\n\n\tprivate fadeOutHorizontalScrollBar (): void {\n\t\tif (this.isAnimating) {\n\t\t\tthis.resetAnimation();\n\t\t\tthis.sectionProperties.animatingHorizontalScrollBar = true;\n\t\t}\n\t\telse {\n\t\t\tvar options: any = {\n\t\t\t\tduration: this.sectionProperties.idleDuration,\n\t\t\t};\n\n\t\t\tthis.sectionProperties.animatingHorizontalScrollBar = this.startAnimating(options);\n\t\t}\n\t}\n\n\tprivate fadeOutVerticalScrollBar (): void {\n\t\tif (this.isAnimating) {\n\t\t\tthis.resetAnimation();\n\t\t\tthis.sectionProperties.animatingVerticalScrollBar = true;\n\t\t}\n\t\telse {\n\t\t\tvar options: any = {\n\t\t\t\tduration: this.sectionProperties.idleDuration,\n\t\t\t};\n\n\t\t\tthis.sectionProperties.animatingVerticalScrollBar = this.startAnimating(options);\n\t\t}\n\t}\n\n\tprivate increaseScrollBarThickness () : void {\n\t\tthis.sectionProperties.scrollBarThickness = 8 * app.roundedDpiScale;\n\t\tthis.containerObject.requestReDraw();\n\t}\n\n\tprivate decreaseScrollBarThickness () : void {\n\t\tthis.sectionProperties.scrollBarThickness = 6 * app.roundedDpiScale;\n\t\tthis.containerObject.requestReDraw();\n\t}\n\n\tprivate hideVerticalScrollBar (): void {\n\t\tif (this.sectionProperties.mouseIsOnVerticalScrollBar) {\n\t\t\tthis.sectionProperties.mouseIsOnVerticalScrollBar = false;\n\t\t\tthis.sectionProperties.mapPane.style.cursor = this.sectionProperties.defaultCursorStyle;\n\n\t\t\tthis.decreaseScrollBarThickness();\n\n\t\t\tif (!(<any>window).mode.isDesktop()) { // On desktop, we don't want to hide the vertical scroll bar.\n\t\t\t\tthis.sectionProperties.drawVerticalScrollBar = false;\n\t\t\t\tthis.fadeOutVerticalScrollBar();\n\t\t\t}\n\n\t\t\t// just in case if we have blinking cursor visible\n\t\t\t// we need to change cursor from default style\n\t\t\tif (this.map._docLayer._cursorMarker)\n\t\t\t\tthis.map._docLayer._cursorMarker.setMouseCursor();\n\t\t}\n\t}\n\n\tprivate showVerticalScrollBar (): void {\n\t\tif (this.isAnimating && this.sectionProperties.animatingVerticalScrollBar)\n\t\t\tthis.containerObject.stopAnimating();\n\n\t\tif (!this.sectionProperties.mouseIsOnVerticalScrollBar) {\n\t\t\tthis.sectionProperties.drawVerticalScrollBar = true;\n\t\t\tthis.sectionProperties.mouseIsOnVerticalScrollBar = true;\n\t\t\tthis.sectionProperties.mapPane.style.cursor = 'pointer';\n\n\t\t\t// Prevent Instant Mouse hover\n\t\t\tsetTimeout(() => {\n\t\t\t\tif (this.sectionProperties.mouseIsOnVerticalScrollBar) {\n\t\t\t\t\tthis.increaseScrollBarThickness();\n\t\t\t\t}\n\t\t\t}, 100);\n\n\t\t\tif (!this.containerObject.isDraggingSomething() && !(<any>window).mode.isDesktop())\n\t\t\t\tthis.containerObject.requestReDraw();\n\t\t}\n\t}\n\n\tprivate hideHorizontalScrollBar (): void {\n\t\tif (this.sectionProperties.mouseIsOnHorizontalScrollBar) {\n\t\t\tthis.sectionProperties.mouseIsOnHorizontalScrollBar = false;\n\t\t\tthis.sectionProperties.mapPane.style.cursor = this.sectionProperties.defaultCursorStyle;\n\n\t\t\tthis.decreaseScrollBarThickness();\n\n\t\t\tif (!(<any>window).mode.isDesktop()) {\n\t\t\t\tthis.sectionProperties.drawHorizontalScrollBar = false;\n\t\t\t\tthis.fadeOutHorizontalScrollBar();\n\t\t\t}\n\n\t\t\t// just in case if we have blinking cursor visible\n\t\t\t// we need to change cursor from default style\n\t\t\tif (this.map._docLayer._cursorMarker)\n\t\t\t\tthis.map._docLayer._cursorMarker.setMouseCursor();\n\t\t}\n\t}\n\n\tprivate showHorizontalScrollBar (): void {\n\t\tif (this.isAnimating && this.sectionProperties.animatingHorizontalScrollBar)\n\t\t\tthis.containerObject.stopAnimating();\n\n\t\tif (!this.sectionProperties.mouseIsOnHorizontalScrollBar) {\n\t\t\tthis.sectionProperties.drawHorizontalScrollBar = true;\n\t\t\tthis.sectionProperties.mouseIsOnHorizontalScrollBar = true;\n\t\t\tthis.sectionProperties.mapPane.style.cursor = 'pointer';\n\n\t\t\t// Prevent Instant Mouse hover\n\t\t\tsetTimeout(() => {\n\t\t\t\tif (this.sectionProperties.mouseIsOnHorizontalScrollBar) {\n\t\t\t\t\tthis.increaseScrollBarThickness();\n\t\t\t\t}\n\t\t\t}, 100);\n\n\t\t\tif (!this.containerObject.isDraggingSomething() && !(<any>window).mode.isDesktop())\n\t\t\t\tthis.containerObject.requestReDraw();\n\t\t}\n\t}\n\n\tprivate isMouseOnScrollBar (point: Array<number>): void {\n\t\tconst mirrorX = this.isRTL();\n\t\tif (this.documentTopLeft[1] >= 0) {\n\t\t\tif ((!mirrorX && point[0] >= this.size[0] - this.sectionProperties.usableThickness)\n\t\t\t\t|| (mirrorX && point[0] <= this.sectionProperties.usableThickness)) {\n\t\t\t\tif (point[1] > this.sectionProperties.yOffset) {\n\t\t\t\t\tthis.showVerticalScrollBar();\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tthis.hideVerticalScrollBar();\n\t\t\t\t}\n\t\t\t}\n\t\t\telse {\n\t\t\t\tthis.hideVerticalScrollBar();\n\t\t\t}\n\t\t}\n\n\t\tif (this.documentTopLeft[0] >= 0) {\n\t\t\tif (point[1] >= this.size[1] - this.sectionProperties.usableThickness) {\n\t\t\t\tif ((!mirrorX && point[0] <= this.size[0] - this.sectionProperties.horizontalScrollRightOffset && point[0] >= this.sectionProperties.xOffset)\n\t\t\t\t\t|| (mirrorX && point[0] >= this.sectionProperties.horizontalScrollRightOffset && point[0] >= this.sectionProperties.xOffset)) {\n\t\t\t\t\tthis.showHorizontalScrollBar();\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tthis.hideHorizontalScrollBar();\n\t\t\t\t}\n\t\t\t}\n\t\t\telse {\n\t\t\t\tthis.hideHorizontalScrollBar();\n\t\t\t}\n\t\t}\n\t}\n\n\tpublic onMouseLeave (): void {\n\t\tthis.hideVerticalScrollBar();\n\t\tthis.hideHorizontalScrollBar();\n\t}\n\n\tpublic scrollVerticalWithOffset (offset: number): boolean {\n\t\tthis.calculateYMinMax();\n\n\t\tif (offset > 0) {\n\t\t\tif (this.documentTopLeft[1] + offset > this.sectionProperties.yMax)\n\t\t\t\toffset = this.sectionProperties.yMax - this.documentTopLeft[1];\n\t\t\tif (offset <= 0)\n\t\t\t\treturn false;\n\t\t}\n\t\telse {\n\t\t\tif (this.documentTopLeft[1] + offset < this.sectionProperties.yMin)\n\t\t\t\toffset = this.sectionProperties.yMin - this.documentTopLeft[1];\n\t\t\tif (offset >= 0)\n\t\t\t\treturn false;\n\t\t}\n\n\t\tthis.moveMapBy(0, offset / app.dpiScale);\n\n\t\tif (app.file.fileBasedView) this.map._docLayer._checkSelectedPart();\n\n\t\tif (!this.sectionProperties.drawVerticalScrollBar) {\n\t\t\tif (this.isAnimating) {\n\t\t\t\tthis.resetAnimation();\n\t\t\t\tthis.sectionProperties.animatingVerticalScrollBar = true;\n\t\t\t}\n\t\t\telse\n\t\t\t\tthis.fadeOutVerticalScrollBar();\n\t\t}\n\n\t\treturn true;\n\t}\n\n\tpublic scrollHorizontalWithOffset (offset: number): boolean {\n\t\tthis.calculateXMinMax();\n\n\t\tif (this.isRTL()) offset = -offset;\n\n\t\tif (offset > 0) {\n\t\t\tif (this.documentTopLeft[0] + offset > this.sectionProperties.xMax)\n\t\t\t\toffset = this.sectionProperties.xMax - this.documentTopLeft[0];\n\t\t\tif (offset <= 0)\n\t\t\t\treturn false;\n\t\t}\n\t\telse {\n\t\t\tif (this.documentTopLeft[0] + offset < this.sectionProperties.xMin)\n\t\t\t\toffset = this.sectionProperties.xMin - this.documentTopLeft[0];\n\t\t\tif (offset >= 0)\n\t\t\t\treturn false;\n\t\t}\n\n\t\tthis.moveMapBy(offset / app.dpiScale, 0);\n\n\t\tif (!this.sectionProperties.drawHorizontalScrollBar) {\n\t\t\tif (this.isAnimating) {\n\t\t\t\tthis.resetAnimation();\n\t\t\t\tthis.sectionProperties.animatingHorizontalScrollBar = true;\n\t\t\t}\n\t\t\telse\n\t\t\t\tthis.fadeOutHorizontalScrollBar();\n\t\t}\n\n\t\treturn true;\n\t}\n\n\tprivate isMouseInsideDocumentAnchor (point: Array<number>): boolean {\n\t\tvar docSection = this.containerObject.getDocumentAnchorSection();\n\t\treturn this.containerObject.doesSectionIncludePoint(docSection, point);\n\t}\n\n\t// eslint-disable-next-line @typescript-eslint/explicit-module-boundary-types\n\tprivate isMousePointerSyncedWithVerticalScrollBar (scrollProps: any, position: Array<number>): boolean {\n\t\t// Keep this desktop-only for now.\n\t\tif (!(<any>window).mode.isDesktop())\n\t\t\treturn true;\n\n\t\tvar spacer = 0;\n\t\tif (!this.sectionProperties.pointerSyncWithVerticalScrollBar) {\n\t\t\tspacer = this.sectionProperties.pointerReCaptureSpacer;\n\t\t}\n\n\t\tvar pointerIsSyncWithScrollBar = false;\n\t\tif (this.sectionProperties.pointerSyncWithVerticalScrollBar) {\n\t\t\tpointerIsSyncWithScrollBar = scrollProps.startY < position[1] && scrollProps.startY + scrollProps.scrollSize - this.sectionProperties.scrollBarThickness > position[1];\n\t\t\tpointerIsSyncWithScrollBar = pointerIsSyncWithScrollBar || (this.isMouseInsideDocumentAnchor(position) && spacer === 0);\n\t\t}\n\t\telse {\n\t\t\t// See if the scroll bar is on top or bottom.\n\t\t\tvar docAncSectionY = this.containerObject.getDocumentAnchorSection().myTopLeft[1];\n\t\t\tif (scrollProps.startY < 30 * window.app.roundedDpiScale + docAncSectionY) {\n\t\t\t\tpointerIsSyncWithScrollBar = scrollProps.startY + spacer < position[1];\n\t\t\t}\n\t\t\telse {\n\t\t\t\tpointerIsSyncWithScrollBar = scrollProps.startY + spacer > position[1];\n\t\t\t}\n\t\t}\n\n\t\tthis.sectionProperties.pointerSyncWithVerticalScrollBar = pointerIsSyncWithScrollBar;\n\t\treturn pointerIsSyncWithScrollBar;\n\t}\n\n\t// eslint-disable-next-line @typescript-eslint/explicit-module-boundary-types\n\tprivate isMousePointerSyncedWithHorizontalScrollBar (scrollProps: any, position: Array<number>): boolean {\n\t\t// Keep this desktop-only for now.\n\t\tif (!(<any>window).mode.isDesktop())\n\t\t\treturn true;\n\n\t\tvar spacer = 0;\n\t\tif (!this.sectionProperties.pointerSyncWithHorizontalScrollBar) {\n\t\t\tspacer = this.sectionProperties.pointerReCaptureSpacer;\n\t\t}\n\n\t\tconst sizeX = scrollProps.scrollSize - this.sectionProperties.scrollBarThickness;\n\t\tconst docWidth: number = this.map.getPixelBoundsCore().getSize().x;\n\t\tconst startX = this.isRTL() ? docWidth - scrollProps.startX - sizeX : scrollProps.startX;\n\t\tconst endX = startX + sizeX;\n\n\t\tvar pointerIsSyncWithScrollBar = false;\n\t\tif (this.sectionProperties.pointerSyncWithHorizontalScrollBar) {\n\t\t\tpointerIsSyncWithScrollBar = position[0] > startX && position[0] < endX;\n\t\t\tpointerIsSyncWithScrollBar = pointerIsSyncWithScrollBar || (this.isMouseInsideDocumentAnchor(position) && spacer === 0);\n\t\t}\n\t\telse {\n\t\t\t// See if the scroll bar is on left or right.\n\t\t\tvar docAncSectionX = this.containerObject.getDocumentAnchorSection().myTopLeft[0];\n\t\t\tif (startX < 30 * window.app.roundedDpiScale + docAncSectionX) {\n\t\t\t\tpointerIsSyncWithScrollBar = startX + spacer < position[0];\n\t\t\t}\n\t\t\telse {\n\t\t\t\tpointerIsSyncWithScrollBar = startX + spacer > position[0];\n\t\t\t}\n\t\t}\n\n\t\tthis.sectionProperties.pointerSyncWithHorizontalScrollBar = pointerIsSyncWithScrollBar;\n\t\treturn pointerIsSyncWithScrollBar;\n\t}\n\n\tpublic onMouseMove (position: Array<number>, dragDistance: Array<number>, e: MouseEvent): void {\n\t\tthis.clearQuickScrollTimeout();\n\n\t\tif (this.sectionProperties.clickScrollVertical && this.containerObject.isDraggingSomething()) {\n\t\t\tif (!this.sectionProperties.previousDragDistance) {\n\t\t\t\tthis.sectionProperties.previousDragDistance = [0, 0];\n\t\t\t}\n\n\t\t\tthis.showVerticalScrollBar();\n\n\t\t\tvar scrollProps: any = this.getVerticalScrollProperties();\n\n\t\t\tvar diffY: number = dragDistance[1] - this.sectionProperties.previousDragDistance[1];\n\t\t\tvar actualDistance = scrollProps.ratio * diffY;\n\n\t\t\tif (this.isMousePointerSyncedWithVerticalScrollBar(scrollProps, position))\n\t\t\t\tthis.scrollVerticalWithOffset(actualDistance);\n\n\t\t\tthis.sectionProperties.previousDragDistance[1] = dragDistance[1];\n\n\t\t\te.stopPropagation(); // Don't propagate to map.\n\t\t\tthis.stopPropagating(); // Don't propagate to bound sections.\n\t\t}\n\t\telse if (this.sectionProperties.clickScrollHorizontal && this.containerObject.isDraggingSomething()) {\n\t\t\tif (!this.sectionProperties.previousDragDistance) {\n\t\t\t\tthis.sectionProperties.previousDragDistance = [0, 0];\n\t\t\t}\n\n\t\t\tthis.showHorizontalScrollBar();\n\n\t\t\tvar scrollProps: any = this.getHorizontalScrollProperties();\n\t\t\tvar diffX: number = dragDistance[0] - this.sectionProperties.previousDragDistance[0];\n\t\t\tvar actualDistance = scrollProps.ratio * diffX;\n\n\t\t\tif (this.isMousePointerSyncedWithHorizontalScrollBar(scrollProps, position))\n\t\t\t\tthis.scrollHorizontalWithOffset(actualDistance);\n\n\t\t\tthis.sectionProperties.previousDragDistance[0] = dragDistance[0];\n\t\t\te.stopPropagation(); // Don't propagate to map.\n\t\t\tthis.stopPropagating(); // Don't propagate to bound sections.\n\t\t}\n\t\telse {\n\t\t\tthis.isMouseOnScrollBar(position);\n\t\t}\n\t}\n\n\t/*\n\t\tWhen user presses the button while the mouse pointer is on the railway of the scroll bar but not on the scroll bar directly,\n\t\twe quickly scroll the document to that position.\n\t*/\n\tprivate quickScrollVertical (point: Array<number>, originalSign?: number): void {\n\t\t// Desktop only for now.\n\t\tif (!(<any>window).mode.isDesktop())\n\t\t\treturn;\n\n\t\tL.DomUtil.addClass(document.documentElement, 'prevent-select');\n\t\tvar props = this.getVerticalScrollProperties();\n\t\tvar midY = (props.startY + props.startY + props.scrollSize - this.sectionProperties.scrollBarThickness) * 0.5;\n\n\t\tif (this.stepByStepScrolling) {\n\t\t\tvar sign = (point[1] - (props.startY + props.scrollSize)) > 0\n\t\t\t\t? 1 : ((point[1] - props.startY) < 0 ? -1 : 0);\n\t\t\tvar offset = props.verticalScrollStep * sign;\n\n\t\t\tif (this.sectionProperties.quickScrollVerticalTimer)\n\t\t\t\tclearTimeout(this.sectionProperties.quickScrollVerticalTimer);\n\t\t\tif (this.sectionProperties.clickScrollVertical)\n\t\t\t\tthis.sectionProperties.quickScrollVerticalTimer = setTimeout(() => {\n\t\t\t\t\tif (!originalSign || originalSign === sign) {\n\t\t\t\t\t\tthis.quickScrollVertical(point, sign);\n\t\t\t\t\t}\n\t\t\t\t}, this.sectionProperties.stepDuration);\n\t\t} else {\n\t\t\toffset = Math.round((point[1] - midY) * props.ratio);\n\t\t}\n\n\t\tthis.scrollVerticalWithOffset(offset);\n\t}\n\n\t/*\n\t\tWhen user presses the button while the mouse pointer is on the railway of the scroll bar but not on the scroll bar directly,\n\t\twe quickly scroll the document to that position.\n\t*/\n\tprivate quickScrollHorizontal (point: Array<number>, originalSign?: number): void {\n\t\t// Desktop only for now.\n\t\tif (!(<any>window).mode.isDesktop())\n\t\t\treturn;\n\n\t\tL.DomUtil.addClass(document.documentElement, 'prevent-select');\n\t\tvar props = this.getHorizontalScrollProperties();\n\t\tconst sizeX = props.scrollSize - this.sectionProperties.scrollBarThickness;\n\t\tconst docWidth: number = this.map.getPixelBoundsCore().getSize().x;\n\t\tconst startX = this.isRTL() ? docWidth - props.startX - sizeX : props.startX;\n\t\tvar midX = startX + sizeX * 0.5;\n\n\t\tif (this.stepByStepScrolling) {\n\t\t\tvar sign = (point[0] - (startX + sizeX)) > 0\n\t\t\t\t? 1 : ((point[0] - startX) < 0 ? -1 : 0);\n\t\t\tvar offset = props.horizontalScrollStep * sign;\n\n\t\t\tif (this.sectionProperties.quickScrollHorizontalTimer)\n\t\t\t\tclearTimeout(this.sectionProperties.quickScrollHorizontalTimer);\n\t\t\tif (this.sectionProperties.clickScrollHorizontal)\n\t\t\t\tthis.sectionProperties.quickScrollHorizontalTimer = setTimeout(() => {\n\t\t\t\t\tif (!originalSign || originalSign === sign) {\n\t\t\t\t\t\tthis.quickScrollHorizontal(point, sign);\n\t\t\t\t\t}\n\t\t\t\t}, this.sectionProperties.stepDuration);\n\t\t} else {\n\t\t\toffset = Math.round((point[0] - midX) * props.ratio);\n\t\t}\n\n\t\tthis.scrollHorizontalWithOffset(offset);\n\t}\n\n\tprivate getLocalYOnVerticalScrollBar (point: Array<number>): number {\n\t\tvar props = this.getVerticalScrollProperties();\n\t\treturn point[1] - props.startY;\n\t}\n\n\tprivate getLocalXOnHorizontalScrollBar (point: Array<number>): number {\n\t\tvar props = this.getHorizontalScrollProperties();\n\t\treturn point[0] - props.startX;\n\t}\n\n\tprivate clearQuickScrollTimeout() {\n\t\tif (this.sectionProperties.quickScrollVerticalTimer) {\n\t\t\tclearTimeout(this.sectionProperties.quickScrollVerticalTimer);\n\t\t\tthis.sectionProperties.quickScrollVerticalTimer = null;\n\t\t}\n\t\tif (this.sectionProperties.quickScrollHorizontalTimer) {\n\t\t\tclearTimeout(this.sectionProperties.quickScrollHorizontalTimer);\n\t\t\tthis.sectionProperties.quickScrollHorizontalTimer = null;\n\t\t}\n\t}\n\n\tpublic onMouseDown (point: Array<number>, e: MouseEvent): void {\n\t\tthis.clearQuickScrollTimeout();\n\t\tthis.onMouseMove(point, null, e);\n\t\tthis.isMouseOnScrollBar(point);\n\n\t\tconst mirrorX = this.isRTL();\n\n\t\tif (this.documentTopLeft[1] >= 0) {\n\t\t\tif ((!mirrorX && point[0] >= this.size[0] - this.sectionProperties.usableThickness)\n\t\t\t\t|| (mirrorX && point[0] <= this.sectionProperties.usableThickness)) {\n\t\t\t\tif (point[1] > this.sectionProperties.yOffset) {\n\t\t\t\t\tthis.sectionProperties.clickScrollVertical = true;\n\t\t\t\t\tthis.map.scrollingIsHandled = true;\n\t\t\t\t\tthis.quickScrollVertical(point);\n\t\t\t\t\tthis.sectionProperties.pointerReCaptureSpacer = this.getLocalYOnVerticalScrollBar(point);\n\t\t\t\t\te.stopPropagation(); // Don't propagate to map.\n\t\t\t\t\tthis.stopPropagating(); // Don't propagate to bound sections.\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tthis.sectionProperties.clickScrollVertical = false;\n\t\t\t\t}\n\t\t\t}\n\t\t\telse {\n\t\t\t\tthis.sectionProperties.clickScrollVertical = false;\n\t\t\t}\n\t\t}\n\n\t\tif (this.documentTopLeft[0] >= 0) {\n\t\t\tif (point[1] >= this.size[1] - this.sectionProperties.usableThickness) {\n\t\t\t\tif ((!mirrorX && point[0] >= this.sectionProperties.xOffset && point[0] <= this.size[0] - this.sectionProperties.horizontalScrollRightOffset)\n\t\t\t\t\t|| (mirrorX && point[0] >= this.sectionProperties.xOffset && point[0] >= this.sectionProperties.horizontalScrollRightOffset)) {\n\t\t\t\t\tthis.sectionProperties.clickScrollHorizontal = true;\n\t\t\t\t\tthis.map.scrollingIsHandled = true;\n\t\t\t\t\tthis.quickScrollHorizontal(point);\n\t\t\t\t\tthis.sectionProperties.pointerReCaptureSpacer = this.getLocalXOnHorizontalScrollBar(point);\n\t\t\t\t\te.stopPropagation(); // Don't propagate to map.\n\t\t\t\t\tthis.stopPropagating(); // Don't propagate to bound sections.\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tthis.sectionProperties.clickScrollHorizontal = false;\n\t\t\t\t}\n\t\t\t}\n\t\t\telse {\n\t\t\t\tthis.sectionProperties.clickScrollHorizontal = false;\n\t\t\t}\n\t\t}\n\t}\n\n\tpublic onMouseUp (point: Array<number>, e: MouseEvent): void {\n\t\tL.DomUtil.removeClass(document.documentElement, 'prevent-select');\n\t\tthis.map.scrollingIsHandled = false;\n\t\tthis.clearQuickScrollTimeout();\n\n\t\tif (this.sectionProperties.clickScrollVertical) {\n\t\t\te.stopPropagation(); // Don't propagate to map.\n\t\t\tthis.stopPropagating(); // Don't propagate to bound sections.\n\t\t\tthis.sectionProperties.clickScrollVertical = false;\n\t\t\tthis.sectionProperties.pointerSyncWithVerticalScrollBar = true; // Default.\n\t\t}\n\t\telse if (this.sectionProperties.clickScrollHorizontal) {\n\t\t\te.stopPropagation(); // Don't propagate to map.\n\t\t\tthis.stopPropagating(); // Don't propagate to bound sections.\n\t\t\tthis.sectionProperties.clickScrollHorizontal = false;\n\t\t\tthis.sectionProperties.pointerSyncWithHorizontalScrollBar = true; // Default.\n\t\t}\n\n\t\t// Unfortunately, dragging outside the map doesn't work for the map element.\n\t\t// We will keep this until we remove leaflet.\n\t\telse if (L.Map.THIS.mouse && L.Map.THIS.mouse._mouseDown\n\t\t\t&& this.containerObject.targetBoundSectionListContains(L.CSections.Tiles.name)\n\t\t\t&& (<any>window).mode.isDesktop()\n\t\t\t&& this.containerObject.isDraggingSomething()\n\t\t\t&& L.Map.THIS._docLayer._docType === 'spreadsheet') {\n\n\t\t\tvar temp = this.containerObject.getPositionOnMouseUp();\n\t\t\tvar tempPos = [temp[0] * app.dpiScale, temp[1] * app.dpiScale];\n\t\t\tvar docTopLeft = app.sectionContainer.getDocumentTopLeft();\n\t\t\ttempPos = [tempPos[0] + docTopLeft[0], tempPos[1] + docTopLeft[1]];\n\t\t\ttempPos = [Math.round(tempPos[0] * app.pixelsToTwips), Math.round(tempPos[1] * app.pixelsToTwips)];\n\t\t\tthis.onScrollVelocity({ vx: 0, vy: 0 }); // Cancel auto scrolling.\n\t\t\tL.Map.THIS.mouse._mouseDown = false;\n\t\t\tL.Map.THIS._docLayer._postMouseEvent('buttonup', tempPos[0], tempPos[1], 1, 1, 0);\n\t\t}\n\n\t\tthis.sectionProperties.previousDragDistance = null;\n\t\tthis.onMouseMove(point, null, e);\n\t}\n\n\tpublic onClick(point: Array<number>, e: MouseEvent): void {\n\t\tif (this.isAnimating && this.sectionProperties.animatingWheelScrollVertical)\n\t\t\tthis.containerObject.stopAnimating();\n\t}\n\n\tprivate animateScroll(delta: [number, number]): void {\n\t\tconst lineHeight = this.containerObject.getScrollLineHeight();\n\n\t\tfor (let i = 0; i < 2; ++i) {\n\t\t\tif (Math.abs(delta[i]) === 0) continue;\n\n\t\t\tif ((delta[i] > 0) !== (this.sectionProperties.scrollAnimationAcc[i] > 0)) {\n\t\t\t\t// Stop animation on scroll change direction\n\t\t\t\tthis.sectionProperties.scrollAnimationVelocity[i] = 0;\n\t\t\t\tthis.sectionProperties.scrollAnimationAcc[i] = 0;\n\t\t\t}\n\n\t\t\tconst sign = delta[i] > 0 ? 1 : -1;\n\t\t\tthis.sectionProperties.scrollAnimationDelta[i] =\n\t\t\t\tlineHeight * ScrollSection.scrollWheelDelta * sign * app.dpiScale;\n\t\t}\n\n\t\tif (!this.sectionProperties.animatingScroll) {\n\t\t\tthis.sectionProperties.animatingScroll = true;\n\t\t\tthis.sectionProperties.lastElapsedTime = 0;\n\t\t\t// We're about to start a duration-less animation, so we need to\n\t\t\t// ensure the animation is reset.\n\t\t\tif (!this.startAnimating({ 'defer': true })) this.resetAnimation();\n\t\t}\n\t}\n\n\tpublic onMouseWheel (point: Array<number>, delta: Array<number>, e: WheelEvent): void {\n\t\tif (e.ctrlKey) return;\n\n\t\tthis.map.fire('closepopups'); // close all popups when scrolling\n\n\t\tlet hscroll = 0, vscroll = 0;\n\t\tif (Math.abs(delta[1]) > Math.abs(delta[0])) {\n\t\t\tif (e.shiftKey)\n\t\t\t\thscroll = delta[1];\n\t\t\telse\n\t\t\t\tvscroll = delta[1];\n\t\t} else\n\t\t\thscroll = delta[0];\n\n\t\tlet shouldAnimate = this.sectionProperties.animateWheelScroll\n\t\t\t&& !this.sectionProperties.scrollAnimationDisableTimeout;\n\n\t\t// We don't want to animate in the case of touchpad events. There is no\n\t\t// completely browser/OS-agnostic way of determining if a wheel event was\n\t\t// generated by a touchpad or a mouse-wheel.\n\t\tif (shouldAnimate) {\n\t\t\tif (this.sectionProperties.scrollQuirks) {\n\t\t\t\t// Firefox sends line scroll events for the mouse-wheel and pixel events\n\t\t\t\t// for the touch-pad. If we receive a non-pixel mousewheel scroll, we know\n\t\t\t\t// that we can rely on this and disable other heuristics that may cause\n\t\t\t\t// false-positives.\n\t\t\t\tif (e.deltaMode !== WheelEvent.DOM_DELTA_PIXEL)\n\t\t\t\t\tthis.sectionProperties.scrollQuirks = false;\n\t\t\t\telse if (e.deltaX !== 0 && e.deltaY !== 0) {\n\t\t\t\t\t// It's not a mouse-wheel if both components are non-zero. I suppose it's\n\t\t\t\t\t// theoretically possible to scroll in both directions at once with a wheel,\n\t\t\t\t\t// but very difficult.\n\t\t\t\t\tshouldAnimate = false;\n\t\t\t\t} else {\n\t\t\t\t\tconst nowIsAccurate = performance.now() % 1 !== 0;\n\t\t\t\t\tconst hasFractionalComponent = (e.deltaX % 1 !== 0) || (e.deltaY % 1 !== 0);\n\t\t\t\t\tconst deltaMaybeDiscrete = Math.abs((e as any).wheelDelta) % 60 === 0;\n\n\t\t\t\t\tif (hasFractionalComponent && (!nowIsAccurate || !deltaMaybeDiscrete)) {\n\t\t\t\t\t\t// Firefox touchpad deltas always seem to have a fractional\n\t\t\t\t\t\t// component on Linux, but this is also true of wheel events for\n\t\t\t\t\t\t// Chrome on Mac.\n\t\t\t\t\t\t// To distinguish Firefox from Chrome, we can use the fact that\n\t\t\t\t\t\t// Firefox performance.now() is rounded to a whole number and that\n\t\t\t\t\t\t// the wheelDelta on Mac will be discrete.\n\t\t\t\t\t\tshouldAnimate = false;\n\t\t\t\t\t} else if (nowIsAccurate && !deltaMaybeDiscrete) {\n\t\t\t\t\t\t// In Chrome, performance.now can (and usually does) have a\n\t\t\t\t\t\t// fractional component. We can use this to single it out, then\n\t\t\t\t\t\t// check if the delta is discrete. This would indicate the event\n\t\t\t\t\t\t// was generated by a mouse-wheel.\n\t\t\t\t\t\tshouldAnimate = false;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else\n\t\t\t\tshouldAnimate = e.deltaMode !== WheelEvent.DOM_DELTA_PIXEL;\n\t\t}\n\n\t\thscroll *= app.dpiScale;\n\t\tvscroll *= app.dpiScale;\n\n\t\tif (shouldAnimate)\n\t\t\tthis.animateScroll([hscroll, vscroll]);\n\t\telse {\n\t\t\tthis.sectionProperties.animatingScroll = false;\n\n\t\t\tif (this.sectionProperties.scrollAnimationDisableTimeout)\n\t\t\t\tclearTimeout(this.sectionProperties.scrollAnimationDisableTimeout);\n\t\t\tthis.sectionProperties.scrollAnimationDisableTimeout =\n\t\t\t\tsetTimeout(() => { this.sectionProperties.scrollAnimationDisableTimeout = null; },\n\t\t\t\t\tScrollSection.scrollDirectTimeoutMs);\n\n\t\t\tthis.sectionProperties.scrollWheelDelta[0] += hscroll;\n\t\t\tthis.sectionProperties.scrollWheelDelta[1] += vscroll;\n\n\t\t\tif (!this.isAnimating) this.startAnimating({});\n\t\t}\n\t}\n}\n\n}\n\nL.getNewScrollSection = function (isRTL?: () => boolean) {\n\treturn new cool.ScrollSection(isRTL);\n};\n"]}