{"version":3,"file":"OtherViewGraphicSelectionSection.js","sourceRoot":"","sources":["../../../../../../../../../../../TanhX/online/browser/src/canvas/sections/OtherViewGraphicSelectionSection.ts"],"names":[],"mappings":"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","sourcesContent":["/* -*- js-indent-level: 8 -*- */\n\n/*\n * Copyright the Collabora Online contributors.\n *\n * SPDX-License-Identifier: MPL-2.0\n *\n * This Source Code Form is subject to the terms of the Mozilla Public\n * License, v. 2.0. If a copy of the MPL was not distributed with this\n * file, You can obtain one at http://mozilla.org/MPL/2.0/.\n */\n\n// This is used for other views' graphic selections.\n\nclass OtherViewGraphicSelectionSection extends CanvasSectionObject {\n    documentObject: boolean = true;\n    interactable: boolean = false; // We don't bother with events.\n    zIndex: number = L.CSections.DefaultForDocumentObjects.processingOrder;\n    drawingOrder: number = L.CSections.DefaultForDocumentObjects.drawingOrder;\n    processingOrder: number = L.CSections.DefaultForDocumentObjects.processingOrder;\n\n    static sectionNamePrefix = 'OtherViewGraphicSelection ';\n    static sectionPointers: Array<OtherViewGraphicSelectionSection> = [];\n\n    constructor(viewId: number, rectangle: cool.SimpleRectangle, part: number, mode: number) {\n        super();\n\n        this.size = [rectangle.pWidth, rectangle.pHeight];\n        this.position = [rectangle.pX1, rectangle.pY1];\n        this.sectionProperties.color = app.LOUtil.rgbToHex(app.LOUtil.getViewIdColor(viewId));\n        this.name = OtherViewGraphicSelectionSection.sectionNamePrefix + viewId;\n\n        this.sectionProperties.viewId = viewId;\n        this.sectionProperties.part = part;\n        this.sectionProperties.mode = mode;\n    }\n\n    onDraw(frameCount?: number, elapsedTime?: number): void {\n        this.context.strokeStyle = this.sectionProperties.color;\n        this.context.lineWidth = 2;\n        this.context.strokeRect(-0.5, -0.5, this.size[0], this.size[1]);\n    }\n\n    checkMyVisibility() {\n        let result = this.size[0] > 0 && this.size[1] > 0;\n\n        if (result) {\n            if (!app.map._docLayer.isWriter()) {\n                if (this.sectionProperties.part !== app.map._docLayer._selectedPart || this.sectionProperties.mode !== app.map._docLayer._selectedMode)\n                    result = false;\n            }\n        }\n        return result;\n    }\n\n    public static addOrUpdateGraphicSelectionIndicator(viewId: number, rectangleData: Array<string>, part: number, mode: number) {\n        let rectangle = new cool.SimpleRectangle(0, 0, 0, 0);\n        if (rectangleData)\n            rectangle = new app.definitions.simpleRectangle(parseInt(rectangleData[0]), parseInt(rectangleData[1]), parseInt(rectangleData[2]), parseInt(rectangleData[3]));\n\n        const sectionName = OtherViewGraphicSelectionSection.sectionNamePrefix + viewId;\n        let section: OtherViewGraphicSelectionSection;\n        if (app.sectionContainer.doesSectionExist(sectionName)) {\n            section = app.sectionContainer.getSectionWithName(sectionName) as OtherViewGraphicSelectionSection;\n            section.sectionProperties.part = part;\n            section.sectionProperties.mode = mode;\n            section.size[0] = rectangle.pWidth;\n            section.size[1] = rectangle.pHeight;\n            section.setPosition(rectangle.pX1, rectangle.pY1);\n        }\n        else {\n            section = new OtherViewGraphicSelectionSection(viewId, rectangle, part, mode);\n            app.sectionContainer.addSection(section);\n            OtherViewGraphicSelectionSection.sectionPointers.push(section);\n        }\n\n        section.setShowSection(section.checkMyVisibility());\n        app.sectionContainer.requestReDraw();\n    }\n\n    public static removeView(viewId: number) {\n        const sectionName = OtherViewGraphicSelectionSection.sectionNamePrefix + viewId;\n        if (app.sectionContainer.doesSectionExist(sectionName)) {\n            const section = app.sectionContainer.getSectionWithName(sectionName) as OtherViewGraphicSelectionSection;\n            OtherViewGraphicSelectionSection.sectionPointers.splice(OtherViewGraphicSelectionSection.sectionPointers.indexOf(section), 1);\n            app.sectionContainer.removeSection(sectionName);\n            app.sectionContainer.requestReDraw();\n        }\n    }\n\n    public static updateVisibilities() {\n        for (let i = 0; i < OtherViewGraphicSelectionSection.sectionPointers.length; i++) {\n            const section = OtherViewGraphicSelectionSection.sectionPointers[i];\n            section.setShowSection(section.checkMyVisibility());\n        }\n        app.sectionContainer.requestReDraw();\n    }\n}\n\napp.definitions.otherViewGraphicSelectionSection = OtherViewGraphicSelectionSection;\n"]}