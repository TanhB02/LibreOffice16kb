{"version":3,"file":"CursorHeaderSection.js","sourceRoot":"","sources":["../../../../../../../../../../../TanhX/online/browser/src/canvas/sections/CursorHeaderSection.ts"],"names":[],"mappings":"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","sourcesContent":["// @ts-strict-ignore\n/* -*- js-indent-level: 8 -*- */\n\n/*\n * Copyright the Collabora Online contributors.\n *\n * SPDX-License-Identifier: MPL-2.0\n *\n * This Source Code Form is subject to the terms of the Mozilla Public\n * License, v. 2.0. If a copy of the MPL was not distributed with this\n * file, You can obtain one at http://mozilla.org/MPL/2.0/.\n */\n\nclass CursorHeaderSection extends HTMLObjectSection {\n    static namePrefix: string = 'CursorHeader ';\n    static duration = 3000;\n\n    constructor(viewId: number, username: string, documentPosition: cool.SimplePoint, color: string) {\n        super(CursorHeaderSection.namePrefix + viewId, null, null, documentPosition);\n\n        this.sectionProperties.deletionTimeout = null;\n        this.sectionProperties.viewId = viewId;\n        this.sectionProperties.color = color;\n        this.sectionProperties.username = username;\n\n        const div = this.getHTMLObject();\n\n        div.textContent = username;\n        div.style.color = 'white';\n        div.style.backgroundColor = color;\n    }\n\n    deleteThis(force: boolean = false) { // Also resets the timer if it is initiated.\n        if (this.sectionProperties.deletionTimeout)\n            clearTimeout(this.sectionProperties.deletionTimeout);\n\n        this.sectionProperties.deletionTimeout = setTimeout(() => {\n            app.sectionContainer.removeSection(this.name);\n        }, (force ? 10: CursorHeaderSection.duration));\n    }\n\n    // This section is for text cursor username popups in Calc. When we want to remove the popup before it times out, we use this function.\n    public static deletePopUpNow(viewId: number) {\n        // If cursor header is also shown, delete it.\n        const name = CursorHeaderSection.namePrefix + viewId;\n        if (app.sectionContainer.doesSectionExist(name)) {\n            const section: CursorHeaderSection = app.sectionContainer.getSectionWithName(name) as CursorHeaderSection;\n            section.deleteThis(true);\n        }\n    }\n\n    public static showCursorHeader(viewId: number, username: string, documentPosition: cool.SimplePoint, color: string) {\n        const sectionName = CursorHeaderSection.namePrefix + viewId;\n        let section;\n\n        if (viewId && !username) { // This should be an update, section should exist.\n            section = app.sectionContainer.getSectionWithName(sectionName);\n            if (section)\n                section.deleteThis();\n        }\n        else {\n            section = app.sectionContainer.getSectionWithName(sectionName);\n\n            if (!section) {\n                section = new CursorHeaderSection(viewId, username, documentPosition, color);\n                app.sectionContainer.addSection(section);\n            }\n\n            section.setPosition(documentPosition.pX, documentPosition.pY);\n            section.deleteThis();\n        }\n\n        // If this is calc and cell cursor username popup is shown, hide it.\n        if (app.map._docLayer._docType === 'spreadsheet') {\n            const cellCursorSection = OtherViewCellCursorSection.getViewCursorSection(viewId) as OtherViewCellCursorSection;\n            if (cellCursorSection)\n                cellCursorSection.hideUsernamePopUp();\n        }\n    }\n}\n\napp.definitions.cursorHeaderSection = CursorHeaderSection;\n"]}