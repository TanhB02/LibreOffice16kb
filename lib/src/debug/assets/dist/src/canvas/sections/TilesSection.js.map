{"version":3,"file":"TilesSection.js","sourceRoot":"","sources":["../../../../../../../../../../../TanhX/online/browser/src/canvas/sections/TilesSection.ts"],"names":[],"mappings":"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","sourcesContent":["// @ts-strict-ignore\n/* -*- tab-width: 4 -*- */\n\n/*\n * Copyright the Collabora Online contributors.\n *\n * SPDX-License-Identifier: MPL-2.0\n *\n * This Source Code Form is subject to the terms of the Mozilla Public\n * License, v. 2.0. If a copy of the MPL was not distributed with this\n * file, You can obtain one at http://mozilla.org/MPL/2.0/.\n */\n/* See CanvasSectionContainer.ts for explanations. */\n\ndeclare var L: any;\n\nnamespace cool {\n\nexport class TilesSection extends CanvasSectionObject {\n\tname: string = L.CSections.Tiles.name;\n\n\t// Below anchor list may be expanded. For example, Writer may have ruler section. Then ruler section should also be added here.\n\tanchor: any = [[L.CSections.ColumnHeader.name, 'bottom', 'top'], [L.CSections.RowHeader.name, 'right', 'left']];\n\texpand: any = ['top', 'left', 'bottom', 'right'];\n\tprocessingOrder: number = L.CSections.Tiles.processingOrder;\n\tdrawingOrder: number = L.CSections.Tiles.drawingOrder;\n\tzIndex: number = L.CSections.Tiles.zIndex;\n\n\tmap: any;\n\tisJSDOM: boolean = false; // testing\n\tcheckpattern: any;\n\n\tconstructor () {\n\t\tsuper();\n\n\t\tthis.map = L.Map.THIS;\n\n\t\tthis.sectionProperties.docLayer = this.map._docLayer;\n\t\tthis.sectionProperties.tsManager = this.sectionProperties.docLayer._painter;\n\t\tthis.sectionProperties.pageBackgroundInnerMargin = 0; // In core pixels. We don't want backgrounds to have exact same borders with tiles for not making them visible when tiles are rendered.\n\t\tthis.sectionProperties.pageBackgroundBorderColor = 'lightgrey';\n\t\tthis.sectionProperties.pageBackgroundTextColor = 'grey';\n\t\tthis.sectionProperties.pageBackgroundFont = String(40 * app.roundedDpiScale) + 'px Arial';\n\n\t\tthis.isJSDOM = typeof window === 'object' && window.name === 'nodejs';\n\n\t\tthis.checkpattern = this.makeCheckPattern();\n\t}\n\n\tprivate makeCheckPattern() {\n\t\tvar canvas = document.createElement('canvas');\n\t\tcanvas.width = 256;\n\t\tcanvas.height = 256;\n\t\tvar drawctx = canvas.getContext('2d');\n\t\tvar patternOn = true;\n\t\tfor (var y = 0; y < 256; y+=32) {\n\t\t\tfor (var x = 0; x < 256; x+=32) {\n\t\t\t\tif (patternOn)\n\t\t\t\t\tdrawctx.fillStyle = 'darkgray';\n\t\t\t\telse\n\t\t\t\t\tdrawctx.fillStyle = 'gray';\n\t\t\t\tpatternOn = !patternOn;\n\t\t\t\tdrawctx.fillRect(x, y, 32, 32);\n\t\t\t}\n\t\t\tpatternOn = !patternOn;\n\t\t}\n\t\treturn canvas;\n\t}\n\n\t// eslint-disable-next-line @typescript-eslint/explicit-module-boundary-types\n\tpaintWithPanes (tile: any, ctx: any, async: boolean): void {\n\t\tvar tileTopLeft = tile.coords.getPos();\n\t\tvar tileBounds = new L.Bounds(tileTopLeft, tileTopLeft.add(new L.Point(TileManager.tileSize, TileManager.tileSize)));\n\n\t\tfor (var i = 0; i < ctx.paneBoundsList.length; ++i) {\n\t\t\t// co-ordinates of this pane in core document pixels\n\t\t\tvar paneBounds = ctx.paneBoundsList[i];\n\t\t\t// co-ordinates of the main-(bottom right) pane in core document pixels\n\t\t\tvar viewBounds = ctx.viewBounds;\n\n\t\t\t// into real pixel-land ...\n\t\t\tpaneBounds.round();\n\t\t\tviewBounds.round();\n\n\t\t\tif (paneBounds.intersects(tileBounds)) {\n\t\t\t\tvar paneOffset = paneBounds.getTopLeft(); // allocates\n\t\t\t\t// Cute way to detect the in-canvas pixel offset of each pane\n\t\t\t\tpaneOffset.x = Math.min(paneOffset.x, viewBounds.min.x);\n\t\t\t\tpaneOffset.y = Math.min(paneOffset.y, viewBounds.min.y);\n\n\t\t\t\tthis.drawTileInPane(tile, tileBounds, paneBounds, paneOffset, this.context, async);\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate beforeDraw(canvasCtx: CanvasRenderingContext2D): void {\n\t\tconst mirrorTile: boolean = this.isCalcRTL();\n\t\tif (mirrorTile) {\n\t\t\tcanvasCtx.save();\n\t\t\tcanvasCtx.translate(this.size[0], 0);\n\t\t\tcanvasCtx.scale(-1, 1);\n\t\t}\n\t}\n\n\tprivate afterDraw(canvasCtx: CanvasRenderingContext2D): void {\n\t\tconst mirrorTile: boolean = this.isCalcRTL();\n\t\tif (mirrorTile) {\n\t\t\tcanvasCtx.restore();\n\t\t}\n\t}\n\n\t// the bounding box of this set of tiles\n\tpublic getSubsetBounds(canvasCtx: CanvasRenderingContext2D, tileSubset: Set<any>): cool.Bounds {\n\n\t\t// don't do anything for this atypical variant\n\t\tif (app.file.fileBasedView)\n\t\t\treturn null;\n\n\t\tvar ctx = this.sectionProperties.tsManager._paintContext();\n\n\t\tvar bounds: cool.Bounds;\n\t\tfor (const coords of Array.from(tileSubset)) {\n\t\t\tvar topLeft = new L.Point(coords.getPos().x, coords.getPos().y);\n\t\t\tvar rightBottom = new L.Point(topLeft.x + TileManager.tileSize, topLeft.y + TileManager.tileSize);\n\n\t\t\tif (bounds === undefined)\n\t\t\t\tbounds = new cool.Bounds(topLeft, rightBottom);\n\t\t\telse {\n\t\t\t\tbounds.extend(topLeft).extend(rightBottom);\n\t\t\t}\n\t\t}\n\n\t\treturn bounds;\n\t}\n\n\tpublic clipSubsetBounds(canvasCtx: CanvasRenderingContext2D, subsetBounds: cool.Bounds): void {\n\n\t\tvar ctx = this.sectionProperties.tsManager._paintContext();\n\t\tctx.viewBounds.round();\n\n\t\tcanvasCtx.beginPath();\n\t\tvar rect = subsetBounds.toRectangle();\n\n\t\tthis.beforeDraw(canvasCtx);\n\t\tcanvasCtx.rect(rect[0] - ctx.viewBounds.min.x, rect[1] - ctx.viewBounds.min.y, rect[2], rect[3]);\n\t\tthis.afterDraw(canvasCtx);\n\n\t\tcanvasCtx.clip();\n\t}\n\n\t// eslint-disable-next-line @typescript-eslint/explicit-module-boundary-types\n\tdrawTileInPane (tile: any, tileBounds: any, paneBounds: any, paneOffset: any, canvasCtx: CanvasRenderingContext2D, clearBackground: boolean): void {\n\t\t// intersect - to avoid state thrash through clipping\n\t\tvar crop = new L.Bounds(tileBounds.min, tileBounds.max);\n\t\tcrop.min.x = Math.max(paneBounds.min.x, tileBounds.min.x);\n\t\tcrop.min.y = Math.max(paneBounds.min.y, tileBounds.min.y);\n\t\tcrop.max.x = Math.min(paneBounds.max.x, tileBounds.max.x);\n\t\tcrop.max.y = Math.min(paneBounds.max.y, tileBounds.max.y);\n\n\t\tvar cropWidth = crop.max.x - crop.min.x;\n\t\tvar cropHeight = crop.max.y - crop.min.y;\n\n\t\tif (cropWidth && cropHeight) {\n\t\t\tif (clearBackground || this.containerObject.isZoomChanged() || canvasCtx !== this.context) {\n\t\t\t\t// Whole canvas is not cleared after zoom has changed, so clear it per tile as they arrive.\n\t\t\t\tcanvasCtx.fillStyle = this.containerObject.getClearColor();\n\t\t\t\tthis.beforeDraw(canvasCtx);\n\t\t\t\tcanvasCtx.fillRect(\n\t\t\t\t\tcrop.min.x - paneOffset.x,\n\t\t\t\t\tcrop.min.y - paneOffset.y,\n\t\t\t\t\tcropWidth, cropHeight);\n\t\t\t\tthis.afterDraw(canvasCtx);\n\t\t\t\tvar gridSection = this.containerObject.getSectionWithName(L.CSections.CalcGrid.name);\n\t\t\t\tgridSection.onDrawArea(crop, paneOffset, canvasCtx);\n\t\t\t}\n\n\t\t\tthis.beforeDraw(canvasCtx);\n\t\t\tthis.drawTileToCanvasCrop(tile, canvasCtx,\n\t\t\t\t\t\t\t\t\t  crop.min.x - tileBounds.min.x,\n\t\t\t\t\t\t\t\t\t  crop.min.y - tileBounds.min.y,\n\t\t\t\t\t\t\t\t\t  cropWidth, cropHeight,\n\t\t\t\t\t\t\t\t\t  crop.min.x - paneOffset.x,\n\t\t\t\t\t\t\t\t\t  crop.min.y - paneOffset.y,\n\t\t\t\t\t\t\t\t\t  cropWidth, cropHeight);\n\t\t\tthis.afterDraw(canvasCtx);\n\t\t}\n\t}\n\n\t// eslint-disable-next-line @typescript-eslint/explicit-module-boundary-types\n\tpdfViewDrawTileBorders (tile: any, offset: any, tileSize: number): void {\n\t\tthis.context.strokeStyle = 'red';\n\t\tthis.context.strokeRect(offset.x, offset.y, tileSize, tileSize);\n\t\tthis.context.font = '20px Verdana';\n\t\tthis.context.fillStyle = 'black';\n\t\tthis.context.fillText(tile.coords.x + ' ' + tile.coords.y + ' ' + tile.coords.part, Math.round(offset.x + tileSize * 0.5), Math.round(offset.y + tileSize * 0.5));\n\t}\n\n\t// eslint-disable-next-line @typescript-eslint/explicit-module-boundary-types\n\tpaintSimple (tile: any, ctx: any, async: boolean): void {\n\t\tctx.viewBounds.round();\n\t\tvar offset = new L.Point(tile.coords.getPos().x - ctx.viewBounds.min.x, tile.coords.getPos().y - ctx.viewBounds.min.y);\n\n\t\tif ((async || this.containerObject.isZoomChanged()) && !app.file.fileBasedView) {\n\t\t\t// Non Calc tiles(handled by paintSimple) can have transparent pixels,\n\t\t\t// so clear before paint if the call is an async one.\n\t\t\t// For the full view area repaint, whole canvas is cleared by section container.\n\t\t\t// Whole canvas is not cleared after zoom has changed, so clear it per tile as they arrive even if not async.\n\t\t\tthis.context.fillStyle = this.containerObject.getClearColor();\n\t\t\tthis.context.fillRect(offset.x, offset.y, TileManager.tileSize, TileManager.tileSize);\n\t\t}\n\n\t\tif (app.file.fileBasedView) {\n\t\t\tvar partHeightPixels = Math.round((this.sectionProperties.docLayer._partHeightTwips + this.sectionProperties.docLayer._spaceBetweenParts) * app.twipsToPixels);\n\n\t\t\toffset.y = tile.coords.part * partHeightPixels + tile.coords.y - this.documentTopLeft[1];\n\t\t}\n\n\t\tthis.drawTileToCanvas(tile, this.context, offset.x, offset.y, TileManager.tileSize, TileManager.tileSize);\n\t}\n\n\t// eslint-disable-next-line @typescript-eslint/explicit-module-boundary-types\n\tpublic paint (tile: any, ctx: any, async: boolean): void {\n\t\tif (this.containerObject.isInZoomAnimation() || this.sectionProperties.tsManager.waitForTiles())\n\t\t\treturn;\n\n\t\tif (!ctx)\n\t\t\tctx = this.sectionProperties.tsManager._paintContext();\n\n\t\tthis.containerObject.setPenPosition(this);\n\n\t\tif (ctx.paneBoundsActive === true)\n\t\t\tthis.paintWithPanes(tile, ctx, async);\n\t\telse\n\t\t\tthis.paintSimple(tile, ctx, async);\n\t}\n\n\tprivate forEachTileInView(zoom: number, part: number, mode: number, ctx: any,\n\t\tcallback: (tile: any, coords: any) => boolean) {\n\t\tvar tileRanges = ctx.paneBoundsList.map(TileManager.pxBoundsToTileRange, TileManager);\n\n\t\tif (app.file.fileBasedView) {\n\t\t\tvar coordList: Array<any> = TileManager.updateFileBasedView(true);\n\n\t\t\tfor (var k: number = 0; k < coordList.length; k++) {\n\t\t\t\tvar key = coordList[k].key();\n\t\t\t\tconst tile: Tile = TileManager.get(key);\n\t\t\t\tif (!callback(tile, coordList[k]))\n\t\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\t\telse {\n\t\t\tfor (var rangeIdx = 0; rangeIdx < tileRanges.length; ++rangeIdx) {\n\t\t\t\tvar tileRange = tileRanges[rangeIdx];\n\t\t\t\tfor (var j = tileRange.min.y; j <= tileRange.max.y; ++j) {\n\t\t\t\t\tfor (var i: number = tileRange.min.x; i <= tileRange.max.x; ++i) {\n\t\t\t\t\t\tvar coords = new TileCoordData(\n\t\t\t\t\t\t\ti * TileManager.tileSize,\n\t\t\t\t\t\t\tj * TileManager.tileSize,\n\t\t\t\t\t\t\tzoom,\n\t\t\t\t\t\t\tpart,\n\t\t\t\t\t\t\tmode);\n\n\t\t\t\t\t\tconst key = coords.key();\n\t\t\t\t\t\tconst tile: Tile = TileManager.get(key);\n\n\t\t\t\t\t\tif (!callback(tile, coords))\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\t// eslint-disable-next-line @typescript-eslint/explicit-module-boundary-types\n\tpublic haveAllTilesInView(zoom?: number, part?: number, mode?: number, ctx?: any): boolean {\n\t\tzoom = zoom || Math.round(this.map.getZoom());\n\t\tpart = part || this.sectionProperties.docLayer._selectedPart;\n\t\tctx = ctx || this.sectionProperties.tsManager._paintContext();\n\n\t\tvar allTilesFetched = true;\n\t\tthis.forEachTileInView(zoom, part, mode, ctx, function (tile: any): boolean {\n\t\t\t// Ensure all tile are available.\n\t\t\tif (!tile || tile.needsFetch()) {\n\t\t\t\tallTilesFetched = false;\n\t\t\t\treturn false; // stop search.\n\t\t\t}\n\t\t\treturn true; // continue checking remaining tiles.\n\t\t});\n\n\t\treturn allTilesFetched;\n\t}\n\n\tprivate drawPageBackgroundWriter (ctx: any) {\n\t\tlet viewRectangleTwips = [this.documentTopLeft[0], this.documentTopLeft[1], this.containerObject.getDocumentAnchorSection().size[0], this.containerObject.getDocumentAnchorSection().size[1]];\n\t\tviewRectangleTwips = viewRectangleTwips.map(function(element: number) {\n\t\t\treturn Math.round(element * app.pixelsToTwips);\n\t\t});\n\n\t\tthis.context.fillStyle = this.containerObject.getDocumentBackgroundColor();\n\t\tfor (let i: number = 0; i < app.file.writer.pageRectangleList.length; i++) {\n\t\t\tlet rectangle: any = app.file.writer.pageRectangleList[i];\n\t\t\tif ((rectangle[1] > viewRectangleTwips[1] && rectangle[1] < viewRectangleTwips[1] + viewRectangleTwips[3]) ||\n\t\t\t\t(rectangle[1] + rectangle[3] > viewRectangleTwips[1] && rectangle[1] + rectangle[3] < viewRectangleTwips[1] + viewRectangleTwips[3]) ||\n\t\t\t\t(rectangle[1] < viewRectangleTwips[1] && rectangle[1] + rectangle[3] > viewRectangleTwips[1] + viewRectangleTwips[3])) {\n\n\t\t\t\trectangle = [Math.round(rectangle[0] * app.twipsToPixels), Math.round(rectangle[1] * app.twipsToPixels), Math.round(rectangle[2] * app.twipsToPixels), Math.round(rectangle[3] * app.twipsToPixels)];\n\n\t\t\t\tthis.context.fillRect(rectangle[0] - ctx.viewBounds.min.x + this.sectionProperties.pageBackgroundInnerMargin,\n\t\t\t\t\trectangle[1] - ctx.viewBounds.min.y + this.sectionProperties.pageBackgroundInnerMargin,\n\t\t\t\t\trectangle[2] - this.sectionProperties.pageBackgroundInnerMargin,\n\t\t\t\t\trectangle[3] - this.sectionProperties.pageBackgroundInnerMargin);\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate drawPageBackgroundFileBasedView (ctx: any) {\n\t\t// PDF view supports only same-sized pages for now. So we can use simple math instead of a loop.\n\t\tvar partHeightPixels: number = Math.round((this.map._docLayer._partHeightTwips + this.map._docLayer._spaceBetweenParts) * app.twipsToPixels);\n\t\tvar visibleBounds: Array<number> = app.file.viewedRectangle.pToArray();\n\t\tvar topVisible: number = Math.floor(visibleBounds[1] / partHeightPixels);\n\t\tvar bottomVisible: number = Math.ceil((visibleBounds[1] + visibleBounds[3]) / partHeightPixels);\n\n\t\t// Check existence of pages.\n\t\ttopVisible = topVisible >= 0 ? topVisible : 0;\n\t\tbottomVisible = bottomVisible < this.map._docLayer._parts ? bottomVisible : this.map._docLayer._parts - 1;\n\n\t\tif (!isNaN(partHeightPixels) && partHeightPixels > 0) {\n\t\t\tvar partHeightPixels: number = Math.round(this.map._docLayer._partHeightTwips * app.twipsToPixels);\n\t\t\tvar gap: number = Math.round(this.map._docLayer._spaceBetweenParts * app.twipsToPixels);\n\t\t\tvar partWidthPixels: number = Math.round(this.map._docLayer._partWidthTwips * app.twipsToPixels);\n\t\t\tvar startY: number = (partHeightPixels + gap) * (topVisible > 0 ? topVisible : 0);\n\t\t\tvar rectangle: Array<number>;\n\n\t\t\tfor (var i: number = 0; i <= bottomVisible - topVisible; i++) {\n\t\t\t\trectangle = [0, startY, partWidthPixels, partHeightPixels];\n\n\t\t\t\tthis.context.strokeRect(\n\t\t\t\t\trectangle[0] - ctx.viewBounds.min.x + this.sectionProperties.pageBackgroundInnerMargin,\n\t\t\t\t\trectangle[1] - ctx.viewBounds.min.y + this.sectionProperties.pageBackgroundInnerMargin,\n\t\t\t\t\trectangle[2] - this.sectionProperties.pageBackgroundInnerMargin,\n\t\t\t\t\trectangle[3] - this.sectionProperties.pageBackgroundInnerMargin);\n\n\t\t\t\tthis.context.fillText(String(i + topVisible + 1),\n\t\t\t\t\tMath.round((2 * rectangle[0] + rectangle[2]) * 0.5) - ctx.viewBounds.min.x,\n\t\t\t\t\tMath.round((2 * rectangle[1] + rectangle[3]) * 0.5) - ctx.viewBounds.min.y,\n\t\t\t\t\trectangle[2] * 0.4);\n\n\t\t\t\tstartY += partHeightPixels + gap;\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate drawPageBackgroundsMultiPageView() {\n\t\tif (MultiPageViewLayout === undefined) return;\n\n\t\tthis.context.fillStyle = this.containerObject.getDocumentBackgroundColor();\n\t\tthis.context.strokeStyle = \"red\";\n\n\t\tfor (let i = 0; i < MultiPageViewLayout.layoutRectangles.length; i++) {\n\t\t\tconst rectangle = MultiPageViewLayout.layoutRectangles[i];\n\t\t\tconst coords = [rectangle.layoutX - app.file.viewedRectangle.pX1, rectangle.layoutY - app.file.viewedRectangle.pY1, rectangle.pWidth, rectangle.pHeight];\n\t\t\tthis.context.strokeRect(coords[0], coords[1], coords[2], coords[3]);\n\t\t\tthis.context.fillRect(coords[0], coords[1], coords[2], coords[3]);\n\t\t}\n\t}\n\n\tprivate drawPageBackgrounds (ctx: any) {\n\t\tif (!app.file.fileBasedView && !app.file.writer.multiPageView && this.map._docLayer._docType !== 'text')\n\t\t\treturn;\n\n\t\tif (!this.containerObject.getDocumentAnchorSection())\n\t\t\treturn;\n\n\t\tthis.context.fillStyle = this.sectionProperties.pageBackgroundTextColor;\n\t\tthis.context.strokeStyle = this.sectionProperties.pageBackgroundBorderColor;\n\t\tthis.context.lineWidth = app.roundedDpiScale;\n\n\t\tthis.context.font = this.sectionProperties.pageBackgroundFont;\n\n\t\tif (app.file.fileBasedView)\n\t\t\tthis.drawPageBackgroundFileBasedView(ctx);\n\t\telse if (app.file.writer.multiPageView)\n\t\t\tthis.drawPageBackgroundsMultiPageView();\n\t\telse if (this.map._docLayer._docType === 'text')\n\t\t\tthis.drawPageBackgroundWriter(ctx);\n\t}\n\n\tprivate drawForMultiPageView() {\n\t\tconst visibleCoordList: Array<TileCoordData> = TileManager.getVisibleCoordList(MultiPageViewLayout.getVisibleAreaRectangle());\n\n\t\tfor (let i = 0; i < visibleCoordList.length; i++) {\n\t\t\tconst coords = visibleCoordList[i];\n\n\t\t\tlet firstIntersection = -1;\n\t\t\tfor (let j = 0; j < MultiPageViewLayout.layoutRectangles.length; j++) {\n\t\t\t\tconst layoutRectangle = MultiPageViewLayout.layoutRectangles[j];\n\t\t\t\tconst coordsRectangle = [coords.x, coords.y, TileManager.tileSize, TileManager.tileSize];\n\t\t\t\tconst intersection = LOUtil._getIntersectionRectangle(layoutRectangle.pToArray(), coordsRectangle);\n\n\t\t\t\tif (intersection) {\n\t\t\t\t\tfirstIntersection = j;\n\n\t\t\t\t\tconst viewX = Math.round(layoutRectangle.layoutX + (intersection[0] - layoutRectangle.pX1) - app.file.viewedRectangle.pX1);\n\t\t\t\t\tconst viewY = Math.round(layoutRectangle.layoutY + (intersection[1] - layoutRectangle.pY1) - app.file.viewedRectangle.pY1);\n\t\t\t\t\tconst sX = Math.round(intersection[0] - coords.x);\n\t\t\t\t\tconst sY = Math.round(intersection[1] - coords.y);\n\n\t\t\t\t\tthis.drawTileToCanvasCrop(\n\t\t\t\t\t\tTileManager.get(coords.key()),\n\t\t\t\t\t\tthis.context,\n\t\t\t\t\t\tsX, sY,\n\t\t\t\t\t\tintersection[2],\n\t\t\t\t\t\tintersection[3],\n\t\t\t\t\t\tviewX,\n\t\t\t\t\t\tviewY,\n\t\t\t\t\t\tintersection[2],\n\t\t\t\t\t\tintersection[3]);\n\t\t\t\t}\n\n\t\t\t\tif (firstIntersection > -1 && j - firstIntersection > 1) break; // Check only the next page rectangle (one tile may intersect 2 pages).\n\t\t\t}\n\t\t}\n\t}\n\n\tpublic onDraw (frameCount: number = null, elapsedTime: number = null): void {\n\t\tif (this.containerObject.isInZoomAnimation())\n\t\t\treturn;\n\n\t\tif (this.containerObject.testing) {\n\t\t\tthis.containerObject.createUpdateSingleDivElement(this);\n\t\t}\n\n\t\tif (app.file.writer.multiPageView === true) {\n\t\t\tthis.drawPageBackgroundsMultiPageView();\n\t\t\tthis.drawForMultiPageView();\n\t\t\treturn;\n\t\t}\n\n\t\tvar zoom = Math.round(this.map.getZoom());\n\t\tvar part = this.sectionProperties.docLayer._selectedPart;\n\t\tvar mode = this.sectionProperties.docLayer._selectedMode;\n\n\t\t// Calculate all this here instead of doing it per tile.\n\t\tvar ctx = this.sectionProperties.tsManager._paintContext();\n\n\t\tif (this.sectionProperties.tsManager.waitForTiles()) {\n\t\t\tif (!this.haveAllTilesInView(zoom, part, mode, ctx))\n\t\t\t\treturn;\n\t\t} else if (!this.containerObject.isZoomChanged()) {\n\t\t\t// Don't show page border and page numbers (drawn by drawPageBackgrounds) if zoom is changing\n\t\t\t// after a zoom animation.\n\t\t\tthis.drawPageBackgrounds(ctx);\n\t\t}\n\n\t\tvar docLayer = this.sectionProperties.docLayer;\n\t\tvar doneTiles = new Set();\n\t\tthis.forEachTileInView(zoom, part, mode, ctx, function (tile: any, coords: TileCoordData): boolean {\n\n\t\t\tif (doneTiles.has(coords.key()))\n\t\t\t\treturn true;\n\n\t\t\t// Ensure tile is within document bounds.\n\t\t\tif (tile && TileManager.isValidTile(coords)) {\n\t\t\t\tif (!this.isJSDOM) { // perf-test code\n\t\t\t\t\tif (tile.isReadyToDraw() || this.map._debug.tileOverlaysOn) { // Ensure tile is loaded\n\t\t\t\t\t\tthis.paint(tile, ctx, false /* async? */);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tdoneTiles.add(coords.key());\n\t\t\treturn true; // continue with remaining tiles.\n\t\t}.bind(this));\n\t}\n\n\tpublic onClick(point: Array<number>, e: MouseEvent): void {\n\t\t// Slides pane is not focusable, we are using a variable to follow its focused state.\n\t\t// Until the pane is focusable, we will need to keep below check here.\n\t\tif (this.map._docLayer._docType === 'presentation' || this.map._docLayer._docType === 'drawing')\n\t\t\tthis.map._docLayer._preview.partsFocused = false; // Parts (slide preview pane) is no longer focused, we need to set this here to avoid unwanted behavior.\n\t}\n\n\t// Return the fraction of intersection area with area1.\n\t// eslint-disable-next-line @typescript-eslint/explicit-module-boundary-types\n\tstatic getTileIntersectionAreaFraction(tileBounds: any, viewBounds: any): number {\n\n\t\tvar size = tileBounds.getSize();\n\t\tif (size.x <= 0 || size.y <= 0)\n\t\t\treturn 0;\n\n\t\tvar intersection = new L.Bounds(\n\t\t\tnew L.Point(\n\t\t\t\tMath.max(tileBounds.min.x, viewBounds.min.x),\n\t\t\t\tMath.max(tileBounds.min.y, viewBounds.min.y)),\n\t\t\tnew L.Point(\n\t\t\t\tMath.min(tileBounds.max.x, viewBounds.max.x),\n\t\t\t\tMath.min(tileBounds.max.y, viewBounds.max.y))\n\t\t);\n\n\t\tvar interSize = intersection.getSize();\n\t\treturn Math.max(0, interSize.x) * Math.max(0, interSize.y) / (size.x * size.y);\n\t}\n\n\tprivate forEachTileInArea(area: any, zoom: number, part: number, mode: number, ctx: any,\n\t\tcallback: (tile: any, coords: any, section: TilesSection) => boolean) {\n\n\t\tif (app.file.fileBasedView) {\n\t\t\tvar coordList: Array<any> = TileManager.updateFileBasedView(true, area, zoom);\n\n\t\t\tfor (var k: number = 0; k < coordList.length; k++) {\n\t\t\t\tvar coords = coordList[k];\n\t\t\t\tvar key = coords.key();\n\t\t\t\tconst tile: Tile = TileManager.get(key);\n\t\t\t\tif (tile)\n\t\t\t\t\tcallback(tile, coords, this);\n\t\t\t}\n\n\t\t\treturn;\n\t\t}\n\n\t\tvar tileRange = TileManager.pxBoundsToTileRange(area);\n\n\t\tfor (var j = tileRange.min.y; j <= tileRange.max.y; ++j) {\n\t\t\tfor (var i = tileRange.min.x; i <= tileRange.max.x; ++i) {\n\t\t\t\tconst coords = new TileCoordData(\n\t\t\t\t\ti * TileManager.tileSize,\n\t\t\t\t\tj * TileManager.tileSize,\n\t\t\t\t\tzoom,\n\t\t\t\t\tpart,\n\t\t\t\t\tmode);\n\n\t\t\t\tconst key = coords.key();\n\t\t\t\tconst tile: Tile = TileManager.get(key);\n\t\t\t\tif (tile)\n\t\t\t\t\tcallback(tile, coords, this);\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Used for rendering a zoom-out frame, to determine which zoom level tiles\n\t * to use for rendering.\n\t *\n\t * @param area specifies the document area in core-pixels at the current\n\t * zoom level.\n\t *\n\t * @returns the zoom-level with maximum tile content.\n\t */\n\tprivate zoomLevelWithMaxContentInArea(area: any,\n\t\tareaZoom: number, part: number, mode: number, ctx: any): number {\n\n\t\tvar frameScale = this.sectionProperties.tsManager._zoomFrameScale;\n\t\tvar docLayer = this.sectionProperties.docLayer;\n\t\tvar targetZoom = Math.round(this.map.getScaleZoom(frameScale, areaZoom));\n\t\tvar bestZoomLevel = targetZoom;\n\t\tvar availAreaScoreAtBestZL = -Infinity; // Higher the better.\n\t\tvar area = area.clone();\n\t\tif (area.min.x < 0)\n\t\t\tarea.min.x = 0;\n\t\tif (area.min.y < 0)\n\t\t\tarea.min.y = 0;\n\n\t\tvar minZoom = <number> this.map.options.minZoom;\n\t\tvar maxZoom = <number> this.map.options.maxZoom;\n\t\tfor (var zoom = minZoom; zoom <= maxZoom; ++zoom) {\n\t\t\tvar availAreaScore = 0; // Higher the better.\n\t\t\tvar hasTiles = false;\n\n\t\t\t// To scale up missing-area scores to maxZoom as we need an\n\t\t\t// good resolution integer score at the end.\n\t\t\tvar dimensionCorrection = this.map.zoomToFactor(maxZoom - zoom + this.map.options.zoom);\n\n\t\t\t// Compute area for zoom-level 'zoom'.\n\t\t\tvar areaAtZoom = this.scaleBoundsForZoom(area, zoom, areaZoom);\n\t\t\t//console.log('DEBUG:: areaAtZoom = ' + areaAtZoom);\n\t\t\tvar relScale = this.map.getZoomScale(zoom, areaZoom);\n\n\t\t\tthis.forEachTileInArea(areaAtZoom, zoom, part, mode, ctx, function(tile, coords, section) {\n\t\t\t\tif (tile && tile.image) {\n\t\t\t\t\tvar tilePos = coords.getPos();\n\n\t\t\t\t\tif (app.file.fileBasedView) {\n\t\t\t\t\t\tvar ratio = TileManager.tileSize * relScale / app.tile.size.y;\n\t\t\t\t\t\tvar partHeightPixels = Math.round((docLayer._partHeightTwips + docLayer._spaceBetweenParts) * ratio);\n\t\t\t\t\t\ttilePos.y = coords.part * partHeightPixels + tilePos.y;\n\t\t\t\t\t}\n\n\t\t\t\t\tvar tileBounds = new L.Bounds(tilePos, tilePos.add(new L.Point(TileManager.tileSize, TileManager.tileSize)));\n\t\t\t\t\tvar interFrac = TilesSection.getTileIntersectionAreaFraction(tileBounds, areaAtZoom);\n\n\t\t\t\t\t// Add to score how much of tile area is available.\n\t\t\t\t\tavailAreaScore += interFrac;\n\t\t\t\t\tif (!hasTiles)\n\t\t\t\t\t\thasTiles = true;\n\t\t\t\t}\n\n\t\t\t\treturn true;\n\t\t\t});\n\n\t\t\t// Scale up with a correction factor to make area scores comparable b/w zoom levels.\n\t\t\tavailAreaScore = hasTiles ? Math.round(availAreaScore\n\t\t\t\t* dimensionCorrection /* width */\n\t\t\t\t* dimensionCorrection /* height */\n\t\t\t\t/ 10 /* resolution control */) : -Infinity;\n\n\t\t\t// Accept this zoom if it has a lower missing-area score\n\t\t\t// In case of a tie we prefer tiles from a zoom level closer to targetZoom.\n\t\t\tif (availAreaScore > availAreaScoreAtBestZL ||\n\t\t\t\t(availAreaScore == availAreaScoreAtBestZL && Math.abs(targetZoom - bestZoomLevel) > Math.abs(targetZoom - zoom))) {\n\t\t\t\tavailAreaScoreAtBestZL = availAreaScore;\n\t\t\t\tbestZoomLevel = zoom;\n\t\t\t}\n\t\t}\n\n\t\treturn bestZoomLevel;\n\t}\n\n\t// eslint-disable-next-line @typescript-eslint/explicit-module-boundary-types\n\tpublic drawTileToCanvas(tile: any, canvas: CanvasRenderingContext2D,\n\t\t\t\t\t\t\tdx: number, dy: number, dWidth: number, dHeight: number): void\n\t{\n\t\tthis.drawTileToCanvasCrop(tile, canvas,\n\t\t\t\t\t\t\t\t  0, 0, TileManager.tileSize, TileManager.tileSize,\n\t\t\t\t\t\t\t\t  dx, dy, dWidth, dHeight);\n\t}\n\n\tprivate drawDebugHistogram(canvas: CanvasRenderingContext2D, x: number, y: number, value: number, offset: number)\n\t{\n\t\t\tconst tSize = 256;\n\t\t\tconst deltaSize = 4;\n\t\t\tvar maxDeltas = (tSize - 16) / deltaSize;\n\n\t\t\t// offset vertically down to 'offset'\n\t\t\tconst yoff = Math.floor(offset / maxDeltas);\n\t\t\ty += yoff * deltaSize;\n\t\t\toffset -= yoff * maxDeltas;\n\n\t\t\tvar firstRowFill = Math.min(value, maxDeltas - offset);\n\n\t\t\t// fill first row from offset\n\t\t\tif (firstRowFill > 0)\n\t\t\t\tcanvas.fillRect(x + offset * deltaSize, y, firstRowFill * deltaSize, deltaSize);\n\n\t\t\t// render the rest:\n\t\t\tvalue = value - firstRowFill;\n\n\t\t\t// central rectangle\n\t\t\tvar rowBlock = Math.floor(value / maxDeltas);\n\n\t\t\tif (rowBlock > 0)\n\t\t\t\tcanvas.fillRect(x, y + deltaSize, maxDeltas * deltaSize, rowBlock * deltaSize);\n\n\t\t\t// Fill last row\n\t\t\tvar rowLeft = value % maxDeltas;\n\t\t\tif (rowLeft > 0)\n\t\t\t\tcanvas.fillRect(x, y + rowBlock * deltaSize + deltaSize, rowLeft * deltaSize, deltaSize);\n\t}\n\n\t// eslint-disable-next-line @typescript-eslint/explicit-module-boundary-types\n\tpublic drawTileToCanvasCrop(tile: any, canvas: CanvasRenderingContext2D,\n\t\t\t\t\t\t\t\tsx: number, sy: number, sWidth: number, sHeight: number,\n\t\t\t\t\t\t\t\tdx: number, dy: number, dWidth: number, dHeight: number): void\n\t{\n\t\tTileManager.touchImage(tile);\n\n\t\t/* if (!(tile.wireId % 4)) // great for debugging tile grid alignment.\n\t\t\t\tcanvas.drawImage(this.checkpattern, sx, sy, sWidth, sHeight, dx, dy, dWidth, dHeight);\n\t\telse */\n\t\tif (tile.image)\n\t\t\tcanvas.drawImage(tile.image, sx, sy, sWidth, sHeight, dx, dy, dWidth, dHeight);\n\n\t\tif (this.map._debug.tileOverlaysOn)\n\t\t{\n\t\t\tthis.beforeDraw(canvas);\n\n\t\t\t// clipping push - normally we avoid clipping for perf.\n\t\t\tcanvas.save();\n\t\t\tconst clipRegion = new Path2D();\n\t\t\tclipRegion.rect(dx, dy, dWidth, dHeight);\n\t\t\tcanvas.clip(clipRegion);\n\n\t\t\t// want to render our bits 'inside' the tile - but we may have only part of it.\n\t\t\t// so offset our rendering and rely on clipping to help.\n\t\t\tconst ox = -sx;\n\t\t\tconst oy = -sy;\n\t\t\tconst tSize = 256;\n\n\t\t\t// blue boundary line on tiles\n\t\t\tcanvas.lineWidth = 1;\n\t\t\tcanvas.strokeStyle = 'rgba(0, 0, 255, 0.8)';\n\t\t\tcanvas.beginPath();\n\t\t\tcanvas.moveTo(ox + dx + 0.5, oy + dy + 0.5);\n\t\t\tcanvas.lineTo(ox + dx + 0.5, oy + dy + tSize + 0.5);\n\t\t\tcanvas.lineTo(ox + dx + tSize + 0.5, oy + dy + tSize + 0.5);\n\t\t\tcanvas.lineTo(ox + dx + tSize + 0.5, oy + dy + 0.5);\n\t\t\tcanvas.lineTo(ox + dx + 0.5, oy + dy + 0.5);\n\t\t\tcanvas.stroke();\n\n\t\t\t// state of the tile\n\t\t\tif (!tile.hasContent())\n\t\t\t\tcanvas.fillStyle = 'rgba(255, 0, 0, 0.8)';   // red\n\t\t\telse if (tile.needsFetch())\n\t\t\t\tcanvas.fillStyle = 'rgba(255, 255, 0, 0.8)'; // yellow\n\t\t\telse if (!tile.isReady())\n\t\t\t\tcanvas.fillStyle = 'rgba(0, 160, 0, 0.8)'; // dark green\n\t\t\telse // present\n\t\t\t\tcanvas.fillStyle = 'rgba(0, 255, 0, 0.5)';   // green\n\t\t\tcanvas.fillRect(ox + dx + 1.5, oy + dy + 1.5, 12, 12);\n\n\t\t\t// deltas graph\n\t\t\tif (tile.deltaCount)\n\t\t\t{\n\t\t\t\t// blue/grey deltas\n\t\t\t\tcanvas.fillStyle = 'rgba(0, 0, 256, 0.3)';\n\t\t\t\tthis.drawDebugHistogram(canvas, ox + dx + 1.5 + 14, oy + dy + 1.5, tile.deltaCount, 0);\n\t\t\t\t// yellow/grey deltas\n\t\t\t\tcanvas.fillStyle = 'rgba(256, 256, 0, 0.3)';\n\t\t\t\tthis.drawDebugHistogram(canvas, ox + dx + 1.5 + 14, oy + dy + 1.5, tile.updateCount, tile.deltaCount);\n\t\t\t}\n\n\t\t\t// Metrics on-top of the tile:\n\t\t\tvar lines = [\n\t\t\t\t'wireId: ' + tile.wireId,\n\t\t\t\t'invalidFrom: ' + tile.invalidFrom,\n\t\t\t\t'nviewid: ' + tile.viewId,\n\t\t\t\t'invalidates: ' + tile.invalidateCount,\n\t\t\t\t'tile: ' + tile.loadCount + ' \\u0394: ' + tile.deltaCount + ' upd: ' + tile.updateCount,\n\t\t\t\t'misses: ' + tile.missingContent + ' gce: ' + tile.gcErrors,\n\t\t\t\t'dlta size/kB: ' + ((tile.rawDeltas ? tile.rawDeltas.length : 0)/1024).toFixed(2)\n\t\t\t];\n\n\t\t\t// FIXME: generate metrics of how long a tile has been visible & invalid for.\n\t\t\t//\t\t\tif (tile._debugTime && tile._debugTime.date !== 0)\n\t\t\t//\t\t\t\t\tlines.push(this.map._debug.updateTimeArray(tile._debugTime, +new Date() - tile._debugTime.date));\n\n\t\t\tconst startY = tSize - 12 * lines.length;\n\n\t\t\t// background\n\t\t\tcanvas.fillStyle = 'rgba(220, 220, 220, 0.5)'; // greyish\n\t\t\tcanvas.fillRect(ox + dx + 1.5, oy + dy + startY - 12.0, 100, 12 * lines.length + 8.0);\n\n\t\t\tcanvas.font = '12px sans';\n\t\t\tcanvas.fillStyle = 'rgba(0, 0, 0, 1.0)';   // black\n\t\t\tcanvas.textAlign = 'left';\n\t\t\tfor (var i = 0 ; i < lines.length; ++i)\n\t\t\t\t\tcanvas.fillText(lines[i], ox + dx + 5.5, oy + dy + startY + i*12);\n\n\t\t\tcanvas.restore();\n\t\t\tthis.afterDraw(canvas);\n\t\t}\n\t}\n\n\t// Called by tsManager to draw a zoom animation frame.\n\t// eslint-disable-next-line @typescript-eslint/explicit-module-boundary-types\n\tpublic drawZoomFrame(ctx?: any): void {\n\t\tvar tsManager = this.sectionProperties.tsManager;\n\t\tif (!tsManager._inZoomAnim)\n\t\t\treturn;\n\n\t\tvar scale = tsManager._zoomFrameScale;\n\t\tif (!scale || !tsManager._newCenter)\n\t\t\treturn;\n\n\t\tctx = ctx || this.sectionProperties.tsManager._paintContext();\n\t\tvar docLayer = this.sectionProperties.docLayer;\n\t\tvar zoom = Math.round(this.map.getZoom());\n\t\tvar part = docLayer._selectedPart;\n\t\tvar mode = docLayer._selectedMode;\n\t\tvar splitPos = ctx.splitPos;\n\n\t\tthis.containerObject.setPenPosition(this);\n\t\tvar viewSize = ctx.viewBounds.getSize();\n\t\t// clear the document area first.\n\t\tthis.context.fillStyle = this.containerObject.getClearColor();\n\t\tthis.context.fillRect(0, 0, viewSize.x, viewSize.y);\n\n\t\tvar paneBoundsList = ctx.paneBoundsList;\n\n\t\tlet maxXBound = 0;\n\t\tlet maxYBound = 0;\n\n\t\tfor (const paneBounds of paneBoundsList) {\n\t\t\tmaxXBound = Math.max(maxXBound, paneBounds.min.x);\n\t\t\tmaxYBound = Math.max(maxYBound, paneBounds.min.y);\n\t\t}\n\n\t\tfor (var k = 0; k < paneBoundsList.length ; ++k) {\n\t\t\tvar paneBounds = paneBoundsList[k];\n\t\t\tvar paneSize = paneBounds.getSize();\n\n\t\t\tvar destPos = new L.Point(0, 0);\n\t\t\tvar docAreaSize = paneSize.divideBy(scale);\n\n\t\t\tlet freezeX: boolean;\n\t\t\tlet freezeY: boolean;\n\n\t\t\tif (paneBounds.min.x === 0 && maxXBound !== 0) {\n\t\t\t\t// There is another pane in the X direction and we are at 0, so we are fixed in X\n\t\t\t\tdocAreaSize.x = paneSize.x;\n\t\t\t\tfreezeX = true;\n\t\t\t} else {\n\t\t\t\t// Pane is free to move in X direction.\n\t\t\t\tdestPos.x = splitPos.x;\n\t\t\t\tdocAreaSize.x += splitPos.x / scale;\n\t\t\t\tfreezeX = false;\n\t\t\t}\n\n\t\t\tif (paneBounds.min.y === 0 && maxYBound !== 0) {\n\t\t\t\t// There is another pane in the Y direction and we are at 0, so we are fixed in Y\n\t\t\t\tdocAreaSize.y = paneSize.y;\n\t\t\t\tfreezeY = true;\n\t\t\t} else {\n\t\t\t\t// Pane is free to move in Y direction.\n\t\t\t\tdestPos.y = splitPos.y;\n\t\t\t\tdocAreaSize.y += splitPos.y / scale;\n\t\t\t\tfreezeY = false;\n\t\t\t}\n\n\t\t\t// Calculate top-left in doc core-pixels for the frame.\n\t\t\tvar docPos = tsManager._getZoomDocPos(\n\t\t\t\ttsManager._newCenter,\n\t\t\t\ttsManager._layer._pinchStartCenter,\n\t\t\t\tpaneBounds,\n\t\t\t\t{ freezeX, freezeY },\n\t\t\t\tsplitPos,\n\t\t\t\tscale,\n\t\t\t\tfalse /* findFreePaneCenter? */\n\t\t\t);\n\n\t\t\tif (!freezeX) {\n\t\t\t\ttsManager._zoomAtDocEdgeX = docPos.topLeft.x == splitPos.x;\n\t\t\t}\n\n\t\t\tif (!freezeY) {\n\t\t\t\ttsManager._zoomAtDocEdgeY = docPos.topLeft.y == splitPos.y;\n\t\t\t}\n\n\t\t\tvar docRange = new L.Bounds(docPos.topLeft, docPos.topLeft.add(docAreaSize));\n\t\t\tif (tsManager._calcGridSection) {\n\t\t\t\ttsManager._calcGridSection.onDrawArea(docRange, docRange.min.subtract(destPos), this.context);\n\t\t\t}\n\t\t\tvar canvasContext = this.context;\n\n\t\t\tvar bestZoomSrc = zoom;\n\t\t\tvar sheetGeometry = docLayer.sheetGeometry;\n\t\t\tvar useSheetGeometry = false;\n\t\t\tif (scale < 1.0) {\n\t\t\t\tuseSheetGeometry = !!sheetGeometry;\n\t\t\t\tbestZoomSrc = this.zoomLevelWithMaxContentInArea(docRange, zoom, part, mode, ctx);\n\t\t\t}\n\n\t\t\tvar docRangeScaled = (bestZoomSrc == zoom) ? docRange : this.scaleBoundsForZoom(docRange, bestZoomSrc, zoom);\n\t\t\tvar destPosScaled = (bestZoomSrc == zoom) ? destPos : this.scalePosForZoom(destPos, bestZoomSrc, zoom);\n\t\t\tvar relScale = (bestZoomSrc == zoom) ? 1 : this.map.getZoomScale(bestZoomSrc, zoom);\n\n\t\t\tthis.beforeDraw(canvasContext);\n\t\t\tthis.forEachTileInArea(docRangeScaled, bestZoomSrc, part, mode, ctx, function (tile, coords, section): boolean {\n\t\t\t\tif (!tile || !tile.isReadyToDraw() || !TileManager.isValidTile(coords))\n\t\t\t\t\treturn false;\n\n\t\t\t\tvar tileCoords = tile.coords.getPos();\n\t\t\t\tif (app.file.fileBasedView) {\n\t\t\t\t\tvar ratio = TileManager.tileSize * relScale / app.tile.size.y;\n\t\t\t\t\tvar partHeightPixels = Math.round((docLayer._partHeightTwips + docLayer._spaceBetweenParts) * ratio);\n\t\t\t\t\ttileCoords.y = tile.coords.part * partHeightPixels + tileCoords.y;\n\t\t\t\t}\n\t\t\t\tvar tileBounds = new L.Bounds(tileCoords, tileCoords.add(new L.Point(TileManager.tileSize, TileManager.tileSize)));\n\n\t\t\t\tvar crop = new L.Bounds(tileBounds.min, tileBounds.max);\n\t\t\t\tcrop.min.x = Math.max(docRangeScaled.min.x, tileBounds.min.x);\n\t\t\t\tcrop.min.y = Math.max(docRangeScaled.min.y, tileBounds.min.y);\n\t\t\t\tcrop.max.x = Math.min(docRangeScaled.max.x, tileBounds.max.x);\n\t\t\t\tcrop.max.y = Math.min(docRangeScaled.max.y, tileBounds.max.y);\n\n\t\t\t\tvar cropWidth = crop.max.x - crop.min.x;\n\t\t\t\tvar cropHeight = crop.max.y - crop.min.y;\n\n\t\t\t\tvar tileOffset = crop.min.subtract(tileBounds.min);\n\t\t\t\tvar paneOffset = crop.min.subtract(docRangeScaled.min.subtract(destPosScaled));\n\t\t\t\tif (cropWidth && cropHeight) {\n\t\t\t\t\t\tsection.drawTileToCanvasCrop(\n\t\t\t\t\t\t\t\ttile, canvasContext,\n\t\t\t\t\t\t\t\ttileOffset.x, tileOffset.y, // source x, y\n\t\t\t\t\t\t\t\tcropWidth, cropHeight, // source size\n\t\t\t\t\t\t\t\t// Destination x, y, w, h (In non-Chrome browsers it leaves lines without the 0.5 correction).\n\t\t\t\t\t\t\t\tMath.floor(paneOffset.x / relScale * scale) + 0.5, // Destination x\n\t\t\t\t\t\t\t\tMath.floor(paneOffset.y / relScale * scale) + 0.5, // Destination y\n\t\t\t\t\t\t\t\tMath.floor((cropWidth / relScale) * scale) + 1.5,    // Destination width\n\t\t\t\t\t\t\t\tMath.floor((cropHeight / relScale) * scale) + 1.5);    // Destination height\n\t\t\t\t}\n\n\t\t\t\treturn true;\n\t\t\t}); // end of forEachTileInArea call.\n\t\t\tthis.afterDraw(canvasContext);\n\n\t\t} // End of pane bounds list loop.\n\n\t}\n\n\tprivate scalePosForZoom(pos: any, toZoom: number, fromZoom: number): any {\n\t\tvar docLayer = this.sectionProperties.docLayer;\n\t\tvar convScale = this.map.getZoomScale(toZoom, fromZoom);\n\n\t\tif (docLayer.sheetGeometry) {\n\t\t\tvar toScale = convScale * TileManager.tileSize * 15.0 / app.tile.size.x;\n\t\t\ttoScale = TileManager.tileSize * 15.0 / Math.round(15.0 * TileManager.tileSize / toScale);\n\t\t\tvar posScaled = docLayer.sheetGeometry.getCorePixelsAtZoom(pos, toScale);\n\t\t\treturn posScaled;\n\t\t}\n\n\t\treturn pos.multiplyBy(convScale);\n\t}\n\n\tprivate scaleBoundsForZoom(corePxBounds: any, toZoom: number, fromZoom: number) {\n\t\tvar docLayer = this.sectionProperties.docLayer;\n\t\tvar convScale = this.map.getZoomScale(toZoom, fromZoom);\n\n\t\tif (docLayer.sheetGeometry) {\n\n\t\t\tvar topLeft = this.scalePosForZoom(corePxBounds.min, toZoom, fromZoom);\n\t\t\tvar size = corePxBounds.getSize().multiplyBy(convScale);\n\t\t\treturn new L.Bounds(\n\t\t\t\ttopLeft,\n\t\t\t\ttopLeft.add(size)\n\t\t\t);\n\t\t}\n\n\t\treturn new L.Bounds(\n\t\t\tcorePxBounds.min.multiplyBy(convScale),\n\t\t\tcorePxBounds.max.multiplyBy(convScale)\n\t\t);\n\t}\n}\n\n}\n\nL.getNewTilesSection = function () {\n\treturn new cool.TilesSection();\n};\n"]}