{"version":3,"file":"CommentSection.js","sourceRoot":"","sources":["../../../../../../../../../../../TanhX/online/browser/src/canvas/sections/CommentSection.ts"],"names":[],"mappings":"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","sourcesContent":["// @ts-strict-ignore\n/* -*- js-indent-level: 8 -*- */\n\n/*\n * Copyright the Collabora Online contributors.\n *\n * SPDX-License-Identifier: MPL-2.0\n *\n * This Source Code Form is subject to the terms of the Mozilla Public\n * License, v. 2.0. If a copy of the MPL was not distributed with this\n * file, You can obtain one at http://mozilla.org/MPL/2.0/.\n */\n/* See CanvasSectionContainer.ts for explanations. */\n\ndeclare var L: any;\ndeclare var Autolinker: any;\ndeclare var DOMPurify : any;\n\n// By default DOMPurify will strip all targets, so set everything\n// as target=_blank with rel=noopener\nDOMPurify.addHook('afterSanitizeAttributes', function (node: HTMLElement) {\n\tif (node.tagName === 'A') {\n\t\tnode.setAttribute('target', '_blank');\n\t\tnode.setAttribute('rel', 'noopener');\n\t}\n});\n\nnamespace cool {\n\n/*\n\tdata.layoutStatus: Enumartion sent from the core side.\n\t0: INVISIBLE, 1: VISIBLE, 2: INSERTED, 3: DELETED, 4: NONE, 5: HIDDEN\n\tEx: \"DELETED\" means that the comment is deleted while the \"track changes\" is on.\n*/\nexport enum CommentLayoutStatus {\n\tINVISIBLE,\n\tVISIBLE,\n\tINSERTED,\n\tDELETED,\n\tNONE,\n\tHIDDEN\n}\n\nexport class Comment extends CanvasSectionObject {\n\tname: string = L.CSections.Comment.name;\n\tprocessingOrder: number = L.CSections.Comment.processingOrder;\n\tdrawingOrder: number = L.CSections.Comment.drawingOrder;\n\tzIndex: number = L.CSections.Comment.zIndex;\n\n\tvalid: boolean = true;\n\tmap: any;\n\tpendingInit: boolean = true;\n\n\tcachedCommentHeight: number | null = null;\n\tcachedIsEdit: boolean = false;\n\thidden: boolean | null = null;\n\n\t// eslint-disable-next-line @typescript-eslint/explicit-module-boundary-types\n\tconstructor (data: any, options: any, commentListSectionPointer: cool.CommentSection) {\n\t\tsuper();\n\n\t\tthis.myTopLeft = [0, 0];\n\t\tthis.documentObject = true;\n\t\tthis.map = L.Map.THIS;\n\n\t\tif (!options)\n\t\t\toptions = {};\n\n\t\tthis.sectionProperties.commentListSection = commentListSectionPointer;\n\t\tthis.sectionProperties.docLayer = this.map._docLayer;\n\n\t\tthis.sectionProperties.selectedAreaPoint = null;\n\t\tthis.sectionProperties.cellCursorPoint = null;\n\n\t\tthis.sectionProperties.draggingStarted = false;\n\t\tthis.sectionProperties.dragStartPosition = null;\n\n\t\tthis.sectionProperties.minWidth = options.minWidth ? options.minWidth : 160;\n\t\tthis.sectionProperties.maxHeight = options.maxHeight ? options.maxHeight : 50;\n\t\tthis.sectionProperties.imgSize = options.imgSize ? options.imgSize : [32, 32];\n\t\tthis.sectionProperties.margin = options.margin ? options.margin : [40, 40];\n\t\tthis.sectionProperties.noMenu = options.noMenu ? options.noMenu : false;\n\n\t\tif (data.parent === undefined)\n\t\t\tdata.parent = '0';\n\n\t\tthis.sectionProperties.data = data;\n\n\t\t/*\n\t\t\tpossibleParentCommentId:\n\t\t\t\t* User deletes a parent comment.\n\t\t\t\t* User deletes also its child comment.\n\t\t\t\t* User reverts the last change (deletion of child comment).\n\t\t\t\t* A comment \"Add\" action is sent from the core side.\n\t\t\t\t* The child comment has also its parent id.\n\t\t\t\t* But there is no such parent at the moment.\n\t\t\t\t* So we will remember its possible parent comment in case user also reverts the deletion of parent comment.\n\t\t\t\t* In that case, parent comment will come with its old id.\n\t\t\t\t* Child comment can now find its parent.\n\t\t\t\t* We will check child comment to see if its parent has also been revived.\n\t\t*/\n\t\tthis.sectionProperties.possibleParentCommentId = null;\n\t\tthis.sectionProperties.wrapper = null;\n\t\tthis.sectionProperties.container = null;\n\t\tthis.sectionProperties.author = null;\n\t\tthis.sectionProperties.resolvedTextElement = null;\n\t\tthis.sectionProperties.authorAvatarImg = null;\n\t\tthis.sectionProperties.authorAvatartdImg = null;\n\t\tthis.sectionProperties.contentAuthor = null;\n\t\tthis.sectionProperties.contentDate = null;\n\t\tthis.sectionProperties.acceptButton = null;\n\t\tthis.sectionProperties.rejectButton = null;\n\t\tthis.sectionProperties.menu = null;\n\t\tthis.sectionProperties.captionNode = null;\n\t\tthis.sectionProperties.captionText = null;\n\n\t\tthis.sectionProperties.contentNode = null;\n\t\tthis.sectionProperties.nodeModify = null;\n\t\tthis.sectionProperties.nodeModifyText = null;\n\t\tthis.sectionProperties.contentText = null;\n\t\tthis.sectionProperties.nodeReply = null;\n\t\tthis.sectionProperties.nodeReplyText = null;\n\t\tthis.sectionProperties.contextMenu = false;\n\n\t\tthis.sectionProperties.highlightedTextColor = '#777777'; // Writer.\n\t\tthis.sectionProperties.usedTextColor = this.sectionProperties.data.color; // Writer.\n\t\tthis.sectionProperties.showSelectedCoordinate = true; // Writer.\n\n\t\tif (app.map._docLayer._docType === 'presentation' || app.map._docLayer._docType === 'drawing') {\n\t\t\tthis.sectionProperties.parthash = parseInt(this.sectionProperties.data.parthash);\n\t\t\tthis.sectionProperties.partIndex = app.impress.getIndexFromSlideHash(this.sectionProperties.parthash);\n\t\t}\n\n\t\tthis.sectionProperties.isHighlighted = false;\n\n\t\tthis.name = data.id === 'new' ? 'new comment': 'comment ' + data.id;\n\n\t\tthis.sectionProperties.commentContainerRemoved = false;\n\t\tthis.sectionProperties.children = []; // This is used for Writer comments. There is parent / child relationship between comments in Writer files.\n\t\tthis.sectionProperties.childLinesNode = null;\n\t\tthis.sectionProperties.childLines = [];\n\t\tthis.sectionProperties.childCommentOffset = 8;\n\t\tthis.sectionProperties.commentMarkerSubSection = null; // For Impress and Draw documents.\n\n\t\tthis.convertRectanglesToCoreCoordinates(); // Convert rectangle coordiantes into core pixels on initialization.\n\n\t\tapp.map.on('sheetgeometrychanged', this.setPositionAndSize.bind(this));\n\t}\n\n\t// Comments import can be costly if the document has a lot of them. If they are all imported/initialized\n\t// when online gets comments message from core, the initial doc render is delayed. To avoid that we do\n\t// lazy import of each comment when it needs to be shown (based on its coordinates).\n\tprivate doPendingInitializationInView (force: boolean = false): void {\n\t\tif (!this.pendingInit)\n\t\t\treturn;\n\n\t\tif (!force && !this.convertRectanglesToViewCoordinates())\n\t\t\treturn;\n\n\t\tvar button = L.DomUtil.create('div', 'annotation-btns-container', this.sectionProperties.nodeModify);\n\t\tL.DomEvent.on(this.sectionProperties.nodeModifyText, 'input', this.textAreaInput, this);\n\t\tL.DomEvent.on(this.sectionProperties.nodeReplyText, 'input', this.textAreaInput, this);\n\t\tL.DomEvent.on(this.sectionProperties.nodeModifyText, 'keydown', this.textAreaKeyDown, this);\n\t\tL.DomEvent.on(this.sectionProperties.nodeReplyText, 'keydown', this.textAreaKeyDown, this);\n\t\tthis.createButton(button, 'annotation-cancel-' + this.sectionProperties.data.id, 'annotation-button button-secondary', _('Cancel'), this.handleCancelCommentButton);\n\t\tthis.createButton(button, 'annotation-save-' + this.sectionProperties.data.id, 'annotation-button button-primary',_('Save'), this.handleSaveCommentButton);\n\t\tbutton = L.DomUtil.create('div', '', this.sectionProperties.nodeReply);\n\t\tthis.createButton(button, 'annotation-cancel-reply-' + this.sectionProperties.data.id, 'annotation-button button-secondary', _('Cancel'), this.handleCancelCommentButton);\n\t\tthis.createButton(button, 'annotation-reply-' + this.sectionProperties.data.id, 'annotation-button button-primary', _('Reply'), this.handleReplyCommentButton);\n\t\tL.DomEvent.disableScrollPropagation(this.sectionProperties.container);\n\n\t\t// Since this is a late called function, if the width is enough, we shouldn't collapse the comments.\n\t\tif (app.map._docLayer._docType !== 'text' || this.sectionProperties.commentListSection.isCollapsed === true)\n\t\t\tthis.sectionProperties.container.style.visibility = 'hidden';\n\n\t\tthis.sectionProperties.nodeModify.style.display = 'none';\n\t\tthis.sectionProperties.nodeReply.style.display = 'none';\n\n\t\tvar events = ['click', 'dblclick', 'mousedown', 'mouseup', 'mouseover', 'mouseout', 'keydown', 'keypress', 'keyup', 'touchstart', 'touchmove', 'touchend'];\n\t\tL.DomEvent.on(this.sectionProperties.container, 'click', this.onMouseClick, this);\n\t\tL.DomEvent.on(this.sectionProperties.container, 'keydown', this.onEscKey, this);\n\n\t\tthis.sectionProperties.container.onwheel = function(e: WheelEvent) {\n\t\t\t// Don't scroll the document if mouse is over comment content. Scrolling the comment content is priority.\n\t\t\tif (!this.sectionProperties.contentNode.matches(':hover')) {\n\t\t\t\te.preventDefault();\n\t\t\t\tapp.sectionContainer.onMouseWheel(e);\n\t\t\t}\n\t\t}.bind(this);\n\n\t\tfor (var it = 0; it < events.length; it++) {\n\t\t\tL.DomEvent.on(this.sectionProperties.container, events[it], L.DomEvent.stopPropagation, this);\n\t\t}\n\n\t\tL.DomEvent.on(this.sectionProperties.container, 'touchstart',\n\t\t\tfunction (e: TouchEvent) {\n\t\t\t\tif (e && e.touches.length > 1) {\n\t\t\t\t\tL.DomEvent.preventDefault(e);\n\t\t\t\t}\n\t\t\t},\n\t\t\tthis);\n\n\t\tthis.update();\n\n\t\tthis.pendingInit = false;\n\t}\n\n\tpublic onInitialize (): void {\n\t\tthis.createContainerAndWrapper();\n\n\t\tthis.createAuthorTable();\n\n\t\tif (this.sectionProperties.data.trackchange && !this.map.isReadOnlyMode()) {\n\t\t\tthis.createTrackChangeButtons();\n\t\t}\n\n\t\tif (this.sectionProperties.noMenu !== true && app.isCommentEditingAllowed()) {\n\t\t\tthis.createMenu();\n\t\t}\n\n\t\tif (this.sectionProperties.data.trackchange) {\n\t\t\tthis.sectionProperties.captionNode = L.DomUtil.create('div', 'cool-annotation-caption', this.sectionProperties.wrapper);\n\t\t\tthis.sectionProperties.captionText = L.DomUtil.create('div', '', this.sectionProperties.captionNode);\n\t\t}\n\n\t\tthis.sectionProperties.contentNode = L.DomUtil.create('div', 'cool-annotation-content cool-dont-break', this.sectionProperties.wrapper);\n\t\tthis.sectionProperties.contentNode.id = 'annotation-content-area-' + this.sectionProperties.data.id;\n\t\tthis.sectionProperties.nodeModify = L.DomUtil.create('div', 'cool-annotation-edit' + ' modify-annotation', this.sectionProperties.wrapper);\n\t\tthis.sectionProperties.nodeModifyText = L.DomUtil.create('div', 'cool-annotation-textarea', this.sectionProperties.nodeModify);\n\t\tthis.sectionProperties.nodeModifyText.setAttribute('contenteditable', 'true');\n\t\tthis.sectionProperties.nodeModifyText.setAttribute('role', 'textbox');\n\t\tthis.sectionProperties.nodeModifyText.setAttribute('aria-label', _('Edit comment'));\n\t\tthis.sectionProperties.nodeModifyText.id = 'annotation-modify-textarea-' + this.sectionProperties.data.id;\n\t\tthis.sectionProperties.contentText = L.DomUtil.create('div', '', this.sectionProperties.contentNode);\n\t\tthis.sectionProperties.nodeReply = L.DomUtil.create('div', 'cool-annotation-edit' + ' reply-annotation', this.sectionProperties.wrapper);\n\t\tthis.sectionProperties.nodeReplyText = L.DomUtil.create('div', 'cool-annotation-textarea', this.sectionProperties.nodeReply);\n\t\tthis.sectionProperties.nodeReplyText.setAttribute('contenteditable', 'true');\n\t\tthis.sectionProperties.nodeReplyText.setAttribute('role', 'textbox');\n\t\tthis.sectionProperties.nodeReplyText.setAttribute('aria-label', _('Reply comment'));\n\t\tthis.sectionProperties.nodeReplyText.id = 'annotation-reply-textarea-' + this.sectionProperties.data.id;\n\t\tthis.createChildLinesNode();\n\n\t\tthis.sectionProperties.container.style.visibility = 'hidden';\n\n\t\tif (this.sectionProperties.commentMarkerSubSection === null && app.map._docLayer._docType === 'presentation' || app.map._docLayer._docType === 'drawing')\n\t\t\tthis.createMarkerSubSection();\n\n\t\tthis.doPendingInitializationInView();\n\t}\n\n\tprivate createContainerAndWrapper (): void {\n\t\tvar isRTL = document.documentElement.dir === 'rtl';\n\t\tthis.sectionProperties.container = L.DomUtil.create('div', 'cool-annotation' + (isRTL ? ' rtl' : ''));\n\t\tthis.sectionProperties.container.id = 'comment-container-' + this.sectionProperties.data.id;\n\t\tL.DomEvent.on(this.sectionProperties.container, 'focusout', this.onLostFocus, this);\n\n\t\tvar mobileClass = (<any>window).mode.isMobile() ? ' wizard-comment-box': '';\n\n\t\tif (this.sectionProperties.data.trackchange) {\n\t\t\tthis.sectionProperties.wrapper = L.DomUtil.create('div', 'cool-annotation-redline-content-wrapper' + mobileClass, this.sectionProperties.container);\n\t\t} else {\n\t\t\tthis.sectionProperties.wrapper = L.DomUtil.create('div', 'cool-annotation-content-wrapper' + mobileClass, this.sectionProperties.container);\n\t\t}\n\n\t\tthis.sectionProperties.wrapper.style.marginLeft = this.sectionProperties.childCommentOffset*this.getChildLevel() + 'px';\n\n\t\tif (!(<any>window).mode.isMobile())\n\t\t\tdocument.getElementById('document-container').appendChild(this.sectionProperties.container);\n\n\t\t// We make comment directly visible when its transitioned to its determined position\n\t\tif (cool.CommentSection.autoSavedComment)\n\t\t\tthis.sectionProperties.container.style.visibility = 'hidden';\n\t}\n\n\tprivate createAuthorTable (): void {\n\t\tthis.sectionProperties.author = L.DomUtil.create('table', 'cool-annotation-table', this.sectionProperties.wrapper);\n\n\t\tvar tbody = L.DomUtil.create('tbody', '', this.sectionProperties.author);\n\t\tvar rowResolved = L.DomUtil.create('tr', '', tbody);\n\t\tvar tdResolved = L.DomUtil.create('td', 'cool-annotation-resolved', rowResolved);\n\t\tvar pResolved = L.DomUtil.create('div', 'cool-annotation-content-resolved', tdResolved);\n\t\tthis.sectionProperties.resolvedTextElement = pResolved;\n\n\t\tthis.updateResolvedField(this.sectionProperties.data.resolved);\n\n\t\tvar tr = L.DomUtil.create('tr', '', tbody);\n\t\tthis.sectionProperties.authorRow = tr;\n\t\ttr.id = 'author table row ' + this.sectionProperties.data.id;\n\t\tvar tdImg = L.DomUtil.create('td', 'cool-annotation-img', tr);\n\t\tvar tdAuthor = L.DomUtil.create('td', 'cool-annotation-author', tr);\n\t\tvar imgAuthor = L.DomUtil.create('img', 'avatar-img', tdImg);\n\t\timgAuthor.setAttribute('alt', this.sectionProperties.data.author);\n\t\tvar viewId = this.map.getViewId(this.sectionProperties.data.author);\n\t\tapp.LOUtil.setUserImage(imgAuthor, this.map, viewId);\n\t\timgAuthor.setAttribute('width', this.sectionProperties.imgSize[0]);\n\t\timgAuthor.setAttribute('height', this.sectionProperties.imgSize[1]);\n\n\t\tif (app.map._docLayer._docType !== 'spreadsheet') {\n\t\t\tthis.sectionProperties.collapsedInfoNode = L.DomUtil.create('div', 'cool-annotation-info-collapsed', tdImg);\n\t\t\tthis.sectionProperties.collapsedInfoNode.style.display = 'none';\n\t\t}\n\n\t\tthis.sectionProperties.authorAvatarImg = imgAuthor;\n\t\tthis.sectionProperties.authorAvatartdImg = tdImg;\n\t\tthis.sectionProperties.contentAuthor = L.DomUtil.create('div', 'cool-annotation-content-author', tdAuthor);\n\t\tthis.sectionProperties.contentDate = L.DomUtil.create('div', 'cool-annotation-date', tdAuthor);\n\t\tthis.sectionProperties.autoSave = L.DomUtil.create('div', 'cool-annotation-autosavelabel', tdAuthor);\n\t}\n\n\tprivate createMenu (): void {\n\t\tvar tdMenu = L.DomUtil.create('td', 'cool-annotation-menubar', this.sectionProperties.authorRow);\n\t\tthis.sectionProperties.menu = L.DomUtil.create('div', this.sectionProperties.data.trackchange ? 'cool-annotation-menu-redline' : 'cool-annotation-menu', tdMenu);\n\t\tthis.sectionProperties.menu.id = 'comment-annotation-menu-' + this.sectionProperties.data.id;\n\t\tthis.sectionProperties.menu.tabIndex = 0;\n\t\tthis.sectionProperties.menu.onclick = this.menuOnMouseClick.bind(this);\n\t\tthis.sectionProperties.menu.onkeypress = this.menuOnKeyPress.bind(this);\n\t\tvar divMenuTooltipText = _('Open menu');\n\t\tthis.sectionProperties.menu.dataset.title = divMenuTooltipText;\n\t\tthis.sectionProperties.menu.setAttribute('aria-label', divMenuTooltipText);\n\t\tthis.sectionProperties.menu.annotation = this;\n\t}\n\n\tprivate createChildLinesNode (): void {\n\t\tthis.sectionProperties.childLinesNode = L.DomUtil.create('div', '', this.sectionProperties.container);\n\t\tthis.sectionProperties.childLinesNode.id = 'annotation-child-lines-' + this.sectionProperties.data.id;\n\t\tthis.sectionProperties.childLinesNode.style.width = this.sectionProperties.childCommentOffset*(this.getChildLevel() + 1) + 'px';\n\t}\n\n\tpublic getContainerPosX(): number {\n\t\treturn parseInt(this.sectionProperties.container.style.left.replace('px', ''));\n\t}\n\n\tpublic getContainerPosY(): number {\n\t\treturn parseInt(this.sectionProperties.container.style.top.replace('px', ''));\n\t}\n\n\tpublic updateChildLines (): void {\n\t\tif (!this.isContainerVisible())\n\t\t\treturn;\n\t\tthis.sectionProperties.wrapper.style.marginLeft =  this.sectionProperties.childCommentOffset*this.getChildLevel() + 'px';\n\t\tthis.sectionProperties.childLinesNode.style.width = this.sectionProperties.childCommentOffset*(this.getChildLevel() + 1) + 'px';\n\n\t\tconst childPositions = [];\n\t\tfor (let i = 0; i < this.sectionProperties.children.length; i++) {\n\t\t\tif (this.sectionProperties.children[i].isContainerVisible())\n\t\t\t\tchildPositions.push({ id: this.sectionProperties.children[i].sectionProperties.data.id,\n\t\t\t\t\t\t\t\t\tposY: this.getContainerPosY()});\n\t\t}\n\t\tchildPositions.sort((a, b) => { return a.posY - b.posY; });\n\t\tlet lastPosY = this.getContainerPosY() + this.getCommentHeight(false);\n\t\tlet i = 0;\n\t\tfor (; i < childPositions.length; i++) {\n\t\t\tif (this.sectionProperties.childLines[i] === undefined) {\n\t\t\t\tthis.sectionProperties.childLines[i] = L.DomUtil.create('div', 'cool-annotation-child-line', this.sectionProperties.childLinesNode);\n\t\t\t\tthis.sectionProperties.childLines[i].id = 'annotation-child-line-' + this.sectionProperties.data.id + '-' + i;\n\t\t\t\tthis.sectionProperties.childLines[i].style.width = this.sectionProperties.childCommentOffset/2 + 'px';\n\t\t\t}\n\t\t\tthis.sectionProperties.childLines[i].style.marginLeft =  (this.sectionProperties.childCommentOffset*this.getChildLevel() + 4) + 'px';\n\t\t\tthis.sectionProperties.childLines[i].style.height = (childPositions[i].posY + 24 - lastPosY) + 'px';\n\t\t\tlastPosY = childPositions[i].posY + 24;\n\t\t}\n\t\tif (i < this.sectionProperties.childLines.length) {\n\t\t\tfor (let j = i; j < this.sectionProperties.childLines.length; j++) {\n\t\t\t\tthis.sectionProperties.childLinesNode.removeChild(this.sectionProperties.childLines[i]);\n\t\t\t\tthis.sectionProperties.childLines.splice(i);\n\t\t\t}\n\t\t}\n\n\t}\n\n\t// eslint-disable-next-line @typescript-eslint/explicit-module-boundary-types\n\tpublic setData (data: any): void {\n\t\tthis.sectionProperties.data = data;\n\t}\n\n\tprivate createTrackChangeButtons (): void {\n\t\tvar tdAccept = L.DomUtil.create('td', 'cool-annotation-menubar', this.sectionProperties.authorRow);\n\t\tvar acceptButton = this.sectionProperties.acceptButton = L.DomUtil.create('button', 'cool-redline-accept-button', tdAccept);\n\n\t\tvar tdReject = L.DomUtil.create('td', 'cool-annotation-menubar', this.sectionProperties.authorRow);\n\t\tvar rejectButton = this.sectionProperties.rejectButton = L.DomUtil.create('button', 'cool-redline-reject-button', tdReject);\n\n\t\tacceptButton.dataset.title = _('Accept change');\n\t\tacceptButton.setAttribute('aria-label', _('Accept change'));\n\n\t\tL.DomEvent.on(acceptButton, 'click', function() {\n\t\t\tthis.map.fire('RedlineAccept', {id: this.sectionProperties.data.id});\n\t\t}, this);\n\n\t\trejectButton.dataset.title = _('Reject change');\n\t\trejectButton.setAttribute('aria-label', _('Reject change'));\n\n\t\tL.DomEvent.on(rejectButton, 'click', function() {\n\t\t\tthis.map.fire('RedlineReject', {id: this.sectionProperties.data.id});\n\t\t}, this);\n\t}\n\n\t// eslint-disable-next-line @typescript-eslint/explicit-module-boundary-types\n\tprivate createButton (container: any, id: any, cssClass: string, value: any, handler: any): void {\n\t\tvar button = L.DomUtil.create('input', cssClass, container);\n\t\tbutton.id = id;\n\t\tbutton.type = 'button';\n\t\tbutton.value = value;\n\t\tL.DomEvent.on(button, 'mousedown', L.DomEvent.preventDefault);\n\t\tL.DomEvent.on(button, 'click', handler, this);\n\t}\n\n\t// eslint-disable-next-line @typescript-eslint/explicit-module-boundary-types\n\tpublic parentOf (comment: any): boolean {\n\t\treturn this.sectionProperties.data.id === comment.sectionProperties.data.parent;\n\t}\n\n\tpublic updateResolvedField (state: string): void {\n\t\tthis.sectionProperties.resolvedTextElement.innerText = state === 'true' ? _('Resolved') : '';\n\t}\n\n\tprivate isNewPara(): boolean {\n\t\tconst selection = window.getSelection();\n\t\tif (!selection.rangeCount) return;\n\n\t\tconst range = selection.getRangeAt(0);\n\t\tconst cursorPosition = range.startOffset;\n\t\tconst node = range.startContainer;\n\n\t\tconst beforeCursor = node.textContent.slice(0, cursorPosition);\n\t\treturn /^\\s*$/.test(beforeCursor.slice(0, -1));\n\t}\n\n\tprivate textAreaInput(ev: any): void {\n\t\tthis.sectionProperties.autoSave.innerText = '';\n\n\t\tif (ev && app.map._docLayer._docType === 'text') {\n\t\t\t// special handling for mentions\n\t\t\tthis.map?.mention.handleMentionInput(ev, this.isNewPara());\n\t\t}\n\t}\n\n\tprivate handleKeyDownForPopup (ev: any, id: string): void {\n\t\tvar popup = this.map._textInput._handleKeyDownForPopup(ev, id);\n\t\t// Block Esc from propogating if it closes the comment mention Popup\n\t\tif (popup && id === 'mentionPopup' && ev.key === 'Escape') {\n\t\t\tev.preventDefault();\n\t\t\tev.stopPropagation();\n\t\t}\n\t}\n\n\tprivate textAreaKeyDown (ev: any): void {\n\t\tif (ev && ev.ctrlKey && ev.key === \"Enter\") {\n\t\t\tthis.map.mention?.closeMentionPopup(false);\n\n\t\t\tif (this.sectionProperties.nodeReplyText.id == ev.srcElement.id) {\n\t\t\t\tthis.handleReplyCommentButton(ev);\n\t\t\t} else {\n\t\t\t\tthis.handleSaveCommentButton(ev);\n\t\t\t}\n\t\t\treturn;\n\t\t}\n\n\t\tthis.handleKeyDownForPopup(ev, 'mentionPopup');\n\t}\n\n\tprivate sanitize (html: string): string {\n\t\tif (DOMPurify.isSupported) {\n\t\t\treturn DOMPurify.sanitize(html, { USE_PROFILES: { html: true } });\n\t\t}\n\t\treturn '';\n\t}\n\n\tprivate updateContent (): void {\n\t\tif(this.sectionProperties.data.html)\n\t\t\tthis.sectionProperties.contentText.innerHTML = this.sanitize(this.sectionProperties.data.html);\n\t\telse\n\t\t\tthis.sectionProperties.contentText.innerText = this.sectionProperties.data.text ? this.sectionProperties.data.text: '';\n\t\t// Get the escaped HTML out and find for possible, useful links\n\t\tvar linkedText = Autolinker.link(this.sectionProperties.contentText.outerHTML);\n\t\tthis.sectionProperties.contentText.innerHTML = this.sanitize(linkedText);\n\t\t// Original unlinked text\n\t\tthis.sectionProperties.contentText.origText = this.sectionProperties.data.text ? this.sectionProperties.data.text: '';\n\t\tthis.sectionProperties.contentText.origHTML = this.sectionProperties.data.html ? this.sectionProperties.data.html: '';\n\t\tthis.sectionProperties.nodeModifyText.innerText = this.sectionProperties.data.text ? this.sectionProperties.data.text: '';\n\t\tif (this.sectionProperties.data.html) {\n\t\t\tthis.sectionProperties.nodeModifyText.innerHTML = this.sanitize(this.sectionProperties.data.html);\n\t\t}\n\t\tthis.sectionProperties.contentAuthor.innerText = this.sectionProperties.data.author;\n\n\t\tthis.updateResolvedField(this.sectionProperties.data.resolved);\n\t\tif (this.sectionProperties.data.avatar) {\n\t\t\tthis.sectionProperties.authorAvatarImg.setAttribute('src', this.sectionProperties.data.avatar);\n\t\t}\n\t\telse {\n\t\t\t$(this.sectionProperties.authorAvatarImg).css('padding-top', '4px');\n\t\t}\n\t\tvar user = this.map.getViewId(this.sectionProperties.data.author);\n\t\tif (user >= 0) {\n\t\t\tvar color = app.LOUtil.rgbToHex(this.map.getViewColor(user));\n\t\t\tthis.sectionProperties.authorAvatartdImg.style.borderColor = color;\n\t\t}\n\n\t\t// dateTime is already in UTC, so we will not append Z that will create issues while converting date\n\t\tvar d = new Date(this.sectionProperties.data.dateTime.replace(/,.*/, ''));\n\t\tvar dateOptions: any = { weekday: 'short', year: 'numeric', month: 'short', day: 'numeric', hour: 'numeric', minute: 'numeric'};\n\t\tthis.sectionProperties.contentDate.innerText = isNaN(d.getTime()) ? this.sectionProperties.data.dateTime: d.toLocaleDateString((<any>String).locale, dateOptions);\n\n\t\tif (this.sectionProperties.data.trackchange) {\n\t\t\tthis.sectionProperties.captionText.innerText = this.sectionProperties.data.description;\n\t\t}\n\t}\n\n\tprivate updateLayout (): void {\n\t\tvar style = this.sectionProperties.wrapper.style;\n\t\tstyle.width = '';\n\t\tstyle.whiteSpace = 'nowrap';\n\n\t\tstyle.whiteSpace = '';\n\t}\n\n\tprivate setPositionAndSize (): void {\n\t\tvar rectangles = this.sectionProperties.data.rectanglesOriginal;\n\t\tif (rectangles && app.map._docLayer._docType === 'text') {\n\t\t\tvar xMin: number = Infinity, yMin: number = Infinity, xMax: number = 0, yMax: number = 0;\n\t\t\tfor (var i = 0; i < rectangles.length; i++) {\n\t\t\t\tif (rectangles[i][0] < xMin)\n\t\t\t\t\txMin = rectangles[i][0];\n\n\t\t\t\tif (rectangles[i][1] < yMin)\n\t\t\t\t\tyMin = rectangles[i][1];\n\n\t\t\t\tif (rectangles[i][0] + rectangles[i][2] > xMax)\n\t\t\t\t\txMax = rectangles[i][0] + rectangles[i][2];\n\n\t\t\t\tif (rectangles[i][1] + rectangles[i][3] > yMax)\n\t\t\t\t\tyMax = rectangles[i][1] + rectangles[i][3];\n\t\t\t}\n\t\t\t// Rectangles are in twips. Convert them to core pixels.\n\t\t\txMin = Math.round(xMin * app.twipsToPixels);\n\t\t\tyMin = Math.round(yMin * app.twipsToPixels);\n\t\t\txMax = Math.round(xMax * app.twipsToPixels);\n\t\t\tyMax = Math.round(yMax * app.twipsToPixels);\n\n\t\t\tthis.setPosition(xMin, yMin); // This function is added by section container.\n\t\t\tthis.size = [xMax - xMin, yMax - yMin];\n\t\t\tif (this.size[0] < 5)\n\t\t\t\tthis.size[0] = 5;\n\t\t}\n\t\telse if (this.sectionProperties.data.cellRange && app.map._docLayer._docType === 'spreadsheet') {\n\t\t\tthis.size = this.calcCellSize();\n\t\t\tvar cellPos = app.map._docLayer._cellRangeToTwipRect(this.sectionProperties.data.cellRange).toRectangle();\n\t\t\tlet startX = cellPos[0];\n\t\t\tif (this.isCalcRTL()) { // Mirroring is done in setPosition\n\t\t\t\tconst sizeX = cellPos[2];\n\t\t\t\tstartX += sizeX;  // but adjust for width of the cell.\n\t\t\t}\n\t\t\tthis.setShowSection(true);\n\t\t\tvar position: Array<number> = [Math.round(cellPos[0] * app.twipsToPixels), Math.round(cellPos[1] * app.twipsToPixels)];\n\n\t\t\tthis.setPosition(position[0], position[1]);\n\t\t}\n\t\telse if (app.map._docLayer._docType === 'presentation' || app.map._docLayer._docType === 'drawing') {\n\t\t\tthis.size = [Math.round(this.sectionProperties.imgSize[0] * app.dpiScale), Math.round(this.sectionProperties.imgSize[1] * app.dpiScale)];\n\t\t\tthis.setPosition(Math.round(this.sectionProperties.data.rectangle[0] * app.twipsToPixels), Math.round(this.sectionProperties.data.rectangle[1] * app.twipsToPixels));\n\t\t}\n\t}\n\n\tpublic removeHighlight (): void {\n\t\tif (app.map._docLayer._docType === 'text') {\n\t\t\tthis.sectionProperties.usedTextColor = this.sectionProperties.data.color;\n\n\t\t\tthis.sectionProperties.isHighlighted = false;\n\t\t}\n\t\telse if (app.map._docLayer._docType === 'spreadsheet') {\n\t\t\tthis.backgroundColor = null;\n\t\t\tthis.backgroundOpacity = 1;\n\t\t}\n\t}\n\n\tpublic highlight (): void {\n\t\tif (app.map._docLayer._docType === 'text') {\n\t\t\tthis.sectionProperties.usedTextColor = this.sectionProperties.highlightedTextColor;\n\n\t\t\tvar x: number = Math.round(this.position[0] / app.dpiScale);\n\t\t\tvar y: number = Math.round(this.position[1] / app.dpiScale);\n\t\t\t(this.containerObject.getSectionWithName(L.CSections.Scroll.name) as any as cool.ScrollSection).onScrollTo({x: x, y: y});\n\t\t}\n\t\telse if (app.map._docLayer._docType === 'spreadsheet') {\n\t\t\tthis.backgroundColor = '#777777'; //background: rgba(119, 119, 119, 0.25);\n\t\t\tthis.backgroundOpacity = 0.25;\n\n\t\t\tvar x: number = Math.round(this.position[0] / app.dpiScale);\n\t\t\tvar y: number = Math.round(this.position[1] / app.dpiScale);\n\t\t\t(this.containerObject.getSectionWithName(L.CSections.Scroll.name) as any as cool.ScrollSection).onScrollTo({x: x, y: y});\n\t\t}\n\t\telse if (app.map._docLayer._docType === 'presentation' || app.map._docLayer._docType === 'drawing') {\n\t\t\tvar x: number = Math.round(this.position[0] / app.dpiScale);\n\t\t\tvar y: number = Math.round(this.position[1] / app.dpiScale);\n\t\t\t(this.containerObject.getSectionWithName(L.CSections.Scroll.name) as any as cool.ScrollSection).onScrollTo({x: x, y: y});\n\t\t}\n\n\t\tthis.containerObject.requestReDraw();\n\t\tthis.sectionProperties.isHighlighted = true;\n\t}\n\n\t// eslint-disable-next-line @typescript-eslint/explicit-module-boundary-types\n\tprivate static doesRectIntersectView(pos: number[], size: number[], viewContext: any): boolean {\n\t\tvar paneBoundsList = <any[]>viewContext.paneBoundsList;\n\t\tvar endPos = [pos[0] + size[0], pos[1] + size[1]];\n\t\tfor (var i = 0; i < paneBoundsList.length; ++i) {\n\t\t\tvar paneBounds = paneBoundsList[i];\n\t\t\tvar rectInvisible = (endPos[0] < paneBounds.min.x || endPos[1] < paneBounds.min.y ||\n\t\t\t\tpos[0] > paneBounds.max.x || pos[1] > paneBounds.max.y);\n\t\t\tif (!rectInvisible)\n\t\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\t/*\n\t\tThis function doesn't take topleft positions of sections into account.\n\t\tThis just returns bare pixel coordinates of the rectangles.\n\t*/\n\tprivate convertRectanglesToCoreCoordinates() {\n\t\tvar pixelBasedOrgRectangles = new Array<Array<number>>();\n\n\t\tvar originals = this.sectionProperties.data.rectanglesOriginal;\n\t\tvar pos: number[], size: number[];\n\n\t\tif (originals) {\n\t\t\tfor (var i = 0; i < originals.length; i++) {\n\t\t\t\tpos = [\n\t\t\t\t\tMath.round(originals[i][0] * app.twipsToPixels),\n\t\t\t\t\tMath.round(originals[i][1] * app.twipsToPixels)\n\t\t\t\t];\n\t\t\t\tsize = [\n\t\t\t\t\tMath.round(originals[i][2] * app.twipsToPixels),\n\t\t\t\t\tMath.round(originals[i][3] * app.twipsToPixels)\n\t\t\t\t];\n\n\t\t\t\tpixelBasedOrgRectangles.push([pos[0], pos[1], size[0], size[1]]);\n\t\t\t}\n\n\t\t\tthis.sectionProperties.pixelBasedOrgRectangles = pixelBasedOrgRectangles;\n\t\t}\n\t}\n\n\t// This is for svg elements that will be bound to document-container.\n\t// This also returns whether any rectangle has an intersection with the visible area/panes.\n\t// This function calculates the core pixel coordinates then converts them into view coordinates.\n\tprivate convertRectanglesToViewCoordinates () : boolean {\n\t\tvar rectangles = this.sectionProperties.data.rectangles;\n\t\tvar originals = this.sectionProperties.data.rectanglesOriginal;\n\t\tvar viewContext = this.map.getTileSectionMgr()._paintContext();\n\t\tvar intersectsVisibleArea = false;\n\t\tvar pos: number[], size: number[];\n\n\t\tif (rectangles) {\n\t\t\tvar documentAnchorSection = this.containerObject.getDocumentAnchorSection();\n\t\t\tvar diff = [documentAnchorSection.myTopLeft[0] - this.documentTopLeft[0], documentAnchorSection.myTopLeft[1] - this.documentTopLeft[1]];\n\n\t\t\tfor (var i = 0; i < rectangles.length; i++) {\n\t\t\t\tpos = [\n\t\t\t\t\tMath.round(originals[i][0] * app.twipsToPixels),\n\t\t\t\t\tMath.round(originals[i][1] * app.twipsToPixels)\n\t\t\t\t];\n\t\t\t\tsize = [\n\t\t\t\t\tMath.round(originals[i][2] * app.twipsToPixels),\n\t\t\t\t\tMath.round(originals[i][3] * app.twipsToPixels)\n\t\t\t\t];\n\n\t\t\t\tif (!intersectsVisibleArea && Comment.doesRectIntersectView(pos, size, viewContext))\n\t\t\t\t\tintersectsVisibleArea = true;\n\n\t\t\t\trectangles[i][0] = pos[0] + diff[0];\n\t\t\t\trectangles[i][1] = pos[1] + diff[1];\n\t\t\t\trectangles[i][2] = size[0];\n\t\t\t\trectangles[i][3] = size[1];\n\t\t\t}\n\t\t} else if (this.sectionProperties.data.trackchange && this.sectionProperties.data.anchorPos) {\n\t\t\t// For redline comments there are no 'rectangles' or 'rectangleOriginal' properties in sectionProperties.data\n\t\t\t// So use the comment rectangle stored in anchorPos (in display? twips).\n\t\t\tpos = this.getPosition();\n\t\t\tsize = this.getSize();\n\n\t\t\tintersectsVisibleArea = Comment.doesRectIntersectView(pos, size, viewContext);\n\t\t}\n\n\t\treturn intersectsVisibleArea;\n\t}\n\n\tpublic getPosition (): number[] {\n\t\t// For redline comments there are no 'rectangles' or 'rectangleOriginal' properties in sectionProperties.data\n\t\t// So use the comment rectangle stored in anchorPos (in display? twips).\n\t\tif (this.sectionProperties.data.trackchange && this.sectionProperties.data.anchorPos) {\n\t\t\tvar anchorPos = this.sectionProperties.data.anchorPos;\n\t\t\treturn [\n\t\t\t\tMath.round(anchorPos[0] * app.twipsToPixels),\n\t\t\t\tMath.round(anchorPos[1] * app.twipsToPixels)\n\t\t\t];\n\t\t} else {\n\t\t\treturn this.position;\n\t\t}\n\t}\n\n\tpublic getSize(): number[] {\n\t\t// For redline comments there are no 'rectangles' or 'rectangleOriginal' properties in sectionProperties.data\n\t\t// So use the comment rectangle stored in anchorPos (in display? twips).\n\t\tif (this.sectionProperties.data.trackchange && this.sectionProperties.data.anchorPos) {\n\t\t\tvar anchorPos = this.sectionProperties.data.anchorPos;\n\t\t\treturn [\n\t\t\t\tMath.round(anchorPos[2] * app.twipsToPixels),\n\t\t\t\tMath.round(anchorPos[3] * app.twipsToPixels)\n\t\t\t];\n\t\t} else {\n\t\t\treturn this.size;\n\t\t}\n\t}\n\n\tprivate updatePosition (): void {\n\t\tthis.convertRectanglesToViewCoordinates();\n\t\tthis.convertRectanglesToCoreCoordinates();\n\t\tthis.setPositionAndSize();\n\t\tif (app.map._docLayer._docType === 'spreadsheet')\n\t\t\tthis.positionCalcComment();\n\t\telse if (app.map._docLayer._docType === \"presentation\" || app.map._docLayer._docType === \"drawing\") {\n\t\t\tif (this.sectionProperties.commentMarkerSubSection !== null) {\n\t\t\t\tthis.sectionProperties.commentMarkerSubSection.sectionProperties.data = this.sectionProperties.data;\n\t\t\t\tthis.sectionProperties.commentMarkerSubSection.setPosition(\n\t\t\t\t\tthis.sectionProperties.data.anchorPos[0] * app.twipsToPixels,\n\t\t\t\t\tthis.sectionProperties.data.anchorPos[1] * app.twipsToPixels\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate createMarkerSubSection() {\n\t\tif (this.sectionProperties.data.rectangle === null)\n\t\t\treturn;\n\n\t\tconst showMarker = app.impress.partList[app.map._docLayer._selectedPart].hash === this.sectionProperties.data.parthash ||\n\t\t\t\t\t\t\tapp.file.fileBasedView;\n\n\t\tthis.sectionProperties.commentMarkerSubSection = new CommentMarkerSubSection(\n\t\t\tthis.name + this.sectionProperties.data.id + String(Math.random()), // Section name - only as a placeholder.\n\t\t\t28, 28, // Width and height.\n\t\t\tnew SimplePoint(this.sectionProperties.data.anchorPos[0], this.sectionProperties.data.anchorPos[1]), // Document position.\n\t\t\t'annotation-marker', // Extra class.\n\t\t\tshowMarker, // Show section.\n\t\t\tthis, // Parent section.\n\t\t\tthis.sectionProperties.data\n\t\t);\n\n\t\tapp.sectionContainer.addSection(this.sectionProperties.commentMarkerSubSection);\n\t}\n\n\tpublic isContainerVisible (): boolean {\n\t\treturn this.sectionProperties.container.style &&\n\t\t\tthis.sectionProperties.container.style.display !== 'none' &&\n\t\t\t(\n\t\t\t\tthis.sectionProperties.container.style.visibility === 'visible' ||\n\t\t\t\tthis.sectionProperties.container.style.visibility === ''\n\t\t\t);\n\t}\n\n\tpublic update (): void {\n\t\tthis.updateContent();\n\t\tthis.updateLayout();\n\t\tthis.updatePosition();\n\t}\n\n\tprivate showMarker (): void {\n\t\tif (this.sectionProperties.commentMarkerSubSection != null) {\n\t\t\tthis.sectionProperties.commentMarkerSubSection.showSection = true;\n\t\t\tthis.sectionProperties.commentMarkerSubSection.onSectionShowStatusChange();\n\t\t}\n\t}\n\n\tprivate hideMarker (): void {\n\t\tif (this.sectionProperties.commentMarkerSubSection != null) {\n\t\t\tthis.sectionProperties.commentMarkerSubSection.showSection = false;\n\t\t\tthis.sectionProperties.commentMarkerSubSection.onSectionShowStatusChange();\n\t\t}\n\t}\n\n\tprivate showWriter() {\n\t\tif (!this.isCollapsed || this.isSelected()) {\n\t\t\tthis.sectionProperties.container.style.visibility = '';\n\t\t\tthis.sectionProperties.container.style.display = '';\n\t\t}\n\t\tif (this.sectionProperties.data.resolved !== 'true' || this.sectionProperties.commentListSection.sectionProperties.showResolved) {\n\t\t\tL.DomUtil.addClass(this.sectionProperties.container, 'cool-annotation-collapsed-show');\n\t\t\tthis.sectionProperties.showSelectedCoordinate = true;\n\t\t}\n\t\tthis.sectionProperties.contentNode.style.display = '';\n\t\tthis.sectionProperties.nodeModify.style.display = 'none';\n\t\tthis.sectionProperties.nodeReply.style.display = 'none';\n\t\tthis.sectionProperties.collapsedInfoNode.style.visibility = '';\n\t\tthis.cachedIsEdit = false;\n\t}\n\n\tprivate showCalc() {\n\t\tthis.sectionProperties.container.style.display = '';\n\t\tthis.sectionProperties.contentNode.style.display = '';\n\t\tthis.sectionProperties.nodeModify.style.display = 'none';\n\t\tthis.sectionProperties.nodeReply.style.display = 'none';\n\t\tthis.cachedIsEdit = false;\n\n\t\tthis.positionCalcComment();\n\t\tif (!(<any>window).mode.isMobile()) {\n\t\t\tthis.sectionProperties.commentListSection.select(this);\n\t\t}\n\t\tthis.sectionProperties.container.style.visibility = '';\n\t}\n\n\tprivate getCommentWidth() {\n\t\t// note: getComputedStyle can be an exceptional bottle-neck with many comments\n\t\treturn parseFloat(getComputedStyle(this.sectionProperties.container).width) * app.dpiScale;\n\t}\n\n\tpublic positionCalcComment(): void {\n\t\tif (!(<any>window).mode.isMobile()) {\n\t\t\tvar cellPos = app.map._docLayer._cellRangeToTwipRect(this.sectionProperties.data.cellRange).toRectangle();\n\t\t\tvar originalSize = [Math.round((cellPos[2]) * app.twipsToPixels), Math.round((cellPos[3]) * app.twipsToPixels)];\n\n\t\t\tconst startX = this.isCalcRTL() ? this.myTopLeft[0] - this.getCommentWidth() : this.myTopLeft[0] + originalSize[0] - 3;\n\n\t\t\tvar pos: Array<number> = [Math.round(startX / app.dpiScale), Math.round(this.myTopLeft[1] / app.dpiScale)];\n\t\t\tthis.sectionProperties.container.style.transform = 'translate3d(' + pos[0] + 'px, ' + pos[1] + 'px, 0px)';\n\t\t}\n\t}\n\n\tprivate showImpressDraw() {\n\t\tif (this.isInsideActivePart()) {\n\t\t\tthis.sectionProperties.container.style.display = '';\n\t\t\tthis.sectionProperties.nodeModify.style.display = 'none';\n\t\t\tthis.sectionProperties.nodeReply.style.display = 'none';\n\t\t\tthis.sectionProperties.contentNode.style.display = '';\n\t\t\tthis.cachedIsEdit = false;\n\t\t\tif (this.isSelected() || !this.isCollapsed) {\n\t\t\t\tthis.sectionProperties.container.style.visibility = '';\n\t\t\t}\n\t\t\telse {\n\t\t\t\tthis.sectionProperties.container.style.visibility = 'hidden';\n\t\t\t}\n\t\t\tL.DomUtil.addClass(this.sectionProperties.container, 'cool-annotation-collapsed-show');\n\t\t}\n\t}\n\n\tpublic setLayoutClass(): void {\n\t\tthis.sectionProperties.container.classList.remove('tracked-deleted-comment-show');\n\t\tthis.sectionProperties.container.classList.remove('tracked-deleted-comment-hide');\n\n\t\tvar showTrackedChanges: boolean = this.map['stateChangeHandler'].getItemValue('.uno:ShowTrackedChanges') === 'true';\n\t\tvar layoutClass: string = showTrackedChanges ? 'tracked-deleted-comment-show' : 'tracked-deleted-comment-hide';\n\t\tif (this.sectionProperties.data.layoutStatus === CommentLayoutStatus.DELETED) {\n\t\t\tthis.sectionProperties.container.classList.add(layoutClass);\n\t\t}\n\t}\n\n\tpublic show(): void {\n\t\tthis.doPendingInitializationInView(true /* force */);\n\n\t\tif (this.hidden === false && !this.isEdit()) return;\n\n\t\tthis.showMarker();\n\n\t\t// On mobile, container shouldn't be 'document-container', but it is 'document-container' on initialization. So we hide the comment until comment wizard is opened.\n\t\tif ((<any>window).mode.isMobile() && this.sectionProperties.container.parentElement === document.getElementById('document-container'))\n\t\t\tthis.sectionProperties.container.style.visibility = 'hidden';\n\n\t\tif (cool.CommentSection.commentWasAutoAdded)\n\t\t\treturn;\n\n\t\t// We don't cache the hidden state for spreadsheets. Only one comment can be\n\t\t// visible and they're hidden when scrolling, so it's easier this way.\n\t\tif (app.map._docLayer._docType === 'text') {\n\t\t\tthis.showWriter();\n\t\t\tthis.hidden = false;\n\t\t} else if (app.map._docLayer._docType === 'presentation' || app.map._docLayer._docType === 'drawing') {\n\t\t\tthis.showImpressDraw();\n\t\t\tthis.hidden = false;\n\t\t} else if (app.map._docLayer._docType === 'spreadsheet')\n\t\t\tthis.showCalc();\n\n\t\tthis.setLayoutClass();\n\t}\n\n\tprivate hideWriter() {\n\t\tthis.sectionProperties.container.style.visibility = 'hidden';\n\t\tthis.sectionProperties.nodeModify.style.display = 'none';\n\t\tthis.sectionProperties.nodeReply.style.display = 'none';\n\t\tthis.sectionProperties.showSelectedCoordinate = false;\n\t\tL.DomUtil.removeClass(this.sectionProperties.container, 'cool-annotation-collapsed-show');\n\t\tthis.cachedIsEdit = false;\n\t\tthis.hidden = true;\n\t}\n\n\tprivate hideCalc() {\n\t\tthis.sectionProperties.container.style.visibility = 'hidden';\n\t\tthis.sectionProperties.nodeModify.style.display = 'none';\n\t\tthis.sectionProperties.nodeReply.style.display = 'none';\n\t\tthis.cachedIsEdit = false;\n\n\t\tif (this.sectionProperties.commentListSection.sectionProperties.selectedComment === this)\n\t\t\tthis.sectionProperties.commentListSection.sectionProperties.selectedComment = null;\n\t}\n\n\tprivate hideImpressDraw() {\n\t\tif (!this.isInsideActivePart()) {\n\t\t\tthis.sectionProperties.container.style.display = 'none';\n\t\t\tthis.hideMarker();\n\t\t}\n\t\telse {\n\t\t\tthis.sectionProperties.container.style.display = '';\n\t\t\tif (this.isCollapsed)\n\t\t\t\tthis.sectionProperties.container.style.visibility = 'hidden';\n\n\t\t\tthis.sectionProperties.nodeModify.style.display = 'none';\n\t\t\tthis.sectionProperties.nodeReply.style.display = 'none';\n\t\t\tthis.cachedIsEdit = false;\n\t\t}\n\t\tL.DomUtil.removeClass(this.sectionProperties.container, 'cool-annotation-collapsed-show');\n\t\tthis.hidden = true;\n\t}\n\n\t// check if this is \"our\" autosaved comment\n\t// core is not aware it's autosaved one so use this simplified detection based on content\n\tpublic isAutoSaved (): boolean {\n\t\tvar autoSavedComment = cool.CommentSection.autoSavedComment;\n\t\tif (!autoSavedComment)\n\t\t\treturn false;\n\n\t\tvar authorMatch = this.sectionProperties.data.author === this.map.getViewName(app.map._docLayer._viewId);\n\t\treturn authorMatch;\n\t}\n\n\tpublic hide (): void {\n\t\tif (this.hidden === true || this.isEdit()) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.sectionProperties.data.id === 'new') {\n\t\t\tthis.sectionProperties.commentListSection.removeItem(this.sectionProperties.data.id);\n\t\t\treturn;\n\t\t}\n\n\t\tif (app.map._docLayer._docType === 'text')\n\t\t\tthis.hideWriter();\n\t\telse if (app.map._docLayer._docType === 'spreadsheet')\n\t\t\tthis.hideCalc();\n\t\telse if (app.map._docLayer._docType === 'presentation' || app.map._docLayer._docType === 'drawing')\n\t\t\tthis.hideImpressDraw();\n\t}\n\n\tprivate isInsideActivePart() {\n\t\t// Impress and Draw only.\n\t\treturn this.sectionProperties.partIndex === app.map._docLayer._selectedPart;\n\t}\n\n\t// eslint-disable-next-line @typescript-eslint/explicit-module-boundary-types\n\tprivate menuOnMouseClick (e: any): void {\n\t\t$(this.sectionProperties.menu).contextMenu();\n\t\tL.DomEvent.stopPropagation(e);\n\t}\n\n\t// eslint-disable-next-line @typescript-eslint/explicit-module-boundary-types\n\tprivate menuOnKeyPress (e: any): void {\n\t\tif (e.code === 'Space' || e.code === 'Enter')\n\t\t\t$(this.sectionProperties.menu).contextMenu();\n\t\tL.DomEvent.stopPropagation(e);\n\t}\n\n\t// eslint-disable-next-line @typescript-eslint/explicit-module-boundary-types\n\tprivate onMouseClick (e: any): void {\n\t\tif (((<any>window).mode.isMobile() || (<any>window).mode.isTablet())\n\t\t\t&& this.map.getDocType() == 'spreadsheet'\n\t\t\t&& !this.map.uiManager.mobileWizard.isOpen()) {\n\t\t\tthis.hide();\n\t\t}\n\t\tL.DomEvent.stopPropagation(e);\n\t\tthis.sectionProperties.commentListSection.click(this);\n\t}\n\n\t// eslint-disable-next-line @typescript-eslint/explicit-module-boundary-types\n\tprivate onEscKey (e: any): void {\n\t\tif ((<any>window).mode.isDesktop()) {\n\t\t\tif (e.keyCode === 27) {\n\t\t\t\tthis.onCancelClick(e);\n\t\t\t} else if (e.keyCode === 33 /*PageUp*/ || e.keyCode === 34 /*PageDown*/) {\n\t\t\t\t// work around for a chrome issue https://issues.chromium.org/issues/41417806\n\t\t\t\tL.DomEvent.preventDefault(e);\n\t\t\t\tvar pos = e.keyCode === 33 ? 0 : e.target.textLength;\n\t\t\t\tvar currentPos = e.target.selectionStart;\n\t\t\t\tif (e.shiftKey) {\n\t\t\t\t\tvar [start, end] = currentPos <= pos ? [currentPos, pos] : [pos, currentPos];\n\t\t\t\t\te.target.setSelectionRange(start, end, currentPos > pos ? 'backward' : 'forward');\n\t\t\t\t} else {\n\t\t\t\t\te.target.setSelectionRange(pos, pos);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t}\n\n\t// eslint-disable-next-line @typescript-eslint/explicit-module-boundary-types\n\tpublic handleReplyCommentButton (e: any): void {\n\t\tcool.CommentSection.autoSavedComment = null;\n\t\tcool.CommentSection.commentWasAutoAdded = false;\n\t\tthis.textAreaInput(null);\n\t\tthis.onReplyClick(e);\n\t}\n\n\t// eslint-disable-next-line @typescript-eslint/explicit-module-boundary-types\n\tpublic onReplyClick (e: any): void {\n\t\tL.DomEvent.stopPropagation(e);\n\t\tif ((<any>window).mode.isMobile()) {\n\t\t\tthis.sectionProperties.data.reply = this.sectionProperties.data.text;\n\t\t\tthis.sectionProperties.commentListSection.saveReply(this);\n\t\t} else {\n\t\t\tthis.removeLastBRTag(this.sectionProperties.nodeReplyText);\n\t\t\tthis.sectionProperties.data.reply = this.sectionProperties.nodeReplyText.innerText;\n\t\t\tthis.sectionProperties.data.html = this.sectionProperties.nodeReplyText.innerHTML;\n\t\t\t// Assigning an empty string to .innerHTML property in some browsers will convert it to 'null'\n\t\t\t// While in browsers like Chrome and Firefox, a null value is automatically converted to ''\n\t\t\t// Better to assign '' here instead of null to keep the behavior same for all\n\t\t\tthis.sectionProperties.nodeReplyText.innerText = '';\n\t\t\tthis.show();\n\t\t\tthis.sectionProperties.commentListSection.saveReply(this);\n\t\t}\n\t}\n\n\t// eslint-disable-next-line @typescript-eslint/explicit-module-boundary-types\n\tpublic handleCancelCommentButton (e: any): void {\n\t\tif (cool.CommentSection.commentWasAutoAdded) {\n\t\t\tapp.sectionContainer.getSectionWithName(L.CSections.CommentList.name).remove(this.sectionProperties.data.id);\n\t\t}\n\n\t\tif (cool.CommentSection.autoSavedComment) {\n\t\t\tthis.sectionProperties.contentText.origText = this.sectionProperties.contentText.uneditedText;\n\t\t\tthis.sectionProperties.contentText.uneditedText = null;\n\t\t\tthis.sectionProperties.contentText.origHTML = this.sectionProperties.contentText.uneditedHTML;\n\t\t\tthis.sectionProperties.contentText.uneditedHTML = null;\n\t\t}\n\n\t\t// These lines are repeated in onCancelClick,\n\t\t// it makes things simple by not adding so many condition for different apps and different situation\n\t\t// It is mandatory to change these values before handleSaveCommentButton is called\n\t\t// calling handleSaveCommentButton in onCancelClick causes problem because that is also called from many other events/function (i.e: onPartChange)\n\t\tif (this.sectionProperties.contentText.origHTML) {\n\t\t\tthis.sectionProperties.nodeModifyText.innerHTML = this.sanitize(this.sectionProperties.contentText.origHTML);\n\t\t}\n\t\telse {\n\t\t\tthis.sectionProperties.nodeModifyText.innerText = this.sectionProperties.contentText.origText;\n\t\t}\n\t\tthis.sectionProperties.nodeReplyText.innerText = '';\n\n\t\tif (cool.CommentSection.autoSavedComment)\n\t\t\tthis.handleSaveCommentButton(e);\n\n\t\tthis.onCancelClick(e);\n\t\tif (app.map._docLayer._docType === 'spreadsheet')\n\t\t\tthis.hideCalc();\n\t\tcool.CommentSection.commentWasAutoAdded = false;\n\t\tcool.CommentSection.autoSavedComment = null;\n\t}\n\n\t// eslint-disable-next-line @typescript-eslint/explicit-module-boundary-types\n\tpublic onCancelClick (e: any): void {\n\t\tif (e)\n\t\t\tL.DomEvent.stopPropagation(e);\n\t\tif (this.sectionProperties.contentText.origHTML) {\n\t\t\tthis.sectionProperties.nodeModifyText.innerHTML = this.sanitize(this.sectionProperties.contentText.origHTML);\n\t\t}\n\t\telse {\n\t\t\tthis.sectionProperties.nodeModifyText.innerText = this.sectionProperties.contentText.origText;\n\t\t}\n\t\tthis.sectionProperties.nodeReplyText.innerText = '';\n\t\tif (app.map._docLayer._docType !== 'spreadsheet')\n\t\t\tthis.show();\n\t\tthis.sectionProperties.commentListSection.cancel(this);\n\t}\n\n\t// eslint-disable-next-line @typescript-eslint/explicit-module-boundary-types\n\tpublic handleSaveCommentButton (e: any): void {\n\t\tcool.CommentSection.autoSavedComment = null;\n\t\tcool.CommentSection.commentWasAutoAdded = false;\n\t\tthis.sectionProperties.contentText.uneditedText = null;\n\t\tthis.sectionProperties.contentText.uneditedHTML = null;\n\t\tthis.textAreaInput(null);\n\t\tthis.onSaveComment(e);\n\t}\n\n\t// eslint-disable-next-line @typescript-eslint/explicit-module-boundary-types\n\tpublic onSaveComment (e: any): void {\n\t\tthis.sectionProperties.commentContainerRemoved = true;\n\t\tL.DomEvent.stopPropagation(e);\n\t\tthis.removeLastBRTag(this.sectionProperties.nodeModifyText);\n\t\tthis.sectionProperties.data.text = this.sectionProperties.nodeModifyText.innerText;\n\t\tthis.sectionProperties.data.html = this.sectionProperties.nodeModifyText.innerHTML;\n\t\tthis.updateContent();\n\t\tif (!cool.CommentSection.autoSavedComment)\n\t\t\tthis.show();\n\t\tthis.sectionProperties.commentListSection.save(this);\n\t}\n\n\t// for some reason firefox adds <br> at of the end of text in contenteditable div\n\t// there have been similar reports: https://bugzilla.mozilla.org/show_bug.cgi?id=1615852\n\tprivate removeLastBRTag(element: HTMLElement) {\n\t\tif (!L.Browser.gecko)\n\t\t\treturn;\n\t\tconst brElements = element.querySelectorAll('br');\n\t\tif (brElements.length > 0)\n\t\t\tbrElements[brElements.length-1].remove();\n\t}\n\n\t// eslint-disable-next-line @typescript-eslint/explicit-module-boundary-types\n\tpublic onLostFocus (e: any): void {\n\n\t\tif (!this.isEdit() || this.sectionProperties.container.contains(e.relatedTarget))\n\t\t\treturn;\n\t\tif (this.sectionProperties.nodeReply.contains(e.target)) {\n\t\t\tthis.onLostFocusReply(e);\n\t\t\treturn;\n\t\t}\n\n\t\tif (app.map._docLayer._docType === 'text' && this.map.mention?.isTypingMention()) {\n\t\t\treturn;\n\t\t}\n\t\tif (!this.sectionProperties.commentContainerRemoved) {\n\t\t\tthis.cachedIsEdit = false;\n\t\t\t$(this.sectionProperties.container).removeClass('annotation-active reply-annotation-container modify-annotation-container');\n\t\t\tthis.removeLastBRTag(this.sectionProperties.nodeModifyText);\n\t\t\tif (this.sectionProperties.contentText.origText !== this.sectionProperties.nodeModifyText.innerText ||\n\t\t\t    this.sectionProperties.contentText.origHTML !== this.sectionProperties.nodeModifyText.innerHTML) {\n\t\t\t\tif(!document.hasFocus())\n\t\t\t\t\tapp.definitions.CommentSection.needFocus = this;\n\t\t\t\tif (!this.sectionProperties.contentText.uneditedHTML)\n\t\t\t\t\tthis.sectionProperties.contentText.uneditedHTML = this.sectionProperties.contentText.origHTML;\n\t\t\t\tif (!this.sectionProperties.contentText.uneditedText)\n\t\t\t\t\tthis.sectionProperties.contentText.uneditedText = this.sectionProperties.contentText.origText;\n\t\t\t\tcool.CommentSection.autoSavedComment = this;\n\t\t\t\tthis.onSaveComment(e);\n\t\t\t}\n\t\t\telse if (this.containerObject.testing) {\n\t\t\t\tvar insertButton = document.getElementById('menu-insertcomment');\n\t\t\t\tif (insertButton) {\n\t\t\t\t\tif (window.getComputedStyle(insertButton).display === 'none') {\n\t\t\t\t\t\tthis.onCancelClick(e);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\t// eslint-disable-next-line @typescript-eslint/explicit-module-boundary-types\n\tpublic onLostFocusReply (e: any): void {\n\t\tif (app.map._docLayer._docType === 'text' && this.map.mention?.isTypingMention()) {\n\t\t\treturn;\n\t\t}\n\t\tif (this.sectionProperties.nodeReplyText.innerText !== '') {\n\t\t\tif(!document.hasFocus())\n\t\t\t\tapp.definitions.CommentSection.needFocus = this;\n\t\t\tif (!this.sectionProperties.contentText.uneditedHTML)\n\t\t\t\tthis.sectionProperties.contentText.uneditedHTML = this.sectionProperties.contentText.origHTML;\n\t\t\tif (!this.sectionProperties.contentText.uneditedText)\n\t\t\t\tthis.sectionProperties.contentText.uneditedText = this.sectionProperties.contentText.origText;\n\t\t\tcool.CommentSection.autoSavedComment = this;\n\t\t\tthis.onReplyClick(e);\n\t\t}\n\t\telse {\n\t\t\tthis.sectionProperties.nodeReply.style.display = 'none';\n\t\t\tif (!this.sectionProperties.nodeModify || this.sectionProperties.nodeModify.style.display === 'none')\n\t\t\t\tthis.cachedIsEdit = false;\n\t\t}\n\t}\n\n\tpublic focus (): void {\n\t\tthis.sectionProperties.container.classList.add('annotation-active');\n\t\tthis.sectionProperties.nodeModifyText.focus({ focusVisible: true });\n\t\tthis.sectionProperties.nodeReplyText.focus({ focusVisible: true });\n\n\t\t// set cursor at the last position on refocus after autosave\n\t\tif (this.isModifying() && this.sectionProperties.nodeModifyText.childNodes.length > 0) {\n\t\t\tvar range = document.createRange()\n\t\t\tvar sel = document.getSelection()\n\t\t\trange.setStartAfter(this.sectionProperties.nodeModifyText.lastChild)\n\t\t\trange.collapse(true)\n\t\t\tsel.removeAllRanges()\n\t\t\tsel.addRange(range)\n\t\t}\n\n\t}\n\n\tpublic reply (): Comment {\n\t\tthis.sectionProperties.container.classList.add('reply-annotation-container');\n\t\tthis.sectionProperties.container.style.visibility = '';\n\t\tthis.sectionProperties.contentNode.style.display = '';\n\t\tthis.sectionProperties.nodeModify.style.display = 'none';\n\t\tthis.sectionProperties.nodeReply.style.display = '';\n\t\tthis.cachedIsEdit = true;\n\t\treturn this;\n\t}\n\n\tpublic edit (): Comment {\n\t\tthis.doPendingInitializationInView(true /* force */);\n\t\tthis.sectionProperties.container.classList.add('modify-annotation-container');\n\t\tthis.sectionProperties.nodeModify.style.display = '';\n\t\tthis.sectionProperties.nodeReply.style.display = 'none';\n\t\tthis.sectionProperties.container.style.visibility = '';\n\t\tthis.sectionProperties.contentNode.style.display = 'none';\n\t\tthis.cachedIsEdit = true;\n\t\treturn this;\n\t}\n\n\tpublic isEdit (): boolean {\n\t\treturn this.cachedIsEdit;\n\t}\n\n\tpublic isModifying(): boolean {\n\t\treturn !this.pendingInit && this.sectionProperties.nodeModify && this.sectionProperties.nodeModify.style.display !== 'none';\n\t}\n\n\tpublic static isAnyEdit (): Comment {\n\t\tvar section = app.sectionContainer && app.sectionContainer instanceof CanvasSectionContainer ?\n\t\t\tapp.sectionContainer.getSectionWithName(L.CSections.CommentList.name) : null;\n\t\tif (!section) {\n\t\t\treturn null;\n\t\t}\n\n\t\tvar commentList = section.sectionProperties.commentList;\n\t\tfor (var i in commentList) {\n\t\t\tvar modifyNode = commentList[i].sectionProperties.nodeModify;\n\t\t\tvar replyNode = commentList[i].sectionProperties.nodeReply;\n\t\t\tif (!commentList[i].pendingInit &&\n\t\t\t\t((modifyNode && modifyNode.style.display !== 'none') ||\n\t\t\t\t(replyNode && replyNode.style.display !== 'none')))\n\t\t\t\t\treturn commentList[i];\n\t\t}\n\t\treturn null;\n\t}\n\n\tpublic static isAnyFocus(): boolean {\n\t\tconst comment_: Comment = Comment.isAnyEdit();\n\n\t\t// We have a comment in edit mode. Is it focused?\n\t\tif (comment_ && (document.activeElement === comment_.sectionProperties.nodeModifyText || document.activeElement === comment_.sectionProperties.nodeReplyText))\n\t\t\treturn true;\n\n\t\treturn false;\n\t}\n\n\tpublic isDisplayed (): boolean {\n\t\treturn (this.sectionProperties.container.style && this.sectionProperties.container.style.visibility === '');\n\t}\n\n\tpublic onResize (): void {\n\t\tthis.updatePosition();\n\t}\n\n\tprivate isSelected(): boolean {\n\t\treturn this.sectionProperties.commentListSection.sectionProperties.selectedComment === this;\n\t}\n\n\t// eslint-disable-next-line @typescript-eslint/explicit-module-boundary-types\n\tprivate doesRectangleContainPoint (rectangle: any, point: Array<number>): boolean {\n\t\tif (point[0] >= rectangle[0] && point[0] <= rectangle[0] + rectangle[2]) {\n\t\t\tif (point[1] >= rectangle[1] && point[1] <= rectangle[1] + rectangle[3]) {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\t\treturn false;\n\t}\n\n\t/*\n\t\tpoint is the core pixel coordinate of the cursor.\n\t\tNot adjusted according to the view.\n\t\tFor adjusting, we need to take document top left and documentAnchor top left into account.\n\t\tNo need to do that for now.\n\t*/\n\tprivate checkIfCursorIsOnThisCommentWriter(rectangles: any, point: Array<number>) {\n\t\tfor (var i: number = 0; i < rectangles.length; i++) {\n\t\t\tif (this.doesRectangleContainPoint(rectangles[i], point)) {\n\t\t\t\tif (!this.isSelected()) {\n\t\t\t\t\tthis.sectionProperties.commentListSection.selectById(this.sectionProperties.data.id);\n\t\t\t\t}\n\t\t\t\tthis.stopPropagating();\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\t// If we are here, this comment is not selected.\n\t\tif (this.isSelected()) {\n\t\t\tif (this.isCollapsed)\n\t\t\t\tthis.setCollapsed();\n\t\t\tthis.sectionProperties.commentListSection.unselect();\n\t\t}\n\t}\n\n\t/// This event is Writer-only. Fired by CanvasSectionContainer.\n\tpublic onCursorPositionChanged(newPosition: cool.SimpleRectangle): void {\n\t\tvar x = newPosition.pX1;\n\t\tvar y = Math.round(newPosition.pCenter[1]);\n\t\tif (this.sectionProperties.pixelBasedOrgRectangles) {\n\t\t\tthis.checkIfCursorIsOnThisCommentWriter(this.sectionProperties.pixelBasedOrgRectangles, [x, y]);\n\t\t}\n\t}\n\n\t/// This event is Calc-only. Fired by CanvasSectionContainer.\n\t// eslint-disable-next-line @typescript-eslint/explicit-module-boundary-types\n\tpublic onCellAddressChanged(): void {\n\t\tif (this.sectionProperties.data.rectangles) {\n\t\t\tvar midX = this.containerObject.getDocumentAnchor()[0] + Math.round(app.calc.cellCursorRectangle.pCenter[0]);\n\t\t\tvar midY = this.containerObject.getDocumentAnchor()[1] + Math.round(app.calc.cellCursorRectangle.pCenter[1]);\n\n\t\t\tif (midX > this.sectionProperties.data.rectangles[0][0] && midX < this.sectionProperties.data.rectangles[0][0] + this.sectionProperties.data.rectangles[0][2]\n\t\t\t\t&& midY > this.sectionProperties.data.rectangles[0][1] && midY < this.sectionProperties.data.rectangles[0][1] + this.sectionProperties.data.rectangles[0][3]) {\n\t\t\t\tthis.sectionProperties.commentListSection.sectionProperties.calcCurrentComment = this;\n\t\t\t}\n\t\t\telse if (this.isSelected()) {\n\t\t\t\tthis.hide();\n\t\t\t\tthis.sectionProperties.commentListSection.sectionProperties.calcCurrentComment = null;\n\t\t\t}\n\t\t\telse if (this.sectionProperties.commentListSection.sectionProperties.calcCurrentComment == this)\n\t\t\t\tthis.sectionProperties.commentListSection.sectionProperties.calcCurrentComment = null;\n\t\t}\n\t}\n\n\tpublic onClick (point: Array<number>, e: MouseEvent): void {\n\t\tif (app.map._docLayer._docType === 'presentation' || app.map._docLayer._docType === 'drawing') {\n\t\t\tthis.sectionProperties.commentListSection.selectById(this.sectionProperties.data.id);\n\t\t\te.stopPropagation();\n\t\t\tthis.stopPropagating();\n\t\t}\n\t}\n\n\tpublic onDraw (): void {\n\t\tif (this.sectionProperties.showSelectedCoordinate) {\n\t\t\tif (app.map._docLayer._docType === 'text') {\n\t\t\t\tvar rectangles: Array<any> = this.sectionProperties.data.rectangles;\n\t\t\t\tif (rectangles) {\n\t\t\t\t\tthis.context.fillStyle = this.sectionProperties.usedTextColor;\n\t\t\t\t\tthis.context.globalAlpha = 0.25;\n\n\t\t\t\t\tfor (var i: number = 0; i < this.sectionProperties.data.rectangles.length;i ++) {\n\t\t\t\t\t\tvar x = rectangles[i][0] - this.myTopLeft[0];\n\t\t\t\t\t\tvar y = rectangles[i][1] - this.myTopLeft[1];\n\t\t\t\t\t\tvar w = rectangles[i][2] > 3 ? rectangles[i][2]: 3;\n\t\t\t\t\t\tvar h = rectangles[i][3];\n\n\t\t\t\t\t\tthis.context.fillRect(x, y, w , h);\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.context.globalAlpha = 1;\n\t\t\t\t}\n\t\t\t}\n\t\t\telse if (app.map._docLayer._docType === 'spreadsheet' &&\n\t\t\t\t parseInt(this.sectionProperties.data.tab) === app.map._docLayer._selectedPart) {\n\n\t\t\t\tvar cellSize = this.calcCellSize();\n\t\t\t\tif (cellSize[0] !== 0 && cellSize[1] !== 0) { // don't draw notes in hidden cells\n\t\t\t\t\t// `zoom` represents the current zoom level of the map, retrieved from `this.map.getZoom()`.\n\t\t\t\t\t// `baseSize` is a constant that defines the base size of the square at the initial zoom level.\n\t\t\t\t\t// `squareDim` calculates the dimension of the square, which dynamically adjusts based on the current zoom level.\n\t\t\t\t\t// The dimension increases proportionally to the zoom level by adding `zoom` to `baseSize`.\n\t\t\t\t\tvar margin = 1;\n\t\t\t\t\tvar baseSize = 2;\n\t\t\t\t\tvar zoom = this.map.getZoom();\n\t\t\t\t\tvar squareDim = baseSize + zoom;\n\n\t\t\t\t\tconst isRTL = this.isCalcRTL();\n\n\t\t\t\t\t// this.size may currently have an artificially wide size if mouseEnter without moveLeave seen\n\t\t\t\t\t// so fetch the real size\n\t\t\t\t\tvar x = isRTL ? margin : cellSize[0] - squareDim - margin;\n\t\t\t\t\tvar commentColor = getComputedStyle(document.body).getPropertyValue('--color-calc-comment');\n\t\t\t\t\tthis.context.fillStyle = commentColor;\n\t\t\t\t\tvar region = new Path2D();\n\t\t\t\t\tregion.moveTo(x, 0);\n\t\t\t\t\tregion.lineTo(x + squareDim, 0);\n\t\t\t\t\tregion.lineTo(x + (isRTL ? 0 : squareDim), squareDim);\n\t\t\t\t\tregion.closePath();\n\t\t\t\t\tthis.context.fill(region);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tpublic onMouseMove (point: Array<number>, dragDistance: Array<number>, e: MouseEvent): void {\n\t\treturn;\n\t}\n\n\tpublic onMouseUp (point: Array<number>, e: MouseEvent): void {\n\t\t// Hammer.js doesn't fire onClick event after touchEnd event.\n\t\t// CanvasSectionContainer fires the onClick event. But since Hammer.js is used for map, it disables the onClick for SectionContainer.\n\t\t// We will use this event as click event on touch devices, until we remove Hammer.js (then this code will be removed from here).\n\t\t// Control.ColumnHeader.js file is not affected by this situation, because map element (so Hammer.js) doesn't cover headers.\n\t\tif (!this.containerObject.isDraggingSomething() && (<any>window).mode.isMobile() || (<any>window).mode.isTablet()) {\n\t\t\tif (app.map._docLayer._docType === 'presentataion' || app.map._docLayer._docType === 'drawing')\n\t\t\t\tapp.map._docLayer._openCommentWizard(this);\n\t\t\tthis.onMouseEnter();\n\t\t\tthis.onClick(point, e);\n\t\t}\n\t}\n\n\tpublic onMouseDown (point: Array<number>, e: MouseEvent): void {\n\t\treturn;\n\t}\n\n\tprivate calcContinueWithMouseEvent (): boolean {\n\t\tif (app.map._docLayer._docType === 'spreadsheet') {\n\t\t\tvar conditions: boolean = !this.isEdit();\n\t\t\tif (conditions) {\n\t\t\t\tvar sc = this.sectionProperties.commentListSection.sectionProperties.selectedComment;\n\t\t\t\tif (sc)\n\t\t\t\t\tconditions = sc.sectionProperties.data.id !== 'new';\n\t\t\t}\n\t\t\treturn conditions;\n\t\t}\n\t\telse {\n\t\t\treturn false;\n\t\t}\n\t}\n\n\tpublic calcCellSize (): number[] {\n\t\tvar cellPos = app.map._docLayer._cellRangeToTwipRect(this.sectionProperties.data.cellRange).toRectangle();\n\t\treturn [Math.round((cellPos[2]) * app.twipsToPixels), Math.round((cellPos[3]) * app.twipsToPixels)];\n\t}\n\n\tpublic onMouseEnter (): void {\n\t\tif (this.calcContinueWithMouseEvent()) {\n\t\t\t// When mouse is above this section, comment's HTML element will be shown.\n\t\t\t// If mouse pointer goes to HTML element, onMouseLeave event shouldn't be fired.\n\t\t\t// But mouse pointer will have left the borders of this section and onMouseLeave event will be fired.\n\t\t\t// Let's do it properly, when mouse is above this section, we will make this section's size bigger and onMouseLeave event will not be fired.\n\t\t\tif (parseInt(this.sectionProperties.data.tab) === app.map._docLayer._selectedPart) {\n\t\t\t\tvar sc = this.sectionProperties.commentListSection.sectionProperties.selectedComment;\n\t\t\t\tif (sc) {\n\t\t\t\t\tif (!sc.isEdit())\n\t\t\t\t\t\tsc.hide();\n\t\t\t\t\telse\n\t\t\t\t\t\treturn; // Another comment is being edited. Return.\n\t\t\t\t}\n\n\t\t\t\tvar containerWidth: number = this.sectionProperties.container.getBoundingClientRect().width;\n\t\t\t\tvar cellPos = app.map._docLayer._cellRangeToTwipRect(this.sectionProperties.data.cellRange).toRectangle();\n\t\t\t\tthis.size = [Math.round((cellPos[2]) * app.twipsToPixels + containerWidth), Math.round((cellPos[3]) * app.twipsToPixels)];\n\t\t\t\tthis.sectionProperties.commentListSection.selectById(this.sectionProperties.data.id);\n\t\t\t\tthis.show();\n\t\t\t}\n\t\t}\n\t}\n\n\tpublic onMouseLeave (point: Array<number>): void {\n\t\tif (this.calcContinueWithMouseEvent()) {\n\t\t\tif (parseInt(this.sectionProperties.data.tab) === app.map._docLayer._selectedPart) {\n\t\t\t\t// Revert the changes we did on \"onMouseEnter\" event.\n\t\t\t\tthis.size = this.calcCellSize();\n\t\t\t\tif (point) {\n\t\t\t\t\tthis.hide();\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tpublic onNewDocumentTopLeft (): void {\n\t\tthis.doPendingInitializationInView();\n\t\tthis.updatePosition();\n\t}\n\n\tpublic onCommentDataUpdate(): void {\n\t\tthis.doPendingInitializationInView();\n\t\tthis.updatePosition();\n\t}\n\n\tpublic onRemove (): void {\n\t\tthis.sectionProperties.commentContainerRemoved = true;\n\n\t\tif (this.sectionProperties.commentListSection.sectionProperties.selectedComment === this)\n\t\t\tthis.sectionProperties.commentListSection.sectionProperties.selectedComment = null;\n\n\t\tthis.sectionProperties.commentListSection.hideArrow();\n\t\tvar container = this.sectionProperties.container;\n\n\t\tif (this.sectionProperties.commentMarkerSubSection !== null)\n\t\t\tapp.sectionContainer.removeSection(this.sectionProperties.commentMarkerSubSection.name);\n\n\t\tif (container && container.parentElement) {\n\t\t\tvar c: number = 0;\n\t\t\twhile (c < 10) {\n\t\t\t\ttry {\n\t\t\t\t\tcontainer.parentElement.removeChild(container);\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tcatch (e) {\n\t\t\t\t\tc++;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tpublic isRootComment(): boolean {\n\t\treturn this.sectionProperties.data.parent === '0';\n\t}\n\n\tpublic setAsRootComment(): void {\n\t\tthis.sectionProperties.data.parent = '0';\n\t\tif (app.map._docLayer._docType === 'text')\n\t\t\tthis.sectionProperties.data.parentId = '0';\n\t}\n\n\tpublic getChildrenLength(): number {\n\t\treturn this.sectionProperties.children.length;\n\t}\n\n\tpublic getChildByIndex(index: number): Comment {\n\t\tif (this.sectionProperties.children.length > index)\n\t\t\treturn this.sectionProperties.children[index];\n\t\telse\n\t\t\treturn null;\n\t}\n\n\tpublic removeChildByIndex(index: number): void {\n\t\tif (this.sectionProperties.children.length > index)\n\t\t\tthis.sectionProperties.children.splice(index, 1);\n\t}\n\n\tpublic getParentCommentId(): string {\n\t\tif (this.sectionProperties.data.parent && this.sectionProperties.data.parent !== '0')\n\t\t\treturn this.sectionProperties.data.parent;\n\t\telse\n\t\t\treturn null;\n\t}\n\n\tpublic getIndexOfChild(comment: Comment): number {\n\t\treturn this.sectionProperties.children.indexOf(comment);\n\t}\n\n\tpublic getChildLevel(): number {\n\t\tif (this.isRootComment()) return 0;\n\t\tconst parentComment = this.sectionProperties.commentListSection.getComment(this.getParentCommentId());\n\t\tif (parentComment) return parentComment.getChildLevel() + 1;\n\t\treturn 1; // Comment list not fully initialized but we know we are not root\n\t}\n\n\tpublic getCommentHeight(invalidateCache: boolean = true): number {\n\t\tif (invalidateCache)\n\t\t\tthis.cachedCommentHeight = null;\n\t\tif (this.cachedCommentHeight === null)\n\t\t\tthis.cachedCommentHeight = this.sectionProperties.container.getBoundingClientRect().height\n\t\t\t- this.sectionProperties.childLinesNode.getBoundingClientRect().height;\n\t\treturn this.cachedCommentHeight;\n\t}\n\n\tpublic setCollapsed(): void {\n\t\tthis.isCollapsed = true;\n\n\t\tif (!this.isEdit())\n\t\t\tthis.show();\n\n\t\tif (this.isRootComment() || app.map._docLayer._docType === 'presentation' || app.map._docLayer._docType === 'drawing') {\n\t\t\tthis.sectionProperties.container.style.display = '';\n\t\t\tthis.sectionProperties.container.style.visibility = 'hidden';\n\t\t}\n\t\tthis.updateThreadInfoIndicator();\n\t\tif (this.sectionProperties.data.resolved === 'false'\n\t\t|| this.sectionProperties.commentListSection.sectionProperties.showResolved\n\t\t|| app.map._docLayer._docType === 'presentation'\n\t\t|| app.map._docLayer._docType === 'drawing')\n\t\t\tL.DomUtil.addClass(this.sectionProperties.container, 'cool-annotation-collapsed-show');\n\t}\n\n\tpublic updateThreadInfoIndicator(replycount:number | string = -1): void {\n\t\tif (app.map._docLayer._docType === 'spreadsheet')\n\t\t\treturn;\n\n\t\tvar innerText;\n\t\tif (this.isEdit())\n\t\t\tinnerText = '!';\n\t\telse if (replycount === '!' || typeof replycount === \"number\" && replycount > 0)\n\t\t\tinnerText = replycount;\n\t\telse\n\t\t\tinnerText = '';\n\n\t\tif (this.sectionProperties.collapsedInfoNode.innerText != innerText)\n\t\t\tthis.sectionProperties.collapsedInfoNode.innerText = innerText;\n\n\t\tif (innerText === '' || this.isContainerVisible())\n\t\t\tthis.sectionProperties.collapsedInfoNode.style.display = 'none';\n\t\telse if ((!this.isContainerVisible() && this.sectionProperties.collapsedInfoNode.innerText !== ''))\n\t\t\tthis.sectionProperties.collapsedInfoNode.style.display = '';\n\t}\n\n\tpublic setExpanded(): void {\n\t\tif (!this.isCollapsed)\n\t\t\treturn;\n\t\tthis.isCollapsed = false;\n\t\tif (this.sectionProperties.data.resolved === 'false' || this.sectionProperties.commentListSection.sectionProperties.showResolved) {\n\t\t\tthis.sectionProperties.container.style.display = '';\n\t\t\tthis.sectionProperties.container.style.visibility = '';\n\t\t}\n\t\tif (app.map._docLayer._docType === 'text')\n\t\t\tthis.sectionProperties.collapsedInfoNode.style.display = 'none';\n\t\tL.DomUtil.removeClass(this.sectionProperties.container, 'cool-annotation-collapsed-show');\n\t}\n\n\tpublic autoCompleteMention(username: string, profileLink: string, replacement: string): void {\n\t\tconst selection = window.getSelection();\n\t\tif (!selection.rangeCount) return;\n\n\t\tconst range = selection.getRangeAt(0);\n\n\t\tconst cursorPosition = range.endOffset;\n\t\tconst container = range.startContainer;\n\n\t\tconst containerText = container.textContent || '';\n\t\tconst mentionStart = containerText.lastIndexOf(replacement, cursorPosition);\n\n\t\tif (mentionStart !== -1) {\n\t\t\tconst mentionEnd = mentionStart + replacement.length;\n\n\t\t\tconst beforeMention = containerText.substring(0, mentionStart);\n\t\t\tconst afterMention = containerText.substring(mentionEnd);\n\n\t\t\tconst hyperlink = document.createElement('a');\n\t\t\thyperlink.href = profileLink;\n\t\t\thyperlink.textContent = `@${username}`;\n\n\t\t\tcontainer.textContent = beforeMention;\n\t\t\tcontainer.parentNode?.insertBefore(hyperlink, container.nextSibling);\n\n\t\t\tconst afterTextNode = document.createTextNode(afterMention);\n\t\t\tconst extraSpaceNode = document.createTextNode('\\u00A0');\n\t\t\thyperlink.parentNode?.insertBefore(extraSpaceNode, hyperlink.nextSibling);\n\t\t\thyperlink.parentNode?.insertBefore(afterTextNode, extraSpaceNode.nextSibling);\n\n\t\t\tconst newRange = document.createRange();\n\t\t\tnewRange.setStartAfter(extraSpaceNode);\n\t\t\tnewRange.setEndAfter(extraSpaceNode);\n\n\t\t\tselection.removeAllRanges();\n\t\t\tselection.addRange(newRange);\n\t\t}\n\t}\n}\n\n}\n\napp.definitions.Comment = cool.Comment;\n"]}