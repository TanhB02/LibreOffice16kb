{"version":3,"file":"SplitterLinesSection.js","sourceRoot":"","sources":["../../../../../../../../../../../TanhX/online/browser/src/canvas/sections/SplitterLinesSection.ts"],"names":[],"mappings":"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","sourcesContent":["/* global Proxy _ */\n/*\n * Copyright the Collabora Online contributors.\n *\n * SPDX-License-Identifier: MPL-2.0\n *\n * This Source Code Form is subject to the terms of the Mozilla Public\n * License, v. 2.0. If a copy of the MPL was not distributed with this\n * file, You can obtain one at http://mozilla.org/MPL/2.0/.\n */\n\nclass SplitterLinesSection extends CanvasSectionObject {\n\tname: string = L.CSections.Splitter.name;\n\tinteractable: boolean = false;\n\tprocessingOrder: number = L.CSections.Splitter.processingOrder;\n\tdrawingOrder: number = L.CSections.Splitter.drawingOrder;\n\tzIndex: number = L.CSections.Splitter.zIndex;\n\tdocumentObject: boolean = true;\n\n\tconstructor() {\n\t\tsuper();\n\t}\n\n\tonInitialize(): void {\n\t\tconst splittersDataDiv = document.createElement('div');\n\t\tsplittersDataDiv.className = 'splitters-data';\n\n\t\tconst canvasContainer = document.getElementById('canvas-container');\n\t\tif (canvasContainer) canvasContainer.appendChild(splittersDataDiv);\n\n\t\tthis.size = [1000000, 1000000];\n\t\tthis.position = [0, 0];\n\n\t\tthis.sectionProperties = {\n\t\t\tfillColor: 'rgba(0, 0, 0, 0)',\n\t\t\tfillOpacity: 0,\n\t\t\tthickness: 0,\n\t\t};\n\n\t\tthis.readCSSProperties();\n\t}\n\n\treadCSSProperties() {\n\t\tconst splittersDataDiv = document.querySelector('.splitters-data');\n\n\t\tif (splittersDataDiv) {\n\t\t\tthis.sectionProperties.fillColor =\n\t\t\t\tgetComputedStyle(splittersDataDiv).getPropertyValue('color');\n\t\t\tthis.sectionProperties.fillOpacity =\n\t\t\t\tgetComputedStyle(splittersDataDiv).getPropertyValue('opacity');\n\t\t\tthis.sectionProperties.thickness =\n\t\t\t\tparseFloat(\n\t\t\t\t\tgetComputedStyle(splittersDataDiv)\n\t\t\t\t\t\t.getPropertyValue('border-top-width')\n\t\t\t\t\t\t.replace('px', ''),\n\t\t\t\t) * app.dpiScale;\n\t\t}\n\t}\n\n\tprivate setBoxGradient(splitPos: any, isVertical: boolean) {\n\t\tlet selectionBackgroundGradient = null;\n\n\t\t// last row geometry data will be a good for setting deafult raw height\n\t\tconst spanlist =\n\t\t\tapp.map._docLayer.sheetGeometry.getRowsGeometry()._visibleSizes._spanlist;\n\t\tconst rowData = spanlist[spanlist.length - 1];\n\n\t\t// Create a linear gradient based on the extracted color stops\n\t\t// get raw data from sheet geometry. use index = 1\n\t\tconst deafultRowSize = rowData.data.sizecore;\n\t\t// gradient width should be half a default row hight.\n\t\tconst gradientWidth: number = Math.ceil(deafultRowSize / 2);\n\t\t//adjust horizontal position for RTL mode\n\t\tsplitPos.x = this.isCalcRTL() ? this.size[0] - splitPos.x : splitPos.x;\n\t\t// Create a linear gradient based on the extracted color stops\n\t\tselectionBackgroundGradient = this.createSplitLineGradient(\n\t\t\tsplitPos,\n\t\t\tgradientWidth,\n\t\t\tisVertical,\n\t\t);\n\n\t\treturn { selectionBackgroundGradient, gradientWidth };\n\t}\n\n\tprivate createSplitLineGradient(\n\t\tsplitPos: any,\n\t\tgradientWidth: number,\n\t\tisVertSplitter: boolean,\n\t) {\n\t\tlet linearGradient = null;\n\t\tconst colorStops = [\n\t\t\t{ colorCode: this.sectionProperties.fillColor, offset: 0 },\n\t\t\t{ colorCode: 'rgba(240, 240, 240, 0)', offset: 1 },\n\t\t];\n\n\t\tif (isVertSplitter) {\n\t\t\tlinearGradient = this.context.createLinearGradient(\n\t\t\t\t0,\n\t\t\t\tsplitPos.y,\n\t\t\t\t0,\n\t\t\t\tsplitPos.y + gradientWidth,\n\t\t\t);\n\t\t} else {\n\t\t\tlet x0 = splitPos.x;\n\t\t\tlet x1 = splitPos.x + gradientWidth;\n\t\t\tif (this.isCalcRTL()) {\n\t\t\t\tx0 = splitPos.x - gradientWidth;\n\t\t\t\tx1 = splitPos.x;\n\t\t\t}\n\t\t\tlinearGradient = this.context.createLinearGradient(x0, 0, x1, 0);\n\t\t}\n\n\t\t// Add color stops to the gradient\n\t\tfor (let i = 0; i < colorStops.length; i++) {\n\t\t\t// set offset with colorcode & handle special case for horizontal line in RTL mode\n\t\t\tconst offset =\n\t\t\t\t!isVertSplitter && this.isCalcRTL()\n\t\t\t\t\t? colorStops[colorStops.length - i - 1].offset\n\t\t\t\t\t: colorStops[i].offset;\n\t\t\tlinearGradient.addColorStop(offset, colorStops[i].colorCode);\n\t\t}\n\n\t\treturn linearGradient;\n\t}\n\n\tprivate GetColumnHeaderHeight(): number {\n\t\tif (\n\t\t\tthis.containerObject.getSectionWithName(L.CSections.ColumnHeader.name)\n\t\t) {\n\t\t\treturn this.containerObject.getSectionWithName(\n\t\t\t\tL.CSections.ColumnHeader.name,\n\t\t\t).size[1];\n\t\t} else return 0;\n\t}\n\n\tprivate GetRowHeaderWidth(): number {\n\t\tif (this.containerObject.getSectionWithName(L.CSections.RowHeader.name)) {\n\t\t\treturn this.containerObject.getSectionWithName(L.CSections.RowHeader.name)\n\t\t\t\t.size[0];\n\t\t} else return 0;\n\t}\n\n\tonDraw(): void {\n\t\tconst splitPanesContext = app.map._docLayer.getSplitPanesContext();\n\n\t\tif (splitPanesContext) {\n\t\t\tvar splitPos = splitPanesContext.getSplitPos();\n\n\t\t\tif (splitPos.x || splitPos.y) {\n\t\t\t\tthis.context.globalAlpha = this.sectionProperties.fillOpacity;\n\t\t\t\tthis.context.lineWidth = this.sectionProperties.thickness;\n\n\t\t\t\tif (splitPos.x) {\n\t\t\t\t\tlet width, style;\n\t\t\t\t\tif (this.documentTopLeft[0] === 0) {\n\t\t\t\t\t\twidth = this.sectionProperties.thickness;\n\t\t\t\t\t\tstyle = this.sectionProperties.fillColor;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tconst temp = this.setBoxGradient(splitPos.clone(), false);\n\t\t\t\t\t\twidth = temp.gradientWidth;\n\t\t\t\t\t\tstyle = temp.selectionBackgroundGradient;\n\t\t\t\t\t}\n\t\t\t\t\tthis.context.fillStyle = style;\n\n\t\t\t\t\tthis.context.fillRect(\n\t\t\t\t\t\tsplitPos.x * app.dpiScale,\n\t\t\t\t\t\t-this.GetColumnHeaderHeight(),\n\t\t\t\t\t\twidth,\n\t\t\t\t\t\tthis.size[1],\n\t\t\t\t\t);\n\t\t\t\t}\n\n\t\t\t\tif (splitPos.y) {\n\t\t\t\t\tlet width, style;\n\t\t\t\t\tif (this.documentTopLeft[1] === 0) {\n\t\t\t\t\t\twidth = this.sectionProperties.thickness;\n\t\t\t\t\t\tstyle = this.sectionProperties.fillColor;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tconst temp = this.setBoxGradient(splitPos.clone(), true);\n\t\t\t\t\t\twidth = temp.gradientWidth;\n\t\t\t\t\t\tstyle = temp.selectionBackgroundGradient;\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.context.fillStyle = style;\n\n\t\t\t\t\tthis.context.fillRect(\n\t\t\t\t\t\t-this.GetRowHeaderWidth(),\n\t\t\t\t\t\tsplitPos.y * app.dpiScale,\n\t\t\t\t\t\tthis.size[0],\n\t\t\t\t\t\twidth,\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tthis.context.globalAlpha = 1;\n\t}\n}\n"]}