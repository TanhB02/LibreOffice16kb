{"version":3,"file":"Control.JSDialog.js","sourceRoot":"","sources":["../../../../../../../../../../TanhX/online/browser/src/control/Control.JSDialog.js"],"names":[],"mappings":"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","sourcesContent":["/* -*- js-indent-level: 8 -*- */\n\n/*\n * Copyright the Collabora Online contributors.\n *\n * SPDX-License-Identifier: MPL-2.0\n *\n * This Source Code Form is subject to the terms of the Mozilla Public\n * License, v. 2.0. If a copy of the MPL was not distributed with this\n * file, You can obtain one at http://mozilla.org/MPL/2.0/.\n */\n\n/*\n * L.Control.JSDialog - class which creates and updates dialogs, popups, snackbar\n */\n\n/* global JSDialog Hammer app _ */\nL.Control.JSDialog = L.Control.extend({\n\toptions: {},\n\tdialogs: {},\n\tdraggingObject: null,\n\n\tonAdd: function (map) {\n\t\tthis.map = map;\n\n\t\tthis.map.on('jsdialog', this.onJSDialog, this);\n\t\tthis.map.on('jsdialogupdate', this.onJSUpdate, this);\n\t\tthis.map.on('jsdialogaction', this.onJSAction, this);\n\t\tthis.map.on('zoomend', this.onZoomEnd, this);\n\t\tthis.map.on('closealldialogs', this.onCloseAll, this);\n\t\tthis.map.on('closeAutoFilterDialog', this.closePopupsOnTabChange, this);\n\t\tL.DomEvent.on(window.document, 'keyup', this.onKeyUp, this);\n\n\t},\n\n\tonRemove: function() {\n\t\tthis.map.off('jsdialog', this.onJSDialog, this);\n\t\tthis.map.off('jsdialogupdate', this.onJSUpdate, this);\n\t\tthis.map.off('jsdialogaction', this.onJSAction, this);\n\t\tthis.map.off('zoomend', this.onZoomEnd, this);\n\t\tthis.map.off('closealldialogs', this.onCloseAll, this);\n\t\tthis.map.off('closeAutoFilterDialog', this.closePopupsOnTabChange, this);\n\t\tL.DomEvent.off(window.document, 'keyup', this.onKeyUp, this);\n\n\t},\n\n\thasDialogOpened: function() {\n\t\tvar dialogs = this.dialogs;\n\t\treturn Object.keys(dialogs)\n\t\t\t.filter(function (key) {\n\t\t\t\treturn key != 'snackbar' && dialogs[key].isDropdown !== true;\n\t\t\t})\n\t\t\t.length > 0;\n\t},\n\n\thasDropdownOpened: function() {\n\t\treturn Object.values(this.dialogs)\n\t\t\t.filter(function (dialog) { return dialog.isDropdown === true; })\n\t\t\t.length > 0;\n\t},\n\n\thasSnackbarOpened: function() {\n\t\treturn Object.keys(this.dialogs)\n\t\t\t.filter(function (key) { return key == 'snackbar'; })\n\t\t\t.length > 0;\n\t},\n\n\tclearDialog: function(id) {\n\t\tconst dialogInfo = this.dialogs[id];\n\t\tconst builder = dialogInfo.builder;\n\n\t\tapp.layoutingService.appendLayoutingTask(() => {\n\t\t\tL.DomUtil.remove(dialogInfo.container);\n\n\t\t\tif (dialogInfo.overlay && !dialogInfo.isSubmenu)\n\t\t\t\tL.DomUtil.remove(dialogInfo.overlay);\n\n\t\t\tdelete this.dialogs[id];\n\t\t});\n\n\t\treturn builder;\n\t},\n\n\tclose: function(id, sendCloseEvent) {\n\t\tif (id !== undefined && this.dialogs[id]) {\n\t\t\tconst dialog = this.dialogs[id];\n\t\t\tif (!sendCloseEvent && dialog.overlay && !dialog.isSubmenu) {\n\t\t\t\tapp.layoutingService.appendLayoutingTask(\n\t\t\t\t\t() => { L.DomUtil.remove(dialog.overlay); });\n\t\t\t}\n\n\t\t\tif (dialog.timeoutId)\n\t\t\t\tclearTimeout(dialog.timeoutId);\n\n\t\t\tif (dialog.isPopup)\n\t\t\t\tthis.closePopover(id, sendCloseEvent);\n\t\t\telse\n\t\t\t\tthis.closeDialog(id, sendCloseEvent);\n\t\t}\n\t},\n\n\tcloseAll: function(leaveSnackbar) {\n\t\tvar dialogs = Object.keys(this.dialogs);\n\t\tfor (var i = 0; i < dialogs.length; i++) {\n\t\t\tif (leaveSnackbar && dialogs[i] && dialogs[i] === 'snackbar')\n\t\t\t\tcontinue;\n\n\t\t\tthis.close(dialogs[i], app.idleHandler._active);\n\t\t}\n\t},\n\n\tcloseAllDropdowns: function() {\n\t\tvar dialogs = Object.values(this.dialogs);\n\t\tfor (var i = 0; i < dialogs.length; i++) {\n\t\t\tif (dialogs[i] && !dialogs[i].isDropdown)\n\t\t\t\tcontinue;\n\n\t\t\tthis.close(dialogs[i].id, false);\n\t\t}\n\t},\n\n\tcloseDialog: function(id, sendCloseEvent) {\n\t\tif (id === undefined || !this.dialogs[id]) {\n\t\t\tconsole.warn('missing dialog data');\n\t\t\treturn;\n\t\t}\n\n\t\tthis.focusToLastElement(id);\n\n\t\tvar builder = this.clearDialog(id);\n\t\tif (sendCloseEvent !== false && builder)\n\t\t\tbuilder.callback('dialog', 'close', {id: '__DIALOG__'}, null, builder);\n\t},\n\n\t// sendCloseEvent means that we only send a command to the server\n\t// we want to kill HTML popup when we receive feedback from the server\n\tclosePopover: function(id, sendCloseEvent) {\n\t\tif (id === undefined || !this.dialogs[id]) {\n\t\t\tconsole.warn('missing popover data');\n\t\t\treturn;\n\t\t}\n\n\t\tvar clickToClose = this.dialogs[id].clickToClose;\n\t\tvar builder = this.dialogs[id].builder;\n\n\t\tif (sendCloseEvent) {\n\t\t\t// first try to close the dropdown if exists\n\t\t\tif (clickToClose && typeof clickToClose.closeDropdown === 'function')\n\t\t\t\tclickToClose.closeDropdown();\n\t\t\tif (clickToClose && L.DomUtil.hasClass(clickToClose, 'menubutton'))\n\t\t\t\tclickToClose.click();\n\t\t\telse if (builder)\n\t\t\t\tbuilder.callback('popover', 'close', {id: '__POPOVER__'}, null, builder);\n\t\t\telse\n\t\t\t\tconsole.warn('closePopover: no builder');\n\t\t}\n\t\telse {\n\t\t\t// Close handler for Dropdown which requires to setup aria properties\n\t\t\tconst popupParent = this.dialogs[id].popupParent;\n\t\t\tif (popupParent && typeof popupParent._onClose === 'function')\n\t\t\t\tpopupParent._onClose();\n\n\t\t\t// Need to change focus to last element before we clear the current dialog\n\t\t\tthis.focusToLastElement(id);\n\t\t\tthis.clearDialog(id);\n\t\t\treturn;\n\t\t}\n\n\t\tthis.focusToLastElement(id);\n\t},\n\n\tonCloseAll: function() {\n\t\tthis.closeAll(/*leaveSnackbar*/ true);\n\t\t// should also close all dropdowns on close all dialogs\n\t\tthis.closeAllDropdowns();\n\t},\n\n\tfocusToLastElement: function(id) {\n\t\tconst dialog = this.dialogs[id];\n\t\tapp.layoutingService.appendLayoutingTask(() => {\n\t\t\tif (!dialog.lastFocusedElement) {\n\t\t\t\tthis.map.focus();\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\ttry {\n\t\t\t\tdialog.lastFocusedElement.focus();\n\t\t\t}\n\t\t\tcatch (error) {\n\t\t\t\tconsole.debug('Cannot focus last element in dialog with id: ' + id);\n\t\t\t\tthis.map.focus();\n\t\t\t}\n\t\t});\n\t},\n\n\tsetTabs: function() {\n\t\tconsole.error('setTabs: not implemented in dialogs.');\n\t},\n\n\tselectedTab: function() {\n\t\t// nothing to do here\n\t},\n\n\t_getDefaultButtonId: function(widgets) {\n\t\tfor (var i in widgets) {\n\t\t\tif (widgets[i].type === 'pushbutton' || widgets[i].type === 'okbutton') {\n\t\t\t\tif (widgets[i].has_default === true)\n\t\t\t\t\treturn widgets[i].id;\n\t\t\t}\n\n\t\t\tif (widgets[i].children) {\n\t\t\t\tvar found = this._getDefaultButtonId(widgets[i].children);\n\t\t\t\tif (found)\n\t\t\t\t\treturn found;\n\t\t\t}\n\t\t}\n\n\t\treturn null;\n\t},\n\n\tfadeOutDialog: function(instance) {\n\t\tif (!instance.id)\n\t\t\treturn;\n\n\t\tconst dialogInfo = this.dialogs[instance.id];\n\t\tif (!dialogInfo)\n\t\t\treturn;\n\n\t\tconst container = dialogInfo.container;\n\n\t\tapp.layoutingService.appendLayoutingTask(() => {\n\t\t\tL.DomUtil.addClass(container, 'fadeout');\n\n\t\t\tlet timeoutId = null;\n\t\t\tconst finallyClose = () => {\n\t\t\t\tinstance.that.close(instance.id, false);\n\t\t\t\tclearTimeout(timeoutId);\n\t\t\t};\n\n\t\t\tcontainer.onanimationend = finallyClose;\n\t\t\t// be sure it will be removed if onanimationend will not be executed\n\t\t\ttimeoutId = setTimeout(finallyClose, 700);\n\t\t});\n\t},\n\n\tgetOrCreateOverlay: function(instance) {\n\t\t// Submenu is created inside the same overlay as parent dropdown\n\t\tif (instance.isDropdown && instance.isSubmenu) {\n\t\t\tinstance.overlay = document.body.querySelector('.jsdialog-overlay');\n\t\t\treturn;\n\t\t}\n\n\t\t// Dialogue overlay which will allow automatic positioning and cancellation of the dialogue if cancellable.\n\t\tvar overlay = L.DomUtil.get(instance.id + '-overlay');\n\t\tif (!overlay) {\n\n\t\t\tif (instance.noOverlay)\n\t\t\t\treturn;\n\n\t\t\toverlay = L.DomUtil.create('div', 'jsdialog-overlay ' + (instance.cancellable && !instance.hasOverlay ? 'cancellable' : ''), instance.containerParent);\n\t\t\toverlay.id = instance.id + '-overlay';\n\t\t\tif (instance.cancellable) {\n\t\t\t\t// dropdowns are online-only components, don't exist in core\n\t\t\t\tvar hasToNotifyServer = !instance.isDropdown;\n\t\t\t\toverlay.onclick = () => { this.close(instance.id, hasToNotifyServer); };\n\t\t\t}\n\t\t}\n\t\tinstance.overlay = overlay;\n\t},\n\n\tisOnlyChild: function(instance) {\n\t\tconst isMenu = instance.children && instance.children.length\n\t\t\t&& instance.children[0].id === '__MENU__';\n\t\tconst isOnlyChild = instance.children && instance.children.length &&\n\t\t\tinstance.children[0].children && instance.children[0].children.length === 1;\n\t\treturn isMenu || isOnlyChild;\n\t},\n\n\tcreateContainer: function(instance, documentFragment) {\n\t\t// it has to be form to handle default button\n\t\tinstance.container = L.DomUtil.create('div', 'jsdialog-window', documentFragment);\n\t\tinstance.container.id = instance.id;\n\n\t\tinstance.form = L.DomUtil.create('form', 'jsdialog-container ui-dialog ui-widget-content lokdialog_container', instance.container);\n\t\tinstance.form.setAttribute('role', 'dialog');\n\t\tinstance.form.setAttribute('aria-labelledby', instance.title);\n\t\tinstance.form.setAttribute('autocomplete', 'off');\n\t\t// Prevent overlay from getting the click, except if we want click to dismiss\n\t\t// Like in the case of the inactivity message.\n\t\t// https://github.com/CollaboraOnline/online/issues/7403\n\t\tif (!instance.clickToDismiss) {\n\t\t\tinstance.container.onclick = function(e) { e.stopPropagation(); };\n\t\t}\n\n\t\tif (instance.collapsed && (instance.collapsed === 'true' || instance.collapsed === true))\n\t\t\tL.DomUtil.addClass(instance.container, 'collapsed');\n\n\t\t// prevent from reloading\n\t\tinstance.form.addEventListener('submit', (event) => { event.preventDefault(); });\n\n\t\tinstance.defaultButtonId = this._getDefaultButtonId(instance.children);\n\n\t\tif (this.isOnlyChild(instance))\n\t\t\tinstance.isOnlyChild = true;\n\n\t\t// it has to be first button in the form\n\t\tvar defaultButton = L.DomUtil.createWithId('button', 'default-button', instance.form);\n\t\tdefaultButton.style.display = 'none';\n\t\tdefaultButton.onclick = function() {\n\t\t\tif (instance.defaultButtonId) {\n\t\t\t\tvar button = instance.form.querySelector('#' + instance.defaultButtonId);\n\t\t\t\tif (button)\n\t\t\t\t\tbutton.click();\n\t\t\t}\n\t\t};\n\n\t\tif (instance.haveTitlebar) {\n\t\t\tinstance.titlebar = L.DomUtil.create('div', 'ui-dialog-titlebar ui-corner-all ui-widget-header ui-helper-clearfix', instance.form);\n\t\t\tvar title = L.DomUtil.create('h2', 'ui-dialog-title', instance.titlebar);\n\t\t\ttitle.innerText = instance.title;\n\t\t\tinstance.titleCloseButton = L.DomUtil.create('button', 'ui-button ui-corner-all ui-widget ui-button-icon-only ui-dialog-titlebar-close', instance.titlebar);\n\t\t\tconst titleCloseButtonText = _('Close dialog');\n\t\t\tinstance.titleCloseButton.setAttribute('aria-label', titleCloseButtonText);\n\t\t\tinstance.titleCloseButton.setAttribute('title', titleCloseButtonText);\n\t\t\tinstance.titleCloseButton.tabIndex = '0';\n\t\t\tL.DomUtil.create('span', 'ui-button-icon ui-icon ui-icon-closethick', instance.titleCloseButton);\n\t\t}\n\n\t\tif (instance.isModalPopUp || instance.isDocumentAreaPopup || instance.isSnackbar)\n\t\t\tL.DomUtil.addClass(instance.container, 'modalpopup');\n\n\t\tif (instance.isModalPopUp && !instance.popupParent) // Special case for menu popups (they are also modal dialogues).\n\t\t\tinstance.overlay.classList.add('dimmed');\n\n\t\tif (instance.isSnackbar) {\n\t\t\tL.DomUtil.addClass(instance.container, 'snackbar');\n\t\t\tL.DomUtil.addClass(instance.form, 'snackbar');\n\t\t}\n\n\t\tinstance.content = L.DomUtil.create('div', 'jsdialog lokdialog ui-dialog-content ui-widget-content' + (instance.isOnlyChild ? ' one-child-popup' : ''), instance.form);\n\n\t\tthis.dialogs[instance.id] = {};\n\t},\n\n\tcreateDialog: function(instance) {\n\t\tinstance.builder = new L.control.jsDialogBuilder(\n\t\t\t{\n\t\t\t\twindowId: instance.id,\n\t\t\t\tmobileWizard: this,\n\t\t\t\tmap: this.map,\n\t\t\t\tcssClass: 'jsdialog' + (instance.isAutoPopup ? ' autofilter' : '') + (instance.isOnlyChild ? ' one-child-popup' : ''),\n\t\t\t\tcallback: instance.callback\n\t\t\t});\n\n\t\tinstance.builder.build(instance.content, [instance]);\n\t\tinstance.builder.setContainer(instance.content);\n\t\tvar primaryBtn = instance.content.querySelector('#' + instance.defaultButtonId);\n\t\tif (primaryBtn)\n\t\t\tL.DomUtil.addClass(primaryBtn, 'button-primary');\n\t},\n\n\taddFocusHandler: function(instance) {\n\t\tif (!instance.canHaveFocus)\n\t\t\treturn;\n\n\t\tconst failedToFindFocus = () => {\n\t\t\tif (document.getElementById(instance.init_focus_id))\n\t\t\t\tdocument.getElementById(instance.init_focus_id).focus();\n\t\t\telse {\n\t\t\t\tapp.console.error('There is no focusable element in the modal. Either focusId should be given or modal should have a response button.');\n\t\t\t\tinstance.that.close(instance.id, true);\n\t\t\t\tinstance.that.map.focus();\n\t\t\t}\n\t\t};\n\n\t\tJSDialog.MakeFocusCycle(instance.container, failedToFindFocus);\n\t},\n\n\taddHandlers: function(instance) {\n\t\tvar onInput = (ev) => {\n\t\t\tif (ev.isFirst)\n\t\t\t\tinstance.that.draggingObject = instance.that.dialogs[instance.id];\n\n\t\t\tif (ev.isFinal && instance.that.draggingObject\n\t\t\t\t&& instance.that.draggingObject.translateX\n\t\t\t\t&& instance.that.draggingObject.translateY) {\n\t\t\t\tinstance.that.draggingObject.startX = instance.that.draggingObject.translateX;\n\t\t\t\tinstance.that.draggingObject.startY = instance.that.draggingObject.translateY;\n\t\t\t\tinstance.that.draggingObject.translateX = 0;\n\t\t\t\tinstance.that.draggingObject.translateY = 0;\n\t\t\t\tinstance.that.draggingObject = null;\n\t\t\t}\n\t\t};\n\n\t\tif (instance.haveTitlebar) {\n\t\t\tinstance.titleCloseButton.onclick = () => {\n\t\t\t\tinstance.that.close(instance.id, true);\n\t\t\t};\n\t\t}\n\n\t\tif (instance.nonModal && instance.haveTitlebar) {\n\t\t\tinstance.titleCloseButton.onclick = () => {\n\t\t\t\tvar newestDialog = Math.max.apply(null,\n\t\t\t\t\tObject.keys(instance.that.dialogs).map(function(i) { return parseInt(i);}));\n\t\t\t\tif (newestDialog > parseInt(instance.id))\n\t\t\t\t\treturn;\n\n\t\t\t\tinstance.that.closeDialog(instance.id, true);\n\t\t\t};\n\n\t\t\tvar hammerTitlebar = new Hammer(instance.titlebar);\n\t\t\thammerTitlebar.add(new Hammer.Pan({ threshold: 20, pointers: 0 }));\n\n\t\t\thammerTitlebar.on('panstart', this.onPan.bind(this));\n\t\t\thammerTitlebar.on('panmove', this.onPan.bind(this));\n\t\t\thammerTitlebar.on('hammer.input', onInput);\n\t\t}\n\n\t\tvar popupParent = instance.popupParent ? L.DomUtil.get(instance.popupParent) : null;\n\n\t\tthis.addFocusHandler(instance); // Loop focus for all dialogues.\n\n\t\tvar clickToCloseId = instance.clickToClose ? L.Util.sanitizeElementId(instance.clickToClose) : null;\n\t\tif (clickToCloseId && clickToCloseId.indexOf('.uno:') === 0)\n\t\t\tclickToCloseId = clickToCloseId.substr('.uno:'.length);\n\n\t\tvar clickToCloseElement = null;\n\t\tif (clickToCloseId && popupParent) {\n\t\t\tclickToCloseElement = popupParent.querySelector('[id=\\'' + clickToCloseId + '\\']');\n\t\t\t// we avoid duplicated ids in unotoolbuttons - try with class\n\t\t\tif (!clickToCloseElement)\n\t\t\t\tclickToCloseElement = popupParent.querySelector('.uno' + clickToCloseId);\n\t\t\t// might be treeview entry\n\t\t\tif (!clickToCloseElement)\n\t\t\t\tinstance.clickToCloseText = instance.clickToClose;\n\t\t} else if (clickToCloseId) {\n\t\t\t// fallback\n\t\t\tclickToCloseElement = L.DomUtil.get(clickToCloseId);\n\t\t}\n\t\tinstance.clickToClose = clickToCloseElement;\n\n\t\t// setup initial focus and helper elements for closing popup\n\t\tvar initialFocusElement = JSDialog.GetFocusableElements(instance.container);\n\n\t\tif (instance.canHaveFocus && initialFocusElement && initialFocusElement.length)\n\t\t\tinitialFocusElement[0].focus();\n\n\t\t// pass the current instance and get the tabcontrol object if it exist\n\t\t// this will only search in current instance and not in whole document\n\t\tconst tabControlWidget = this.findTabControl(instance);\n\n\t\tlet focusWidget, firstFocusableElement ;\n\n\t\tif (tabControlWidget) {\n\t\t\t// get DOM element of tabControl from current instance\n\t\t\tfocusWidget = instance.content.querySelector('[id=\"' + tabControlWidget.id + '\"]');\n\t\t\tfirstFocusableElement = JSDialog.GetFocusableElements(focusWidget);\n\n\t\t} else {\n\t\t\t// will directly set element of focusable element based on init focus id\n\t\t\t// If init_id is not defined, select the first focusable element from the container\n\t\t\tfirstFocusableElement = instance.init_focus_id ? instance.container.querySelector('[id=\\'' + instance.init_focus_id + '\\']') : JSDialog.GetFocusableElements(instance.container);\n\t\t}\n\n\t\tif (firstFocusableElement && document.activeElement !== firstFocusableElement && instance.canHaveFocus) {\n\t\t\t// for tab control case we have more then 1 element that can be focusable so select the first tab for the list\n\t\t\tfirstFocusableElement = firstFocusableElement.length > 0 ? firstFocusableElement[0] : firstFocusableElement;\n\t\t\tfirstFocusableElement.focus();\n\t\t}\n\t\telse if (instance.canHaveFocus !== false)\n\t\t\tconsole.error('cannot get focus for widget: \"' + instance.init_focus_id + '\"');\n\n\t\tif (instance.isDropdown && instance.isSubmenu) {\n\t\t\tinstance.container.addEventListener('mouseleave', () => {\n\t\t\t\tinstance.builder.callback('combobox', 'hidedropdown', {id: instance.id}, null, instance.builder);\n\t\t\t});\n\t\t}\n\t},\n\n\t findTabControl: function(obj) {\n\t\tif (obj.type === 'tabcontrol') {\n\t\t\t// this return the main tabcontrol object\n\t\t\treturn obj;\n\t\t}\n\t\tif (obj.children && obj.children.length > 0) {\n\t\t\tfor (let child of obj.children) {\n\t\t\t\tconst result = this.findTabControl(child); // Recursively search in children\n\t\t\t\tif (result) return result; // If found, return the tabcontrol\n\t\t\t}\n\t\t}\n\t\treturn null; // Return null if tabcontrol is not found\n\t},\n\n\t/// if you use updatePos - instance param is bound automatically\n\tsetPosition: function(instance, updatedPos) {\n\t\tvar calculated = false;\n\t\tvar isRTL = document.documentElement.dir === 'rtl';\n\n\t\tif (instance.isSnackbar) {\n\t\t\tcalculated = true;\n\t\t\tinstance.posx = window.innerWidth/2 - instance.form.offsetWidth/2;\n\t\t\tinstance.posy = window.innerHeight - instance.form.offsetHeight - 40;\n\t\t} else if (instance.nonModal || instance.popupParent) {\n\t\t\t// in case of toolbox we want to create popup positioned by toolitem not toolbox\n\t\t\tif (updatedPos) {\n\t\t\t\tcalculated = true;\n\t\t\t\tinstance.posx = updatedPos.x;\n\t\t\t\tinstance.posy = updatedPos.y;\n\t\t\t}\n\t\t\tvar parent = L.DomUtil.get(instance.popupParent);\n\n\t\t\tif (instance.clickToCloseId && parent) {\n\t\t\t\tvar childButton = parent.querySelector('[id=\\'' + instance.clickToCloseId + '\\']');\n\t\t\t\tif (childButton)\n\t\t\t\t\tparent = childButton;\n\t\t\t} else if (instance.clickToCloseText && parent) {\n\t\t\t\tvar matchingElements;\n\t\t\t\tif ((matchingElements = parent.querySelectorAll('span.ui-treeview-cell-text')).length) {// treeview entry for context menu\n\t\t\t\t\tparent = Array.from(matchingElements).find((value) => value.innerText === instance.clickToCloseText);\n\t\t\t\t} else if ((matchingElements = parent.querySelectorAll('div.ui-iconview-entry > img')).length) {// iconview entry for context menu\n\t\t\t\t\tparent = Array.from(matchingElements).find((img) => img.title === instance.clickToCloseText);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (!parent && instance.popupParent === '_POPOVER_') {\n\t\t\t\t// popup was trigerred not by toolbar or menu button, probably on tile area\n\t\t\t\tif (instance.isAutoPopup) {\n\t\t\t\t\t// we are already done\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tconsole.warn('other popup than autofilter in the document area');\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (parent) {\n\t\t\t\tcalculated = true;\n\t\t\t\tinstance.posx = parent.getBoundingClientRect().left;\n\t\t\t\tinstance.posy = parent.getBoundingClientRect().bottom;\n\n\t\t\t\tif (instance.popupAnchor && instance.popupAnchor.indexOf('top') >= 0)\n\t\t\t\t\tinstance.posy = parent.getBoundingClientRect().top;\n\n\t\t\t\tinstance.container.style.minWidth = parent.getBoundingClientRect().width + 'px';\n\n\t\t\t\tif (isRTL)\n\t\t\t\t\tinstance.posx = window.innerWidth - instance.posx;\n\n\t\t\t\tif (instance.popupAnchor && instance.popupAnchor.indexOf('end') >= 0)\n\t\t\t\t\tinstance.posx += (isRTL ? 0 : 1) * (parent.clientWidth) - 15;\n\n\t\t\t\tif (instance.content.clientWidth > window.innerWidth)\n\t\t\t\t\tinstance.container.style.maxWidth = (window.innerWidth - instance.posx - 20) + 'px';\n\t\t\t\telse if (instance.posx + instance.content.clientWidth > window.innerWidth)\n\t\t\t\t\tinstance.posx -= instance.posx + instance.content.clientWidth + 10 - window.innerWidth;\n\n\t\t\t\tif (instance.content.clientHeight > window.innerHeight)\n\t\t\t\t\tinstance.container.style.maxHeight = (window.innerHeight - instance.posy - 20) + 'px';\n\t\t\t\telse if (instance.posy + instance.content.clientHeight > window.innerHeight)\n\t\t\t\t\tinstance.posy -= instance.posy + instance.content.clientHeight + 10 - window.innerHeight;\n\t\t\t}\n\t\t\telse {\n\t\t\t\tvar height = instance.form.getBoundingClientRect().height;\n\t\t\t\tif (instance.posy + height > instance.containerParent.getBoundingClientRect().height) {\n\t\t\t\t\tcalculated = true;\n\t\t\t\t\tvar newTopPosition = instance.posy - height;\n\t\t\t\t\tif (newTopPosition < 0)\n\t\t\t\t\t\tnewTopPosition = 0;\n\t\t\t\t\tinstance.posy = newTopPosition;\n\t\t\t\t}\n\n\t\t\t\tvar width = instance.form.getBoundingClientRect().width;\n\t\t\t\tif (isRTL)\n\t\t\t\t\twidth = width * -1;\n\n\t\t\t\tif (instance.posx + width > instance.containerParent.getBoundingClientRect().width) {\n\t\t\t\t\tcalculated = true;\n\t\t\t\t\tvar newLeftPosition = instance.posx - width;\n\t\t\t\t\tif (newLeftPosition < 0)\n\t\t\t\t\t\tnewLeftPosition = 0;\n\t\t\t\t\tinstance.posx = newLeftPosition;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tvar positionNotSet = !instance.container.style || !instance.container.style.marginInlineStart;\n\t\tif (calculated || positionNotSet)\n\t\t\tthis.setNewPosition(instance.container, instance.posx, instance.posy);\n\t},\n\n\tcenterDialogPosition: function (instance) {\n\t\tvar isRTL = document.documentElement.dir === 'rtl';\n\t\tvar height = instance.form.getBoundingClientRect().height;\n\t\tvar width = instance.form.getBoundingClientRect().width;\n\t\tinstance.startX = instance.posx = (window.innerWidth - (isRTL ? (-1 * width) : width)) / 2;\n\t\tinstance.startY = instance.posy = (window.innerHeight - height) / 2;\n\t\tinstance.updatePos({x: instance.posx, y: instance.posy});\n\t},\n\n\tparentAutofilter : null,\n\n\tcalculateAutoFilterPosition: function(instance) {\n\t\t// this is autofilter popup\n\n\t\t// RTL mode: only difference is when file is RTL not UI\n\t\t// var isViewRTL = document.documentElement.dir === 'rtl';\n\t\tvar isSpreadsheetRTL = this.map._docLayer.isCalcRTL();\n\n\t\tvar scale = this.map.zoomToFactor(this.map.getZoom());\n\t\tvar origin = this.map.getPixelOrigin();\n\t\tvar panePos = this.map._getMapPanePos();\n\n\t\tvar offsetX = isSpreadsheetRTL ? 0 : app.sectionContainer.getSectionWithName(L.CSections.RowHeader.name).size[0];\n\t\tvar offsetY = app.sectionContainer.getSectionWithName(L.CSections.ColumnHeader.name).size[1];\n\n\t\tif (this.isChildAutoFilter(instance)) {\n\t\t\tthis.calculateSubmenuAutoFilterPosition(instance, this.parentAutofilter);\n\t\t\treturn;\n\t\t}\n\t\tthis.parentAutofilter = instance.form;\n\t\tconst devicePixelRatio = app.dpiScale;\n\t\t// Convert the server-provided px values to screen coordinates\n\t\tinstance.posx = instance.posx / devicePixelRatio;\n\t\tinstance.posy = instance.posy / devicePixelRatio;\n\t\tvar left = parseInt(instance.posx) * scale;\n\t\tvar top = parseInt(instance.posy) * scale;\n\n\t\tvar splitPanesContext = this.map.getSplitPanesContext();\n\t\tvar splitPos = new L.Point(0, 0);\n\n\t\tif (splitPanesContext)\n\t\t\tsplitPos = splitPanesContext.getSplitPos();\n\n\t\tvar newLeft = left + panePos.x - origin.x;\n\t\tif (left >= splitPos.x && newLeft >= 0)\n\t\t\tleft = newLeft;\n\n\t\tvar newTop = top + panePos.y - origin.y;\n\t\tif (top >= splitPos.y && newTop >= 0)\n\t\t\ttop = newTop;\n\n\t\tif (isSpreadsheetRTL)\n\t\t\tleft = this.map._size.x - left;\n\n\t\tvar canvasEl = this.map._docLayer._canvas.getBoundingClientRect();\n\n\t\tinstance.posx = left + offsetX + canvasEl.left; // adding canvasEl.left in case we change sidebar to left of the screen\n\t\t// make margin from canvas top and not from window top\n\t\tinstance.posy = top + offsetY + canvasEl.top;\n\n\t\tthis.updateAutoPopPosition(instance.container, instance.posx, instance.posy);\n\t},\n\n\tisChildAutoFilter: function(instance) {\n\t\t// JSON structure suggests that if children array's first element has id='menu' and widgetType = 'treelistbox' then it will definitely be a child autofilter popup\n\t\tvar rootChild = instance.children[0];\n\t\tif (rootChild) {\n\t\t\tvar firstWidget = rootChild.children[0];\n\t\t\treturn firstWidget ? (firstWidget.id === 'menu' && firstWidget.type === 'treelistbox') : false;\n\t\t}\n\t\treturn false;\n\t},\n\n\tcalculateSubmenuAutoFilterPosition: function(instance, parentAutofilter) {\n\t\tvar parentAutofilter = parentAutofilter.getBoundingClientRect();\n\t\tinstance.posx = parentAutofilter.right;\n\t\tinstance.posy = parentAutofilter.top;\n\n\t\t// set margin start for child popup in rtl mode\n\t\tvar isSpreadsheetRTL = this.map._docLayer.isCalcRTL();\n\t\tif (isSpreadsheetRTL) {\n\t\t\tvar rtlPosx = parentAutofilter.left - instance.form.getBoundingClientRect().width;\n\t\t\tinstance.posx = rtlPosx < 0 ? 0 : rtlPosx;\n\t\t}\n\t\t// set posx of instance (submenufilter) based on window width\n\t\tvar width = instance.content.clientWidth;\n\t\tif (instance.posx + width > window.innerWidth)\n\t\t\tinstance.posx -= instance.posx + width - window.innerWidth;\n\n\t\t// submenu filter popup should not go below toolbar element. Adjust height according to window height and bottom toolbar element so it will not overlap with each other\n\t\tvar height = instance.form.getBoundingClientRect().height;\n\t\tif (instance.posy + height > window.innerHeight)\n\t\t\tinstance.posy = window.innerHeight - height;\n\n\t\tthis.updateAutoPopPosition(instance.container, instance.posx, instance.posy);\n\t},\n\n\tclosePopupsOnTabChange: function() {\n\t\t//this.dialogs is an object\n\t\tvar dialogKeys = Object.keys(this.dialogs);\n\n\t\tfor (var i = 0; i < dialogKeys.length; i++) {\n\t\t\tvar autoFilterDialogId = dialogKeys[i];\n\t\t\tvar dialog = this.dialogs[autoFilterDialogId];\n\n\t\t\t// Check if the current dialog has the isAutoPopup (Autofilter or AutoPopup) property set to true\n\t\t\tif (dialog.isAutoPopup) {\n\t\t\t\t// Call this.close(key, true) for the current dialog\n\t\t\t\tthis.close(autoFilterDialogId, true);\n\t\t\t}\n\t\t}\n\t},\n\n\tgetAutoPopupParentContainer(instance) {\n\t\t// Parent container will\n\t\tif (instance.isAutofilter || instance.isAutoCompletePopup || !instance.isDocumentAreaPopup)\n\t\t\treturn document.body\n\t\treturn document.getElementById('document-container');\n\t},\n\n\tonJSDialog: function(e) {\n\t\t/*\n\t\t\tDialog types:\n\t\t\t\t* Modal (isModalPopUp = true): non-movable + overlay + dimmed background.\n\t\t\t\t* Nonmodal: movable + no dim + no overlay (user can interact with the document).\n\t\t\t\t* Popup (Non-dialog) (isDocumentAreaPopup = true): overlay + no dim.\n\t\t*/\n\n\t\t// We will pass this here and there, so we can split the code into smaller functions.\n\t\t// Then we will save this into this.dialogs[].\n\t\tvar instance = e.data;\n\n\t\t// Save last focused element, we will set the focus back to this element after this popup is closed.\n\t\tif (!this.dialogs[instance.id] || !this.dialogs[instance.id].lastFocusedElement) // Avoid to reset while updates.\n\t\t\tinstance.lastFocusedElement = document.activeElement;\n\n\t\tinstance.callback = e.callback;\n\t\tinstance.isSnackbar = e.data.type === 'snackbar';\n\t\tinstance.isDropdown = e.data.type === 'dropdown';\n\t\tinstance.isModalPopUp = e.data.type === 'modalpopup' || instance.isDropdown;\n\t\tinstance.snackbarTimeout = e.data.timeout;\n\t\tinstance.isOnlyChild = false;\n\t\tinstance.that = this;\n\t\tinstance.startX = e.data.posx;\n\t\tinstance.startY = e.data.posy;\n\t\tinstance.updatePos = null;\n\t\tinstance.canHaveFocus = !instance.isSnackbar && instance.id !== 'busypopup' && !instance.isAutoCompletePopup;\n\t\tinstance.isDocumentAreaPopup = instance.popupParent === '_POPOVER_' && instance.posx !== undefined && instance.posy !== undefined;\n\t\tinstance.isPopup = instance.isModalPopUp || instance.isDocumentAreaPopup || instance.isSnackbar;\n\t\tinstance.isAutoPopup = instance.isDocumentAreaPopup && this.map._docLayer.isCalc();\n\t\tinstance.isAutofilter = instance.isAutoPopup && !instance.isAutoFillPreviewTooltip && !instance.isAutoCompletePopup;// separate the autofilter case\n\t\tinstance.containerParent = this.getAutoPopupParentContainer(instance);\n\t\tinstance.hasClose = !!instance.hasClose; // default is true\n\t\tinstance.haveTitlebar = instance.hasClose\n\t\t\t|| (!instance.isModalPopUp && !instance.isSnackbar && instance.hasClose)\n\t\t\t|| (instance.title && instance.title !== '');\n\t\tinstance.nonModal = !instance.isModalPopUp && !instance.isDocumentAreaPopup && !instance.isSnackbar;\n\n\t\t// Make a better seperation between popups and modals.\n\t\tif (instance.isDocumentAreaPopup)\n\t\t\tinstance.isModalPopUp = false;\n\n\t\t// Check.\n\t\tif (instance.popupParent === '_POPOVER_' && (instance.posx === undefined || instance.posy === undefined))\n\t\t\tconsole.error('There is a POPOVER dialogue without position information.');\n\n\t\tif (instance.action === 'fadeout')\n\t\t{\n\t\t\tthis.fadeOutDialog(instance);\n\t\t}\n\t\telse if (instance.action === 'close')\n\t\t{\n\t\t\tthis.close(instance.id, false);\n\n\t\t\t// Manage focus\n\t\t\tvar dialogs = Object.keys(this.dialogs);\n\t\t\tif (dialogs.length) {\n\t\t\t\tvar lastKey = dialogs[dialogs.length - 1];\n\t\t\t\tconst lastDialog = this.dialogs[lastKey];\n\t\t\t\tconst lastContainer = lastDialog.container;\n\t\t\t\tif (lastDialog.canHaveFocus && lastContainer) {\n\t\t\t\t\tvar initialFocusElement = JSDialog.GetFocusableElements(lastContainer);\n\t\t\t\t\tif (initialFocusElement && initialFocusElement.length)\n\t\t\t\t\t\tinitialFocusElement[0].focus();\n\t\t\t\t\telse\n\t\t\t\t\t\tlastContainer.focus();\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tthis.map.focus();\n\t\t\t}\n\t\t}\n\t\telse {\n\t\t\t// There is no action, so we create a new dialogue.\n\t\t\tif (instance.isModalPopUp || instance.isDocumentAreaPopup)\n\t\t\t\tthis.getOrCreateOverlay(instance);\n\n\t\t\t// Sometimes we get another full update for the same dialog\n\t\t\tconst existingNode = this.dialogs[instance.id];\n\n\t\t\tif (existingNode) {\n\t\t\t\tinstance.posx = existingNode.startX;\n\t\t\t\tinstance.posy = existingNode.startY;\n\t\t\t}\n\n\t\t\t// We show some dialogs such as Macro Security Warning Dialog and Text Import Dialog (csv)\n\t\t\t// They are displayed before the document is loaded\n\t\t\t// Spinning should be happening until the 1st interaction with the user\n\t\t\t// which is the dialog opening in this case\n\t\t\tif (this.map)\n\t\t\t\tthis.map._progressBar.end();\n\n\t\t\tconst dialogDomParent = instance.overlay ? instance.overlay: instance.containerParent;\n\t\t\tconst documentFragment = new DocumentFragment(); // do not modify dom yet\n\n\t\t\tthis.createContainer(instance, documentFragment);\n\t\t\tthis.createDialog(instance);\n\n\t\t\t// FIXME: remove this auto-bound instance so it will be clear what is passed\n\t\t\tinstance.updatePos = this.setPosition.bind(this, instance);\n\n\t\t\tapp.layoutingService.appendLayoutingTask(() => {\n\t\t\t\t// dialog built - add to DOM now\n\t\t\t\tif (existingNode) {\n\t\t\t\t\texistingNode.container.replaceWith(instance.container);\n\t\t\t\t} else {\n\t\t\t\t\tinstance.container.classList.add('fadein');\n\t\t\t\t\tdialogDomParent.append(instance.container);\n\t\t\t\t}\n\n\t\t\t\t// do in task to apply correct focus when already shown\n\t\t\t\tthis.addHandlers(instance);\n\n\t\t\t\t// Special case for nonModal dialogues. Core side doesn't send their initial coordinates. We need to center them.\n\t\t\t\tif (instance.nonModal && !(instance.startX && instance.startY)) {\n\t\t\t\t\tthis.centerDialogPosition(instance);\n\t\t\t\t} else {\n\t\t\t\t\tinstance.updatePos();\n\t\t\t\t}\n\n\t\t\t\t// AutoPopup  will calculate popup position for Autofilter Popup\n\t\t\t\tif (instance.isAutofilter && !instance.isAutoFillPreviewTooltip)\n\t\t\t\t\tthis.calculateAutoFilterPosition(instance);\n\t\t\t\telse if (instance.isAutoFillPreviewTooltip || instance.isAutoCompletePopup){\n\t\t\t\t\tthis.updateAutoPopPosition(instance.container, instance.posx, instance.posy);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tthis.dialogs[instance.id] = instance;\n\n\t\t\tif (instance.isSnackbar && instance.snackbarTimeout > 0) {\n\t\t\t\tinstance.timeoutId = setTimeout(() => { app.map.uiManager.closeSnackbar(); }, instance.snackbarTimeout);\n\t\t\t}\n\t\t}\n\t},\n\n\tonJSUpdate: function (e) {\n\t\tvar data = e.data;\n\n\t\tif (data.jsontype !== 'dialog' && data.jsontype !== 'popup')\n\t\t\treturn;\n\n\t\tvar dialog = this.dialogs[data.id] ? this.dialogs[data.id].container : null;\n\t\tif (!dialog)\n\t\t\treturn;\n\n\t\tvar builder = new L.control.jsDialogBuilder({windowId: data.id,\n\t\t\tmobileWizard: this,\n\t\t\tmap: this.map,\n\t\t\tcssClass: 'jsdialog',\n\t\t\tcallback: e.callback\n\t\t});\n\n\t\tbuilder.updateWidget(dialog, data.control);\n\n\t\tconst dialogInfos = this.dialogs;\n\n\t\t// after widget update we might have bigger content and need to center the dialog again\n\t\tapp.layoutingService.appendLayoutingTask(() => {\n\t\t\tvar dialogInfo = dialogInfos[data.id];\n\t\t\tif (!dialogInfo) {\n\t\t\t\tconsole.debug('JSDialog: dialog info with id: \"' + data.id + '\" not found.');\n\t\t\t\tif (dialog) console.debug('JSDialog: old data was: ' + JSON.stringify(dialog));\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (dialogInfo.isDocumentAreaPopup) {\n\t\t\t\t// In case of AutocompletePopup's update data would have posx, posy\n\t\t\t\tdialogInfo.updatePos(new L.Point(data.posx, data.posy));\n\t\t\t} else {\n\t\t\t\tdialogInfo.updatePos();\n\t\t\t}\n\t\t});\n\t},\n\n\tonJSAction: function (e) {\n\t\tvar data = e.data;\n\t\tvar innerData = data.data;\n\n\t\tif (data.jsontype === 'formulabar' && innerData && innerData.separator)\n\t\t\tapp.calc.decimalSeparator = innerData.separator;\n\n\t\tif (data.jsontype !== 'dialog' && data.jsontype !== 'popup')\n\t\t\treturn;\n\n\t\tvar dialog = this.dialogs[data.id];\n\t\tif (!dialog)\n\t\t\treturn;\n\n\t\tvar builder = dialog.builder;\n\t\tif (!builder)\n\t\t\treturn;\n\n\t\tvar dialogContainer = dialog.container;\n\t\tif (!dialogContainer)\n\t\t\treturn;\n\n\t\t// focus on element outside view will move viewarea leaving blank space on the bottom\n\t\tif (innerData.action_type === 'grab_focus') {\n\t\t\tapp.layoutingService.appendLayoutingTask(() => {\n\t\t\t\tvar control = dialogContainer.querySelector('[id=\\'' + innerData.control_id + '\\']');\n\t\t\t\tvar controlPosition = control ? control.getBoundingClientRect() : null;\n\t\t\t\tif (controlPosition && (controlPosition.bottom > window.innerHeight ||\n\t\t\t\t\tcontrolPosition.right > window.innerWidth)) {\n\t\t\t\t\tthis.centerDialogPosition(dialog); // will center it\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tbuilder.executeAction(dialogContainer, innerData);\n\t},\n\n\t_clamp: function(value, min, max) {\n\t\treturn Math.min(Math.max(value, min), max);\n\t},\n\n\tonPan: function (ev) {\n\t\tconst target = this.draggingObject;\n\t\tif (target) {\n\t\t\tconst isRTL = document.documentElement.dir === 'rtl';\n\n\t\t\tconst dialogBounds = target.form.getBoundingClientRect();\n\t\t\tconst width = dialogBounds.width;\n\t\t\tconst height = dialogBounds.height;\n\n\t\t\tconst startX = target.startX ? target.startX : 0;\n\t\t\tconst startY = target.startY ? target.startY : 0;\n\n\t\t\tlet newX = startX + ev.deltaX * (isRTL ? -1 : 1);\n\t\t\tlet newY = startY + ev.deltaY;\n\n\t\t\t// We want to allow dragging the dialog offscreen iff it also drags another part of the dialog onscreen\n\t\t\tif (newX < 0 && newX + width < window.innerWidth) {\n\t\t\t\tnewX = Math.min(0, window.innerWidth - width);\n\t\t\t}\n\n\t\t\tif (newX + width > window.innerWidth && newX > 0) {\n\t\t\t\tnewX = Math.max(window.innerWidth - width, 0);\n\t\t\t}\n\n\t\t\t// Happily for us, jsdialogs scroll in the y direction if the screen is too small anyway which lets us not worry about the title bar going fully offscreen\n\t\t\tnewY = this._clamp(newY, 0, window.innerHeight - height);\n\n\t\t\ttarget.translateX = newX;\n\t\t\ttarget.translateY = newY;\n\n\t\t\tthis.setNewPosition(target.container, newX, newY);\n\t\t}\n\t},\n\n\tupdateAutoPopPosition: function (target, newX, newY) {\n\t\tvar width = target.getBoundingClientRect().width;\n\t\tvar dialogBottom = newY + target.getBoundingClientRect().height;\n\t\tvar windowBottom = window.innerHeight;\n\t\tif (newX + width > window.innerWidth)\n\t\t\tnewX = window.innerWidth - width;\n\n\t\t// at this point we have un updated potion of autofilter instance.\n\t\t// so to handle overlapping case of autofilter and toolbar we need some complex calculation\n\t\tif (dialogBottom > windowBottom)\n\t\t\tnewY = newY - (dialogBottom - windowBottom + 10);\n\n\t\tthis.setNewPosition(target, newX, newY);\n\t},\n\n\tsetNewPosition(target, newX, newY) {\n\t\ttarget.style.marginInlineStart = newX + 'px';\n\t\ttarget.style.marginTop = newY + 'px';\n\t},\n\n\thandleKeyEvent: function (event) {\n\t\tvar keyCode = event.keyCode;\n\n\t\tswitch (keyCode) {\n\t\tcase 27:\n\t\t\t// ESC\n\t\t\tvar dialogKeys = Object.keys(this.dialogs);\n\t\t\tif (dialogKeys.length) {\n\t\t\t\tvar lastKey = dialogKeys[dialogKeys.length - 1];\n\t\t\t\tvar sendCloseToServer = this.dialogs[lastKey].isDropdown !== true;\n\t\t\t\tthis.close(lastKey, sendCloseToServer);\n\t\t\t\treturn true;\n\t\t\t}\n\t\t\tbreak;\n\t\tcase 18:\n\t\t\tif (app.map && app.map.jsdialog && app.map.jsdialog.hasDialogOpened()) {\n\t\t\t\tdocument.body.classList.add('activate-underlines');\n\t\t\t}\n\t\t}\n\n\t\treturn false;\n\t},\n\tonKeyUp: function(ev) {\n\t\tif ((ev.keyCode === 18) && app.map && app.map.jsdialog && app.map.jsdialog.hasDialogOpened()) {\n\t\t\tdocument.body.classList.remove('activate-underlines');\n\t\t}\n\t},\n\n\tonZoomEnd: function () {\n\t\tvar dialogs = Object.keys(this.dialogs);\n\t\tif (dialogs.length) {\n\t\t\tvar lastKey = dialogs[dialogs.length - 1];\n\t\t\tvar dialogInfo = this.dialogs[lastKey];\n\t\t\tif (dialogInfo.isPopup) {\n\t\t\t\tthis.close(lastKey, true);\n\t\t\t\tthis.map.focus();\n\t\t\t}\n\t\t}\n\n\t}\n});\n\nL.control.jsDialog = function (options) {\n\treturn new L.Control.JSDialog(options);\n};\n"]}