{"version":3,"file":"Control.UIManager.js","sourceRoot":"","sources":["../../../../../../../../../../TanhX/online/browser/src/control/Control.UIManager.ts"],"names":[],"mappings":"AAAA,gCAAgC;AAChC;;;;;;;;GAQG;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAiBH;;GAEG;AACH;IAAwB,6BAAS;IAAjC;QAAA,qEAqnEC;QApnEA,kBAAY,GAAQ,IAAI,CAAC;QACzB,uBAAiB,GAAQ,IAAI,CAAC;QAC9B,eAAS,GAAQ,KAAK,CAAC;QACvB,oBAAc,GAAkB,IAAI,CAAC;QACrC,mBAAa,GAAU,EAAE,CAAC,CAAC,6BAA6B;QACxD,mBAAa,GAA+B,EAAE,CAAC;QAC/C,oBAAc,GAA+B,EAAE,CAAC;QAChD,2BAA2B;QAC3B,gBAAU,GAA+B,EAAE,CAAC;;IA4mE7C,CAAC;IA1mEA;;;;;OAKG;IACH,yBAAK,GAAL,UAAM,GAA6B;QAAnC,iBA2DC;QA1DA,IAAI,CAAC,GAAG,GAAG,GAAG,CAAC;QACf,IAAI,CAAC,WAAW,GAAG,IAAI,CAAC;QACxB,iEAAiE;QACjE,4CAA4C;QAC5C,+DAA+D;QAC/D,+DAA+D;QAC/D,iEAAiE;QACjE,qEAAqE;QACrE,uEAAuE;QACvE,0EAA0E;QAC1E,IAAI,CAAC,GAAG,CAAC,iBAAiB,GAAG,CAAC,CAAC,aAAa,CAAC,CAAC,CAAC,CAAC,CAAC,SAAS,CAAC,IAAI,CAAC,CAAC;QACjE,IAAI,CAAC,GAAG,CAAC,gBAAgB,GAAG,CAAC,CAAC,YAAY,CAAC,CAAC,CAAC,CAAC,CAAC,SAAS,CAAC,IAAI,CAAC,CAAC;QAE/D,GAAG,CAAC,EAAE,CAAC,SAAS,EAAE,IAAI,CAAC,WAAW,EAAE,IAAI,CAAC,CAAC;QAC1C,GAAG,CAAC,MAAM,CAAC,EAAE,CAAC,kBAAkB,EAAE,IAAI,CAAC,kBAAkB,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC;QAEtE,IAAI,MAAM,CAAC,IAAI,CAAC,QAAQ,EAAE,EAAE;YAC3B,MAAM,CAAC,gBAAgB,CAAC,UAAU,EAAE,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC;YAE9D,+DAA+D;YAC/D,OAAO,CAAC,SAAS,CAAC,EAAC,OAAO,EAAE,aAAa,EAAC,EAAE,aAAa,CAAC,CAAC;YAC3D,OAAO,CAAC,SAAS,CAAC,EAAC,OAAO,EAAE,aAAa,EAAC,EAAE,aAAa,CAAC,CAAC;SAC3D;QAED,GAAG,CAAC,EAAE,CAAC,SAAS,EAAE,IAAI,CAAC,OAAO,EAAE,IAAI,CAAC,CAAC;QACtC,GAAG,CAAC,EAAE,CAAC,WAAW,EAAE,IAAI,CAAC,SAAS,EAAE,IAAI,CAAC,CAAC;QAE1C,CAAC,CAAC,kBAAkB,CAAC,CAAC,EAAE,CAAC,OAAO,EAAE,UAAC,KAAK;;YACvC,IAAM,MAAM,GAAG,KAAK,CAAC,MAAqB,CAAC;YAC3C,IAAI,CAAA,MAAA,MAAM,CAAC,aAAa,0CAAE,EAAE,MAAK,YAAY,EAAE,gEAAgE;gBAC9G,KAAI,CAAC,GAAG,CAAC,IAAI,CAAC,gBAAgB,CAAC,CAAC;QAClC,CAAC,CAAC,CAAC;QAEH,CAAC,CAAC,WAAW,CAAC,CAAC,EAAE,CAAC,OAAO,EAAE,UAAC,KAAK;;YAChC,IAAM,MAAM,GAAG,KAAK,CAAC,MAAqB,CAAC;YAC3C,IAAI,CAAA,MAAA,MAAM,CAAC,aAAa,0CAAE,QAAQ,MAAK,KAAK,IAAI,kDAAkD;gBACjG,MAAM,CAAC,QAAQ,KAAK,KAAK,IAAI,6CAA6C;gBAC1E,CAAA,MAAA,MAAM,CAAC,aAAa,0CAAE,EAAE,MAAK,mBAAmB,EAAE,EAAE,uDAAuD;gBAC3G,KAAI,CAAC,GAAG,CAAC,IAAI,CAAC,gBAAgB,CAAC,CAAC;aAAC;QACnC,CAAC,CAAC,CAAC;QACH,IAAM,OAAO,GAAG,QAAQ,CAAC,aAAa,CAAC,WAAW,CAAgB,CAAC;QACnE,OAAO,CAAC,gBAAgB,CAAC,OAAO,EAAE,UAAS,CAAa;YACvD,IAAM,EAAE,GAAG,IAAmB,CAAC;YAE/B,4EAA4E;YAC5E,IAAI,CAAC,CAAC,QAAQ,IAAI,EAAE,CAAC,WAAW,IAAI,EAAE,CAAC,WAAW;gBAAE,OAAO;YAE3D,sBAAsB;YACtB,IAAI,CAAC,UAAU,IAAI,CAAC,CAAC,MAAM,CAAC;YAE5B,mDAAmD;YACnD,CAAC,CAAC,cAAc,EAAE,CAAC;QAClB,CAAC,EAAE,EAAE,OAAO,EAAE,KAAK,EAAE,CAAC,CAAC;QACzB,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,iBAAiB,EAAE,IAAI,CAAC,aAAa,EAAE,IAAI,CAAC,CAAC;QAEzD,IAAI,CAAC,GAAG,CAAC,oBAAoB,CAAC,CAAC,YAAY,CAAC,iBAAiB,EAAE,OAAO,CAAC,CAAC;QACxE,IAAI,CAAC,GAAG,CAAC,oBAAoB,CAAC,CAAC,YAAY,CAAC,kBAAkB,EAAE,OAAO,CAAC,CAAC;QACzE,IAAI,CAAC,GAAG,CAAC,oBAAoB,CAAC,CAAC,YAAY,CAAC,iBAAiB,EAAE,MAAM,CAAC,CAAC;IACxE,CAAC;IAED,oBAAoB;IAEpB;;OAEG;IACH,kCAAc,GAAd;QACC,2BAA2B;QAC3B,IAAI,MAAM,CAAC,IAAI,CAAC,QAAQ,EAAE;YACzB,OAAO,SAAS,CAAC;QAElB,OAAO,IAAI,CAAC,wBAAwB,EAAE,CAAC,CAAC,CAAC,aAAa,CAAC,CAAC,CAAC,SAAS,CAAC;IACpE,CAAC;IAED;;OAEG;IACH,oCAAgB,GAAhB;QACC,OAAO,MAAM,CAAC,KAAK,CAAC,UAAU,CAAC,2BAA2B,EAAE,KAAK,CAAC,CAAC;IACpE,CAAC;IAED;;OAEG;IACH,oCAAgB,GAAhB,UAAiB,QAAiB;QACjC,MAAM,CAAC,KAAK,CAAC,GAAG,CAAC,2BAA2B,EAAE,QAAQ,CAAC,CAAC;QACxD,IAAM,cAAc,GAAG,QAAQ,CAAA,CAAC,CAAC,MAAM,CAAC,CAAC,CAAC,OAAO,CAAC;QAClD,IAAI,CAAC,GAAG,CAAC,oBAAoB,CAAC,CAAC,YAAY,CAAC,oBAAoB,EAAE,cAAc,CAAC,CAAC;QAClF,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,qBAAqB,EAAE,EAAC,WAAW,EAAG,oBAAoB,EAAE,KAAK,EAAG,cAAc,EAAC,CAAC,CAAC;IACrG,CAAC;IAED;;OAEG;IACH,4CAAwB,GAAxB;QACC,IAAM,YAAY,GAAG,MAAM,CAAC,KAAK,CAAC,GAAG,CAAC,aAAa,EAAE,IAAI,CAAC,CAAC,CAAC,yDAAyD;QACrH,gDAAgD;QAChD,IAAM,gBAAgB,GAAG,CAAC,MAAM,CAAC,iBAAiB,KAAK,SAAS,IAAI,YAAY,IAAI,IAAI,CAAC,IAAI,YAAY,KAAK,MAAM,CAAC;QACrH,OAAO,CAAC,gBAAgB,CAAC;IAC1B,CAAC;IAED,mBAAmB;IAEnB;;OAEG;IACH,iCAAa,GAAb;QACC,QAAQ,CAAC,eAAe,CAAC,YAAY,CAAC,YAAY,EAAC,OAAO,CAAC,CAAC;QAC5D,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,qBAAqB,EAAE,EAAC,WAAW,EAAG,iBAAiB,EAAE,KAAK,EAAG,OAAO,EAAC,CAAC,CAAC;QAC1F,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,iBAAiB,CAAC,CAAC;IAClC,CAAC;IAED;;OAEG;IACH,gCAAY,GAAZ;QACC,QAAQ,CAAC,eAAe,CAAC,YAAY,CAAC,YAAY,EAAC,MAAM,CAAC,CAAC;QAC3D,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,qBAAqB,EAAE,EAAC,WAAW,EAAG,iBAAiB,EAAE,KAAK,EAAG,MAAM,EAAC,CAAC,CAAC;QACzF,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,iBAAiB,CAAC,CAAC;IAClC,CAAC;IAED;;OAEG;IACH,iDAA6B,GAA7B;QACC,IAAI,GAAG,CAAC,gBAAgB,EAAE;YACzB,GAAG,CAAC,gBAAgB,CAAC,sBAAsB,CAAC,KAAK,CAAC,CAAC;YAEnD,IAAI,IAAI,CAAC,GAAG,CAAC,UAAU,EAAE,IAAI,aAAa,EAAE;gBAC3C,GAAG,CAAC,gBAAgB,CAAC,aAAa,CAAC,MAAM,CAAC,gBAAgB,CAAC,QAAQ,CAAC,eAAe,CAAC,CAAC,gBAAgB,CAAC,6BAA6B,CAAC,CAAC,CAAC;aACtI;iBAAM;gBACN,GAAG,CAAC,gBAAgB,CAAC,aAAa,CAAC,MAAM,CAAC,gBAAgB,CAAC,QAAQ,CAAC,eAAe,CAAC,CAAC,gBAAgB,CAAC,gBAAgB,CAAC,CAAC,CAAC;aACzH;YAED,8DAA8D;YAC9D,GAAG,CAAC,gBAAgB,CAAC,sBAAsB,CAAC,IAAI,CAAC,CAAC;SAClD;IACF,CAAC;IAED;;OAEG;IACH,qCAAiB,GAAjB,UAAkB,QAAiB;QAClC,IAAI,GAAG,GAAG,EAAE,UAAU,EAAE,EAAE,MAAM,EAAE,QAAQ,EAAE,OAAO,EAAE,EAAE,EAAE,EAAE,CAAC;QAC5D,QAAQ,CAAC,CAAC,CAAC,GAAG,CAAC,QAAQ,CAAC,KAAK,GAAG,MAAM,CAAC,CAAC,CAAC,GAAG,CAAC,QAAQ,CAAC,KAAK,GAAG,OAAO,CAAC;QACtE,GAAG,CAAC,MAAM,CAAC,WAAW,CAAC,4BAA4B,GAAG,IAAI,CAAC,SAAS,CAAC,GAAG,CAAC,CAAC,CAAC;QAC3E,IAAI,CAAC,oBAAoB,CAAC,QAAQ,CAAC,CAAC;IACrC,CAAC;IAED;;OAEG;IACH,wCAAoB,GAApB,UAAqB,QAAiB;QACrC,QAAQ,CAAC,eAAe,CAAC,YAAY,CAAC,eAAe,EAAE,QAAQ,CAAC,CAAC,CAAC,MAAM,CAAC,CAAC,CAAC,OAAO,CAAC,CAAC;QACpF,IAAI,QAAQ,EAAE;YACb,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,qBAAqB,EAAE,EAAC,WAAW,EAAG,kBAAkB,EAAE,KAAK,EAAG,OAAO,EAAC,CAAC,CAAC;SAC3F;aACI;YACJ,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,qBAAqB,EAAE,EAAC,WAAW,EAAG,kBAAkB,EAAE,KAAK,EAAG,MAAM,EAAC,CAAC,CAAC;SAC1F;QACD,IAAI,CAAC,6BAA6B,EAAE,CAAC;IACtC,CAAC;IAED;;OAEG;IACH,+BAAW,GAAX,UAAY,QAAyB;QAAzB,yBAAA,EAAA,gBAAyB;QACpC,uBAAuB;QACvB,IAAI,cAAc,GAAG,IAAI,CAAC,gBAAgB,EAAE,CAAC;QAE7C,IAAI,QAAQ,EAAE;YACb,IAAI,CAAC,oBAAoB,CAAC,cAAc,CAAC,CAAC;SAC1C;aAAM;YACN,IAAI,CAAC,iBAAiB,CAAC,cAAc,CAAC,CAAC;SACvC;IACF,CAAC;IAED;;OAEG;IACH,oCAAgB,GAAhB;QACC,iEAAiE;QACjE,IAAI,WAAW,GAAG,MAAM,CAAC,KAAK,CAAC,UAAU,CAAC,WAAW,CAAC,CAAC;QACvD,IAAI,sBAAsB,GAAG,yBAAyB,GAAG,CAAC,WAAW,CAAC,CAAC,CAAC,MAAM,CAAC,CAAC,CAAC,OAAO,CAAC,CAAC;QAC1F,IAAI,cAAc,GAAG,MAAM,CAAC,KAAK,CAAC,UAAU,CAAC,sBAAsB,EAAE,WAAW,CAAC,CAAC;QAClF,OAAO,cAAc,CAAC;IACvB,CAAC;IAED;;OAEG;IACH,gCAAY,GAAZ;QACC,uBAAuB;QACvB,IAAI,WAAW,GAAG,MAAM,CAAC,KAAK,CAAC,UAAU,CAAC,WAAW,CAAC,CAAC;QACvD,IAAI,sBAAsB,GAAG,yBAAyB,GAAG,CAAC,WAAW,CAAC,CAAC,CAAC,MAAM,CAAC,CAAC,CAAC,OAAO,CAAC,CAAC;QAC1F,IAAI,cAAc,GAAG,MAAM,CAAC,KAAK,CAAC,UAAU,CAAC,sBAAsB,EAAE,WAAW,CAAC,CAAC;QAElF,2EAA2E;QAC3E,IAAI,cAAc,EAAE;YACnB,MAAM,CAAC,KAAK,CAAC,GAAG,CAAC,sBAAsB,EAAE,KAAK,CAAC,CAAC;YAChD,IAAI,CAAC,iBAAiB,CAAC,KAAK,CAAC,CAAC;SAC9B;aACI;YACJ,MAAM,CAAC,KAAK,CAAC,GAAG,CAAC,sBAAsB,EAAE,IAAI,CAAC,CAAC;YAC/C,IAAI,CAAC,iBAAiB,CAAC,IAAI,CAAC,CAAC;SAC7B;IACF,CAAC;IAED;;OAEG;IACH,kCAAc,GAAd;QACC,uBAAuB;QACvB,IAAI,WAAW,GAAG,MAAM,CAAC,KAAK,CAAC,UAAU,CAAC,WAAW,CAAC,CAAC;QACvD,2EAA2E;QAC3E,IAAI,WAAW,EAAE;YAChB,MAAM,CAAC,KAAK,CAAC,GAAG,CAAC,WAAW,EAAE,KAAK,CAAC,CAAC;YACrC,IAAI,CAAC,aAAa,EAAE,CAAC;YACrB,IAAI,CAAC,sBAAsB,CAAC,KAAK,CAAC,CAAC;SACnC;aACI;YACJ,MAAM,CAAC,KAAK,CAAC,GAAG,CAAC,WAAW,EAAE,IAAI,CAAC,CAAC;YACpC,IAAI,CAAC,YAAY,EAAE,CAAC;YACpB,IAAI,CAAC,sBAAsB,CAAC,IAAI,CAAC,CAAC;SAClC;QACD,IAAI,CAAC,WAAW,EAAE,CAAC;QACnB,IAAI,CAAC,6BAA6B,EAAE,CAAC;QACrC,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,QAAQ,EAAE;YAC1B,IAAI,CAAC,uBAAuB,EAAE,CAAC;QAEhC,IAAI,GAAG,CAAC,GAAG,CAAC,SAAS,CAAC,QAAQ,KAAK,aAAa,EAAE;YACjD,IAAM,eAAe,GAAG,GAAG,CAAC,gBAAgB,CAAC,kBAAkB,CAAC,CAAC,CAAC,SAAS,CAAC,QAAQ,CAAC,IAAI,CAAC,CAAC;YAC3F,IAAI,eAAe;gBAClB,eAAe,CAAC,gBAAgB,EAAE,CAAC;SACpC;QAED,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,cAAc,CAAC,CAAC;IAC/B,CAAC;IAED;;OAEG;IACH,4CAAwB,GAAxB;QACC,IAAI,WAAW,GAAG,MAAM,CAAC,KAAK,CAAC,UAAU,CAAC,WAAW,CAAC,CAAC;QAEvD,IAAI,WAAW,EAAE;YAChB,IAAI,CAAC,YAAY,EAAE,CAAC;SACpB;aAAM;YACN,IAAI,CAAC,aAAa,EAAE,CAAC;SACrB;QAED,IAAI,CAAC,WAAW,CAAC,IAAI,CAAC,CAAC;IACxB,CAAC;IAED;;OAEG;IACH,0CAAsB,GAAtB,UAAuB,QAAiB;QACvC,IAAI,GAAG,GAAG,EAAE,UAAU,EAAE,EAAE,MAAM,EAAE,QAAQ,EAAE,OAAO,EAAE,EAAE,EAAE,EAAE,CAAC;QAC5D,QAAQ,CAAC,CAAC,CAAC,GAAG,CAAC,QAAQ,CAAC,KAAK,GAAG,MAAM,CAAC,CAAC,CAAC,GAAG,CAAC,QAAQ,CAAC,KAAK,GAAG,OAAO,CAAC;QACtE,GAAG,CAAC,MAAM,CAAC,WAAW,CAAC,uBAAuB,GAAG,IAAI,CAAC,SAAS,CAAC,GAAG,CAAC,CAAC,CAAC;IACvE,CAAC;IAED;;OAEG;IACH,kCAAc,GAAd;QACC,2CAA2C;QAC3C,IAAI,YAAY,GAAG,IAAI,CAAC,iBAAiB,CAAC;QAC1C,IAAI,QAAQ,GAAG,IAAI,CAAC,GAAG,CAAC,MAAM,CAAC,CAAC,YAAY,CAAC,CAAC,CAAC,IAAI,CAAC,GAAG,CAAC,MAAM,CAAC,CAAC,YAAY,CAAC,CAAC,CAAC,EAAE,CAAC;QAClF,IAAI,CAAC,cAAc,CAAC,cAAc,EAAE,CAAC,CAAC,iBAAiB,CAAC,EAAE,CAAC,CAAC,gBAAgB,CAAC,EAAE,QAAQ,EAAE,CAAC,CAAC,QAAQ,CAAC,EACnG,UAAC,OAAe;YACf,YAAY,CAAC,mBAAmB,CAAC,OAAO,CAAC,CAAC;QAC5C,CAAC,CAAC,CAAC;IACJ,CAAC;IAED;;OAEG;IACH,8BAAU,GAAV;QACC,IAAI,MAAM,CAAC,sBAAsB,EAAE;YAClC,yCAAyC;YACzC,mDAAmD;SACnD;aAAM;YACN,GAAG,CAAC,MAAM,CAAC,WAAW,CAAC,wBAAwB,CAAC,CAAC;SACjD;QAED,2CAA2C;IAC5C,CAAC;IAED;;OAEG;IACH,kDAA8B,GAA9B;QACC,IAAM,iBAAiB,GAAG,IAAI,CAAC,wBAAwB,EAAE,CAAC;QAC1D,IAAM,QAAQ,GAAG,MAAM,CAAC,IAAI,CAAC,QAAQ,EAAE,CAAC;QACxC,IAAI,QAAQ,IAAI,CAAC,iBAAiB,EAAE;YACnC,IAAI,OAAO,GAAG,CAAC,CAAC,OAAO,CAAC,OAAO,EAAE,CAAC;YAClC,IAAI,CAAC,GAAG,CAAC,OAAO,GAAG,OAAO,CAAC;YAC3B,IAAI,CAAC,GAAG,CAAC,UAAU,CAAC,OAAO,CAAC,CAAC;SAC7B;QAED,IAAI,CAAC,QAAQ,IAAI,CAAC,iBAAiB;YAClC,IAAI,CAAC,GAAG,CAAC,UAAU,GAAG,QAAQ,CAAC,UAAU,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;IACtD,CAAC;IAED;;OAEG;IACH,qCAAiB,GAAjB;QAAA,iBA0FC;QAzFA,IAAI,CAAC,8BAA8B,EAAE,CAAC;QAEtC,IAAI,MAAM,CAAC,IAAI,CAAC,QAAQ,EAAE,EAAE;YAC3B,CAAC,CAAC,sBAAsB,CAAC,CAAC,EAAE,CAAC,OAAO,EAAE;gBACrC,KAAI,CAAC,oBAAoB,EAAE,CAAC;YAC7B,CAAC,CAAC,CAAC;SACH;QAED,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,QAAQ,EAAE,EAAE;YAC5B,IAAI,CAAC,GAAG,CAAC,SAAS,GAAG,QAAQ,CAAC,SAAS,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;YAElD,IAAI,CAAC,GAAG,CAAC,OAAO,GAAG,QAAQ,CAAC,OAAO,CAAC,IAAI,CAAC,GAAG,EAAE,EAAC,SAAS,EAAE,GAAG,EAAC,CAAC,CAAC;YAEhE,IAAI,CAAC,GAAG,CAAC,SAAS,GAAG,QAAQ,CAAC,cAAc,CAAC,IAAI,CAAC,GAAG,EAAE,EAAE,SAAS,EAAE,GAAG,EAAE,CAAC,CAAC;YAE3E,IAAI,CAAC,GAAG,CAAC,mBAAmB,GAAG,CAAC,CAAC,OAAO,CAAC,mBAAmB,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;YACvE,IAAI,CAAC,GAAG,CAAC,YAAY,GAAG,CAAC,CAAC,OAAO,CAAC,YAAY,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;YACzD,IAAI,CAAC,GAAG,CAAC,sBAAsB,GAAG,CAAC,CAAC,OAAO,CAAC,sBAAsB,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;SAC7E;QAED,IAAI,CAAC,GAAG,CAAC,QAAQ,GAAG,CAAC,CAAC,OAAO,CAAC,QAAQ,EAAE,CAAC;QACzC,IAAI,CAAC,GAAG,CAAC,UAAU,CAAC,IAAI,CAAC,GAAG,CAAC,QAAQ,CAAC,CAAC;QAEvC,MAAM,CAAC,YAAY,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;QAE9B,IAAI,CAAC,iBAAiB,GAAG,CAAC,CAAC,OAAO,CAAC,iBAAiB,EAAE,CAAC;QACvD,IAAI,CAAC,GAAG,CAAC,UAAU,CAAC,IAAI,CAAC,iBAAiB,CAAC,CAAC;QAC5C,IAAI,CAAC,GAAG,CAAC,UAAU,CAAC,CAAC,CAAC,OAAO,CAAC,WAAW,EAAE,CAAC,CAAC;QAC7C,IAAI,MAAM,CAAC,IAAI,CAAC,QAAQ,EAAE,EAAE;YAC3B,IAAI,CAAC,YAAY,GAAG,CAAC,CAAC,OAAO,CAAC,YAAY,EAAE,CAAC;YAC7C,IAAI,CAAC,GAAG,CAAC,UAAU,CAAC,IAAI,CAAC,YAAY,CAAC,CAAC;SACvC;QACD,IAAI,CAAC,GAAG,CAAC,UAAU,CAAC,CAAC,CAAC,OAAO,CAAC,cAAc,EAAE,CAAC,CAAC;QAChD,IAAI,CAAC,GAAG,CAAC,MAAM,GAAG,CAAC,CAAC,OAAO,CAAC,SAAS,EAAE,CAAC;QACxC,IAAI,CAAC,GAAG,CAAC,UAAU,CAAC,IAAI,CAAC,GAAG,CAAC,MAAM,CAAC,CAAC;QACrC,IAAI,CAAC,GAAG,CAAC,UAAU,CAAC,CAAC,CAAC,OAAO,CAAC,WAAW,EAAE,CAAC,CAAC;QAC7C,IAAI,CAAC,GAAG,CAAC,QAAQ,GAAG,CAAC,CAAC,OAAO,CAAC,QAAQ,EAAE,CAAC;QACzC,IAAI,CAAC,GAAG,CAAC,UAAU,CAAC,IAAI,CAAC,GAAG,CAAC,QAAQ,CAAC,CAAC;QACvC,IAAI,CAAC,GAAG,CAAC,WAAW,GAAG,QAAQ,CAAC,WAAW,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;QAEtD,IAAI,CAAC,CAAC,GAAG,CAAC,UAAU,IAAI,MAAM,CAAC,uBAAuB;YACrD,IAAI,CAAC,GAAG,CAAC,UAAU,CAAC,CAAC,CAAC,GAAG,CAAC,UAAU,CAAC,CAAC;QAEvC,IAAI,aAAa,GAAG,UAAC,KAAa;YACjC,KAAI,CAAC,cAAc,GAAG,MAAM,CAAC,UAAU,CAAC;gBACvC,IAAI,IAAI,GAAG;oBACV,EAAE,EAAE,WAAW;oBACf,QAAQ,EAAE,QAAQ;oBAClB,IAAI,EAAE,YAAY;oBAClB,QAAQ,EAAE;wBACT;4BACC,EAAE,EAAE,eAAe;4BACnB,IAAI,EAAE,WAAW;4BACjB,QAAQ,EAAE,MAAM;4BAChB,QAAQ,EAAE;gCACT,EAAC,EAAE,EAAE,aAAa,EAAE,IAAI,EAAE,YAAY,EAAC;gCACvC,EAAC,EAAE,EAAE,WAAW,EAAE,IAAI,EAAE,WAAW,EAAE,IAAI,EAAE,KAAK,EAAC;6BACjD;yBACD;qBACD;iBACD,CAAC;gBACF,IAAI,GAAG,CAAC,MAAM,EAAE;oBACf,IAAI,eAAe,GAAG,cAA+B,CAAC,CAAC;oBACvD,GAAG,CAAC,MAAM,CAAC,UAAU,CAAC,EAAC,OAAO,EAAE,YAAY,GAAG,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,EAAE,QAAQ,EAAE,eAAe,EAAC,CAAC,CAAC;iBACjG;YACF,CAAC,EAAE,GAAG,CAAC,CAAC;QACT,CAAC,CAAC;QAEF,IAAI,gBAAgB,GAAG;YACtB,IAAI,KAAI,CAAC,cAAc,IAAI,IAAI;gBAC9B,MAAM,CAAC,YAAY,CAAC,KAAI,CAAC,cAAc,CAAC,CAAC;YAC1C,IAAI,IAAI,GAAG;gBACV,EAAE,EAAE,WAAW;gBACf,QAAQ,EAAE,QAAQ;gBAClB,IAAI,EAAE,YAAY;gBAClB,MAAM,EAAE,SAAS;aACjB,CAAC;YACF,IAAI,GAAG,CAAC,MAAM;gBACb,GAAG,CAAC,MAAM,CAAC,UAAU,CAAC,EAAC,OAAO,EAAE,YAAY,GAAG,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,EAAC,CAAC,CAAC;QACxE,CAAC,CAAC;QAEF,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,UAAU,EAAE,UAAC,CAAM;YAC9B,gBAAgB,EAAE,CAAC;YACnB,aAAa,CAAC,CAAC,CAAC,KAAK,CAAC,CAAC;QACxB,CAAC,CAAC,CAAC;QAEH,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,UAAU,EAAE,UAAC,CAAM;YAC9B,gBAAgB,EAAE,CAAC;QACpB,CAAC,CAAC,CAAC;IACJ,CAAC;IAED;;;OAGG;IACH,2CAAuB,GAAvB,UAAwB,OAAe;;QACtC,IAAI,SAAS,GAAG,MAAM,CAAC,IAAI,CAAC,SAAS,EAAE,CAAC;QACxC,IAAI,WAAW,GAAG,IAAI,CAAC,cAAc,EAAE,CAAC;QACxC,IAAI,iBAAiB,GAAG,WAAW,KAAK,aAAa,IAAI,CAAC,GAAG,CAAC,UAAU,EAAE,CAAC;QAC3E,IAAI,QAAQ,GAAG,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,WAAW,CAAC;QAEzC,QAAQ,CAAC,IAAI,CAAC,YAAY,CAAC,wBAAwB,EAAE,WAAW,CAAC,CAAC;QAClE,QAAQ,CAAC,IAAI,CAAC,YAAY,CAAC,cAAc,EAAE,OAAO,CAAC,CAAC;QAEpD,IAAI,QAAQ;YACX,QAAQ,CAAC,IAAI,CAAC,YAAY,CAAC,wBAAwB,EAAE,MAAM,CAAC,CAAC;QAE9D,IAAI,MAAM,CAAC,IAAI,CAAC,QAAQ,EAAE,EAAE;YAC3B,CAAC,CAAC,qBAAqB,CAAC,CAAC,GAAG,CAAC,SAAS,EAAE,MAAM,CAAC,CAAC;YAChD,IAAI,CAAC,GAAG,CAAC,eAAe,GAAG,QAAQ,CAAC,eAAe,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;YAC9D,IAAI,CAAC,GAAG,CAAC,YAAY,GAAG,QAAQ,CAAC,YAAY,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;YACxD,IAAI,CAAC,GAAG,CAAC,eAAe,GAAG,QAAQ,CAAC,eAAe,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;SAC9D;aAAM,IAAI,iBAAiB,EAAE;YAC7B,IAAI,CAAC,wBAAwB,CAAC,OAAO,CAAC,CAAC;YACvC,qDAAqD;SACrD;QAED,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,UAAU,CAAI,OAAO,iBAAc,EAAE,IAAI,CAAC,EAAE;YAC7D,IAAI,CAAC,mBAAmB,EAAE,CAAC;SAC3B;QAED,IAAI,CAAC,wBAAwB,EAAE,CAAC;QAEhC,IAAI,OAAO,KAAK,aAAa,EAAE;YAC9B,IAAI,CAAC,SAAS,GAAG,QAAQ,CAAC,SAAS,CAAC,IAAI,CAAC,GAAG,EAAE,SAAS,IAAI,MAAM,CAAC,IAAI,CAAC,QAAQ,EAAE,CAAC,CAAC;YAEnF,IAAM,aAAa,GAAG,QAAQ,CAAC,cAAc,CAAC,gBAAgB,CAAC,CAAC;YAChE,IAAM,kBAAkB,GAAG,QAAQ,CAAC,cAAc,CAAC,qBAAqB,CAAC,CAAC;YAC1E,MAAA,kBAAkB,aAAlB,kBAAkB,uBAAlB,kBAAkB,CAAE,SAAS,0CAAE,MAAM,CAAC,QAAQ,CAAC,CAAC;YAChD,MAAA,aAAa,aAAb,aAAa,uBAAb,aAAa,CAAE,SAAS,0CAAE,MAAM,CAAC,QAAQ,CAAC,CAAC;YAC3C,IAAI,CAAC,GAAG,CAAC,UAAU,GAAG,QAAQ,CAAC,UAAU,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;YACpD,IAAI,CAAC,GAAG,CAAC,iBAAiB,GAAG,QAAQ,CAAC,iBAAiB,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;YAClE,CAAC,CAAC,kBAAkB,CAAC,CAAC,QAAQ,CAAC,aAAa,CAAC,CAAC;YAE9C,yBAAyB;YACzB,CAAC,CAAC,OAAO,CAAC,MAAM,CAAC,CAAC,CAAC,OAAO,CAAC,GAAG,CAAC,+BAA+B,CAAC,CAAC,CAAC;YACjE,IAAM,gBAAgB,GAAG,QAAQ,CAAC,cAAc,CAAC,kBAAkB,CAAC,CAAC;YACrE,IAAI,gBAAgB,IAAI,IAAI;gBAC3B,MAAA,gBAAgB,CAAC,UAAU,0CAAE,WAAW,CAAC,gBAAgB,CAAC,CAAC;YAE5D,IAAM,cAAc,GAAG,IAAI,CAAC,gBAAgB,EAAE,CAAA,CAAC,CAAC,MAAM,CAAC,CAAC,CAAC,OAAO,CAAC;YACjE,IAAI,CAAC,GAAG,CAAC,oBAAoB,CAAC,CAAC,YAAY,CAAC,oBAAoB,EAAE,cAAc,CAAC,CAAC;YAClF,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,qBAAqB,EAAE,EAAC,WAAW,EAAG,oBAAoB,EAAE,KAAK,EAAG,cAAc,EAAC,CAAC,CAAC;SACpG;QAED,IAAI,IAAI,CAAC,GAAG,CAAC,uBAAuB,EAAE,EAAE;YACvC,yBAAyB;YACzB,CAAC,CAAC,OAAO,CAAC,MAAM,CAAC,CAAC,CAAC,OAAO,CAAC,GAAG,CAAC,qBAAqB,CAAC,CAAC,CAAC;YACvD,CAAC,CAAC,gCAAgC,CAAC,CAAC,IAAI,EAAE,CAAC;YAC3C,IAAI,CAAC,eAAe,EAAE,CAAC;YACvB,IAAI,CAAC,GAAG,CAAC,kBAAkB,GAAG,IAAI,SAAS,CAAC,kBAAkB,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;YACzE,IAAI,CAAC,GAAG,CAAC,gBAAgB,GAAG,IAAI,SAAS,CAAC,gBAAgB,CAAC,IAAI,CAAC,GAAG,EAAE,IAAI,CAAC,GAAG,CAAC,kBAAkB,CAAC,CAAC;SAClG;QAED,IAAI,OAAO,KAAK,MAAM,EAAE;YACvB,yBAAyB;YACzB,CAAC,CAAC,OAAO,CAAC,MAAM,CAAC,CAAC,CAAC,OAAO,CAAC,GAAG,CAAC,qBAAqB,CAAC,CAAC,CAAC;YACvD,CAAC,CAAC,OAAO,CAAC,MAAM,CAAC,CAAC,CAAC,OAAO,CAAC,GAAG,CAAC,+BAA+B,CAAC,CAAC,CAAC;YACjE,IAAM,gBAAgB,GAAG,QAAQ,CAAC,cAAc,CAAC,kBAAkB,CAAC,CAAC;YACrE,IAAI,gBAAgB,IAAI,IAAI;gBAC3B,MAAA,gBAAgB,CAAC,UAAU,0CAAE,WAAW,CAAC,gBAAgB,CAAC,CAAC;YAE5D,IAAI,CAAC,eAAe,EAAE,CAAC;YAEvB,IAAI,YAAY,GAAG,IAAI,CAAC,qBAAqB,CAAC,cAAc,EAAE,IAAI,CAAC,CAAC;YACpE,IAAI,YAAY,KAAK,KAAK;gBACzB,IAAI,CAAC,GAAG,CAAC,cAAc,CAAC,8BAA8B,CAAC,CAAC;YACzD,wCAAwC;YACxC,IAAI,mBAAmB,GAAG,IAAI,CAAC,GAAG,CAAC,oBAAoB,CAAC,CAAC,YAAY,CAAC,iBAAiB,CAAC,CAAC;YACzF,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,qBAAqB,EAAE,EAAC,WAAW,EAAG,iBAAiB,EAAE,KAAK,EAAG,mBAAmB,EAAC,CAAC,CAAC;YACtG,IAAI,CAAC,GAAG,CAAC,OAAO,GAAG,CAAC,CAAC,OAAO,CAAC,OAAO,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;SAC/C;QAED,IAAI,IAAI,CAAC,GAAG,CAAC,uBAAuB,EAAE,IAAI,CAAC,SAAS,IAAI,MAAM,CAAC,IAAI,CAAC,QAAQ,EAAE,CAAC,EAAE;YAChF,QAAQ,CAAC,eAAe,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;SACnC;QACD,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,QAAQ,EAAE,IAAI,MAAM,CAAC,IAAI,CAAC,SAAS,EAAE,CAAC,IAAI,CAAC,GAAG,CAAC,UAAU,EAAE,EAAE;YAC7E,IAAI,CAAC,GAAG,CAAC,SAAS,CAAC,mBAAmB,CAAC,OAAO,CAAC,CAAC;SAChD;QAED,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,cAAc,EAAE,IAAI,CAAC,cAAc,EAAE,IAAI,CAAC,CAAC;QAEvD,IAAI,CAAC,YAAY,EAAE,CAAC;QAEpB,IAAI,oBAAoB,GAAG,IAAI,CAAC,GAAG,CAAC,uBAAuB,EAAE,IAAI,MAAM,CAAC,UAAU,CAAC,GAAG,CAAC,mBAAmB,CAAC,CAAC;QAC5G,gFAAgF;QAChF,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,WAAW,EAAE;YACxB,IAAI,oBAAoB,KAAK,MAAM,IAAI,oBAAoB,KAAK,GAAG,EAAE;gBACpE,GAAG,CAAC,UAAU,CAAC,QAAQ,CAAC,cAAc,CAAC,CAAC;aACxC;QACF,CAAC,CAAC,CAAC;IACJ,CAAC;IAED;;OAEG;IACH,qCAAiB,GAAjB;QACC,gEAAgE;QAChE,IAAI,MAAM,CAAC,IAAI,CAAC,SAAS,EAAE,IAAI,CAAC,MAAM,CAAC,gBAAgB,EAAE;YACxD,IAAI,WAAW,GAAG,IAAI,CAAC,qBAAqB,CAAC,aAAa,EAAE,IAAI,CAAC,CAAC;YAElE,IAAI,IAAI,CAAC,qBAAqB,CAAC,cAAc,EAAE,IAAI,CAAC,EAAE;gBACrD,GAAG,CAAC,MAAM,CAAC,WAAW,CAAC,sBAAsB,CAAC,CAAC;aAC/C;YAED,IAAI,IAAI,CAAC,GAAG,CAAC,UAAU,EAAE,KAAK,cAAc,EAAE;gBAC7C,IAAI,IAAI,CAAC,qBAAqB,CAAC,uBAAuB,EAAE,KAAK,CAAC,EAAE;oBAC/D,GAAG,CAAC,MAAM,CAAC,WAAW,CAAC,sBAAsB,CAAC,CAAC;oBAC/C,GAAG,CAAC,MAAM,CAAC,WAAW,CAAC,4BAA4B,CAAC,CAAC;oBACrD,IAAI,CAAC,GAAG,CAAC,OAAO,CAAC,eAAe,CAAC,wBAAwB,CAAC,CAAC;iBAC3D;qBAAM,IAAI,IAAI,CAAC,qBAAqB,CAAC,uBAAuB,EAAE,KAAK,CAAC,EAAE;oBACtE,GAAG,CAAC,MAAM,CAAC,WAAW,CAAC,sBAAsB,CAAC,CAAC;oBAC/C,GAAG,CAAC,MAAM,CAAC,WAAW,CAAC,0BAA0B,CAAC,CAAC;oBACnD,IAAI,CAAC,GAAG,CAAC,OAAO,CAAC,eAAe,CAAC,sBAAsB,CAAC,CAAC;iBACzD;qBAAM,IAAI,IAAI,CAAC,qBAAqB,CAAC,mBAAmB,EAAE,KAAK,CAAC,EAAE;oBAClE,GAAG,CAAC,MAAM,CAAC,WAAW,CAAC,sBAAsB,CAAC,CAAC;oBAC/C,GAAG,CAAC,MAAM,CAAC,WAAW,CAAC,4BAA4B,CAAC,CAAC;oBACrD,IAAI,CAAC,GAAG,CAAC,OAAO,CAAC,eAAe,CAAC,wBAAwB,CAAC,CAAC;iBAC3D;aACD;iBAAM,IAAI,IAAI,CAAC,qBAAqB,CAAC,eAAe,EAAE,KAAK,CAAC,EAAE;gBAC9D,GAAG,CAAC,MAAM,CAAC,WAAW,CAAC,sBAAsB,CAAC,CAAC;gBAC/C,GAAG,CAAC,MAAM,CAAC,WAAW,CAAC,oCAAoC,CAAC,CAAC;gBAC7D,IAAI,CAAC,GAAG,CAAC,OAAO,CAAC,eAAe,CAAC,gCAAgC,CAAC,CAAC;aACnE;YAED,IAAI,WAAW;gBACd,IAAI,CAAC,GAAG,CAAC,OAAO,CAAC,gBAAgB,EAAE,CAAC;;gBAEpC,GAAG,CAAC,MAAM,CAAC,WAAW,CAAC,sBAAsB,CAAC,CAAC;SAChD;aACI,IAAI,MAAM,CAAC,IAAI,CAAC,YAAY,EAAE,EAAE;YACpC,kDAAkD;YAClD,sDAAsD;YACtD,kDAAkD;YAClD,kDAAkD;YAClD,2CAA2C;YAC3C,2CAA2C;YAC3C,oBAAoB;YACpB,GAAG,CAAC,MAAM,CAAC,WAAW,CAAC,sBAAsB,CAAC,CAAC;SAC/C;IACF,CAAC;IAED;;OAEG;IACH,mCAAe,GAAf;QACC,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,QAAQ,EAAE,IAAI,MAAM,CAAC,IAAI,CAAC,SAAS,EAAE,CAAC,IAAI,CAAC,GAAG,CAAC,UAAU,EAAE,EAAE;YAC7E,IAAI,SAAS,GAAG,IAAI,CAAC,qBAAqB,CAAC,WAAW,CAAC,CAAC;YACxD,IAAI,gBAAgB,GAAG,IAAI,CAAC,GAAG,CAAC,UAAU,EAAE,CAAC;YAC7C,8CAA8C;YAC9C,GAAG,CAAC,WAAW,CAAC,KAAK,CAAC,eAAe,CAAC,IAAI,CAAC,GAAG,EAAE;gBAC/C,WAAW,EAAE,gBAAgB;gBAC7B,SAAS,EAAE,SAAS;aACpB,CAAC,CAAC;SACH;IACF,CAAC;IAED;;OAEG;IACH,mCAAe,GAAf;QACC,IAAI,IAAI,CAAC,GAAG,CAAC,OAAO,EACpB;YACC,IAAI,CAAC,GAAG,CAAC,aAAa,CAAC,IAAI,CAAC,GAAG,CAAC,OAAO,CAAC,CAAC;YACzC,IAAI,CAAC,GAAG,CAAC,OAAO,GAAG,IAAI,CAAC;SACxB;QACD,IAAI,IAAI,CAAC,GAAG,CAAC,UAAU,EACvB;YACC,IAAI,CAAC,GAAG,CAAC,UAAU,CAAC,QAAQ,EAAE,CAAC;YAC/B,IAAI,CAAC,GAAG,CAAC,UAAU,GAAG,IAAI,CAAC;SAC3B;IACF,CAAC;IAED;;OAEG;IACH,gCAAY,GAAZ;QACC,IAAI,CAAC,GAAG,CAAC,OAAO,GAAG,CAAC,CAAC,OAAO,CAAC,OAAO,EAAE,CAAC;QACvC,IAAI,CAAC,GAAG,CAAC,UAAU,CAAC,IAAI,CAAC,GAAG,CAAC,OAAO,CAAC,CAAC;QACtC,IAAI,CAAC,GAAG,CAAC,UAAU,GAAG,QAAQ,CAAC,UAAU,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;QAEpD,+CAA+C;QAC/C,IAAI,CAAC,GAAG,CAAC,UAAU,CAAC,WAAW,CAAC,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,CAAC;QAE/C,IAAI,CAAC,GAAG,CAAC,OAAO,CAAC,eAAe,EAAE,CAAC;QACnC,IAAI,CAAC,GAAG,CAAC,UAAU,CAAC,cAAc,EAAE,CAAC;QACrC,IAAI,CAAC,GAAG,CAAC,mBAAmB,EAAE,CAAC;QAC/B,IAAI,CAAC,GAAG,CAAC,SAAS,CAAC,mBAAmB,EAAE,CAAC;QACzC,IAAI,CAAC,GAAG,CAAC,SAAS,CAAC,gBAAgB,EAAE,CAAC;QAEtC,IAAI,CAAC,GAAG,CAAC,UAAU,CAAC,mBAAmB,EAAE,CAAC;QAE1C,IAAI,IAAI,CAAC,sBAAsB;YAC9B,IAAI,CAAC,WAAW,EAAE,CAAC;IACrB,CAAC;IAED;;;OAGG;IACH,4CAAwB,GAAxB,UAAyB,OAAe;QACvC,IAAI,OAAO,KAAK,aAAa,EAAE;YAC9B,IAAI,WAAW,GAAG,CAAC,CAAC,OAAO,CAAC,eAAe,EAAE,CAAC;SAC9C;aAAM,IAAI,OAAO,KAAK,cAAc,EAAE;YACtC,WAAW,GAAG,CAAC,CAAC,OAAO,CAAC,kBAAkB,EAAE,CAAC;SAC7C;aAAM,IAAI,OAAO,KAAK,SAAS,EAAE;YACjC,WAAW,GAAG,CAAC,CAAC,OAAO,CAAC,eAAe,EAAE,CAAC;SAC1C;aAAM;YACN,WAAW,GAAG,CAAC,CAAC,OAAO,CAAC,iBAAiB,EAAE,CAAC;SAC5C;QAED,IAAI,CAAC,WAAW,GAAG,WAAW,CAAC;QAC/B,IAAI,CAAC,GAAG,CAAC,UAAU,CAAC,WAAW,CAAC,CAAC;QACjC,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,kBAAkB,CAAC,CAAC;QAClC,GAAG,CAAC,EAAE,CAAC,wBAAwB,CAAC,UAAU,EAAE,CAAC;IAC9C,CAAC;IAED;;OAEG;IACH,2CAAuB,GAAvB;QACC,IAAI,IAAI,CAAC,cAAc,EAAE,KAAK,SAAS,IAAI,IAAI,CAAC,GAAG,CAAC,cAAc,EAAE,EAAE;YACrE,IAAI,CAAC,cAAc,EAAE,CAAC;YACtB,IAAI,CAAC,cAAc,EAAE,CAAC;SACtB;QACD,kDAAkD;QAClD,yCAAyC;IAC1C,CAAC;IAED;;OAEG;IACH,sCAAkB,GAAlB;QACE,IAAI,WAAW,GAAG,CAAC,CAAC,2CAA2C,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,IAAI,gBAAgB,CAAC;QAChG,IAAI,CAAC,mBAAmB,EAAE,CAAC;QAC3B,IAAI,CAAC,wBAAwB,CAAC,IAAI,CAAC,GAAG,CAAC,UAAU,EAAE,CAAC,CAAC;QACrD,IAAI,IAAI,CAAC,IAAI,CAAC,WAAW,KAAK,MAAM,EAAE;YACrC,CAAC,CAAC,WAAW,CAAC,CAAC,WAAW,CAAC,UAAU,CAAC,CAAC;SACvC;QACD,CAAC,CAAC,GAAG,GAAG,WAAW,CAAC,CAAC,KAAK,EAAE,CAAC;QAC7B,IAAI,CAAC,uBAAuB,EAAE,CAAC;QAC/B,IAAI,CAAC,WAAW,CAAC,gBAAgB,GAAG,IAAI,CAAC;QACzC,IAAI,CAAC,WAAW,CAAC,QAAQ,EAAE,CAAC;QAC5B,CAAC,CAAC,MAAM,CAAC,CAAC,QAAQ,CAAC,oBAAoB,CAAC,CAAC;QACzC,IAAI,CAAC,mBAAmB,EAAE,CAAC;QAC3B,IAAI,CAAC,GAAG,CAAC,mBAAmB,EAAE,CAAC;QAC/B,IAAI,IAAI,CAAC,GAAG,CAAC,UAAU,EAAE,KAAK,cAAc;YAC3C,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,iBAAiB,CAAC,CAAC;IACpC,CAAC;IAED;;OAEG;IACH,kCAAc,GAAd;QACC,IAAI,IAAI,CAAC,GAAG,CAAC,OAAO;YACnB,IAAI,CAAC,GAAG,CAAC,OAAO,CAAC,UAAU,EAAE,CAAC;IAChC,CAAC;IAED;;;OAGG;IACH,kCAAc,GAAd,UAAe,EAAW;QACzB,EAAE,GAAG,EAAE,KAAK,SAAS,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,GAAG,CAAC;QACjC,UAAU,CAAC;YACV,IAAI,OAAO,GAAG,cAAc;gBAC3B,CAAC,MAAM,CAAC,SAAS,KAAK,SAAS,CAAC,CAAC,CAAC,MAAM,CAAC,SAAS,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;gBACxD,cAAc,CAAC;YAChB,GAAG,CAAC,MAAM,CAAC,WAAW,CAAC,OAAO,CAAC,CAAC;QACjC,CAAC,EAAE,EAAE,CAAC,CAAC;IACR,CAAC;IAED;;OAEG;IACH,kCAAc,GAAd;QACC,OAAO;IACR,CAAC;IAED;;OAEG;IACH,oCAAgB,GAAhB;QACC,IAAI,CAAC,kBAAkB,EAAE,CAAC;QAC1B,IAAI,CAAC,GAAG,CAAC,SAAS,CAAC,mBAAmB,EAAE,CAAC;QACzC,IAAI,CAAC,GAAG,CAAC,SAAS,CAAC,gBAAgB,EAAE,CAAC;QACtC,IAAI,gBAAgB,GAAG,IAAI,CAAC,eAAe,EAAE,CAAC;QAC9C,IAAI,CAAC,WAAW,EAAE,CAAC;QACnB,IAAI,CAAC,sBAAsB,GAAG,gBAAgB,CAAC;IAChD,CAAC;IAED;;OAEG;IACH,uCAAmB,GAAnB;QACC,IAAI,IAAI,CAAC,WAAW,EAAE;YACrB,IAAI,CAAC,GAAG,CAAC,aAAa,CAAC,IAAI,CAAC,WAAW,CAAC,CAAC;YACzC,IAAI,CAAC,WAAW,GAAG,IAAI,CAAC;SACxB;QACD,CAAC,CAAC,MAAM,CAAC,CAAC,WAAW,CAAC,oBAAoB,CAAC,CAAC;IAC7C,CAAC;IAED;;;OAGG;IACH,kCAAc,GAAd,UAAe,MAAW;QACzB,IAAI,MAAM,CAAC,IAAI,CAAC,QAAQ,EAAE;YACzB,OAAO;QAER,IAAI,WAAW,GAAG,IAAI,CAAC,cAAc,EAAE,CAAC;QAExC,IAAI,MAAM,CAAC,IAAI,KAAK,WAAW,IAAI,CAAC,MAAM,CAAC,KAAK;YAC/C,OAAO;QAER,IAAI,MAAM,CAAC,IAAI,KAAK,SAAS,IAAI,MAAM,CAAC,IAAI,KAAK,aAAa;YAC7D,OAAO;QAER,QAAQ,CAAC,IAAI,CAAC,YAAY,CAAC,wBAAwB,EAAE,MAAM,CAAC,IAAI,CAAC,CAAC;QAElE,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,aAAa,EAAE,EAAC,KAAK,EAAE,0BAA0B,EAAE,IAAI,EAAE,EAAC,IAAI,EAAE,MAAM,CAAC,IAAI,EAAC,EAAC,CAAC,CAAC;QAE7F,QAAQ,WAAW,EAAE;YACrB,KAAK,SAAS;gBACb,IAAI,CAAC,eAAe,EAAE,CAAC;gBACvB,MAAM;YAEP,KAAK,aAAa;gBACjB,IAAI,CAAC,mBAAmB,EAAE,CAAC;gBAC3B,MAAM;SACN;QAED,MAAM,CAAC,iBAAiB,GAAG,MAAM,CAAC,IAAI,CAAC;QAEvC,QAAQ,MAAM,CAAC,IAAI,EAAE;YACrB,KAAK,SAAS;gBACb,IAAI,CAAC,YAAY,EAAE,CAAC;gBACpB,MAAM;YAEP,KAAK,aAAa;gBACjB,IAAI,CAAC,gBAAgB,EAAE,CAAC;gBACxB,MAAM;SACN;QAED,MAAM,CAAC,KAAK,CAAC,GAAG,CAAC,aAAa,EAAE,MAAM,CAAC,IAAI,KAAK,SAAS,CAAC,CAAC;QAC3D,IAAI,CAAC,iBAAiB,EAAE,CAAC;QACzB,IAAI,CAAC,mBAAmB,EAAE,CAAC;QAE3B,kFAAkF;QAClF,sBAAsB;QACtB,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,cAAc,CAAC,CAAC;QAC9B,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,kBAAkB,CAAC,CAAC;QAElC,IAAI,OAAO,MAAM,CAAC,aAAa,KAAK,UAAU;YAC7C,MAAM,CAAC,aAAa,EAAE,CAAC;QACxB,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,iBAAiB,CAAC,CAAC;QACjC,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,cAAc,CAAC,CAAC;QAC9B,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,kBAAkB,CAAC,CAAC;QAClC,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,kBAAkB,CAAC,CAAC;IACnC,CAAC;IAED,kBAAkB;IAElB;;;OAGG;IACH,gDAA4B,GAA5B,UAA6B,MAAW;QACvC,IAAI,IAAI,CAAC,GAAG,CAAC,UAAU,EAAE,EAAE;YAC1B,0FAA0F;YAC1F,IAAI,YAAY,GAAG,MAAM,CAAC,YAAY,IAAI,MAAM,CAAC;YAEjD,IAAI,SAAS,GAAoB;gBAChC;oBACC,IAAI,EAAE,QAAQ;oBACd,GAAG,EAAE,MAAM,CAAC,UAAU;oBACtB,EAAE,EAAE,MAAM,CAAC,EAAE;oBACb,GAAG,EAAE,MAAM,CAAC,EAAE;oBACd,IAAI,EAAE,CAAC,CAAC,MAAM,CAAC,IAAI,CAAC,UAAU,CAAC,GAAG,EAAE,QAAQ,CAAC,CAAC;oBAC9C,mFAAmF;oBACnF,WAAW,EAAE,CAAC,MAAM,CAAC,SAAS,CAAC,cAAc,CAAC,IAAI,CAAC,MAAM,EAAE,YAAY,CAAC;iBACxE;aACD,CAAC;YAEF,cAAc;YACd,IAAI,UAAU,GAAG,MAAM,CAAC,GAAG,CAAC,GAAG,CAAC,UAAU,CAAC;YAC3C,IAAI,UAAU,IAAI,CAAC,UAAU,CAAC,OAAO,CAAC,MAAM,CAAC,EAAE,CAAC,EAAE;gBACjD,6BAA6B;gBAC7B,SAAS,CAAC,CAAC,CAAC,CAAC,OAAO,GAAG,SAAS,CAAC,CAAC,CAAC,CAAC,GAAG,CAAC;gBACxC,SAAS,CAAC,CAAC,CAAC,CAAC,IAAI,GAAG,UAAU,CAAC;gBAC/B,SAAS,CAAC,CAAC,CAAC,CAAC,MAAM,GAAG,SAAS,CAAC,CAAC,CAAC,CAAC,GAAG,CAAC;gBACvC,SAAS,CAAC,CAAC,CAAC,CAAC,IAAI,GAAG,SAAS,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC;gBACtC,UAAU,CAAC,UAAU,CAAC,YAAY,EAAE,SAAS,CAAC,CAAC;gBAE/C,iDAAiD;gBACjD,IAAI,CAAC,2BAA2B,EAAE,CAAC;aACnC;SACD;QAED,IAAI,IAAI,CAAC,GAAG,CAAC,cAAc,EAAE,EAAE;YAC9B,+BAA+B;YAC/B,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,SAAS,EAAE,EAAC,EAAE,EAAE,MAAM,CAAC,EAAE,EAAE,KAAK,EAAE,MAAM,CAAC,IAAI,EAAC,CAAC,CAAC;SAC9D;IACF,CAAC;IAED,+CAA2B,GAA3B;;;YACC,KAAmB,IAAA,KAAA,SAAA,IAAI,CAAC,aAAa,CAAA,gBAAA,4BAAE;gBAAlC,IAAI,MAAM,WAAA;gBACd,IAAM,IAAI,GAAG,QAAQ,CAAC,aAAa,CAAC,aAAa,GAAG,kBAAkB,CAAC,MAAM,CAAC,EAAE,CAAC,CAAuB,CAAC;gBACzG,IAAI,MAAM,GAAG,MAAM,CAAC,MAAM,CAAC;gBAC3B,IAAI,IAAI,EAAE;oBACT,IAAG,MAAM,CAAC,MAAM,KAAK,SAAS,IAAI,MAAM,CAAC,MAAM,KAAK,EAAE,EAAE;wBACvD,IAAI,QAAQ,GAAG,GAAG,CAAC,MAAM,CAAC,oBAAoB,CAAC,MAAM,CAAC,UAAU,CAAC,CAAC;wBAClE,MAAM,GAAG,GAAG,CAAC,MAAM,CAAC,WAAW,CAAC,QAAQ,CAAC,CAAC;qBAC1C;oBACD,IAAI,CAAC,KAAK,CAAC,UAAU,GAAG,OAAO,GAAG,SAAS,CAAC,MAAM,CAAC,GAAG,IAAI,CAAC;oBAC3D,IAAI,CAAC,KAAK,CAAC,gBAAgB,GAAG,WAAW,CAAC;oBAC1C,IAAI,CAAC,KAAK,CAAC,kBAAkB,GAAG,QAAQ,CAAC;iBACzC;aACD;;;;;;;;;IACF,CAAC;IAED;;;;;OAKG;IACH,gCAAY,GAAZ,UAAa,MAAW;QACvB,KAAK,IAAI,CAAC,IAAI,IAAI,CAAC,aAAa,EAAE;YACjC,IAAI,IAAI,GAAG,IAAI,CAAC,aAAa,CAAC,CAAC,CAAC,CAAC;YACjC,IAAI,IAAI,CAAC,EAAE,KAAK,MAAM,CAAC,EAAE;gBACxB,OAAO;SACR;QAED,IAAI,CAAC,aAAa,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;QAChC,IAAI,CAAC,kBAAkB,CAAC,MAAM,CAAC,CAAC;IACjC,CAAC;IAED;;;OAGG;IACH,sCAAkB,GAAlB,UAAmB,MAAW;QAC7B,IAAI,MAAM,CAAC,MAAM,KAAK,KAAK,IAAI,MAAM,CAAC,IAAI,CAAC,QAAQ,EAAE,EAAE;YACtD,OAAO;SACP;QACD,IAAI,CAAC,IAAI,CAAC,WAAW;YACpB,IAAI,CAAC,4BAA4B,CAAC,MAAM,CAAC,CAAC;;YAE1C,IAAI,CAAC,WAAW,CAAC,uBAAuB,CAAC,MAAM,CAAC,CAAC;IACnD,CAAC;IAED;;OAEG;IACH,uCAAmB,GAAnB;QACC,KAAK,IAAI,CAAC,IAAI,IAAI,CAAC,aAAa;YAC/B,IAAI,CAAC,kBAAkB,CAAC,IAAI,CAAC,aAAa,CAAC,CAAC,CAAC,CAAC,CAAC;IACjD,CAAC;IAED;;;;OAIG;IACH,8CAA0B,GAA1B,UAA2B,QAAgB,EAAE,IAAa;QACzD,cAAc;QACd,IAAM,QAAQ,GAAU,EAAE,CAAC;QAC3B,IAAI,KAAK,GAAG,KAAK,CAAC;QAElB,QAAQ,CAAC,OAAO,CAAC,UAAC,OAAO;YACxB,IAAI,OAAO,IAAI,OAAO,CAAC,GAAG,CAAC,QAAQ,CAAC,EAAE;gBACrC,KAAK,GAAG,IAAI,CAAC;gBACb,OAAO,CAAC,QAAQ,CAAC,QAAQ,EAAE,IAAI,CAAC,CAAC;aACjC;QACF,CAAC,CAAC,CAAC;QAEH,IAAM,aAAa,GAAG,MAAM,CAAC,GAAG,CAAC,GAAG,CAAC,UAAU,CAAC,OAAO,CAAC,QAAQ,CAAC,CAAC;QAClE,KAAK,GAAG,KAAK,IAAI,aAAa,CAAC;QAC/B,IAAI,aAAa;YAChB,MAAM,CAAC,GAAG,CAAC,GAAG,CAAC,UAAU,CAAC,QAAQ,CAAC,QAAQ,EAAE,IAAI,CAAC,CAAC;QAEpD,OAAO,KAAK,CAAC;IACd,CAAC;IAED;;;;OAIG;IACH,8BAAU,GAAV,UAAW,QAAgB,EAAE,IAAa;QACzC,IAAI,KAAK,GAAG,KAAK,CAAC;QAClB,IAAI,CAAC,IAAI,CAAC,WAAW,EAAE;YACtB,KAAK,GAAG,IAAI,CAAC,0BAA0B,CAAC,QAAQ,EAAE,IAAI,CAAC,CAAC;SACxD;aAAM;YACN,IAAI,IAAI,EAAE;gBACT,OAAO,IAAI,CAAC,aAAa,CAAC,QAAQ,CAAC,CAAC;aACpC;iBAAM;gBACN,IAAI,CAAC,aAAa,CAAC,QAAQ,CAAC,GAAG,IAAI,CAAC;aACpC;YACD,IAAI,CAAC,WAAW,CAAC,kBAAkB,EAAE,CAAC;YACtC,KAAK,GAAG,IAAI,CAAC,WAAW,CAAC,qBAAqB,CAAC,QAAQ,EAAE,IAAI,CAAC,CAAC;SAC/D;QAED,IAAI,CAAC,KAAK,EAAE;YACX,MAAM,CAAC,GAAG,CAAC,OAAO,CAAC,KAAK,CAAC,kBAAkB,GAAG,QAAQ,GAAG,cAAc,CAAC,CAAC;YACzE,OAAO;SACP;IACF,CAAC;IAED;;;OAGG;IACH,mCAAe,GAAf,UAAgB,QAAgB;QAC/B,OAAO,CAAC,CAAC,QAAQ,IAAI,IAAI,CAAC,aAAa,CAAC,CAAC;IAC1C,CAAC;IAED,WAAW;IAEX;;;;OAIG;IACH,wCAAoB,GAApB,UAAqB,OAAe,EAAE,IAAa;QAClD,IAAI,OAAO,GAAG,IAAI,CAAC,IAAI,CAAC,OAAO,CAAC;QAChC,IAAI,IAAI,EAAE;YACT,OAAO,OAAO,CAAC,WAAW,CAAC,OAAO,CAAC,CAAC;SACpC;aAAM;YACN,OAAO,OAAO,CAAC,WAAW,CAAC,OAAO,CAAC,CAAC;SACpC;IACF,CAAC;IAED;;;;OAIG;IACH,+CAA2B,GAA3B,UAA4B,OAAe,EAAE,IAAa;QAA1D,iBAsBC;QArBA,cAAc;QACd,IAAM,QAAQ,GAAU,EAAE,CAAC;QAC3B,IAAI,KAAK,GAAG,KAAK,CAAC;QAElB,QAAQ,CAAC,OAAO,CAAC,UAAC,OAAO;YACxB,IAAI,CAAC,OAAO;gBACX,OAAO;YACR,OAAO,CAAC,KAAK,CAAC,OAAO,CAAC,UAAC,IAAS;gBAC/B,IAAI,QAAQ,GAAG,KAAI,CAAC,GAAG,CAAC,eAAe,CAAC,IAAI,CAAC,CAAC;gBAC9C,IAAI,QAAQ,CAAC,OAAO,CAAC,OAAO,CAAC,IAAI,CAAC,CAAC,EAAE;oBACpC,KAAK,GAAG,IAAI,CAAC;oBACb,IAAI,IAAI,EAAE;wBACT,OAAO,CAAC,QAAQ,CAAC,IAAI,CAAC,EAAE,EAAE,IAAI,CAAC,CAAC;qBAChC;yBAAM;wBACN,OAAO,CAAC,QAAQ,CAAC,IAAI,CAAC,EAAE,EAAE,KAAK,CAAC,CAAC;qBACjC;iBACD;YACF,CAAC,CAAC,CAAC;QACJ,CAAC,CAAC,CAAC;QAEH,OAAO,KAAK,CAAC;IACd,CAAC;IAED;;;;OAIG;IACH,+BAAW,GAAX,UAAY,OAAe,EAAE,IAAa;QACzC,IAAI,IAAI,EAAE;YACT,OAAO,IAAI,CAAC,cAAc,CAAC,OAAO,CAAC,CAAC;SACpC;aAAM;YACN,IAAI,CAAC,cAAc,CAAC,OAAO,CAAC,GAAG,IAAI,CAAC;SACpC;QACD,IAAI,KAAK,GAAG,KAAK,CAAC;QAClB,IAAI,CAAC,IAAI,CAAC,WAAW,EAAE;YACtB,KAAK,KAAL,KAAK,GAAK,IAAI,CAAC,2BAA2B,CAAC,OAAO,EAAE,IAAI,CAAC,EAAC;YAC1D,KAAK,KAAL,KAAK,GAAK,IAAI,CAAC,oBAAoB,CAAC,OAAO,EAAE,IAAI,CAAC,EAAC;SACnD;aAAM;YACN,IAAI,CAAC,WAAW,CAAC,kBAAkB,EAAE,CAAC;YACtC,KAAK,KAAL,KAAK,GAAK,IAAI,CAAC,WAAW,CAAC,sBAAsB,CAAC,OAAO,EAAE,IAAI,CAAC,EAAC;SACjE;QAED,IAAI,CAAC,KAAK,EAAE;YACX,MAAM,CAAC,GAAG,CAAC,OAAO,CAAC,KAAK,CAAC,qBAAqB,GAAG,OAAO,GAAG,cAAc,CAAC,CAAC;SAC3E;IACF,CAAC;IAED;;;OAGG;IACH,oCAAgB,GAAhB,UAAiB,OAAe;QAC/B,OAAO,CAAC,CAAC,OAAO,IAAI,IAAI,CAAC,cAAc,CAAC,CAAC;IAC1C,CAAC;IAED,UAAU;IAEV;;OAEG;IACH,+BAAW,GAAX;QACC,IAAI,CAAC,sBAAsB,GAAG,KAAK,CAAC;QACpC,IAAI,CAAC,IAAI,CAAC,eAAe,EAAE;YAC1B,OAAO;QACR,CAAC,CAAC,WAAW,CAAC,CAAC,IAAI,EAAE,CAAC;QACtB,IAAI,CAAC,CAAC,MAAM,CAAC,kBAAkB,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,QAAQ,EAAE,EAAE;YAC3D,CAAC,CAAC,qBAAqB,CAAC,CAAC,IAAI,EAAE,CAAC;YAChC,CAAC,CAAC,8BAA8B,CAAC,CAAC,IAAI,EAAE,CAAC;SACzC;QACD,IAAM,GAAG,GAAG,QAAQ,CAAC,cAAc,CAAC,aAAa,CAAC,CAAC;QACnD,IAAI,GAAG,IAAI,IAAI;YACd,GAAG,CAAC,KAAK,CAAC,SAAS,GAAG,cAAc,CAAC;QAEtC,CAAC,CAAC,OAAO,CAAC,CAAC,IAAI,CAAC,OAAO,EAAE,CAAC,CAAC,WAAW,CAAC,CAAC,CAAC;QAEzC,IAAI,IAAI,CAAC,6BAA6B;YACrC,IAAI,CAAC,mBAAmB,EAAE,CAAC;IAC7B,CAAC;IAED;;OAEG;IACH,+BAAW,GAAX;QACC,IAAI,CAAC,sBAAsB,GAAG,IAAI,CAAC;QACnC,IAAI,IAAI,CAAC,eAAe,EAAE,IAAI,IAAI,CAAC,wBAAwB,EAAE;YAC5D,OAAO;QAER,IAAI,uBAAuB,GAAG,IAAI,CAAC,sBAAsB,EAAE,CAAC;QAC5D,IAAI,CAAC,iBAAiB,EAAE,CAAC,CAAE,0GAA0G;QACrI,IAAI,CAAC,6BAA6B,GAAG,uBAAuB,CAAC;QAE7D,CAAC,CAAC,WAAW,CAAC,CAAC,IAAI,EAAE,CAAC;QACtB,IAAI,CAAC,CAAC,MAAM,CAAC,kBAAkB,EAAE;YAChC,CAAC,CAAC,qBAAqB,CAAC,CAAC,IAAI,EAAE,CAAC;YAChC,CAAC,CAAC,8BAA8B,CAAC,CAAC,IAAI,EAAE,CAAC;SACzC;QACD,IAAM,GAAG,GAAG,QAAQ,CAAC,cAAc,CAAC,aAAa,CAAC,CAAC;QACnD,IAAI,GAAG,IAAI,IAAI;YACd,GAAG,CAAC,KAAK,CAAC,SAAS,GAAG,gBAAgB,CAAC;QAExC,CAAC,CAAC,OAAO,CAAC,CAAC,IAAI,CAAC,OAAO,EAAE,CAAC,CAAC,WAAW,CAAC,CAAC,CAAC;IAC1C,CAAC;IAED;;OAEG;IACH,mCAAe,GAAf;QACC,OAAO,CAAC,CAAC,WAAW,CAAC,CAAC,GAAG,CAAC,SAAS,CAAC,KAAK,MAAM,CAAC;IACjD,CAAC;IAED;;OAEG;IACH,iCAAa,GAAb;QACC,IAAI,IAAI,CAAC,eAAe,EAAE;YACzB,IAAI,CAAC,WAAW,EAAE,CAAC;;YAEnB,IAAI,CAAC,WAAW,EAAE,CAAC;IACrB,CAAC;IAED,QAAQ;IAER;;OAEG;IACH,6BAAS,GAAT;QACC,IAAI,CAAC,IAAI,CAAC,cAAc,CAAC,gBAAgB,CAAC,CAAC;QAC3C,CAAC,CAAC,aAAa,CAAC,CAAC,IAAI,EAAE,CAAC;QACxB,CAAC,CAAC,MAAM,CAAC,CAAC,QAAQ,CAAC,UAAU,CAAC,CAAC;QAC/B,IAAI,CAAC,cAAc,CAAC,WAAW,EAAE,IAAI,CAAC,CAAC;QACvC,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,cAAc,CAAC,CAAC;IAC/B,CAAC;IAED;;OAEG;IACH,6BAAS,GAAT;QACC,CAAC,CAAC,aAAa,CAAC,CAAC,IAAI,EAAE,CAAC;QACxB,CAAC,CAAC,MAAM,CAAC,CAAC,WAAW,CAAC,UAAU,CAAC,CAAC;QAClC,IAAI,CAAC,cAAc,CAAC,WAAW,EAAE,KAAK,CAAC,CAAC;QACxC,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,cAAc,CAAC,CAAC;IAC/B,CAAC;IAED;;OAEG;IACH,+BAAW,GAAX;QACC,IAAI,IAAI,CAAC,cAAc,EAAE;YACxB,IAAI,CAAC,SAAS,EAAE,CAAC;;YAEjB,IAAI,CAAC,SAAS,EAAE,CAAC;IACnB,CAAC;IAED;;OAEG;IACH,kCAAc,GAAd;QACC,OAAO,CAAC,CAAC,aAAa,CAAC,CAAC,EAAE,CAAC,UAAU,CAAC,CAAC;IACxC,CAAC;IAED;;OAEG;IACH,gCAAY,GAAZ;QACC,IAAI,CAAC,QAAQ,CAAC,iBAAiB;YAC9B,CAAC,QAAQ,CAAC,oBAAoB;YAC9B,CAAC,QAAQ,CAAC,mBAAmB;YAC7B,CAAC,QAAQ,CAAC,uBAAuB;YACjC,OAAO,KAAK,CAAC;;YAEb,OAAO,IAAI,CAAC;IACd,CAAC;IAED,sBAAsB;IAEtB;;OAEG;IACH,uCAAmB,GAAnB;QACC,OAAO,CAAC,CAAC,MAAM,CAAC,CAAC,QAAQ,CAAC,oBAAoB,CAAC,CAAC;IACjD,CAAC;IAED;;OAEG;IACH,2CAAuB,GAAvB;QACC,IAAI,IAAI,CAAC,mBAAmB,EAAE;YAC7B,OAAO;QAER,CAAC,CAAC,MAAM,CAAC,CAAC,QAAQ,CAAC,oBAAoB,CAAC,CAAC;IAC1C,CAAC;IAED;;OAEG;IACH,uCAAmB,GAAnB;QACC,IAAI,CAAC,6BAA6B,GAAG,IAAI,CAAC;QAE1C,IAAI,IAAI,CAAC,sBAAsB,EAAE,IAAI,IAAI,CAAC,eAAe,EAAE;YAC1D,OAAO;QAER,IAAI,CAAC,oBAAoB,CAAC,CAAC,CAAC,aAAa,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC;QAChD,CAAC,CAAC,kBAAkB,CAAC,CAAC,GAAG,CAAC,SAAS,EAAE,MAAM,CAAC,CAAC;QAE7C,CAAC,CAAC,qBAAqB,CAAC,CAAC,QAAQ,CAAC,gBAAgB,CAAC,CAAC;IACrD,CAAC;IAED;;OAEG;IACH,qCAAiB,GAAjB;QACC,IAAI,CAAC,6BAA6B,GAAG,KAAK,CAAC;QAE3C,IAAI,CAAC,IAAI,CAAC,sBAAsB,EAAE;YACjC,OAAO;QAER,IAAI,CAAC,oBAAoB,CAAC,CAAC,CAAC,aAAa,CAAC,EAAE,CAAC,CAAC,CAAC;QAC/C,CAAC,CAAC,kBAAkB,CAAC,CAAC,GAAG,CAAC,SAAS,EAAE,EAAE,CAAC,CAAC;QAEzC,CAAC,CAAC,qBAAqB,CAAC,CAAC,WAAW,CAAC,gBAAgB,CAAC,CAAC;IACxD,CAAC;IAED,mCAAe,GAAf,UAAgB,EAAU,EAAE,IAAa;QACxC,IAAI,IAAI,EAAE;YACT,OAAO,IAAI,CAAC,UAAU,CAAC,EAAE,CAAC,CAAC;SAC3B;aAAM;YACN,IAAI,CAAC,UAAU,CAAC,EAAE,CAAC,GAAG,IAAI,CAAC;SAC3B;QACD,IAAI,IAAI,CAAC,WAAW,EAAE;YACrB,IAAI,CAAC,WAAW,CAAC,4BAA4B,EAAE,CAAC;SAChD;IACF,CAAC;IAED;;OAEG;IACH,gCAAY,GAAZ,UAAa,IAAY;QACxB,OAAO,CAAC,CAAC,IAAI,IAAI,IAAI,CAAC,UAAU,CAAC,CAAC;IACnC,CAAC;IAED;;OAEG;IACH,0CAAsB,GAAtB;QACC,OAAO,CAAC,CAAC,qBAAqB,CAAC,CAAC,QAAQ,CAAC,gBAAgB,CAAC,CAAC;IAC5D,CAAC;IAED,wBAAwB;IAExB;;OAEG;IACH,iCAAa,GAAb;QACC,CAAC,CAAC,qBAAqB,CAAC,CAAC,GAAG,CAAC,QAAQ,EAAE,IAAI,CAAC,cAAc,CAAC,CAAC;QAC5D,IAAI,CAAC,GAAG,CAAC,SAAS,CAAC,IAAI,EAAE,CAAC;QAC1B,IAAI,CAAC,cAAc,CAAC,eAAe,EAAE,IAAI,CAAC,CAAC;QAC3C,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,kBAAkB,CAAC,CAAC;IACnC,CAAC;IAED;;;OAGG;IACH,iCAAa,GAAb,UAAc,UAAoB;QACjC,IAAI,CAAC,UAAU,IAAI,CAAC,IAAI,CAAC,kBAAkB,EAAE;YAC5C,OAAO;QAER,IAAI,CAAC,cAAc,GAAG,CAAC,CAAC,qBAAqB,CAAC,CAAC,GAAG,CAAC,QAAQ,CAAC,CAAC;QAC7D,CAAC,CAAC,qBAAqB,CAAC,CAAC,GAAG,CAAC,QAAQ,EAAE,KAAK,CAAC,CAAC;QAC9C,IAAI,CAAC,GAAG,CAAC,SAAS,CAAC,IAAI,EAAE,CAAC;QAC1B,IAAI,CAAC,UAAU;YACd,IAAI,CAAC,cAAc,CAAC,eAAe,EAAE,KAAK,CAAC,CAAC;QAC7C,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,kBAAkB,CAAC,CAAC;IACnC,CAAC;IAED;;OAEG;IACH,mCAAe,GAAf;QACC,IAAI,IAAI,CAAC,kBAAkB,EAAE;YAC5B,IAAI,CAAC,aAAa,EAAE,CAAC;;YAErB,IAAI,CAAC,aAAa,EAAE,CAAC;IACvB,CAAC;IAED;;OAEG;IACH,+BAAW,GAAX;QACC,IAAI,CAAC,aAAa,EAAE,CAAC;QACrB,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,aAAa,CAAC,CAAC;IAC9B,CAAC;IAED;;OAEG;IACH,sCAAkB,GAAlB;;QACC,OAAO,CAAA,MAAA,MAAA,QAAQ,CAAC,cAAc,CAAC,cAAc,CAAC,0CAAE,KAAK,0CAAE,OAAO,MAAK,MAAM,CAAC;IAC3E,CAAC;IAED,iBAAiB;IAEjB;;;OAGG;IACH,sCAAkB,GAAlB,UAAmB,CAAM;QACxB,IAAI,MAAM,CAAC,IAAI,CAAC,QAAQ,EAAE,EAAE;YAC3B,IAAI,CAAC,CAAC,MAAM,CAAC,IAAI,KAAK,MAAM,EAAE;gBAC7B,OAAO,CAAC,SAAS,CAAC,EAAC,OAAO,EAAE,aAAa,EAAC,EAAE,WAAW,CAAC,CAAC;gBACzD,CAAC,CAAC,eAAe,CAAC,CAAC,IAAI,EAAE,CAAC;aAC1B;iBACI;gBACJ,OAAO,CAAC,SAAS,CAAC,EAAC,OAAO,EAAE,aAAa,EAAC,EAAE,eAAe,CAAC,CAAC;gBAC7D,CAAC,CAAC,eAAe,CAAC,CAAC,IAAI,EAAE,CAAC;aAC1B;SACD;QAED,IAAI,iBAAiB,GAAG,IAAI,CAAC,wBAAwB,EAAE,CAAC;QACxD,IAAI,iBAAiB,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,QAAQ,EAAE,EAAE;YACjD,IAAI,CAAC,CAAC,MAAM,CAAC,IAAI,KAAK,MAAM,EAAE;gBAC7B,IAAI,IAAI,CAAC,GAAG,CAAC,OAAO,EAAE;oBACrB,IAAI,CAAC,GAAG,CAAC,aAAa,CAAC,IAAI,CAAC,GAAG,CAAC,OAAO,CAAC,CAAC;oBACzC,IAAI,CAAC,GAAG,CAAC,OAAO,GAAG,IAAI,CAAC;iBACxB;gBACD,IAAI,CAAC,uBAAuB,EAAE,CAAC;aAC/B;iBAAM,IAAI,CAAC,CAAC,MAAM,CAAC,IAAI,KAAK,UAAU,EAAE;gBACxC,IAAI,CAAC,IAAI,CAAC,GAAG,CAAC,OAAO,EAAE;oBACtB,IAAI,OAAO,GAAG,CAAC,CAAC,OAAO,CAAC,OAAO,EAAE,CAAC;oBAClC,IAAI,CAAC,GAAG,CAAC,OAAO,GAAG,OAAO,CAAC;oBAC3B,IAAI,CAAC,GAAG,CAAC,UAAU,CAAC,OAAO,CAAC,CAAC;iBAC7B;gBAED,IAAI,IAAI,CAAC,WAAW,IAAI,CAAC,CAAC,qBAAqB,CAAC,CAAC,EAAE,CAAC,SAAS,CAAC,EAAE;oBAC/D,IAAI,CAAC,GAAG,CAAC,aAAa,CAAC,IAAI,CAAC,WAAW,CAAC,CAAC;oBACzC,IAAI,CAAC,WAAW,GAAG,IAAI,CAAC;iBACxB;aACD;iBAAM;gBACN,GAAG,CAAC,MAAM,CAAC,WAAW,CAAC,sBAAsB,CAAC,CAAC;aAC/C;SACD;IACF,CAAC;IAED;;OAEG;IACH,6BAAS,GAAT;QACC,IAAI,IAAI,CAAC,WAAW,IAAI,CAAC,IAAI,CAAC,GAAG,CAAC,oBAAoB,EAAE;YACvD,IAAI,CAAC,kBAAkB,EAAE,CAAC;;YAE1B,IAAI,CAAC,cAAc,EAAE,CAAC;QAEvB,IAAI,CAAC,YAAY,EAAE,CAAC;IACrB,CAAC;IAED,gCAAY,GAAZ;QACC,IAAI,OAAO,MAAM,CAAC,aAAa,KAAK,UAAU,EAAE;YAC/C,MAAM,CAAC,aAAa,EAAE,CAAC;SACvB;IACF,CAAC;IAED;;OAEG;IACH,iCAAa,GAAb;QACC,IAAI,CAAC,IAAI,CAAC,GAAG,CAAC,SAAS,IAAI,OAAO,IAAI,CAAC,GAAG,CAAC,SAAS,CAAC,OAAO,KAAK,WAAW;YAC3E,OAAO;QAER,IAAI,QAAQ,GAAG,IAAI,CAAC,GAAG,CAAC,SAAS,CAAC,OAAO,CAAC;QAC1C,IAAI,UAAU,GAAG,IAAI,CAAC,GAAG,CAAC,SAAS,CAAC,QAAQ,CAAC,CAAC;QAC9C,IAAI,CAAC,UAAU,EAAE;YAChB,OAAO,CAAC,KAAK,CAAC,mCAAmC,GAAG,QAAQ,GAAG,GAAG,CAAC,CAAC;YACpE,OAAO;SACP;QAED,IAAI,eAAe,GAAG,UAAU,CAAC,eAAe,CAAC;QACjD,IAAI,eAAe,IAAI,MAAM,CAAC,aAAa,EAAE;YAC5C,IAAI,MAAM,GAAG,eAAe,CAAC,YAAY,CAAC;YAC1C,IAAI,MAAM,KAAK,SAAS,IAAI,CAAC,IAAI,CAAC,GAAG,CAAC,MAAM,EAAE;gBAC7C,IAAI,CAAC,GAAG,CAAC,MAAM,GAAG,CAAC,CAAC,OAAO,CAAC,MAAM,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;gBAC7C,IAAI,CAAC,GAAG,CAAC,MAAM,CAAC,MAAM,GAAG,MAAM,CAAC;gBAChC,IAAI,CAAC,GAAG,CAAC,UAAU,CAAC,IAAI,CAAC,GAAG,CAAC,MAAM,CAAC,CAAC;gBACrC,IAAI,CAAC,GAAG,CAAC,MAAM,CAAC,YAAY,EAAE,CAAC;aAC/B;SACD;QACD,IAAI,MAAM,CAAC,sBAAsB,EAAE;YAClC,IAAI,eAAe,IAAI,IAAI,CAAC,WAAW,EAAE;gBACxC,IAAM,IAAI,GAAG,eAAe,CAAC,aAAa,IAAI,eAAe,CAAC,YAAY,CAAC;gBAC3E,0EAA0E;gBAC1E,qCAAqC;gBACrC,IAAI,CAAC,UAAU,CAAC,WAAW,EAAE,IAAI,CAAC,CAAC;aACnC;YACD,IAAM,iBAAiB,GAAG,UAAU,CAAC,iBAAiB,CAAC;YACvD,IAAI,iBAAiB,EAAE;gBACtB,IAAM,OAAO,GAAG,iBAAiB,CAAC,iBAAiB,CAAC;gBACpD,IAAM,QAAQ,GAAG,iBAAiB,CAAC,kBAAkB,CAAC;gBACtD,IAAI,OAAO,KAAK,SAAS,IAAI,CAAC,IAAI,CAAC,GAAG,CAAC,UAAU,EAAE;oBAClD,IAAI,CAAC,GAAG,CAAC,UAAU,GAAG,CAAC,CAAC,OAAO,CAAC,UAAU,CAAC,OAAO,EAAE,QAAQ,CAAC,CAAC;iBAC9D;aACD;SACD;IACF,CAAC;IAED;;OAEG;IACH,wCAAoB,GAApB;QACC,IAAI,IAAI,CAAC,GAAG,CAAC,UAAU,EAAE,EAAE;YAC1B,6DAA6D;YAC7D,iDAAiD;YACjD,IAAI,CAAC,GAAG,CAAC,aAAa,CAAC,MAAM,CAAC,CAAC;YAC/B,IAAI,OAAO,GAAG,GAAG,CAAC,GAAG,CAAC,UAAU,CAAC;YACjC,IAAI,OAAO,EAAE;gBACZ,OAAO,CAAC,UAAU,CAAC,aAAa,EAAE,KAAK,CAAC,CAAC;gBACzC,OAAO,CAAC,UAAU,CAAC,OAAO,EAAE,KAAK,CAAC,CAAC;aACnC;SACD;aAAM;YACN,GAAG,CAAC,UAAU,CAAC,QAAQ,CAAC,UAAU,CAAC,CAAC;SACpC;IACF,CAAC;IAED;;;OAGG;IACH,4BAAQ,GAAR,UAAS,aAAkB;QAC1B,IAAI,aAAa,CAAC,KAAK,IAAI,aAAa,CAAC,KAAK,CAAC,OAAO,EAAE;YACvD,IAAI,aAAa,CAAC,KAAK,CAAC,OAAO,KAAK,eAAe,IAAI,IAAI,CAAC,YAAY,EAAE;gBACzE,IAAI,IAAI,CAAC,YAAY,CAAC,MAAM,EAAE,EAAE;oBAC/B,IAAI,CAAC,YAAY,CAAC,SAAS,CAAC,IAAI,CAAC,CAAC;iBAClC;qBAAM;oBACN,IAAI,CAAC,oBAAoB,EAAE,CAAC;iBAC5B;aACD;iBAAM,IAAI,aAAa,CAAC,KAAK,CAAC,OAAO,KAAK,aAAa,EAAE;gBACzD,IAAI,CAAC,oBAAoB,EAAE,CAAC;aAC5B;SACD;IACF,CAAC;IAED,cAAc;IAEd;;OAEG;IACH,+BAAW,GAAX;QACC,OAAO,IAAI,CAAC,SAAS,CAAC;IACvB,CAAC;IAED;;;OAGG;IACH,2BAAO,GAAP,UAAQ,KAAU;QACjB,IAAI,CAAC,SAAS,GAAG,IAAI,CAAC;QACtB,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,UAAU,EAAE,EAAC,KAAK,EAAE,KAAK,CAAC,CAAC,CAAC,KAAK,CAAC,OAAO,CAAC,CAAC,CAAC,IAAI,EAAC,CAAC,CAAC;IAClE,CAAC;IAED;;OAEG;IACH,6BAAS,GAAT;QACC,IAAI,CAAC,SAAS,GAAG,KAAK,CAAC;QACvB,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC;IAC3B,CAAC;IAED,wBAAwB;IAExB;;;;OAIG;IACK,mCAAe,GAAvB,UAAwB,OAAY,EAAE,IAAY;QACjD,IAAI,SAAS,GAAG,CAAC,CAAC,OAAO,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC;QACxC,SAAS,CAAC,SAAS,GAAG,IAAI,CAAC;QAC3B,OAAO,CAAC,OAAO,CAAC,QAAQ,EAAE,SAAS,EAAE,SAAS,CAAC,SAAS,CAAC,CAAC;IAC3D,CAAC;IAED;;;OAGG;IACH,uCAAmB,GAAnB,UAAoB,WAAgB;QACnC,IAAI,KAAK,GAAG,WAAW,CAAC,SAAS,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC;QAC7C,IAAI,MAAM,GAAG,IAAI,CAAC,GAAG,CAAC,SAAS,CAAC,cAAc,CAAC,IAAI,CAAC,CAAC,KAAK,CAAC,CAAC,KAAK,CAAC,CAAC,CAAC,EAAE,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;QAClF,IAAI,EAAE,GAAG,IAAI,CAAC,GAAG,CAAC,sBAAsB,CAAC,MAAM,CAAC,CAAC;QACjD,IAAI,IAAI,GAAG,CAAC,CAAC,gBAAgB,CAAC,CAAC;QAE/B,IAAI,CAAC,OAAO,EAAE,CAAC;QACf,IAAI,CAAC,OAAO,CAAC,QAAQ,CAAC,CAAC;QACvB,IAAI,CAAC,eAAe,CAAC,IAAI,EAAE,WAAW,CAAC,IAAI,CAAC,CAAC;QAC7C,IAAI,CAAC,OAAO,CAAC,QAAQ,EAAE,OAAO,EAAE,IAAI,CAAC,CAAC,CAAC,CAAC,CAAC;QACzC,IAAI,CAAC,OAAO,CAAC,QAAQ,EAAE,UAAU,EAAE,EAAE,EAAE,EAAE,aAAa,EAAG,EAAE,EAAE,OAAO,GAAG,EAAE,CAAC,CAAC,GAAG,OAAO,GAAG,EAAE,CAAC,CAAC,EAAE,SAAS,EAAE,SAAS,EAAE,CAAC,CAAC;QACtH,IAAI,CAAC,OAAO,CAAC,MAAM,CAAC,CAAC;QACrB,QAAQ,CAAC,gBAAgB,CAAC,WAAW,EAAE;YACtC,IAAI,CAAC,OAAO,CAAC,OAAO,CAAC,CAAC;YACtB,IAAI,CAAC,OAAO,CAAC,SAAS,CAAC,CAAC;QACzB,CAAC,EAAE,EAAC,IAAI,EAAE,IAAI,EAAC,CAAC,CAAC;IAClB,CAAC;IAED,YAAY;IAEZ;;OAEG;IACH,iCAAa,GAAb;QACC,QAAQ,CAAC,kBAAkB,CAAC,aAAa,EAAE,CAAC;IAC7C,CAAC;IAED;;;;;;;;;OASG;IACH,gCAAY,GAAZ,UACC,KAAa,EACb,MAAc,EACd,QAAa,EACb,OAAe,EACf,WAAoB,EACpB,WAAoB;QAEpB,QAAQ,CAAC,kBAAkB,CAAC,YAAY,CAAC,KAAK,EAAE,MAAM,EAAE,QAAQ,EAAE,OAAO,EAAE,WAAW,EAAE,WAAW,CAAC,CAAC;IACtG,CAAC;IAED;;OAEG;IACH,mCAAe,GAAf,UACC,OAAe,EACf,UAAkB,EAClB,QAAa,EACb,OAAgB,EAChB,WAAqB,EACrB,QAAkB;QAElB,QAAQ,CAAC,kBAAkB,CAAC,YAAY,CAAC,OAAO,EAAE,UAAU,EAAE,QAAQ,EAAE,OAAO,CAAC,CAAC,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,IAAI,EAAE,WAAW,EAAE,QAAQ,CAAC,CAAC;IAC9H,CAAC;IAED;;;;OAIG;IACH,uCAAmB,GAAnB,UAAoB,KAAa,EAAE,QAAkB;QACpD,QAAQ,CAAC,kBAAkB,CAAC,mBAAmB,CAAC,KAAK,EAAE,QAAQ,CAAC,CAAC;IAClE,CAAC;IAED,SAAS;IAET;;;;;OAKG;IACH,6BAAS,GAAT,UAAU,IAAS,EAAE,SAAgB,EAAE,cAAuB;QAA9D,iBAiBC;QAhBA,IAAI,eAAe,GAAG,UAAC,UAAe,EAAE,SAAc,EAAE,MAAW,EAAE,IAAS;YAC7E,MAAM,CAAC,GAAG,CAAC,OAAO,CAAC,KAAK,CAAC,iBAAiB,GAAG,UAAU,GAAG,QAAQ,GAAG,MAAM,CAAC,EAAE,GAAG,YAAY,GAAG,SAAS,GAAG,YAAY,GAAG,IAAI,GAAG,GAAG,CAAC,CAAC;YAEvI,wBAAwB;YACxB,SAAS,CAAC,IAAI,CAAC,EAAC,EAAE,EAAE,CAAC,cAAc,CAAC,CAAC,CAAC,cAAc,CAAA,CAAC,CAAC,iBAAiB,CAAC,EAAE,IAAI,EAAE,cAAQ,KAAI,CAAC,UAAU,CAAC,IAAI,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,EAAC,CAAC,CAAC;YACtH,SAAS,CAAC,IAAI,CAAC,EAAC,EAAE,EAAE,aAAa,EAAE,IAAI,EAAE,cAAQ,KAAI,CAAC,UAAU,CAAC,IAAI,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,EAAC,CAAC,CAAC;YAE/E,KAAK,IAAI,CAAC,IAAI,SAAS,EAAE;gBACxB,IAAI,QAAQ,GAAG,SAAS,CAAC,CAAC,CAAC,CAAC;gBAC5B,IAAI,MAAM,CAAC,EAAE,KAAK,QAAQ,CAAC,EAAE,IAAI,CAAC,CAAC,QAAQ,CAAC,IAAI,IAAI,SAAS,KAAK,QAAQ,CAAC,IAAI,CAAC,EAAE;oBACjF,QAAQ,CAAC,IAAI,CAAC,UAAU,EAAE,SAAS,EAAE,MAAM,EAAE,IAAI,CAAC,CAAC;iBACnD;aACD;QACF,CAAC,CAAC;QAEF,GAAG,CAAC,MAAM,CAAC,UAAU,CAAC,EAAC,OAAO,EAAE,YAAY,GAAG,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,EAAE,QAAQ,EAAE,eAAe,EAAC,CAAC,CAAC;IAClG,CAAC;IAED;;;OAGG;IACH,8BAAU,GAAV,UAAW,QAAgB;QAC1B,IAAI,YAAY,GAAG,EAAE,EAAE,EAAE,QAAQ,EAAE,QAAQ,EAAE,QAAQ,EAAE,IAAI,EAAE,YAAY,EAAE,MAAM,EAAE,OAAO,EAAE,CAAC;QAC7F,GAAG,CAAC,MAAM,CAAC,UAAU,CAAC,EAAE,OAAO,EAAE,YAAY,GAAG,IAAI,CAAC,SAAS,CAAC,YAAY,CAAC,EAAE,CAAC,CAAC;IACjF,CAAC;IAED;;OAEG;IACH,4BAAQ,GAAR;QACC,IAAI,IAAI,CAAC,GAAG,CAAC,QAAQ;YACpB,IAAI,CAAC,GAAG,CAAC,QAAQ,CAAC,QAAQ,EAAE,CAAC;;YAE7B,IAAI,CAAC,YAAY,CAAC,YAAY,EAAE,CAAC;IACnC,CAAC;IAED;;OAEG;IACH,mCAAe,GAAf;QACC,IAAI,IAAI,CAAC,GAAG,CAAC,QAAQ;YACpB,OAAO,IAAI,CAAC,GAAG,CAAC,QAAQ,CAAC,eAAe,EAAE,CAAC;;YAE3C,OAAO,IAAI,CAAC,YAAY,CAAC,MAAM,EAAE,CAAC;IACpC,CAAC;IAED,yDAAyD;IACzD,mCAAe,GAAf,UAAgB,OAAe;QAC9B,OAAO,QAAQ,CAAC,eAAe,CAAC,OAAO,CAAC,CAAC;IAC1C,CAAC;IAED;;;;;;;;OAQG;IACK,oCAAgB,GAAxB,UACC,EAAU,EACV,KAAyB,EACzB,WAAoB,EACpB,OAAc,EACd,OAAgB,EAChB,cAAwB;QAExB,IAAI,QAAQ,GAAG,IAAI,CAAC,eAAe,CAAC,EAAE,CAAC,CAAC;QACxC,OAAO,GAAG,OAAO,CAAC,CAAC,CAAC,OAAO,CAAC,CAAC,CAAC,UAAU,CAAC;QACzC,OAAO;YACN,EAAE,EAAE,QAAQ;YACZ,QAAQ,EAAE,EAAE;YACZ,IAAI,EAAE,YAAY;YAClB,KAAK,EAAE,KAAK;YACZ,QAAQ,EAAE,KAAK,KAAK,SAAS;YAC7B,UAAU,EAAE,IAAI;YAChB,WAAW,EAAE,WAAW;YACxB,QAAQ,EAAE,QAAQ;YAClB,eAAe,EAAE,OAAO;YACxB,cAAc,EAAE,cAAc;YAC9B,QAAQ,EAAE;gBACT;oBACC,EAAE,EAAE,sBAAsB;oBAC1B,IAAI,EAAE,WAAW;oBACjB,QAAQ,EAAE,IAAI;oBACd,QAAQ,EAAE,OAAO;iBACjB;aACD;SACD,CAAC;IACH,CAAC;IAED,6DAA6D;IAC7D,iDAAiD;IACjD,oFAAoF;IACpF,uBAAuB;IACvB,6BAA6B;IAC7B,kCAAkC;IAClC,kCAAkC;IAClC,mCAAmC;IACnC,uCAAuC;IACvC,sDAAsD;IACtD,iCAAa,GAAb,UACC,EAAU,EACV,KAAyB,EACzB,QAAgB,EAChB,QAAgB,EAChB,UAAkB,EAClB,QAAa,EACb,UAAmB,EACnB,OAAgB;QARjB,iBA4EC;QAlEA,IAAI,QAAQ,GAAG,IAAI,CAAC,eAAe,CAAC,EAAE,CAAC,CAAC;QACxC,IAAI,gBAAgB,GAAG,EAAE,GAAG,WAAW,CAAC;QACxC,IAAI,cAAc,GAAG,EAAE,GAAG,SAAS,CAAC;QACpC,uDAAuD;QACvD,IAAI,cAAc,GAAG,SAAS,CAAC,MAAM,GAAG,CAAC,CAAC;QAE1C,IAAI,IAAI,GAAG,IAAI,CAAC,gBAAgB,CAAC,EAAE,EAAE,KAAK,EAAE,IAAI,EAAE;YACjD;gBACC,EAAE,EAAE,mBAAmB;gBACvB,IAAI,EAAE,WAAW;gBACjB,IAAI,EAAE,KAAK;gBACX,MAAM,EAAE,CAAC,MAAM,CAAC,IAAI,CAAC,QAAQ,EAAE;aAC/B;YACD;gBACC,EAAE,EAAE,mBAAmB;gBACvB,IAAI,EAAE,WAAW;gBACjB,IAAI,EAAE,QAAQ;aACd;YACD;gBACC,EAAE,EAAE,mBAAmB;gBACvB,IAAI,EAAE,WAAW;gBACjB,IAAI,EAAE,QAAQ;aACd;YACD;gBACC,EAAE,EAAE,EAAE;gBACN,IAAI,EAAE,WAAW;gBACjB,IAAI,EAAE,EAAE;gBACR,OAAO,EAAE,IAAI;gBACb,QAAQ,EAAE;oBACT,UAAU,CAAC,CAAC,CAAC;wBACZ,EAAE,EAAE,cAAc;wBAClB,IAAI,EAAE,YAAY;wBAClB,IAAI,EAAE,CAAC,CAAC,QAAQ,CAAC;qBACjB,CAAC,CAAC,CAAC,EAAE,IAAI,EAAE,WAAW,EAAE;oBACzB;wBACC,EAAE,EAAE,gBAAgB;wBACpB,IAAI,EAAE,YAAY;wBAClB,IAAI,EAAE,UAAU;wBAChB,aAAa,EAAE,IAAI;wBACnB,MAAM,EAAE,UAAU,CAAC,CAAC,CAAC,KAAK,CAAA,CAAC,CAAC,IAAI,CAAC,+EAA+E;qBAChH;iBACD;gBACD,QAAQ,EAAE,KAAK;gBACf,WAAW,EAAE,KAAK;aAClB;SACD,EAAE,OAAO,EAAE,cAAc,CAAC,CAAC;QAE5B,IAAI,CAAC,SAAS,CAAC,IAAI,EAAE;YACpB,EAAC,EAAE,EAAE,gBAAgB,EAAE,IAAI,EAAE;oBAC5B,IAAI,SAAS,GAAG,KAAK,CAAC;oBACtB,IAAI,OAAO,QAAQ,KAAK,UAAU;wBACjC,SAAS,GAAG,QAAQ,EAAE,CAAC;oBACxB,IAAI,CAAC,SAAS;wBACb,KAAI,CAAC,UAAU,CAAC,QAAQ,CAAC,CAAC;gBAC5B,CAAC,EAAC;SACF,EAAE,cAAc,CAAC,CAAC;QACnB,IAAI,CAAC,UAAU,IAAI,CAAC,UAAU,EAAE;YAC/B,yJAAyJ;YACzJ,IAAM,aAAa,GAAG,QAAQ,CAAC,cAAc,CAAC,QAAQ,CAAC,CAAC;YACxD,IAAI,aAAa,IAAI,IAAI,EAAE;gBAC1B,aAAa,CAAC,QAAQ,GAAG,CAAC,CAAC,CAAC;gBAC5B,oEAAoE;gBACpE,aAAa,CAAC,KAAK,EAAE,CAAC;gBACtB,aAAa,CAAC,SAAS,IAAI,eAAe,CAAC;aAC3C;SACD;IACF,CAAC;IAED;;OAEG;IACH,yCAAqB,GAArB,UACC,EAAU,EACV,KAAa,EACb,OAAe,EACf,UAAkB,EAClB,QAAa,EACb,KAAc,EACd,cAAoB,EACpB,QAAyB;QAR1B,iBAsEC;QA9DA,yBAAA,EAAA,gBAAyB;QAEzB,IAAI,QAAQ,GAAG,IAAI,CAAC,eAAe,CAAC,EAAE,CAAC,CAAC;QACxC,IAAI,gBAAgB,GAAG,EAAE,GAAG,WAAW,CAAC;QACxC,IAAI,cAAc,GAAG,EAAE,GAAG,SAAS,CAAC;QAEpC,IAAI,IAAI,GAAG,IAAI,CAAC,gBAAgB,CAAC,EAAE,EAAE,KAAK,EAAE,IAAI,EAAE;YACjD;gBACC,EAAE,EAAE,mBAAmB;gBACvB,IAAI,EAAE,WAAW;gBACjB,IAAI,EAAE,KAAK;gBACX,MAAM,EAAE,CAAC,MAAM,CAAC,IAAI,CAAC,QAAQ,EAAE;aAC/B;YACD;gBACC,EAAE,EAAE,mBAAmB;gBACvB,IAAI,EAAE,WAAW;gBACjB,IAAI,EAAE,OAAO;aACb;YACD;gBACC,EAAE,EAAE,QAAQ,GAAG,cAAc;gBAC7B,IAAI,EAAE,aAAa;gBACnB,KAAK,EAAE,CAAC,KAAK,KAAK,SAAS,IAAI,KAAK,KAAK,IAAI,CAAC,CAAC,CAAC,KAAK,CAAA,CAAC,CAAC,CAAC,CAAC;gBACzD,QAAQ,EAAE,GAAG;gBACb,QAAQ,EAAE,QAAQ;aAClB;YACD;gBACC,EAAE,EAAE,EAAE;gBACN,IAAI,EAAE,WAAW;gBACjB,IAAI,EAAE,EAAE;gBACR,OAAO,EAAE,IAAI;gBACb,QAAQ,EAAE;oBACT;wBACC,EAAE,EAAE,cAAc;wBAClB,IAAI,EAAE,YAAY;wBAClB,IAAI,EAAE,CAAC,CAAC,QAAQ,CAAC;qBACjB;oBACD;wBACC,EAAE,EAAE,gBAAgB;wBACpB,IAAI,EAAE,YAAY;wBAClB,IAAI,EAAE,UAAU;wBAChB,aAAa,EAAE,IAAI;wBACnB,MAAM,EAAE,UAAU,CAAC,CAAC,CAAC,KAAK,CAAA,CAAC,CAAC,IAAI,CAAC,+EAA+E;qBAChH;iBACD;gBACD,QAAQ,EAAE,KAAK;gBACf,WAAW,EAAE,KAAK;aAClB;SACD,EAAE,UAAU,CAAC,CAAC,CAAC,gBAAgB,CAAC,CAAC,CAAC,cAAc,CAAC,CAAC;QAEnD,IAAI,CAAC,SAAS,CAAC,IAAI,EAAE;YACpB,EAAC,EAAE,EAAE,gBAAgB,EAAE,IAAI,EAAE;oBAC5B,IAAI,SAAS,GAAG,KAAK,CAAC;oBACtB,IAAI,OAAO,QAAQ,KAAK,UAAU;wBACjC,SAAS,GAAG,QAAQ,EAAE,CAAC;oBACxB,IAAI,CAAC,SAAS;wBACb,KAAI,CAAC,UAAU,CAAC,QAAQ,CAAC,CAAC;gBAC5B,CAAC,EAAC;YACF,EAAC,EAAE,EAAE,cAAc,EAAE,IAAI,EAAE;oBAC1B,IAAI,OAAO,cAAc,KAAK,UAAU;wBACvC,cAAc,EAAE,CAAC;gBACnB,CAAC,EAAC;SACF,EAAE,cAAc,CAAC,CAAC;IACpB,CAAC;IAED;;;;OAIG;IACH,qCAAiB,GAAjB,UAAkB,EAAU,EAAE,KAAa,EAAE,QAAiB;QAC7D,IAAI,CAAC,GAAG,CAAC,MAAM;YACd,OAAO;QAER,IAAI,QAAQ,GAAG,IAAI,CAAC,eAAe,CAAC,EAAE,CAAC,CAAC;QAExC,IAAI,IAAI,GAAG;YACV,EAAE,EAAE,QAAQ;YACZ,QAAQ,EAAE,QAAQ;YAClB,IAAI,EAAE,YAAY;YAClB,MAAM,EAAE,QAAQ;YAChB,OAAO,EAAE;gBACR,EAAE,EAAE,QAAQ,GAAG,cAAc;gBAC7B,IAAI,EAAE,aAAa;gBACnB,KAAK,EAAE,KAAK;gBACZ,QAAQ,EAAE,GAAG;gBACb,QAAQ,EAAE,QAAQ;aAClB;SACD,CAAC;QAEF,GAAG,CAAC,MAAM,CAAC,UAAU,CAAC,EAAC,OAAO,EAAE,YAAY,GAAG,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,EAAC,CAAC,CAAC;IACvE,CAAC;IAED,iGAAiG;IACjG,2DAA2D;IAC3D,8CAA0B,GAA1B,UACC,EAAU,EACV,KAAa,EACb,OAAe,EACf,WAAoB,EACpB,gBAAuB,EACvB,YAAmB;QANpB,iBAoDC;QA5CA,IAAI,QAAQ,GAAG,IAAI,CAAC,eAAe,CAAC,EAAE,CAAC,CAAC;QAExC,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,gBAAgB,CAAC,MAAM,EAAE,CAAC,EAAE;YAC/C,gBAAgB,CAAC,CAAC,CAAC,CAAC,IAAI,GAAG,YAAY,CAAC;QAEzC,IAAI,IAAI,GAAG,IAAI,CAAC,gBAAgB,CAAC,EAAE,EAAE,KAAK,EAAE,CAAC,CAAC,WAAW,EAAE;YAC1D;gBACC,EAAE,EAAE,mBAAmB;gBACvB,IAAI,EAAE,WAAW;gBACjB,IAAI,EAAE,KAAK;gBACX,MAAM,EAAE,CAAC,MAAM,CAAC,IAAI,CAAC,QAAQ,EAAE;aAC/B;YACD;gBACC,EAAE,EAAE,mBAAmB;gBACvB,IAAI,EAAE,WAAW;gBACjB,IAAI,EAAE,OAAO;aACb;YACD;gBACC,EAAE,EAAE,EAAE;gBACN,IAAI,EAAE,WAAW;gBACjB,IAAI,EAAE,EAAE;gBACR,OAAO,EAAE,IAAI;gBACb,QAAQ,EAAE,gBAAgB;gBAC1B,QAAQ,EAAE,KAAK;gBACf,WAAW,EAAE,KAAK;aAClB;SACD,CAAC,CAAC;QAEH,gBAAgB,CAAC,OAAO,CAAC,UAAC,MAAM;YAC/B,YAAY,CAAC,OAAO,CAAC,UAAC,QAAQ;gBAC7B,IAAI,MAAM,CAAC,EAAE,KAAK,QAAQ,CAAC,EAAE,EAAE;oBAC9B,IAAI,OAAO,QAAQ,CAAC,KAAK,KAAK,UAAU,EAAE;wBACzC,QAAQ,CAAC,IAAI,GAAG;4BACf,QAAQ,CAAC,KAAK,EAAE,CAAC;4BACjB,KAAI,CAAC,UAAU,CAAC,QAAQ,CAAC,CAAC;wBAC3B,CAAC,CAAC;qBACF;;wBAEA,QAAQ,CAAC,IAAI,GAAG,cAAQ,KAAI,CAAC,UAAU,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAC,CAAC;iBACtD;YACF,CAAC,CAAC,CAAC;QACJ,CAAC,CAAC,CAAC;QAEH,IAAI,CAAC,SAAS,CAAC,IAAI,EAAE,YAAY,CAAC,CAAC;IACpC,CAAC;IAED,qEAAqE;IACrE,uBAAuB;IACvB,6BAA6B;IAC7B,qBAAqB;IACrB,4CAA4C;IAC5C,sCAAsC;IACtC,uCAAuC;IACvC,kCAAc,GAAd,UACC,EAAU,EACV,KAAa,EACb,OAAe,EACf,YAAoB,EACpB,UAAkB,EAClB,QAAiC,EACjC,aAAuB;QAPxB,iBAwDC;QA/CA,IAAI,QAAQ,GAAG,IAAI,CAAC,eAAe,CAAC,EAAE,CAAC,CAAC;QACxC,IAAI,IAAI,GAAG,IAAI,CAAC,gBAAgB,CAAC,EAAE,EAAE,KAAK,EAAE,CAAC,MAAM,CAAC,IAAI,CAAC,SAAS,EAAE,EAAE;YACrE;gBACC,EAAE,EAAE,mBAAmB;gBACvB,IAAI,EAAE,WAAW;gBACjB,IAAI,EAAE,OAAO;gBACb,QAAQ,EAAE,aAAa;aACvB;YACD;gBACC,EAAE,EAAE,aAAa;gBACjB,IAAI,EAAE,MAAM;gBACZ,QAAQ,EAAE,CAAC,CAAC,aAAa;gBACzB,IAAI,EAAE,YAAY;gBAClB,UAAU,EAAE,mBAAmB;aAC/B;YACD;gBACC,EAAE,EAAE,EAAE;gBACN,IAAI,EAAE,WAAW;gBACjB,IAAI,EAAE,EAAE;gBACR,OAAO,EAAE,IAAI;gBACb,QAAQ,EAAE;oBACT;wBACC,EAAE,EAAE,iBAAiB;wBACrB,IAAI,EAAE,YAAY;wBAClB,IAAI,EAAE,CAAC,CAAC,QAAQ,CAAC;qBACjB;oBACD;wBACC,EAAE,EAAE,aAAa;wBACjB,IAAI,EAAE,YAAY;wBAClB,IAAI,EAAE,UAAU;wBAChB,aAAa,EAAE,IAAI;qBACnB;iBACD;gBACD,QAAQ,EAAE,KAAK;gBACf,WAAW,EAAE,KAAK;aAClB;SACD,EAAE,mBAAmB,CAAC,CAAC;QAExB,IAAI,CAAC,SAAS,CAAC,IAAI,EAAE;YACpB,EAAC,EAAE,EAAE,aAAa,EAAE,IAAI,EAAE;oBACzB,IAAI,OAAO,QAAQ,KAAK,UAAU,EAAE;wBACnC,IAAI,KAAK,GAAG,QAAQ,CAAC,cAAc,CAAC,mBAAmB,CAAqB,CAAC;wBAC7E,QAAQ,CAAC,KAAK,CAAC,KAAK,CAAC,CAAC;qBACtB;oBACD,KAAI,CAAC,UAAU,CAAC,QAAQ,CAAC,CAAC;gBAC3B,CAAC,EAAC;SACF,CAAC,CAAC;IACJ,CAAC;IAED,sDAAsD;IACtD,kDAAkD;IAClD,+BAAW,GAAX,UAAY,CAAM;QACjB,IAAI,OAAO,GAAG,CAAC,CAAC,GAAG,CAAC;QACpB,IAAI,IAAI,GAAG,CAAC,CAAC,MAAM,CAAC;QACpB,IAAI,QAAQ,GAAG,CAAC,CAAC,WAAW,CAAC;QAE7B,IAAI,EAAE,GAAG,SAAS,GAAG,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,MAAM,EAAE,GAAG,EAAE,CAAC,CAAC;QACpD,IAAI,QAAQ,GAAG,IAAI,CAAC,eAAe,CAAC,EAAE,CAAC,CAAC;QACxC,IAAI,IAAI,GAAG,IAAI,CAAC,gBAAgB,CAAC,EAAE,EAAE,GAAG,EAAE,CAAC,MAAM,CAAC,IAAI,CAAC,SAAS,EAAE,EAAE;YACnE;gBACC,EAAE,EAAE,QAAQ,GAAG,OAAO;gBACtB,IAAI,EAAE,WAAW;gBACjB,IAAI,EAAE,OAAO;aACb;YACD;gBACC,EAAE,EAAE,EAAE;gBACN,IAAI,EAAE,WAAW;gBACjB,IAAI,EAAE,EAAE;gBACR,OAAO,EAAE,IAAI;gBACb,QAAQ,EAAE;oBACT;wBACC,EAAE,EAAE,QAAQ,GAAG,WAAW;wBAC1B,IAAI,EAAE,YAAY;wBAClB,IAAI,EAAE,CAAC,CAAC,QAAQ,CAAC;wBACjB,aAAa,EAAE,IAAI;qBACnB;iBACD;gBACD,QAAQ,EAAE,KAAK;gBACf,WAAW,EAAE,KAAK;aAClB;SACD,CAAC,CAAC;QAEH,IAAI,CAAC,SAAS,CAAC,IAAI,EACnB,CAAC;gBACA,EAAE,EAAG,QAAQ,GAAG,WAAW;gBAC3B,IAAI,EAAG;oBACN,IAAI,CAAC,IAAI,IAAI,CAAC,QAAQ;wBACrB,OAAO;oBACR,IAAI,GAAG,GAAG,MAAM,CAAC,IAAI,CAAC,MAAM,CAAC,WAAW,CAAC,IAAI,CAAC,EAAE,QAAQ,CAAC,CAAC;oBAC1D,GAAG,aAAH,GAAG,uBAAH,GAAG,CAAE,KAAK,EAAE,CAAC;gBACd,CAAC;aACD,CAAC,CAAC,CAAC;QAEJ,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,QAAQ,EAAE,EAAE;YAC5B,IAAM,aAAa,GAAG,QAAQ,CAAC,cAAc,CAAC,QAAQ,CAAC,CAAC;YACxD,IAAI,aAAa,IAAI,IAAI,EAAE;gBAC1B,aAAa,CAAC,KAAK,CAAC,WAAW,GAAG,GAAG,CAAC;gBACtC,aAAa,CAAC,KAAK,CAAC,YAAY,GAAG,GAAG,CAAC;aACvC;SACD;IACF,CAAC;IAED;;OAEG;IACH,mCAAe,GAAf,UACC,EAAU,EACV,KAAa,EACb,OAAe,EACf,aAAqB,EACrB,YAAoB,EACpB,WAAuB,EACvB,UAAsB,EACtB,WAAoB;QARrB,iBAiEC;QAvDA,IAAI,QAAQ,GAAG,IAAI,CAAC,eAAe,CAAC,EAAE,CAAC,CAAC;QAExC,IAAI,IAAI,GAAG,IAAI,CAAC,gBAAgB,CAAC,EAAE,EAAE,KAAK,EAAE,WAAW,EAAE;YACxD;gBACC,EAAE,EAAG,QAAQ,GAAG,QAAQ;gBACxB,IAAI,EAAE,WAAW;gBACjB,IAAI,EAAE,KAAK;gBACX,MAAM,EAAE,CAAC,MAAM,CAAC,IAAI,CAAC,QAAQ,EAAE;aAC/B;YACD;gBACC,EAAE,EAAE,QAAQ,GAAG,QAAQ;gBACvB,IAAI,EAAE,WAAW;gBACjB,IAAI,EAAE,OAAO;aACb;YACD;gBACC,EAAE,EAAE,EAAE;gBACN,IAAI,EAAE,WAAW;gBACjB,IAAI,EAAE,EAAE;gBACR,OAAO,EAAE,IAAI;gBACb,QAAQ,EAAE;oBACT,YAAY,CAAC,CAAC,CAAC;wBACd,EAAE,EAAE,QAAQ,GAAG,WAAW;wBAC1B,IAAI,EAAE,YAAY;wBAClB,IAAI,EAAE,YAAY;qBAClB,CAAC,CAAC,CAAC,EAAE,IAAI,EAAE,WAAW,EAAE;oBACzB;wBACC,EAAE,EAAE,QAAQ,GAAG,YAAY;wBAC3B,IAAI,EAAE,YAAY;wBAClB,IAAI,EAAE,aAAa;qBACnB;iBACD;gBACD,QAAQ,EAAE,KAAK;gBACf,WAAW,EAAE,KAAK;aAClB;SACD,CAAC,CAAC;QAEH,IAAI,CAAC,SAAS,CAAC,IAAI,EACnB;YACC;gBACC,EAAE,EAAE,QAAQ,GAAG,WAAW;gBAC1B,IAAI,EAAE;oBACL,IAAI,OAAO,UAAU,KAAK,UAAU;wBACnC,UAAU,EAAE,CAAC;oBACd,KAAI,CAAC,UAAU,CAAC,QAAQ,CAAC,CAAC;gBAC3B,CAAC;aACD;YACD;gBACC,EAAE,EAAE,QAAQ,GAAG,YAAY;gBAC3B,IAAI,EAAE;oBACL,IAAI,OAAO,WAAW,KAAK,UAAU;wBACpC,WAAW,EAAE,CAAC;oBACf,KAAI,CAAC,UAAU,CAAC,QAAQ,CAAC,CAAC;gBAC3B,CAAC;aACD;SACD,CAAC,CAAC;IACJ,CAAC;IAED,+DAA+D;IAC/D,uBAAuB;IACvB,6BAA6B;IAC7B,qBAAqB;IACrB,sCAAsC;IACtC,uCAAuC;IACvC,oCAAgB,GAAhB,UACC,EAAU,EACV,KAAa,EACb,OAAe,EACf,UAAkB,EAClB,QAAoB,EACpB,gBAA0B;QAN3B,iBA+CC;QAvCA,IAAI,QAAQ,GAAG,IAAI,CAAC,eAAe,CAAC,EAAE,CAAC,CAAC;QACxC,IAAI,IAAI,GAAG,IAAI,CAAC,gBAAgB,CAAC,EAAE,EAAE,KAAK,EAAE,CAAC,MAAM,CAAC,IAAI,CAAC,SAAS,EAAE,EAAE;YACrE;gBACC,EAAE,EAAE,mBAAmB;gBACvB,IAAI,EAAE,WAAW;gBACjB,IAAI,EAAE,OAAO;aACb;YACD;gBACC,EAAE,EAAE,EAAE;gBACN,IAAI,EAAE,WAAW;gBACjB,IAAI,EAAE,EAAE;gBACR,OAAO,EAAE,IAAI;gBACb,QAAQ,EAAE;oBACT;wBACC,EAAE,EAAE,iBAAiB;wBACrB,IAAI,EAAE,YAAY;wBAClB,IAAI,EAAE,CAAC,CAAC,QAAQ,CAAC;wBACjB,MAAM,EAAE,gBAAgB,KAAK,IAAI,CAAC,CAAC,CAAC,IAAI,CAAA,CAAC,CAAC,KAAK;qBAC/C;oBACD;wBACC,EAAE,EAAE,aAAa;wBACjB,IAAI,EAAE,YAAY;wBAClB,IAAI,EAAE,UAAU;wBAChB,aAAa,EAAE,IAAI;qBACnB;iBACD;gBACD,QAAQ,EAAE,KAAK;gBACf,WAAW,EAAE,KAAK;aAClB;SACD,CAAC,CAAC;QAEH,IAAI,CAAC,SAAS,CAAC,IAAI,EAAE;YACpB,EAAC,EAAE,EAAE,aAAa,EAAE,IAAI,EAAE;oBACzB,IAAI,OAAO,QAAQ,KAAK,UAAU,EAAE;wBACnC,QAAQ,EAAE,CAAC;qBACX;oBACD,KAAI,CAAC,UAAU,CAAC,QAAQ,CAAC,CAAC;gBAC3B,CAAC,EAAC;SACF,CAAC,CAAC;IACJ,CAAC;IAED,mBAAmB;IAEnB;;;;OAIG;IACH,wCAAoB,GAApB,UAAqB,GAAW,EAAE,IAAY;QAC7C,IAAI,GAAG,EAAE;YACR,IAAI,OAAO,GAAG,GAAG,CAAC,GAAG,CAAC,KAAK,CAAC,CAAC;YAC7B,IAAI,OAAO,EAAE;gBACZ,OAAO,GAAG,QAAQ,CAAC,OAAO,CAAC,KAAK,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,GAAG,IAAI,GAAG,IAAI,CAAC;aACvD;iBACI;gBACJ,OAAO,GAAG,IAAI,GAAG,IAAI,CAAC;aACtB;YACD,GAAG,CAAC,GAAG,CAAC,EAAE,GAAG,EAAE,OAAO,EAAE,CAAC,CAAC;SACzB;IACF,CAAC;IAEF;;;;OAIG;IACH,kCAAc,GAAd,UAAe,IAAY,EAAE,KAAU;QACtC,IAAM,OAAO,GAAG,IAAI,CAAC,GAAG,CAAC,UAAU,EAAE,CAAC;QACtC,OAAO,MAAM,CAAC,KAAK,CAAC,GAAG,CAAI,OAAO,SAAI,IAAM,EAAE,KAAK,CAAC,CAAC;IACtD,CAAC;IAED;;OAEG;IACH,2CAAuB,GAAvB,UAAwB,KAAgC;;QACvD,IAAM,OAAO,GAAG,IAAI,CAAC,GAAG,CAAC,UAAU,EAAE,CAAC;QAEtC,IAAM,SAAS,GAA2B,EAAE,CAAC;;YAC7C,KAA2B,IAAA,KAAA,SAAA,MAAM,CAAC,OAAO,CAAC,KAAK,CAAC,CAAA,gBAAA,4BAAE;gBAAvC,IAAA,KAAA,mBAAY,EAAX,GAAG,QAAA,EAAE,KAAK,QAAA;gBACrB,SAAS,CAAI,OAAO,SAAI,GAAK,CAAC,GAAG,KAAK,CAAA;aACtC;;;;;;;;;QACD,MAAM,CAAC,KAAK,CAAC,WAAW,CAAC,SAAS,CAAC,CAAC;IACrC,CAAC;IAED;;;;OAIG;IACH,yCAAqB,GAArB,UAAsB,IAAY,EAAE,YAA6B;QAA7B,6BAAA,EAAA,oBAA6B;QAChE,IAAM,OAAO,GAAG,IAAI,CAAC,GAAG,CAAC,UAAU,EAAE,CAAC;QACtC,OAAO,MAAM,CAAC,KAAK,CAAC,UAAU,CAAI,OAAO,SAAI,IAAM,EAAE,YAAY,CAAC,CAAC;IACpE,CAAC;IACF,gBAAC;AAAD,CAAC,AArnED,CAAwB,CAAC,CAAC,OAAO,GAqnEhC;AAED,uDAAuD;AACvD,CAAC,CAAC,OAAO,CAAC,SAAS,GAAG;IACrB,OAAO,IAAI,SAAS,EAAE,CAAC;AACxB,CAAC,CAAC","sourcesContent":["/* -*- js-indent-level: 8 -*- */\n/*\n * Copyright the Collabora Online contributors.\n *\n * SPDX-License-Identifier: MPL-2.0\n *\n * This Source Code Form is subject to the terms of the Mozilla Public\n * License, v. 2.0. If a copy of the MPL was not distributed with this\n * file, You can obtain one at http://mozilla.org/MPL/2.0/.\n */\n\n/**\n * Type for the toolbar button configuration.\n */\ninterface ToolbarButton {\n\ttype: string;\n\tuno: string;\n\tid: string;\n\timg: string;\n\thint: string;\n\tpostmessage: boolean;\n\tcommand?: string; // Optional because it's added later\n\tw2icon?: string; // Optional because it's added later\n\ttext?: string; // Optional because it's added later\n}\n\n/**\n * UIManager class  initializes UI elements (toolbars, menubar, ruler, etc.) and controls their visibility.\n */\nclass UIManager extends L.Control {\n\tmobileWizard: any = null;\n\tdocumentNameInput: any = null;\n\tblockedUI: any = false;\n\tbusyPopupTimer: number | null = null;\n\tcustomButtons: any[] = []; // added by WOPI InsertButton\n\thiddenButtons: { [key: string]: boolean } = {};\n\thiddenCommands: { [key: string]: boolean } = {};\n\t// Hidden Notebookbar tabs.\n\thiddenTabs: { [key: string]: boolean } = {};\n\n\t/**\n\t * Called when the UIManager control is added to the map.\n\t * Initializes UI elements, clones original templates, and sets up event listeners.\n\t * @param map - The Leaflet map instance.\n\t * @returns A dummy container HTMLElement.\n\t */\n\tonAdd(map: ReturnType<typeof L.Map>) {\n\t\tthis.map = map;\n\t\tthis.notebookbar = null;\n\t\t// Every time the UI mode changes from 'classic' to 'notebookbar'\n\t\t// the two below elements will be destroyed.\n\t\t// Here we save the original state of the elements, as provided\n\t\t// by server, in order to apply to them the same initialization\n\t\t// code when activating the 'classic' mode as if the elements are\n\t\t// initialized for the first time since the start of the application.\n\t\t// It is important to use the same initial structure provided by server\n\t\t// in order to keep a single place (server) of initial properties setting.\n\t\tthis.map.toolbarUpTemplate = $('#toolbar-up')[0].cloneNode(true);\n\t\tthis.map.mainMenuTemplate = $('#main-menu')[0].cloneNode(true);\n\n\t\tmap.on('infobar', this.showInfoBar, this);\n\t\tapp.events.on('updatepermission', this.onUpdatePermission.bind(this));\n\n\t\tif (window.mode.isMobile()) {\n\t\t\twindow.addEventListener('popstate', this.onGoBack.bind(this));\n\n\t\t\t// provide entries in the history we can catch to close the app\n\t\t\thistory.pushState({context: 'app-started'}, 'app-started');\n\t\t\thistory.pushState({context: 'app-started'}, 'app-started');\n\t\t}\n\n\t\tmap.on('blockUI', this.blockUI, this);\n\t\tmap.on('unblockUI', this.unblockUI, this);\n\n\t\t$('#toolbar-wrapper').on('click', (event) => {\n\t\t\tconst target = event.target as HTMLElement;\n\t\t\tif (target.parentElement?.id === 'toolbar-up') // checks if clicked on empty part of the toolbar on tabbed view\n\t\t\t\tthis.map.fire('editorgotfocus');\n\t\t});\n\n\t\t$('.main-nav').on('click', (event) => {\n\t\t\tconst target = event.target as HTMLElement;\n\t\t\tif (target.parentElement?.nodeName === 'NAV' || // checks if clicked on an container of an element\n\t\t\t\ttarget.nodeName === 'NAV' || // checks if clicked on navigation bar itself\n\t\t\t\ttarget.parentElement?.id === 'document-titlebar') { // checks if clicked on the document titlebar container\n\t\t\t\tthis.map.fire('editorgotfocus');}\n\t\t});\n\t\tconst mainNav = document.querySelector('.main-nav') as HTMLElement;\n\t\tmainNav.addEventListener('wheel', function(e: WheelEvent) {\n\t\t\tconst el = this as HTMLElement;\n\n\t\t\t// Allow default scroll for Shift + scroll or if not horizontally scrollable\n\t\t\tif (e.shiftKey || el.scrollWidth <= el.clientWidth) return;\n\t  \n\t\t\t// Scroll horizontally\n\t\t\tthis.scrollLeft += e.deltaY;\n\t  \n\t\t\t// Prevent vertical scroll only within this element\n\t\t\te.preventDefault();\n\t\t  }, { passive: false });\n\t\tthis.map.on('updateviewslist', this.onUpdateViews, this);\n\n\t\tthis.map['stateChangeHandler'].setItemValue('toggledarktheme', 'false');\n\t\tthis.map['stateChangeHandler'].setItemValue('invertbackground', 'false');\n\t\tthis.map['stateChangeHandler'].setItemValue('showannotations', 'true');\n\t}\n\n\t// UI initialization\n\n\t/**\n\t * Returns the current UI mode (\"notebookbar\" or \"classic\").\n\t */\n\tgetCurrentMode(): string {\n\t\t// no notebookbar on mobile\n\t\tif (window.mode.isMobile())\n\t\t\treturn 'classic';\n\n\t\treturn this.shouldUseNotebookbarMode() ? 'notebookbar' : 'classic';\n\t}\n\n\t/**\n\t * Returns if the highlight of column/row is enabled.\n\t */\n\tgetHighlightMode(): boolean {\n\t\treturn window.prefs.getBoolean('ColumnRowHighlightEnabled', false);\n\t}\n\n\t/**\n\t * Changes status of the highlight of column/row is enabled.\n\t */\n\tsetHighlightMode(newState: boolean): void {\n\t\twindow.prefs.set('ColumnRowHighlightEnabled', newState);\n\t\tconst highlightState = newState? 'true' : 'false';\n\t\tthis.map['stateChangeHandler'].setItemValue('columnrowhighlight', highlightState);\n\t\tthis._map.fire('commandstatechanged', {commandName : 'columnrowhighlight', state : highlightState});\n\t}\n\n\t/**\n\t * Determines whether to use notebookbar mode based on user preferences.\n\t */\n\tshouldUseNotebookbarMode(): boolean {\n\t\tconst forceCompact = window.prefs.get('compactMode', null); // getBoolean() does not accept null as the default value\n\t\t// all other cases should default to notebookbar\n\t\tconst shouldUseClassic = (window.userInterfaceMode === 'classic' && forceCompact == null) || forceCompact === 'true';\n\t\treturn !shouldUseClassic;\n\t}\n\n\t// Dark mode toggle\n\n\t/**\n\t * Switches the UI to light mode.\n\t */\n\tloadLightMode(): void {\n\t\tdocument.documentElement.setAttribute('data-theme','light');\n\t\tthis._map.fire('commandstatechanged', {commandName : 'toggledarktheme', state : 'false'});\n\t\tthis.map.fire('darkmodechanged');\n\t}\n\n\t/**\n\t * Switches the UI to dark mode.\n\t */\n\tloadDarkMode(): void {\n\t\tdocument.documentElement.setAttribute('data-theme','dark');\n\t\tthis._map.fire('commandstatechanged', {commandName : 'toggledarktheme', state : 'true'});\n\t\tthis.map.fire('darkmodechanged');\n\t}\n\n\t/**\n\t * Adjusts the canvas color after a mode change.\n\t */\n\tsetCanvasColorAfterModeChange(): void {\n\t\tif (app.sectionContainer) {\n\t\t\tapp.sectionContainer.setBackgroundColorMode(false);\n\n\t\t\tif (this.map.getDocType() == 'spreadsheet') {\n\t\t\t\tapp.sectionContainer.setClearColor(window.getComputedStyle(document.documentElement).getPropertyValue('--color-background-document'));\n\t\t\t} else {\n\t\t\t\tapp.sectionContainer.setClearColor(window.getComputedStyle(document.documentElement).getPropertyValue('--color-canvas'));\n\t\t\t}\n\n\t\t\t//change back to it's default value after setting canvas color\n\t\t\tapp.sectionContainer.setBackgroundColorMode(true);\n\t\t}\n\t}\n\n\t/**\n\t * Sets the document background based on the activation flag.\n\t */\n\tsetDarkBackground(activate: boolean): void {\n\t\tvar cmd = { 'NewTheme': { 'type': 'string', 'value': '' } };\n\t\tactivate ? cmd.NewTheme.value = 'Dark' : cmd.NewTheme.value = 'Light';\n\t\tapp.socket.sendMessage('uno .uno:InvertBackground ' + JSON.stringify(cmd));\n\t\tthis.initDarkBackgroundUI(activate);\n\t}\n\n\t/**\n\t * Initializes UI changes related to the dark background.\n\t */\n\tinitDarkBackgroundUI(activate: boolean): void {\n\t\tdocument.documentElement.setAttribute('data-bg-theme', activate ? 'dark' : 'light');\n\t\tif (activate) {\n\t\t\tthis._map.fire('commandstatechanged', {commandName : 'invertbackground', state : 'false'});\n\t\t}\n\t\telse {\n\t\t\tthis._map.fire('commandstatechanged', {commandName : 'invertbackground', state : 'true'});\n\t\t}\n\t\tthis.setCanvasColorAfterModeChange();\n\t}\n\n\t/**\n\t * Applies background inversion (with an option to skip core changes).\n\t */\n\tapplyInvert(skipCore: boolean = false): void {\n\t\t// get the initial mode\n\t\tvar backgroundDark = this.isBackgroundDark();\n\n\t\tif (skipCore) {\n\t\t\tthis.initDarkBackgroundUI(backgroundDark);\n\t\t} else {\n\t\t\tthis.setDarkBackground(backgroundDark);\n\t\t}\n\t}\n\n\t/**\n\t * Returns whether the document background should be dark.\n\t */\n\tisBackgroundDark(): boolean {\n\t\t// get the initial mode If document background is inverted or not\n\t\tvar inDarkTheme = window.prefs.getBoolean('darkTheme');\n\t\tvar darkBackgroundPrefName = 'darkBackgroundForTheme.' + (inDarkTheme ? 'dark' : 'light');\n\t\tvar backgroundDark = window.prefs.getBoolean(darkBackgroundPrefName, inDarkTheme);\n\t\treturn backgroundDark;\n\t}\n\n\t/**\n\t * Toggles the background inversion setting.\n\t */\n\ttoggleInvert(): void {\n\t\t// get the initial mode\n\t\tvar inDarkTheme = window.prefs.getBoolean('darkTheme');\n\t\tvar darkBackgroundPrefName = 'darkBackgroundForTheme.' + (inDarkTheme ? 'dark' : 'light');\n\t\tvar backgroundDark = window.prefs.getBoolean(darkBackgroundPrefName, inDarkTheme);\n\n\t\t// swap them by invoking the appropriate load function and saving the state\n\t\tif (backgroundDark) {\n\t\t\twindow.prefs.set(darkBackgroundPrefName, false);\n\t\t\tthis.setDarkBackground(false);\n\t\t}\n\t\telse {\n\t\t\twindow.prefs.set(darkBackgroundPrefName, true);\n\t\t\tthis.setDarkBackground(true);\n\t\t}\n\t}\n\n\t/**\n\t * Toggles the overall dark mode setting and refreshes related UI components.\n\t */\n\ttoggleDarkMode(): void {\n\t\t// get the initial mode\n\t\tvar inDarkTheme = window.prefs.getBoolean('darkTheme');\n\t\t// swap them by invoking the appropriate load function and saving the state\n\t\tif (inDarkTheme) {\n\t\t\twindow.prefs.set('darkTheme', false);\n\t\t\tthis.loadLightMode();\n\t\t\tthis.activateDarkModeInCore(false);\n\t\t}\n\t\telse {\n\t\t\twindow.prefs.set('darkTheme', true);\n\t\t\tthis.loadDarkMode();\n\t\t\tthis.activateDarkModeInCore(true);\n\t\t}\n\t\tthis.applyInvert();\n\t\tthis.setCanvasColorAfterModeChange();\n\t\tif (!window.mode.isMobile())\n\t\t\tthis.refreshAfterThemeChange();\n\n\t\tif (app.map._docLayer._docType === 'spreadsheet') {\n\t\t\tconst calcGridSection = app.sectionContainer.getSectionWithName(L.CSections.CalcGrid.name);\n\t\t\tif (calcGridSection)\n\t\t\t\tcalcGridSection.resetStrokeStyle();\n\t\t}\n\n\t\tthis.map.fire('themechanged');\n\t}\n\n\t/**\n\t * Initializes dark mode based on user settings.\n\t */\n\tinitDarkModeFromSettings(): void {\n\t\tvar inDarkTheme = window.prefs.getBoolean('darkTheme');\n\n\t\tif (inDarkTheme) {\n\t\t\tthis.loadDarkMode();\n\t\t} else {\n\t\t\tthis.loadLightMode();\n\t\t}\n\n\t\tthis.applyInvert(true);\n\t}\n\n\t/**\n\t * Informs the core system about the dark mode change.\n\t */\n\tactivateDarkModeInCore(activate: boolean): void {\n\t\tvar cmd = { 'NewTheme': { 'type': 'string', 'value': '' } };\n\t\tactivate ? cmd.NewTheme.value = 'Dark' : cmd.NewTheme.value = 'Light';\n\t\tapp.socket.sendMessage('uno .uno:ChangeTheme ' + JSON.stringify(cmd));\n\t}\n\n\t/**\n\t * Shows a modal dialog asking to rename document.\n\t */\n\trenameDocument(): void {\n\t\t// todo: does this need _('rename document)\n\t\tvar docNameInput = this.documentNameInput;\n\t\tvar fileName = this.map['wopi'].BaseFileName ? this.map['wopi'].BaseFileName : '';\n\t\tthis.showInputModal('rename-modal', _('Rename Document'), _('Enter new name'), fileName, _('Rename'),\n\t\t\t(newName: string) => {\n\t\t\t\tdocNameInput.documentNameConfirm(newName);\n\t\t});\n\t}\n\n\t/**\n\t * Toggles WASM mode (if applicable).\n\t */\n\ttoggleWasm(): void {\n\t\tif (window.ThisIsTheEmscriptenApp) {\n\t\t\t//TODO: Should use the \"external\" socket.\n\t\t\t// app.socket.sendMessage('switch_request online');\n\t\t} else {\n\t\t\tapp.socket.sendMessage('switch_request offline');\n\t\t}\n\n\t\t// Wait for Coolwsd to initiate the switch.\n\t}\n\n\t/**\n\t * Setup menubar and the top toolbar.\n\t */\n\tinitializeMenubarAndTopToolbar(): void {\n\t\tconst enableNotebookbar = this.shouldUseNotebookbarMode();\n\t\tconst isMobile = window.mode.isMobile();\n\t\tif (isMobile || !enableNotebookbar) {\n\t\t\tvar menubar = L.control.menubar();\n\t\t\tthis.map.menubar = menubar;\n\t\t\tthis.map.addControl(menubar);\n\t\t}\n\n\t\tif (!isMobile && !enableNotebookbar)\n\t\t\tthis.map.topToolbar = JSDialog.TopToolbar(this.map);\n\t}\n\n\t/**\n\t * Initializes basic UI components.\n\t */\n\tinitializeBasicUI(): void {\n\t\tthis.initializeMenubarAndTopToolbar();\n\n\t\tif (window.mode.isMobile()) {\n\t\t\t$('#toolbar-mobile-back').on('click', () => {\n\t\t\t\tthis.enterReadonlyOrClose();\n\t\t\t});\n\t\t}\n\n\t\tif (!window.mode.isMobile()) {\n\t\t\tthis.map.statusBar = JSDialog.StatusBar(this.map);\n\n\t\t\tthis.map.sidebar = JSDialog.Sidebar(this.map, {animSpeed: 200});\n\n\t\t\tthis.map.navigator = JSDialog.NavigatorPanel(this.map, { animSpeed: 200 });\n\n\t\t\tthis.map.formulaautocomplete = L.control.formulaautocomplete(this.map);\n\t\t\tthis.map.formulausage = L.control.formulausage(this.map);\n\t\t\tthis.map.autofillpreviewtooltip = L.control.autofillpreviewtooltip(this.map);\n\t\t}\n\n\t\tthis.map.jsdialog = L.control.jsDialog();\n\t\tthis.map.addControl(this.map.jsdialog);\n\n\t\twindow.setupToolbar(this.map);\n\n\t\tthis.documentNameInput = L.control.documentNameInput();\n\t\tthis.map.addControl(this.documentNameInput);\n\t\tthis.map.addControl(L.control.alertDialog());\n\t\tif (window.mode.isMobile()) {\n\t\t\tthis.mobileWizard = L.control.mobileWizard();\n\t\t\tthis.map.addControl(this.mobileWizard);\n\t\t}\n\t\tthis.map.addControl(L.control.languageDialog());\n\t\tthis.map.dialog = L.control.lokDialog();\n\t\tthis.map.addControl(this.map.dialog);\n\t\tthis.map.addControl(L.control.contextMenu());\n\t\tthis.map.userList = L.control.userList();\n\t\tthis.map.addControl(this.map.userList);\n\t\tthis.map.aboutDialog = JSDialog.aboutDialog(this.map);\n\n\t\tif (L.Map.versionBar && window.allowUpdateNotification)\n\t\t\tthis.map.addControl(L.Map.versionBar);\n\n\t\tvar openBusyPopup = (label: string) => {\n\t\t\tthis.busyPopupTimer = window.setTimeout(() => {\n\t\t\t\tvar json = {\n\t\t\t\t\tid: 'busypopup',\n\t\t\t\t\tjsontype: 'dialog',\n\t\t\t\t\ttype: 'modalpopup',\n\t\t\t\t\tchildren: [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tid: 'busycontainer',\n\t\t\t\t\t\t\ttype: 'container',\n\t\t\t\t\t\t\tvertical: 'true',\n\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\t{id: 'busyspinner', type: 'spinnerimg'},\n\t\t\t\t\t\t\t\t{id: 'busylabel', type: 'fixedtext', text: label}\n\t\t\t\t\t\t\t]\n\t\t\t\t\t\t}\n\t\t\t\t\t]\n\t\t\t\t};\n\t\t\t\tif (app.socket) {\n\t\t\t\t\tvar builderCallback = function() { /* Do nothing. */ };\n\t\t\t\t\tapp.socket._onMessage({textMsg: 'jsdialog: ' + JSON.stringify(json), callback: builderCallback});\n\t\t\t\t}\n\t\t\t}, 700);\n\t\t};\n\n\t\tvar fadeoutBusyPopup = () => {\n\t\t\tif (this.busyPopupTimer != null)\n\t\t\t\twindow.clearTimeout(this.busyPopupTimer);\n\t\t\tvar json = {\n\t\t\t\tid: 'busypopup',\n\t\t\t\tjsontype: 'dialog',\n\t\t\t\ttype: 'modalpopup',\n\t\t\t\taction: 'fadeout'\n\t\t\t};\n\t\t\tif (app.socket)\n\t\t\t\tapp.socket._onMessage({textMsg: 'jsdialog: ' + JSON.stringify(json)});\n\t\t};\n\n\t\tthis.map.on('showbusy', (e: any) => {\n\t\t\tfadeoutBusyPopup();\n\t\t\topenBusyPopup(e.label);\n\t\t});\n\n\t\tthis.map.on('hidebusy', (e: any) => {\n\t\t\tfadeoutBusyPopup();\n\t\t});\n\t}\n\n\t/**\n\t * Initializes specialized UI components based on the document type.\n\t * @param docType - Document type (e.g. 'spreadsheet', 'presentation', 'text').\n\t */\n\tinitializeSpecializedUI(docType: string): void {\n\t\tvar isDesktop = window.mode.isDesktop();\n\t\tvar currentMode = this.getCurrentMode();\n\t\tvar enableNotebookbar = currentMode === 'notebookbar' && !app.isReadOnly();\n\t\tvar hasShare = this.map.wopi.EnableShare;\n\n\t\tdocument.body.setAttribute('data-userInterfaceMode', currentMode);\n\t\tdocument.body.setAttribute('data-docType', docType);\n\n\t\tif (hasShare)\n\t\t\tdocument.body.setAttribute('data-integratorSidebar', 'true');\n\n\t\tif (window.mode.isMobile()) {\n\t\t\t$('#mobile-edit-button').css('display', 'flex');\n\t\t\tthis.map.mobileBottomBar = JSDialog.MobileBottomBar(this.map);\n\t\t\tthis.map.mobileTopBar = JSDialog.MobileTopBar(this.map);\n\t\t\tthis.map.mobileSearchBar = JSDialog.MobileSearchBar(this.map);\n\t\t} else if (enableNotebookbar) {\n\t\t\tthis.createNotebookbarControl(docType);\n\t\t\t// makeSpaceForNotebookbar call in onUpdatePermission\n\t\t}\n\n\t\tif (!window.prefs.getBoolean(`${docType}.ShowToolbar`, true)) {\n\t\t\tthis.collapseNotebookbar();\n\t\t}\n\n\t\tthis.initDarkModeFromSettings();\n\n\t\tif (docType === 'spreadsheet') {\n\t\t\tthis.sheetsBar = JSDialog.SheetsBar(this.map, isDesktop || window.mode.isTablet());\n\n\t\t\tconst formulabarRow = document.getElementById('formulabar-row');\n\t\t\tconst spreadsheetToolbar = document.getElementById('spreadsheet-toolbar');\n\t\t\tspreadsheetToolbar?.classList?.remove('hidden');\n\t\t\tformulabarRow?.classList?.remove('hidden');\n\t\t\tthis.map.formulabar = JSDialog.FormulaBar(this.map);\n\t\t\tthis.map.addressInputField = JSDialog.AddressInputField(this.map);\n\t\t\t$('#toolbar-wrapper').addClass('spreadsheet');\n\n\t\t\t// remove unused elements\n\t\t\tL.DomUtil.remove(L.DomUtil.get('presentation-controls-wrapper'));\n\t\t\tconst selectBackground = document.getElementById('selectbackground');\n\t\t\tif (selectBackground != null)\n\t\t\t\tselectBackground.parentNode?.removeChild(selectBackground);\n\n\t\t\tconst highlightState = this.getHighlightMode()? 'true' : 'false';\n\t\t\tthis.map['stateChangeHandler'].setItemValue('columnrowhighlight', highlightState);\n\t\t\tthis._map.fire('commandstatechanged', {commandName : 'columnrowhighlight', state : highlightState});\n\t\t}\n\n\t\tif (this.map.isPresentationOrDrawing()) {\n\t\t\t// remove unused elements\n\t\t\tL.DomUtil.remove(L.DomUtil.get('spreadsheet-toolbar'));\n\t\t\t$('#presentation-controls-wrapper').show();\n\t\t\tthis.initializeRuler();\n\t\t\tthis.map.slideShowPresenter = new SlideShow.SlideShowPresenter(this.map);\n\t\t\tthis.map.presenterConsole = new SlideShow.PresenterConsole(this.map, this.map.slideShowPresenter);\n\t\t}\n\n\t\tif (docType === 'text') {\n\t\t\t// remove unused elements\n\t\t\tL.DomUtil.remove(L.DomUtil.get('spreadsheet-toolbar'));\n\t\t\tL.DomUtil.remove(L.DomUtil.get('presentation-controls-wrapper'));\n\t\t\tconst selectBackground = document.getElementById('selectbackground');\n\t\t\tif (selectBackground != null)\n\t\t\t\tselectBackground.parentNode?.removeChild(selectBackground);\n\n\t\t\tthis.initializeRuler();\n\n\t\t\tvar showResolved = this.getBooleanDocTypePref('ShowResolved', true);\n\t\t\tif (showResolved === false)\n\t\t\t\tthis.map.sendUnoCommand('.uno:ShowResolvedAnnotations');\n\t\t\t// Notify the initial status of comments\n\t\t\tvar initialCommentState = this.map['stateChangeHandler'].getItemValue('showannotations');\n\t\t\tthis._map.fire('commandstatechanged', {commandName : 'showannotations', state : initialCommentState});\n\t\t\tthis.map.mention = L.control.mention(this.map);\n\t\t}\n\n\t\tif (this.map.isPresentationOrDrawing() && (isDesktop || window.mode.isTablet())) {\n\t\t\tJSDialog.PresentationBar(this.map);\n\t\t}\n\t\tif ((window.mode.isTablet() || window.mode.isDesktop()) && !app.isReadOnly()) {\n\t\t\tthis.map.navigator.initializeNavigator(docType);\n\t\t}\n\n\t\tthis.map.on('changeuimode', this.onChangeUIMode, this);\n\n\t\tthis.refreshTheme();\n\n\t\tvar startPresentationGet = this.map.isPresentationOrDrawing() && window.coolParams.get('startPresentation');\n\t\t// check for \"presentation\" dispatch event only after document gets fully loaded\n\t\tthis.map.on('docloaded', function() {\n\t\t\tif (startPresentationGet === 'true' || startPresentationGet === '1') {\n\t\t\t\tapp.dispatcher.dispatch('presentation');\n\t\t\t}\n\t\t});\n\t}\n\n\t/**\n\t * Initializes the sidebar based on saved state and preferences.\n\t */\n\tinitializeSidebar(): void {\n\t\t// Hide the sidebar on start if saved state or UIDefault is set.\n\t\tif (window.mode.isDesktop() && !window.ThisIsAMobileApp) {\n\t\t\tvar showSidebar = this.getBooleanDocTypePref('ShowSidebar', true);\n\n\t\t\tif (this.getBooleanDocTypePref('PropertyDeck', true)) {\n\t\t\t\tapp.socket.sendMessage('uno .uno:SidebarShow');\n\t\t\t}\n\n\t\t\tif (this.map.getDocType() === 'presentation') {\n\t\t\t\tif (this.getBooleanDocTypePref('SdSlideTransitionDeck', false)) {\n\t\t\t\t\tapp.socket.sendMessage('uno .uno:SidebarShow');\n\t\t\t\t\tapp.socket.sendMessage('uno .uno:SlideChangeWindow');\n\t\t\t\t\tthis.map.sidebar.setupTargetDeck('.uno:SlideChangeWindow');\n\t\t\t\t} else if (this.getBooleanDocTypePref('SdCustomAnimationDeck', false)) {\n\t\t\t\t\tapp.socket.sendMessage('uno .uno:SidebarShow');\n\t\t\t\t\tapp.socket.sendMessage('uno .uno:CustomAnimation');\n\t\t\t\t\tthis.map.sidebar.setupTargetDeck('.uno:CustomAnimation');\n\t\t\t\t} else if (this.getBooleanDocTypePref('SdMasterPagesDeck', false)) {\n\t\t\t\t\tapp.socket.sendMessage('uno .uno:SidebarShow');\n\t\t\t\t\tapp.socket.sendMessage('uno .uno:MasterSlidesPanel');\n\t\t\t\t\tthis.map.sidebar.setupTargetDeck('.uno:MasterSlidesPanel');\n\t\t\t\t}\n\t\t\t} else if (this.getBooleanDocTypePref('StyleListDeck', false)) {\n\t\t\t\tapp.socket.sendMessage('uno .uno:SidebarShow');\n\t\t\t\tapp.socket.sendMessage('uno .uno:SidebarDeck.StyleListDeck');\n\t\t\t\tthis.map.sidebar.setupTargetDeck('.uno:SidebarDeck.StyleListDeck');\n\t\t\t}\n\n\t\t\tif (showSidebar)\n\t\t\t\tthis.map.sidebar.setAsInitialized();\n\t\t\telse\n\t\t\t\tapp.socket.sendMessage('uno .uno:SidebarHide');\n\t\t}\n\t\telse if (window.mode.isChromebook()) {\n\t\t\t// HACK - currently the sidebar shows when loaded,\n\t\t\t// with the exception of mobile phones & tablets - but\n\t\t\t// there, it does not show only because they start\n\t\t\t// with read/only mode which hits an early exit in\n\t\t\t// _launchSidebar() in Control.LokDialog.js\n\t\t\t// So for the moment, let's just hide it on\n\t\t\t// Chromebooks early\n\t\t\tapp.socket.sendMessage('uno .uno:SidebarHide');\n\t\t}\n\t}\n\n\t/**\n\t * Initializes the ruler component.\n\t */\n\tinitializeRuler(): void {\n\t\tif ((window.mode.isTablet() || window.mode.isDesktop()) && !app.isReadOnly()) {\n\t\t\tvar showRuler = this.getBooleanDocTypePref('ShowRuler');\n\t\t\tvar interactiveRuler = this.map.isEditMode();\n\t\t\t// Call the static method from the Ruler class\n\t\t\tapp.definitions.ruler.initializeRuler(this.map, {\n\t\t\t\tinteractive: interactiveRuler,\n\t\t\t\tshowruler: showRuler\n\t\t\t});\n\t\t}\n\t}\n\n\t/**\n\t * Removes classic UI components.\n\t */\n\tremoveClassicUI(): void {\n\t\tif (this.map.menubar)\n\t\t{\n\t\t\tthis.map.removeControl(this.map.menubar);\n\t\t\tthis.map.menubar = null;\n\t\t}\n\t\tif (this.map.topToolbar)\n\t\t{\n\t\t\tthis.map.topToolbar.onRemove();\n\t\t\tthis.map.topToolbar = null;\n\t\t}\n\t}\n\n\t/**\n\t * Adds classic UI components.\n\t */\n\taddClassicUI(): void {\n\t\tthis.map.menubar = L.control.menubar();\n\t\tthis.map.addControl(this.map.menubar);\n\t\tthis.map.topToolbar = JSDialog.TopToolbar(this.map);\n\n\t\t//update the toolbar according to CheckFileInfo\n\t\tthis.map.topToolbar.onWopiProps(this.map.wopi);\n\n\t\tthis.map.menubar._onDocLayerInit();\n\t\tthis.map.topToolbar.onDocLayerInit();\n\t\tthis.map.sendInitUNOCommands();\n\t\tthis.map._docLayer._resetClientVisArea();\n\t\tthis.map._docLayer._requestNewTiles();\n\n\t\tthis.map.topToolbar.updateControlsState();\n\n\t\tif (this._menubarShouldBeHidden)\n\t\t\tthis.hideMenubar();\n\t}\n\n\t/**\n\t * Creates and adds a notebookbar control based on document type.\n\t * @param docType - Document type (e.g. 'spreadsheet', 'presentation', etc.)\n\t */\n\tcreateNotebookbarControl(docType: string): void {\n\t\tif (docType === 'spreadsheet') {\n\t\t\tvar notebookbar = L.control.notebookbarCalc();\n\t\t} else if (docType === 'presentation') {\n\t\t\tnotebookbar = L.control.notebookbarImpress();\n\t\t} else if (docType === 'drawing') {\n\t\t\tnotebookbar = L.control.notebookbarDraw();\n\t\t} else {\n\t\t\tnotebookbar = L.control.notebookbarWriter();\n\t\t}\n\n\t\tthis.notebookbar = notebookbar;\n\t\tthis.map.addControl(notebookbar);\n\t\tthis.map.fire('a11ystatechanged');\n\t\tapp.UI.notebookbarAccessibility.initialize();\n\t}\n\n\t/**\n\t * Refreshes UI components after a theme change.\n\t */\n\trefreshAfterThemeChange(): void {\n\t\tif (this.getCurrentMode() === 'classic' || this.map.isReadOnlyMode()) {\n\t\t\tthis.refreshMenubar();\n\t\t\tthis.refreshToolbar();\n\t\t}\n\t\t// jsdialog components like notebookbar or sidebar\n\t\t// doesn't require reload to change icons\n\t}\n\n\t/**\n\t * Refreshes the notebookbar.\n\t */\n\trefreshNotebookbar(): void {\n\t\t\tvar selectedTab = $('.ui-tab.notebookbar[aria-selected=\"true\"]').attr('id') || 'Home-tab-label';\n\t\t\tthis.removeNotebookbarUI();\n\t\t\tthis.createNotebookbarControl(this.map.getDocType());\n\t\t\tif (this._map._permission === 'edit') {\n\t\t\t\t$('.main-nav').removeClass('readonly');\n\t\t\t}\n\t\t\t$('#' + selectedTab).click();\n\t\t\tthis.makeSpaceForNotebookbar();\n\t\t\tthis.notebookbar._showNotebookbar = true;\n\t\t\tthis.notebookbar.showTabs();\n\t\t\t$('#map').addClass('notebookbar-opened');\n\t\t\tthis.insertCustomButtons();\n\t\t\tthis.map.sendInitUNOCommands();\n\t\t\tif (this.map.getDocType() === 'presentation')\n\t\t\t\tthis.map.fire('toggleslidehide');\n\t}\n\n\t/**\n\t * Refreshes the menubar.\n\t */\n\trefreshMenubar(): void {\n\t\tif (this.map.menubar)\n\t\t\tthis.map.menubar._onRefresh();\n\t}\n\n\t/**\n\t * Refreshes the sidebar after a delay.\n\t * @param ms - Milliseconds to delay the refresh (default 400ms).\n\t */\n\trefreshSidebar(ms?: number): void {\n\t\tms = ms !== undefined ? ms : 400;\n\t\tsetTimeout(function () {\n\t\t\tvar message = 'dialogevent ' +\n\t\t\t\t(window.sidebarId !== undefined ? window.sidebarId : -1) +\n\t\t\t\t' {\"id\":\"-1\"}';\n\t\t\tapp.socket.sendMessage(message);\n\t\t}, ms);\n\t}\n\n\t/**\n\t * Placeholder method for refreshing the toolbar.\n\t */\n\trefreshToolbar(): void {\n\t\t// TODO\n\t}\n\n\t/**\n\t * Adds notebookbar UI components.\n\t */\n\taddNotebookbarUI(): void {\n\t\tthis.refreshNotebookbar();\n\t\tthis.map._docLayer._resetClientVisArea();\n\t\tthis.map._docLayer._requestNewTiles();\n\t\tvar menubarWasHidden = this.isMenubarHidden();\n\t\tthis.showMenubar();\n\t\tthis._menubarShouldBeHidden = menubarWasHidden;\n\t}\n\n\t/**\n\t * Removes notebookbar UI components.\n\t */\n\tremoveNotebookbarUI(): void {\n\t\tif (this.notebookbar) {\n\t\t\tthis.map.removeControl(this.notebookbar);\n\t\t\tthis.notebookbar = null;\n\t\t}\n\t\t$('#map').removeClass('notebookbar-opened');\n\t}\n\n\t/**\n\t * Handles UI mode changes.\n\t * @param uiMode - Object containing the new UI mode and additional flags.\n\t */\n\tonChangeUIMode(uiMode: any): void {\n\t\tif (window.mode.isMobile())\n\t\t\treturn;\n\n\t\tvar currentMode = this.getCurrentMode();\n\n\t\tif (uiMode.mode === currentMode && !uiMode.force)\n\t\t\treturn;\n\n\t\tif (uiMode.mode !== 'classic' && uiMode.mode !== 'notebookbar')\n\t\t\treturn;\n\n\t\tdocument.body.setAttribute('data-userInterfaceMode', uiMode.mode);\n\n\t\tthis.map.fire('postMessage', {msgId: 'Action_ChangeUIMode_Resp', args: {Mode: uiMode.mode}});\n\n\t\tswitch (currentMode) {\n\t\tcase 'classic':\n\t\t\tthis.removeClassicUI();\n\t\t\tbreak;\n\n\t\tcase 'notebookbar':\n\t\t\tthis.removeNotebookbarUI();\n\t\t\tbreak;\n\t\t}\n\n\t\twindow.userInterfaceMode = uiMode.mode;\n\n\t\tswitch (uiMode.mode) {\n\t\tcase 'classic':\n\t\t\tthis.addClassicUI();\n\t\t\tbreak;\n\n\t\tcase 'notebookbar':\n\t\t\tthis.addNotebookbarUI();\n\t\t\tbreak;\n\t\t}\n\n\t\twindow.prefs.set('compactMode', uiMode.mode === 'classic');\n\t\tthis.initializeSidebar();\n\t\tthis.insertCustomButtons();\n\n\t\t// this code ensures that elements in the notebookbar have their \"selected\" status\n\t\t// displayed correctly\n\t\tthis.map.fire('rulerchanged');\n\t\tthis.map.fire('statusbarchanged');\n\n\t\tif (typeof window.initializedUI === 'function')\n\t\t\twindow.initializedUI();\n\t\tthis.map.fire('darkmodechanged');\n\t\tthis.map.fire('rulerchanged');\n\t\tthis.map.fire('statusbarchanged');\n\t\tthis.map.fire('a11ystatechanged');\n\t}\n\n\t// UI modification\n\n\t/**\n\t * Inserts a button into the classic toolbar.\n\t * @param button - Button configuration object.\n\t */\n\tinsertButtonToClassicToolbar(button: any): void {\n\t\tif (this.map.isEditMode()) {\n\t\t\t// Position: Either specified by the caller, or defaulting to first position (before save)\n\t\t\tvar insertBefore = button.insertBefore || 'save';\n\n\t\t\tvar newButton: ToolbarButton[] = [\n\t\t\t\t{\n\t\t\t\t\ttype: 'button',\n\t\t\t\t\tuno: button.unoCommand,\n\t\t\t\t\tid: button.id,\n\t\t\t\t\timg: button.id,\n\t\t\t\t\thint: _(button.hint.replaceAll('\"', '&quot;')), /* \"Try\" to localize ! */\n\t\t\t\t\t/* Notify the host back when button is clicked (only when unoCommand is not set) */\n\t\t\t\t\tpostmessage: !Object.prototype.hasOwnProperty.call(button, 'unoCommand')\n\t\t\t\t}\n\t\t\t];\n\n\t\t\t// TODO: other\n\t\t\tvar topToolbar = window.app.map.topToolbar;\n\t\t\tif (topToolbar && !topToolbar.hasItem(button.id)) {\n\t\t\t\t// translate to JSDialog JSON\n\t\t\t\tnewButton[0].command = newButton[0].uno;\n\t\t\t\tnewButton[0].type = 'toolitem';\n\t\t\t\tnewButton[0].w2icon = newButton[0].img;\n\t\t\t\tnewButton[0].text = newButton[0].hint;\n\t\t\t\ttopToolbar.insertItem(insertBefore, newButton);\n\n\t\t\t\t// updated css rules to show custom button images\n\t\t\t\tthis.setCssRulesForCustomButtons();\n\t\t\t}\n\t\t}\n\n\t\tif (this.map.isReadOnlyMode()) {\n\t\t\t// Just add a menu entry for it\n\t\t\tthis.map.fire('addmenu', {id: button.id, label: button.hint});\n\t\t}\n\t}\n\n\tsetCssRulesForCustomButtons(): void {\n\t\tfor (var button of this.customButtons) {\n\t\t\tconst item = document.querySelector(\".w2ui-icon.\" + encodeURIComponent(button.id)) as HTMLElement | null;\n\t\t\tvar imgUrl = button.imgurl;\n\t\t\tif (item) {\n\t\t\t\tif(button.imgurl === undefined || button.imgurl === \"\") {\n\t\t\t\t\tvar iconName = app.LOUtil.getIconNameOfCommand(button.unoCommand);\n\t\t\t\t\timgUrl = app.LOUtil.getImageURL(iconName);\n\t\t\t\t}\n\t\t\t\titem.style.background = 'url(\"' + encodeURI(imgUrl) + '\")';\n\t\t\t\titem.style.backgroundRepeat = 'no-repeat';\n\t\t\t\titem.style.backgroundPosition = 'center';\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Registers a new custom button.\n\t *\n\t * Called by the WOPI API to register new custom button\n\t * @param button - Button configuration object.\n\t */\n\tinsertButton(button: any): void {\n\t\tfor (var i in this.customButtons) {\n\t\t\tvar item = this.customButtons[i];\n\t\t\tif (item.id === button.id)\n\t\t\t\treturn;\n\t\t}\n\n\t\tthis.customButtons.push(button);\n\t\tthis.insertCustomButton(button);\n\t}\n\n\t/**\n\t * Inserts a custom button into the current UI.\n\t * @param button - Button configuration object.\n\t */\n\tinsertCustomButton(button: any): void {\n\t\tif (button.tablet === false && window.mode.isTablet()) {\n\t\t\treturn;\n\t\t}\n\t\tif (!this.notebookbar)\n\t\t\tthis.insertButtonToClassicToolbar(button);\n\t\telse\n\t\t\tthis.notebookbar.insertButtonToShortcuts(button);\n\t}\n\n\t/**\n\t * Inserts all custom buttons into the current UI.\n\t */\n\tinsertCustomButtons(): void {\n\t\tfor (var i in this.customButtons)\n\t\t\tthis.insertCustomButton(this.customButtons[i]);\n\t}\n\n\t/**\n\t * Shows or hides a button in the classic toolbar.\n\t * @param buttonId - The buttons ID.\n\t * @param show - Flag to show (true) or hide (false).\n\t */\n\tshowButtonInClassicToolbar(buttonId: string, show: boolean): boolean {\n\t\t// TODO: other\n\t\tconst toolbars: any[] = [];\n\t\tlet found = false;\n\n\t\ttoolbars.forEach((toolbar) => {\n\t\t\tif (toolbar && toolbar.get(buttonId)) {\n\t\t\t\tfound = true;\n\t\t\t\ttoolbar.showItem(buttonId, show);\n\t\t\t}\n\t\t});\n\n\t\tconst topToolbarHas = window.app.map.topToolbar.hasItem(buttonId);\n\t\tfound = found || topToolbarHas;\n\t\tif (topToolbarHas)\n\t\t\twindow.app.map.topToolbar.showItem(buttonId, show);\n\n\t\treturn found;\n\t}\n\n\t/**\n\t * Shows or hides a button in the current UI.\n\t * @param buttonId - The buttons ID.\n\t * @param show - Flag to show (true) or hide (false).\n\t */\n\tshowButton(buttonId: string, show: boolean): void {\n\t\tvar found = false;\n\t\tif (!this.notebookbar) {\n\t\t\tfound = this.showButtonInClassicToolbar(buttonId, show);\n\t\t} else {\n\t\t\tif (show) {\n\t\t\t\tdelete this.hiddenButtons[buttonId];\n\t\t\t} else {\n\t\t\t\tthis.hiddenButtons[buttonId] = true;\n\t\t\t}\n\t\t\tthis.notebookbar.reloadShortcutsBar();\n\t\t\tfound = this.notebookbar.showNotebookbarButton(buttonId, show);\n\t\t}\n\n\t\tif (!found) {\n\t\t\twindow.app.console.error('Button with id \"' + buttonId + '\" not found.');\n\t\t\treturn;\n\t\t}\n\t}\n\n\t/**\n\t * Returns whether a button is currently visible.\n\t * @param buttonId - The buttons ID.\n\t */\n\tisButtonVisible(buttonId: string): boolean {\n\t\treturn !(buttonId in this.hiddenButtons);\n\t}\n\n\t// Commands\n\n\t/**\n\t * Shows or hides a command in the menubar.\n\t * @param command - Command identifier.\n\t * @param show - Flag to show (true) or hide (false).\n\t */\n\tshowCommandInMenubar(command: string, show: boolean): boolean {\n\t\tvar menubar = this._map.menubar;\n\t\tif (show) {\n\t\t\treturn menubar.showUnoItem(command);\n\t\t} else {\n\t\t\treturn menubar.hideUnoItem(command);\n\t\t}\n\t}\n\n\t/**\n\t * Shows or hides a command in the classic toolbar.\n\t * @param command - Command identifier.\n\t * @param show - Flag to show (true) or hide (false).\n\t */\n\tshowCommandInClassicToolbar(command: string, show: boolean): boolean {\n\t\t// TODO: other\n\t\tconst toolbars: any[] = [];\n\t\tvar found = false;\n\n\t\ttoolbars.forEach((toolbar) => {\n\t\t\tif (!toolbar)\n\t\t\t\treturn;\n\t\t\ttoolbar.items.forEach((item: any) => {\n\t\t\t\tvar commands = this.map._extractCommand(item);\n\t\t\t\tif (commands.indexOf(command) != -1) {\n\t\t\t\t\tfound = true;\n\t\t\t\t\tif (show) {\n\t\t\t\t\t\ttoolbar.showItem(item.id, true);\n\t\t\t\t\t} else {\n\t\t\t\t\t\ttoolbar.showItem(item.id, false);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\n\t\treturn found;\n\t}\n\n\t/**\n\t * Shows or hides a command in the current UI.\n\t * @param command - Command identifier.\n\t * @param show - Flag to show (true) or hide (false).\n\t */\n\tshowCommand(command: string, show: boolean): void {\n\t\tif (show) {\n\t\t\tdelete this.hiddenCommands[command];\n\t\t} else {\n\t\t\tthis.hiddenCommands[command] = true;\n\t\t}\n\t\tvar found = false;\n\t\tif (!this.notebookbar) {\n\t\t\tfound ||= this.showCommandInClassicToolbar(command, show);\n\t\t\tfound ||= this.showCommandInMenubar(command, show);\n\t\t} else {\n\t\t\tthis.notebookbar.reloadShortcutsBar();\n\t\t\tfound ||= this.notebookbar.showNotebookbarCommand(command, show);\n\t\t}\n\n\t\tif (!found) {\n\t\t\twindow.app.console.error('Item with command \"' + command + '\" not found.');\n\t\t}\n\t}\n\n\t/**\n\t * Returns whether a command is visible.\n\t * @param command - Command identifier.\n\t */\n\tisCommandVisible(command: string): boolean {\n\t\treturn !(command in this.hiddenCommands);\n\t}\n\n\t// Menubar\n\n\t/**\n\t * Shows the menubar.\n\t */\n\tshowMenubar(): void {\n\t\tthis._menubarShouldBeHidden = false;\n\t\tif (!this.isMenubarHidden())\n\t\t\treturn;\n\t\t$('.main-nav').show();\n\t\tif (L.Params.closeButtonEnabled && !window.mode.isTablet()) {\n\t\t\t$('#closebuttonwrapper').show();\n\t\t\t$('#closebuttonwrapperseparator').show();\n\t\t}\n\t\tconst obj = document.getElementById('fold-button');\n\t\tif (obj != null)\n\t\t\tobj.style.transform = 'rotate(0deg)';\n\n\t\t$('#fold').prop('title', _('Hide Menu'));\n\n\t\tif (this._notebookbarShouldBeCollapsed)\n\t\t\tthis.collapseNotebookbar();\n\t}\n\n\t/**\n\t * Hides the menubar.\n\t */\n\thideMenubar(): void {\n\t\tthis._menubarShouldBeHidden = true;\n\t\tif (this.isMenubarHidden() || this.shouldUseNotebookbarMode())\n\t\t\treturn;\n\n\t\tvar notebookbarWasCollapsed = this.isNotebookbarCollapsed();\n\t\tthis.extendNotebookbar();  // The notebookbar has the button to show the menu bar, so having it hidden at the same time softlocks you\n\t\tthis._notebookbarShouldBeCollapsed = notebookbarWasCollapsed;\n\n\t\t$('.main-nav').hide();\n\t\tif (L.Params.closeButtonEnabled) {\n\t\t\t$('#closebuttonwrapper').hide();\n\t\t\t$('#closebuttonwrapperseparator').hide();\n\t\t}\n\t\tconst obj = document.getElementById('fold-button');\n\t\tif (obj != null)\n\t\t\tobj.style.transform = 'rotate(180deg)';\n\n\t\t$('#fold').prop('title', _('Show Menu'));\n\t}\n\n\t/**\n\t * Returns whether the menubar is hidden.\n\t */\n\tisMenubarHidden(): boolean {\n\t\treturn $('.main-nav').css('display') === 'none';\n\t}\n\n\t/**\n\t * Toggles the menubars visibility.\n\t */\n\ttoggleMenubar(): void {\n\t\tif (this.isMenubarHidden())\n\t\t\tthis.showMenubar();\n\t\telse\n\t\t\tthis.hideMenubar();\n\t}\n\n\t// Ruler\n\n\t/**\n\t * Shows the ruler.\n\t */\n\tshowRuler(): void {\n\t\tthis._map.sendUnoCommand('.uno:ShowRuler');\n\t\t$('.cool-ruler').show();\n\t\t$('#map').addClass('hasruler');\n\t\tthis.setDocTypePref('ShowRuler', true);\n\t\tthis.map.fire('rulerchanged');\n\t}\n\n\t/**\n\t * Hides the ruler.\n\t */\n\thideRuler(): void {\n\t\t$('.cool-ruler').hide();\n\t\t$('#map').removeClass('hasruler');\n\t\tthis.setDocTypePref('ShowRuler', false);\n\t\tthis.map.fire('rulerchanged');\n\t}\n\n\t/**\n\t * Toggles the rulers visibility.\n\t */\n\ttoggleRuler(): void {\n\t\tif (this.isRulerVisible())\n\t\t\tthis.hideRuler();\n\t\telse\n\t\t\tthis.showRuler();\n\t}\n\n\t/**\n\t * Returns whether the ruler is visible.\n\t */\n\tisRulerVisible(): boolean {\n\t\treturn $('.cool-ruler').is(':visible');\n\t}\n\n\t/**\n\t * Returns whether the document is in fullscreen mode.\n\t */\n\tisFullscreen(): boolean {\n\t\tif (!document.fullscreenElement &&\n\t\t\t!document.mozFullscreenElement &&\n\t\t\t!document.msFullscreenElement &&\n\t\t\t!document.webkitFullscreenElement)\n\t\t\treturn false;\n\t\telse\n\t\t\treturn true;\n\t}\n\n\t// Notebookbar helpers\n\n\t/**\n\t * Returns whether the notebookbar is currently shown.\n\t */\n\thasNotebookbarShown(): boolean {\n\t\treturn $('#map').hasClass('notebookbar-opened');\n\t}\n\n\t/**\n\t * Adjusts layout to make space for the notebookbar.\n\t */\n\tmakeSpaceForNotebookbar(): void {\n\t\tif (this.hasNotebookbarShown())\n\t\t\treturn;\n\n\t\t$('#map').addClass('notebookbar-opened');\n\t}\n\n\t/**\n\t * Collapses the notebookbar.\n\t */\n\tcollapseNotebookbar(): void {\n\t\tthis._notebookbarShouldBeCollapsed = true;\n\n\t\tif (this.isNotebookbarCollapsed() || this.isMenubarHidden())\n\t\t\treturn;\n\n\t\tthis.moveObjectVertically($('#formulabar'), -1);\n\t\t$('#toolbar-wrapper').css('display', 'none');\n\n\t\t$('#document-container').addClass('tabs-collapsed');\n\t}\n\n\t/**\n\t * Extends (uncollapses) the notebookbar.\n\t */\n\textendNotebookbar(): void {\n\t\tthis._notebookbarShouldBeCollapsed = false;\n\n\t\tif (!this.isNotebookbarCollapsed())\n\t\t\treturn;\n\n\t\tthis.moveObjectVertically($('#formulabar'), 1);\n\t\t$('#toolbar-wrapper').css('display', '');\n\n\t\t$('#document-container').removeClass('tabs-collapsed');\n\t}\n\n\tshowNotebookTab(id: string, show: boolean): void {\n\t\tif (show) {\n\t\t\tdelete this.hiddenTabs[id];\n\t\t} else {\n\t\t\tthis.hiddenTabs[id] = true;\n\t\t}\n\t\tif (this.notebookbar) {\n\t\t\tthis.notebookbar.refreshContextTabsVisibility();\n\t\t}\n\t}\n\n\t/**\n\t * Is the notebookbar's tab visible?\n\t */\n\tisTabVisible(name: string): boolean {\n\t\treturn !(name in this.hiddenTabs);\n\t}\n\n\t/**\n\t * Returns whether the notebookbar is collapsed.\n\t */\n\tisNotebookbarCollapsed(): boolean {\n\t\treturn $('#document-container').hasClass('tabs-collapsed');\n\t}\n\n\t// UI Defaults functions\n\n\t/**\n\t * Shows the status bar.\n\t */\n\tshowStatusBar(): void {\n\t\t$('#document-container').css('bottom', this.documentBottom);\n\t\tthis.map.statusBar.show();\n\t\tthis.setDocTypePref('ShowStatusbar', true);\n\t\tthis.map.fire('statusbarchanged');\n\t}\n\n\t/**\n\t * Hides the status bar.\n\t * @param firstStart - Optional flag indicating if this is the initial call.\n\t */\n\thideStatusBar(firstStart?: boolean): void {\n\t\tif (!firstStart && !this.isStatusBarVisible())\n\t\t\treturn;\n\n\t\tthis.documentBottom = $('#document-container').css('bottom');\n\t\t$('#document-container').css('bottom', '0px');\n\t\tthis.map.statusBar.hide();\n\t\tif (!firstStart)\n\t\t\tthis.setDocTypePref('ShowStatusbar', false);\n\t\tthis.map.fire('statusbarchanged');\n\t}\n\n\t/**\n\t * Toggles the status bars visibility.\n\t */\n\ttoggleStatusBar(): void {\n\t\tif (this.isStatusBarVisible())\n\t\t\tthis.hideStatusBar();\n\t\telse\n\t\t\tthis.showStatusBar();\n\t}\n\n\t/**\n\t * Focuses the search functionality.\n\t */\n\tfocusSearch(): void {\n\t\tthis.showStatusBar();\n\t\tthis.map.fire('focussearch');\n\t}\n\n\t/**\n\t * Returns whether the status bar is visible.\n\t */\n\tisStatusBarVisible(): boolean {\n\t\treturn document.getElementById('toolbar-down')?.style?.display !== 'none';\n\t}\n\n\t// Event handlers\n\n\t/**\n\t * Event handler for updating document permission.\n\t * @param e - The event object containing permission details.\n\t */\n\tonUpdatePermission(e: any): void {\n\t\tif (window.mode.isMobile()) {\n\t\t\tif (e.detail.perm === 'edit') {\n\t\t\t\thistory.pushState({context: 'app-started'}, 'edit-mode');\n\t\t\t\t$('#toolbar-down').show();\n\t\t\t}\n\t\t\telse {\n\t\t\t\thistory.pushState({context: 'app-started'}, 'readonly-mode');\n\t\t\t\t$('#toolbar-down').hide();\n\t\t\t}\n\t\t}\n\n\t\tvar enableNotebookbar = this.shouldUseNotebookbarMode();\n\t\tif (enableNotebookbar && !window.mode.isMobile()) {\n\t\t\tif (e.detail.perm === 'edit') {\n\t\t\t\tif (this.map.menubar) {\n\t\t\t\t\tthis.map.removeControl(this.map.menubar);\n\t\t\t\t\tthis.map.menubar = null;\n\t\t\t\t}\n\t\t\t\tthis.makeSpaceForNotebookbar();\n\t\t\t} else if (e.detail.perm === 'readonly') {\n\t\t\t\tif (!this.map.menubar) {\n\t\t\t\t\tvar menubar = L.control.menubar();\n\t\t\t\t\tthis.map.menubar = menubar;\n\t\t\t\t\tthis.map.addControl(menubar);\n\t\t\t\t}\n\n\t\t\t\tif (this.notebookbar && $('#mobile-edit-button').is(':hidden')) {\n\t\t\t\t\tthis.map.removeControl(this.notebookbar);\n\t\t\t\t\tthis.notebookbar = null;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tapp.socket.sendMessage('uno .uno:SidebarHide');\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Refreshes the UI.\n\t */\n\trefreshUI(): void {\n\t\tif (this.notebookbar && !this.map._shouldStartReadOnly())\n\t\t\tthis.refreshNotebookbar();\n\t\telse\n\t\t\tthis.refreshMenubar();\n\n\t\tthis.refreshTheme();\n\t}\n\n\trefreshTheme(): void {\n\t\tif (typeof window.initializedUI === 'function') {\n\t\t\twindow.initializedUI();\n\t\t}\n\t}\n\n\t/**\n\t * Updates the view information.\n\t */\n\tonUpdateViews(): void {\n\t\tif (!this.map._docLayer || typeof this.map._docLayer._viewId === 'undefined')\n\t\t\treturn;\n\n\t\tvar myViewId = this.map._docLayer._viewId;\n\t\tvar myViewData = this.map._viewInfo[myViewId];\n\t\tif (!myViewData) {\n\t\t\tconsole.error('Not found view data for viewId: \"' + myViewId + '\"');\n\t\t\treturn;\n\t\t}\n\n\t\tvar userPrivateInfo = myViewData.userprivateinfo;\n\t\tif (userPrivateInfo && window.zoteroEnabled) {\n\t\t\tvar apiKey = userPrivateInfo.ZoteroAPIKey;\n\t\t\tif (apiKey !== undefined && !this.map.zotero) {\n\t\t\t\tthis.map.zotero = L.control.zotero(this.map);\n\t\t\t\tthis.map.zotero.apiKey = apiKey;\n\t\t\t\tthis.map.addControl(this.map.zotero);\n\t\t\t\tthis.map.zotero.updateUserID();\n\t\t\t}\n\t\t}\n\t\tif (window.documentSigningEnabled) {\n\t\t\tif (userPrivateInfo && this.notebookbar) {\n\t\t\t\tconst show = userPrivateInfo.SignatureCert && userPrivateInfo.SignatureKey;\n\t\t\t\t// Show or hide the signature button on the notebookbar depending on if we\n\t\t\t\t// have a signing cert/key specified.\n\t\t\t\tthis.showButton('signature', show);\n\t\t\t}\n\t\t\tconst serverPrivateInfo = myViewData.serverprivateinfo;\n\t\t\tif (serverPrivateInfo) {\n\t\t\t\tconst baseUrl = serverPrivateInfo.ESignatureBaseUrl;\n\t\t\t\tconst clientId = serverPrivateInfo.ESignatureClientId;\n\t\t\t\tif (baseUrl !== undefined && !this.map.eSignature) {\n\t\t\t\t\tthis.map.eSignature = L.control.eSignature(baseUrl, clientId);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Enters read-only mode or closes the app.\n\t */\n\tenterReadonlyOrClose(): void {\n\t\tif (this.map.isEditMode()) {\n\t\t\t// in edit mode, passing 'edit' actually enters readonly mode\n\t\t\t// and bring the blue circle editmode button back\n\t\t\tthis.map.setPermission('edit');\n\t\t\tvar toolbar = app.map.topToolbar;\n\t\t\tif (toolbar) {\n\t\t\t\ttoolbar.selectItem('closemobile', false);\n\t\t\t\ttoolbar.selectItem('close', false);\n\t\t\t}\n\t\t} else {\n\t\t\tapp.dispatcher.dispatch('closeapp');\n\t\t}\n\t}\n\n\t/**\n\t * Handles mobile back navigation.\n\t * @param popStateEvent - The popstate event.\n\t */\n\tonGoBack(popStateEvent: any): void {\n\t\tif (popStateEvent.state && popStateEvent.state.context) {\n\t\t\tif (popStateEvent.state.context === 'mobile-wizard' && this.mobileWizard) {\n\t\t\t\tif (this.mobileWizard.isOpen()) {\n\t\t\t\t\tthis.mobileWizard.goLevelUp(true);\n\t\t\t\t} else {\n\t\t\t\t\tthis.enterReadonlyOrClose();\n\t\t\t\t}\n\t\t\t} else if (popStateEvent.state.context === 'app-started') {\n\t\t\t\tthis.enterReadonlyOrClose();\n\t\t\t}\n\t\t}\n\t}\n\n\t// Blocking UI\n\n\t/**\n\t * Returns whether the UI is blocked.\n\t */\n\tisUIBlocked(): boolean {\n\t\treturn this.blockedUI;\n\t}\n\n\t/**\n\t * Blocks the UI and displays a busy popup.\n\t * @param event - Event containing an optional message.\n\t */\n\tblockUI(event: any): void {\n\t\tthis.blockedUI = true;\n\t\tthis.map.fire('showbusy', {label: event ? event.message : null});\n\t}\n\n\t/**\n\t * Unblocks the UI and hides the busy popup.\n\t */\n\tunblockUI(): void {\n\t\tthis.blockedUI = false;\n\t\tthis.map.fire('hidebusy');\n\t}\n\n\t// Document area tooltip\n\n\t/**\n\t * Sets the tooltip text for an element.\n\t * @param element - The target element.\n\t * @param text - Tooltip text.\n\t */\n\tprivate _setTooltipText(element: any, text: string): void {\n\t\tvar dummyNode = L.DomUtil.create('div');\n\t\tdummyNode.innerText = text;\n\t\telement.tooltip('option', 'content', dummyNode.innerHTML);\n\t}\n\n\t/**\n\t * Shows general tooltips in the document area\n\t * @param tooltipInfo - contains rectangle (position in twips) and text properties.\n\t */\n\tshowDocumentTooltip(tooltipInfo: any): void {\n\t\tvar split = tooltipInfo.rectangle.split(',');\n\t\tvar latlng = this.map._docLayer._twipsToLatLng(new L.Point(+split[0], +split[1]));\n\t\tvar pt = this.map.latLngToContainerPoint(latlng);\n\t\tvar elem = $('.leaflet-layer');\n\n\t\telem.tooltip();\n\t\telem.tooltip('enable');\n\t\tthis._setTooltipText(elem, tooltipInfo.text);\n\t\telem.tooltip('option', 'items', elem[0]);\n\t\telem.tooltip('option', 'position', { my: 'left bottom',  at: 'left+' + pt.x + ' top+' + pt.y, collision: 'fit fit' });\n\t\telem.tooltip('open');\n\t\tdocument.addEventListener('mousemove', function() {\n\t\t\telem.tooltip('close');\n\t\t\telem.tooltip('disable');\n\t\t}, {once: true});\n\t}\n\n\t// Snack bar\n\n\t/**\n\t * Closes the snackbar.\n\t */\n\tcloseSnackbar(): void {\n\t\tJSDialog.SnackbarController.closeSnackbar();\n\t}\n\n\t/**\n\t * Displays a snackbar notification.\n\t * @param label - Message text.\n\t * @param action - Action text.\n\t * @param callback - Callback to execute on action.\n\t * @param timeout - Duration before auto-dismiss.\n\t * @param hasProgress - Whether to show a progress bar.\n\t * @param withDismiss - Whether a dismiss button is included.\n\t * @param infinite - If true, shows an indeterminate progress bar.\n\t */\n\tshowSnackbar(\n\t\tlabel: string,\n\t\taction: string,\n\t\tcallback: any,\n\t\ttimeout: number,\n\t\thasProgress: boolean,\n\t\twithDismiss: boolean,\n\t): void {\n\t\tJSDialog.SnackbarController.showSnackbar(label, action, callback, timeout, hasProgress, withDismiss);\n\t}\n\n\t/**\n\t * Displays a snackbar with a progress bar.\n\t */\n\tshowProgressBar(\n\t\tmessage: string,\n\t\tbuttonText: string,\n\t\tcallback: any,\n\t\ttimeout?: number,\n\t\twithDismiss?: boolean,\n\t\tinfinite?: boolean,\n\t): void {\n\t\tJSDialog.SnackbarController.showSnackbar(message, buttonText, callback, timeout ? timeout : -1, true, withDismiss, infinite);\n\t}\n\n\t/**\n\t * Updates the progress value on the snackbar.\n\t * @param value - Progress value (0100).\n\t * @param infinite - If true, shows an indeterminate progress bar.\n\t */\n\tsetSnackbarProgress(value: number, infinite?: boolean): void {\n\t\tJSDialog.SnackbarController.setSnackbarProgress(value, infinite);\n\t}\n\n\t// Modals\n\n\t/**\n\t * Displays a modal dialog.\n\t * @param json - JSON configuration for the dialog.\n\t * @param callbacks - Array of callback configurations.\n\t * @param cancelButtonId - Optional ID for the cancel button.\n\t */\n\tshowModal(json: any, callbacks: any[], cancelButtonId?: string): void {\n\t\tvar builderCallback = (objectType: any, eventType: any, object: any, data: any) => {\n\t\t\twindow.app.console.debug(\"modal action: '\" + objectType + \"' id:'\" + object.id + \"' event: '\" + eventType + \"' state: '\" + data + \"'\");\n\n\t\t\t// default close methods\n\t\t\tcallbacks.push({id: (cancelButtonId ? cancelButtonId: 'response-cancel'), func: () => { this.closeModal(json.id); }});\n\t\t\tcallbacks.push({id: '__POPOVER__', func: () => { this.closeModal(json.id); }});\n\n\t\t\tfor (var i in callbacks) {\n\t\t\t\tvar callback = callbacks[i];\n\t\t\t\tif (object.id === callback.id && (!callback.type || eventType === callback.type)) {\n\t\t\t\t\tcallback.func(objectType, eventType, object, data);\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\tapp.socket._onMessage({textMsg: 'jsdialog: ' + JSON.stringify(json), callback: builderCallback});\n\t}\n\n\t/**\n\t * Closes a modal dialog.\n\t * @param dialogId - The ID of the dialog to close.\n\t */\n\tcloseModal(dialogId: string): void {\n\t\tvar closeMessage = { id: dialogId, jsontype: 'dialog', type: 'modalpopup', action: 'close' };\n\t\tapp.socket._onMessage({ textMsg: 'jsdialog: ' + JSON.stringify(closeMessage) });\n\t}\n\n\t/**\n\t * Closes all open dialogs.\n\t */\n\tcloseAll(): void {\n\t\tif (this.map.jsdialog)\n\t\t\tthis.map.jsdialog.closeAll();\n\t\telse\n\t\t\tthis.mobileWizard._closeWizard();\n\t}\n\n\t/**\n\t * Returns whether any dialog is currently open.\n\t */\n\tisAnyDialogOpen(): boolean {\n\t\tif (this.map.jsdialog)\n\t\t\treturn this.map.jsdialog.hasDialogOpened();\n\t\telse\n\t\t\treturn this.mobileWizard.isOpen();\n\t}\n\n\t// TODO: remove and use JSDialog.generateModalId directly\n\tgenerateModalId(givenId: string): string {\n\t\treturn JSDialog.generateModalId(givenId);\n\t}\n\n\t/**\n\t * Constructs JSON for a modal dialog.\n\t * @param id - Base ID.\n\t * @param title - Dialog title. No titlebar if missing.\n\t * @param cancellable - Whether the dialog is cancellable.\n\t * @param widgets - Array of widget configurations.\n\t * @param focusId - Optional focus element ID.\n\t * @param clickToDismiss - Optional flag for click-to-dismiss behavior.\n\t */\n\tprivate _modalDialogJSON(\n\t\tid: string,\n\t\ttitle: string | undefined,\n\t\tcancellable: boolean,\n\t\twidgets: any[],\n\t\tfocusId?: string,\n\t\tclickToDismiss?: boolean,\n\t): any {\n\t\tvar dialogId = this.generateModalId(id);\n\t\tfocusId = focusId ? focusId : 'response';\n\t\treturn {\n\t\t\tid: dialogId,\n\t\t\tdialogid: id,\n\t\t\ttype: 'modalpopup',\n\t\t\ttitle: title,\n\t\t\thasClose: title !== undefined,\n\t\t\thasOverlay: true,\n\t\t\tcancellable: cancellable,\n\t\t\tjsontype: 'dialog',\n\t\t\t'init_focus_id': focusId,\n\t\t\tclickToDismiss: clickToDismiss,\n\t\t\tchildren: [\n\t\t\t\t{\n\t\t\t\t\tid: 'info-modal-container',\n\t\t\t\t\ttype: 'container',\n\t\t\t\t\tvertical: true,\n\t\t\t\t\tchildren: widgets,\n\t\t\t\t},\n\t\t\t]\n\t\t};\n\t}\n\n\t/// DEPRECATED: use JSDialog.showInfoModalWithOptions instead\n\t/// shows simple info modal (message + ok button)\n\t/// When called with just an id (one argument), the popup will be click dismissable.\n\t/// id - id of a dialog\n\t/// title - title of a dialog\n\t/// message1 - 1st line of message\n\t/// message2 - 2nd line of message\n\t/// buttonText - text inside button\n\t/// callback - callback on button press\n\t/// withCancel - specifies if needs cancel button also\n\tshowInfoModal(\n\t\tid: string,\n\t\ttitle: string | undefined,\n\t\tmessage1: string,\n\t\tmessage2: string,\n\t\tbuttonText: string,\n\t\tcallback: any,\n\t\twithCancel: boolean,\n\t\tfocusId?: string,\n\t): void {\n\t\tvar dialogId = this.generateModalId(id);\n\t\tvar responseButtonId = id + '-response';\n\t\tvar cancelButtonId = id + '-cancel';\n\t\t// If called with only id, then we want clickToDismiss.\n\t\tvar clickToDismiss = arguments.length < 2;\n\n\t\tvar json = this._modalDialogJSON(id, title, true, [\n\t\t\t{\n\t\t\t\tid: 'info-modal-tile-m',\n\t\t\t\ttype: 'fixedtext',\n\t\t\t\ttext: title,\n\t\t\t\thidden: !window.mode.isMobile()\n\t\t\t},\n\t\t\t{\n\t\t\t\tid: 'info-modal-label1',\n\t\t\t\ttype: 'fixedtext',\n\t\t\t\ttext: message1\n\t\t\t},\n\t\t\t{\n\t\t\t\tid: 'info-modal-label2',\n\t\t\t\ttype: 'fixedtext',\n\t\t\t\ttext: message2\n\t\t\t},\n\t\t\t{\n\t\t\t\tid: '',\n\t\t\t\ttype: 'buttonbox',\n\t\t\t\ttext: '',\n\t\t\t\tenabled: true,\n\t\t\t\tchildren: [\n\t\t\t\t\twithCancel ? {\n\t\t\t\t\t\tid: cancelButtonId,\n\t\t\t\t\t\ttype: 'pushbutton',\n\t\t\t\t\t\ttext: _('Cancel')\n\t\t\t\t\t} : { type: 'container' },\n\t\t\t\t\t{\n\t\t\t\t\t\tid: responseButtonId,\n\t\t\t\t\t\ttype: 'pushbutton',\n\t\t\t\t\t\ttext: buttonText,\n\t\t\t\t\t\t'has_default': true,\n\t\t\t\t\t\thidden: buttonText ? false: true // Hide if no text is given. So we can use one modal type for various purposes.\n\t\t\t\t\t}\n\t\t\t\t],\n\t\t\t\tvertical: false,\n\t\t\t\tlayoutstyle: 'end'\n\t\t\t},\n\t\t], focusId, clickToDismiss);\n\n\t\tthis.showModal(json, [\n\t\t\t{id: responseButtonId, func: () => {\n\t\t\t\tvar dontClose = false;\n\t\t\t\tif (typeof callback === 'function')\n\t\t\t\t\tdontClose = callback();\n\t\t\t\tif (!dontClose)\n\t\t\t\t\tthis.closeModal(dialogId);\n\t\t\t}}\n\t\t], cancelButtonId);\n\t\tif (!buttonText && !withCancel) {\n\t\t\t// if no buttons better to set tabIndex to negative so the element is not reachable via sequential keyboard navigation but can be focused programatically\n\t\t\tconst dialogElement = document.getElementById(dialogId);\n\t\t\tif (dialogElement != null) {\n\t\t\t\tdialogElement.tabIndex = -1;\n\t\t\t\t// We hid the OK button, we need to set focus manually on the popup.\n\t\t\t\tdialogElement.focus();\n\t\t\t\tdialogElement.className += ' focus-hidden';\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Displays a modal dialog with a progress bar.\n\t */\n\tshowProgressBarDialog(\n\t\tid: string,\n\t\ttitle: string,\n\t\tmessage: string,\n\t\tbuttonText: string,\n\t\tcallback: any,\n\t\tvalue?: number,\n\t\tcancelCallback?: any,\n\t\tinfinite: boolean = false,\n\t): void {\n\t\tvar dialogId = this.generateModalId(id);\n\t\tvar responseButtonId = id + '-response';\n\t\tvar cancelButtonId = id + '-cancel';\n\n\t\tvar json = this._modalDialogJSON(id, title, true, [\n\t\t\t{\n\t\t\t\tid: 'info-modal-tile-m',\n\t\t\t\ttype: 'fixedtext',\n\t\t\t\ttext: title,\n\t\t\t\thidden: !window.mode.isMobile()\n\t\t\t},\n\t\t\t{\n\t\t\t\tid: 'info-modal-label1',\n\t\t\t\ttype: 'fixedtext',\n\t\t\t\ttext: message\n\t\t\t},\n\t\t\t{\n\t\t\t\tid: dialogId + '-progressbar',\n\t\t\t\ttype: 'progressbar',\n\t\t\t\tvalue: (value !== undefined && value !== null ? value: 0),\n\t\t\t\tmaxValue: 100,\n\t\t\t\tinfinite: infinite\n\t\t\t},\n\t\t\t{\n\t\t\t\tid: '',\n\t\t\t\ttype: 'buttonbox',\n\t\t\t\ttext: '',\n\t\t\t\tenabled: true,\n\t\t\t\tchildren: [\n\t\t\t\t\t{\n\t\t\t\t\t\tid: cancelButtonId,\n\t\t\t\t\t\ttype: 'pushbutton',\n\t\t\t\t\t\ttext: _('Cancel')\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tid: responseButtonId,\n\t\t\t\t\t\ttype: 'pushbutton',\n\t\t\t\t\t\ttext: buttonText,\n\t\t\t\t\t\t'has_default': true,\n\t\t\t\t\t\thidden: buttonText ? false: true // Hide if no text is given. So we can use one modal type for various purposes.\n\t\t\t\t\t}\n\t\t\t\t],\n\t\t\t\tvertical: false,\n\t\t\t\tlayoutstyle: 'end'\n\t\t\t},\n\t\t], buttonText ? responseButtonId : cancelButtonId);\n\n\t\tthis.showModal(json, [\n\t\t\t{id: responseButtonId, func: () => {\n\t\t\t\tvar dontClose = false;\n\t\t\t\tif (typeof callback === 'function')\n\t\t\t\t\tdontClose = callback();\n\t\t\t\tif (!dontClose)\n\t\t\t\t\tthis.closeModal(dialogId);\n\t\t\t}},\n\t\t\t{id: cancelButtonId, func: () => {\n\t\t\t\tif (typeof cancelCallback === 'function')\n\t\t\t\t\tcancelCallback();\n\t\t\t}}\n\t\t], cancelButtonId);\n\t}\n\n\t/**\n\t * Updates the progress value in a progress dialog.\n\t * @param value - Progress value (0100).\n\t * @param infinite - If true, shows an indeterminate progress bar.\n\t */\n\tsetDialogProgress(id: string, value: number, infinite: boolean): void {\n\t\tif (!app.socket)\n\t\t\treturn;\n\n\t\tvar dialogId = this.generateModalId(id);\n\n\t\tvar json = {\n\t\t\tid: dialogId,\n\t\t\tjsontype: 'dialog',\n\t\t\ttype: 'modalpopup',\n\t\t\taction: 'update',\n\t\t\tcontrol: {\n\t\t\t\tid: dialogId + '-progressbar',\n\t\t\t\ttype: 'progressbar',\n\t\t\t\tvalue: value,\n\t\t\t\tmaxValue: 100,\n\t\t\t\tinfinite: infinite\n\t\t\t}\n\t\t};\n\n\t\tapp.socket._onMessage({textMsg: 'jsdialog: ' + JSON.stringify(json)});\n\t}\n\n\t/// buttonObjectList: [{id: button's id, text: button's text, ..other properties if needed}, ...]\n\t/// callbackList: [{id: button's id, func_: function}, ...]\n\tshowModalWithCustomButtons(\n\t\tid: string,\n\t\ttitle: string,\n\t\tmessage: string,\n\t\tcancellable: boolean,\n\t\tbuttonObjectList: any[],\n\t\tcallbackList: any[],\n\t): void {\n\t\tvar dialogId = this.generateModalId(id);\n\n\t\tfor (var i = 0; i < buttonObjectList.length; i++)\n\t\t\tbuttonObjectList[i].type = 'pushbutton';\n\n\t\tvar json = this._modalDialogJSON(id, title, !!cancellable, [\n\t\t\t{\n\t\t\t\tid: 'info-modal-tile-m',\n\t\t\t\ttype: 'fixedtext',\n\t\t\t\ttext: title,\n\t\t\t\thidden: !window.mode.isMobile()\n\t\t\t},\n\t\t\t{\n\t\t\t\tid: 'info-modal-label1',\n\t\t\t\ttype: 'fixedtext',\n\t\t\t\ttext: message\n\t\t\t},\n\t\t\t{\n\t\t\t\tid: '',\n\t\t\t\ttype: 'buttonbox',\n\t\t\t\ttext: '',\n\t\t\t\tenabled: true,\n\t\t\t\tchildren: buttonObjectList,\n\t\t\t\tvertical: false,\n\t\t\t\tlayoutstyle: 'end'\n\t\t\t},\n\t\t]);\n\n\t\tbuttonObjectList.forEach((button) => {\n\t\t\tcallbackList.forEach((callback) => {\n\t\t\t\tif (button.id === callback.id) {\n\t\t\t\t\tif (typeof callback.func_ === 'function') {\n\t\t\t\t\t\tcallback.func = () => {\n\t\t\t\t\t\t\tcallback.func_();\n\t\t\t\t\t\t\tthis.closeModal(dialogId);\n\t\t\t\t\t\t};\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t\tcallback.func = () => { this.closeModal(dialogId); };\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\n\t\tthis.showModal(json, callbackList);\n\t}\n\n\t/// shows simple input modal (message + input + (cancel + ok) button)\n\t/// id - id of a dialog\n\t/// title - title of a dialog\n\t/// message - message\n\t/// defaultValue - default value of an input\n\t/// buttonText - text inside OK button\n\t/// callback - callback on button press\n\tshowInputModal(\n\t\tid: string,\n\t\ttitle: string,\n\t\tmessage: string,\n\t\tdefaultValue: string,\n\t\tbuttonText: string,\n\t\tcallback: (input: string) => void,\n\t\tpasswordInput?: boolean,\n\t): void {\n\t\tvar dialogId = this.generateModalId(id);\n\t\tvar json = this._modalDialogJSON(id, title, !window.mode.isDesktop(), [\n\t\t\t{\n\t\t\t\tid: 'info-modal-label1',\n\t\t\t\ttype: 'fixedtext',\n\t\t\t\ttext: message,\n\t\t\t\tlabelFor: 'input-modal',\n\t\t\t},\n\t\t\t{\n\t\t\t\tid: 'input-modal',\n\t\t\t\ttype: 'edit',\n\t\t\t\tpassword: !!passwordInput,\n\t\t\t\ttext: defaultValue,\n\t\t\t\tlabelledBy: 'info-modal-label1'\n\t\t\t},\n\t\t\t{\n\t\t\t\tid: '',\n\t\t\t\ttype: 'buttonbox',\n\t\t\t\ttext: '',\n\t\t\t\tenabled: true,\n\t\t\t\tchildren: [\n\t\t\t\t\t{\n\t\t\t\t\t\tid: 'response-cancel',\n\t\t\t\t\t\ttype: 'pushbutton',\n\t\t\t\t\t\ttext: _('Cancel'),\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tid: 'response-ok',\n\t\t\t\t\t\ttype: 'pushbutton',\n\t\t\t\t\t\ttext: buttonText,\n\t\t\t\t\t\t'has_default': true,\n\t\t\t\t\t}\n\t\t\t\t],\n\t\t\t\tvertical: false,\n\t\t\t\tlayoutstyle: 'end'\n\t\t\t},\n\t\t], 'input-modal-input');\n\n\t\tthis.showModal(json, [\n\t\t\t{id: 'response-ok', func: () => {\n\t\t\t\tif (typeof callback === 'function') {\n\t\t\t\t\tvar input = document.getElementById('input-modal-input') as HTMLInputElement;\n\t\t\t\t\tcallback(input.value);\n\t\t\t\t}\n\t\t\t\tthis.closeModal(dialogId);\n\t\t\t}}\n\t\t]);\n\t}\n\n\t/// Shows an info bar at the bottom right of the view.\n\t/// This is called by map.fire('infobar', {data}).\n\tshowInfoBar(e: any): void {\n\t\tvar message = e.msg;\n\t\tvar link = e.action;\n\t\tvar linkText = e.actionLabel;\n\n\t\tvar id = 'infobar' + Math.round(Math.random() * 10);\n\t\tvar dialogId = this.generateModalId(id);\n\t\tvar json = this._modalDialogJSON(id, ' ', !window.mode.isDesktop(), [\n\t\t\t{\n\t\t\t\tid: dialogId + '-text',\n\t\t\t\ttype: 'fixedtext',\n\t\t\t\ttext: message\n\t\t\t},\n\t\t\t{\n\t\t\t\tid: '',\n\t\t\t\ttype: 'buttonbox',\n\t\t\t\ttext: '',\n\t\t\t\tenabled: true,\n\t\t\t\tchildren: [\n\t\t\t\t\t{\n\t\t\t\t\t\tid: dialogId + '-response',\n\t\t\t\t\t\ttype: 'pushbutton',\n\t\t\t\t\t\ttext: _(linkText),\n\t\t\t\t\t\t'has_default': true,\n\t\t\t\t\t}\n\t\t\t\t],\n\t\t\t\tvertical: false,\n\t\t\t\tlayoutstyle: 'end'\n\t\t\t},\n\t\t]);\n\n\t\tthis.showModal(json,\n\t\t[{\n\t\t\tid : dialogId + '-response',\n\t\t\tfunc : () => {\n\t\t\t\tif (!link || !linkText)\n\t\t\t\t\treturn;\n\t\t\t\tvar win = window.open(window.sanitizeUrl(link), '_blank');\n\t\t\t\twin?.focus();\n\t\t\t}\n\t\t}]);\n\n\t\tif (!window.mode.isMobile()) {\n\t\t\tconst dialogElement = document.getElementById(dialogId);\n\t\t\tif (dialogElement != null) {\n\t\t\t\tdialogElement.style.marginRight = '0';\n\t\t\t\tdialogElement.style.marginBottom = '0';\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Displays a yes/no confirmation modal dialog.\n\t */\n\tshowYesNoButton(\n\t\tid: string,\n\t\ttitle: string,\n\t\tmessage: string,\n\t\tyesButtonText: string,\n\t\tnoButtonText: string,\n\t\tyesFunction: () => void,\n\t\tnoFunction: () => void,\n\t\tcancellable: boolean,\n\t): void {\n\t\tvar dialogId = this.generateModalId(id);\n\n\t\tvar json = this._modalDialogJSON(id, title, cancellable, [\n\t\t\t{\n\t\t\t\tid:  dialogId + '-title',\n\t\t\t\ttype: 'fixedtext',\n\t\t\t\ttext: title,\n\t\t\t\thidden: !window.mode.isMobile()\n\t\t\t},\n\t\t\t{\n\t\t\t\tid: dialogId + '-label',\n\t\t\t\ttype: 'fixedtext',\n\t\t\t\ttext: message\n\t\t\t},\n\t\t\t{\n\t\t\t\tid: '',\n\t\t\t\ttype: 'buttonbox',\n\t\t\t\ttext: '',\n\t\t\t\tenabled: true,\n\t\t\t\tchildren: [\n\t\t\t\t\tnoButtonText ? {\n\t\t\t\t\t\tid: dialogId + '-nobutton',\n\t\t\t\t\t\ttype: 'pushbutton',\n\t\t\t\t\t\ttext: noButtonText\n\t\t\t\t\t} : { type: 'container' },\n\t\t\t\t\t{\n\t\t\t\t\t\tid: dialogId + '-yesbutton',\n\t\t\t\t\t\ttype: 'pushbutton',\n\t\t\t\t\t\ttext: yesButtonText,\n\t\t\t\t\t}\n\t\t\t\t],\n\t\t\t\tvertical: false,\n\t\t\t\tlayoutstyle: 'end'\n\t\t\t},\n\t\t]);\n\n\t\tthis.showModal(json,\n\t\t[\n\t\t\t{\n\t\t\t\tid: dialogId + '-nobutton',\n\t\t\t\tfunc: () => {\n\t\t\t\t\tif (typeof noFunction === 'function')\n\t\t\t\t\t\tnoFunction();\n\t\t\t\t\tthis.closeModal(dialogId);\n\t\t\t\t}\n\t\t\t},\n\t\t\t{\n\t\t\t\tid: dialogId + '-yesbutton',\n\t\t\t\tfunc: () => {\n\t\t\t\t\tif (typeof yesFunction === 'function')\n\t\t\t\t\t\tyesFunction();\n\t\t\t\t\tthis.closeModal(dialogId);\n\t\t\t\t}\n\t\t\t}\n\t\t]);\n\t}\n\n\t/// shows simple confirm modal (message + (cancel + ok) button)\n\t/// id - id of a dialog\n\t/// title - title of a dialog\n\t/// message - message\n\t/// buttonText - text inside OK button\n\t/// callback - callback on button press\n\tshowConfirmModal(\n\t\tid: string,\n\t\ttitle: string,\n\t\tmessage: string,\n\t\tbuttonText: string,\n\t\tcallback: () => void,\n\t\thideCancelButton?: boolean,\n\t): void {\n\t\tvar dialogId = this.generateModalId(id);\n\t\tvar json = this._modalDialogJSON(id, title, !window.mode.isDesktop(), [\n\t\t\t{\n\t\t\t\tid: 'info-modal-label1',\n\t\t\t\ttype: 'fixedtext',\n\t\t\t\ttext: message\n\t\t\t},\n\t\t\t{\n\t\t\t\tid: '',\n\t\t\t\ttype: 'buttonbox',\n\t\t\t\ttext: '',\n\t\t\t\tenabled: true,\n\t\t\t\tchildren: [\n\t\t\t\t\t{\n\t\t\t\t\t\tid: 'response-cancel',\n\t\t\t\t\t\ttype: 'pushbutton',\n\t\t\t\t\t\ttext: _('Cancel'),\n\t\t\t\t\t\thidden: hideCancelButton === true ? true: false\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tid: 'response-ok',\n\t\t\t\t\t\ttype: 'pushbutton',\n\t\t\t\t\t\ttext: buttonText,\n\t\t\t\t\t\t'has_default': true,\n\t\t\t\t\t}\n\t\t\t\t],\n\t\t\t\tvertical: false,\n\t\t\t\tlayoutstyle: 'end'\n\t\t\t},\n\t\t]);\n\n\t\tthis.showModal(json, [\n\t\t\t{id: 'response-ok', func: () => {\n\t\t\t\tif (typeof callback === 'function') {\n\t\t\t\t\tcallback();\n\t\t\t\t}\n\t\t\t\tthis.closeModal(dialogId);\n\t\t\t}}\n\t\t]);\n\t}\n\n\t// Helper functions\n\n\t/**\n\t * Moves a jQuery element vertically by a specified difference.\n\t * @param obj - The jQuery element.\n\t * @param diff - The vertical pixel difference.\n\t */\n\tmoveObjectVertically(obj: JQuery, diff: number): void {\n\t\tif (obj) {\n\t\t\tvar prevTop = obj.css('top');\n\t\t\tif (prevTop) {\n\t\t\t\tprevTop = parseInt(prevTop.slice(0, -2)) + diff + 'px';\n\t\t\t}\n\t\t\telse {\n\t\t\t\tprevTop = diff + 'px';\n\t\t\t}\n\t\t\tobj.css({ top: prevTop });\n\t\t\t}\n\t\t}\n\n\t/**\n\t * Sets a document typespecific preference.\n\t * @param name - Preference name.\n\t * @param value - Preference value.\n\t */\n\tsetDocTypePref(name: string, value: any): any {\n\t\tconst docType = this.map.getDocType();\n\t\treturn window.prefs.set(`${docType}.${name}`, value);\n\t}\n\n\t/**\n\t * Sets several document typespecific preference items at once.\n\t */\n\tsetDocTypeMultiplePrefs(prefs: { [key: string]: string }) {\n\t\tconst docType = this.map.getDocType();\n\n\t\tconst deckPrefs: Record<string, string> = {};\n\t\tfor (const [key, value] of Object.entries(prefs)) {\n\t\t\tdeckPrefs[`${docType}.${key}`] = value\n\t\t}\n\t\twindow.prefs.setMultiple(deckPrefs);\n\t}\n\n\t/**\n\t * Retrieves a boolean preference for the current document type.\n\t * @param name - Preference name.\n\t * @param defaultValue - Default value if not set.\n\t */\n\tgetBooleanDocTypePref(name: string, defaultValue: boolean = false): boolean {\n\t\tconst docType = this.map.getDocType();\n\t\treturn window.prefs.getBoolean(`${docType}.${name}`, defaultValue);\n\t}\n}\n\n// Export a factory function for the UIManager control.\nL.control.uiManager = function (): UIManager {\n\treturn new UIManager();\n};\n"]}