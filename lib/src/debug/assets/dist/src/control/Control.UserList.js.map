{"version":3,"file":"Control.UserList.js","sourceRoot":"","sources":["../../../../../../../../../../TanhX/online/browser/src/control/Control.UserList.ts"],"names":[],"mappings":"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","sourcesContent":["// @ts-strict-ignore\n/* -*- js-indent-level: 8 -*- */\n/*\n * Copyright the Collabora Online contributors.\n *\n * SPDX-License-Identifier: MPL-2.0\n *\n * This Source Code Form is subject to the terms of the Mozilla Public\n * License, v. 2.0. If a copy of the MPL was not distributed with this\n * file, You can obtain one at http://mozilla.org/MPL/2.0/.\n */\n/*\n * L.Control.UserList\n */\n/* global app */\n\ninterface UserExtraInfo {\n\tavatar: string;\n}\n\ninterface User {\n\tusername: string;\n\textraInfo: UserExtraInfo;\n\tcolor: string;\n\treadonly: boolean;\n\tyou: boolean;\n\tcachedHeaderAvatar?: HTMLImageElement;\n\tcachedUserListAvatar?: HTMLImageElement;\n}\n\ninterface UserEvent {\n\tviewId: number;\n\tusername: string;\n\textraInfo: UserExtraInfo;\n\treadonly: boolean;\n}\n\nclass UserList extends L.Control {\n\toptions: {\n\t\tuserLimitHeader: number;\n\t\tuserLimitHeaderWhenFollowing: number;\n\t\tuserPopupTimeout: null | ReturnType<typeof setTimeout>;\n\t\tuserJoinedPopupMessage: string;\n\t\tuserLeftPopupMessage: string;\n\t\tfollowingChipTextUser: string;\n\t\tfollowingChipTextEditor: string;\n\t\tfollowingChipTooltipText: string;\n\t\tuserAvatarAlt: string;\n\t\tnUsers?: string;\n\t\toneUser?: string;\n\t\tnoUser?: string;\n\t} = {\n\t\tuserLimitHeader: 6,\n\t\tuserLimitHeaderWhenFollowing: 3,\n\t\tuserPopupTimeout: null,\n\t\tuserJoinedPopupMessage: _('{user} has joined'),\n\t\tuserLeftPopupMessage: _('{user} has left'),\n\t\tfollowingChipTextUser: _('Following {user}'),\n\t\tfollowingChipTextEditor: _('Following the editor'),\n\t\tfollowingChipTooltipText: _('Stop following'),\n\t\tuserAvatarAlt: _('Avatar for {user}'),\n\t\tnUsers: undefined,\n\t\toneUser: undefined,\n\t\tnoUser: undefined,\n\t};\n\n\tusers: Map<number, User> = new Map();\n\n\tonAdd(map: ReturnType<typeof L.map>) {\n\t\tthis.map = map;\n\n\t\tmap.on('addview', this.onAddView, this);\n\t\tmap.on('removeview', this.onRemoveView, this);\n\t\tmap.on('deselectuser', this.deselectUser, this);\n\n\t\tif (window.mode.isMobile() || window.mode.isTablet()) {\n\t\t\tthis.options.nUsers = '%n';\n\t\t\tthis.options.oneUser = '1';\n\t\t\tthis.options.noUser = '0';\n\t\t} else {\n\t\t\tthis.options.nUsers = _('%n users');\n\t\t\tthis.options.oneUser = _('1 user');\n\t\t\tthis.options.noUser = _('0 users');\n\t\t}\n\n\t\tconst userListElement = document.getElementById('userListSummary');\n\t\tuserListElement.setAttribute('aria-label', _('User List Summary'));\n\n\t\tthis.registerHeaderAvatarEvents();\n\t}\n\n\tselectUser(viewId: number) {\n\t\tconst user = this.users.get(viewId);\n\n\t\tif (user === undefined) {\n\t\t\tconsole.debug(\"User doesn't exist: \" + viewId);\n\t\t\treturn;\n\t\t}\n\n\t\tthis.renderAll();\n\t}\n\n\tgetFollowedUser(): undefined | [number, User] {\n\t\tconst followedId = app.getFollowedViewId();\n\t\tconst myViewId =\n\t\t\tthis.map && this.map._docLayer && this.map._docLayer._viewId;\n\n\t\tif (\n\t\t\tmyViewId === followedId ||\n\t\t\tfollowedId === -1 ||\n\t\t\t!app.isFollowingUser()\n\t\t) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\tconst followedUser = this.users.get(followedId);\n\n\t\tif (followedUser === undefined) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\treturn [followedId, followedUser];\n\t}\n\n\tunfollowAll() {\n\t\tapp.setFollowingOff();\n\t}\n\n\tfollowUser(viewId: number, instantJump: boolean = true) {\n\t\tconst myViewId = this.map._docLayer._viewId;\n\t\tconst followingViewId = app.getFollowedViewId();\n\t\tconst followMyself = viewId === myViewId;\n\n\t\tif (followingViewId === viewId) return;\n\n\t\tapp.setFollowingUser(viewId);\n\n\t\tif (followMyself) {\n\t\t\tthis.map._setFollowing(true, myViewId, instantJump);\n\t\t} else if (viewId !== -1) {\n\t\t\tthis.map._setFollowing(true, viewId, instantJump);\n\t\t} else {\n\t\t\tthis.unfollowAll();\n\t\t\tthis.map._setFollowing(false, -1);\n\t\t}\n\n\t\tthis.selectUser(viewId);\n\t}\n\n\tcreateAvatar(\n\t\tcachedElement: HTMLImageElement | undefined,\n\t\tviewId: number,\n\t\tusername: string,\n\t\textraInfo: UserExtraInfo,\n\t\tcolor: string,\n\t\tzIndex?: number | 'auto',\n\t) {\n\t\tif (zIndex === undefined) {\n\t\t\tzIndex = 'auto';\n\t\t}\n\n\t\tlet img = cachedElement;\n\n\t\tif (img === undefined) {\n\t\t\timg = L.DomUtil.create('img', 'avatar-img') as HTMLImageElement;\n\t\t}\n\n\t\tapp.LOUtil.setUserImage(img, this.map, viewId);\n\n\t\timg.alt = this.options.userAvatarAlt.replace('{user}', username);\n\n\t\timg.style.zIndex = zIndex.toString();\n\t\timg.style.borderColor = color;\n\t\timg.style.backgroundColor = 'var(--color-background-lighter)';\n\n\t\timg.setAttribute('data-view-id', viewId.toString());\n\n\t\treturn img;\n\t}\n\n\tgetUserItem(\n\t\tviewId: number,\n\t\tusername: string,\n\t\textraInfo: UserExtraInfo,\n\t\tcolor: string,\n\t) {\n\t\tvar content = L.DomUtil.create('tr', 'useritem');\n\t\tcontent.id = 'user-' + viewId;\n\t\t$(document).on(\n\t\t\t'click',\n\t\t\t'#' + content.id,\n\t\t\tthis.onUseritemClicked.bind(this),\n\t\t);\n\n\t\tvar iconTd = L.DomUtil.create('td', 'usercolor', content);\n\t\tvar nameTd = L.DomUtil.create('td', 'username cool-font', content);\n\n\t\tconst avatarElement = this.createAvatar(\n\t\t\tundefined,\n\t\t\tviewId,\n\t\t\tusername,\n\t\t\textraInfo,\n\t\t\tcolor,\n\t\t);\n\t\ticonTd.appendChild(avatarElement);\n\t\tnameTd.textContent = username;\n\n\t\treturn content;\n\t}\n\n\topenDropdown() {\n\t\tconst userListSummary = document.getElementById(\n\t\t\t'userListSummaryBackground',\n\t\t);\n\t\tconst userListPopover = document.getElementById('userlist-dropdown');\n\t\t// checking case ''(empty string) is because when element loads first time it does not have any inline display style\n\t\tconst canShowDropdown =\n\t\t\t!userListPopover &&\n\t\t\tuserListSummary &&\n\t\t\tuserListSummary.style.display !== 'none';\n\t\tif (canShowDropdown) {\n\t\t\tJSDialog.OpenDropdown(\n\t\t\t\t'userlist',\n\t\t\t\tdocument.getElementById('userListSummary'),\n\t\t\t\tJSDialog.MenuDefinitions.get('UsersListMenu'),\n\t\t\t);\n\t\t}\n\t}\n\n\tregisterHeaderAvatarEvents() {\n\t\tdocument.getElementById('userListSummary').addEventListener(\n\t\t\t'click',\n\t\t\tfunction (e: MouseEvent) {\n\t\t\t\te.stopPropagation();\n\t\t\t\tthis.openDropdown();\n\t\t\t}.bind(this),\n\t\t);\n\t}\n\n\thideUserList() {\n\t\treturn (\n\t\t\t(window as any) /* TODO: remove cast after gh#8221 */.ThisIsAMobileApp ||\n\t\t\t(this.map['wopi'].HideUserList !== null &&\n\t\t\t\tthis.map['wopi'].HideUserList !== undefined &&\n\t\t\t\t$.inArray('true', this.map['wopi'].HideUserList) >= 0) ||\n\t\t\t(window.mode.isMobile() &&\n\t\t\t\t$.inArray('mobile', this.map['wopi'].HideUserList) >= 0) ||\n\t\t\t(window.mode.isTablet() &&\n\t\t\t\t$.inArray('tablet', this.map['wopi'].HideUserList) >= 0) ||\n\t\t\t(window.mode.isDesktop() &&\n\t\t\t\t$.inArray('desktop', this.map['wopi'].HideUserList) >= 0)\n\t\t);\n\t}\n\n\tgetSortedUsers(): Generator<[number, User], undefined, undefined> {\n\t\treturn function* (\n\t\t\tthis: UserList,\n\t\t): Generator<[number, User], undefined, undefined> {\n\t\t\tconst self = this.users.get(this.map._docLayer._viewId);\n\n\t\t\tif (this.users.get(this.map._docLayer._viewId) === undefined) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst followedUser = this.getFollowedUser();\n\n\t\t\tif (followedUser !== undefined) {\n\t\t\t\tyield followedUser;\n\t\t\t}\n\n\t\t\tyield [this.map._docLayer._viewId, self];\n\n\t\t\tconst readonlyUsers: [number, User][] = [];\n\n\t\t\tfor (const [viewId, user] of Array.from(this.users.entries()).reverse()) {\n\t\t\t\tconst isSelf = viewId === this.map._docLayer._viewId;\n\t\t\t\tconst isFollowed =\n\t\t\t\t\tfollowedUser !== undefined && viewId === followedUser[0];\n\t\t\t\tif (isSelf || isFollowed) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tif (user.readonly) {\n\t\t\t\t\treadonlyUsers.push([viewId, user]);\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tyield [viewId, user];\n\t\t\t}\n\n\t\t\tyield* readonlyUsers;\n\t\t}.bind(this)();\n\t}\n\n\trenderHeaderAvatars() {\n\t\tconst userListElementBackground = document.getElementById(\n\t\t\t'userListSummaryBackground',\n\t\t);\n\t\tconst userListElement = document.getElementById('userListSummary');\n\n\t\tif (\n\t\t\twindow.mode.isMobile() ||\n\t\t\tthis.hideUserList() ||\n\t\t\tthis.users.size === 1\n\t\t) {\n\t\t\tuserListElement.removeAttribute('accesskey');\n\t\t\tuserListElementBackground.style.display = 'none';\n\t\t\treturn;\n\t\t}\n\n\t\tlet displayCount: number;\n\n\t\tif (this.getFollowedUser() === undefined && !app.isFollowingEditor()) {\n\t\t\tdisplayCount = this.options.userLimitHeader;\n\t\t} else {\n\t\t\tdisplayCount = this.options.userLimitHeaderWhenFollowing;\n\t\t}\n\n\t\tconst avatarUsers = Array.from(this.getSortedUsers()).slice(\n\t\t\t0,\n\t\t\tdisplayCount,\n\t\t);\n\t\tconst followed = this.getFollowedUser();\n\n\t\tuserListElement.setAttribute('accesskey', 'UP');\n\n\t\tuserListElement.replaceChildren(\n\t\t\t...avatarUsers.map(([viewId, user], index) => {\n\t\t\t\tconst img = this.createAvatar(\n\t\t\t\t\tuser.cachedHeaderAvatar,\n\t\t\t\t\tviewId,\n\t\t\t\t\tuser.username,\n\t\t\t\t\tuser.extraInfo,\n\t\t\t\t\tuser.color,\n\t\t\t\t\tdisplayCount - index,\n\t\t\t\t);\n\t\t\t\tuser.cachedHeaderAvatar = img;\n\n\t\t\t\tif (followed !== undefined && followed[0] === viewId) {\n\t\t\t\t\timg.classList.add('following');\n\t\t\t\t} else {\n\t\t\t\t\timg.classList.remove('following');\n\t\t\t\t}\n\n\t\t\t\treturn img;\n\t\t\t}),\n\t\t);\n\n\t\tuserListElementBackground.style.display = 'block';\n\t}\n\n\tupdateUserListCount() {\n\t\tconst count = this.users.size;\n\t\tlet text = '';\n\t\tif (count > 1) {\n\t\t\ttext = this.options.nUsers.replace('%n', count.toString());\n\t\t} else if (count === 1) {\n\t\t\ttext = this.options.oneUser;\n\t\t} else {\n\t\t\ttext = this.options.noUser;\n\t\t}\n\n\t\tif (this.map.mobileTopBar) {\n\t\t\tif (!this.hideUserList() && count > 1)\n\t\t\t\tthis.map.mobileTopBar.showItem('userlist', true);\n\t\t\telse this.map.mobileTopBar.showItem('userlist', false);\n\t\t}\n\t}\n\n\tdeselectUser(e: UserEvent) {\n\t\tconst user = this.users.get(e.viewId);\n\n\t\tif (user === undefined) {\n\t\t\tconsole.debug(\"User doesn't exist: \" + e.viewId);\n\t\t\treturn;\n\t\t}\n\n\t\tthis.renderAll();\n\t}\n\n\tonAddView(e: UserEvent) {\n\t\tlet color;\n\t\tlet username;\n\t\tlet you;\n\n\t\tif (e.viewId === this.map._docLayer._viewId) {\n\t\t\tusername = _('You');\n\t\t\tcolor = 'var(--color-main-text)';\n\t\t\tyou = true;\n\t\t} else {\n\t\t\tusername = e.username;\n\t\t\tcolor = app.LOUtil.rgbToHex(this.map.getViewColor(e.viewId));\n\t\t\tyou = false;\n\t\t}\n\n\t\tthis.users.set(e.viewId, {\n\t\t\tyou: you,\n\t\t\tusername: username,\n\t\t\textraInfo: e.extraInfo,\n\t\t\tcolor: color,\n\t\t\treadonly: e.readonly,\n\t\t});\n\n\t\tthis.showJoinLeaveMessage('join', e.viewId, username, color);\n\n\t\tthis.renderAll();\n\t}\n\n\tonRemoveView(e: UserEvent) {\n\t\tconst user = this.users.get(e.viewId);\n\t\tthis.users.delete(e.viewId);\n\n\t\tif (e.viewId === app.getFollowedViewId()) {\n\t\t\tthis.unfollowAll();\n\t\t}\n\n\t\tif (user !== undefined) {\n\t\t\tthis.showJoinLeaveMessage('leave', e.viewId, user.username, user.color);\n\t\t}\n\n\t\tthis.renderAll();\n\t}\n\n\trenderAll() {\n\t\tthis.updateUserListCount();\n\t\tthis.renderHeaderAvatars();\n\t\tconst popoverElement = document.getElementById('userlist-entries');\n\t\tif (popoverElement) this.renderHeaderAvatarPopover(popoverElement);\n\t\tthis.renderFollowingChip();\n\t}\n\n\tshowTooltip(text: string) {\n\t\tconst userList = $('#userListHeader');\n\t\tif (userList) {\n\t\t\tuserList.get(0).title = text;\n\t\t\tuserList.tooltip({\n\t\t\t\tcontent: text,\n\t\t\t});\n\t\t\tuserList.tooltip('enable');\n\t\t\tuserList.tooltip('open');\n\t\t}\n\t}\n\n\thideTooltip() {\n\t\tconst userList = $('#userListHeader');\n\t\tif (userList) {\n\t\t\tuserList.get(0).title = undefined;\n\t\t\tuserList.tooltip('option', 'disabled', true);\n\t\t}\n\t}\n\n\tshowJoinLeaveMessage(\n\t\ttype: 'join' | 'leave',\n\t\tviewId: number,\n\t\tusername: string, // As the user no longer exists when we are showing a leave message, we can't get this from the viewId\n\t\t_color: string /* TODO: make this display in user colors */,\n\t) {\n\t\tlet message;\n\n\t\tif (viewId === this.map._docLayer._viewId) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (type === 'join') {\n\t\t\tmessage = this.options.userJoinedPopupMessage.replace('{user}', username);\n\t\t} else {\n\t\t\tmessage = this.options.userLeftPopupMessage.replace('{user}', username);\n\t\t}\n\n\t\tconst sanitizer = document.createElement('div');\n\t\tsanitizer.innerText = message;\n\n\t\tthis.showTooltip(sanitizer.innerHTML);\n\n\t\tclearTimeout(this.options.userPopupTimeout);\n\t\tthis.options.userPopupTimeout = setTimeout(() => {\n\t\t\tthis.hideTooltip();\n\t\t}, 3000);\n\t}\n\n\trenderHeaderAvatarPopover(popoverElement: Element) {\n\t\t// Popover rendering\n\t\tconst users = Array.from(this.getSortedUsers());\n\n\t\tconst following = this.getFollowedUser();\n\n\t\tconst userElements = users.map(([viewId, user]) => {\n\t\t\tconst userLabel = L.DomUtil.create('div', 'user-list-item--name');\n\t\t\tuserLabel.innerText = user.username;\n\n\t\t\tconst userFollowingLabel = L.DomUtil.create(\n\t\t\t\t'div',\n\t\t\t\t'user-list-item--following-label',\n\t\t\t);\n\t\t\tuserFollowingLabel.innerText = _('Following');\n\n\t\t\tconst userLabelContainer = L.DomUtil.create(\n\t\t\t\t'div',\n\t\t\t\t'user-list-item--name-container',\n\t\t\t);\n\t\t\tuserLabelContainer.appendChild(userLabel);\n\t\t\tuserLabelContainer.appendChild(userFollowingLabel);\n\n\t\t\tconst listItem = L.DomUtil.create('div', 'user-list-item');\n\t\t\tlistItem.setAttribute('data-view-id', viewId);\n\t\t\tlistItem.setAttribute('role', 'button');\n\n\t\t\tif (following !== undefined && viewId == following[0]) {\n\t\t\t\t$(listItem).addClass('selected-user');\n\t\t\t}\n\n\t\t\tconst avatar = this.createAvatar(\n\t\t\t\tuser.cachedUserListAvatar,\n\t\t\t\tviewId,\n\t\t\t\tuser.username,\n\t\t\t\tuser.extraInfo,\n\t\t\t\tuser.color,\n\t\t\t);\n\t\t\tuser.cachedUserListAvatar = avatar;\n\n\t\t\tlistItem.appendChild(avatar);\n\t\t\tlistItem.appendChild(userLabelContainer);\n\t\t\tlistItem.addEventListener('click', () => {\n\t\t\t\tthis.followUser(viewId);\n\t\t\t\tJSDialog.CloseDropdown('userlist');\n\t\t\t});\n\n\t\t\treturn listItem;\n\t\t});\n\n\t\tconst followEditorWrapper = L.DomUtil.create('div', '');\n\t\tfollowEditorWrapper.id = 'follow-editor';\n\t\tconst followEditorCheckbox = L.DomUtil.create(\n\t\t\t'input',\n\t\t\t'follow-editor-checkbox jsdialog ui-checkbox',\n\t\t\tfollowEditorWrapper,\n\t\t);\n\t\tfollowEditorCheckbox.id = 'follow-editor-checkbox';\n\t\tfollowEditorCheckbox.setAttribute('type', 'checkbox');\n\t\tfollowEditorCheckbox.onchange = (event: Event) => {\n\t\t\t(window as any).editorUpdate(event);\n\t\t\tthis.renderAll();\n\t\t};\n\t\t(followEditorCheckbox as HTMLInputElement).checked =\n\t\t\tapp.isFollowingEditor();\n\n\t\tconst followEditorCheckboxLabel = L.DomUtil.create(\n\t\t\t'label',\n\t\t\t'follow-editor-label',\n\t\t\tfollowEditorWrapper,\n\t\t);\n\t\tfollowEditorCheckboxLabel.innerText = _('Always follow the editor');\n\t\tfollowEditorCheckboxLabel.setAttribute('for', 'follow-editor-checkbox');\n\n\t\tpopoverElement.replaceChildren(...userElements, followEditorWrapper);\n\t}\n\n\trenderFollowingChip() {\n\t\tconst followingChipBackground = document.getElementById(\n\t\t\t'followingChipBackground',\n\t\t);\n\t\tconst followingChip = document.getElementById('followingChip');\n\n\t\tconst following = this.getFollowedUser();\n\n\t\tif (following === undefined && !app.isFollowingEditor()) {\n\t\t\tfollowingChipBackground.style.display = 'none';\n\t\t\treturn;\n\t\t}\n\n\t\tconst topAvatarZIndex = this.options.userLimitHeaderWhenFollowing;\n\n\t\tif (app.isFollowingEditor()) {\n\t\t\tfollowingChip.innerText = this.options.followingChipTextEditor;\n\t\t\tfollowingChip.style.borderColor = 'var(--color-main-text)';\n\t\t} else {\n\t\t\tfollowingChip.innerText = this.options.followingChipTextUser.replace(\n\t\t\t\t'{user}',\n\t\t\t\tfollowing[1].username,\n\t\t\t);\n\t\t\tfollowingChip.style.borderColor = following[1].color;\n\t\t}\n\n\t\tfollowingChip.onclick = () => {\n\t\t\tthis.unfollowAll();\n\t\t\tthis.renderAll();\n\t\t};\n\n\t\tfollowingChip.title = this.options.followingChipTooltipText;\n\t\t$(followingChip).tooltip();\n\n\t\tfollowingChipBackground.style.display = 'block';\n\t\tfollowingChipBackground.style.zIndex = topAvatarZIndex.toString();\n\t}\n}\n\nL.control.userList = function () {\n\treturn new UserList();\n};\n\nL.control.createUserListWidget = function () {\n\t// TODO: this is not interactive\n\tconst userlistElement = L.DomUtil.create('div');\n\tapp.map.userList.renderHeaderAvatarPopover(userlistElement);\n\treturn userlistElement;\n};\n"]}