{"version":3,"file":"Control.FormulaBarJSDialog.js","sourceRoot":"","sources":["../../../../../../../../../../TanhX/online/browser/src/control/Control.FormulaBarJSDialog.js"],"names":[],"mappings":"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","sourcesContent":["/* -*- js-indent-level: 8 -*- */\n/*\n * Copyright the Collabora Online contributors.\n *\n * SPDX-License-Identifier: MPL-2.0\n *\n * This Source Code Form is subject to the terms of the Mozilla Public\n * License, v. 2.0. If a copy of the MPL was not distributed with this\n * file, You can obtain one at http://mozilla.org/MPL/2.0/.\n */\n\n/*\n * JSDialog.FormulaBar - implementation of formulabar toolbar\n */\n\n/* global JSDialog _ _UNO UNOKey */\n\nconst EXPAND_FORMULA_BAR_TEXT = _('Expand Formula Bar');\nconst FUNCTION_WIZARD_TEXT = _('Function Wizard');\nclass FormulaBar {\n\tconstructor(map) {\n\t\tthis.map = map;\n\t\tthis.parentContainer = L.DomUtil.get('formulabar');\n\n\t\tthis.map.on('formulabar', this.onFormulaBar, this);\n\t\tthis.map.on('jsdialogupdate', this.onJSUpdate, this);\n\t\tthis.map.on('jsdialogaction', this.onJSAction, this);\n\t\tthis.map.on('doclayerinit', this.onDocLayerInit, this);\n\n\t\tthis.builder = new L.control.jsDialogBuilder(\n\t\t\t{\n\t\t\t\tmobileWizard: this,\n\t\t\t\tmap: this.map,\n\t\t\t\tcssClass: 'formulabar jsdialog',\n\t\t\t\tcallback: this.callback.bind(this)\n\t\t\t});\n\n\t\tthis.createFormulabar('');\n\t}\n\n\tonRemove() {\n\t\tthis.map.off('formulabar', this.onFormulaBar, this);\n\t\tthis.map.off('jsdialogupdate', this.onJSUpdate, this);\n\t\tthis.map.off('jsdialogaction', this.onJSAction, this);\n\n\t\tthis.map.off('doclayerinit', this.onDocLayerInit, this);\n\t}\n\n\tonDocLayerInit() {\n\t\tvar docType = this.map.getDocType();\n\t\tif (docType == 'spreadsheet')\n\t\t\tthis.showFormulabar();\n\t}\n\n\tcreateFormulabar(text) {\n\t\tif (!window.mode.isMobile()) {\n\t\t\tvar data = [\n\t\t\t\t{\n\t\t\t\t\tid: 'formulabar-buttons-toolbox',\n\t\t\t\t\ttype: 'toolbox',\n\t\t\t\t\tchildren: [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tid: 'functiondialog',\n\t\t\t\t\t\t\ttype: 'toolitem',\n\t\t\t\t\t\t\ttext: FUNCTION_WIZARD_TEXT,\n\t\t\t\t\t\t\tcommand: '.uno:FunctionDialog'\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tid: 'AutoSumMenu:AutoSumMenu',\n\t\t\t\t\t\t\ttype: 'menubutton',\n\t\t\t\t\t\t\tclass: 'AutoSumMenu',\n\t\t\t\t\t\t\tnoLabel: true,\n\t\t\t\t\t\t\ttext: _('Select Function'),\n\t\t\t\t\t\t\tcommand: '.uno:AutoSumMenu'\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tid: 'startformula',\n\t\t\t\t\t\t\ttype: 'customtoolitem',\n\t\t\t\t\t\t\ttext: _('Formula'),\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t// on mobile we show other buttons on the top bar\n\t\t\t\t\t\t\tid: 'acceptformula',\n\t\t\t\t\t\t\ttype: 'customtoolitem',\n\t\t\t\t\t\t\ttext: _('Accept'),\n\t\t\t\t\t\t\tvisible: false\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tid: 'cancelformula',\n\t\t\t\t\t\t\ttype: 'customtoolitem',\n\t\t\t\t\t\t\ttext: _UNO('.uno:Cancel', 'spreadsheet'),\n\t\t\t\t\t\t\tvisible: false\n\t\t\t\t\t\t}\n\t\t\t\t\t]\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tid: 'formulabar-toolbox',\n\t\t\t\t\ttype: 'toolbox',\n\t\t\t\t\tchildren: [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tid: 'sc_input_window',\n\t\t\t\t\t\t\ttype: 'formulabaredit',\n\t\t\t\t\t\t\ttext: text ? text : ''\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tid: 'expand',\n\t\t\t\t\t\t\ttype: 'pushbutton',\n\t\t\t\t\t\t\ttext: EXPAND_FORMULA_BAR_TEXT,\n\t\t\t\t\t\t\tsymbol: 'SPIN_DOWN',\n\t\t\t\t\t\t}]\n\t\t\t\t}];\n\t\t} else {\n\t\t\tvar data = [\n\t\t\t\t{\n\t\t\t\t\tid: 'formulabar-toolbox',\n\t\t\t\t\ttype: 'toolbox',\n\t\t\t\t\tchildren: [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tid: 'functiondialog',\n\t\t\t\t\t\t\ttype: 'toolitem',\n\t\t\t\t\t\t\ttext: FUNCTION_WIZARD_TEXT,\n\t\t\t\t\t\t\tcommand: '.uno:FunctionDialog'\n\t\t\t\t\t\t}, {\n\t\t\t\t\t\t\tid: 'sc_input_window',\n\t\t\t\t\t\t\ttype: 'formulabaredit',\n\t\t\t\t\t\t\ttext: text ? text : ''\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tid: 'expand',\n\t\t\t\t\t\t\ttype: 'pushbutton',\n\t\t\t\t\t\t\ttext: EXPAND_FORMULA_BAR_TEXT,\n\t\t\t\t\t\t\tsymbol: 'SPIN_DOWN',\n\t\t\t\t\t\t}]\n\t\t\t\t}];\n\t\t}\n\n\t\tthis.parentContainer.replaceChildren();\n\t\tthis.builder.build(this.parentContainer, data);\n\t}\n\n\ttoggleMultiLine(input) {\n\t\tif (L.DomUtil.hasClass(input, 'expanded')) {\n\t\t\tL.DomUtil.removeClass(input, 'expanded');\n\t\t\tL.DomUtil.removeClass(this.parentContainer, 'expanded');\n\t\t\tthis.onJSUpdate({\n\t\t\t\tdata: {\n\t\t\t\t\tjsontype: 'formulabar',\n\t\t\t\t\tid: this.builder.windowId,\n\t\t\t\t\t'control_id': 'expand',\n\t\t\t\t\tcontrol: {\n\t\t\t\t\t\tid: 'expand',\n\t\t\t\t\t\ttype: 'pushbutton',\n\t\t\t\t\t\ttext: EXPAND_FORMULA_BAR_TEXT,\n\t\t\t\t\t\tsymbol: 'SPIN_DOWN'\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t} else {\n\t\t\tL.DomUtil.addClass(input, 'expanded');\n\t\t\tL.DomUtil.addClass(this.parentContainer, 'expanded');\n\t\t\tthis.onJSUpdate({\n\t\t\t\tdata: {\n\t\t\t\t\tjsontype: 'formulabar',\n\t\t\t\t\tid: this.builder.windowId,\n\t\t\t\t\t'control_id': 'expand',\n\t\t\t\t\tcontrol: {\n\t\t\t\t\t\tid: 'expand',\n\t\t\t\t\t\ttype: 'pushbutton',\n\t\t\t\t\t\ttext: _('Collapse Formula Bar'),\n\t\t\t\t\t\tsymbol: 'SPIN_UP'\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n\n\tcallback(objectType, eventType, object, data, builder) {\n\t\tif (object.id === 'expand') {\n\t\t\tvar input = this.getInputField();\n\t\t\tif (input)\n\t\t\t\tthis.toggleMultiLine(input);\n\t\t\treturn;\n\t\t}\n\n\t\t// in the core we have DrawingArea not TextView\n\t\tif (object.id.indexOf('sc_input_window') === 0) {\n\t\t\tconst map = builder.map;\n\t\t\tobjectType = 'drawingarea';\n\n\t\t\tif (eventType === 'keypress' && data === UNOKey.RETURN || data === UNOKey.ESCAPE)\n\t\t\t\tmap.focus();\n\t\t\telse if (eventType === 'grab_focus') {\n\t\t\t\tthis.focusField();\n\t\t\t\tmap.onFormulaBarFocus();\n\t\t\t}\n\n\t\t\tmap.userList.followUser(map._docLayer._getViewId(), false);\n\t\t}\n\n\t\tbuilder._defaultCallbackHandler(objectType, eventType, object, data, builder);\n\t}\n\n\tfocusField() {\n\t\tL.DomUtil.addClass(this.getInputField(), 'focused');\n\t}\n\n\tblurField() {\n\t\tL.DomUtil.removeClass(this.getInputField(), 'focused');\n\t}\n\n\tenable() {\n\t\tvar input = this.getInputField();\n\t\tif (!input)\n\t\t\treturn;\n\n\t\tinput.enable();\n\t}\n\n\tdisable() {\n\t\tvar input = this.getInputField();\n\t\tif (!input)\n\t\t\treturn;\n\n\t\tinput.disable();\n\t}\n\n\thasFocus() {\n\t\tvar input = this.getInputField();\n\t\tif (!input)\n\t\t\treturn false;\n\t\treturn L.DomUtil.hasClass(input, 'focused');\n\t}\n\n\tisInEditMode() {\n\t\tvar acceptButton = this.parentContainer.querySelector('#acceptformula');\n\t\tif (acceptButton)\n\t\t\treturn !acceptButton.classList.contains('hidden');\n\t\treturn false;\n\t}\n\n\tshowFormulabar() {\n\t\tif (this.parentContainer)\n\t\t\tthis.parentContainer.style.setProperty('display', 'table-cell');\n\t}\n\n\tshow(action) {\n\t\tthis.showButton(action, true);\n\t}\n\n\thide(action) {\n\t\tthis.showButton(action, false);\n\t}\n\n\tshowButton(action, show) {\n\t\tthis.onJSAction(\n\t\t\t{\n\t\t\t\tdata: {\n\t\t\t\t\tjsontype: 'formulabar',\n\t\t\t\t\tid: this.builder.windowId,\n\t\t\t\t\tdata: {\n\t\t\t\t\t\t'control_id': action,\n\t\t\t\t\t\t'action_type': show ? 'show' : 'hide'\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t}\n\n\tgetControl(controlId) {\n\t\tif (!this.parentContainer)\n\t\t\treturn;\n\n\t\tvar control = this.parentContainer.querySelector('[id=\\'' + controlId + '\\']');\n\t\tif (!control)\n\t\t\twindow.app.console.warn('formulabar update: not found control with id: \"' + controlId + '\"');\n\n\t\treturn control;\n\t}\n\n\tgetInputField() {\n\t\treturn this.getControl('sc_input_window');\n\t}\n\n\tonFormulaBar(e) {\n\t\tvar data = e.data;\n\t\tif (data.jsontype !== 'formulabar')\n\t\t\treturn;\n\n\t\tconsole.warn('formulabar: old style formulabar full update - to fix in core');\n\t\treturn;\n\t}\n\n\tonJSUpdate (e) {\n\t\tvar data = e.data;\n\t\tif (data.jsontype !== 'formulabar')\n\t\t\treturn;\n\n\t\tvar control = this.getControl(data.control.id);\n\t\tif (!control)\n\t\t\treturn;\n\n\t\tvar parent = control.parentNode;\n\t\tif (!parent)\n\t\t\treturn;\n\n\t\tcontrol.style.visibility = 'hidden';\n\t\tvar temporaryParent = L.DomUtil.create('div');\n\t\tthis.builder.build(temporaryParent, [data.control], false);\n\t\tparent.insertBefore(temporaryParent.firstChild, control.nextSibling);\n\t\tL.DomUtil.remove(control);\n\t}\n\n\tonJSAction (e) {\n\t\tvar data = e.data;\n\n\t\tif (data.jsontype !== 'formulabar')\n\t\t\treturn;\n\n\t\tif (!this.builder)\n\t\t\treturn;\n\n\t\tthis.builder.setWindowId(data.id);\n\n\t\tvar innerData = data ? data.data : null;\n\n\t\tif (this.parentContainer.firstChild) {\n\t\t\tvar messageForInputField = innerData && innerData.control_id === 'sc_input_window';\n\t\t\tvar isSetTextMessage = innerData && innerData.action_type === 'setText';\n\t\t\tvar isGrabFocusMessage = innerData && innerData.action_type === 'grab_focus';\n\n\t\t\tif (messageForInputField && isGrabFocusMessage) {\n\t\t\t\tthis.focusField();\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (messageForInputField && isSetTextMessage) {\n\t\t\t\tvar customEditArea = this.getInputField();\n\t\t\t\tif (customEditArea) {\n\t\t\t\t\tvar selection = innerData.selection.split(';');\n\t\t\t\t\tcustomEditArea.setText(innerData.text, selection);\n\t\t\t\t}\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.builder.executeAction(this.parentContainer, innerData);\n\t\t} else\n\t\t\tthis.createFormulabar(innerData.text);\n\t}\n}\n\nJSDialog.FormulaBar = function (map) {\n\treturn new FormulaBar(map);\n};\n"]}