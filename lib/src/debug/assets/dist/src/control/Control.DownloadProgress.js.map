{"version":3,"file":"Control.DownloadProgress.js","sourceRoot":"","sources":["../../../../../../../../../../TanhX/online/browser/src/control/Control.DownloadProgress.js"],"names":[],"mappings":"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","sourcesContent":["/* -*- js-indent-level: 8 -*- */\n/*\n * Copyright the Collabora Online contributors.\n *\n * SPDX-License-Identifier: MPL-2.0\n *\n * This Source Code Form is subject to the terms of the Mozilla Public\n * License, v. 2.0. If a copy of the MPL was not distributed with this\n * file, You can obtain one at http://mozilla.org/MPL/2.0/.\n */\n/*\n * L.Control.DownloadProgress.\n */\n/* global _ $ JSDialog app */\nL.Control.DownloadProgress = L.Control.extend({\n\toptions: {\n\t\tsnackbarTimeout: 20000,\n\t\tuserWarningKey: 'warnedAboutLargeCopy'\n\t},\n\n\tinitialize: function (options) {\n\t\tL.setOptions(this, options);\n\t},\n\n\tonAdd: function (map) {\n\t\tthis._map = map;\n\t\tthis._started = false;\n\t\tthis._complete = false;\n\t\tthis._closed = false;\n\t\tthis._isLargeCopy = false;\n\t\tthis._infinite = true;\n\t},\n\n\t_userAlreadyWarned: function () {\n\t\treturn window.prefs.getBoolean(this.options.userWarningKey);\n\t},\n\n\t_setUserAlreadyWarned: function () {\n\t\twindow.prefs.set(this.options.userWarningKey, true);\n\t},\n\n\t_getDialogTitle: function () {\n\t\treturn _('Download Selection');\n\t},\n\n\t_getLargeCopyPasteMessage: function () {\n\t\treturn this._map._clip._substProductName(\n\t\t\t_('If you want to share large elements outside of {productname} it\\'s necessary to first download them.'));\n\t},\n\n\t_getDownloadProgressDialogId: function () {\n\t\treturn 'copy_paste_download_progress';\n\t},\n\n\t// Step 1. Large copy paste warning\n\n\t_showLargeCopyPasteWarning: function (inSnackbar) {\n\t\tvar modalId = this._getDownloadProgressDialogId();\n\n\t\tvar msg = this._getLargeCopyPasteMessage();\n\t\tvar buttonText = _('Download') + app.util.replaceCtrlAltInMac(' (Ctrl + C)');\n\n\t\tif (inSnackbar) {\n\t\t\tthis._map.uiManager.showSnackbar(\n\t\t\t\tmsg, buttonText, this._onStartDownload.bind(this), this.options.snackbarTimeout);\n\n\t\t\tthis.setupKeyboardShortcutForSnackbar();\n\t\t} else {\n\t\t\tthis._map.uiManager.showInfoModal(modalId, this._getDialogTitle(), msg, '',\n\t\t\t\tbuttonText, this._onStartDownload.bind(this), true, modalId + '-response');\n\n\t\t\tapp.layoutingService.appendLayoutingTask(() => {\n\t\t\t\tthis.setupKeyboardShortcutForDialog(modalId);\n\t\t\t});\n\t\t}\n\t},\n\n\t// Step 2. Download progress\n\n\t_showDownloadProgress: function (inSnackbar) {\n\t\tvar modalId = this._getDownloadProgressDialogId();\n\t\tvar msg = _('Downloading clipboard content');\n\t\tvar buttonText = _('Cancel');\n\n\t\tif (inSnackbar) {\n\t\t\tthis._map.uiManager.showProgressBar(msg, buttonText, this._onClose.bind(this), undefined, undefined, this._infinite);\n\t\t} else if (this._isLargeCopy) {\n\t\t\t// downloading for copy, next: show download complete dialog\n\t\t\tbuttonText = _('Copy') + app.util.replaceCtrlAltInMac(' (Ctrl + C)');\n\n\t\t\tthis._map.uiManager.showProgressBarDialog(modalId, this._getDialogTitle(), msg,\n\t\t\t\tbuttonText, this._onConfirmCopyAction.bind(this), 0, this._onClose.bind(this), this._infinite);\n\n\t\t\tJSDialog.enableButtonInModal(modalId, modalId + '-response', false);\n\t\t} else {\n\t\t\t// downloading for paste, next: dialog will disappear\n\t\t\tthis._map.uiManager.showProgressBarDialog(modalId, this._getDialogTitle(), msg,\n\t\t\t\t'', this._onClose.bind(this), 0, this._onClose.bind(this), this._infinite);\n\t\t}\n\t},\n\n\t_closeDownloadProgressDialog: function () {\n\t\tvar modalId = this._getDownloadProgressDialogId();\n\t\tif (!this._userAlreadyWarned())\n\t\t\tthis._map.uiManager.closeModal(this._map.uiManager.generateModalId(modalId));\n\t},\n\n\t// Step 3. Download complete\n\n\t_showDownloadComplete: function (inSnackbar) {\n\t\tvar modalId = this._getDownloadProgressDialogId();\n\t\tvar snackbarMsg = _('Download completed and ready to be copied to clipboard.');\n\t\tvar dialogMsg = snackbarMsg + ' ' + _('From now on clipboard notifications will discreetly appear at the bottom.');\n\t\tvar buttonText = _('Copy') + app.util.replaceCtrlAltInMac(' (Ctrl + C)');\n\n\t\tif (inSnackbar) {\n\t\t\tthis._map.uiManager.setSnackbarProgress(100);\n\n\t\t\tthis._map.uiManager.showSnackbar(\n\t\t\t\tsnackbarMsg, buttonText, this._onConfirmCopyAction.bind(this), this.options.snackbarTimeout);\n\n\t\t\tsetTimeout(() => {\n\t\t\t\tthis.setupKeyboardShortcutForSnackbar();\n\t\t\t}, 100);\n\t\t} else {\n\t\t\tJSDialog.setMessageInModal(modalId, dialogMsg, '');\n\t\t\tJSDialog.enableButtonInModal(modalId, modalId + '-response', true);\n\t\t\tthis.setupKeyboardShortcutForDialog(modalId);\n\t\t}\n\t},\n\n\t_setupKeyboardShortcutForElement: function (eventTargetId, buttonId) {\n\t\tvar keyDownCallback = function(e) {\n\t\t\tvar modifierKeys = !e.altKey && !e.shiftKey;\n\t\t\tif (L.Browser.mac) {\n\t\t\t\tmodifierKeys = modifierKeys && e.metaKey && !e.ctrlKey;\n\t\t\t} else {\n\t\t\t\tmodifierKeys = modifierKeys && e.ctrlKey && !e.metaKey;\n\t\t\t}\n\t\t\t// CTRL + C / Command + C\n\t\t\tif (modifierKeys && e.key === 'c') {\n\t\t\t\tdocument.getElementById(buttonId).click();\n\t\t\t\te.preventDefault();\n\t\t\t}\n\t\t};\n\t\tif (document.getElementById(eventTargetId))\n\t\t\tdocument.getElementById(eventTargetId).onkeydown = keyDownCallback.bind(this);\n\t},\n\n\tsetupKeyboardShortcutForDialog: function (modalId) {\n\t\tvar dialogId = this._map.uiManager.generateModalId(modalId);\n\t\tvar buttonId = modalId + '-response';\n\t\tthis._setupKeyboardShortcutForElement(dialogId, buttonId);\n\t\tdocument.getElementById(buttonId).focus();\n\t},\n\n\tsetupKeyboardShortcutForSnackbar: function () {\n\t\tthis._setupKeyboardShortcutForElement('snackbar-container', 'button');\n\n\t\t// Snackbars cannot get focus, but we are using it with a button and it requires to be focused. No need to change snackbar imp for now.\n\t\tif (document.getElementById('button'))\n\t\t\tdocument.getElementById('button').focus(); // TODO: This \"button\" id is too generic. It could be something like \"snackbar-button\" etc.\n\t},\n\n\t// isLargeCopy specifies if we are copying and have to explain user the process\n\t// if it is false we do paste so only show download progress\n\tshow: function (isLargeCopy) {\n\t\twindow.app.console.log('DownloadProgress.show');\n\t\t// better to init the following state variables here,\n\t\t// since the widget could be re-used without having been destroyed\n\t\tthis._started = false;\n\t\tthis._complete = false;\n\t\tthis._closed = false;\n\t\tthis._isLargeCopy = isLargeCopy;\n\n\t\tif (isLargeCopy)\n\t\t\tthis._showLargeCopyPasteWarning(this._userAlreadyWarned());\n\t\telse\n\t\t\tthis._showDownloadProgress(this._userAlreadyWarned());\n\t},\n\n\tisClosed: function () {\n\t\treturn this._closed;\n\t},\n\n\tisStarted: function () {\n\t\treturn this._started;\n\t},\n\n\tisComplete: function () {\n\t\treturn this._complete;\n\t},\n\n\tcurrentStatus: function () {\n\t\tif (this._closed)\n\t\t\treturn 'closed';\n\t\tif (!this._started && !this._complete)\n\t\t\treturn 'downloadButton';\n\t\tif (this._started)\n\t\t\treturn 'progress';\n\t\tif (this._complete)\n\t\t\treturn 'confirmPasteButton';\n\t},\n\n\tsetURI: function (uri) {\n\t\t// set up data uri to be downloaded\n\t\tthis._uri = uri;\n\t},\n\n\tsetValue: function (value) {\n\t\tif (this._userAlreadyWarned())\n\t\t\tthis._map.uiManager.setSnackbarProgress(Math.round(value), this._infinite);\n\t\telse {\n\t\t\tvar modalId = this._getDownloadProgressDialogId();\n\t\t\tthis._map.uiManager.setDialogProgress(modalId, Math.round(value), this._infinite);\n\t\t}\n\t},\n\n\t_setProgressCursor: function() {\n\t\t$('#map').css('cursor', 'progress');\n\t},\n\n\t_setNormalCursor: function() {\n\t\t$('#map').css('cursor', 'default');\n\t},\n\n\tstartProgressMode: function() {\n\t\tthis._setProgressCursor();\n\t\tthis._started = true;\n\t\tthis.setValue(0);\n\t},\n\n\t_onStartDownload: function () {\n\t\tif (!this._uri)\n\t\t\treturn;\n\n\t\tthis._showDownloadProgress(this._userAlreadyWarned());\n\n\t\tthis.startProgressMode();\n\t\tthis._download();\n\n\t\treturn true;\n\t},\n\n\t_onUpdateProgress: function (e) {\n\t\tif (e.statusType === 'setvalue') {\n\t\t\tthis.setValue(e.value);\n\t\t}\n\t\telse if (e.statusType === 'finish') {\n\t\t\tthis._onComplete();\n\t\t}\n\t},\n\n\t_onComplete: function () {\n\t\tif (this._complete)\n\t\t\treturn;\n\t\tthis.setValue(100);\n\t\tthis._setNormalCursor();\n\t\tthis._complete = true;\n\t\tthis._started = false;\n\n\t\tif (this._isLargeCopy)\n\t\t\tthis._showDownloadComplete(this._userAlreadyWarned());\n\t\telse\n\t\t\tthis._closeDownloadProgressDialog();\n\t},\n\n\t_onConfirmCopyAction: function () {\n\t\tthis._map._clip.filterExecCopyPaste('.uno:Copy');\n\t\tthis._onClose();\n\t\tthis._setUserAlreadyWarned();\n\n\t\tvar msg = _('Content copied to clipboard');\n\t\tthis._map.uiManager.showSnackbar(msg);\n\t},\n\n\t_onClose: function () {\n\t\tif (this._userAlreadyWarned())\n\t\t\tthis._map.uiManager.closeSnackbar();\n\n\t\tif (this._started)\n\t\t\tthis._closeDownloadProgressDialog();\n\n\t\tthis._started = false;\n\t\tthis._complete = false;\n\t\tthis._closed = true;\n\n\t\tthis._setNormalCursor();\n\t\tthis._cancelDownload();\n\t\tif (this._map)\n\t\t\tthis._map.focus();\n\t},\n\n\t_download: async function () {\n\t\tlet response;\n\t\ttry {\n\t\t\tresponse = await this._map._clip._doAsyncDownload(\n\t\t\t\t'GET', this._uri, null, true,\n\t\t\t\tfunction(progress) { return progress/2; },\n\t\t\t);\n\t\t} catch (error) {\n\t\t\tthis._onClose();\n\t\t\tapp.showAsyncDownloadError(error, _('Download failed'));\n\t\t\treturn;\n\t\t}\n\n\t\twindow.app.console.log('clipboard async download done');\n\t\t// annoying async parse of the blob ...\n\t\tvar reader = new FileReader();\n\t\treader.onload = () => {\n\t\t\tvar text = reader.result;\n\t\t\twindow.app.console.log('async clipboard parse done: ' + text.substring(0, 256));\n\t\t\tlet result = this._map._clip.parseClipboard(text);\n\t\t\tthis._map._clip.setTextSelectionHTML(result['html'], result['plain']);\n\t\t};\n\t\t// TODO: failure to parse ? ...\n\t\treader.readAsText(response);\n\t},\n\n\t_cancelDownload: function () {\n\t\tthis._setNormalCursor();\n\t\tif (!this._started || this._complete)\n\t\t\treturn;\n\t\t// TODO: insert code for cancelling an async download\n\t}\n});\n\nL.control.downloadProgress = function (options) {\n\treturn new L.Control.DownloadProgress(options);\n};\n"]}