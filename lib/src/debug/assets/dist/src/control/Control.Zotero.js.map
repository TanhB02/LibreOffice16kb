{"version":3,"file":"Control.Zotero.js","sourceRoot":"","sources":["../../../../../../../../../../TanhX/online/browser/src/control/Control.Zotero.js"],"names":[],"mappings":"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","sourcesContent":["/* -*- js-indent-level: 8; fill-column: 100 -*- */\n/*\n * Copyright the Collabora Online contributors.\n *\n * SPDX-License-Identifier: MPL-2.0\n *\n * This Source Code Form is subject to the terms of the Mozilla Public\n * License, v. 2.0. If a copy of the MPL was not distributed with this\n * file, You can obtain one at http://mozilla.org/MPL/2.0/.\n */\n\n/*\n * L.Control.Zotero - bibliography dialogs implementation\n */\n\n/* global _ Promise app Set */\nL.Control.Zotero = L.Control.extend({\n\t_cachedURL: [],\n\tcitations: {},\n\titemsPerPage: 15,\n\n\tgetCachedOrFetch: function (url, retry=true) {\n\t\tvar that = this;\n\t\tvar cachedData = this._cachedURL[url];\n\t\tif (cachedData) {\n\t\t\treturn new Promise(function(resolve) {\n\t\t\t\tresolve(cachedData);\n\t\t\t});\n\t\t} else {\n\t\t\treturn fetch(url).then(function (response) {\n\t\t\t\tif (!response.ok && retry)\n\t\t\t\t\treturn that.getCachedOrFetch(url, false);\n\n\t\t\t\tthat._cachedURL[url] = response.json();\n\t\t\t\treturn that._cachedURL[url];\n\t\t\t});\n\t\t}\n\t},\n\n\tsettings: {\n\t\thasBibliography: '0',\n\t\tbibliographyStyleHasBeenSet: '0',\n\t\tstyle: '',\n\t\tlocale: 'en-US',\n\t\tbib: {\n\t\t\tuncited: [],\n\t\t\tomitted: [],\n\t\t\tcustom: []\n\t\t}\n\t},\n\n\tonAdd: function (map) {\n\t\tthis.map = map;\n\t\tthis.enable = false;\n\t\tthis.fetchStyle();\n\t},\n\n\textractItemKeyFromLink: function(link) {\n\t\treturn link.substring(link.lastIndexOf('/')+1);\n\t},\n\n\tonFieldValue: function(fields) {\n\n\t\tvar resetCitations = true;\n\t\tfor (var index = 0; index < fields.length; index++) {\n\t\t\tvar field = fields[index];\n\t\t\tvar fieldString;\n\t\t\tif (this.getFieldType() === 'Field')\n\t\t\t\tfieldString = field.command;\n\t\t\telse if (this.getFieldType() === 'ReferenceMark')\n\t\t\t\tfieldString = field.name;\n\t\t\telse if (this.getFieldType() === 'Bookmark')\n\t\t\t\tfieldString = field.bookmark;\n\n\t\t\tif (fieldString.startsWith('ZOTERO_BIBL') || fieldString.startsWith('ADDIN ZOTERO_BIBL')) {\n\t\t\t\tthis.setBibCustomProperty(fieldString);\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\t// Reset citations only once but avoid resetting it if we only recieved bib fields\n\t\t\tif (resetCitations) {\n\t\t\t\tresetCitations = false;\n\t\t\t\tthis.resetCitation();\n\t\t\t}\n\t\t\tvar values = this.getJSONfromCitationString(fieldString);\n\t\t\tif (!values) {\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tvar that = this;\n\t\t\tthis.citationCluster[values.citationID] = [];\n\t\t\tvar citationString = app.util.trim(values.properties.plainCitation, this.settings.layout.prefix, this.settings.layout.suffix);\n\t\t\tvar citations = citationString.split(this.settings.layout.delimiter);\n\t\t\tvar itemUriList = [];\n\t\t\tvalues.citationItems.forEach(function(item, i) {\n\t\t\t\t//zotero desktop versions do not store keys in cslJSON\n\t\t\t\t//extract key from the item url\n\t\t\t\tvar itemUri = item.uris[0];\n\t\t\t\tvar citationId = that.extractItemKeyFromLink(itemUri);\n\t\t\t\tthat.citationCluster[values.citationID].push(citationId);\n\t\t\t\tthat.citations[citationId] = app.util.trim(citations[i], that.settings.group.prefix, that.settings.group.suffix);\n\t\t\t\tthat.setCitationNumber(that.citations[citationId]);\n\t\t\t\titemUriList.push(itemUri);\n\t\t\t});\n\t\t\tthis.showUnsupportedItemWarning(itemUriList);\n\t\t}\n\n\t\tif (this.pendingCitationUpdate || (this.previousNumberOfFields && this.previousNumberOfFields !== fields.length)) {\n\t\t\tdelete this.pendingCitationUpdate;\n\t\t\tthis.updateCitations(true);\n\t\t}\n\t\tthis.previousNumberOfFields = fields.length;\n\t},\n\n\tgetCitationKeys: function() {\n\t\treturn Object.keys(this.citations);\n\t},\n\n\tgetCitationKeysForBib: function() {\n\t\tvar uncitedKeys = [];\n\t\tvar that = this;\n\t\tthis.settings.bib.uncited.forEach(function(item) {\n\t\t\tuncitedKeys.push(that.extractItemKeyFromLink(item[0]));\n\t\t});\n\n\t\tvar omittedKeys = new Set();\n\t\tthis.settings.bib.omitted.forEach(function(item) {\n\t\t\tomittedKeys.add(that.extractItemKeyFromLink(item[0]));\n\t\t});\n\n\t\tvar allKeys = Object.keys(this.citations).concat(uncitedKeys);\n\n\t\tallKeys = allKeys.filter(function(key) { return !omittedKeys.has(key); });\n\n\t\treturn allKeys;\n\n\t},\n\n\taskForApiKey: function () {\n\t\tthis.map.fire('postMessage', {msgId: 'UI_ZoteroKeyMissing'});\n\t\t// if empty - integrator supports Zotero and will ask user to provide the key\n\t\t// if undefined/null - integrator doesn't have feature yet - show the warning\n\t\tif (this.apiKey !== '')\n\t\t\tthis.map.uiManager.showSnackbar(_('Zotero API key is not configured'));\n\t},\n\n\trefreshUI: function () {\n\t\tthis.map.uiManager.refreshUI();\n\t},\n\n\tupdateUserID: function () {\n\t\tif (this.apiKey === '') {\n\t\t\tthis.refreshUI();\n\t\t\treturn;\n\t\t}\n\n\t\tvar that = this;\n\t\tfetch('https://api.zotero.org/keys/' + this.apiKey)\n\t\t\t.then(function (response) { return response.json(); })\n\t\t\t.then(function (data) {\n\t\t\t\tthat.userID = data.userID;\n\t\t\t\tthat.enable = !!that.userID;\n\t\t\t\tthat.refreshUI();\n\t\t\t\tthat.updateGroupIdList();\n\t\t\t}, function () { that.map.uiManager.showSnackbar(_('Zotero API key is incorrect')); });\n\t},\n\n\tupdateGroupIdList: function() {\n\t\tthis.groupIdList = new Set();\n\t\tvar that = this;\n\t\tthis.getCachedOrFetch('https://api.zotero.org/users/' + this.userID + '/groups?v=3&key=' + this.apiKey)\n\t\t\t.then(function (data) {\n\t\t\t\tfor (var i = 0; i < data.length; i++) {\n\t\t\t\t\tthat.groupIdList.add(data[i].data.id.toString());\n\t\t\t\t}\n\t\t\t}, function () {});\n\t},\n\n\tshowUnsupportedItemWarning: function(uriList) {\n\t\tif (this.showUnsupportedWarning === false || !this.userID)\n\t\t\treturn;\n\n\t\tfor (var i in uriList) {\n\t\t\tvar uriObject = new URL(uriList[i]);\n\n\t\t\tvar catagory = uriObject.pathname.startsWith('/groups/') ? '/groups/' : '/users/';\n\n\t\t\tvar id = uriObject.pathname.substring(catagory.length);\n\t\t\tid = id.substring(0, id.indexOf('/'));\n\t\t\tif (!this.groupIdList.has(id) && id !== this.userID.toString()) {\n\t\t\t\tthis.showUnsupportedWarning = false;\n\t\t\t\tthis.map.uiManager.showInfoModal('zoterounreachablewarn', _('Zotero Warning'),\n\t\t\t\t\t_('The document contains some citations which may be unreachable through web API. It may cause some problems while editing citations or bibliography.'),\n\t\t\t\t\tnull, _('Close'), function() {});\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\t},\n\n\tgetTopBarJSON: function () {\n\t\treturn {\n\t\t\tid: 'ZoteroDialog-search-container',\n\t\t\ttype: 'container',\n\t\t\tlayoutstyle: 'end',\n\t\t\tchildren: [\n\t\t\t\t{\n\t\t\t\t\tid: 'zoterorefresh-buttonbox',\n\t\t\t\t\ttype: 'buttonbox',\n\t\t\t\t\tleftaligned: 'true',\n\t\t\t\t\tchildren: [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ttype: 'pushbutton',\n\t\t\t\t\t\t\tid: 'zoterorefresh',\n\t\t\t\t\t\t\ttext: _('Refresh')\n\t\t\t\t\t\t}\n\t\t\t\t\t],\n\t\t\t\t\tvertical: false,\n\t\t\t\t\tlayoutstyle: 'end'\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\ttype: 'edit',\n\t\t\t\t\tid: 'zoterosearch',\n\t\t\t\t\tplaceholder: _('Search'),\n\t\t\t\t\ttext: ''\n\t\t\t\t}\n\t\t\t]\n\t\t};\n\t},\n\n\tgetMainControlsJSON: function (showCategories) {\n\t\treturn {\n\t\t\tid: 'ZoteroDialog-content',\n\t\t\ttype: 'container',\n\t\t\tchildren: [\n\t\t\t\t{\n\t\t\t\t\tid: 'ZoteroDialog-main',\n\t\t\t\t\ttype: 'container',\n\t\t\t\t\tchildren: [\n\t\t\t\t\t\t(showCategories) ? {\n\t\t\t\t\t\t\ttype: 'treelistbox',\n\t\t\t\t\t\t\tid: 'zoterocategory',\n\t\t\t\t\t\t\tenabled: false,\n\t\t\t\t\t\t\tentries: this.getDefaultCategories()\n\t\t\t\t\t\t} : {},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ttype: 'treelistbox',\n\t\t\t\t\t\t\tid: 'zoterolist',\n\t\t\t\t\t\t\tenabled: false,\n\t\t\t\t\t\t\tentries: [ { columns: [ { text: _('Loading...') } ] } ]\n\t\t\t\t\t\t}\n\t\t\t\t\t]\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tid: 'ZoteroDialog-buttonbox',\n\t\t\t\t\ttype: 'buttonbox',\n\t\t\t\t\tchildren: [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tid: 'previous',\n\t\t\t\t\t\t\ttype: 'pushbutton',\n\t\t\t\t\t\t\ttext: _('Previous'),\n\t\t\t\t\t\t\tenabled: false,\n\t\t\t\t\t\t\tvisible: false\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tid: 'pagelabel',\n\t\t\t\t\t\t\ttype: 'fixedtext',\n\t\t\t\t\t\t\ttext: '1/1',\n\t\t\t\t\t\t\tvisible: false\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tid: 'next',\n\t\t\t\t\t\t\ttype: 'pushbutton',\n\t\t\t\t\t\t\ttext: _('Next'),\n\t\t\t\t\t\t\tvisible: false\n\n\t\t\t\t\t\t}\n\t\t\t\t\t],\n\t\t\t\t\tvertical: false,\n\t\t\t\t\tlayoutstyle: 'start'\n\t\t\t\t}\n\t\t\t],\n\t\t\tvertical: true\n\t\t};\n\t},\n\n\tgetOptionsJSON: function () {\n\t\tvar that = this;\n\t\treturn {\n\t\t\tid: 'ZoteroDialog-locale-container',\n\t\t\ttype: 'container',\n\t\t\tchildren: [\n\t\t\t\t{\n\t\t\t\t\ttype: 'fixedtext',\n\t\t\t\t\tid: 'zoterolocale-label',\n\t\t\t\t\ttext: _('Language:')\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tid: 'zoterolocale',\n\t\t\t\t\ttype: 'combobox',\n\t\t\t\t\tentries: Array.from(Object.keys(this.availableLanguages), function(langCode) {return that.availableLanguages[langCode][0];}),\n\t\t\t\t\tselectedCount: '1',\n\t\t\t\t\tselectedEntries: [\n\t\t\t\t\t\tObject.keys(this.availableLanguages).indexOf(this.settings.locale)\n\t\t\t\t\t],\n\t\t\t\t\tenabled: false\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\ttype: 'fixedtext',\n\t\t\t\t\tid: 'zoterotype-label',\n\t\t\t\t\ttext: _('Store as:')\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tid: 'zoterotype',\n\t\t\t\t\ttype: 'combobox',\n\t\t\t\t\tentries: [\n\t\t\t\t\t\t_('Fields'),\n\t\t\t\t\t\t_('Bookmarks')\n\t\t\t\t\t],\n\t\t\t\t\tselectedCount: '1',\n\t\t\t\t\tselectedEntries: [\n\t\t\t\t\t\tthis.getFieldType() === 'Bookmark' || this.settings.wrapper === 'Endnote' ? 1 : 0\n\t\t\t\t\t],\n\t\t\t\t\tenabled: false\n\t\t\t\t}\n\t\t\t]\n\t\t};\n\t},\n\n\tdialogSetup: function (title, showCategories, showOptions) {\n\t\tvar data = {\n\t\t\tid: 'ZoteroDialog',\n\t\t\tdialogid: 'ZoteroDialog',\n\t\t\ttype: 'dialog',\n\t\t\ttext: title,\n\t\t\ttitle: title,\n\t\t\tjsontype: 'dialog',\n\t\t\tresponses: [\n\t\t\t\t{\n\t\t\t\t\tid: 'ok',\n\t\t\t\t\tresponse: 1\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tid: 'cancel',\n\t\t\t\t\tresponse: 0\n\t\t\t\t},\n\t\t\t],\n\t\t\tchildren: [\n\t\t\t\t{\n\t\t\t\t\tid: 'ZoteroDialog-mainbox',\n\t\t\t\t\ttype: 'container',\n\t\t\t\t\tvertical: true,\n\t\t\t\t\tchildren: [\n\t\t\t\t\t\tthis.getTopBarJSON(),\n\t\t\t\t\t\tthis.getMainControlsJSON(showCategories),\n\t\t\t\t\t\t(showOptions) ? this.getOptionsJSON() : {},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tid: 'ZoteroDialog-buttonbox',\n\t\t\t\t\t\t\ttype: 'buttonbox',\n\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tid: 'cancel',\n\t\t\t\t\t\t\t\t\ttype: 'pushbutton',\n\t\t\t\t\t\t\t\t\ttext: _('Cancel'),\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tid: 'ok',\n\t\t\t\t\t\t\t\t\ttype: 'pushbutton',\n\t\t\t\t\t\t\t\t\ttext: _('OK'),\n\t\t\t\t\t\t\t\t\tenabled: false,\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\tvertical: false,\n\t\t\t\t\t\t\tlayoutstyle: 'end'\n\t\t\t\t\t\t}\n\t\t\t\t\t]\n\t\t\t\t},\n\t\t\t],\n\t\t};\n\n\t\tthis.items = []; // zoterolist content\n\t\tthis.categories = this.getDefaultCategories(); // zoterocategory content\n\n\t\tthis.groups = [];\n\t\tthis.collections = [];\n\n\t\tvar dialogBuildEvent = {\n\t\t\tdata: data,\n\t\t\tcallback: this._onAction.bind(this),\n\t\t};\n\n\n\t\tthis.map.fire(window.mode.isMobile() ? 'mobilewizard' : 'jsdialog', dialogBuildEvent);\n\n\t\treturn this;\n\t},\n\n\tupdateControl: function (controlJSON) {\n\t\tthis.map.fire('jsdialogupdate', {\n\t\t\tdata: {\n\t\t\t\tjsontype: 'dialog',\n\t\t\t\taction: 'update',\n\t\t\t\tid: 'ZoteroDialog',\n\t\t\t\tcontrol: controlJSON,\n\t\t\t},\n\t\t\tcallback: this._onAction.bind(this)\n\t\t});\n\t},\n\n\tenableDialogOKButton: function() {\n\t\tthis.updateControl(\n\t\t\t{\n\t\t\t\tid: 'ok',\n\t\t\t\ttype: 'pushbutton',\n\t\t\t\ttext: _('OK'),\n\t\t\t\t'has_default': true\n\t\t\t}\n\t\t);\n\t},\n\n\tenableDialogLanguageCombobox: function(locale) {\n\t\tvar that = this;\n\t\tthis.updateControl(\n\t\t\t{\n\t\t\t\t\tid: 'zoterolocale',\n\t\t\t\t\ttype: 'combobox',\n\t\t\t\t\tentries: Array.from(Object.keys(this.availableLanguages), function(langCode) {return that.availableLanguages[langCode][0];}),\n\t\t\t\t\tselectedCount: '1',\n\t\t\t\t\tselectedEntries: [\n\t\t\t\t\t\tObject.keys(this.availableLanguages).indexOf(locale)\n\t\t\t\t\t],\n\t\t\t\t});\n\t},\n\n\tenableDialogFieldTypeCombobox: function(citationFormat) {\n\t\tvar entries = [];\n\t\tif (citationFormat === 'note') {\n\t\t\tentries = [_('Footnotes'), _('Endnotes')];\n\t\t} else {\n\t\t\tentries = [_('Fields'), _('Bookmarks')];\n\t\t}\n\t\tthis.updateControl({\n\t\t\t\t\tid: 'zoterotype',\n\t\t\t\t\ttype: 'combobox',\n\t\t\t\t\tentries: entries,\n\t\t\t\t\tselectedCount: '1',\n\t\t\t\t\tselectedEntries: [\n\t\t\t\t\t\tthis.getFieldType() === 'Bookmark' || this.settings.wrapper === 'Endnote' ? 1 : 0\n\t\t\t\t\t],\n\t\t\t\t\tenabled: !(this.citations && Object.keys(this.citations).length)\n\t\t\t\t});\n\t},\n\n\tenableDisableNextPrevious: function(hide) {\n\t\tthis.updateControl({\n\t\t\tid: 'previous',\n\t\t\ttype: 'pushbutton',\n\t\t\ttext: _('Previous'),\n\t\t\tenabled: this._currentPage > 0,\n\t\t\tvisible: hide ? false : true\n\t\t});\n\n\t\tthis.updateControl({\n\t\t\tid: 'pagelabel',\n\t\t\ttype: 'fixedtext',\n\t\t\ttext: (this._currentPage + 1) + '/' + this.totalPages,\n\t\t\tvisible: hide ? false : true\n\t\t});\n\n\t\tthis.updateControl({\n\t\t\tid: 'next',\n\t\t\ttype: 'pushbutton',\n\t\t\ttext: _('Next'),\n\t\t\tenabled: this._currentPage < this.totalPages - 1,\n\t\t\tvisible: hide ? false : true\n\t\t});\n\t},\n\n\tupdateList: function(headerArray, failText) {\n\t\tif (this.items.length !== 0) {\n\t\t\treturn {\n\t\t\t\tdata: {\n\t\t\t\t\tjsontype: 'dialog',\n\t\t\t\t\taction: 'update',\n\t\t\t\t\tid: 'ZoteroDialog',\n\t\t\t\t\tcontrol: {\n\t\t\t\t\t\tid: 'zoterolist',\n\t\t\t\t\t\ttype: 'treelistbox',\n\t\t\t\t\t\theaders: headerArray.map(\n\t\t\t\t\t\t\tfunction(item) { return { text: item }; }\n\t\t\t\t\t\t),\n\t\t\t\t\t\tentries: this.items,\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\tcallback: this._onAction.bind(this)\n\t\t\t};\n\t\t} else {\n\t\t\treturn {\n\t\t\t\tdata: {\n\t\t\t\t\tjsontype: 'dialog',\n\t\t\t\t\taction: 'update',\n\t\t\t\t\tid: 'ZoteroDialog',\n\t\t\t\t\tcontrol: {\n\t\t\t\t\t\tid: 'zoterolist',\n\t\t\t\t\t\ttype: 'treelistbox',\n\t\t\t\t\t\tentries: [ { columns: [ { text: failText } ] } ]\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t};\n\t\t}\n\t},\n\n\tgetZoteroItemQuery: function(limit, start) {\n\t\tvar result = '?v=3&key=' + this.apiKey + '&include=data,citation,csljson&style=' + this.settings.style + '&locale=' + this.settings.locale;\n\n\t\tif (limit)\n\t\t\tresult += '&limit=' + limit;\n\t\tif (start)\n\t\t\tresult += '&start=' + start;\n\t\treturn result;\n\t},\n\n\t_getDefaultSubCollections: function () {\n\t\treturn [\n\t\t\t{ columns: [ { text: _('My Publications') } ], row: 'https://api.zotero.org/users/' + this.userID + '/publications/items/top' + this.getZoteroItemQuery() },\n\t\t];\n\t},\n\n\tgetDefaultCategories: function () {\n\t\treturn [\n\t\t\t{ columns: [{ text: _('My Library') } ], row: 'https://api.zotero.org/users/' + this.userID + '/items/top' + this.getZoteroItemQuery(this.itemsPerPage, 0), children: this._getDefaultSubCollections() },\n\t\t\t{ columns: [{ text: _('Group Libraries')}] }];\n\t},\n\n\tupdateCategories: function() {\n\t\tthis.updateControl({\n\t\t\tid: 'zoterocategory',\n\t\t\ttype: 'treelistbox',\n\t\t\tentries: this.categories,\n\t\t});\n\t},\n\n\tresetCitation: function() {\n\t\tthis.citationCluster = {};\n\t\tthis.citations = {};\n\t\tdelete this.settings.citationNumber;\n\t\tif (this.getFieldType() === 'Bookmark')\n\t\t\tthis.bookmarksOrder = [];\n\t},\n\n\tsetCitationNumber: function(number) {\n\t\tif (this.settings.citationFormat !== 'numeric')\n\t\t\treturn;\n\n\t\tif (!this.settings.citationNumber)\n\t\t\tthis.settings.citationNumber = 1;\n\n\t\tthis.settings.citationNumber = this.settings.citationNumber <= parseInt(number) ? parseInt(number) + 1 : this.settings.citationNumber;\n\n\t},\n\n\tgetCitationText: function(citationId, text) {\n\t\tif (this.citations && this.citations[citationId])\n\t\t\treturn this.citations[citationId];\n\n\t\tif (this.settings.citationFormat === 'numeric') {\n\t\t\tif (!this.settings.citationNumber)\n\t\t\t\tthis.settings.citationNumber = 1;\n\t\t\tthis.citations[citationId] = this.settings.citationNumber++;\n\t\t} else {\n\t\t\tthis.citations[citationId] = app.util.trim(text, this.settings.layout.prefix, this.settings.layout.suffix);\n\t\t}\n\n\t\treturn this.settings.group.prefix + this.citations[citationId] + this.settings.group.suffix;\n\t},\n\n\thandleCitationText: function(citationItems) {\n\t\t//Some citations have style so trying to change just inner most text without affecting other html\n\t\tvar citationString = '';\n\t\tvar citationNode = new DOMParser().parseFromString(citationItems[0].citation, 'text/html').body;\n\n\t\tvar that = this;\n\t\tcitationItems.forEach(function(item) {\n\t\t\tvar itemHTML = new DOMParser().parseFromString(item.citation, 'text/html').body;\n\t\t\t// last-child works here only because its a single chain of nodes\n\t\t\tvar innerMostNode = itemHTML.querySelector('*:last-child');\n\n\t\t\tvar keys = item['key'] ? [item['key']]\n\t\t\t\t: Object.keys(item['citationItems']).map(function(citationitem) {return that.extractItemKeyFromLink(item['citationItems'][citationitem].id);});\n\t\t\tkeys.forEach(function(key) {\n\t\t\t\tcitationString += innerMostNode ? that.getCitationText(key, innerMostNode.textContent)\n\t\t\t\t\t: that.getCitationText(key, item.citation.toString());\n\t\t\t\tcitationString += that.settings.layout.delimiter;\n\t\t\t});\n\t\t});\n\n\t\tcitationString = this.settings.layout.prefix + app.util.trimEnd(citationString, this.settings.layout.delimiter) + this.settings.layout.suffix;\n\t\t// last-child works here only because its a single chain of nodes\n\t\tvar innerText = citationNode.querySelector('*:last-child');\n\t\tif (!innerText)\n\t\t\tcitationNode.textContent = citationString;\n\t\telse\n\t\t\tinnerText.textContent = citationString;\n\t\treturn citationNode;\n\t},\n\n\tgetJSONfromCitationString: function(string) {\n\t\tif (!string)\n\t\t\treturn {};\n\n\t\tvar firstBraceIndex = string.indexOf('{');\n\t\tvar lastBraceIndex = string.lastIndexOf('}');\n\n\t\tif (firstBraceIndex < 0 || lastBraceIndex > string.length || lastBraceIndex < 0)\n\t\t\treturn {};\n\n\t\tvar values = JSON.parse(string.substring(firstBraceIndex, lastBraceIndex+1));\n\t\tif (values['properties']['formattedCitation'])\n\t\t\tvalues.citation = values['properties']['formattedCitation']; // comes in handy to avoid multiple property checking latter\n\t\treturn values;\n\t},\n\n\tgetCitationJSONString: function(items) {\n\t\tvar resultJSON = {};\n\t\tresultJSON['citationID'] = app.util.randomString(10);\n\n\t\tvar citationNode = this.handleCitationText(items);\n\n\t\tvar properties = {\n\t\t\tformattedCitation: citationNode.innerHTML,\n\t\t\tplainCitation: citationNode.textContent,\n\t\t\tnoteIndex: '0'\n\t\t};\n\n\t\tresultJSON['properties'] = properties;\n\n\t\tresultJSON['citationItems'] = [];\n\n\t\titems.forEach(function(item) {\n\t\t\tif (item['citationItems']) {\n\t\t\t\tresultJSON['citationItems'] = resultJSON['citationItems'].concat(item['citationItems']);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tvar citationItems = {\n\t\t\t\tid: item['csljson'].id,\n\t\t\t\turis: Object.keys(item['links']).map(function(link) {return item['links'][link]['href'];}),\n\t\t\t\titemData: item['csljson']\n\t\t\t};\n\t\t\tresultJSON['citationItems'].push(citationItems);\n\t\t});\n\n\n\t\tresultJSON['schema'] = 'https://raw.githubusercontent.com/citation-style-language/schema/master/schemas/input/csl-citation.json';\n\n\t\treturn {jsonString: JSON.stringify(resultJSON),\n\t\t\tcitationString: properties.formattedCitation};\n\t},\n\n\tfillCategories: function () {\n\t\tthis.categories = this.getDefaultCategories().slice();\n\t\tthis.categories[0].children = this.categories[0].children.concat(this.collections.slice());\n\t\tthis.categories[1].children = this.groups.slice();\n\t},\n\n\t// columns: Array of details which will be displayed in the dialog\n\t// entryData: Object containing extra details related to the entry\n\tcreateEntry: function (index, columns, entryData, hasIcon) {\n\t\tif (hasIcon) {\n\t\t\tvar type = entryData.itemType;\n\t\t\ttype = type.toUpperCase()[0] + type.substr(1);\n\t\t\tvar icon = 'zotero' + type;\n\t\t\tvar firstColumn = [ { collapsed: icon, expanded: icon } ];\n\t\t} else {\n\t\t\tfirstColumn = [];\n\t\t}\n\t\tthis.items.push(Object.assign({ 'columns': firstColumn.concat(columns.map(\n\t\t\tfunction (item) {\n\t\t\t\treturn { text: item };\n\t\t\t}\n\t\t)), row: index, state: (this.dialogType === 'itemlist') ? false : undefined,\n\t\t}, entryData));\n\t},\n\n\tfillItems: function (items) {\n\t\tvar index = 0;\n\t\tfor (var iterator = 0; iterator < items.length; ++iterator) {\n\t\t\tif (items[iterator].data.itemType === 'note')\n\t\t\t\tcontinue;\n\n\t\t\tvar creatorArray = [];\n\t\t\tfor (var creator = 0; items[iterator].data.creators && creator < items[iterator].data.creators.length; ++creator) {\n\t\t\t\tcreatorArray.push(items[iterator].data.creators[creator].name ?\n\t\t\t\t\titems[iterator].data.creators[creator].name:\n\t\t\t\t\titems[iterator].data.creators[creator].firstName + ' ' + items[iterator].data.creators[creator].lastName);\n\t\t\t}\n\t\t\tvar creatorString = creatorArray.join(', ');\n\t\t\tthis.createEntry(index++,\n\t\t\t\t[items[iterator].csljson.title, creatorString, items[iterator].data.date ? items[iterator].data.date : items[iterator].data.dateDecided],\n\t\t\t\t{type: 'item', itemType: items[iterator].data.itemType, item: items[iterator]},\n\t\t\t\ttrue\n\t\t\t);\n\t\t}\n\t},\n\n\tfillStyles: function (styles) {\n\t\tvar styleToSelect = this.settings.style;\n\t\tif (this.settings.style === '')\n\t\t\tstyleToSelect = window.prefs.get('Zotero_LastUsedStyle', '');\n\n\t\tfor (var iterator = 0; iterator < styles.length; ++iterator) {\n\t\t\tthis.createEntry(iterator, [styles[iterator].title],\n\t\t\t\tObject.assign({name: styles[iterator].name, type: 'style'},\n\t\t\t\t\tstyleToSelect === styles[iterator].name ? {selected: true} : null));\n\t\t}\n\t},\n\n\tfillNotes: function (items, notesCount) {\n\t\tvar index = notesCount;\n\t\tfor (var iterator = 0; iterator < items.length; ++iterator) {\n\t\t\tif (items[iterator].data.itemType !== 'note')\n\t\t\t\tcontinue;\n\n\t\t\tvar dummyNode = L.DomUtil.create('div');\n\t\t\tdummyNode.innerHTML = items[iterator].data.note;\n\t\t\tvar note = dummyNode.innerText.replaceAll('\\n', ' ');\n\n\t\t\tthis.createEntry(index++,\n\t\t\t\t[note],\n\t\t\t\t{type: 'note', itemType: items[iterator].data.itemType, item: items[iterator]},\n\t\t\t\ttrue\n\t\t\t);\n\t\t}\n\t\treturn index;\n\t},\n\n\tshowItemList: function () {\n\t\tif (!this.enable) {\n\t\t\tthis.askForApiKey();\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this.settings.style) {\n\t\t\tthis.pendingAction = this.showItemList;\n\t\t\tthis.showStyleList();\n\t\t\treturn;\n\t\t}\n\t\tvar that = this;\n\t\tthis.dialogType = 'itemlist';\n\n\t\tthat.dialogSetup(_('My Library'), true);\n\t\tthat.updateCategories();\n\n\t\tthis.getCachedOrFetch('https://api.zotero.org/users/' + this.userID + '/groups?v=3&key=' + this.apiKey)\n\t\t\t.then(function (data) {\n\t\t\t\tfor (var i = 0; i < data.length; i++) {\n\t\t\t\t\tthat.groups.push(\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tcolumns: [ { text: data[i].data.name } ],\n\t\t\t\t\t\t\tid: data[i].data.id,\n\t\t\t\t\t\t\trow: data[i].links.self.href + '/items/top' + that.getZoteroItemQuery()\n\t\t\t\t\t\t});\n\t\t\t\t\tthat.fillCategories();\n\t\t\t\t\tthat.updateCategories();\n\t\t\t\t}\n\t\t\t}, function () {\n\t\t\t\tthat.map.uiManager.showSnackbar(_('Failed to load groups'));\n\t\t\t});\n\n\t\tthis.getCachedOrFetch('https://api.zotero.org/users/' + this.userID + '/collections' + this.getZoteroItemQuery())\n\t\t\t.then(function (data) {\n\t\t\t\tfor (var i = 0; i < data.length; i++) {\n\t\t\t\t\tthat.collections.push(\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tcolumns: [ { text: data[i].data.name } ],\n\t\t\t\t\t\t\tid: data[i].data.key,\n\t\t\t\t\t\t\trow: data[i].links.self.href + '/items/top' + that.getZoteroItemQuery(),\n\t\t\t\t\t\t\tchildren: [ { text: '<dummy>' } ],\n\t\t\t\t\t\t\tondemand: true\n\t\t\t\t\t\t});\n\t\t\t\t\tthat.fillCategories();\n\t\t\t\t\tthat.updateCategories();\n\t\t\t\t}\n\t\t\t}, function () {\n\t\t\t\tthat.map.uiManager.showSnackbar(_('Failed to load collections'));\n\t\t\t});\n\n\t\t\tthis.totalItems = -1;\n\t\t\tthis.totalPages = -1;\n\t\t\tthis._currentPage = 0;\n\t\t\tfetch('https://api.zotero.org/users/'+ this.userID +'/items/top?v=3&key=' + this.apiKey + '&limit=1') //find total number of entries\n\t\t\t.then(function (response) {\n\t\t\t\tthat.map.uiManager.showProgressBar(_(\"Loading references\"), undefined, undefined, 10000);\n\t\t\t\tthat.showItemsForUrl('https://api.zotero.org/users/' + that.userID + '/items/top' + that.getZoteroItemQuery(that.itemsPerPage, 0), true);\n\n\t\t\t\tthat.totalItems = parseInt(response.headers.get('Total-Results'));\n\t\t\t\tthat.totalPages = Math.ceil(that.totalItems/that.itemsPerPage);\n\t\t\t\tthat._currentPage = 0;\n\t\t\t\tthat.enableDisableNextPrevious();\n\t\t\t\tthat.asyncItemLoading();\n\t\t\t});\n\t},\n\n\tasyncItemLoading: function() {\n\t\tvar that = this;\n\t\tvar pagesLoaded = 1;\n\t\tfor (var i = this.itemsPerPage; i < that.totalItems; i += this.itemsPerPage) {\n\t\t\tthat.getCachedOrFetch('https://api.zotero.org/users/' + that.userID + '/items/top' + that.getZoteroItemQuery(that.itemsPerPage, i), true)\n\t\t\t.then(function () {\n\t\t\t\t++pagesLoaded;\n\t\t\t\tvar loadPct = (pagesLoaded/that.totalPages)*100;\n\t\t\t\tthat.map.uiManager.setSnackbarProgress(loadPct);\n\t\t\t\tif (pagesLoaded === that.totalPages)\n\t\t\t\t\tthat.map.uiManager.closeSnackbar();\n\t\t\t});\n\t\t}\n\t},\n\n\tshowStyleList: function() {\n\t\tif (!this.enable) {\n\t\t\tthis.askForApiKey();\n\t\t\treturn;\n\t\t}\n\n\t\tvar that = this;\n\t\tthis.dialogType = 'stylelist';\n\t\tthis.dialogSetup(_('Citation Style'), false, true);\n\t\tthis.getCachedOrFetch('https://www.zotero.org/styles-files/styles.json')\n\t\t\t.then(function (data) {\n\t\t\t\tthat.fillStyles(data);\n\n\t\t\t\tvar dialogUpdateEvent = that.updateList([_('Styles')],_('An error occurred while fetching style list'));\n\n\t\t\t\tif (window.mode.isMobile()) window.mobileDialogId = dialogUpdateEvent.data.id;\n\t\t\t\tthat.map.fire('jsdialogupdate', dialogUpdateEvent);\n\t\t\t\tvar styleToBeSelected = (that.settings.style && that.settings.style !== '') ? that.settings : {name: window.prefs.get('Zotero_LastUsedStyle', '')};\n\t\t\t\tif (styleToBeSelected !== '')\n\t\t\t\t\tthat.checkStyleTypeAndEnableOK(styleToBeSelected);\n\t\t\t}, function () {\n\t\t\t\tthat.map.uiManager.showSnackbar(_('Failed to load styles'));\n\t\t\t});\n\t},\n\n\tfetchStyle: function() {\n\t\tthis.fetchCustomProperty('ZOTERO_PREF_');\n\t},\n\n\tfetchCustomProperty: function(prefix) {\n\t\tapp.socket.sendMessage('commandvalues command=.uno:SetDocumentProperties?namePrefix=' + prefix);\n\t},\n\n\tsetFetchedCitationFormat: function(style) {\n\t\tif (!style)\n\t\t\tstyle = this.settings.style;\n\n\t\tvar that = this;\n\t\tfetch('https://www.zotero.org/styles/' + style)\n\t\t\t.then(function (response) { return response.text(); })\n\t\t\t.then(function (html) {\n\t\t\t\tvar csl = new DOMParser().parseFromString(html, 'text/xml');\n\t\t\t\tvar categories = csl.getElementsByTagName('category');\n\t\t\t\tfor (var i = 0; i < categories.length; i++) {\n\t\t\t\t\tif (categories[i].getAttribute('citation-format')) {\n\t\t\t\t\t\tthat.settings.citationFormat = categories[i].getAttribute('citation-format');\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tvar citation = csl.getElementsByTagName('citation')[0];\n\n\t\t\t\tif (citation) {\n\t\t\t\t\tthat.setCitationLayout(citation);\n\t\t\t\t\tthat.updateCitations(true);\n\t\t\t\t\tif (that.settings.bibliographyStyleHasBeenSet === '1') {\n\t\t\t\t\t\tthat.updateBibList();\n\t\t\t\t\t\tthat.handleInsertBibliography();\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tvar link = csl.getElementsByTagName('link');\n\t\t\t\t\tfor (var i = 0; i < link.length; i++) {\n\t\t\t\t\t\tif (link[i].getAttribute('rel') === 'independent-parent') {\n\t\t\t\t\t\t\tthat.setFetchedCitationFormat(that.extractItemKeyFromLink(link[i].getAttribute('href')));\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t},\n\n\t/// returns found languageNames key\n\tmakeLanguageAvailable: function (locale) {\n\t\tvar ret = null;\n\t\tvar languages = Object.keys(this.languageNames).filter(\n\t\t\tfunction (value) { return value.indexOf(locale) >= 0; });\n\t\tfor (var l in languages) {\n\t\t\tvar language = languages[l];\n\t\t\tret = language;\n\t\t\tthis.availableLanguages[language] = this.languageNames[language];\n\t\t}\n\t\treturn ret;\n\t},\n\n\tcheckStyleTypeAndEnableOK: function(selectedStyle) {\n\t\tvar style = selectedStyle.name ? selectedStyle.name : selectedStyle.style;\n\n\t\tif (!style)\n\t\t\treturn;\n\n\t\tvar that = this;\n\t\tfetch('https://www.zotero.org/styles/' + style)\n\t\t\t.then(function (response) { return response.text(); })\n\t\t\t.then(function (html) {\n\t\t\t\tvar csl = new DOMParser().parseFromString(html, 'text/xml');\n\n\t\t\t\tthat.availableLanguages = {};\n\n\t\t\t\tvar locales = csl.getElementsByTagName('locale');\n\t\t\t\tfor (var i = 0; i < locales.length; i++) {\n\t\t\t\t\tif (locales[i].getAttribute('xml:lang')) {\n\t\t\t\t\t\tvar code = locales[i].getAttribute('xml:lang');\n\t\t\t\t\t\tthat.makeLanguageAvailable(code);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tvar style = csl.getElementsByTagName('style');\n\t\t\t\tif (style.length) {\n\t\t\t\t\tvar defaultLocale = style[0].getAttribute('default-locale');\n\t\t\t\t\tif (defaultLocale && defaultLocale !== '')\n\t\t\t\t\t\tdefaultLocale = that.makeLanguageAvailable(defaultLocale);\n\t\t\t\t}\n\n\t\t\t\tvar availableLocale =\n\t\t\t\t\tObject.keys(that.availableLanguages).indexOf(that.settings.locale) >= 0;\n\t\t\t\tthat.enableDialogLanguageCombobox(\n\t\t\t\t\tavailableLocale ? that.settings.locale : defaultLocale);\n\n\t\t\t\tvar categories = csl.getElementsByTagName('category');\n\t\t\t\tfor (var i = 0; i < categories.length; i++) {\n\t\t\t\t\tif (categories[i].getAttribute('citation-format')) {\n\t\t\t\t\t\tselectedStyle.citationFormat = categories[i].getAttribute('citation-format');\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tthat.enableDialogFieldTypeCombobox(selectedStyle.citationFormat);\n\t\t\t\tthat.enableDialogOKButton();\n\t\t\t});\n\t},\n\n\tsetCitationLayout: function(ciatationNode) {\n\t\tvar layout = ciatationNode.getElementsByTagName('layout')[0];\n\t\tthis.settings.layout = {};\n\t\tthis.settings.layout['prefix'] = layout && layout.getAttribute('prefix') ? layout.getAttribute('prefix') : '';\n\t\tthis.settings.layout['suffix'] = layout && layout.getAttribute('suffix') ? layout.getAttribute('suffix') : '';\n\t\tthis.settings.layout['delimiter'] = layout && layout.getAttribute('delimiter') ? layout.getAttribute('delimiter') : '';\n\n\t\tvar group = layout.getElementsByTagName('group')[0];\n\t\tthis.settings.group = {};\n\t\tthis.settings.group['prefix'] = group && group.getAttribute('prefix') ? group.getAttribute('prefix') : '';\n\t\tthis.settings.group['suffix'] = group && group.getAttribute('suffix') ? group.getAttribute('suffix') : '';\n\t\tthis.settings.group['delimiter'] = group && group.getAttribute('delimiter') ? group.getAttribute('delimiter') : '';\n\t},\n\n\tsetFetchedStyle: function(valueString) {\n\n\t\tvar value = new DOMParser().parseFromString(valueString, 'text/xml');\n\t\tvar styleNode = value.getElementsByTagName('style')[0];\n\n\t\tthis.settings.style = this.extractItemKeyFromLink(styleNode.id);\n\t\tvar locale = styleNode.getAttribute('locale');\n\t\tif (locale)\n\t\t\tthis.settings.locale = locale;\n\t\tvar fieldTypeNode = value.getElementsByName('fieldType');\n\t\tif (fieldTypeNode && fieldTypeNode[0])\n\t\t\tthis.settings.fieldType = fieldTypeNode[0].getAttribute('value');\n\t\telse\n\t\t\tthis.settings.fieldType = this.getFieldType();\n\n\t\tvar noteTypeNode = value.getElementsByName('noteType');\n\t\tif (noteTypeNode && noteTypeNode[0])\n\t\t\tthis.settings.wrapper = noteTypeNode[0].getAttribute('value') === '1' ? 'Footnote' : 'Endnote';\n\n\t\tthis.settings.hasBibliography = styleNode.getAttribute('hasBibliography');\n\t\tthis.settings.bibliographyStyleHasBeenSet = styleNode.getAttribute('bibliographyStyleHasBeenSet');\n\n\t\tthis.setFetchedCitationFormat();\n\n\t\twindow.prefs.set('Zotero_LastUsedStyle', this.settings.style);\n\t},\n\n\tgetStyleXml: function() {\n\t\tvar xmlDoc = new DOMParser().parseFromString('<data></data>', 'text/xml');\n\t\tvar dataNode = xmlDoc.getElementsByTagName('data')[0];\n\t\tdataNode.setAttribute('data-version', '3');\n\n\t\tvar sessionNode = xmlDoc.createElement('session');\n\t\tsessionNode.setAttribute('id', app.util.randomString(8));\n\n\t\tdataNode.appendChild(sessionNode);\n\n\t\tvar styleNode = xmlDoc.createElement('style');\n\t\tstyleNode.setAttribute('id', 'http://www.zotero.org/styles/' + this.settings.style);\n\t\tif (this.selectedCitationLangCode)\n\t\t\tthis.settings.locale = this.selectedCitationLangCode;\n\t\tstyleNode.setAttribute('locale', this.settings.locale);\n\t\tstyleNode.setAttribute('hasBibliography', this.settings.hasBibliography);\n\t\tstyleNode.setAttribute('bibliographyStyleHasBeenSet', this.settings.bibliographyStyleHasBeenSet);\n\n\t\tdataNode.appendChild(styleNode);\n\n\t\tvar prefsNode = xmlDoc.createElement('prefs');\n\n\t\tvar prefFieldNode = xmlDoc.createElement('pref');\n\t\tprefFieldNode.setAttribute('name', 'fieldType');\n\t\tprefFieldNode.setAttribute('value', this.getFieldType());\n\n\t\tprefsNode.appendChild(prefFieldNode);\n\n\t\tif (this.settings.wrapper) {\n\t\t\tvar prefNotedNode = xmlDoc.createElement('pref');\n\t\t\tprefNotedNode.setAttribute('name', 'noteType');\n\n\t\t\tif (this.settings.wrapper === 'Footnote')\n\t\t\t\tprefNotedNode.setAttribute('value', '1');\n\t\t\telse\n\t\t\t\tprefNotedNode.setAttribute('value', '2');\n\n\t\t\tprefsNode.appendChild(prefNotedNode);\n\t\t}\n\n\t\tdataNode.appendChild(prefsNode);\n\n\t\treturn dataNode;\n\t},\n\n\tsetStyle: function(style) {\n\t\tthis.settings.style = style.name;\n\t\tthis.settings.hasBibliography = '1';\n\n\t\tvar dataNode = this.getStyleXml();\n\n\t\tvar valueString = dataNode.outerHTML;\n\n\t\tthis.setCustomProperty('ZOTERO_PREF_', valueString);\n\t\tthis.setFetchedCitationFormat();\n\n\t\twindow.prefs.set('Zotero_LastUsedStyle', this.settings.style);\n\t},\n\n\tmarkBibliographyStyleHasBeenSet: function(unset) {\n\t\tif (unset)\n\t\t\tthis.settings.bibliographyStyleHasBeenSet = '0';\n\t\telse\n\t\t\tthis.settings.bibliographyStyleHasBeenSet = '1';\n\n\t\tvar dataNode = this.getStyleXml();\n\t\tvar valueString = dataNode.outerHTML;\n\t\tthis.setCustomProperty('ZOTERO_PREF_', valueString);\n\t},\n\n\tgetFieldType: function() {\n\t\tif (this.settings.fieldType)\n\t\t\treturn this.settings.fieldType;\n\n\t\tvar fileExtension = this.map['wopi'].BaseFileName.substring(this.map['wopi'].BaseFileName.lastIndexOf('.') + 1);\n\t\tthis.settings.fieldType = fileExtension.startsWith('doc') ? 'Field' : 'ReferenceMark';\n\n\t\t//TODO: probably also check for notes?\n\t\treturn this.settings.fieldType;\n\t},\n\n\tsetFieldType: function(field, format) {\n\t\tthis.settings.wrapper = '';\n\t\tif (field === 'Bookmarks')\n\t\t\tthis.settings.fieldType = 'Bookmark';\n\t\telse {\n\t\t\tvar fileExtension = this.map['wopi'].BaseFileName.substring(this.map['wopi'].BaseFileName.lastIndexOf('.') + 1);\n\t\t\tthis.settings.fieldType = fileExtension.startsWith('doc') ? 'Field' : 'ReferenceMark';\n\t\t\tif (format === 'note') {\n\t\t\t\tthis.settings.wrapper = 'Footnote';\n\t\t\t\tif (field === 'Endnotes')\n\t\t\t\t\tthis.settings.wrapper = 'Endnote';\n\t\t\t}\n\t\t}\n\t},\n\n\t_findEntryWithUrlImpl: function(entry, url) {\n\t\tif (entry.row === url)\n\t\t\treturn entry;\n\n\t\tfor (var i in entry.children) {\n\t\t\tvar found = this._findEntryWithUrlImpl(entry.children[i], url);\n\t\t\tif (found)\n\t\t\t\treturn found;\n\t\t}\n\n\t\treturn null;\n\t},\n\n\t_findEntryWithUrl: function(data, url) {\n\t\tfor (var i in data.entries) {\n\t\t\tvar found = this._findEntryWithUrlImpl(data.entries[i], url);\n\t\t\tif (found)\n\t\t\t\treturn found;\n\t\t}\n\n\t\treturn null;\n\t},\n\n\t_fetchCollectionAndPushTo: function(collectionId, targetCollection) {\n\t\tvar that = this;\n\t\tthis.getCachedOrFetch('https://api.zotero.org/users/' + this.userID + '/collections/' + collectionId + '/collections/?v=3&key=' + this.apiKey)\n\t\t\t.then(function (data) {\n\t\t\t\tfor (var i = 0; i < data.length; i++) {\n\t\t\t\t\ttargetCollection.children.push(\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tcolumns: [ { text: data[i].data.name } ],\n\t\t\t\t\t\t\tid: data[i].data.key,\n\t\t\t\t\t\t\trow: data[i].links.self.href + '/items/top' + that.getZoteroItemQuery(),\n\t\t\t\t\t\t\tchildren: [ { text: '<dummy>' } ],\n\t\t\t\t\t\t\tondemand: true\n\t\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\tif (!data.length)\n\t\t\t\t\ttargetCollection.children = undefined;\n\t\t\t\tthat.fillCategories();\n\t\t\t\tthat.updateCategories();\n\t\t\t}, function () {\n\t\t\t\tthat.map.uiManager.showSnackbar(_('Failed to load collections'));\n\t\t\t});\n\t},\n\n\t_expandCollection: function(treeViewData, row) {\n\t\tvar entry = this._findEntryWithUrl(treeViewData, row);\n\t\tvar searchArray = { entries: this.collections };\n\t\tvar targetEntry = this._findEntryWithUrl(searchArray, row);\n\n\t\tif (entry && targetEntry) {\n\t\t\tif (targetEntry.children && targetEntry.children.length === 1\n\t\t\t\t&& targetEntry.children[0].text === '<dummy>') {\n\t\t\t\ttargetEntry.children = [];\n\t\t\t\ttargetEntry.ondemand = undefined;\n\t\t\t\tthis.fillCategories();\n\t\t\t\tthis.updateCategories();\n\n\t\t\t\tthis._fetchCollectionAndPushTo(entry.id, targetEntry);\n\t\t\t}\n\t\t}\n\t},\n\n\tshowItemsForUrl: function(url, checkState) {\n\t\tvar that = this;\n\t\tthat.items = [];\n\t\tthis.getCachedOrFetch(url)\n\t\t\t.then(function (data) {\n\t\t\t\tthat.fillItems(data);\n\t\t\t\tvar dialogUpdateEvent = that.updateList([_('Title'), _('Creator(s)'), _('Date')], _('Your library is empty'));\n\t\t\t\tthat.map.fire('jsdialogupdate', dialogUpdateEvent);\n\t\t\t\tif (window.mode.isMobile()) window.mobileDialogId = dialogUpdateEvent.data.id;\n\n\t\t\t\t// mark already existing citations\n\t\t\t\tif (checkState) {\n\t\t\t\t\tthat.pendingCitationUpdate = false;\n\t\t\t\t\tthat.pendingItemListing = true;\n\t\t\t\t\tthat.fetchCitationUnderCursor();\n\t\t\t\t}\n\t\t\t\tthat.enableDisableNextPrevious(!url.includes('limit='));\n\t\t\t}, function () {\n\t\t\t\tthat.map.uiManager.showSnackbar(_('Failed to load items'));\n\t\t\t});\n\t},\n\n\t_onAction: function(element, action, data, index) {\n\t\tif (element === 'dialog' && action === 'close') return;\n\t\tif (element === 'treeview') {\n\t\t\tif (action == 'keydown')\n\t\t\t\treturn;\n\t\t\tif (data.id === 'zoterocategory') {\n\t\t\t\tvar url = index;\n\t\t\t\tif (!url)\n\t\t\t\t\treturn;\n\n\t\t\t\tif (action === 'expand')\n\t\t\t\t\tthis._expandCollection(data, index);\n\n\t\t\t\tthis.showItemsForUrl(url);\n\t\t\t\treturn;\n\t\t\t} else {\n\t\t\t\tif (this.dialogType === 'itemlist') {\n\t\t\t\t\tif (action !== 'change')\n\t\t\t\t\t\treturn;\n\n\t\t\t\t\tthis.selected = data.entries.filter(function (e) { return e.state === true; });\n\t\t\t\t\tthis.enableDialogOKButton();\n\t\t\t\t} else {\n\t\t\t\t\tthis.selected = data.entries[parseInt(index)];\n\n\t\t\t\t\tif (this.dialogType === 'stylelist') {\n\t\t\t\t\t\tthis.checkStyleTypeAndEnableOK(this.selected);\n\t\t\t\t\t} else if (this.dialogType === 'insertnote') {\n\t\t\t\t\t\tthis.enableDialogOKButton();\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\t\tif (element === 'edit' && data.id === 'zoterosearch') {\n\t\t\tconst query = data.querySelector('input').value;\n\t\t\tif (query)\n\t\t\t\tdocument.getElementById('zoterolist').filterEntries(query);\n\t\t\treturn;\n\t\t}\n\t\tif (data.id == 'ok') {\n\t\t\t// set selected style, style format and field\n\t\t\tif (!this.selected || this.selected.type === 'style') {\n\t\t\t\tvar citationFormat = this.selected ? this.selected.citationFormat : this.settings.citationFormat;\n\t\t\t\tvar parameters = this.selected ? this.selected : {name: window.prefs.get('Zotero_LastUsedStyle', ''), type: 'style'};\n\t\t\t\tvar selectedFieldType = this.selectedFieldType;\n\t\t\t\tthis.closeZoteroDialog();\n\t\t\t\tthis.map.uiManager.showConfirmModal('zoterofieldtypewarn', _('Citation warning'),\n\t\t\t\t\t_('Once citations are entered their storage and display type can not be changed.'),\n\t\t\t\t\t _('Confirm'), function() {\n\t\t\t\t\t\tthis.setFieldType(selectedFieldType, citationFormat);\n\t\t\t\t\t\tthis._onOk(parameters);\n\t\t\t\t\t\tthis.dispatchPendingAction();\n\t\t\t\t\t }.bind(this));\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis._onOk(this.selected);\n\t\t\tthis.dispatchPendingAction();\n\t\t}\n\t\tif (element === 'pushbutton' && data.id === 'zoterorefresh') {\n\t\t\tthis._cachedURL = [];\n\t\t\tif (this.dialogType === 'itemlist')\n\t\t\t\tthis.showItemList();\n\t\t\telse if (this.dialogType === 'insertnote')\n\t\t\t\tthis.handleInsertNote();\n\t\t\telse\n\t\t\t\tthis.showStyleList();\n\t\t\treturn;\n\t\t}\n\t\tif (element === 'combobox') {\n\t\t\tif (data.id === 'zoterolocale') {\n\t\t\t\tthis.selectedCitationLangCode = Object.keys(this.availableLanguages)[parseInt(index)];\n\t\t\t\tif (this.settings.style)\n\t\t\t\t\tthis.enableDialogOKButton();\n\t\t\t} else if (data.id === 'zoterotype') {\n\t\t\t\tthis.selectedFieldType = index.substring(index.indexOf(';')+1);\n\t\t\t}\n\t\t\treturn;\n\t\t}\n\t\tif (data.id === 'next') {\n\t\t\tthis.showItemsForUrl('https://api.zotero.org/users/' + this.userID + '/items/top' + this.getZoteroItemQuery(this.itemsPerPage, (this._currentPage + 1)*this.itemsPerPage), true);\n\t\t\tthis._currentPage++;\n\t\t\tthis.enableDisableNextPrevious();\n\t\t\treturn;\n\t\t}\n\t\tif (data.id === 'previous') {\n\t\t\tthis.showItemsForUrl('https://api.zotero.org/users/' + this.userID + '/items/top' + this.getZoteroItemQuery(this.itemsPerPage, (this._currentPage - 1)*this.itemsPerPage), true);\n\t\t\tthis._currentPage--;\n\t\t\tthis.enableDisableNextPrevious();\n\t\t\treturn;\n\t\t}\n\n\t\tthis.closeZoteroDialog();\n\t\tthis._currentPage = 0;\n\t},\n\n\tdispatchPendingAction: function() {\n\t\tif (this.pendingAction) {\n\t\t\tthis.pendingAction();\n\t\t\tdelete this.pendingAction;\n\t\t}\n\t},\n\n\tcloseZoteroDialog: function() {\n\t\tvar closeEvent = {\n\t\t\tdata: {\n\t\t\t\taction: 'close',\n\t\t\t\tid: 'ZoteroDialog',\n\t\t\t}\n\t\t};\n\t\tthis.map.fire(window.mode.isMobile() ? 'closemobilewizard' : 'jsdialog', closeEvent);\n\n\t\t// clear all previous selections\n\t\tdelete this.selectedCitationLangCode;\n\t\tdelete this.selected;\n\t\tdelete this.selectedFieldType;\n\t},\n\n\t_onOk: function (selected) {\n\t\tif (this.dialogType === 'itemlist') {\n\t\t\tvar citationsToInsert = [];\n\n\t\t\tfor (var i in selected) {\n\t\t\t    citationsToInsert = citationsToInsert.concat([selected[i].item]);\n\t\t\t}\n\n\t\t\tthis.insertCitation(citationsToInsert);\n\n\t\t\t// update all the citations once citations are inserted and we get updated fields\n\t\t\tthis.pendingCitationUpdate = true;\n\t\t}\n\t\telse if (selected.type === 'style') {\n\t\t\tthis.setStyle(selected);\n\t\t}\n\t\telse if (selected.type === 'note') {\n\t\t\tif (this.map._clip) {\n\t\t\t\tthis.map._clip.dataTransferToDocumentFallback(null, selected.item.data.note);\n\t\t\t}\n\t\t\telse\n\t\t\t\tconsole.warn('zotero: cannot paste a note');\n\t\t}\n\t},\n\n\thandleItemList: function() {\n\t\tthis.showItemList();\n\t},\n\n\thandleStyleList: function() {\n\t\tthis.showStyleList();\n\t},\n\n\thandleInsertNote: function() {\n\t\tif (!this.enable) {\n\t\t\tthis.askForApiKey();\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this.settings.style) {\n\t\t\tthis.pendingAction = this.handleInsertNote;\n\t\t\tthis.showStyleList();\n\t\t\treturn;\n\t\t}\n\n\t\tvar that = this;\n\t\tthis.dialogType = 'insertnote';\n\t\tvar notesCount = 0;\n\n\t\tthis.dialogSetup(_('Add Note'), false);\n\n\t\tvar updateDialog = function () {\n\t\t\tvar dialogUpdateEvent = that.updateList([_('Notes')],_('An error occurred while fetching notes'));\n\t\t\tif (window.mode.isMobile()) window.mobileDialogId = dialogUpdateEvent.data.id;\n\t\t\tthat.map.fire('jsdialogupdate', dialogUpdateEvent);\n\t\t};\n\n\t\tthis.getCachedOrFetch('https://api.zotero.org/users/' + this.userID + '/items' + this.getZoteroItemQuery())\n\t\t\t.then(function (data) {\n\t\t\t\tnotesCount += that.fillNotes(data, notesCount);\n\t\t\t\tupdateDialog();\n\n\t\t\t\tthat.getCachedOrFetch('https://api.zotero.org/users/' + that.userID + '/groups?v=3&key=' + that.apiKey)\n\t\t\t\t\t.then(function (data) {\n\t\t\t\t\t\tfor (var i = 0; i < data.length; i++) {\n\t\t\t\t\t\t\tvar groupUrl = data[i].links.self.href + '/items' + that.getZoteroItemQuery();\n\t\t\t\t\t\t\tthat.getCachedOrFetch(groupUrl)\n\t\t\t\t\t\t\t\t.then(function (data) {\n\t\t\t\t\t\t\t\t\tnotesCount += that.fillNotes(data, notesCount);\n\t\t\t\t\t\t\t\t\tupdateDialog();\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t});\n\t},\n\n\tinsertBibliography: function() {\n\t\tif (!this.enable) {\n\t\t\tthis.askForApiKey();\n\t\t\treturn;\n\t\t}\n\n\t\tthis.handleInsertBibliography();\n\t},\n\n\thandleInsertBibliography: function() {\n\t\tif (!this.settings.style) {\n\t\t\tthis.pendingAction = this.handleInsertBibliography;\n\t\t\tthis.showStyleList();\n\t\t\treturn;\n\t\t}\n\n\t\tif (!(this.citations && Object.keys(this.citations)))\n\t\t\treturn;\n\n\t\tif (this.getCitationKeys().length === 0)\n\t\t\treturn;\n\n\t\tvar that = this;\n\n\t\tif (this.settings.citationFormat === 'numeric') {\n\t\t\tthis.getCachedOrFetch('https://api.zotero.org/users/' + this.userID + '/items?include=bib&itemKey=' + this.getCitationKeysForBib().join(',') + '&v=3&key=' + this.apiKey + '&style=' + this.settings.style + '&locale=' + this.settings.locale)\n\t\t\t\t.then(function(data) {\n\t\t\t\t\tvar bibList = data.reduce(function(map, item) {\n\t\t\t\t\t\tmap[item.key] = item.bib;\n\t\t\t\t\t\treturn map;\n\t\t\t\t\t}, {});\n\n\t\t\t\t\tvar html = '';\n\t\t\t\t\tthat.getCitationKeysForBib().forEach(function(key) {\n\t\t\t\t\t\tvar bib = new DOMParser().parseFromString(bibList[key], 'text/html').body;\n\t\t\t\t\t\tvar numberNode = bib.getElementsByClassName('csl-entry')[0].firstElementChild;\n\t\t\t\t\t\tvar number = parseInt(numberNode.textContent.substring(numberNode.textContent.search(/[0-9]/))).toString();\n\t\t\t\t\t\tnumberNode.textContent = numberNode.textContent.replace(number, that.citations[key]);\n\t\t\t\t\t\thtml += bib.innerHTML;\n\t\t\t\t\t});\n\n\t\t\t\t\tthat.sendInsertBibCommand(html);\n\t\t\t\t\tthat.markBibliographyStyleHasBeenSet(); // update the document meta data about bib being set\n\n\t\t\t\t});\n\t\t\treturn;\n\t\t}\n\n\t\tfetch('https://api.zotero.org/users/' + this.userID + '/items?format=bib&itemKey=' + this.getCitationKeys().join(',') + '&v=3&key=' + this.apiKey + '&style=' + this.settings.style + '&locale=' + this.settings.locale)\n\t\t\t.then(function (response) { return response.text(); })\n\t\t\t.then(function (html) {\n\t\t\t\tthat.sendInsertBibCommand(html);\n\t\t\t\tthat.markBibliographyStyleHasBeenSet(); // update the document meta data about bib being set\n\t\t\t});\n\t},\n\n\tupdateFieldsList: function() {\n\t\tif (this.getFieldType() === 'Field')\n\t\t\tapp.socket.sendMessage('commandvalues command=.uno:TextFormFields?type=vnd.oasis.opendocument.field.UNHANDLED&commandPrefix=ADDIN%20ZOTERO_ITEM%20CSL_CITATION');\n\t\telse if (this.getFieldType() === 'ReferenceMark')\n\t\t\tapp.socket.sendMessage('commandvalues command=.uno:Fields?typeName=SetRef&namePrefix=ZOTERO_ITEM%20CSL_CITATION');\n\t\telse if (this.getFieldType() === 'Bookmark')\n\t\t\tapp.socket.sendMessage('commandvalues command=.uno:Bookmarks?namePrefix=ZOTERO_BREF_');\n\t},\n\n\tupdateBibList: function() {\n\t\tif (this.getFieldType() === 'Field')\n\t\t\tapp.socket.sendMessage('commandvalues command=.uno:TextFormFields?type=vnd.oasis.opendocument.field.UNHANDLED&commandPrefix=ADDIN%20ZOTERO_BIBL');\n\t\telse if (this.getFieldType() === 'ReferenceMark')\n\t\t\tapp.socket.sendMessage('commandvalues command=.uno:Sections?typeName=SetRef&namePrefix=ZOTERO_BIBL');\n\t\telse if (this.getFieldType() === 'Bookmark')\n\t\t\tapp.socket.sendMessage('commandvalues command=.uno:SetDocumentProperties?namePrefix=' + this.bibBookmarkName);\n\t},\n\n\tupdateCitations: function(showSnackbar) {\n\t\tif (!this.citations) {\n\t\t\tthis.updateFieldsList();\n\t\t\treturn;\n\t\t}\n\n\n\t\tvar that = this;\n\t\tvar citationKeys = this.getCitationKeys();\n\t\tvar citationCluster = this.citationCluster ? this.citationCluster : [];\n\n\t\tthis.getCachedOrFetch('https://api.zotero.org/users/' + this.userID + '/items/top' + this.getZoteroItemQuery() + '&itemKey=' + citationKeys.join(','))\n\t\t\t.then(function (data) {\n\t\t\t\tthat.resetCitation();\n\t\t\t\t// creating object for faster search\n\t\t\t\tvar dataMap = data.reduce(function(map, item) {\n\t\t\t\t\tmap[item.key] = item;\n\t\t\t\t\treturn map;\n\t\t\t\t}, {});\n\n\t\t\t\tvar newValues = [];\n\t\t\t\tObject.keys(citationCluster).forEach(function (clusterKey) {\n\t\t\t\t\tvar itemList = citationCluster[clusterKey].reduce(function(list, item) {\n\t\t\t\t\t\tlist.push(dataMap[item]);\n\t\t\t\t\t\treturn list;\n\t\t\t\t\t}, []);\n\t\t\t\t\tvar citationData = that.getCitationJSONString(itemList);\n\t\t\t\t\tvar updateParameter = that.getFieldParameters(citationData.jsonString, citationData.citationString);\n\t\t\t\t\tnewValues.push(that.getFieldType() !== 'Bookmark' ? updateParameter : {parameter: updateParameter, cslJSON: citationData.jsonString});\n\t\t\t\t});\n\n\t\t\t\tthat.sendUpdateCitationCommand(newValues);\n\t\t\t\tif (showSnackbar)\n\t\t\t\t\tthat.map.uiManager.showSnackbar(_('Updated citations'));\n\t\t\t}, function () {\n\t\t\t\tthat.map.uiManager.showSnackbar(_('Citations update failed'));\n\t\t\t});\n\n\t\tif (showSnackbar)\n\t\t\tthis.map.uiManager.showSnackbar(_('Updating citations'));\n\t},\n\n\thandleUnlinkCitations: function() {\n\t\tvar parametes = {};\n\t\tvar command = '';\n\t\tif (this.getFieldType() === 'Field') {\n\t\t\tparametes = {\n\t\t\t\t'FieldType': {\n\t\t\t\t\t'type': 'string',\n\t\t\t\t\t'value': 'vnd.oasis.opendocument.field.UNHANDLED'\n\t\t\t\t},\n\t\t\t\t'FieldCommandPrefix': {\n\t\t\t\t\t'type': 'string',\n\t\t\t\t\t'value': 'ADDIN ZOTERO_'\n\t\t\t\t},\n\t\t\t};\n\t\t\tcommand = '.uno:DeleteTextFormFields';\n\t\t} else if (this.getFieldType() === 'Bookmark') {\n\t\t\tparametes = {\n\t\t\t\t'BookmarkNamePrefix': {\n\t\t\t\t\t'type': 'string',\n\t\t\t\t\t'value': 'ZOTERO_BREF_'\n\t\t\t\t}\n\t\t\t};\n\t\t\tcommand = '.uno:DeleteBookmarks';\n\t\t\tthis.setCustomProperty('ZOTERO_BREF_', ''); // deletes stored CSL data from custom properties\n\t\t} else if (this.getFieldType() === 'ReferenceMark') {\n\t\t\tparametes = {\n\t\t\t\t'TypeName': {\n\t\t\t\t\t'type': 'string',\n\t\t\t\t\t'value': 'SetRef'\n\t\t\t\t},\n\t\t\t\t'NamePrefix': {\n\t\t\t\t\t'type': 'string',\n\t\t\t\t\t'value': 'ZOTERO_ITEM CSL_CITATION'\n\t\t\t\t}\n\t\t\t};\n\t\t\tcommand = '.uno:DeleteFields';\n\n\t\t\tvar sectionUnlinkParameter = {\n\t\t\t\t'SectionNamePrefix': {\n\t\t\t\t\t'type': 'string',\n\t\t\t\t\t'value': 'ZOTERO_BIBL'\n\t\t\t\t}\n\t\t\t};\n\t\t\tthis.map.sendUnoCommand('.uno:DeleteSections', sectionUnlinkParameter, true);\n\t\t}\n\t\tthis.map.sendUnoCommand(command, parametes, true);\n\t\tthis.resetCitation();\n\t\tthis.map.uiManager.showSnackbar('Unlinked citations');\n\t},\n\n\tunlinkCitations: function() {\n\t\tthis.map.uiManager.showInfoModal('zoterounlinkwarn', _('Unlink Citations'),\n\t\t\t_('Unlinking citations will prevent Collabora Online from updating citations and bibliography in this document.'),\n\t\t\tnull, _('Confirm'), this.handleUnlinkCitations.bind(this));\n\t},\n\n\thandleRefreshCitationsAndBib: function(showSnackbar) {\n\t\t//discard the cached url and fetch fresh one\n\t\tthis._cachedURL = [];\n\t\tthis.updateCitations(showSnackbar);\n\t\tif (this.settings.bibliographyStyleHasBeenSet === '1')\n\t\t\tthis.handleInsertBibliography();\n\t},\n\n\trefreshCitationsAndBib: function() {\n\t\tif (!this.enable) {\n\t\t\tthis.askForApiKey();\n\t\t\treturn;\n\t\t}\n\n\t\tthis.handleRefreshCitationsAndBib(true);\n\t},\n\n\thandleInsertCitation: function() {\n\t\t//start by fetching existing citation under the cursor\n\t\tif (!this.fetchCitationUnderCursor())\n\t\t\tthis.insertCitation({}); //temp fix until exitsting citations can be fetched for every field type\n\t},\n\n\tfetchCitationUnderCursor: function() {\n\t\tif (this.getFieldType() === 'Field')\n\t\t\tapp.socket.sendMessage('commandvalues command=.uno:TextFormField?type=vnd.oasis.opendocument.field.UNHANDLED&commandPrefix=ADDIN%20ZOTERO_ITEM');\n\t\telse if (this.getFieldType() === 'ReferenceMark')\n\t\t\tapp.socket.sendMessage('commandvalues command=.uno:Field?typeName=SetRef&namePrefix=ZOTERO_ITEM%20CSL_CITATION');\n\t\telse if (this.getFieldType() === 'Bookmark')\n\t\t\tapp.socket.sendMessage('commandvalues command=.uno:Bookmark?namePrefix=ZOTERO_BREF_');\n\t\telse\n\t\t\treturn false;\n\n\t\treturn true;\n\t},\n\n\t// happens on _onCommandValuesMsg in WriterTileLayer.js\n\thandleFieldUnderCursor: function (field) {\n\t\tif (!this.pendingItemListing)\n\t\t\treturn;\n\n\t\tvar cslString;\n\t\tif (this.getFieldType() === 'Field') {\n\t\t\tcslString = field.command;\n\t\t} else if (this.getFieldType() == 'Bookmark') {\n\t\t\tcslString = field.bookmark;\n\t\t} else if (this.getFieldType() === 'ReferenceMark') {\n\t\t\tcslString = field.name;\n\t\t}\n\t\tvar existingCitationUnderCursor = this.getJSONfromCitationString(cslString);\n\t\tthis.insertNewCitation = !Object.keys(existingCitationUnderCursor).length;\n\n\t\t// we need only to update states of items to show in the dialog\n\t\tthis.pendingItemListing = false;\n\t\tfor (var i in existingCitationUnderCursor.citationItems) {\n\t\t\tvar existingItem = existingCitationUnderCursor.citationItems[i];\n\t\t\tvar itemUri = existingItem.uris[0];\n\t\t\tvar key = this.extractItemKeyFromLink(itemUri);\n\n\t\t\tfor (var j in this.items) {\n\t\t\t\tvar listItem = this.items[j];\n\t\t\t\tif (listItem.item.key === key) {\n\t\t\t\t\tlistItem.state = true;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tvar dialogUpdateEvent = this.updateList([_('Title'), _('Creator(s)'), _('Date')], _('Your library is empty'));\n\t\tthis.map.fire('jsdialogupdate', dialogUpdateEvent);\n\t},\n\n\tinsertCitation: function(citationsToInsert) {\n\t\tif (!(citationsToInsert && citationsToInsert.length))\n\t\t\treturn;\n\n\t\tvar command = '';\n\t\tif (this.getFieldType() === 'Field') {\n\t\t\tcommand = this.insertNewCitation ? '.uno:TextFormField' : '.uno:UpdateTextFormField';\n\t\t} else if (this.getFieldType() == 'Bookmark') {\n\t\t\tcommand = this.insertNewCitation ? '.uno:InsertBookmark' : '.uno:UpdateBookmark';\n\t\t} else if (this.getFieldType() === 'ReferenceMark') {\n\t\t\tcommand = this.insertNewCitation ? '.uno:InsertField': '.uno:UpdateField';\n\t\t}\n\n\t\tvar citationData = this.getCitationJSONString(citationsToInsert);\n\t\tvar parameters = this.insertNewCitation ? this.getFieldParameters(citationData.jsonString, citationData.citationString) : this.getFieldUpdateParameters(citationData.jsonString, citationData.citationString);\n\n\t\tif (this.getFieldType() == 'Bookmark') {\n\t\t\tvar prefix = this.insertNewCitation ? parameters['Bookmark'].value : parameters['Bookmark']['value']['Bookmark'].value;\n\t\t\tthis.setCustomProperty(prefix + '_', 'ZOTERO_ITEM CSL_CITATION ' + citationData.jsonString);\n\t\t}\n\n\t\tdelete this.insertNewCitation;\n\t\tthis.map.sendUnoCommand(command, parameters, true);\n\t\tthis.updateFieldsList();\n\t},\n\n\tsendUpdateCitationCommand: function(newValueArray) {\n\n\t\tvar updatedCitations;\n\t\tif (this.getFieldType() === 'Field') {\n\t\t\tupdatedCitations = {\n\t\t\t\t'FieldType': {\n\t\t\t\t\t'type': 'string',\n\t\t\t\t\t'value': 'vnd.oasis.opendocument.field.UNHANDLED'\n\t\t\t\t},\n\t\t\t\t'FieldCommandPrefix': {\n\t\t\t\t\t'type': 'string',\n\t\t\t\t\t'value': 'ADDIN ZOTERO_ITEM CSL_CITATION'\n\t\t\t\t},\n\t\t\t\t'Fields': {\n\t\t\t\t\t'type': '[][]com.sun.star.beans.PropertyValue',\n\t\t\t\t\t'value': newValueArray\n\t\t\t\t}\n\t\t\t};\n\t\t\tthis.map.sendUnoCommand('.uno:TextFormFields', updatedCitations, true);\n\t\t} else if (this.getFieldType() === 'ReferenceMark') {\n\t\t\tupdatedCitations = {\n\t\t\t\t'TypeName': {\n\t\t\t\t\t'type': 'string',\n\t\t\t\t\t'value': 'SetRef'\n\t\t\t\t},\n\t\t\t\t'NamePrefix': {\n\t\t\t\t\t'type': 'string',\n\t\t\t\t\t'value': 'ZOTERO_ITEM CSL_CITATION'\n\t\t\t\t},\n\t\t\t\t'Fields': {\n\t\t\t\t\t'type': '[][]com.sun.star.beans.PropertyValue',\n\t\t\t\t\t'value': newValueArray\n\t\t\t\t},\n\t\t\t\t'NeverExpand': {\n\t\t\t\t\t'type': 'boolean',\n\t\t\t\t\t'value': true\n\t\t\t\t}\n\t\t\t};\n\t\t\tthis.map.sendUnoCommand('.uno:UpdateFields', updatedCitations, true);\n\t\t} else if (this.getFieldType() === 'Bookmark') {\n\t\t\tupdatedCitations = {\n\t\t\t\t'BookmarkNamePrefix': {\n\t\t\t\t\t'type': 'string',\n\t\t\t\t\t'value': 'ZOTERO_BREF_'\n\t\t\t\t},\n\t\t\t\t'Bookmarks': {\n\t\t\t\t\t'type': '[][]com.sun.star.beans.PropertyValue',\n\t\t\t\t\t'value': newValueArray.map(function(value) {return value.parameter;})\n\t\t\t\t}\n\t\t\t};\n\t\t\tvar that = this;\n\t\t\tnewValueArray.forEach(function(value) {\n\t\t\t\tthat.setCustomProperty(value.parameter['Bookmark'].value + '_', 'ZOTERO_ITEM CSL_CITATION ' + value.cslJSON);\n\t\t\t});\n\t\t\tthis.map.sendUnoCommand('.uno:UpdateBookmarks', updatedCitations, true);\n\t\t}\n\n\t\tthis.updateFieldsList();\n\t},\n\n\tgetFieldParameters: function(cslJSON, citationString) {\n\t\tvar field = {};\n\n\t\tif (this.getFieldType() === 'Field') {\n\t\t\tfield['FieldType'] = {type: 'string', value: 'vnd.oasis.opendocument.field.UNHANDLED'};\n\t\t\tfield['FieldCommand'] = {type: 'string', value: 'ADDIN ZOTERO_ITEM CSL_CITATION ' + cslJSON};\n\t\t\tfield['FieldResult'] = {type: 'string', value: citationString};\n\t\t} else if (this.getFieldType() === 'ReferenceMark') {\n\t\t\tfield['TypeName'] = {type: 'string', value: 'SetRef'};\n\t\t\tfield['Name'] = {type: 'string', value: 'ZOTERO_ITEM CSL_CITATION ' + cslJSON + ' RND' + app.util.randomString(10)};\n\t\t\tfield['Content'] = {type: 'string', value: citationString};\n\t\t\tfield['NeverExpand'] = {type: 'boolean', value: true};\n\t\t} else if (this.getFieldType() == 'Bookmark') {\n\t\t\tfield['Bookmark'] = {type: 'string', value: 'ZOTERO_BREF_' + app.util.randomString(12)};\n\t\t\tfield['BookmarkText'] = {type: 'string', value: citationString};\n\t\t}\n\n\t\tif (this.settings.wrapper)\n\t\t\tfield['Wrapper'] = {type: 'string', value: this.settings.wrapper};\n\n\t\treturn field;\n\t},\n\n\tgetFieldUpdateParameters: function(cslJSON, citationString) {\n\t\tvar field = {};\n\n\t\tif (this.getFieldType() === 'Field') {\n\t\t\tfield = {\n\t\t\t\t'FieldType': {\n\t\t\t\t\t'type': 'string',\n\t\t\t\t\t'value': 'vnd.oasis.opendocument.field.UNHANDLED'\n\t\t\t\t},\n\t\t\t\t'FieldCommandPrefix': {\n\t\t\t\t\t'type': 'string',\n\t\t\t\t\t'value': 'ADDIN ZOTERO_ITEM'\n\t\t\t\t},\n\t\t\t\t'Field': {\n\t\t\t\t\t'type': '[]com.sun.star.beans.PropertyValue',\n\t\t\t\t\t'value': {\n\t\t\t\t\t\t'FieldType': {\n\t\t\t\t\t\t\t'type': 'string',\n\t\t\t\t\t\t\t'value': 'vnd.oasis.opendocument.field.UNHANDLED'\n\t\t\t\t\t\t},\n\t\t\t\t\t\t'FieldCommand': {\n\t\t\t\t\t\t\t'type': 'string',\n\t\t\t\t\t\t\t'value': 'ADDIN ZOTERO_ITEM CSL_CITATION ' + cslJSON\n\t\t\t\t\t\t},\n\t\t\t\t\t\t'FieldResult': {\n\t\t\t\t\t\t\t'type': 'string',\n\t\t\t\t\t\t\t'value': citationString\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t};\n\t\t} else if (this.getFieldType() === 'ReferenceMark') {\n\t\t\tfield = {\n\t\t\t\t'TypeName': {\n\t\t\t\t\t'type': 'string',\n\t\t\t\t\t'value': 'SetRef'\n\t\t\t\t},\n\t\t\t\t'NamePrefix': {\n\t\t\t\t\t'type': 'string',\n\t\t\t\t\t'value': 'ZOTERO_ITEM CSL_CITATION'\n\t\t\t\t},\n\t\t\t\t'Field': {\n\t\t\t\t\t'type': '[]com.sun.star.beans.PropertyValue',\n\t\t\t\t\t'value': {\n\t\t\t\t\t\t'Name': {\n\t\t\t\t\t\t\t'type': 'string',\n\t\t\t\t\t\t\t'value': 'ZOTERO_ITEM CSL_CITATION ' + cslJSON\n\t\t\t\t\t\t},\n\t\t\t\t\t\t'Content': {\n\t\t\t\t\t\t\t'type': 'string',\n\t\t\t\t\t\t\t'value': citationString\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t};\n\t\t} else if (this.getFieldType() === 'Bookmark') {\n\t\t\tfield = {\n\t\t\t\t'BookmarkNamePrefix': {\n\t\t\t\t\t'type': 'string',\n\t\t\t\t\t'value': 'ZOTERO_BREF_'\n\t\t\t\t},\n\t\t\t\t'Bookmark': {\n\t\t\t\t\t'type': '[]com.sun.star.beans.PropertyValue',\n\t\t\t\t\t'value': {\n\t\t\t\t\t\t'Bookmark': {\n\t\t\t\t\t\t\t'type': 'string',\n\t\t\t\t\t\t\t'value': 'ZOTERO_BREF_' + app.util.randomString(12)\n\t\t\t\t\t\t},\n\t\t\t\t\t\t'BookmarkText': {\n\t\t\t\t\t\t\t'type': 'string',\n\t\t\t\t\t\t\t'value': citationString\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t};\n\t\t}\n\t\treturn field;\n\t},\n\n\tgetBibParameters: function(html) {\n\t\tvar field = {};\n\t\t// TODO: support uncited omitted (citation) and custom sources in bibliography\n\t\tif (this.getFieldType() === 'Field') {\n\t\t\tfield['FieldType'] = {type: 'string', value: 'vnd.oasis.opendocument.field.UNHANDLED'};\n\t\t\tfield['FieldCommand'] = {type: 'string', value: 'ADDIN ZOTERO_BIBL ' + JSON.stringify(this.settings.bib) + ' CSL_BIBLIOGRAPHY'};\n\t\t\tfield['FieldResult'] = {type: 'string', value: html};\n\t\t} else if (this.getFieldType() == 'Bookmark') {\n\t\t\tfield['Bookmark'] = {type: 'string', value: 'ZOTERO_BREF_' + app.util.randomString(12)};\n\t\t\tfield['BookmarkText'] = {type: 'string', value: html};\n\t\t} else {\n\t\t\tfield['RegionName'] = {type: 'string', value: 'ZOTERO_BIBL ' + JSON.stringify(this.settings.bib) + ' CSL_BIBLIOGRAPHY ' + ' RND' + app.util.randomString(10)};\n\t\t\tfield['Content'] = {type: 'string', value: html};\n\t\t}\n\n\t\treturn field;\n\t},\n\n\tsendInsertBibCommand: function(html) {\n\t\tvar command = '';\n\t\tvar parameters = this.getBibParameters(html);\n\t\tif (this.getFieldType() === 'Field') {\n\t\t\tcommand = '.uno:TextFormField';\n\t\t\tif (this.settings.bibliographyStyleHasBeenSet == '1') {\n\t\t\t\tparameters = {\n\t\t\t\t\t'FieldType': {\n\t\t\t\t\t\t'type': 'string',\n\t\t\t\t\t\t'value': 'vnd.oasis.opendocument.field.UNHANDLED'\n\t\t\t\t\t},\n\t\t\t\t\t'FieldCommandPrefix': {\n\t\t\t\t\t\t'type': 'string',\n\t\t\t\t\t\t'value': 'ADDIN ZOTERO_BIBL'\n\t\t\t\t\t},\n\t\t\t\t\t'Fields': {\n\t\t\t\t\t\t'type': '[][]com.sun.star.beans.PropertyValue',\n\t\t\t\t\t\t'value': [parameters]\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t\tcommand = '.uno:TextFormFields';\n\t\t\t}\n\n\t\t} else if (this.getFieldType() == 'Bookmark') {\n\t\t\tcommand = '.uno:InsertBookmark';\n\t\t\tvar newBibBookmarkName = parameters['Bookmark'].value;\n\t\t\tif (this.settings.bibliographyStyleHasBeenSet == '1') {\n\t\t\t\tcommand = '.uno:UpdateBookmarks';\n\t\t\t\tparameters = {\n\t\t\t\t\t'BookmarkNamePrefix': {\n\t\t\t\t\t\t'type': 'string',\n\t\t\t\t\t\t'value': this.bibBookmarkName\n\t\t\t\t\t},\n\t\t\t\t\t'Bookmarks': {\n\t\t\t\t\t\t'type': '[][]com.sun.star.beans.PropertyValue',\n\t\t\t\t\t\t'value': [parameters]\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t}\n\t\t\tthis.bibBookmarkName = newBibBookmarkName;\n\t\t\tthis.setCustomProperty(this.bibBookmarkName + '_', 'ZOTERO_BIBL ' + JSON.stringify(this.settings.bib) + ' CSL_BIBLIOGRAPHY');\n\t\t} else {\n\t\t\tcommand = '.uno:InsertSection';\n\t\t\tif (this.settings.bibliographyStyleHasBeenSet == '1') {\n\t\t\t\tvar command = '.uno:UpdateSections';\n\t\t\t\tparameters = {\n\t\t\t\t\t'SectionNamePrefix': {\n\t\t\t\t\t\t'type': 'string',\n\t\t\t\t\t\t'value': 'ZOTERO_BIBL'\n\t\t\t\t\t},\n\t\t\t\t\t'Sections': {\n\t\t\t\t\t\t'type': '[][]com.sun.star.beans.PropertyValue',\n\t\t\t\t\t\t'value': [parameters]\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t}\n\t\t}\n\n\t\tthis.map.sendUnoCommand(command, parameters, true);\n\t},\n\n\tsetCustomProperty: function(prefix, string) {\n\t\tvar property =\n\t\t{\n\t\t\t'UpdatedProperties': {\n\t\t\t\t'type': '[]com.sun.star.beans.PropertyValue',\n\t\t\t\t'value': {\n\t\t\t\t\t'NamePrefix': {\n\t\t\t\t\t\t'type': 'string',\n\t\t\t\t\t\t'value': prefix\n\t\t\t\t\t},\n\t\t\t\t\t'UserDefinedProperties': {\n\t\t\t\t\t\t'type': '[]com.sun.star.beans.PropertyValue',\n\t\t\t\t\t\t'value': {\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\t// style preference needs to be stored into chunks of max 255 chars\n\t\tfor (var start = 0, end = 1; (end * 255) < (string.length + 255); start++, end++) {\n\t\t\tproperty['UpdatedProperties']['value']['UserDefinedProperties']['value'][prefix+end] =\n\t\t\t{\n\t\t\t\t'type': 'string',\n\t\t\t\t'value': string.slice(start*255, end*255)\n\t\t\t};\n\n\t\t}\n\t\tthis.map.sendUnoCommand('.uno:SetDocumentProperties', property, true);\n\t},\n\n\thandleCustomProperty: function(userDefinedProperties) {\n\t\tvar prefixList = new Set();\n\t\tvar nameValueMap = {};\n\t\tvar resultMap = {};\n\t\tfor (var i = 0; i < userDefinedProperties.length; i++) {\n\t\t\tprefixList.add(userDefinedProperties[i].name.substring(0, userDefinedProperties[i].name.lastIndexOf('_')));\n\t\t\tnameValueMap[userDefinedProperties[i].name] = userDefinedProperties[i].value;\n\t\t}\n\n\t\tprefixList.forEach(function(prefix) {\n\t\t\tfor (i = 1; nameValueMap[prefix + '_' + i]; i++) {\n\t\t\t\tif (resultMap[prefix])\n\t\t\t\t\tresultMap[prefix] += nameValueMap[prefix + '_' + i];\n\t\t\t\telse\n\t\t\t\t\tresultMap[prefix] = nameValueMap[prefix + '_' + i];\n\t\t\t}\n\t\t});\n\n\t\tvar resultKeys = Object.keys(resultMap);\n\t\tif (resultMap.ZOTERO_PREF) {\n\t\t\tthis.setFetchedStyle(resultMap.ZOTERO_PREF);\n\t\t}\n\t\t// insert new bookmark citation\n\t\telse if (!resultKeys.length) {\n\t\t\tthis.handleFieldUnderCursor({});\n\t\t}\n\t\t// update existing bookmark citation\n\t\telse if (resultKeys.length && resultKeys[0].startsWith('ZOTERO_BREF')) {\n\t\t\tthis.handleFieldUnderCursor({bookmark: resultMap[resultKeys[0]]});\n\n\t\t\tvar fields = [];\n\t\t\tvar that = this;\n\t\t\tthis.bookmarksOrder.forEach(function(bookmark) {\n\t\t\t\tif (resultMap[bookmark].startsWith('ZOTERO_BIBL')) {\n\t\t\t\t\tthat.bibBookmarkName = bookmark;\n\t\t\t\t\tthat.setBibCustomProperty(resultMap[bookmark]);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tfields.push({bookmark: resultMap[bookmark]});\n\t\t\t});\n\t\t\tthis.onFieldValue(fields);\n\t\t}\n\t},\n\n\tsetBibCustomProperty: function(bibProperty) {\n\t\tif (!bibProperty)\n\t\t\treturn {};\n\n\t\tvar firstBraceIndex = bibProperty.indexOf('{');\n\t\tvar lastBraceIndex = bibProperty.lastIndexOf('}');\n\n\t\tif (firstBraceIndex < 0 || lastBraceIndex > bibProperty.length || lastBraceIndex < 0)\n\t\t\treturn {};\n\n\t\tvar values = JSON.parse(bibProperty.substring(firstBraceIndex, lastBraceIndex+1));\n\n\t\tthis.settings.bib.uncited = values.uncited;\n\t\tthis.settings.bib.omitted = values.omitted;\n\t\tthis.settings.bib.custom = values.custom;\n\t},\n\n\thandleBookmark: function(bookmarks) {\n\t\tthis.resetCitation();\n\t\tvar that = this;\n\t\tbookmarks.forEach(function(bookmark) {\n\t\t\tthat.bookmarksOrder.push(bookmark.name);\n\t\t});\n\t\tthis.fetchCustomProperty('ZOTERO_BREF_');\n\t},\n\n\t_onMessage: function(message) {\n\t\tif (message.startsWith('itemslist: ')) {\n\t\t\tthis.handleItemList(message);\n\t\t}\n\t},\n\n\t// from https://raw.githubusercontent.com/citation-style-language/locales/master/locales.json\n\t// saves us from fetching same thing every time for every user\n\tavailableLanguages: {},\n\tlanguageNames: {\n\t\t'af-ZA': [\n\t\t\t'Afrikaans',\n\t\t\t'Afrikaans'\n\t\t],\n\t\t'ar': [\n\t\t\t'العربية',\n\t\t\t'Arabic'\n\t\t],\n\t\t'bg-BG': [\n\t\t\t'Български',\n\t\t\t'Bulgarian'\n\t\t],\n\t\t'ca-AD': [\n\t\t\t'Català',\n\t\t\t'Catalan'\n\t\t],\n\t\t'cs-CZ': [\n\t\t\t'Čeština',\n\t\t\t'Czech'\n\t\t],\n\t\t'cy-GB': [\n\t\t\t'Cymraeg',\n\t\t\t'Welsh'\n\t\t],\n\t\t'da-DK': [\n\t\t\t'Dansk',\n\t\t\t'Danish'\n\t\t],\n\t\t'de-AT': [\n\t\t\t'Deutsch (Österreich)',\n\t\t\t'German (Austria)'\n\t\t],\n\t\t'de-CH': [\n\t\t\t'Deutsch (Schweiz)',\n\t\t\t'German (Switzerland)'\n\t\t],\n\t\t'de-DE': [\n\t\t\t'Deutsch (Deutschland)',\n\t\t\t'German (Germany)'\n\t\t],\n\t\t'el-GR': [\n\t\t\t'Ελληνικά',\n\t\t\t'Greek'\n\t\t],\n\t\t'en-GB': [\n\t\t\t'English (UK)',\n\t\t\t'English (UK)'\n\t\t],\n\t\t'en-US': [\n\t\t\t'English (US)',\n\t\t\t'English (US)'\n\t\t],\n\t\t'es-CL': [\n\t\t\t'Español (Chile)',\n\t\t\t'Spanish (Chile)'\n\t\t],\n\t\t'es-ES': [\n\t\t\t'Español (España)',\n\t\t\t'Spanish (Spain)'\n\t\t],\n\t\t'es-MX': [\n\t\t\t'Español (México)',\n\t\t\t'Spanish (Mexico)'\n\t\t],\n\t\t'et-EE': [\n\t\t\t'Eesti keel',\n\t\t\t'Estonian'\n\t\t],\n\t\t'eu': [\n\t\t\t'Euskara',\n\t\t\t'Basque'\n\t\t],\n\t\t'fa-IR': [\n\t\t\t'فارسی',\n\t\t\t'Persian'\n\t\t],\n\t\t'fi-FI': [\n\t\t\t'Suomi',\n\t\t\t'Finnish'\n\t\t],\n\t\t'fr-CA': [\n\t\t\t'Français (Canada)',\n\t\t\t'French (Canada)'\n\t\t],\n\t\t'fr-FR': [\n\t\t\t'Français (France)',\n\t\t\t'French (France)'\n\t\t],\n\t\t'he-IL': [\n\t\t\t'עברית',\n\t\t\t'Hebrew'\n\t\t],\n\t\t'hi-IN': [\n\t\t\t'हिंदी',\n\t\t\t'Hindi'\n\t\t],\n\t\t'hr-HR': [\n\t\t\t'Hrvatski',\n\t\t\t'Croatian'\n\t\t],\n\t\t'hu-HU': [\n\t\t\t'Magyar',\n\t\t\t'Hungarian'\n\t\t],\n\t\t'id-ID': [\n\t\t\t'Bahasa Indonesia',\n\t\t\t'Indonesian'\n\t\t],\n\t\t'is-IS': [\n\t\t\t'Íslenska',\n\t\t\t'Icelandic'\n\t\t],\n\t\t'it-IT': [\n\t\t\t'Italiano',\n\t\t\t'Italian'\n\t\t],\n\t\t'ja-JP': [\n\t\t\t'日本語',\n\t\t\t'Japanese'\n\t\t],\n\t\t'km-KH': [\n\t\t\t'ភាសាខ្មែរ',\n\t\t\t'Khmer'\n\t\t],\n\t\t'ko-KR': [\n\t\t\t'한국어',\n\t\t\t'Korean'\n\t\t],\n\t\t'la': [\n\t\t\t'Latina',\n\t\t\t'Latin'\n\t\t],\n\t\t'lt-LT': [\n\t\t\t'Lietuvių kalba',\n\t\t\t'Lithuanian'\n\t\t],\n\t\t'lv-LV': [\n\t\t\t'Latviešu',\n\t\t\t'Latvian'\n\t\t],\n\t\t'mn-MN': [\n\t\t\t'Монгол',\n\t\t\t'Mongolian'\n\t\t],\n\t\t'nb-NO': [\n\t\t\t'Norsk bokmål',\n\t\t\t'Norwegian (Bokmål)'\n\t\t],\n\t\t'nl-NL': [\n\t\t\t'Nederlands',\n\t\t\t'Dutch'\n\t\t],\n\t\t'nn-NO': [\n\t\t\t'Norsk nynorsk',\n\t\t\t'Norwegian (Nynorsk)'\n\t\t],\n\t\t'pl-PL': [\n\t\t\t'Polski',\n\t\t\t'Polish'\n\t\t],\n\t\t'pt-BR': [\n\t\t\t'Português (Brasil)',\n\t\t\t'Portuguese (Brazil)'\n\t\t],\n\t\t'pt-PT': [\n\t\t\t'Português (Portugal)',\n\t\t\t'Portuguese (Portugal)'\n\t\t],\n\t\t'ro-RO': [\n\t\t\t'Română',\n\t\t\t'Romanian'\n\t\t],\n\t\t'ru-RU': [\n\t\t\t'Русский',\n\t\t\t'Russian'\n\t\t],\n\t\t'sk-SK': [\n\t\t\t'Slovenčina',\n\t\t\t'Slovak'\n\t\t],\n\t\t'sl-SI': [\n\t\t\t'Slovenščina',\n\t\t\t'Slovenian'\n\t\t],\n\t\t'sr-RS': [\n\t\t\t'Српски / Srpski',\n\t\t\t'Serbian'\n\t\t],\n\t\t'sv-SE': [\n\t\t\t'Svenska',\n\t\t\t'Swedish'\n\t\t],\n\t\t'th-TH': [\n\t\t\t'ไทย',\n\t\t\t'Thai'\n\t\t],\n\t\t'tr-TR': [\n\t\t\t'Türkçe',\n\t\t\t'Turkish'\n\t\t],\n\t\t'uk-UA': [\n\t\t\t'Українська',\n\t\t\t'Ukrainian'\n\t\t],\n\t\t'vi-VN': [\n\t\t\t'Tiếng Việt',\n\t\t\t'Vietnamese'\n\t\t],\n\t\t'zh-CN': [\n\t\t\t'中文 (中国大陆)',\n\t\t\t'Chinese (PRC)'\n\t\t],\n\t\t'zh-TW': [\n\t\t\t'中文 (台灣)',\n\t\t\t'Chinese (Taiwan)'\n\t\t]\n\t}\n});\n\nL.control.zotero = function (map) {\n\treturn new L.Control.Zotero(map);\n};\n"]}