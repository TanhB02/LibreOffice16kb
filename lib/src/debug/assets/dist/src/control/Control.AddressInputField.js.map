{"version":3,"file":"Control.AddressInputField.js","sourceRoot":"","sources":["../../../../../../../../../../TanhX/online/browser/src/control/Control.AddressInputField.ts"],"names":[],"mappings":"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","sourcesContent":["/* -*- js-indent-level: 8 -*- */\n/*\n * Copyright the Collabora Online contributors.\n *\n * SPDX-License-Identifier: MPL-2.0\n *\n * This Source Code Form is subject to the terms of the Mozilla Public\n * License, v. 2.0. If a copy of the MPL was not distributed with this\n * file, You can obtain one at http://mozilla.org/MPL/2.0/.\n */\n\n/*\n * JSDialog.AddressInputField - implementation of address input field in calc\n */\n\ndeclare var JSDialog: any;\ndeclare var L: any;\n\nclass AddressInputField {\n\tmap: any;\n\tparentContainer: HTMLElement;\n\tbuilder: any;\n\n\tpublic constructor(map: any) {\n\t\tthis.map = map;\n\t\tthis.parentContainer = L.DomUtil.get('addressInput');\n\n\t\tthis.map.on('jsdialogupdate', this.onJSUpdate, this);\n\t\tthis.map.on('jsdialogaction', this.onJSAction, this);\n\t\tthis.map.on('doclayerinit', this.onDocLayerInit, this);\n\t\tthis.map.on('celladdress', this.onCellAddress, this);\n\n\t\tthis.builder = new L.control.jsDialogBuilder({\n\t\t\tmobileWizard: this,\n\t\t\tmap: this.map,\n\t\t\tcssClass: 'addressInput jsdialog',\n\t\t\twindowId: -4,\n\t\t});\n\n\t\tthis.createAddressInputField();\n\t}\n\n\tpublic onRemove() {\n\t\tthis.map.off('jsdialogupdate', this.onJSUpdate, this);\n\t\tthis.map.off('jsdialogaction', this.onJSAction, this);\n\t\tthis.map.off('doclayerinit', this.onDocLayerInit, this);\n\t\tthis.map.off('celladdress', this.onCellAddress, this);\n\t}\n\n\tprivate onCellAddress(event: any) {\n\t\tconst addressInput = document.querySelector<HTMLInputElement>(\n\t\t\t'#addressInput input',\n\t\t);\n\t\tif (addressInput && document.activeElement !== addressInput) {\n\t\t\t// if the user is not editing the address field\n\t\t\taddressInput.value = event.address;\n\t\t\taddressInput.setAttribute('aria-label', event.address);\n\t\t}\n\t\tthis.map.formulabarSetDirty();\n\t}\n\n\tprivate createAddressInputField() {\n\t\tconst data: any = [\n\t\t\t{\n\t\t\t\tid: 'pos_window',\n\t\t\t\ttype: 'combobox',\n\t\t\t\ttext: _('cell address'),\n\t\t\t\tenabled: true,\n\t\t\t\tchangeOnEnterOnly: true,\n\t\t\t\tfocusMapOnEnter: true,\n\t\t\t\tchildren: [\n\t\t\t\t\t{\n\t\t\t\t\t\tid: 'expand',\n\t\t\t\t\t\ttype: 'pushbutton',\n\t\t\t\t\t\ttext: '',\n\t\t\t\t\t\tsymbol: 'SPIN_DOWN',\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tid: '',\n\t\t\t\t\t\ttype: 'edit',\n\t\t\t\t\t\ttext: '',\n\t\t\t\t\t\tenabled: true,\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tid: '',\n\t\t\t\t\t\ttype: 'borderwindow',\n\t\t\t\t\t\ttext: '',\n\t\t\t\t\t\tenabled: true,\n\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\ttype: 'edit',\n\t\t\t\t\t\t\t\tid: '',\n\t\t\t\t\t\t\t\ttext: '',\n\t\t\t\t\t\t\t\tenabled: true,\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t],\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t\tselectedEntries: [],\n\t\t\t\tselectedCount: 0,\n\t\t\t},\n\t\t];\n\t\tthis.parentContainer.replaceChildren();\n\t\tthis.builder.build(this.parentContainer, data);\n\t}\n\n\tprivate onJSUpdate(e: any) {\n\t\tconst data = e?.data;\n\t\tif (data.jsontype !== 'addressinputfield') return;\n\n\t\t// we don't want to send change event on every keypress,\n\t\t// otherwise core will keep on adding new named range on every keypress.\n\t\t// we want to create a named range only when user presses the 'Enter' key.\n\t\tdata.control.changeOnEnterOnly = true;\n\t\tdata.control.focusMapOnEnter = true;\n\t\tthis.builder.updateWidget(this.parentContainer, data.control);\n\t}\n\n\tprivate onDocLayerInit() {\n\t\tvar docType = this.map.getDocType();\n\t\tif (docType == 'spreadsheet' && this.parentContainer) {\n\t\t\tthis.parentContainer.style.setProperty('display', 'table-cell');\n\t\t}\n\t}\n\n\tprivate onJSAction(e: any) {\n\t\tconst data = e.data;\n\t\tif (data.jsontype !== 'addressinputfield') return;\n\n\t\tconst innerData = data?.data;\n\t\tthis.builder.executeAction(this.parentContainer, innerData);\n\t}\n}\n\nJSDialog.AddressInputField = function (map: any) {\n\treturn new AddressInputField(map);\n};\n"]}