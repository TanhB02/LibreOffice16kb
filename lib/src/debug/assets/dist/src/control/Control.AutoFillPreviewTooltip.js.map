{"version":3,"file":"Control.AutoFillPreviewTooltip.js","sourceRoot":"","sources":["../../../../../../../../../../TanhX/online/browser/src/control/Control.AutoFillPreviewTooltip.ts"],"names":[],"mappings":"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","sourcesContent":["// @ts-strict-ignore\n/* -*- js-indent-level: 8 -*- */\n/*\n * Copyright the Collabora Online contributors.\n *\n * SPDX-License-Identifier: MPL-2.0\n *\n * This Source Code Form is subject to the terms of the Mozilla Public\n * License, v. 2.0. If a copy of the MPL was not distributed with this\n * file, You can obtain one at http://mozilla.org/MPL/2.0/.\n */\n/*\n * Control.AutoFillPreviewTooltip - class for tooltip of cell previews during auto fill\n */\n\n/* global app */\n\nclass AutoFillPreviewTooltip extends L.Control.AutoCompletePopup {\n\tusageText: string;\n\tnewPopupData: PopupData;\n\n\tconstructor(map: ReturnType<typeof L.map>) {\n\t\tsuper('autoFillPreviewTooltip', map);\n\t}\n\n\tonAdd() {\n\t\tthis.newPopupData.isAutoFillPreviewTooltip = true;\n\t\tthis.newPopupData.noOverlay = true;\n\t\tthis.newPopupData.id = 'autoFillPreviewTooltip';\n\n\t\tthis.map.on(\n\t\t\t'openautofillpreviewpopup',\n\t\t\tthis.openAutoFillPreviewPopup,\n\t\t\tthis,\n\t\t);\n\t\tthis.map.on(\n\t\t\t'closeautofillpreviewpopup',\n\t\t\tthis.closeAutoFillPreviewPopup,\n\t\t\tthis,\n\t\t);\n\t}\n\n\tgetSimpleTextJSON(cellValue: string): TextWidget {\n\t\treturn {\n\t\t\tid: this.popupId + 'fixedtext',\n\t\t\ttype: 'fixedtext',\n\t\t\ttext: cellValue,\n\t\t\tenabled: false,\n\t\t} as TextWidget;\n\t}\n\n\topenAutoFillPreviewPopup(ev: FireEvent): void {\n\t\t// calculate the popup position\n\t\tvar cellRange = this.map._docLayer._parseCellRange(\n\t\t\tJSON.stringify(ev.data.celladdress),\n\t\t);\n\t\tev.data.celladdress = this.map._docLayer\n\t\t\t._cellRangeToTwipRect(cellRange)\n\t\t\t.toRectangle();\n\n\t\tev.data.celladdress = new app.definitions.simplePoint(\n\t\t\tparseInt(ev.data.celladdress[0]),\n\t\t\tparseInt(ev.data.celladdress[1]),\n\t\t);\n\t\tev.data.celladdress.pX -=\n\t\t\tapp.sectionContainer.getDocumentTopLeft()[0] -\n\t\t\tapp.sectionContainer.getDocumentAnchor()[0];\n\t\tev.data.celladdress.pY -=\n\t\t\tapp.sectionContainer.getDocumentTopLeft()[1] -\n\t\t\tapp.sectionContainer.getDocumentAnchor()[1];\n\n\t\tconst entry = ev.data.text;\n\t\tlet data: PopupData;\n\n\t\tif (entry.length > 0) {\n\t\t\tthis.closeAutoFillPreviewPopup();\n\t\t\tconst control = this.getSimpleTextJSON(entry);\n\t\t\tif (L.DomUtil.get(this.popupId + 'fixedtext')) {\n\t\t\t\tdata = this.getPopupJSON(control, {\n\t\t\t\t\tx: ev.data.celladdress.cX,\n\t\t\t\t\ty: ev.data.celladdress.cY,\n\t\t\t\t});\n\t\t\t\tthis.sendUpdate(data);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (L.DomUtil.get(this.popupId)) this.closeAutoFillPreviewPopup();\n\t\t\tdata = Object.assign({}, this.newPopupData);\n\t\t\tdata.children[0].children[0] = control;\n\t\t}\n\n\t\t// add position\n\t\tdata.posx = ev.data.celladdress.cX;\n\t\tdata.posy = ev.data.celladdress.cY;\n\t\tthis.sendJSON(data);\n\t}\n\n\tcloseAutoFillPreviewPopup(): void {\n\t\tsuper.closePopup();\n\t}\n}\nL.control.autofillpreviewtooltip = function (map: any) {\n\treturn new AutoFillPreviewTooltip(map);\n};\n"]}