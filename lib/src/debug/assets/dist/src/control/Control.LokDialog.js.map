{"version":3,"file":"Control.LokDialog.js","sourceRoot":"","sources":["../../../../../../../../../../TanhX/online/browser/src/control/Control.LokDialog.js"],"names":[],"mappings":"AAAA,gCAAgC;AAChC;;;;;;;;GAQG;AACH;;GAEG;AAEH,wDAAwD;AAExD,CAAC,CAAC,OAAO,GAAG,EAEX,CAAC;AAEF,IAAI,mBAAmB,GAAG,IAAI,CAAC;AAC/B,IAAI,mBAAmB,GAAG,IAAI,CAAC;AAC/B,IAAI,iBAAiB,GAAG,IAAI,CAAC;AAE7B,SAAS,oBAAoB,CAAC,MAAM;IACnC,IAAI,MAAM,KAAK,IAAI,IAAI,MAAM,KAAK,SAAS,EAAE;QAC5C,IAAI,KAAK,GAAG;YACX,cAAc,GAAG,MAAM,CAAC,cAAc,CAAC,SAAS,CAAC,CAAC,GAAG,MAAM,GAAG,MAAM,CAAC,cAAc,CAAC,SAAS,CAAC,CAAC,GAAG,QAAQ;YAC1G,QAAQ,GAAG,MAAM,CAAC,cAAc,CAAC,KAAK,GAAG,IAAI,GAAG,MAAM,CAAC,cAAc,CAAC,KAAK,GAAG,GAAG;SACjF,CAAC;QAEF,KAAK,GAAG,KAAK,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;QACxB,MAAM,CAAC,KAAK,CAAC,KAAK,CAAC,eAAe,GAAG,KAAK,CAAC;QAC3C,MAAM,CAAC,KAAK,CAAC,KAAK,CAAC,YAAY,GAAG,KAAK,CAAC;QACxC,MAAM,CAAC,KAAK,CAAC,KAAK,CAAC,SAAS,GAAG,KAAK,CAAC;QAErC,IAAI,MAAM,CAAC,cAAc,CAAC,MAAM,EAAE;YACjC,MAAM,CAAC,KAAK,CAAC,KAAK,CAAC,CAAC,CAAC,OAAO,CAAC,gBAAgB,CAAC,GAAG,MAAM,CAAC,cAAc,CAAC,MAAM,CAAC;SAC9E;KACD;AACF,CAAC;AAED,IAAI,aAAa,GAAG,IAAI,CAAC;AAEzB,IAAI,WAAW,GAAG,EAAE,CAAC;AAErB,SAAS,cAAc,CAAC,EAAE;IACzB,KAAK,IAAI,IAAI,IAAI,WAAW,EAAE;QAC7B,IAAI,WAAW,CAAC,IAAI,CAAC,CAAC,GAAG,KAAK,EAAE,IAAI,WAAW,CAAC,IAAI,CAAC,CAAC,QAAQ,CAAC,EAAE,KAAK,EAAE,EAAE;YACzE,OAAO,WAAW,CAAC,IAAI,CAAC,CAAC;SACzB;KACD;IACD,OAAO,IAAI,CAAC;AACb,CAAC;AAED,SAAS,gBAAgB,CAAC,EAAE;IAC3B,KAAK,IAAI,IAAI,IAAI,WAAW,EAAE;QAC7B,IAAI,WAAW,CAAC,IAAI,CAAC,CAAC,GAAG,KAAK,EAAE,IAAI,WAAW,CAAC,IAAI,CAAC,CAAC,QAAQ,CAAC,EAAE,KAAK,EAAE,EAAE;YACzE,OAAO,WAAW,CAAC,IAAI,CAAC,CAAC;SACzB;KACD;AACF,CAAC;AAED,SAAS,cAAc,CAAC,EAAE;IACzB,OAAO,EAAE,CAAC,OAAO,CAAC,SAAS,EAAE,EAAE,CAAC,CAAC;AAClC,CAAC;AAED,CAAC,CAAC,OAAO,CAAC,SAAS,GAAG,CAAC,CAAC,OAAO,CAAC,MAAM,CAAC;IAEtC,cAAc,EAAE,YAAY;IAE5B,4BAA4B,EAAE;QAC7B,OAAO,MAAM,CAAC,cAAc,KAAK,SAAS,CAAC;IAC5C,CAAC;IAED,KAAK,EAAE,UAAU,EAAE;QAClB,IAAI,CAAC,aAAa;YACjB,OAAO;QAER,IAAI,EAAE,GAAG,cAAc,CAAC,aAAa,CAAC,EAAE,CAAC,CAAC;QAC1C,IAAI,MAAM,GAAG,cAAc,CAAC,EAAE,CAAC,CAAC;QAEhC,IAAI,MAAM,EAAE;YACX,IAAI,IAAI,GAAG,MAAM,CAAC,YAAY,CAAC,MAAM,GAAG,EAAE,CAAC,MAAM,CAAC;YAClD,IAAI,IAAI,GAAG,MAAM,CAAC,YAAY,CAAC,MAAM,GAAG,EAAE,CAAC,MAAM,CAAC;YAElD,6CAA6C;YAC7C,IAAI,MAAM,CAAC,IAAI,CAAC,SAAS,EAAE;gBAC1B,CAAC,IAAI,GAAG,CAAC,MAAM,CAAC,KAAK,GAAC,CAAC,IAAI,IAAI,GAAG,CAAC,MAAM,CAAC,MAAM,GAAC,CAAC;uBAC/C,IAAI,GAAG,MAAM,CAAC,UAAU,GAAG,MAAM,CAAC,KAAK,GAAC,CAAC;uBACzC,IAAI,GAAG,MAAM,CAAC,WAAW,GAAG,MAAM,CAAC,MAAM,GAAC,CAAC,CAAC,EAAE;gBACjD,IAAI,MAAM,GAAG,CAAC,CAAC,sBAAsB,CAAC,CAAC;gBACvC,IAAI,IAAI,GAAG,UAAU,CAAC,MAAM,CAAC,GAAG,CAAC,MAAM,CAAC,CAAC,CAAC;gBAC1C,IAAI,GAAG,GAAG,UAAU,CAAC,MAAM,CAAC,GAAG,CAAC,KAAK,CAAC,CAAC,CAAC;gBACxC,IAAI,GAAG,IAAI,CAAC,GAAG,CAAC,IAAI,EAAE,CAAC,IAAI,CAAC,CAAC;gBAC7B,IAAI,GAAG,IAAI,CAAC,GAAG,CAAC,IAAI,EAAE,CAAC,GAAG,CAAC,CAAC;aAC5B;YAED,MAAM,CAAC,cAAc,CAAC,SAAS,GAAG;gBACjC,CAAC,EAAE,IAAI;gBACP,CAAC,EAAE,IAAI;aACP,CAAC;YAEF,MAAM,CAAC,cAAc,CAAC,SAAS,GAAG;gBACjC,CAAC,EAAE,IAAI;gBACP,CAAC,EAAE,IAAI;aACP,CAAC;YAEF,oBAAoB,CAAC,MAAM,CAAC,CAAC;SAC7B;IACF,CAAC;IAED,OAAO,EAAE,UAAU,EAAE;QACpB,IAAI,EAAE,GAAG,cAAc,CAAC,EAAE,CAAC,MAAM,CAAC,EAAE,CAAC,CAAC;QACtC,IAAI,MAAM,GAAG,cAAc,CAAC,EAAE,CAAC,CAAC;QAEhC,IAAI,MAAM,EAAE;YACX,IAAI,EAAE,CAAC,IAAI,IAAI,YAAY,EAAE;gBAC5B,MAAM,CAAC,YAAY,CAAC,SAAS,GAAG,MAAM,CAAC,cAAc,CAAC,KAAK,IAAI,CAAC,CAAC;aACjE;YAED,IAAI,MAAM,CAAC,YAAY,CAAC,SAAS,GAAG,EAAE,CAAC,KAAK,GAAG,GAAG,EAAE;gBACnD,MAAM,CAAC,cAAc,CAAC,KAAK,GAAG,MAAM,CAAC,YAAY,CAAC,SAAS,GAAG,EAAE,CAAC,KAAK,CAAC;aACvE;YAED,oBAAoB,CAAC,MAAM,CAAC,CAAC;SAC7B;IACF,CAAC;IAED,KAAK,EAAE,UAAU,GAAG;QACnB,GAAG,CAAC,EAAE,CAAC,QAAQ,EAAE,IAAI,CAAC,YAAY,EAAE,IAAI,CAAC,CAAC;QAC1C,GAAG,CAAC,EAAE,CAAC,aAAa,EAAE,IAAI,CAAC,cAAc,EAAE,IAAI,CAAC,CAAC;QACjD,GAAG,CAAC,EAAE,CAAC,WAAW,EAAE,IAAI,CAAC,UAAU,EAAE,IAAI,CAAC,CAAC;QAC3C,GAAG,CAAC,EAAE,CAAC,YAAY,EAAE,IAAI,CAAC,mBAAmB,EAAE,IAAI,CAAC,CAAC;QACrD,GAAG,CAAC,EAAE,CAAC,aAAa,EAAE,IAAI,CAAC,cAAc,EAAE,IAAI,CAAC,CAAC;QACjD,GAAG,CAAC,EAAE,CAAC,gBAAgB,EAAE,IAAI,CAAC,iBAAiB,EAAE,IAAI,CAAC,CAAC;QACvD,yDAAyD;QACzD,GAAG,CAAC,EAAE,CAAC,mBAAmB,EAAE,IAAI,CAAC,kBAAkB,EAAE,IAAI,CAAC,CAAC;QAC3D,CAAC,CAAC,QAAQ,CAAC,EAAE,CAAC,QAAQ,EAAE,SAAS,EAAE,IAAI,CAAC,mBAAmB,EAAE,IAAI,CAAC,CAAC;IACpE,CAAC;IAED,QAAQ,EAAE,EAAE;IAEZ,eAAe,EAAE;QAChB,OAAO,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC,MAAM,GAAG,CAAC,CAAC;IAC9C,CAAC;IAED,yBAAyB,EAAE;QAC1B,IAAI,IAAI,CAAC,UAAU;YAClB,OAAO,QAAQ,CAAC,cAAc,CAAC,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC,KAAK,CAAC,CAAC;;YAErE,OAAO,IAAI,CAAC;IACd,CAAC;IAED,iDAAiD;IACjD,eAAe,EAAE;QAChB,CAAC,CAAC,sBAAsB,CAAC,CAAC,QAAQ,CAAC,UAAU,CAAC,CAAC;QAC/C,UAAU,CAAC;YACV,CAAC,CAAC,sBAAsB,CAAC,CAAC,WAAW,CAAC,UAAU,CAAC,CAAC;QACnD,CAAC,EAAE,GAAG,CAAC,CAAC;IACT,CAAC;IAED,UAAU,EAAE,UAAS,CAAC;QACrB,IAAI,CAAC,CAAC,CAAC,MAAM,EAAE;YACd,CAAC,CAAC,+CAA+C,CAAC,CAAC,MAAM,EAAE,CAAC;YAC5D,CAAC,CAAC,wBAAwB,CAAC,CAAC,MAAM,EAAE,CAAC;SACrC;IACF,CAAC;IAED,YAAY,EAAE,UAAS,EAAE;QACxB,EAAE,GAAG,QAAQ,CAAC,EAAE,CAAC,CAAC;QAClB,KAAK,IAAI,KAAK,IAAI,IAAI,CAAC,QAAQ,EAAE;YAChC,IAAI,IAAI,CAAC,QAAQ,CAAC,KAAK,CAAC,CAAC,OAAO,IAAI,IAAI,CAAC,QAAQ,CAAC,KAAK,CAAC,CAAC,OAAO,KAAK,EAAE,EAAE;gBACxE,OAAO,KAAK,CAAC;aACb;SACD;QACD,OAAO,IAAI,CAAC;IACb,CAAC;IAED,OAAO,EAAE,UAAS,EAAE;QACnB,OAAO,CAAC,EAAE,IAAI,IAAI,CAAC,QAAQ,CAAC,IAAI,IAAI,CAAC,QAAQ,CAAC,EAAE,CAAC;YAChD,CAAC,CAAC,GAAG,GAAG,IAAI,CAAC,QAAQ,CAAC,EAAE,CAAC,CAAC,CAAC,MAAM,GAAG,CAAC,CAAC;IACxC,CAAC;IAED,eAAe,EAAE,UAAS,EAAE;QAC3B,OAAO,CAAC,EAAE,IAAI,IAAI,CAAC,QAAQ,CAAC,IAAI,IAAI,CAAC,QAAQ,CAAC,EAAE,CAAC,CAAC,aAAa,CAAC;IACjE,CAAC;IAED,kBAAkB,EAAE,UAAS,EAAE;QAC9B,OAAO,CAAC,CAAC,OAAO,CAAC,QAAQ,CAAC,EAAE,EAAE,6BAA6B,CAAC;YAC3D,CAAC,CAAC,OAAO,CAAC,QAAQ,CAAC,EAAE,EAAE,2BAA2B,CAAC,CAAC;IACtD,CAAC;IAED,wEAAwE;IACxE,QAAQ,EAAE,UAAS,EAAE;QACpB,IAAI,OAAM,CAAC,EAAE,CAAC,KAAK,QAAQ;YAC1B,OAAO,QAAQ,CAAC,EAAE,CAAC,OAAO,CAAC,IAAI,CAAC,cAAc,EAAE,EAAE,CAAC,CAAC,CAAC;QACtD,OAAO,EAAE,CAAC;IACX,CAAC;IAED,yDAAyD;IACzD,QAAQ,EAAE,UAAS,EAAE;QACpB,OAAO,IAAI,CAAC,cAAc,GAAG,EAAE,CAAC;IACjC,CAAC;IAED,uDAAuD;IACvD,iEAAiE;IACjE,cAAc,EAAE,UAAS,EAAE,EAAE,CAAC,EAAE,CAAC,EAAE,KAAK,EAAE,MAAM;QAC/C,IAAI,CAAC,KAAK,IAAI,EAAE,KAAK,IAAI;YACxB,KAAK,GAAG,IAAI,CAAC,QAAQ,CAAC,QAAQ,CAAC,EAAE,CAAC,CAAC,CAAC,KAAK,CAAC;QAC3C,IAAI,CAAC,KAAK,IAAI,KAAK,IAAI,CAAC;YACvB,OAAO,IAAI,CAAC;QACb,IAAI,CAAC,MAAM,IAAI,EAAE,KAAK,IAAI;YACzB,MAAM,GAAG,IAAI,CAAC,QAAQ,CAAC,QAAQ,CAAC,EAAE,CAAC,CAAC,CAAC,MAAM,CAAC;QAC7C,IAAI,CAAC,MAAM,IAAI,MAAM,IAAI,CAAC;YACzB,OAAO,IAAI,CAAC;QACb,IAAI,CAAC,CAAC;YACL,CAAC,GAAG,CAAC,CAAC;QACP,IAAI,CAAC,CAAC;YACL,CAAC,GAAG,CAAC,CAAC;QAEP,qCAAqC;QACrC,OAAO,CAAC,CAAC,GAAG,GAAG,CAAC,eAAe,EAAE,CAAC,GAAG,GAAG,CAAC,eAAe,EAAE,KAAK,GAAG,GAAG,CAAC,eAAe,EAAE,MAAM,GAAG,GAAG,CAAC,eAAe,CAAC,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;IAChI,CAAC;IAED,oBAAoB,EAAE,UAAS,EAAE,EAAE,CAAC,EAAE,CAAC,EAAE,KAAK,EAAE,MAAM;QACrD,IAAI,CAAC,gBAAgB,CAAC,EAAE,EAAE,IAAI,CAAC,cAAc,CAAC,EAAE,EAAE,CAAC,EAAE,CAAC,EAAE,KAAK,EAAE,MAAM,CAAC,CAAC,CAAC;IACzE,CAAC;IAED,oCAAoC;IACpC,iBAAiB,EAAE,UAAS,EAAE,EAAE,SAAS;QACxC,IAAI,KAAK,GAAG,IAAI,CAAC,QAAQ,CAAC,EAAE,CAAC,CAAC;QAC9B,IAAI,MAAM,GAAG,QAAQ,CAAC,cAAc,CAAC,KAAK,GAAG,SAAS,CAAC,CAAC;QACxD,IAAI,CAAC,MAAM;YACV,OAAO,CAAC,wBAAwB;QACjC,IAAI,GAAG,GAAG,MAAM,CAAC,UAAU,CAAC,IAAI,CAAC,CAAC;QAClC,GAAG,CAAC,SAAS,EAAE,CAAC;QAChB,IAAI,IAAI,GAAG,SAAS,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC;QAChC,GAAG,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC,EAAE,IAAI,CAAC,CAAC,CAAC,EAAE,IAAI,CAAC,CAAC,CAAC,EAAE,IAAI,CAAC,CAAC,CAAC,CAAC,CAAC;QAC7C,GAAG,CAAC,SAAS,GAAG,sBAAsB,CAAC;QACvC,GAAG,CAAC,IAAI,EAAE,CAAC;IACZ,CAAC;IAED,gBAAgB,EAAE,UAAS,EAAE,EAAE,SAAS;QACvC,IAAI,CAAC,SAAS;YACb,OAAO,CAAC,yCAAyC;QAElD,SAAS,GAAG,SAAS,CAAC,OAAO,CAAC,IAAI,EAAE,EAAE,CAAC,CAAC;QACxC,IAAI,CAAC,SAAS;YACb,OAAO,CAAC,yCAAyC;QAElD,kGAAkG;QAClG,GAAG,CAAC,MAAM,CAAC,WAAW,CAAC,cAAc,GAAG,EAAE,GAAG,aAAa,GAAG,SAAS,GAAG,YAAY,GAAG,GAAG,CAAC,eAAe,CAAC,CAAC;QAE7G,IAAI,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC,OAAO;YAC3B,IAAI,CAAC,iBAAiB,CAAC,EAAE,EAAE,SAAS,CAAC,CAAC;IACxC,CAAC;IAED,gBAAgB,EAAE,UAAS,EAAE;QAC5B,GAAG,CAAC,MAAM,CAAC,WAAW,CAAC,gBAAgB,GAAG,EAAE,GAAG,QAAQ,CAAC,CAAC;QACzD,4EAA4E;QAC5E,+EAA+E;QAC/E,+EAA+E;QAC/E,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,UAAU,IAAI,CAAC,MAAM,CAAC,mBAAmB,EAAE;YACzD,GAAG,CAAC,UAAU,CAAC,QAAQ,CAAC,UAAU,CAAC,CAAC;SACpC;IACF,CAAC;IAED,iBAAiB,EAAE,UAAS,IAAI;QAC/B,IAAI,GAAG,IAAI,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC;QACvB,OAAO,CAAC,CAAC,KAAK,CAAC,QAAQ,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,KAAK,CAAC,QAAQ,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,CAAC;YAC5D,QAAQ,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,IAAI,QAAQ,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC;IACrD,CAAC;IAED,YAAY,EAAE,UAAS,CAAC;QACvB,kKAAkK;QAClK,IAAI,CAAC,CAAC,OAAO,IAAI,SAAS;YACtB,CAAC,CAAC,OAAO,KAAK,QAAQ;YACtB,CAAC,CAAC,OAAO,KAAK,gBAAgB;YAC9B,CAAC,CAAC,OAAO,KAAK,OAAO;YACrB,CAAC,CAAC,OAAO,KAAK,MAAM;YACpB,CAAC,CAAC,OAAO,KAAK,SAAS;YACvB,CAAC,CAAC,OAAO,KAAK,UAAU,EAAE;YAC7B,OAAO;SACP;QAED,CAAC,CAAC,EAAE,GAAG,QAAQ,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC;QACtB,IAAI,KAAK,GAAG,IAAI,CAAC,QAAQ,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC;QAEhC,IAAI,KAAK,GAAG,CAAC,CAAC;QACd,IAAI,MAAM,GAAG,CAAC,CAAC;QACf,IAAI,CAAC,CAAC,IAAI,EAAE;YACX,KAAK,GAAG,QAAQ,CAAC,CAAC,CAAC,IAAI,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;YACvC,MAAM,GAAG,QAAQ,CAAC,CAAC,CAAC,IAAI,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;SACxC;QAED,IAAI,IAAI,CAAC;QACT,IAAI,GAAG,CAAC;QACR,IAAI,CAAC,CAAC,QAAQ,EAAE;YACf,IAAI,GAAG,QAAQ,CAAC,CAAC,CAAC,QAAQ,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;YAC1C,GAAG,GAAG,QAAQ,CAAC,CAAC,CAAC,QAAQ,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;SACzC;QAED,IAAI,CAAC,CAAC,KAAK,IAAI,OAAO,gBAAgB,KAAK,WAAW,EAAE;YACvD,CAAC,CAAC,KAAK,GAAG,CAAC,CAAC,KAAK,CAAC,OAAO,CAAC,kBAAkB,EAAE,gBAAgB,CAAC,CAAC;SAChE;QAED,IAAI,CAAC,CAAC,MAAM,KAAK,SAAS,EAAE;YAC3B,IAAI,CAAC,CAAC,CAAC,OAAO,KAAK,QAAQ,IAAI,CAAC,CAAC,OAAO,KAAK,UAAU,CAAC,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,QAAQ,EAAE,EAAE;gBACpF,6DAA6D;gBAC7D,IAAI,CAAC,aAAa,CAAC,CAAC,CAAC,EAAE,EAAE,IAAI,EAAE,GAAG,EAAE,KAAK,EAAE,MAAM,EAAE,CAAC,CAAC,KAAK,EAAE,IAAI,EAAE,CAAC,CAAC,SAAS,CAAC,CAAC;aAC/E;iBAAM,IAAI,CAAC,CAAC,OAAO,KAAK,OAAO,IAAI,CAAC,CAAC,OAAO,KAAK,SAAS,EAAE;gBAC5D,IAAI,QAAQ,GAAG,QAAQ,CAAC,CAAC,CAAC,QAAQ,CAAC,CAAC;gBACpC,IAAI,CAAC,IAAI,CAAC,OAAO,CAAC,QAAQ,CAAC;oBAC1B,OAAO;gBAER,wDAAwD;gBACxD,iCAAiC;gBACjC,IAAI,CAAC,CAAC,OAAO,KAAK,SAAS;oBACvB,IAAI,CAAC,QAAQ,CAAC,QAAQ,CAAC,CAAC,OAAO,KAAK,SAAS;oBAC7C,IAAI,CAAC,QAAQ,CAAC,QAAQ,CAAC,CAAC,cAAc,KAAK,IAAI;oBAClD,OAAO;gBAER,IAAI,CAAC,IAAI;oBACR,IAAI,GAAG,CAAC,CAAC;gBACV,IAAI,CAAC,GAAG;oBACP,GAAG,GAAG,CAAC,CAAC;gBACT,IAAI,CAAC,kBAAkB,CAAC,QAAQ,CAAC,CAAC;gBAElC,IAAI,CAAC,QAAQ,CAAC,QAAQ,CAAC,CAAC,OAAO,GAAG,CAAC,CAAC,EAAE,CAAC;gBACvC,IAAI,CAAC,QAAQ,CAAC,QAAQ,CAAC,CAAC,UAAU,GAAG,KAAK,CAAC;gBAC3C,IAAI,CAAC,QAAQ,CAAC,QAAQ,CAAC,CAAC,WAAW,GAAG,MAAM,CAAC;gBAC7C,IAAI,CAAC,QAAQ,CAAC,QAAQ,CAAC,CAAC,MAAM,GAAG,IAAI,CAAC;gBACtC,IAAI,CAAC,QAAQ,CAAC,QAAQ,CAAC,CAAC,MAAM,GAAG,GAAG,CAAC;gBAErC,IAAI,CAAC,CAAC,OAAO,KAAK,SAAS;oBAC1B,IAAI,CAAC,QAAQ,CAAC,QAAQ,CAAC,CAAC,cAAc,GAAG,IAAI,CAAC;;oBAE9C,IAAI,CAAC,QAAQ,CAAC,QAAQ,CAAC,CAAC,cAAc,GAAG,KAAK,CAAC;gBAChD,IAAI,CAAC,kBAAkB,CAAC,CAAC,CAAC,EAAE,EAAE,QAAQ,EAAE,GAAG,EAAE,IAAI,CAAC,CAAC;gBACnD,IAAI,CAAC,gBAAgB,CAAC,CAAC,CAAC,EAAE,EAAE,IAAI,CAAC,cAAc,CAAC,IAAI,EAAE,CAAC,EAAE,CAAC,EAAE,KAAK,EAAE,MAAM,CAAC,CAAC,CAAC;aAC5E;SACD;QAED,iEAAiE;QACjE,IAAI,CAAC,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC,CAAC,EAAE,CAAC,IAAI,IAAI,CAAC,YAAY,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,EAAE;YACrD,IAAI,CAAC,CAAC,MAAM,IAAI,OAAO,IAAI,MAAM,CAAC,cAAc,IAAI,CAAC,CAAC,EAAE,EAAE;gBACzD,MAAM,CAAC,cAAc,GAAG,SAAS,CAAC;gBAClC,sCAAsC;aACtC;YACD,OAAO;SACP;QAED,0EAA0E;QAC1E,IAAI,MAAM,CAAC,IAAI,CAAC,QAAQ,EAAE;YACzB,OAAO;QAER,IAAI,CAAC,CAAC,MAAM,KAAK,YAAY,EAAE;YAC9B,IAAI,CAAC,cAAc,GAAG,IAAI,CAAC;YAC3B,IAAI,MAAM,GAAG,IAAI,CAAC,YAAY,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC;YACrC,IAAI,SAAS,GAAG,CAAC,CAAC,SAAS,CAAC;YAC5B,IAAI,MAAM,EAAE,EAAE,4BAA4B;gBACzC,IAAI,CAAC,CAAC,SAAS,IAAI,IAAI,CAAC,QAAQ,CAAC,MAAM,CAAC,CAAC,cAAc,KAAK,IAAI,EAAE;oBACjE,kCAAkC;oBAClC,IAAI,CAAC,kBAAkB,CAAC,MAAM,CAAC,CAAC;oBAChC,IAAI,GAAG,IAAI,CAAC,QAAQ,CAAC,MAAM,CAAC,CAAC,MAAM,CAAC;oBACpC,GAAG,GAAG,IAAI,CAAC,QAAQ,CAAC,MAAM,CAAC,CAAC,MAAM,CAAC;oBACnC,KAAK,GAAG,QAAQ,CAAC,CAAC,CAAC,SAAS,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;oBAC5C,MAAM,GAAG,QAAQ,CAAC,CAAC,CAAC,SAAS,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;oBAC7C,IAAI,CAAC,QAAQ,CAAC,MAAM,CAAC,CAAC,UAAU,GAAG,KAAK,CAAC;oBACzC,IAAI,CAAC,QAAQ,CAAC,MAAM,CAAC,CAAC,WAAW,GAAG,MAAM,CAAC;oBAC3C,IAAI,CAAC,kBAAkB,CAAC,CAAC,CAAC,EAAE,EAAE,MAAM,EAAE,GAAG,EAAE,IAAI,CAAC,CAAC;iBACjD;gBAED,SAAS,GAAG,IAAI,CAAC,cAAc,CAAC,IAAI,EAAE,CAAC,EAAE,CAAC,EAAE,IAAI,CAAC,QAAQ,CAAC,MAAM,CAAC,CAAC,UAAU,EAAE,IAAI,CAAC,QAAQ,CAAC,MAAM,CAAC,CAAC,WAAW,CAAC,CAAC;aACjH;iBAAM,IAAI,SAAS,EAAE,EAAE,4BAA4B;gBACnD,IAAI,IAAI,CAAC,iBAAiB,CAAC,SAAS,CAAC,EAAE;oBACtC,SAAS,GAAG,CAAC,CAAC,SAAS,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC;oBACnC,CAAC,GAAG,QAAQ,CAAC,SAAS,CAAC,CAAC,CAAC,CAAC,CAAC;oBAC3B,CAAC,GAAG,QAAQ,CAAC,SAAS,CAAC,CAAC,CAAC,CAAC,CAAC;oBAC3B,KAAK,GAAG,QAAQ,CAAC,SAAS,CAAC,CAAC,CAAC,CAAC,CAAC;oBAC/B,MAAM,GAAG,QAAQ,CAAC,SAAS,CAAC,CAAC,CAAC,CAAC,CAAC;oBAEhC,SAAS,GAAG,IAAI,CAAC,cAAc,CAAC,IAAI,EAAE,CAAC,EAAE,CAAC,EAAE,KAAK,EAAE,MAAM,CAAC,CAAC;iBAC3D;qBAAM;oBACN,OAAO;iBACP;aACD;iBAAM;gBACN,SAAS,GAAG,IAAI,CAAC,cAAc,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC;aACtC;YACD,IAAI,CAAC,gBAAgB,CAAC,CAAC,CAAC,EAAE,EAAE,SAAS,CAAC,CAAC;SACvC;aAAM,IAAI,CAAC,CAAC,MAAM,KAAK,cAAc,EAAE;YACvC,mFAAmF;YACnF,4EAA4E;YAC5E,CAAC,CAAC,GAAG,GAAG,KAAK,CAAC,CAAC,MAAM,EAAE,CAAC;YACxB,IAAI,CAAC,aAAa,CAAC,CAAC,CAAC,EAAE,EAAE,IAAI,EAAE,IAAI,EAAE,KAAK,EAAE,MAAM,EAAE,IAAI,CAAC,QAAQ,CAAC,QAAQ,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,KAAK,EAAE,IAAI,EAAE,CAAC,CAAC,SAAS,CAAC,CAAC;YAC5G,IAAI,IAAI,CAAC,IAAI,CAAC,SAAS,IAAI,IAAI,CAAC,IAAI,CAAC,SAAS,CAAC,QAAQ,KAAK,aAAa,EAAE;gBAC1E,IAAI,GAAG,CAAC,gBAAgB,CAAC,gBAAgB,CAAC,CAAC,CAAC,SAAS,CAAC,SAAS,CAAC,IAAI,CAAC,EAAE;oBACtE,GAAG,CAAC,gBAAgB,CAAC,kBAAkB,CAAC,CAAC,CAAC,SAAS,CAAC,SAAS,CAAC,IAAI,CAAC,CAAC,aAAa,EAAE,CAAC;oBACpF,GAAG,CAAC,gBAAgB,CAAC,kBAAkB,CAAC,CAAC,CAAC,SAAS,CAAC,YAAY,CAAC,IAAI,CAAC,CAAC,aAAa,EAAE,CAAC;iBACvF;aACD;SACD;aAAM,IAAI,CAAC,CAAC,MAAM,KAAK,mBAAmB,EAAE;YAC5C,IAAI,IAAI,CAAC,OAAO,CAAC,CAAC,CAAC,EAAE,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,SAAS,EAAE;gBACxC,SAAS,GAAG,CAAC,CAAC,SAAS,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC;gBACnC,IAAI,CAAC,GAAG,QAAQ,CAAC,SAAS,CAAC,CAAC,CAAC,CAAC,CAAC;gBAC/B,IAAI,CAAC,GAAG,QAAQ,CAAC,SAAS,CAAC,CAAC,CAAC,CAAC,CAAC;gBAC/B,MAAM,GAAG,QAAQ,CAAC,SAAS,CAAC,CAAC,CAAC,CAAC,CAAC;gBAEhC,IAAI,CAAC,mBAAmB,CAAC,CAAC,CAAC,EAAE,EAAE,CAAC,EAAE,CAAC,EAAE,MAAM,CAAC,CAAC;aAC7C;SACD;aAAM,IAAI,CAAC,CAAC,MAAM,KAAK,gBAAgB,EAAE;YACzC,IAAI,IAAI,CAAC,OAAO,CAAC,CAAC,CAAC,EAAE,CAAC,EAAE;gBACvB,IAAI,UAAU,GAAG,EAAE,CAAC;gBACpB,IAAI,kBAAkB,EAAE,gBAAgB,CAAC;gBACzC,IAAI,CAAC,CAAC,UAAU,EAAE;oBACjB,IAAI,QAAQ,GAAG,CAAC,CAAC,UAAU,CAAC,KAAK,CAAC,MAAM,CAAC,CAAC;oBAC1C,IAAI,QAAQ,IAAI,IAAI,EAAE;wBACrB,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,QAAQ,CAAC,MAAM,EAAE,CAAC,IAAI,CAAC,EAAE;4BAC5C,IAAI,IAAI,GAAG,EAAE,CAAC;4BACd,IAAI,CAAC,CAAC,GAAG,QAAQ,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAC,CAAC;4BAC/B,IAAI,CAAC,CAAC,GAAG,QAAQ,CAAC,QAAQ,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC;4BACnC,IAAI,CAAC,KAAK,GAAG,QAAQ,CAAC,QAAQ,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC;4BACvC,IAAI,CAAC,MAAM,GAAG,QAAQ,CAAC,QAAQ,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC;4BACxC,UAAU,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;yBACtB;qBACD;iBACD;gBAED,IAAI,CAAC,CAAC,kBAAkB,EAAE;oBACzB,kBAAkB,GAAG,CAAC,CAAC,kBAAkB,KAAK,MAAM,CAAC;iBACrD;gBACD,IAAI,CAAC,CAAC,gBAAgB,EAAE;oBACvB,gBAAgB,GAAG,CAAC,CAAC,gBAAgB,KAAK,MAAM,CAAC;iBACjD;gBACD,IAAI,CAAC,oBAAoB,CAAC,CAAC,CAAC,EAAE,EAAE,UAAU,EAAE,kBAAkB,EAAE,gBAAgB,CAAC,CAAC;aAClF;SACD;aAAM,IAAI,CAAC,CAAC,MAAM,KAAK,eAAe,EAAE;YACxC,IAAI,CAAC,CAAC,KAAK,IAAI,IAAI,CAAC,QAAQ,CAAC,QAAQ,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,EAAE;gBAC7C,IAAI,CAAC,QAAQ,CAAC,QAAQ,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,KAAK,GAAG,CAAC,CAAC,KAAK,CAAC;gBAC9C,CAAC,CAAC,GAAG,GAAG,KAAK,CAAC,CAAC,MAAM,CAAC,QAAQ,EAAE,OAAO,EAAE,CAAC,CAAC,KAAK,CAAC,CAAC;aAClD;SACD;aAAM,IAAI,CAAC,CAAC,MAAM,KAAK,gBAAgB,EAAE;YACzC,oDAAoD;YACpD,uDAAuD;YACvD,IAAI,OAAO,GAAG,CAAC,CAAC,CAAC,OAAO,KAAK,MAAM,CAAC,CAAC;YACrC,IAAI,CAAC,QAAQ,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,aAAa,GAAG,OAAO,CAAC;YAC5C,IAAI,OAAO,EAAE;gBACZ,CAAC,CAAC,GAAG,GAAG,KAAK,GAAG,SAAS,CAAC,CAAC,GAAG,CAAC,EAAC,OAAO,EAAE,OAAO,EAAC,CAAC,CAAC;gBACnD,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,mBAAmB,EAAE,EAAC,KAAK,EAAE,CAAC,CAAC,EAAE,EAAE,MAAM,EAAE,IAAI,EAAE,WAAW,EAAE,IAAI,EAAC,CAAC,CAAC,CAAC,MAAM;aAC3F;iBACI;gBACJ,CAAC,CAAC,GAAG,GAAG,KAAK,GAAG,SAAS,CAAC,CAAC,GAAG,CAAC,EAAC,OAAO,EAAE,MAAM,EAAC,CAAC,CAAC;aAClD;SACD;aAAM,IAAI,CAAC,CAAC,MAAM,KAAK,OAAO,EAAE;YAChC,MAAM,GAAG,IAAI,CAAC,YAAY,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC;YACjC,IAAI,MAAM;gBACT,IAAI,CAAC,mBAAmB,CAAC,MAAM,CAAC,CAAC;;gBAEjC,IAAI,CAAC,cAAc,CAAC,CAAC,CAAC,EAAE,EAAE,KAAK,CAAC,CAAC;SAClC;aAAM,IAAI,CAAC,CAAC,MAAM,KAAK,MAAM,EAAE;YAC/B,CAAC,CAAC,GAAG,GAAG,KAAK,CAAC,CAAC,MAAM,EAAE,CAAC,GAAG,CAAC,EAAC,OAAO,EAAE,MAAM,EAAC,CAAC,CAAC;SAC/C;aAAM,IAAI,CAAC,CAAC,MAAM,KAAK,MAAM,EAAE;YAC/B,CAAC,CAAC,GAAG,GAAG,KAAK,CAAC,CAAC,MAAM,EAAE,CAAC,GAAG,CAAC,EAAC,OAAO,EAAE,OAAO,EAAC,CAAC,CAAC;SAChD;IACF,CAAC;IAED,mBAAmB,EAAE,UAAS,KAAK,EAAE,CAAC,EAAE,CAAC,EAAE,MAAM;QAChD,IAAI,KAAK,GAAG,IAAI,CAAC,QAAQ,CAAC,KAAK,CAAC,CAAC;QACjC,IAAI,YAAY,GAAG,CAAC,CAAC,OAAO,CAAC,GAAG,CAAC,KAAK,GAAG,SAAS,CAAC,CAAC;QACpD,IAAI,aAAa,GAAG,IAAI,CAAC,eAAe,CAAC,KAAK,CAAC,CAAC;QAChD,CAAC,CAAC,OAAO,CAAC,QAAQ,CAAC,YAAY,EAAE,QAAQ,EAAE,MAAM,GAAG,IAAI,CAAC,CAAC;QAC1D,CAAC,CAAC,OAAO,CAAC,QAAQ,CAAC,YAAY,EAAE,SAAS,EAAE,aAAa,CAAC,CAAC,CAAC,OAAO,CAAC,CAAC,CAAC,MAAM,CAAC,CAAC;QAC9E,mDAAmD;QACnD,CAAC,CAAC,OAAO,CAAC,QAAQ,CAAC,IAAI,CAAC,QAAQ,CAAC,KAAK,CAAC,CAAC,MAAM,EAAE,MAAM,EAAE,CAAC,GAAG,IAAI,CAAC,CAAC;QAClE,CAAC,CAAC,OAAO,CAAC,QAAQ,CAAC,IAAI,CAAC,QAAQ,CAAC,KAAK,CAAC,CAAC,MAAM,EAAE,KAAK,EAAE,CAAC,GAAG,IAAI,CAAC,CAAC;QAEjE,0DAA0D;QAC1D,yCAAyC;QACzC,oEAAoE;QACpE,IAAI,aAAa;YAChB,IAAI,CAAC,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,CAAC;IACxB,CAAC;IAED,mBAAmB,EAAE,UAAS,QAAQ;QACrC,IAAI,EAAE,GAAG,IAAI,CAAC,QAAQ,CAAC,QAAQ,CAAC,CAAC;QACjC,IAAI,CAAC,QAAQ,CAAC,EAAE,CAAC,CAAC,MAAM,GAAG,CAAC,CAAC,OAAO,CAAC,MAAM,CAAC,KAAK,EAAE,0BAA0B,EAAE,CAAC,CAAC,OAAO,CAAC,GAAG,CAAC,QAAQ,CAAC,CAAC,CAAC;QACxG,IAAI,MAAM,GAAG,CAAC,CAAC,OAAO,CAAC,MAAM,CAAC,KAAK,EAAE,iCAAiC,EAAE,IAAI,CAAC,QAAQ,CAAC,EAAE,CAAC,CAAC,MAAM,CAAC,CAAC;QAClG,MAAM,CAAC,EAAE,GAAG,QAAQ,GAAG,SAAS,CAAC;QACjC,CAAC,CAAC,OAAO,CAAC,QAAQ,CAAC,MAAM,EAAE,iBAAiB,CAAC,CAAC;IAC/C,CAAC;IAED,oBAAoB,EAAE,UAAS,KAAK,EAAE,UAAU,EAAE,kBAAkB,EAAE,gBAAgB;QACrF,IAAI,KAAK,GAAG,IAAI,CAAC,QAAQ,CAAC,KAAK,CAAC,CAAC;QACjC,IAAI,UAAU,GAAG,IAAI,CAAC,QAAQ,CAAC,KAAK,CAAC,CAAC,aAAa,CAAC,UAAU,CAAC;QAC/D,CAAC,CAAC,OAAO,CAAC,KAAK,CAAC,UAAU,CAAC,CAAC;QAC5B,IAAI,OAAO,GAAG,IAAI,CAAC,QAAQ,CAAC,KAAK,CAAC,CAAC,aAAa,CAAC,OAAO,CAAC;QACzD,IAAI,WAAW,EAAE,SAAS,CAAC;QAC3B,IAAI,kBAAkB,EAAE;YACvB,WAAW,GAAG,IAAI,CAAC,QAAQ,CAAC,KAAK,CAAC,CAAC,aAAa,CAAC,WAAW,CAAC;SAC7D;aAAM,IAAI,OAAO,CAAC,KAAK,EAAE;YACzB,CAAC,CAAC,OAAO,CAAC,MAAM,CAAC,OAAO,CAAC,KAAK,CAAC,CAAC;YAChC,OAAO,CAAC,KAAK,GAAG,IAAI,CAAC;SACrB;QACD,IAAI,gBAAgB,EAAE;YACrB,SAAS,GAAG,IAAI,CAAC,QAAQ,CAAC,KAAK,CAAC,CAAC,aAAa,CAAC,SAAS,CAAC;SACzD;aAAO,IAAI,OAAO,CAAC,GAAG,EAAE;YACxB,CAAC,CAAC,OAAO,CAAC,MAAM,CAAC,OAAO,CAAC,GAAG,CAAC,CAAC;YAC9B,OAAO,CAAC,GAAG,GAAG,IAAI,CAAC;SACnB;QAED,IAAI,CAAC,OAAO,CAAC,KAAK,IAAI,CAAC,OAAO,CAAC,GAAG;YACjC,OAAO,CAAC,eAAe,GAAG,IAAI,CAAC;QAEhC,IAAI,CAAC,UAAU,IAAI,UAAU,CAAC,MAAM,GAAG,CAAC,EAAE;YACzC,OAAO;SACP;QAED,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,UAAU,CAAC,MAAM,EAAE,EAAE,CAAC,EAAE;YAC3C,IAAI,SAAS,GAAG,CAAC,CAAC,OAAO,CAAC,MAAM,CAAC,KAAK,EAAE,kCAAkC,EAAE,UAAU,CAAC,CAAC;YACxF,IAAI,SAAS,GAAG,CAAC,CAAC,OAAO,CAAC,MAAM,CAAC,KAAK,EAAE,wBAAwB,EAAE,SAAS,CAAC,CAAC;YAC7E,IAAI,IAAI,GAAG,UAAU,CAAC,CAAC,CAAC,CAAC;YACzB,CAAC,CAAC,OAAO,CAAC,QAAQ,CAAC,SAAS,EAAE,OAAO,EAAE,IAAI,CAAC,KAAK,GAAG,IAAI,CAAC,CAAC;YAC1D,CAAC,CAAC,OAAO,CAAC,QAAQ,CAAC,SAAS,EAAE,QAAQ,EAAE,IAAI,CAAC,MAAM,GAAG,IAAI,CAAC,CAAC;YAC5D,CAAC,CAAC,OAAO,CAAC,QAAQ,CAAC,SAAS,EAAE,MAAM,EAAG,IAAI,CAAC,CAAC,GAAG,IAAI,CAAC,CAAC;YACtD,CAAC,CAAC,OAAO,CAAC,QAAQ,CAAC,SAAS,EAAE,KAAK,EAAE,IAAI,CAAC,CAAC,GAAG,IAAI,CAAC,CAAC;SACpD;QAED,IAAI,QAAQ,CAAC;QACb,IAAI,WAAW,EAAE;YAChB,IAAI,SAAS,GAAG,UAAU,CAAC,CAAC,CAAC,CAAC;YAC9B,IAAI,SAAS,CAAC,KAAK,GAAG,CAAC;gBACtB,OAAO;YACR,SAAS,GAAG,EAAC,CAAC,EAAE,SAAS,CAAC,CAAC,EAAE,CAAC,EAAE,SAAS,CAAC,CAAC,EAAE,KAAK,EAAE,CAAC,EAAE,MAAM,EAAE,SAAS,CAAC,MAAM,EAAC,CAAC;YACjF,QAAQ,GAAG,CAAC,CAAC,KAAK,CAAC,SAAS,CAAC,CAAC,EAAE,SAAS,CAAC,CAAC,GAAG,SAAS,CAAC,MAAM,CAAC,CAAC;YAChE,QAAQ,GAAG,QAAQ,CAAC,QAAQ,CAAC,CAAC,CAAC,KAAK,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC;YAC5C,WAAW,CAAC,OAAO,GAAG,QAAQ,CAAC;YAC/B,WAAW,CAAC,SAAS,GAAG,SAAS,CAAC,MAAM,CAAC;SACzC;QAED,IAAI,MAAM,CAAC;QACX,IAAI,SAAS,EAAE;YACd,IAAI,OAAO,GAAG,UAAU,CAAC,UAAU,CAAC,MAAM,GAAG,CAAC,CAAC,CAAC;YAChD,IAAI,OAAO,CAAC,KAAK,GAAG,CAAC;gBACpB,OAAO;YACR,OAAO,GAAG,EAAC,CAAC,EAAE,OAAO,CAAC,CAAC,GAAG,OAAO,CAAC,KAAK,GAAG,CAAC,EAAE,CAAC,EAAE,OAAO,CAAC,CAAC,EAAE,KAAK,EAAE,CAAC,EAAE,MAAM,EAAE,OAAO,CAAC,MAAM,EAAC,CAAC;YAC7F,MAAM,GAAG,CAAC,CAAC,KAAK,CAAC,OAAO,CAAC,CAAC,EAAE,OAAO,CAAC,CAAC,GAAG,OAAO,CAAC,MAAM,CAAC,CAAC;YACxD,MAAM,GAAG,MAAM,CAAC,QAAQ,CAAC,CAAC,CAAC,KAAK,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC;YACxC,SAAS,CAAC,OAAO,GAAG,MAAM,CAAC;YAC3B,SAAS,CAAC,SAAS,GAAG,OAAO,CAAC,MAAM,CAAC;SACrC;QAED,IAAI,WAAW,IAAI,OAAO,CAAC,eAAe,EAAE;YAC3C,IAAI,CAAC,OAAO,CAAC,KAAK;gBACjB,OAAO,CAAC,KAAK,GAAG,OAAO,CAAC,WAAW,CAAC,WAAW,CAAC,CAAC;YAClD,gHAAgH;YAChH,WAAW,CAAC,GAAG,GAAG,QAAQ,CAAC;YAC3B,CAAC,CAAC,OAAO,CAAC,QAAQ,CAAC,WAAW,EAAE,MAAM,EAAG,QAAQ,CAAC,CAAC,GAAG,IAAI,CAAC,CAAC;YAC5D,CAAC,CAAC,OAAO,CAAC,QAAQ,CAAC,WAAW,EAAE,KAAK,EAAE,QAAQ,CAAC,CAAC,GAAG,IAAI,CAAC,CAAC;SAC1D;QAED,IAAI,SAAS,IAAI,OAAO,CAAC,eAAe,EAAE;YACzC,IAAI,CAAC,OAAO,CAAC,GAAG;gBACf,OAAO,CAAC,GAAG,GAAG,OAAO,CAAC,WAAW,CAAC,SAAS,CAAC,CAAC;YAC9C,0GAA0G;YAC1G,SAAS,CAAC,GAAG,GAAG,MAAM,CAAC;YACvB,CAAC,CAAC,OAAO,CAAC,QAAQ,CAAC,SAAS,EAAE,MAAM,EAAG,MAAM,CAAC,CAAC,GAAG,IAAI,CAAC,CAAC;YACxD,CAAC,CAAC,OAAO,CAAC,QAAQ,CAAC,SAAS,EAAE,KAAK,EAAE,MAAM,CAAC,CAAC,GAAG,IAAI,CAAC,CAAC;SACtD;IACF,CAAC;IAED,KAAK,EAAE,UAAS,KAAK,EAAE,WAAW;QACjC,IAAI,CAAC,IAAI,CAAC,QAAQ,CAAC,KAAK,CAAC,CAAC;QAC1B,IAAI,KAAK,IAAI,IAAI,CAAC,QAAQ,EAAE;YAC3B,IAAI,CAAC,IAAI,CAAC,KAAK,CAAC,WAAW,CAAC,CAAC;SAC7B;IACF,CAAC;IAED,qBAAqB,EAAE,UAAS,MAAM,EAAE,KAAK,EAAE,MAAM;QACpD,IAAI,QAAQ,GAAG,KAAK,GAAG,GAAG,CAAC,eAAe,CAAC;QAC3C,IAAI,OAAO,GAAG,KAAK,CAAC;QACpB,IAAI,MAAM,CAAC,KAAK,IAAI,QAAQ,EAAE;YAC7B,CAAC,CAAC,OAAO,CAAC,QAAQ,CAAC,MAAM,EAAE,OAAO,EAAE,KAAK,GAAG,IAAI,CAAC,CAAC;YAClD,MAAM,CAAC,KAAK,GAAG,QAAQ,CAAC;YACxB,OAAO,GAAG,IAAI,CAAC;SACf;QAED,IAAI,SAAS,GAAG,MAAM,GAAG,GAAG,CAAC,eAAe,CAAC;QAC7C,IAAI,MAAM,CAAC,MAAM,IAAI,SAAS,EAAE;YAC/B,CAAC,CAAC,OAAO,CAAC,QAAQ,CAAC,MAAM,EAAE,QAAQ,EAAE,MAAM,GAAG,IAAI,CAAC,CAAC;YACpD,MAAM,CAAC,MAAM,GAAG,SAAS,CAAC;YAC1B,OAAO,GAAG,IAAI,CAAC;SACf;QACD,OAAO,OAAO,CAAC;IAChB,CAAC;IAED,aAAa,EAAE,UAAS,EAAE,EAAE,SAAS,EAAE,QAAQ,EAAE,KAAK,EAAE,MAAM,EAAE,KAAK,EAAE,IAAI,EAAE,QAAQ;QACpF,IAAI,MAAM,CAAC,eAAe,IAAI,GAAG,CAAC,GAAG,CAAC,YAAY;YAChD,GAAG,CAAC,GAAG,CAAC,YAAY,CAAC,UAAU,CAAC,aAAa,EAAE,KAAK,CAAC,CAAC;QACxD,IAAI,CAAC,mBAAmB,EAAE,CAAC;QAC3B,IAAI,eAAe,GAAG,CAAC,CAAC,OAAO,CAAC,MAAM,CAAC,KAAK,EAAE,WAAW,EAAE,QAAQ,CAAC,IAAI,CAAC,CAAC;QAC1E,CAAC,CAAC,OAAO,CAAC,QAAQ,CAAC,eAAe,EAAE,SAAS,EAAE,KAAK,CAAC,CAAC;QACtD,CAAC,CAAC,OAAO,CAAC,QAAQ,CAAC,eAAe,EAAE,QAAQ,EAAE,KAAK,CAAC,CAAC;QACrD,CAAC,CAAC,OAAO,CAAC,QAAQ,CAAC,eAAe,EAAE,cAAc,EAAE,YAAY,CAAC,CAAC;QAElE,IAAI,KAAK,GAAG,IAAI,CAAC,QAAQ,CAAC,EAAE,CAAC,CAAC;QAC9B,eAAe,CAAC,EAAE,GAAG,KAAK,CAAC;QAC3B,IAAI,QAAQ;YACX,eAAe,CAAC,OAAO,CAAC,QAAQ,GAAG,QAAQ,CAAC;QAE7C,IAAI,YAAY,GAAG,CAAC,CAAC,OAAO,CAAC,MAAM,CAAC,QAAQ,EAAE,kBAAkB,EAAE,eAAe,CAAC,CAAC;QACnF,IAAI,CAAC,qBAAqB,CAAC,YAAY,EAAE,KAAK,EAAE,MAAM,CAAC,CAAC;QACxD,YAAY,CAAC,EAAE,GAAG,KAAK,GAAG,SAAS,CAAC;QAEpC,IAAI,WAAW,GAAG,qBAAqB,CAAC;QACxC,IAAI,CAAC,KAAK;YACT,WAAW,IAAI,oBAAoB,CAAC;QAErC,IAAI,IAAI,GAAG,IAAI,CAAC;QAChB,IAAI,IAAI,GAAG,CAAC,CAAC,MAAM,CAAC,CAAC,KAAK,EAAE,CAAC;QAC7B,CAAC,CAAC,eAAe,CAAC,CAAC,MAAM,CAAC;YACzB,QAAQ,EAAE,IAAI,CAAC,GAAG,CAAC,KAAK,EAAE,IAAI,CAAC,CAAC,CAAC;YACjC,KAAK,EAAE,IAAI,CAAC,GAAG,CAAC,KAAK,EAAE,IAAI,CAAC,CAAC,CAAC;YAC9B,SAAS,EAAE,CAAC,CAAC,MAAM,CAAC,CAAC,MAAM,EAAE;YAC7B,MAAM,EAAE,MAAM;YACd,KAAK,EAAE,KAAK,CAAC,CAAC,CAAC,KAAK,CAAC,CAAC,CAAC,EAAE;YACzB,KAAK,EAAE,KAAK;YACZ,aAAa,EAAE,IAAI;YACnB,SAAS,EAAE,KAAK;YAChB,SAAS,EAAE,KAAK;YAChB,WAAW,EAAE,WAAW;YACxB,KAAK,EAAE;gBACN,IAAI,CAAC,cAAc,CAAC,EAAE,EAAE,IAAI,CAAC,CAAC;YAC/B,CAAC;SACD,CAAC,CAAC;QAEH,IAAI,SAAS,IAAI,IAAI,IAAI,QAAQ,IAAI,IAAI,EAAE;YAC1C,gEAAgE;YAChE,0CAA0C;YAC1C,IAAI,MAAM,GAAG,IAAI,CAAC,IAAI,CAAC,SAAS,CAAC,cAAc,CAAC,IAAI,CAAC,CAAC,KAAK,CAAC,SAAS,EAAE,QAAQ,CAAC,CAAC,CAAC;YAClF,IAAI,MAAM,GAAG,IAAI,CAAC,IAAI,CAAC,cAAc,EAAE,CAAC;YACxC,IAAI,OAAO,GAAG,IAAI,CAAC,IAAI,CAAC,cAAc,EAAE,CAAC;YAEzC,IAAI,IAAI,GAAG,MAAM,CAAC,CAAC,GAAG,OAAO,CAAC,CAAC,GAAG,MAAM,CAAC,CAAC,CAAC;YAC3C,IAAI,GAAG,GAAG,MAAM,CAAC,CAAC,GAAG,OAAO,CAAC,CAAC,GAAG,MAAM,CAAC,CAAC,CAAC;YAE1C,IAAI,IAAI,IAAI,CAAC,IAAI,GAAG,IAAI,CAAC,EAAE;gBAC1B,CAAC,CAAC,eAAe,CAAC,CAAC,MAAM,CAAC,QAAQ,EAAE,UAAU,EACzC,EAAE,EAAE,EAAE,UAAU;oBACd,EAAE,EAAE,OAAO,GAAG,IAAI,GAAG,OAAO,GAAG,GAAG;oBAClC,EAAE,EAAE,IAAI,KAAK,UAAU,CAAC,CAAC,CAAC,MAAM,CAAC,CAAC;wBAClC,qBAAqB,EAAE,CAAC,CAAC;aAChC;SACD;QAED,kEAAkE;QAClE,CAAC,CAAC,eAAe,CAAC,CAAC,MAAM,EAAE,CAAC,IAAI,EAAE,CAAC;QAEnC,uEAAuE;QACvE,CAAC,CAAC,OAAO,CAAC,QAAQ,CAAC,eAAe,EAAE,WAAW,EAAE,MAAM,GAAG,IAAI,CAAC,CAAC;QAEhE,wEAAwE;QACxE,IAAI,QAAQ,GAAG,eAAe,CAAC,eAAe,CAAC;QAC/C,IAAI,WAAW,GAAG,MAAM,CAAC,gBAAgB,CAAC,QAAQ,CAAC,CAAC,gBAAgB,CAAC,cAAc,CAAC,CAAC,KAAK,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC;QAClG,IAAI,YAAY,GAAG,MAAM,CAAC,gBAAgB,CAAC,QAAQ,CAAC,CAAC,gBAAgB,CAAC,eAAe,CAAC,CAAC,KAAK,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC;QACpG,CAAC,CAAC,OAAO,CAAC,QAAQ,CAAC,QAAQ,EAAE,UAAU,EAAE,KAAK,GAAG,CAAC,CAAC,WAAW,GAAG,CAAC,YAAY,CAAC,GAAG,IAAI,CAAC,CAAC;QAExF,IAAI,CAAC,QAAQ,CAAC,EAAE,CAAC,GAAG;YACnB,EAAE,EAAE,EAAE;YACN,KAAK,EAAE,KAAK;YACZ,KAAK,EAAE,KAAK;YACZ,MAAM,EAAE,MAAM;YACd,MAAM,EAAE,IAAI;YACZ,KAAK,EAAE,KAAK;SACZ,CAAC;QAEF,gGAAgG;QAChG,CAAC,CAAC,sDAAsD,CAAC,CAAC,IAAI,CAAC,UAAU,EAAE,IAAI,CAAC,CAAC,IAAI,EAAE,CAAC;QAExF,IAAI,CAAC,mBAAmB,CAAC,KAAK,CAAC,CAAC;QAChC,IAAI,CAAC,kBAAkB,CAAC,EAAE,EAAE,YAAY,CAAA,cAAc,CAAC,CAAC;QACxD,IAAI,CAAC,cAAc,CAAC,eAAe,EAAE,EAAE,EAAE,YAAY,CAAC,CAAC;QAEvD,IAAI,CAAC,UAAU,GAAG,EAAE,CAAC;QACrB,IAAI,CAAC,gBAAgB,CAAC,EAAE,EAAE,IAAI,CAAC,cAAc,CAAC,EAAE,CAAC,CAAC,CAAC;IACpD,CAAC;IAED,WAAW,EAAE,UAAS,EAAE,EAAE,cAAc,EAAE,WAAW;QACpD,IAAI,MAAM,CAAC,IAAI,CAAC,SAAS,EAAE,EAAE;YAC5B,IAAI,CAAC,kBAAkB,CAAC,EAAE,EAAE,WAAW,CAAA,cAAc,CAAC,CAAC;SACvD;QAED,iBAAiB;QACjB,IAAI,CAAC,oBAAoB,CAAC,EAAE,CAAC,CAAC;IAC/B,CAAC;IAED,kBAAkB,EAAE,UAAS,EAAE,EAAE,MAAM,CAAA,cAAc;QACpD,CAAC,CAAC,QAAQ,CAAC,EAAE,CAAC,MAAM,EAAE,aAAa,EAAE,CAAC,CAAC,QAAQ,CAAC,cAAc,CAAC,CAAC;QAChE,CAAC,CAAC,QAAQ,CAAC,EAAE,CAAC,MAAM,EAAE,WAAW,EAAE,UAAS,CAAC;YAC5C,IAAI,GAAG,GAAG,IAAI,CAAC,kBAAkB,CAAC,CAAC,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,QAAQ,CAAC,gBAAgB,CAAC,CAAC,EAAE,MAAM,CAAC,CAAC,CAAC,CAAC,EAAC,CAAC,EAAE,CAAC,CAAC,OAAO,EAAE,CAAC,EAAE,CAAC,CAAC,OAAO,EAAC,CAAC;YACpH,IAAI,CAAC,qBAAqB,CAAC,MAAM,EAAE,EAAE,EAAE,GAAG,CAAC,CAAC,EAAE,GAAG,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC,CAAC;QAC/D,CAAC,EAAE,IAAI,CAAC,CAAC;QAET,CAAC,CAAC,QAAQ,CAAC,EAAE,CAAC,MAAM,EAAE,mBAAmB,EAAE,UAAS,CAAC;YACpD,CAAC,CAAC,QAAQ,CAAC,cAAc,CAAC,CAAC,CAAC,CAAC;YAE7B,IAAI,IAAI,CAAC,IAAI,CAAC,SAAS,CAAC,WAAW,EAAE;gBACpC,OAAO;YAER,IAAI,MAAM,CAAC,iBAAiB;gBAC3B,MAAM,CAAC,iBAAiB,GAAG,IAAI,CAAC;YAEjC,IAAI,OAAO,GAAG,CAAC,CAAC;YAChB,IAAI,IAAI,CAAC,IAAI,CAAC,OAAO,CAAC,EAAE;gBACvB,OAAO,IAAI,CAAC,CAAC,MAAM,KAAK,IAAI,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC,SAAS,CAAC,IAAI,CAAC,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC,SAAS,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,CAAC;gBAClG,OAAO,IAAI,CAAC,CAAC,MAAM,KAAK,IAAI,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC,SAAS,CAAC,MAAM,CAAC,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC,SAAS,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC,CAAC;gBACtG,OAAO,IAAI,CAAC,CAAC,MAAM,KAAK,IAAI,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC,SAAS,CAAC,KAAK,CAAC,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC,SAAS,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,CAAC;aACpG;iBAAM;gBACN,OAAO,GAAG,CAAC,CAAC;aACZ;YAED,IAAI,QAAQ,GAAG,CAAC,CAAC;YACjB,IAAI,KAAK,GAAG,CAAC,CAAC,QAAQ,CAAC,CAAC,CAAC,WAAW,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,CAAC;YAC/C,IAAI,IAAI,GAAG,CAAC,CAAC,OAAO,CAAC,CAAC,CAAC,WAAW,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,CAAC;YAC5C,IAAI,GAAG,GAAG,CAAC,CAAC,MAAM,CAAC,CAAC,CAAC,WAAW,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC;YACzC,IAAI,GAAG,GAAG,CAAC,CAAC,OAAO,CAAC,CAAC,CAAC,WAAW,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC,CAAC;YAC9C,QAAQ,GAAG,KAAK,GAAG,IAAI,GAAG,GAAG,GAAG,GAAG,CAAC;YAEpC,8BAA8B;YAC9B,IAAI,YAAY,GAAG,CAAC,CAAC,IAAI,CAAC,OAAO,CAAC,OAAO,EAAE,QAAQ,CAAC,CAAC;YACrD,IAAI,GAAG,GAAG,IAAI,CAAC,kBAAkB,CAAC,CAAC,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,QAAQ,CAAC,gBAAgB,CAAC,CAAC,EAAE,MAAM,CAAC,CAAC,CAAC,CAAC,EAAC,CAAC,EAAE,CAAC,CAAC,OAAO,EAAE,CAAC,EAAE,CAAC,CAAC,OAAO,EAAC,CAAC;YACpH,IAAI,CAAC,qBAAqB,CAAC,YAAY,EAAE,EAAE,EAAE,GAAG,CAAC,CAAC,EAAE,GAAG,CAAC,CAAC,EAAE,CAAC,EAAE,OAAO,EAAE,QAAQ,CAAC,CAAC;YACjF,IAAI,CAAC,IAAI,CAAC,QAAQ,CAAC,EAAE,CAAC,CAAC;YACvB,mBAAmB;QACpB,CAAC,EAAE,IAAI,CAAC,CAAC;QAET,CAAC,CAAC,QAAQ,CAAC,EAAE,CAAC,MAAM,EAAE,OAAO,EAAE,UAAS,EAAE;YACzC,wDAAwD;YACxD,wEAAwE;YACxE,CAAC,CAAC,QAAQ,CAAC,IAAI,CAAC,EAAE,CAAC,CAAC;QACrB,CAAC,CAAC,CAAC;IACJ,CAAC;IAED,cAAc,EAAE,UAAS,eAAe,EAAE,EAAE,EAAE,MAAM;QACnD,IAAI,QAAQ,GAAG,cAAc,CAAC,MAAM,CAAC,EAAE,CAAC,CAAC;QACzC,IAAI,UAAU,GAAG,CAAC,CAAC,GAAG,GAAG,QAAQ,CAAC,CAAC,MAAM,EAAE,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC;QACnD,IAAI,QAAQ,GAAG,CAAC,CAAC,GAAG,GAAG,QAAQ,CAAC,CAAC,IAAI,EAAE,CAAC,QAAQ,EAAE,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC;QAE1D,IAAI,KAAK,GAAG,GAAG,CAAC;QAChB,IAAI,KAAK,GAAG,IAAI,CAAC,QAAQ,CAAC,EAAE,CAAC,CAAC,KAAK,CAAC;QACpC,IAAI,MAAM,GAAG,IAAI,CAAC,QAAQ,CAAC,EAAE,CAAC,CAAC,MAAM,CAAC;QACtC,IAAI,OAAO,GAAG,CAAC,CAAC;QAChB,IAAI,OAAO,GAAG,CAAC,CAAC;QAEhB,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,QAAQ,EAAE,IAAI,MAAM,CAAC,IAAI,CAAC,QAAQ,EAAE,CAAC,IAAI,KAAK,GAAG,MAAM,CAAC,MAAM,CAAC,KAAK,EAAE;YACtF,KAAK,GAAG,MAAM,CAAC,MAAM,CAAC,KAAK,GAAG,CAAC,KAAK,GAAG,EAAE,CAAC,CAAC;YAC3C,OAAO,GAAG,CAAC,CAAC,KAAK,GAAG,MAAM,CAAC,MAAM,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC;YAC7C,OAAO,GAAG,CAAC,CAAC,MAAM,GAAG,MAAM,CAAC,MAAM,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC;SAC/C;QAED,IAAI,KAAK,GAAG;YACX,MAAM,EAAE,OAAO;YACf,MAAM,EAAE,OAAO;YACf,SAAS,EAAE,KAAK;SAChB,CAAC;QACF,IAAI,cAAc,GAAG;YACpB,SAAS,EAAE,EAAE,CAAC,EAAE,OAAO,EAAE,CAAC,EAAE,OAAO,EAAE;YACrC,KAAK,EAAE,KAAK;YACZ,KAAK,EAAE,CAAC;YACR,EAAE,EAAE,CAAC;YACL,EAAE,EAAE,CAAC;YACL,EAAE,EAAE,CAAC;SACL,CAAC;QAEF,iEAAiE;QACjE,kCAAkC;QAClC,IAAI,MAAM,CAAC,IAAI,CAAC,QAAQ,EAAE,EAAE;YAC3B,CAAC,CAAC,eAAe,CAAC,CAAC,MAAM,CAAC,QAAQ,EAAE,UAAU,EAAE,EAAE,EAAE,EAAE,YAAY,EAAE,EAAE,EAAE,YAAY,EAAE,EAAE,EAAE,qBAAqB,EAAE,CAAC,CAAC;YACnH,cAAc,CAAC,MAAM,GAAG,YAAY,CAAC;YACrC,cAAc,CAAC,SAAS,CAAC,CAAC,GAAG,CAAC,CAAC;SAC/B;QAED,IAAI,cAAc,CAAC,QAAQ,CAAC,IAAI,IAAI,EAAE;YACrC,gBAAgB,CAAC,QAAQ,CAAC,CAAC;SAC3B;QACD,WAAW,CAAC,IAAI,CAAC,EAAC,GAAG,EAAE,QAAQ,EAAE,KAAK,EAAE,UAAU,EAAE,QAAQ,EAAE,QAAQ,EAAE,cAAc,EAAE,cAAc,EAAE,YAAY,EAAE,KAAK,EAAE,KAAK,EAAC,KAAK,EAAE,MAAM,EAAE,MAAM,EAAC,CAAC,CAAC;QAE3J,IAAI,IAAI,GAAG,IAAI,CAAC;QAChB,IAAI,cAAc,GAAG,IAAI,MAAM,CAAC,QAAQ,CAAC,CAAC;QAC1C,cAAc,CAAC,GAAG,CAAC,IAAI,MAAM,CAAC,GAAG,CAAC,EAAE,SAAS,EAAE,EAAE,EAAE,QAAQ,EAAE,CAAC,EAAE,CAAC,CAAC,CAAC;QACnE,cAAc,CAAC,GAAG,CAAC,IAAI,MAAM,CAAC,KAAK,CAAC,EAAE,SAAS,EAAE,CAAC,EAAE,CAAC,CAAC,CAAC,aAAa,CAAC,CAAC,cAAc,CAAC,GAAG,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC;QAElG,cAAc,CAAC,EAAE,CAAC,UAAU,EAAE,IAAI,CAAC,KAAK,CAAC,CAAC;QAC1C,cAAc,CAAC,EAAE,CAAC,SAAS,EAAE,IAAI,CAAC,KAAK,CAAC,CAAC;QACzC,cAAc,CAAC,EAAE,CAAC,sBAAsB,EAAE,IAAI,CAAC,OAAO,CAAC,CAAC;QACxD,cAAc,CAAC,EAAE,CAAC,cAAc,EAAE,UAAS,EAAE;YAC5C,IAAI,EAAE,CAAC,OAAO,EAAE;gBACf,aAAa,GAAG,EAAE,CAAC,MAAM,CAAC;aAC1B;YAED,IAAI,EAAE,CAAC,OAAO,IAAI,aAAa,EAAE;gBAChC,IAAI,EAAE,GAAG,cAAc,CAAC,aAAa,CAAC,EAAE,CAAC,CAAC;gBAC1C,IAAI,MAAM,GAAG,cAAc,CAAC,EAAE,CAAC,CAAC;gBAChC,IAAI,MAAM,EAAE;oBACX,MAAM,CAAC,YAAY,CAAC,MAAM,GAAG,MAAM,CAAC,cAAc,CAAC,SAAS,CAAC,CAAC,CAAC;oBAC/D,MAAM,CAAC,YAAY,CAAC,MAAM,GAAG,MAAM,CAAC,cAAc,CAAC,SAAS,CAAC,CAAC,CAAC;iBAC/D;gBACD,aAAa,GAAG,IAAI,CAAC;aACrB;QACF,CAAC,CAAC,CAAC;QAEH,IAAI,aAAa,GAAG,IAAI,MAAM,CAAC,MAAM,CAAC,CAAC;QACvC,aAAa,CAAC,GAAG,CAAC,IAAI,MAAM,CAAC,GAAG,CAAC,EAAE,SAAS,EAAE,EAAE,EAAE,QAAQ,EAAE,CAAC,EAAE,CAAC,CAAC,CAAC;QAClE,aAAa,CAAC,GAAG,CAAC,IAAI,MAAM,CAAC,KAAK,CAAC,EAAE,SAAS,EAAE,CAAC,EAAE,CAAC,CAAC,CAAC,aAAa,CAAC,CAAC,aAAa,CAAC,GAAG,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC;QAEhG,aAAa,CAAC,EAAE,CAAC,UAAU,EAAE,IAAI,CAAC,KAAK,CAAC,CAAC;QACzC,aAAa,CAAC,EAAE,CAAC,SAAS,EAAE,IAAI,CAAC,KAAK,CAAC,CAAC;QACxC,aAAa,CAAC,EAAE,CAAC,sBAAsB,EAAE,IAAI,CAAC,OAAO,CAAC,CAAC;QACvD,aAAa,CAAC,EAAE,CAAC,cAAc,EAAE,UAAS,EAAE;YAC3C,IAAI,EAAE,CAAC,OAAO,EAAE;gBACf,IAAI,CAAC,cAAc,GAAG,KAAK,CAAC;gBAC5B,aAAa,GAAG,EAAE,CAAC,MAAM,CAAC;aAC1B;iBACI,IAAI,IAAI,CAAC,cAAc,EAAE;gBAC7B,aAAa,GAAG,IAAI,CAAC;gBACrB,IAAI,CAAC,cAAc,GAAG,KAAK,CAAC;gBAC5B,OAAO;aACP;YAED,IAAI,EAAE,CAAC,OAAO,IAAI,aAAa,EAAE;gBAChC,IAAI,EAAE,GAAG,cAAc,CAAC,aAAa,CAAC,EAAE,CAAC,CAAC;gBAC1C,IAAI,MAAM,GAAG,cAAc,CAAC,EAAE,CAAC,CAAC;gBAChC,IAAI,MAAM,EAAE;oBACX,MAAM,CAAC,YAAY,CAAC,MAAM,GAAG,MAAM,CAAC,cAAc,CAAC,SAAS,CAAC,CAAC,CAAC;oBAC/D,MAAM,CAAC,YAAY,CAAC,MAAM,GAAG,MAAM,CAAC,cAAc,CAAC,SAAS,CAAC,CAAC,CAAC;iBAC/D;gBACD,aAAa,GAAG,IAAI,CAAC;aACrB;QACF,CAAC,CAAC,CAAC;QAEH,oBAAoB,CAAC,cAAc,CAAC,QAAQ,CAAC,CAAC,CAAC;IAChD,CAAC;IAED,qBAAqB,EAAE,UAAS,IAAI,EAAE,KAAK,EAAE,CAAC,EAAE,CAAC,EAAE,KAAK,EAAE,OAAO,EAAE,QAAQ;QAC1E,GAAG,CAAC,MAAM,CAAC,WAAW,CAAC,iBAAiB,GAAG,KAAK,GAAI,QAAQ,GAAG,IAAI;YACrC,KAAK,GAAG,CAAC,GAAG,KAAK,GAAG,CAAC,GAAG,SAAS,GAAG,KAAK;YACzC,WAAW,GAAG,OAAO,GAAG,YAAY,GAAG,QAAQ,CAAC,CAAC;IAChF,CAAC;IAED,uBAAuB,EAAE,UAAS,KAAK,EAAE,IAAI,EAAE,CAAC,EAAE,CAAC,EAAE,MAAM;QAC1D,iEAAiE;QACjE,GAAG,CAAC,MAAM,CAAC,WAAW,CAAC,mBAAmB,GAAG,KAAK,GAAI,QAAQ,GAAG,IAAI;YACvC,KAAK,GAAG,CAAC,GAAG,KAAK,GAAG,CAAC,GAAG,UAAU,GAAG,MAAM,CAAC,CAAC;IAC5E,CAAC;IAED,kBAAkB,EAAE,UAAS,QAAQ;QACpC,yCAAyC;QACzC,IAAI,IAAI,GAAG,IAAI,CAAC;QAChB,IAAI,YAAY,GAAG,KAAK,CAAC;QAEzB,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC,OAAO,CAAC,UAAS,EAAE;YAC7C,IAAI,YAAY;gBACf,IAAI,CAAC,cAAc,CAAC,EAAE,EAAE,IAAI,CAAC,CAAC;YAE/B,IAAI,EAAE,IAAI,QAAQ;gBACjB,YAAY,GAAG,IAAI,CAAC;QACtB,CAAC,CAAC,CAAC;IACJ,CAAC;IAED,cAAc,EAAE,UAAS,QAAQ,EAAE,aAAa;QAC/C,IAAI,CAAC,kBAAkB,CAAC,QAAQ,CAAC,CAAC;QAElC,IAAI,MAAM,CAAC,eAAe,IAAI,GAAG,CAAC,GAAG,CAAC,YAAY;YACjD,GAAG,CAAC,GAAG,CAAC,YAAY,CAAC,UAAU,CAAC,aAAa,EAAE,IAAI,CAAC,CAAC;QAEtD,IAAI,aAAa;YAChB,IAAI,CAAC,gBAAgB,CAAC,QAAQ,CAAC,CAAC;QACjC,CAAC,CAAC,GAAG,GAAG,IAAI,CAAC,QAAQ,CAAC,QAAQ,CAAC,CAAC,CAAC,MAAM,EAAE,CAAC;QAE1C,0BAA0B;QAC1B,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,gBAAgB,CAAC,CAAC;QACjC,IAAI,CAAC,IAAI,CAAC,KAAK,EAAE,CAAC;QAElB,OAAO,IAAI,CAAC,QAAQ,CAAC,QAAQ,CAAC,CAAC;QAC/B,IAAI,CAAC,UAAU,GAAG,IAAI,CAAC;QAEvB,gBAAgB,CAAC,IAAI,CAAC,QAAQ,CAAC,QAAQ,CAAC,CAAC,CAAC;IAC3C,CAAC;IAED,cAAc,EAAE;QACf,KAAK,IAAI,QAAQ,IAAI,IAAI,CAAC,QAAQ,EAAE;YACnC,IAAI,CAAC,cAAc,CAAC,QAAQ,EAAE,IAAI,CAAC,CAAC;SACpC;QACD,IAAI,IAAI,CAAC,4BAA4B,EAAE,EAAE;YACxC,IAAI,CAAC,cAAc,CAAC,MAAM,CAAC,cAAc,EAAE,IAAI,CAAC,CAAC;SACjD;IACF,CAAC;IAED,mBAAmB,EAAE;QACpB,oDAAoD;QACpD,IAAI,IAAI,CAAC,UAAU,IAAI,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC,UAAU,CAAC;YACnD,CAAC,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC,KAAK;YACrC,IAAI,CAAC,cAAc,CAAC,IAAI,CAAC,UAAU,EAAE,IAAI,CAAC,CAAC;IAC7C,CAAC;IAED,iBAAiB,EAAE;QAClB,6DAA6D;QAC7D,KAAK,IAAI,KAAK,IAAI,IAAI,CAAC,QAAQ,EAAE;YAChC,CAAC,CAAC,GAAG,GAAG,IAAI,CAAC,QAAQ,CAAC,KAAK,CAAC,CAAC,KAAK,GAAG,SAAS,CAAC,CAAC,GAAG,CAAC,EAAC,OAAO,EAAE,MAAM,EAAC,CAAC,CAAC;SACvE;IACF,CAAC;IAED,yCAAyC;IACzC,kBAAkB,EAAE,UAAU,CAAC;QAC9B,IAAI,CAAC,CAAC,KAAK,KAAK,CAAC,EAAE;YAClB,qBAAqB;YACrB,IAAI,CAAC,iBAAiB,EAAE,CAAC;SACzB;aAAM;YACN,IAAI,CAAC,KAAK,CAAC,CAAC,CAAC,KAAK,EAAE,CAAC,CAAC,WAAW,CAAC,CAAC;YACnC,IAAI,IAAI,CAAC,IAAI,CAAC,UAAU;gBACvB,IAAI,CAAC,IAAI,CAAC,iBAAiB,EAAE,CAAC;SAC/B;IACF,CAAC;IAED,YAAY,EAAE,UAAS,QAAQ,EAAE,SAAS,EAAE,GAAG;QAC9C,IAAI,KAAK,GAAG,IAAI,CAAC,QAAQ,CAAC,QAAQ,CAAC,CAAC;QACpC,IAAI,MAAM,GAAG,QAAQ,CAAC,cAAc,CAAC,KAAK,GAAG,SAAS,CAAC,CAAC;QACxD,IAAI,CAAC,MAAM;YACV,OAAO,CAAC,wBAAwB;QAEjC,IAAI,CAAC,QAAQ,CAAC,QAAQ,CAAC,CAAC,UAAU,GAAG,IAAI,CAAC;QAC1C,IAAI,GAAG,GAAG,MAAM,CAAC,UAAU,CAAC,IAAI,CAAC,CAAC;QAElC,IAAI,IAAI,GAAG,IAAI,CAAC;QAChB,IAAI,CAAC,GAAG,CAAC,CAAC;QACV,IAAI,CAAC,GAAG,CAAC,CAAC;QACV,IAAI,SAAS,EAAE;YACd,SAAS,GAAG,SAAS,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC;YACjC,CAAC,GAAG,QAAQ,CAAC,SAAS,CAAC,CAAC,CAAC,CAAC,CAAC;YAC3B,CAAC,GAAG,QAAQ,CAAC,SAAS,CAAC,CAAC,CAAC,CAAC,CAAC;SAC3B;QAED,IAAI,SAAS,GAAG,CAAC,CAAC,OAAO,CAAC,GAAG,CAAC,KAAK,CAAC,CAAC;QAErC,GAAG,CAAC,SAAS,CAAC,GAAG,EAAE,CAAC,EAAE,CAAC,CAAC,CAAC;QAEzB,+BAA+B;QAC/B,IAAI,SAAS;YACZ,CAAC,CAAC,SAAS,CAAC,CAAC,MAAM,EAAE,CAAC,IAAI,EAAE,CAAC;QAE9B,IAAI,QAAQ,IAAI,IAAI,CAAC,QAAQ,EAAE;YAC9B,yDAAyD;YACzD,IAAI,CAAC,QAAQ,CAAC,QAAQ,CAAC,CAAC,UAAU,GAAG,KAAK,CAAC;YAC3C,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,mBAAmB,EAAE,EAAC,KAAK,EAAE,QAAQ,EAAE,MAAM,EAAE,IAAI,EAAC,CAAC,CAAC;SACrE;IACF,CAAC;IAED,oCAAoC;IACpC,cAAc,EAAE,UAAU,CAAC;QAC1B,IAAI,EAAE,GAAG,QAAQ,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC;QACxB,IAAI,QAAQ,GAAG,IAAI,CAAC,YAAY,CAAC,EAAE,CAAC,CAAC;QACrC,IAAI,QAAQ,EAAE;YACb,IAAI,CAAC,iBAAiB,CAAC,QAAQ,EAAE,CAAC,CAAC,GAAG,CAAC,CAAC;SACxC;aAAM;YACN,IAAI,CAAC,YAAY,CAAC,EAAE,EAAE,CAAC,CAAC,SAAS,EAAE,CAAC,CAAC,GAAG,CAAC,CAAC;SAC1C;IACF,CAAC;IAED,uBAAuB;IAEvB,iBAAiB,EAAE,UAAS,QAAQ,EAAE,GAAG;QACxC,IAAI,KAAK,GAAG,IAAI,CAAC,QAAQ,CAAC,QAAQ,CAAC,CAAC;QACpC,IAAI,MAAM,GAAG,CAAC,CAAC,OAAO,CAAC,GAAG,CAAC,KAAK,GAAG,WAAW,CAAC,CAAC;QAChD,IAAI,CAAC,MAAM;YACV,OAAO,CAAC,iCAAiC;QAE1C,mDAAmD;QACnD,IAAI,KAAK,GAAG,IAAI,CAAC,QAAQ,CAAC,QAAQ,CAAC,CAAC,UAAU,CAAC;QAC/C,IAAI,IAAI,GAAG,QAAQ,CAAC,MAAM,CAAC,KAAK,CAAC,IAAI,CAAC,CAAC;QACvC,IAAI,OAAO,GAAG,IAAI,GAAG,KAAK,CAAC;QAC3B,IAAI,OAAO,GAAG,MAAM,CAAC,UAAU,EAAE;YAChC,IAAI,OAAO,GAAG,MAAM,CAAC,UAAU,GAAG,KAAK,GAAG,EAAE,CAAC;YAC7C,CAAC,CAAC,OAAO,CAAC,QAAQ,CAAC,MAAM,EAAE,MAAM,EAAE,OAAO,GAAG,IAAI,CAAC,CAAC;SACnD;QACD,kDAAkD;QAClD,IAAI,GAAG,GAAG,QAAQ,CAAC,MAAM,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC;QACrC,IAAI,MAAM,GAAG,IAAI,CAAC,QAAQ,CAAC,QAAQ,CAAC,CAAC,WAAW,CAAC;QACjD,IAAI,SAAS,GAAG,GAAG,GAAG,MAAM,CAAC;QAC7B,IAAI,SAAS,GAAG,MAAM,CAAC,WAAW,EAAE;YACnC,IAAI,MAAM,GAAG,GAAG,GAAG,MAAM,GAAG,EAAE,CAAC;YAC/B,CAAC,CAAC,OAAO,CAAC,QAAQ,CAAC,MAAM,EAAE,KAAK,EAAE,MAAM,GAAG,IAAI,CAAC,CAAC;SACjD;QAED,oDAAoD;QACpD,gDAAgD;QAChD,gDAAgD;QAChD,8CAA8C;QAC9C,IAAI,CAAC,qBAAqB,CAAC,MAAM,EAAE,IAAI,CAAC,QAAQ,CAAC,QAAQ,CAAC,CAAC,UAAU,EACpE,IAAI,CAAC,QAAQ,CAAC,QAAQ,CAAC,CAAC,WAAW,CAAC,CAAC;QAEtC,IAAI,GAAG,GAAG,MAAM,CAAC,UAAU,CAAC,IAAI,CAAC,CAAC;QAClC,GAAG,CAAC,SAAS,CAAC,GAAG,EAAE,CAAC,EAAE,CAAC,CAAC,CAAC;QACzB,CAAC,CAAC,MAAM,CAAC,CAAC,IAAI,EAAE,CAAC;IAClB,CAAC;IAED,mBAAmB,EAAE,UAAS,QAAQ;QACrC,CAAC,CAAC,GAAG,GAAG,IAAI,CAAC,QAAQ,CAAC,QAAQ,CAAC,GAAG,WAAW,CAAC,CAAC,MAAM,EAAE,CAAC;QAExD,0FAA0F;QAC1F,IAAI,MAAM,GAAG,QAAQ,CAAC,cAAc,CAAC,QAAQ,GAAG,SAAS,CAAC,CAAC;QAC3D,IAAI,CAAC,MAAM,EAAE;YACZ,MAAM,GAAG,QAAQ,CAAC,cAAc,CAAC,IAAI,CAAC,QAAQ,CAAC,QAAQ,CAAC,GAAG,SAAS,CAAC,CAAC;YACtE,IAAI,CAAC,MAAM;gBACV,OAAO;SACR;QACD,IAAI,YAAY,GAAG,MAAM,CAAC,MAAM,CAAC;QACjC,CAAC,CAAC,GAAG,GAAG,QAAQ,CAAC,CAAC,MAAM,CAAC,YAAY,GAAG,IAAI,CAAC,CAAC;QAE9C,IAAI,CAAC,QAAQ,CAAC,QAAQ,CAAC,CAAC,OAAO,GAAG,SAAS,CAAC;QAC5C,IAAI,CAAC,QAAQ,CAAC,QAAQ,CAAC,CAAC,MAAM,GAAG,SAAS,CAAC;QAC3C,IAAI,CAAC,QAAQ,CAAC,QAAQ,CAAC,CAAC,MAAM,GAAG,SAAS,CAAC;IAC5C,CAAC;IAED,kBAAkB,EAAE,UAAS,EAAE;QAC9B,CAAC,CAAC,GAAG,GAAG,IAAI,CAAC,QAAQ,CAAC,EAAE,CAAC,GAAG,WAAW,CAAC,CAAC,MAAM,EAAE,CAAC;QAClD,IAAI,CAAC,QAAQ,CAAC,EAAE,CAAC,CAAC,OAAO,GAAG,SAAS,CAAC;QACtC,IAAI,CAAC,QAAQ,CAAC,EAAE,CAAC,CAAC,MAAM,GAAG,SAAS,CAAC;QACrC,IAAI,CAAC,QAAQ,CAAC,EAAE,CAAC,CAAC,MAAM,GAAG,SAAS,CAAC;IACtC,CAAC;IAED,kBAAkB,EAAE,UAAS,OAAO,EAAE,QAAQ,EAAE,GAAG,EAAE,IAAI;QACxD,IAAI,KAAK,GAAG,IAAI,CAAC,QAAQ,CAAC,QAAQ,CAAC,CAAC;QACpC,IAAI,eAAe,GAAG,CAAC,CAAC,OAAO,CAAC,GAAG,CAAC,KAAK,CAAC,CAAC;QAC3C,IAAI,cAAc,GAAG,CAAC,CAAC,OAAO,CAAC,MAAM,CAAC,QAAQ,EAAE,uBAAuB,EAAE,eAAe,CAAC,CAAC;QAC1F,CAAC,CAAC,cAAc,CAAC,CAAC,IAAI,EAAE,CAAC,CAAC,wDAAwD;QAElF,cAAc,CAAC,EAAE,GAAG,KAAK,GAAG,WAAW,CAAC;QACxC,CAAC,CAAC,OAAO,CAAC,QAAQ,CAAC,cAAc,EAAE,UAAU,EAAE,OAAO,CAAC,CAAC;QACxD,CAAC,CAAC,OAAO,CAAC,QAAQ,CAAC,cAAc,EAAE,SAAS,EAAE,IAAI,CAAC,CAAC;QACpD,CAAC,CAAC,OAAO,CAAC,QAAQ,CAAC,cAAc,EAAE,OAAO,EAAE,KAAK,CAAC,CAAC;QACnD,CAAC,CAAC,OAAO,CAAC,QAAQ,CAAC,cAAc,EAAE,QAAQ,EAAE,KAAK,CAAC,CAAC;QAEpD;;;;UAIE;QAEF,sBAAsB;QACtB,IAAI,QAAQ,GAAG,EAAE,CAAC;QAClB,CAAC,CAAC,OAAO,CAAC,QAAQ,CAAC,cAAc,EAAE,qBAAqB,EAAE,IAAI,GAAG,IAAI,CAAC,CAAC;QACvE,CAAC,CAAC,OAAO,CAAC,QAAQ,CAAC,cAAc,EAAE,KAAK,EAAE,CAAC,GAAG,GAAG,QAAQ,CAAC,GAAG,IAAI,CAAC,CAAC;QAEnE,gBAAgB;QAChB,IAAI,CAAC,iBAAiB,CAAC,OAAO,EAAE,cAAc,CAAC,CAAC;IACjD,CAAC;IAED,iBAAiB,EAAE,UAAS,OAAO,EAAE,MAAM;QAC1C,CAAC,CAAC,QAAQ,CAAC,EAAE,CAAC,MAAM,EAAE,aAAa,EAAE,CAAC,CAAC,QAAQ,CAAC,cAAc,CAAC,CAAC;QAEhE,CAAC,CAAC,QAAQ,CAAC,EAAE,CAAC,MAAM,EAAE,+BAA+B,EAAE,UAAS,CAAC;YAChE,CAAC,CAAC,QAAQ,CAAC,cAAc,CAAC,CAAC,CAAC,CAAC;YAC7B,IAAI,IAAI,GAAG,MAAM,CAAC,qBAAqB,EAAE,CAAC;YAC1C,IAAI,MAAM,GAAG,CAAC,CAAC,CAAC,IAAI,KAAK,UAAU,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,cAAc,CAAC,CAAC,CAAC,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC,CAAC,aAAa,CAAC,CAAC,CAAC,CAAC,OAAO,CAAC;YAChG,IAAI,MAAM,GAAG,CAAC,CAAC,CAAC,IAAI,KAAK,UAAU,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,cAAc,CAAC,CAAC,CAAC,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC,CAAC,aAAa,CAAC,CAAC,CAAC,CAAC,OAAO,CAAC;YAChG,MAAM,GAAG,MAAM,GAAG,IAAI,CAAC,CAAC,CAAC;YACzB,MAAM,GAAG,MAAM,GAAG,IAAI,CAAC,CAAC,CAAC;YACzB,IAAI,CAAC,CAAC,IAAI,KAAK,YAAY,EAC3B;gBACC,mBAAmB,GAAG,MAAM,CAAC;gBAC7B,mBAAmB,GAAG,MAAM,CAAC;gBAC7B,IAAI,CAAC,uBAAuB,CAAC,OAAO,EAAE,UAAU,EAAE,mBAAmB,EAAE,mBAAmB,EAAE,CAAC,CAAC,CAAC;aAC/F;iBACI,IAAI,CAAC,CAAC,IAAI,KAAK,UAAU,EAC9B;gBACC,IAAI,CAAC,uBAAuB,CAAC,OAAO,EAAE,QAAQ,EAAE,mBAAmB,EAAE,mBAAmB,EAAE,mBAAmB,GAAG,MAAM,CAAC,CAAC;gBACxH,IAAI,iBAAiB,KAAK,YAAY,EAAE;oBACvC,uBAAuB;oBACvB,IAAI,IAAI,CAAC,IAAI,CAAC,OAAO,CAAC,EAAE;wBACvB,IAAI,CAAC,qBAAqB,CAAC,YAAY,EAAE,OAAO,EAAE,mBAAmB,EAAE,mBAAmB,EAAE,CAAC,EAAE,IAAI,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC,SAAS,CAAC,IAAI,EAAE,CAAC,CAAC,CAAC;wBACrI,IAAI,CAAC,qBAAqB,CAAC,UAAU,EAAE,OAAO,EAAE,mBAAmB,EAAE,mBAAmB,EAAE,CAAC,EAAE,IAAI,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC,SAAS,CAAC,IAAI,EAAE,CAAC,CAAC,CAAC;qBACnI;yBAAM;wBACN,IAAI,CAAC,qBAAqB,CAAC,YAAY,EAAE,OAAO,EAAE,mBAAmB,EAAE,mBAAmB,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC,CAAC;wBACrG,IAAI,CAAC,qBAAqB,CAAC,UAAU,EAAE,OAAO,EAAE,mBAAmB,EAAE,mBAAmB,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC,CAAC;qBACnG;iBACD;gBACD,mBAAmB,GAAG,IAAI,CAAC;gBAC3B,mBAAmB,GAAG,IAAI,CAAC;aAC3B;iBACI,IAAI,CAAC,CAAC,IAAI,KAAK,WAAW,EAC/B;gBACC,IAAI,CAAC,uBAAuB,CAAC,OAAO,EAAE,WAAW,EAAE,mBAAmB,EAAE,mBAAmB,EAAE,mBAAmB,GAAG,MAAM,CAAC,CAAC;aAC3H;YACD,iBAAiB,GAAG,CAAC,CAAC,IAAI,CAAC;QAC5B,CAAC,EAAE,IAAI,CAAC,CAAC;QAET,CAAC,CAAC,QAAQ,CAAC,EAAE,CAAC,MAAM,EAAE,mBAAmB,EAAE,UAAS,CAAC;YACpD,IAAI,OAAO,GAAG,CAAC,CAAC;YAChB,IAAI,IAAI,CAAC,IAAI,CAAC,OAAO,CAAC,EAAE;gBACvB,OAAO,IAAI,CAAC,CAAC,MAAM,KAAK,IAAI,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC,SAAS,CAAC,IAAI,CAAC,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC,SAAS,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,CAAC;gBAClG,OAAO,IAAI,CAAC,CAAC,MAAM,KAAK,IAAI,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC,SAAS,CAAC,MAAM,CAAC,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC,SAAS,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC,CAAC;gBACtG,OAAO,IAAI,CAAC,CAAC,MAAM,KAAK,IAAI,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC,SAAS,CAAC,KAAK,CAAC,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC,SAAS,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,CAAC;aACpG;iBAAM;gBACN,OAAO,GAAG,CAAC,CAAC;aACZ;YACD,IAAI,YAAY,GAAG,CAAC,CAAC,IAAI,CAAC,OAAO,CAAC,OAAO,EAAE,QAAQ,CAAC,CAAC;YACrD,IAAI,CAAC,qBAAqB,CAAC,YAAY,EAAE,OAAO,EAAE,CAAC,CAAC,OAAO,EAAE,CAAC,CAAC,OAAO,EAAE,CAAC,EAAE,OAAO,EAAE,CAAC,CAAC,CAAC;QACxF,CAAC,EAAE,IAAI,CAAC,CAAC;QACT,CAAC,CAAC,QAAQ,CAAC,EAAE,CAAC,MAAM,EAAE,WAAW,EAAE,UAAS,CAAC;YAC5C,IAAI,CAAC,qBAAqB,CAAC,MAAM,EAAE,OAAO,EAAE,CAAC,CAAC,OAAO,EAAE,CAAC,CAAC,OAAO,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC,CAAC;QAC5E,CAAC,EAAE,IAAI,CAAC,CAAC;QACT,CAAC,CAAC,QAAQ,CAAC,EAAE,CAAC,MAAM,EAAE,aAAa,EAAE;YACpC,OAAO,KAAK,CAAC;QACd,CAAC,CAAC,CAAC;IACJ,CAAC;CAED,CAAC,CAAC;AAEH,CAAC,CAAC,OAAO,CAAC,SAAS,GAAG,UAAU,OAAO;IACtC,OAAO,IAAI,CAAC,CAAC,OAAO,CAAC,SAAS,CAAC,OAAO,CAAC,CAAC;AACzC,CAAC,CAAC","sourcesContent":["/* -*- js-indent-level: 8 -*- */\n/*\n * Copyright the Collabora Online contributors.\n *\n * SPDX-License-Identifier: MPL-2.0\n *\n * This Source Code Form is subject to the terms of the Mozilla Public\n * License, v. 2.0. If a copy of the MPL was not distributed with this\n * file, You can obtain one at http://mozilla.org/MPL/2.0/.\n */\n/*\n * L.Control.LokDialog used for displaying LOK dialogs\n */\n\n/* global app $ L Hammer brandProductName UNOModifier */\n\nL.WinUtil = {\n\n};\n\nvar firstTouchPositionX = null;\nvar firstTouchPositionY = null;\nvar previousTouchType = null;\n\nfunction updateTransformation(target) {\n\tif (target !== null && target !== undefined) {\n\t\tvar value = [\n\t\t\t'translate3d(' + target.transformation.translate.x + 'px, ' + target.transformation.translate.y + 'px, 0)',\n\t\t\t'scale(' + target.transformation.scale + ', ' + target.transformation.scale + ')'\n\t\t];\n\n\t\tvalue = value.join(' ');\n\t\ttarget.value.style.webkitTransform = value;\n\t\ttarget.value.style.mozTransform = value;\n\t\ttarget.value.style.transform = value;\n\n\t\tif (target.transformation.origin) {\n\t\t\ttarget.value.style[L.DomUtil.TRANSFORM_ORIGIN] = target.transformation.origin;\n\t\t}\n\t}\n}\n\nvar draggedObject = null;\n\nvar zoomTargets = [];\n\nfunction findZoomTarget(id) {\n\tfor (var item in zoomTargets) {\n\t\tif (zoomTargets[item].key === id || zoomTargets[item].titlebar.id === id) {\n\t\t\treturn zoomTargets[item];\n\t\t}\n\t}\n\treturn null;\n}\n\nfunction removeZoomTarget(id) {\n\tfor (var item in zoomTargets) {\n\t\tif (zoomTargets[item].key === id || zoomTargets[item].titlebar.id === id) {\n\t\t\tdelete zoomTargets[item];\n\t\t}\n\t}\n}\n\nfunction toZoomTargetId(id) {\n\treturn id.replace('-canvas', '');\n}\n\nL.Control.LokDialog = L.Control.extend({\n\n\tdialogIdPrefix: 'lokdialog-',\n\n\thasDialogInMobilePanelOpened: function() {\n\t\treturn window.mobileDialogId !== undefined;\n\t},\n\n\tonPan: function (ev) {\n\t\tif (!draggedObject)\n\t\t\treturn;\n\n\t\tvar id = toZoomTargetId(draggedObject.id);\n\t\tvar target = findZoomTarget(id);\n\n\t\tif (target) {\n\t\t\tvar newX = target.initialState.startX + ev.deltaX;\n\t\t\tvar newY = target.initialState.startY + ev.deltaY;\n\n\t\t\t// Don't allow to put dialog outside the view\n\t\t\tif (window.mode.isDesktop() &&\n\t\t\t\t(newX < -target.width/2 || newY < -target.height/2\n\t\t\t\t|| newX > window.innerWidth - target.width/2\n\t\t\t\t|| newY > window.innerHeight - target.height/2)) {\n\t\t\t\tvar dialog = $('.lokdialog_container');\n\t\t\t\tvar left = parseFloat(dialog.css('left'));\n\t\t\t\tvar top = parseFloat(dialog.css('top'));\n\t\t\t\tnewX = Math.max(newX, -left);\n\t\t\t\tnewY = Math.max(newY, -top);\n\t\t\t}\n\n\t\t\ttarget.transformation.translate = {\n\t\t\t\tx: newX,\n\t\t\t\ty: newY\n\t\t\t};\n\n\t\t\ttarget.transformation.translate = {\n\t\t\t\tx: newX,\n\t\t\t\ty: newY\n\t\t\t};\n\n\t\t\tupdateTransformation(target);\n\t\t}\n\t},\n\n\tonPinch: function (ev) {\n\t\tvar id = toZoomTargetId(ev.target.id);\n\t\tvar target = findZoomTarget(id);\n\n\t\tif (target) {\n\t\t\tif (ev.type == 'pinchstart') {\n\t\t\t\ttarget.initialState.initScale = target.transformation.scale || 1;\n\t\t\t}\n\n\t\t\tif (target.initialState.initScale * ev.scale > 0.4) {\n\t\t\t\ttarget.transformation.scale = target.initialState.initScale * ev.scale;\n\t\t\t}\n\n\t\t\tupdateTransformation(target);\n\t\t}\n\t},\n\n\tonAdd: function (map) {\n\t\tmap.on('window', this._onDialogMsg, this);\n\t\tmap.on('windowpaint', this._onDialogPaint, this);\n\t\tmap.on('docloaded', this._docLoaded, this);\n\t\tmap.on('closepopup', this.onCloseCurrentPopUp, this);\n\t\tmap.on('closepopups', this._onClosePopups, this);\n\t\tmap.on('editorgotfocus', this._onEditorGotFocus, this);\n\t\t// Fired to signal that the input focus is being changed.\n\t\tmap.on('changefocuswidget', this._changeFocusWidget, this);\n\t\tL.DomEvent.on(document, 'mouseup', this.onCloseCurrentPopUp, this);\n\t},\n\n\t_dialogs: {},\n\n\thasOpenedDialog: function() {\n\t\treturn Object.keys(this._dialogs).length > 0;\n\t},\n\n\tgetCurrentDialogContainer: function() {\n\t\tif (this._currentId)\n\t\t\treturn document.getElementById(this._dialogs[this._currentId].strId);\n\t\telse\n\t\t\treturn null;\n\t},\n\n\t// method used to warn user about dialog modality\n\tblinkOpenDialog: function() {\n\t\t$('.lokdialog_container').addClass('lokblink');\n\t\tsetTimeout(function () {\n\t\t\t$('.lokdialog_container').removeClass('lokblink');\n\t\t}, 600);\n\t},\n\n\t_docLoaded: function(e) {\n\t\tif (!e.status) {\n\t\t\t$('.lokdialog_container:not(.jsdialog-container)').remove();\n\t\t\t$('.lokdialogchild-canvas').remove();\n\t\t}\n\t},\n\n\t_getParentId: function(id) {\n\t\tid = parseInt(id);\n\t\tfor (var winId in this._dialogs) {\n\t\t\tif (this._dialogs[winId].childid && this._dialogs[winId].childid === id) {\n\t\t\t\treturn winId;\n\t\t\t}\n\t\t}\n\t\treturn null;\n\t},\n\n\t_isOpen: function(id) {\n\t\treturn (id in this._dialogs) && this._dialogs[id] &&\n\t\t\t$('#' + this._toStrId(id)).length > 0;\n\t},\n\n\tisCursorVisible: function(id) {\n\t\treturn (id in this._dialogs) && this._dialogs[id].cursorVisible;\n\t},\n\n\t_isSelectionHandle: function(el) {\n\t\treturn L.DomUtil.hasClass(el, 'text-selection-handle-start')\t||\n\t\t\tL.DomUtil.hasClass(el, 'text-selection-handle-end');\n\t},\n\n\t// Given a prefixed dialog id like 'lokdialog-323', gives a raw id, 323.\n\t_toIntId: function(id) {\n\t\tif (typeof(id) === 'string')\n\t\t\treturn parseInt(id.replace(this.dialogIdPrefix, ''));\n\t\treturn id;\n\t},\n\n\t// Converts a raw dialog id like 432, to 'lokdialog-432'.\n\t_toStrId: function(id) {\n\t\treturn this.dialogIdPrefix + id;\n\t},\n\n\t// Create a rectangle string of form \"x,y,width,height\"\n\t// if params are missing, assumes 0,0,dialog width, dialog height\n\t_createRectStr: function(id, x, y, width, height) {\n\t\tif (!width && id !== null)\n\t\t\twidth = this._dialogs[parseInt(id)].width;\n\t\tif (!width || width <= 0)\n\t\t\treturn null;\n\t\tif (!height && id !== null)\n\t\t\theight = this._dialogs[parseInt(id)].height;\n\t\tif (!height || height <= 0)\n\t\t\treturn null;\n\t\tif (!x)\n\t\t\tx = 0;\n\t\tif (!y)\n\t\t\ty = 0;\n\n\t\t// pre-multiplied by the scale factor\n\t\treturn [x * app.roundedDpiScale, y * app.roundedDpiScale, width * app.roundedDpiScale, height * app.roundedDpiScale].join(',');\n\t},\n\n\t_sendPaintWindowRect: function(id, x, y, width, height) {\n\t\tthis._sendPaintWindow(id, this._createRectStr(id, x, y, width, height));\n\t},\n\n\t// TODO: Extract to tool in Debug.js\n\t_debugPaintWindow: function(id, rectangle) {\n\t\tvar strId = this._toStrId(id);\n\t\tvar canvas = document.getElementById(strId + '-canvas');\n\t\tif (!canvas)\n\t\t\treturn; // no window to paint to\n\t\tvar ctx = canvas.getContext('2d');\n\t\tctx.beginPath();\n\t\tvar rect = rectangle.split(',');\n\t\tctx.rect(rect[0], rect[1], rect[2], rect[3]);\n\t\tctx.fillStyle = 'rgba(255, 0, 0, 0.5)';\n\t\tctx.fill();\n\t},\n\n\t_sendPaintWindow: function(id, rectangle) {\n\t\tif (!rectangle)\n\t\t\treturn; // Don't request rendering an empty area.\n\n\t\trectangle = rectangle.replace(/ /g, '');\n\t\tif (!rectangle)\n\t\t\treturn; // Don't request rendering an empty area.\n\n\t\t//window.app.console.log('_sendPaintWindow: rectangle: ' + rectangle + ', dpiscale: ' + dpiscale);\n\t\tapp.socket.sendMessage('paintwindow ' + id + ' rectangle=' + rectangle + ' dpiscale=' + app.roundedDpiScale);\n\n\t\tif (this._map._debug.debugOn)\n\t\t\tthis._debugPaintWindow(id, rectangle);\n\t},\n\n\t_sendCloseWindow: function(id) {\n\t\tapp.socket.sendMessage('windowcommand ' + id + ' close');\n\t\t// CSV and Macro Security Warning Dialogs are shown before the document load\n\t\t// In that state the document is not really loaded and closing or cancelling it\n\t\t// returns docnotloaded error. Instead of this we can return to the integration\n\t\tif (!this._map._docLoaded && !window._firstDialogHandled) {\n\t\t\tapp.dispatcher.dispatch('closeapp');\n\t\t}\n\t},\n\n\t_isRectangleValid: function(rect) {\n\t\trect = rect.split(',');\n\t\treturn (!isNaN(parseInt(rect[0])) && !isNaN(parseInt(rect[1])) &&\n\t\t\t\tparseInt(rect[2]) >= 0 && parseInt(rect[3]) >= 0);\n\t},\n\n\t_onDialogMsg: function(e) {\n\t\t// window.app.console.log('onDialogMsg: id: ' + e.id + ', winType: ' + e.winType + ', action: ' + e.action + ', size: ' + e.size + ', rectangle: ' + e.rectangle);\n\t\tif (e.winType != undefined &&\n\t\t    e.winType !== 'dialog' &&\n\t\t    e.winType !== 'calc-input-win' &&\n\t\t    e.winType !== 'child' &&\n\t\t    e.winType !== 'deck' &&\n\t\t    e.winType !== 'tooltip' &&\n\t\t    e.winType !== 'dropdown') {\n\t\t\treturn;\n\t\t}\n\n\t\te.id = parseInt(e.id);\n\t\tvar strId = this._toStrId(e.id);\n\n\t\tvar width = 0;\n\t\tvar height = 0;\n\t\tif (e.size) {\n\t\t\twidth = parseInt(e.size.split(',')[0]);\n\t\t\theight = parseInt(e.size.split(',')[1]);\n\t\t}\n\n\t\tvar left;\n\t\tvar top;\n\t\tif (e.position) {\n\t\t\tleft = parseInt(e.position.split(',')[0]);\n\t\t\ttop = parseInt(e.position.split(',')[1]);\n\t\t}\n\n\t\tif (e.title && typeof brandProductName !== 'undefined') {\n\t\t\te.title = e.title.replace('Collabora Office', brandProductName);\n\t\t}\n\n\t\tif (e.action === 'created') {\n\t\t\tif ((e.winType === 'dialog' || e.winType === 'dropdown') && !window.mode.isMobile()) {\n\t\t\t\t// When left/top are invalid, the dialog shows in the center.\n\t\t\t\tthis._launchDialog(e.id, left, top, width, height, e.title, null, e.unique_id);\n\t\t\t} else if (e.winType === 'child' || e.winType === 'tooltip') {\n\t\t\t\tvar parentId = parseInt(e.parentId);\n\t\t\t\tif (!this._isOpen(parentId))\n\t\t\t\t\treturn;\n\n\t\t\t\t// In case of tooltips, do not remove the previous popup\n\t\t\t\t// only if that's also a tooltip.\n\t\t\t\tif (e.winType === 'tooltip' &&\n\t\t\t\t    this._dialogs[parentId].childid !== undefined &&\n\t\t\t\t    this._dialogs[parentId].childistooltip !== true)\n\t\t\t\t\treturn;\n\n\t\t\t\tif (!left)\n\t\t\t\t\tleft = 0;\n\t\t\t\tif (!top)\n\t\t\t\t\ttop = 0;\n\t\t\t\tthis._removeDialogChild(parentId);\n\n\t\t\t\tthis._dialogs[parentId].childid = e.id;\n\t\t\t\tthis._dialogs[parentId].childwidth = width;\n\t\t\t\tthis._dialogs[parentId].childheight = height;\n\t\t\t\tthis._dialogs[parentId].childx = left;\n\t\t\t\tthis._dialogs[parentId].childy = top;\n\n\t\t\t\tif (e.winType === 'tooltip')\n\t\t\t\t\tthis._dialogs[parentId].childistooltip = true;\n\t\t\t\telse\n\t\t\t\t\tthis._dialogs[parentId].childistooltip = false;\n\t\t\t\tthis._createDialogChild(e.id, parentId, top, left);\n\t\t\t\tthis._sendPaintWindow(e.id, this._createRectStr(null, 0, 0, width, height));\n\t\t\t}\n\t\t}\n\n\t\t// All other callbacks don't make sense without an active dialog.\n\t\tif (!(this._isOpen(e.id) || this._getParentId(e.id))) {\n\t\t\tif (e.action == 'close' && window.mobileDialogId == e.id) {\n\t\t\t\twindow.mobileDialogId = undefined;\n\t\t\t\t//this._map.fire('closemobilewizard');\n\t\t\t}\n\t\t\treturn;\n\t\t}\n\n\t\t// We don't want dialogs on smartphones, only calc input window is allowed\n\t\tif (window.mode.isMobile())\n\t\t\treturn;\n\n\t\tif (e.action === 'invalidate') {\n\t\t\tthis.wasInvalidated = true;\n\t\t\tvar parent = this._getParentId(e.id);\n\t\t\tvar rectangle = e.rectangle;\n\t\t\tif (parent) { // this is a floating window\n\t\t\t\tif (e.rectangle && this._dialogs[parent].childistooltip === true) {\n\t\t\t\t\t// resize tooltips on invalidation\n\t\t\t\t\tthis._removeDialogChild(parent);\n\t\t\t\t\tleft = this._dialogs[parent].childx;\n\t\t\t\t\ttop = this._dialogs[parent].childy;\n\t\t\t\t\twidth = parseInt(e.rectangle.split(',')[2]);\n\t\t\t\t\theight = parseInt(e.rectangle.split(',')[3]);\n\t\t\t\t\tthis._dialogs[parent].childwidth = width;\n\t\t\t\t\tthis._dialogs[parent].childheight = height;\n\t\t\t\t\tthis._createDialogChild(e.id, parent, top, left);\n\t\t\t\t}\n\n\t\t\t\trectangle = this._createRectStr(null, 0, 0, this._dialogs[parent].childwidth, this._dialogs[parent].childheight);\n\t\t\t} else if (rectangle) { // this is the actual dialog\n\t\t\t\tif (this._isRectangleValid(rectangle)) {\n\t\t\t\t\trectangle = e.rectangle.split(',');\n\t\t\t\t\tx = parseInt(rectangle[0]);\n\t\t\t\t\ty = parseInt(rectangle[1]);\n\t\t\t\t\twidth = parseInt(rectangle[2]);\n\t\t\t\t\theight = parseInt(rectangle[3]);\n\n\t\t\t\t\trectangle = this._createRectStr(null, x, y, width, height);\n\t\t\t\t} else {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\trectangle = this._createRectStr(e.id);\n\t\t\t}\n\t\t\tthis._sendPaintWindow(e.id, rectangle);\n\t\t} else if (e.action === 'size_changed') {\n\t\t\t// FIXME: we don't really have to destroy and launch the dialog again but do it for\n\t\t\t// now because the size sent to us previously in 'created' cb is not correct\n\t\t\t$('#' + strId).remove();\n\t\t\tthis._launchDialog(e.id, null, null, width, height, this._dialogs[parseInt(e.id)].title, null, e.unique_id);\n\t\t\tif (this._map._docLayer && this._map._docLayer._docType === 'spreadsheet') {\n\t\t\t\tif (app.sectionContainer.doesSectionExist(L.CSections.RowHeader.name)) {\n\t\t\t\t\tapp.sectionContainer.getSectionWithName(L.CSections.RowHeader.name)._updateCanvas();\n\t\t\t\t\tapp.sectionContainer.getSectionWithName(L.CSections.ColumnHeader.name)._updateCanvas();\n\t\t\t\t}\n\t\t\t}\n\t\t} else if (e.action === 'cursor_invalidate') {\n\t\t\tif (this._isOpen(e.id) && !!e.rectangle) {\n\t\t\t\trectangle = e.rectangle.split(',');\n\t\t\t\tvar x = parseInt(rectangle[0]);\n\t\t\t\tvar y = parseInt(rectangle[1]);\n\t\t\t\theight = parseInt(rectangle[3]);\n\n\t\t\t\tthis._updateDialogCursor(e.id, x, y, height);\n\t\t\t}\n\t\t} else if (e.action === 'text_selection') {\n\t\t\tif (this._isOpen(e.id)) {\n\t\t\t\tvar rectangles = [];\n\t\t\t\tvar startHandleVisible, endHandleVisible;\n\t\t\t\tif (e.rectangles) {\n\t\t\t\t\tvar dataList = e.rectangles.match(/\\d+/g);\n\t\t\t\t\tif (dataList != null) {\n\t\t\t\t\t\tfor (var i = 0; i < dataList.length; i += 4) {\n\t\t\t\t\t\t\tvar rect = {};\n\t\t\t\t\t\t\trect.x = parseInt(dataList[i]);\n\t\t\t\t\t\t\trect.y = parseInt(dataList[i + 1]);\n\t\t\t\t\t\t\trect.width = parseInt(dataList[i + 2]);\n\t\t\t\t\t\t\trect.height = parseInt(dataList[i + 3]);\n\t\t\t\t\t\t\trectangles.push(rect);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (e.startHandleVisible) {\n\t\t\t\t\tstartHandleVisible = e.startHandleVisible === 'true';\n\t\t\t\t}\n\t\t\t\tif (e.endHandleVisible) {\n\t\t\t\t\tendHandleVisible = e.endHandleVisible === 'true';\n\t\t\t\t}\n\t\t\t\tthis._updateTextSelection(e.id, rectangles, startHandleVisible, endHandleVisible);\n\t\t\t}\n\t\t} else if (e.action === 'title_changed') {\n\t\t\tif (e.title && this._dialogs[parseInt(e.id)]) {\n\t\t\t\tthis._dialogs[parseInt(e.id)].title = e.title;\n\t\t\t\t$('#' + strId).dialog('option', 'title', e.title);\n\t\t\t}\n\t\t} else if (e.action === 'cursor_visible') {\n\t\t\t// cursor_visible implies focus has changed, but can\n\t\t\t// be misleading when it flips back on forth on typing!\n\t\t\tvar visible = (e.visible === 'true');\n\t\t\tthis._dialogs[e.id].cursorVisible = visible;\n\t\t\tif (visible) {\n\t\t\t\t$('#' + strId + '-cursor').css({display: 'block'});\n\t\t\t\tthis._map.fire('changefocuswidget', {winId: e.id, dialog: this, acceptInput: true}); // Us.\n\t\t\t}\n\t\t\telse {\n\t\t\t\t$('#' + strId + '-cursor').css({display: 'none'});\n\t\t\t}\n\t\t} else if (e.action === 'close') {\n\t\t\tparent = this._getParentId(e.id);\n\t\t\tif (parent)\n\t\t\t\tthis._onDialogChildClose(parent);\n\t\t\telse\n\t\t\t\tthis._onDialogClose(e.id, false);\n\t\t} else if (e.action === 'hide') {\n\t\t\t$('#' + strId).parent().css({display: 'none'});\n\t\t} else if (e.action === 'show') {\n\t\t\t$('#' + strId).parent().css({display: 'block'});\n\t\t}\n\t},\n\n\t_updateDialogCursor: function(dlgId, x, y, height) {\n\t\tvar strId = this._toStrId(dlgId);\n\t\tvar dialogCursor = L.DomUtil.get(strId + '-cursor');\n\t\tvar cursorVisible = this.isCursorVisible(dlgId);\n\t\tL.DomUtil.setStyle(dialogCursor, 'height', height + 'px');\n\t\tL.DomUtil.setStyle(dialogCursor, 'display', cursorVisible ? 'block' : 'none');\n\t\t// set the position of the cursor container element\n\t\tL.DomUtil.setStyle(this._dialogs[dlgId].cursor, 'left', x + 'px');\n\t\tL.DomUtil.setStyle(this._dialogs[dlgId].cursor, 'top', y + 'px');\n\n\t\t// Make sure the keyboard is visible if there is a cursor.\n\t\t// But don't hide the keyboard otherwise.\n\t\t// At least the formula-input hides the cursor after each key input.\n\t\tif (cursorVisible)\n\t\t\tthis._map.focus(true);\n\t},\n\n\t_createDialogCursor: function(dialogId) {\n\t\tvar id = this._toIntId(dialogId);\n\t\tthis._dialogs[id].cursor = L.DomUtil.create('div', 'leaflet-cursor-container', L.DomUtil.get(dialogId));\n\t\tvar cursor = L.DomUtil.create('div', 'leaflet-cursor lokdialog-cursor', this._dialogs[id].cursor);\n\t\tcursor.id = dialogId + '-cursor';\n\t\tL.DomUtil.addClass(cursor, 'blinking-cursor');\n\t},\n\n\t_updateTextSelection: function(dlgId, rectangles, startHandleVisible, endHandleVisible) {\n\t\tvar strId = this._toIntId(dlgId);\n\t\tvar selections = this._dialogs[strId].textSelection.rectangles;\n\t\tL.DomUtil.empty(selections);\n\t\tvar handles = this._dialogs[strId].textSelection.handles;\n\t\tvar startHandle, endHandle;\n\t\tif (startHandleVisible) {\n\t\t\tstartHandle = this._dialogs[strId].textSelection.startHandle;\n\t\t} else if (handles.start) {\n\t\t\tL.DomUtil.remove(handles.start);\n\t\t\thandles.start = null;\n\t\t}\n\t\tif (endHandleVisible) {\n\t\t\tendHandle = this._dialogs[strId].textSelection.endHandle;\n\t\t}  else if (handles.end) {\n\t\t\tL.DomUtil.remove(handles.end);\n\t\t\thandles.end = null;\n\t\t}\n\n\t\tif (!handles.start && !handles.end)\n\t\t\thandles.draggingStopped = true;\n\n\t\tif (!rectangles || rectangles.length < 1) {\n\t\t\treturn;\n\t\t}\n\n\t\tfor (var i = 0; i < rectangles.length; ++i) {\n\t\t\tvar container = L.DomUtil.create('div', 'leaflet-text-selection-container', selections);\n\t\t\tvar selection = L.DomUtil.create('div', 'leaflet-text-selection', container);\n\t\t\tvar rect = rectangles[i];\n\t\t\tL.DomUtil.setStyle(selection, 'width', rect.width + 'px');\n\t\t\tL.DomUtil.setStyle(selection, 'height', rect.height + 'px');\n\t\t\tL.DomUtil.setStyle(container, 'left',  rect.x + 'px');\n\t\t\tL.DomUtil.setStyle(container, 'top', rect.y + 'px');\n\t\t}\n\n\t\tvar startPos;\n\t\tif (startHandle) {\n\t\t\tvar startRect = rectangles[0];\n\t\t\tif (startRect.width < 1)\n\t\t\t\treturn;\n\t\t\tstartRect = {x: startRect.x, y: startRect.y, width: 1, height: startRect.height};\n\t\t\tstartPos = L.point(startRect.x, startRect.y + startRect.height);\n\t\t\tstartPos = startPos.subtract(L.point(0, 2));\n\t\t\tstartHandle.lastPos = startPos;\n\t\t\tstartHandle.rowHeight = startRect.height;\n\t\t}\n\n\t\tvar endPos;\n\t\tif (endHandle) {\n\t\t\tvar endRect = rectangles[rectangles.length - 1];\n\t\t\tif (endRect.width < 1)\n\t\t\t\treturn;\n\t\t\tendRect = {x: endRect.x + endRect.width - 1, y: endRect.y, width: 1, height: endRect.height};\n\t\t\tendPos = L.point(endRect.x, endRect.y + endRect.height);\n\t\t\tendPos = endPos.subtract(L.point(0, 2));\n\t\t\tendHandle.lastPos = endPos;\n\t\t\tendHandle.rowHeight = endRect.height;\n\t\t}\n\n\t\tif (startHandle && handles.draggingStopped) {\n\t\t\tif (!handles.start)\n\t\t\t\thandles.start = handles.appendChild(startHandle);\n\t\t\t// window.app.console.log('lokdialog: _updateTextSelection: startPos: x: ' + startPos.x + ', y: ' + startPos.y);\n\t\t\tstartHandle.pos = startPos;\n\t\t\tL.DomUtil.setStyle(startHandle, 'left',  startPos.x + 'px');\n\t\t\tL.DomUtil.setStyle(startHandle, 'top', startPos.y + 'px');\n\t\t}\n\n\t\tif (endHandle && handles.draggingStopped) {\n\t\t\tif (!handles.end)\n\t\t\t\thandles.end = handles.appendChild(endHandle);\n\t\t\t// window.app.console.log('lokdialog: _updateTextSelection: endPos: x: ' + endPos.x + ', y: ' + endPos.y);\n\t\t\tendHandle.pos = endPos;\n\t\t\tL.DomUtil.setStyle(endHandle, 'left',  endPos.x + 'px');\n\t\t\tL.DomUtil.setStyle(endHandle, 'top', endPos.y + 'px');\n\t\t}\n\t},\n\n\tfocus: function(dlgId, acceptInput) {\n\t\tthis._map.setWinId(dlgId);\n\t\tif (dlgId in this._dialogs) {\n\t\t\tthis._map.focus(acceptInput);\n\t\t}\n\t},\n\n\t_setCanvasWidthHeight: function(canvas, width, height) {\n\t\tvar newWidth = width * app.roundedDpiScale;\n\t\tvar changed = false;\n\t\tif (canvas.width != newWidth) {\n\t\t\tL.DomUtil.setStyle(canvas, 'width', width + 'px');\n\t\t\tcanvas.width = newWidth;\n\t\t\tchanged = true;\n\t\t}\n\n\t\tvar newHeight = height * app.roundedDpiScale;\n\t\tif (canvas.height != newHeight) {\n\t\t\tL.DomUtil.setStyle(canvas, 'height', height + 'px');\n\t\t\tcanvas.height = newHeight;\n\t\t\tchanged = true;\n\t\t}\n\t\treturn changed;\n\t},\n\n\t_launchDialog: function(id, leftTwips, topTwips, width, height, title, type, uniqueId) {\n\t\tif (window.ThisIsTheiOSApp && app.map.mobileTopBar)\n\t\t\t\tapp.map.mobileTopBar.enableItem('closemobile', false);\n\t\tthis.onCloseCurrentPopUp();\n\t\tvar dialogContainer = L.DomUtil.create('div', 'lokdialog', document.body);\n\t\tL.DomUtil.setStyle(dialogContainer, 'padding', '0px');\n\t\tL.DomUtil.setStyle(dialogContainer, 'margin', '0px');\n\t\tL.DomUtil.setStyle(dialogContainer, 'touch-action', 'manipulate');\n\n\t\tvar strId = this._toStrId(id);\n\t\tdialogContainer.id = strId;\n\t\tif (uniqueId)\n\t\t\tdialogContainer.dataset.uniqueId = uniqueId;\n\n\t\tvar dialogCanvas = L.DomUtil.create('canvas', 'lokdialog_canvas', dialogContainer);\n\t\tthis._setCanvasWidthHeight(dialogCanvas, width, height);\n\t\tdialogCanvas.id = strId + '-canvas';\n\n\t\tvar dialogClass = 'lokdialog_container';\n\t\tif (!title)\n\t\t\tdialogClass += ' lokdialog_notitle';\n\n\t\tvar that = this;\n\t\tvar size = $(window).width();\n\t\t$(dialogContainer).dialog({\n\t\t\tminWidth: Math.min(width, size.x),\n\t\t\twidth: Math.min(width, size.x),\n\t\t\tmaxHeight: $(window).height(),\n\t\t\theight: 'auto',\n\t\t\ttitle: title ? title : '',\n\t\t\tmodal: false,\n\t\t\tcloseOnEscape: true,\n\t\t\tdraggable: false,\n\t\t\tresizable: false,\n\t\t\tdialogClass: dialogClass,\n\t\t\tclose: function() {\n\t\t\t\tthat._onDialogClose(id, true);\n\t\t\t}\n\t\t});\n\n\t\tif (leftTwips != null && topTwips != null) {\n\t\t\t// magic to re-calculate the position in twips to absolute pixel\n\t\t\t// position inside the #document-container\n\t\t\tvar pixels = this._map._docLayer._twipsToPixels(new L.Point(leftTwips, topTwips));\n\t\t\tvar origin = this._map.getPixelOrigin();\n\t\t\tvar panePos = this._map._getMapPanePos();\n\n\t\t\tvar left = pixels.x + panePos.x - origin.x;\n\t\t\tvar top = pixels.y + panePos.y - origin.y;\n\n\t\t\tif (left >= 0 && top >= 0) {\n\t\t\t\t$(dialogContainer).dialog('option', 'position',\n\t\t\t\t\t\t\t  { my: 'left top',\n\t\t\t\t\t\t\t    at: 'left+' + left + ' top+' + top,\n\t\t\t\t\t\t\t    of: type === 'dropdown' ? '#map' :\n\t\t\t\t\t\t\t    '#document-container' });\n\t\t\t}\n\t\t}\n\n\t\t// don't show the dialog surround until we have the dialog content\n\t\t$(dialogContainer).parent().hide();\n\n\t\t// Override default minHeight, which can be too large for thin dialogs.\n\t\tL.DomUtil.setStyle(dialogContainer, 'minHeight', height + 'px');\n\n\t\t// Title bar may overflow due to range name. So we should have max width\n\t\tvar titleBar = dialogContainer.previousSibling;\n\t\tvar leftPadding = window.getComputedStyle(titleBar).getPropertyValue('padding-left').slice(0, -2);\n\t\tvar rightPadding = window.getComputedStyle(titleBar).getPropertyValue('padding-right').slice(0, -2);\n\t\tL.DomUtil.setStyle(titleBar, 'maxWidth', width - (+leftPadding + +rightPadding) + 'px');\n\n\t\tthis._dialogs[id] = {\n\t\t\tid: id,\n\t\t\tstrId: strId,\n\t\t\twidth: width,\n\t\t\theight: height,\n\t\t\tcursor: null,\n\t\t\ttitle: title\n\t\t};\n\n\t\t// don't make 'TAB' focus on this button; we want to cycle focus in the lok dialog with each TAB\n\t\t$('.lokdialog_container button.ui-dialog-titlebar-close').attr('tabindex', '-1').blur();\n\n\t\tthis._createDialogCursor(strId);\n\t\tthis._setupWindowEvents(id, dialogCanvas/*, dlgInput*/);\n\t\tthis._setupGestures(dialogContainer, id, dialogCanvas);\n\n\t\tthis._currentId = id;\n\t\tthis._sendPaintWindow(id, this._createRectStr(id));\n\t},\n\n\t_postLaunch: function(id, panelContainer, panelCanvas) {\n\t\tif (window.mode.isDesktop()) {\n\t\t\tthis._setupWindowEvents(id, panelCanvas/*, dlgInput*/);\n\t\t}\n\n\t\t// Render window.\n\t\tthis._sendPaintWindowRect(id);\n\t},\n\n\t_setupWindowEvents: function(id, canvas/*, dlgInput*/) {\n\t\tL.DomEvent.on(canvas, 'contextmenu', L.DomEvent.preventDefault);\n\t\tL.DomEvent.on(canvas, 'mousemove', function(e) {\n\t\t\tvar pos = this._isSelectionHandle(e.target) ? L.DomEvent.getMousePosition(e, canvas) : {x: e.offsetX, y: e.offsetY};\n\t\t\tthis._postWindowMouseEvent('move', id, pos.x, pos.y, 1, 0, 0);\n\t\t}, this);\n\n\t\tL.DomEvent.on(canvas, 'mousedown mouseup', function(e) {\n\t\t\tL.DomEvent.preventDefault(e);\n\n\t\t\tif (this._map.uiManager.isUIBlocked())\n\t\t\t\treturn;\n\n\t\t\tif (canvas.lastDraggedHandle)\n\t\t\t\tcanvas.lastDraggedHandle = null;\n\n\t\t\tvar buttons = 0;\n\t\t\tif (this._map['mouse']) {\n\t\t\t\tbuttons |= e.button === this._map['mouse'].JSButtons.left ? this._map['mouse'].LOButtons.left : 0;\n\t\t\t\tbuttons |= e.button === this._map['mouse'].JSButtons.middle ? this._map['mouse'].LOButtons.middle : 0;\n\t\t\t\tbuttons |= e.button === this._map['mouse'].JSButtons.right ? this._map['mouse'].LOButtons.right : 0;\n\t\t\t} else {\n\t\t\t\tbuttons = 1;\n\t\t\t}\n\n\t\t\tvar modifier = 0;\n\t\t\tvar shift = e.shiftKey ? UNOModifier.SHIFT : 0;\n\t\t\tvar ctrl = e.ctrlKey ? UNOModifier.CTRL : 0;\n\t\t\tvar alt = e.altKey ? UNOModifier.ALT : 0;\n\t\t\tvar cmd = e.metaKey ? UNOModifier.CTRLMAC : 0;\n\t\t\tmodifier = shift | ctrl | alt | cmd;\n\n\t\t\t// 'mousedown' -> 'buttondown'\n\t\t\tvar lokEventType = e.type.replace('mouse', 'button');\n\t\t\tvar pos = this._isSelectionHandle(e.target) ? L.DomEvent.getMousePosition(e, canvas) : {x: e.offsetX, y: e.offsetY};\n\t\t\tthis._postWindowMouseEvent(lokEventType, id, pos.x, pos.y, 1, buttons, modifier);\n\t\t\tthis._map.setWinId(id);\n\t\t\t//dlgInput.focus();\n\t\t}, this);\n\n\t\tL.DomEvent.on(canvas, 'click', function(ev) {\n\t\t\t// Clicking on the dialog's canvas shall not trigger any\n\t\t\t// focus change - therefore the event is stopped and preventDefault()ed.\n\t\t\tL.DomEvent.stop(ev);\n\t\t});\n\t},\n\n\t_setupGestures: function(dialogContainer, id, canvas) {\n\t\tvar targetId = toZoomTargetId(canvas.id);\n\t\tvar zoomTarget = $('#' + targetId).parent().get(0);\n\t\tvar titlebar = $('#' + targetId).prev().children().get(0);\n\n\t\tvar ratio = 1.0;\n\t\tvar width = this._dialogs[id].width;\n\t\tvar height = this._dialogs[id].height;\n\t\tvar offsetX = 0;\n\t\tvar offsetY = 0;\n\n\t\tif ((window.mode.isMobile() || window.mode.isTablet()) && width > window.screen.width) {\n\t\t\tratio = window.screen.width / (width + 40);\n\t\t\toffsetX = -(width - window.screen.width) / 2;\n\t\t\toffsetY = -(height - window.screen.height) / 2;\n\t\t}\n\n\t\tvar state = {\n\t\t\tstartX: offsetX,\n\t\t\tstartY: offsetY,\n\t\t\tinitScale: ratio\n\t\t};\n\t\tvar transformation = {\n\t\t\ttranslate: { x: offsetX, y: offsetY },\n\t\t\tscale: ratio,\n\t\t\tangle: 0,\n\t\t\trx: 0,\n\t\t\try: 0,\n\t\t\trz: 0\n\t\t};\n\n\t\t// on mobile, force the positioning to the top, so that it is not\n\t\t// covered by the virtual keyboard\n\t\tif (window.mode.isMobile()) {\n\t\t\t$(dialogContainer).dialog('option', 'position', { my: 'center top', at: 'center top', of: '#document-container' });\n\t\t\ttransformation.origin = 'center top';\n\t\t\ttransformation.translate.y = 0;\n\t\t}\n\n\t\tif (findZoomTarget(targetId) != null) {\n\t\t\tremoveZoomTarget(targetId);\n\t\t}\n\t\tzoomTargets.push({key: targetId, value: zoomTarget, titlebar: titlebar, transformation: transformation, initialState: state, width:width, height: height});\n\n\t\tvar that = this;\n\t\tvar hammerTitlebar = new Hammer(titlebar);\n\t\thammerTitlebar.add(new Hammer.Pan({ threshold: 20, pointers: 0 }));\n\t\thammerTitlebar.add(new Hammer.Pinch({ threshold: 0 })).recognizeWith([hammerTitlebar.get('pan')]);\n\n\t\thammerTitlebar.on('panstart', this.onPan);\n\t\thammerTitlebar.on('panmove', this.onPan);\n\t\thammerTitlebar.on('pinchstart pinchmove', this.onPinch);\n\t\thammerTitlebar.on('hammer.input', function(ev) {\n\t\t\tif (ev.isFirst) {\n\t\t\t\tdraggedObject = ev.target;\n\t\t\t}\n\n\t\t\tif (ev.isFinal && draggedObject) {\n\t\t\t\tvar id = toZoomTargetId(draggedObject.id);\n\t\t\t\tvar target = findZoomTarget(id);\n\t\t\t\tif (target) {\n\t\t\t\t\ttarget.initialState.startX = target.transformation.translate.x;\n\t\t\t\t\ttarget.initialState.startY = target.transformation.translate.y;\n\t\t\t\t}\n\t\t\t\tdraggedObject = null;\n\t\t\t}\n\t\t});\n\n\t\tvar hammerContent = new Hammer(canvas);\n\t\thammerContent.add(new Hammer.Pan({ threshold: 20, pointers: 0 }));\n\t\thammerContent.add(new Hammer.Pinch({ threshold: 0 })).recognizeWith([hammerContent.get('pan')]);\n\n\t\thammerContent.on('panstart', this.onPan);\n\t\thammerContent.on('panmove', this.onPan);\n\t\thammerContent.on('pinchstart pinchmove', this.onPinch);\n\t\thammerContent.on('hammer.input', function(ev) {\n\t\t\tif (ev.isFirst) {\n\t\t\t\tthat.wasInvalidated = false;\n\t\t\t\tdraggedObject = ev.target;\n\t\t\t}\n\t\t\telse if (that.wasInvalidated) {\n\t\t\t\tdraggedObject = null;\n\t\t\t\tthat.wasInvalidated = false;\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (ev.isFinal && draggedObject) {\n\t\t\t\tvar id = toZoomTargetId(draggedObject.id);\n\t\t\t\tvar target = findZoomTarget(id);\n\t\t\t\tif (target) {\n\t\t\t\t\ttarget.initialState.startX = target.transformation.translate.x;\n\t\t\t\t\ttarget.initialState.startY = target.transformation.translate.y;\n\t\t\t\t}\n\t\t\t\tdraggedObject = null;\n\t\t\t}\n\t\t});\n\n\t\tupdateTransformation(findZoomTarget(targetId));\n\t},\n\n\t_postWindowMouseEvent: function(type, winid, x, y, count, buttons, modifier) {\n\t\tapp.socket.sendMessage('windowmouse id=' + winid +  ' type=' + type +\n\t\t                              ' x=' + x + ' y=' + y + ' count=' + count +\n\t\t                              ' buttons=' + buttons + ' modifier=' + modifier);\n\t},\n\n\t_postWindowGestureEvent: function(winid, type, x, y, offset) {\n\t\t// window.app.console.log('x ' + x + ' y ' + y + ' o ' + offset);\n\t\tapp.socket.sendMessage('windowgesture id=' + winid +  ' type=' + type +\n\t\t                              ' x=' + x + ' y=' + y + ' offset=' + offset);\n\t},\n\n\t_closeChildWindows: function(dialogId) {\n\t\t// child windows - with greater id number\n\t\tvar that = this;\n\t\tvar foundCurrent = false;\n\n\t\tObject.keys(this._dialogs).forEach(function(id) {\n\t\t\tif (foundCurrent)\n\t\t\t\tthat._onDialogClose(id, true);\n\n\t\t\tif (id == dialogId)\n\t\t\t\tfoundCurrent = true;\n\t\t});\n\t},\n\n\t_onDialogClose: function(dialogId, notifyBackend) {\n\t\tthis._closeChildWindows(dialogId);\n\n\t\tif (window.ThisIsTheiOSApp && app.map.mobileTopBar)\n\t\t\tapp.map.mobileTopBar.enableItem('closemobile', true);\n\n\t\tif (notifyBackend)\n\t\t\tthis._sendCloseWindow(dialogId);\n\t\t$('#' + this._toStrId(dialogId)).remove();\n\n\t\t// focus the main document\n\t\tthis._map.fire('editorgotfocus');\n\t\tthis._map.focus();\n\n\t\tdelete this._dialogs[dialogId];\n\t\tthis._currentId = null;\n\n\t\tremoveZoomTarget(this._toStrId(dialogId));\n\t},\n\n\t_onClosePopups: function() {\n\t\tfor (var dialogId in this._dialogs) {\n\t\t\tthis._onDialogClose(dialogId, true);\n\t\t}\n\t\tif (this.hasDialogInMobilePanelOpened()) {\n\t\t\tthis._onDialogClose(window.mobileDialogId, true);\n\t\t}\n\t},\n\n\tonCloseCurrentPopUp: function() {\n\t\t// for title-less dialog only (context menu, pop-up)\n\t\tif (this._currentId && this._isOpen(this._currentId) &&\n\t\t\t!this._dialogs[this._currentId].title)\n\t\t\tthis._onDialogClose(this._currentId, true);\n\t},\n\n\t_onEditorGotFocus: function() {\n\t\t// We need to lose focus on any dialogs currently with focus.\n\t\tfor (var winId in this._dialogs) {\n\t\t\t$('#' + this._dialogs[winId].strId + '-cursor').css({display: 'none'});\n\t\t}\n\t},\n\n\t// Focus is being changed, update states.\n\t_changeFocusWidget: function (e) {\n\t\tif (e.winId === 0) {\n\t\t\t// We lost the focus.\n\t\t\tthis._onEditorGotFocus();\n\t\t} else {\n\t\t\tthis.focus(e.winId, e.acceptInput);\n\t\t\tif (this._map.formulabar)\n\t\t\t\tthis._map.onFormulaBarFocus();\n\t\t}\n\t},\n\n\t_paintDialog: function(parentId, rectangle, img) {\n\t\tvar strId = this._toStrId(parentId);\n\t\tvar canvas = document.getElementById(strId + '-canvas');\n\t\tif (!canvas)\n\t\t\treturn; // no window to paint to\n\n\t\tthis._dialogs[parentId].isPainting = true;\n\t\tvar ctx = canvas.getContext('2d');\n\n\t\tvar that = this;\n\t\tvar x = 0;\n\t\tvar y = 0;\n\t\tif (rectangle) {\n\t\t\trectangle = rectangle.split(',');\n\t\t\tx = parseInt(rectangle[0]);\n\t\t\ty = parseInt(rectangle[1]);\n\t\t}\n\n\t\tvar container = L.DomUtil.get(strId);\n\n\t\tctx.drawImage(img, x, y);\n\n\t\t// if dialog is hidden, show it\n\t\tif (container)\n\t\t\t$(container).parent().show();\n\n\t\tif (parentId in that._dialogs) {\n\t\t\t// We might have closed the dialog by the time we render.\n\t\t\tthat._dialogs[parentId].isPainting = false;\n\t\t\tthat._map.fire('changefocuswidget', {winId: parentId, dialog: that});\n\t\t}\n\t},\n\n\t// Binary dialog msg recvd from core\n\t_onDialogPaint: function (e) {\n\t\tvar id = parseInt(e.id);\n\t\tvar parentId = this._getParentId(id);\n\t\tif (parentId) {\n\t\t\tthis._paintDialogChild(parentId, e.img);\n\t\t} else {\n\t\t\tthis._paintDialog(id, e.rectangle, e.img);\n\t\t}\n\t},\n\n\t// Dialog Child Methods\n\n\t_paintDialogChild: function(parentId, img) {\n\t\tvar strId = this._toStrId(parentId);\n\t\tvar canvas = L.DomUtil.get(strId + '-floating');\n\t\tif (!canvas)\n\t\t\treturn; // no floating window to paint to\n\n\t\t// Make sure the child is not trimmed on the right.\n\t\tvar width = this._dialogs[parentId].childwidth;\n\t\tvar left = parseInt(canvas.style.left);\n\t\tvar leftPos = left + width;\n\t\tif (leftPos > window.innerWidth) {\n\t\t\tvar newLeft = window.innerWidth - width - 20;\n\t\t\tL.DomUtil.setStyle(canvas, 'left', newLeft + 'px');\n\t\t}\n\t\t// Also, make sure child is not trimmed on bottom.\n\t\tvar top = parseInt(canvas.style.top);\n\t\tvar height = this._dialogs[parentId].childheight;\n\t\tvar bottomPos = top + height;\n\t\tif (bottomPos > window.innerHeight) {\n\t\t\tvar newTop = top - height - 20;\n\t\t\tL.DomUtil.setStyle(canvas, 'top', newTop + 'px');\n\t\t}\n\n\t\t// The image is rendered per the HiDPI scale we used\n\t\t// while requesting rendering the image. Here we\n\t\t// set the canvas to have the actual size, while\n\t\t// the image is rendered with the HiDPI scale.\n\t\tthis._setCanvasWidthHeight(canvas, this._dialogs[parentId].childwidth,\n\t\t\tthis._dialogs[parentId].childheight);\n\n\t\tvar ctx = canvas.getContext('2d');\n\t\tctx.drawImage(img, 0, 0);\n\t\t$(canvas).show();\n\t},\n\n\t_onDialogChildClose: function(dialogId) {\n\t\t$('#' + this._toStrId(dialogId) + '-floating').remove();\n\n\t\t// Remove any extra height allocated for the parent container (only for floating dialogs).\n\t\tvar canvas = document.getElementById(dialogId + '-canvas');\n\t\tif (!canvas) {\n\t\t\tcanvas = document.getElementById(this._toStrId(dialogId) + '-canvas');\n\t\t\tif (!canvas)\n\t\t\t\treturn;\n\t\t}\n\t\tvar canvasHeight = canvas.height;\n\t\t$('#' + dialogId).height(canvasHeight + 'px');\n\n\t\tthis._dialogs[dialogId].childid = undefined;\n\t\tthis._dialogs[dialogId].childx = undefined;\n\t\tthis._dialogs[dialogId].childy = undefined;\n\t},\n\n\t_removeDialogChild: function(id) {\n\t\t$('#' + this._toStrId(id) + '-floating').remove();\n\t\tthis._dialogs[id].childid = undefined;\n\t\tthis._dialogs[id].childx = undefined;\n\t\tthis._dialogs[id].childy = undefined;\n\t},\n\n\t_createDialogChild: function(childId, parentId, top, left) {\n\t\tvar strId = this._toStrId(parentId);\n\t\tvar dialogContainer = L.DomUtil.get(strId);\n\t\tvar floatingCanvas = L.DomUtil.create('canvas', 'lokdialogchild-canvas', dialogContainer);\n\t\t$(floatingCanvas).hide(); // Hide to avoid flickering while we set the dimensions.\n\n\t\tfloatingCanvas.id = strId + '-floating';\n\t\tL.DomUtil.setStyle(floatingCanvas, 'position', 'fixed');\n\t\tL.DomUtil.setStyle(floatingCanvas, 'z-index', '11');\n\t\tL.DomUtil.setStyle(floatingCanvas, 'width', '0px');\n\t\tL.DomUtil.setStyle(floatingCanvas, 'height', '0px');\n\n\t\t/*\n\t\t\tSome notes:\n\t\t\t\t* Modal windows' child positions are relative to page borders.\n\t\t\t\t* So this code adapts to it.\n\t\t*/\n\n\t\t// Add header height..\n\t\tvar addition = 40;\n\t\tL.DomUtil.setStyle(floatingCanvas, 'margin-inline-start', left + 'px');\n\t\tL.DomUtil.setStyle(floatingCanvas, 'top', (top + addition) + 'px');\n\n\t\t// attach events\n\t\tthis._setupChildEvents(childId, floatingCanvas);\n\t},\n\n\t_setupChildEvents: function(childId, canvas) {\n\t\tL.DomEvent.on(canvas, 'contextmenu', L.DomEvent.preventDefault);\n\n\t\tL.DomEvent.on(canvas, 'touchstart touchmove touchend', function(e) {\n\t\t\tL.DomEvent.preventDefault(e);\n\t\t\tvar rect = canvas.getBoundingClientRect();\n\t\t\tvar touchX = (e.type === 'touchend') ? e.changedTouches[0].clientX : e.targetTouches[0].clientX;\n\t\t\tvar touchY = (e.type === 'touchend') ? e.changedTouches[0].clientY : e.targetTouches[0].clientY;\n\t\t\ttouchX = touchX - rect.x;\n\t\t\ttouchY = touchY - rect.y;\n\t\t\tif (e.type === 'touchstart')\n\t\t\t{\n\t\t\t\tfirstTouchPositionX = touchX;\n\t\t\t\tfirstTouchPositionY = touchY;\n\t\t\t\tthis._postWindowGestureEvent(childId, 'panBegin', firstTouchPositionX, firstTouchPositionY, 0);\n\t\t\t}\n\t\t\telse if (e.type === 'touchend')\n\t\t\t{\n\t\t\t\tthis._postWindowGestureEvent(childId, 'panEnd', firstTouchPositionX, firstTouchPositionY, firstTouchPositionY - touchY);\n\t\t\t\tif (previousTouchType === 'touchstart') {\n\t\t\t\t\t// Simulate mouse click\n\t\t\t\t\tif (this._map['mouse']) {\n\t\t\t\t\t\tthis._postWindowMouseEvent('buttondown', childId, firstTouchPositionX, firstTouchPositionY, 1, this._map['mouse'].LOButtons.left, 0);\n\t\t\t\t\t\tthis._postWindowMouseEvent('buttonup', childId, firstTouchPositionX, firstTouchPositionY, 1, this._map['mouse'].LOButtons.left, 0);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis._postWindowMouseEvent('buttondown', childId, firstTouchPositionX, firstTouchPositionY, 1, 1, 0);\n\t\t\t\t\t\tthis._postWindowMouseEvent('buttonup', childId, firstTouchPositionX, firstTouchPositionY, 1, 1, 0);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tfirstTouchPositionX = null;\n\t\t\t\tfirstTouchPositionY = null;\n\t\t\t}\n\t\t\telse if (e.type === 'touchmove')\n\t\t\t{\n\t\t\t\tthis._postWindowGestureEvent(childId, 'panUpdate', firstTouchPositionX, firstTouchPositionY, firstTouchPositionY - touchY);\n\t\t\t}\n\t\t\tpreviousTouchType = e.type;\n\t\t}, this);\n\n\t\tL.DomEvent.on(canvas, 'mousedown mouseup', function(e) {\n\t\t\tvar buttons = 0;\n\t\t\tif (this._map['mouse']) {\n\t\t\t\tbuttons |= e.button === this._map['mouse'].JSButtons.left ? this._map['mouse'].LOButtons.left : 0;\n\t\t\t\tbuttons |= e.button === this._map['mouse'].JSButtons.middle ? this._map['mouse'].LOButtons.middle : 0;\n\t\t\t\tbuttons |= e.button === this._map['mouse'].JSButtons.right ? this._map['mouse'].LOButtons.right : 0;\n\t\t\t} else {\n\t\t\t\tbuttons = 1;\n\t\t\t}\n\t\t\tvar lokEventType = e.type.replace('mouse', 'button');\n\t\t\tthis._postWindowMouseEvent(lokEventType, childId, e.offsetX, e.offsetY, 1, buttons, 0);\n\t\t}, this);\n\t\tL.DomEvent.on(canvas, 'mousemove', function(e) {\n\t\t\tthis._postWindowMouseEvent('move', childId, e.offsetX, e.offsetY, 1, 0, 0);\n\t\t}, this);\n\t\tL.DomEvent.on(canvas, 'contextmenu', function() {\n\t\t\treturn false;\n\t\t});\n\t}\n\n});\n\nL.control.lokDialog = function (options) {\n\treturn new L.Control.LokDialog(options);\n};\n"]}