{"version":3,"file":"Control.AlertDialog.js","sourceRoot":"","sources":["../../../../../../../../../../TanhX/online/browser/src/control/Control.AlertDialog.js"],"names":[],"mappings":"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","sourcesContent":["/* -*- js-indent-level: 8 -*- */\n/*\n * Copyright the Collabora Online contributors.\n *\n * SPDX-License-Identifier: MPL-2.0\n *\n * This Source Code Form is subject to the terms of the Mozilla Public\n * License, v. 2.0. If a copy of the MPL was not distributed with this\n * file, You can obtain one at http://mozilla.org/MPL/2.0/.\n */\n/*\n * L.Control.Dialog used for displaying alerts\n */\n\n/* global _ sanitizeUrl JSDialog */\nL.Control.AlertDialog = L.Control.extend({\n\tonAdd: function (map) {\n\t\t// TODO: Better distinction between warnings and errors\n\t\tmap.on('error', this._onError, this);\n\t\tmap.on('warn', this._onError, this);\n\t},\n\n\t_onError: function(e) {\n\t\tif (!this._map._fatal &&\n\t\t    e.cmd !== 'notasync' &&\n\t\t    e.type !== 'warn') {\n\t\t\tthis._map.uiManager.closeAll();\n\t\t}\n\n\t\tif (e.msg) {\n\t\t\tif (window.ThisIsAMobileApp && this._map._fatal) {\n\t\t\t\tthis._map.uiManager.showConfirmModal('cool_alert', '', e.msg, _('Close'), function() {\n\t\t\t\t\twindow.postMobileMessage('BYE');\n\t\t\t\t\tthis._map.uiManager.closeAll();\n\t\t\t\t}.bind(this), true /* Hide cancel button */);\n\t\t\t}\n\t\t\telse\n\t\t\t\tthis._map.uiManager.showConfirmModal('cool_alert', '', e.msg, _('Close'), function() { /* Do nothing. */ }, true);\n\t\t}\n\t\telse if (e.cmd == 'load' && e.kind == 'docunloading') {\n\t\t\t// Handled by transparently retrying.\n\t\t\treturn;\n\t\t} else if (e.cmd == 'openlink') {\n\t\t\tvar url = e.url;\n\t\t\tvar messageText = window.errorMessages.leaving;\n\n\t\t\tvar isLinkValid = sanitizeUrl(url) !== 'about:blank';\n\n\t\t\tif (!isLinkValid) {\n\t\t\t\tmessageText = window.errorMessages.invalidLink;\n\t\t\t}\n\n\t\t\tthis._map.uiManager.showInfoModal('openlink', _('External link'), messageText, url,\n\t\t\t\tisLinkValid ? _('Open link') : _('OK'), function() {\n\t\t\t\t\tif (!isLinkValid)\n\t\t\t\t\t\treturn;\n\t\t\t\t\tif ('processCoolUrl' in window) {\n\t\t\t\t\t\turl = window.processCoolUrl({ url: url, type: 'doc' });\n\t\t\t\t\t}\n\n\t\t\t\t\twindow.open(url, '_blank');\n\t\t\t\t});\n\t\t} else if (e.kind == 'network' && e.code == 24581) {\n\t\t\tif (e.cmd == 'paste') {\n\t\t\t\tvar alertId = 'paste_network_access_error';\n\t\t\t\tvar title = _('Copied external sources are not allowed');\n\t\t\t\tvar message1 = _('It seems you have copied a selection that includes external images.');\n\t\t\t\tvar message2 = _('Downloading external resources is forbidden but pasting images is still possible. Please right click in the image, choose \"Copy Image\" and paste it into the document instead.');\n\t\t\t} else {\n\t\t\t\t// insert image for example, it should not happen with correct coolwsd.xml configuration of net.lok_allow\n\t\t\t\talertId = 'insert_network_access_error';\n\t\t\t\ttitle = _('External data source not allowed');\n\t\t\t\tmessage1 = _('It seems you have tried to insert external data.');\n\t\t\t\tmessage2 = _('Selected external data source is forbidden. Please contact the system administrator.');\n\t\t\t}\n\n\t\t\tif (JSDialog.shouldShowAgain(alertId)) {\n\t\t\t\tvar alertOptions = {\n\t\t\t\t\ttitle: title,\n\t\t\t\t\tmessages: [\n\t\t\t\t\t\tmessage1,\n\t\t\t\t\t\tmessage2\n\t\t\t\t\t],\n\t\t\t\t\tbuttons: [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ttext: _('Don\\'t show this again'),\n\t\t\t\t\t\t\tcallback: function() {\n\t\t\t\t\t\t\t\tJSDialog.setShowAgain(alertId, false);\n\t\t\t\t\t\t\t\treturn false; // Close modal\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t],\n\t\t\t\t\twithCancel: false,\n\t\t\t\t\tfocusId: JSDialog.generateModalId(alertId) + '-cancel'\n\t\t\t\t};\n\n\t\t\t\tJSDialog.showInfoModalWithOptions(alertId, alertOptions);\n\t\t\t}\n\t\t} else if (e.cmd == 'notasync') { // developer only no translation needed\n\t\t\tthis._map.uiManager.showInfoModal(\n\t\t\t\t'cool_alert', '', 'This dialog is non-async', '', _('Close'), function() { /* Do nothing. */ }, false);\n\t\t} else if (e.cmd && e.kind) {\n\t\t\tthis._map.fire('hidebusy');\n\n\t\t\tvar msg = _('The server encountered a {0} error while parsing the {1} command.');\n\t\t\tmsg = msg.replace('{0}', e.kind);\n\t\t\tmsg = msg.replace('{1}', e.cmd);\n\t\t\tthis._map.uiManager.showInfoModal('cool_alert', '', msg, '', _('Close'), function() { /* Do nothing. */ }, false);\n\t\t}\n\t}\n});\n\nL.control.alertDialog = function (options) {\n\treturn new L.Control.AlertDialog(options);\n};\n"]}