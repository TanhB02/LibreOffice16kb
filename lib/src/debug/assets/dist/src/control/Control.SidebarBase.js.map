{"version":3,"file":"Control.SidebarBase.js","sourceRoot":"","sources":["../../../../../../../../../../TanhX/online/browser/src/control/Control.SidebarBase.ts"],"names":[],"mappings":"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","sourcesContent":["// @ts-strict-ignore\n/* -*- js-indent-level: 8 -*- */\n/*\n * Copyright the Collabora Online contributors.\n *\n * SPDX-License-Identifier: MPL-2.0\n *\n * This Source Code Form is subject to the terms of the Mozilla Public\n * License, v. 2.0. If a copy of the MPL was not distributed with this\n * file, You can obtain one at http://mozilla.org/MPL/2.0/.\n */\n/*\n * Control.SidebarBase\n */\n\n/* global app */\ndeclare var JSDialog: any;\n\nenum SidebarType {\n\tSidebar = 'sidebar',\n\tNavigator = 'navigator',\n}\ninterface SidebarOptions {\n\tanimSpeed: number;\n}\nabstract class SidebarBase {\n\toptions: SidebarOptions;\n\ttype: SidebarType;\n\n\tmap: any;\n\n\tcontainer: HTMLDivElement;\n\tdocumentContainer: HTMLDivElement;\n\twrapper: HTMLElement;\n\tbuilder: any;\n\tenableFocus: boolean;\n\n\tconstructor(\n\t\tmap: any,\n\t\toptions: SidebarOptions = {\n\t\t\tanimSpeed: 1000,\n\t\t} /* Default speed: to be used on load */,\n\t\ttype: SidebarType,\n\t) {\n\t\tthis.type = type;\n\t\tthis.options = options;\n\t\tthis.onAdd(map);\n\t}\n\n\tonAdd(map: ReturnType<typeof L.map>) {\n\t\tthis.map = map;\n\n\t\tapp.events.on('resize', this.onResize.bind(this));\n\n\t\tthis.builder = new L.control.jsDialogBuilder({\n\t\t\tmobileWizard: this,\n\t\t\tmap: map,\n\t\t\tcssClass: `jsdialog sidebar`, // use sidebar css for now, maybe have seperate css for navigator later\n\t\t});\n\t\tthis.container = L.DomUtil.create(\n\t\t\t'div',\n\t\t\t`${this.type}-container`,\n\t\t\t$(`#${this.type}-panel`).get(0),\n\t\t);\n\t\tthis.wrapper = document.getElementById(`${this.type}-dock-wrapper`);\n\t\tthis.documentContainer = document.querySelector('#document-container');\n\n\t\tthis.map.on('jsdialogupdate', this.onJSUpdate, this);\n\t\tthis.map.on('jsdialogaction', this.onJSAction, this);\n\t}\n\n\tonRemove() {\n\t\tthis.map.off('jsdialogupdate', this.onJSUpdate, this);\n\t\tthis.map.off('jsdialogaction', this.onJSAction, this);\n\t}\n\n\tisVisible(): boolean {\n\t\treturn $(`#${this.type}-dock-wrapper`).hasClass('visible');\n\t}\n\n\tcloseSidebar() {\n\t\t$(`#${this.type}-dock-wrapper`).removeClass('visible');\n\n\t\tif (!this.map.editorHasFocus()) {\n\t\t\tthis.map.fire('editorgotfocus');\n\t\t\tthis.map.focus();\n\t\t}\n\n\t\tconst upperCaseType = this.type[0].toUpperCase() + this.type.slice(1);\n\t\tthis.map.uiManager.setDocTypePref('Show' + upperCaseType, false);\n\t}\n\n\tonJSUpdate(e: FireEvent) {\n\t\tvar data = e.data;\n\n\t\tif (data.jsontype !== this.type) return;\n\n\t\tif (!this.container) return;\n\n\t\tif (!this.builder) return;\n\n\t\t// reduce unwanted warnings in console\n\t\tif (data.control.id === 'addonimage') {\n\t\t\twindow.app.console.log('Ignored update for control: ' + data.control.id);\n\t\t\treturn;\n\t\t}\n\n\t\tthis.builder.updateWidget(this.container, data.control);\n\t}\n\n\tonJSAction(e: FireEvent) {\n\t\tvar data = e.data;\n\n\t\tif (data.jsontype !== this.type) return;\n\n\t\tif (!this.builder) return;\n\n\t\tif (!this.container) return;\n\n\t\tvar innerData = data.data;\n\t\tif (!innerData) return;\n\n\t\tvar controlId = innerData.control_id;\n\n\t\t// Panels share the same name for main containers, do not execute actions for them\n\t\t// if panel has to be shown or hidden, full update will appear\n\t\tif (\n\t\t\tcontrolId.indexOf('contents') === 0 ||\n\t\t\tcontrolId.indexOf('titlebar') === 0 ||\n\t\t\tcontrolId.indexOf('expander') === 0 ||\n\t\t\tcontrolId.indexOf('addonimage') === 0\n\t\t) {\n\t\t\twindow.app.console.log(\n\t\t\t\t'Ignored action: ' +\n\t\t\t\t\tinnerData.action_type +\n\t\t\t\t\t' for control: ' +\n\t\t\t\t\tcontrolId,\n\t\t\t);\n\t\t\treturn;\n\t\t}\n\n\t\tthis.builder.executeAction(this.container, innerData);\n\t}\n\tmarkNavigatorTreeView(data: WidgetJSON): boolean {\n\t\tif (!data) return false;\n\n\t\tif (data.type === 'treelistbox') {\n\t\t\t(data as TreeWidgetJSON).draggable = false;\n\t\t\treturn true;\n\t\t}\n\n\t\tfor (const i in data.children) {\n\t\t\tif (this.markNavigatorTreeView(data.children[i])) {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\n\t\treturn false;\n\t}\n\tonResize() {\n\t\tthis.wrapper.style.maxHeight =\n\t\t\tthis.documentContainer.getBoundingClientRect().height + 'px';\n\t}\n}\nJSDialog.SidebarBase = SidebarBase;\n"]}