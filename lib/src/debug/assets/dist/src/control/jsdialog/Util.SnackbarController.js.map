{"version":3,"file":"Util.SnackbarController.js","sourceRoot":"","sources":["../../../../../../../../../../../TanhX/online/browser/src/control/jsdialog/Util.SnackbarController.ts"],"names":[],"mappings":"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","sourcesContent":["// @ts-strict-ignore\n/* -*- js-indent-level: 8 -*- */\n/*\n * Copyright the Collabora Online contributors.\n *\n * SPDX-License-Identifier: MPL-2.0\n *\n * This Source Code Form is subject to the terms of the Mozilla Public\n * License, v. 2.0. If a copy of the MPL was not distributed with this\n * file, You can obtain one at http://mozilla.org/MPL/2.0/.\n */\n\n/*\n * Util.SnackbarController - helper for managing the snackbars queue\n */\n\ndeclare var JSDialog: any;\n\ntype SnackbarData = {\n\tlabel: string;\n\taction: string | undefined;\n\tcallback: () => void | undefined;\n\ttimeout: number;\n\thasProgress: boolean | undefined;\n\twithDismiss: boolean | undefined;\n\tinfinite: boolean | undefined;\n};\n\nclass SnackbarController {\n\tsnackbarTimeout: number = 10000;\n\tsnackbarQueue: Array<SnackbarData>;\n\tshowingSnackbar: boolean = false;\n\n\tconstructor() {\n\t\tthis.snackbarQueue = new Array<SnackbarData>();\n\t}\n\n\tpublic closeSnackbar() {\n\t\tvar closeMessage = {\n\t\t\tid: 'snackbar',\n\t\t\tjsontype: 'dialog',\n\t\t\ttype: 'snackbar',\n\t\t\taction: 'close',\n\t\t};\n\t\tapp.socket._onMessage({\n\t\t\ttextMsg: 'jsdialog: ' + JSON.stringify(closeMessage),\n\t\t});\n\n\t\tthis.showingSnackbar = false;\n\t\tthis.scheduleSnackbar();\n\t}\n\n\tpublic showSnackbar(\n\t\tlabel: string,\n\t\taction: string | undefined,\n\t\tcallback: () => void | undefined,\n\t\ttimeout: number | undefined,\n\t\thasProgress: boolean | undefined,\n\t\twithDismiss: boolean | undefined,\n\t\tinfinite: boolean | undefined,\n\t) {\n\t\tif (!app.socket) return;\n\n\t\tthis.snackbarQueue.push({\n\t\t\tlabel: label,\n\t\t\taction: action,\n\t\t\tcallback: callback,\n\t\t\ttimeout: timeout,\n\t\t\thasProgress: hasProgress,\n\t\t\twithDismiss: withDismiss,\n\t\t\tinfinite: infinite,\n\t\t});\n\n\t\tthis.scheduleSnackbar();\n\t}\n\n\tprivate extractTimeout(snackbarData: SnackbarData): number {\n\t\treturn snackbarData.timeout || this.snackbarTimeout;\n\t}\n\n\tprivate scheduleSnackbar() {\n\t\tif (this.showingSnackbar || !this.snackbarQueue.length) return;\n\n\t\tconst snackbarData = this.snackbarQueue.shift();\n\t\tthis.showSnackbarImpl(snackbarData);\n\t\tthis.showingSnackbar = true;\n\t}\n\n\tprivate showSnackbarImpl(snackbarData: SnackbarData) {\n\t\tvar buttonId = 'button';\n\t\tvar labelId = 'label';\n\n\t\tvar json = {\n\t\t\tid: 'snackbar',\n\t\t\tjsontype: 'dialog',\n\t\t\ttype: 'snackbar',\n\t\t\ttimeout: this.extractTimeout(snackbarData),\n\t\t\tinit_focus_id: snackbarData.action ? buttonId : undefined,\n\t\t\tchildren: [\n\t\t\t\t{\n\t\t\t\t\tid: snackbarData.hasProgress\n\t\t\t\t\t\t? 'snackbar-container-progress'\n\t\t\t\t\t\t: 'snackbar-container',\n\t\t\t\t\ttype: 'container',\n\t\t\t\t\tchildren: [\n\t\t\t\t\t\tsnackbarData.action\n\t\t\t\t\t\t\t? {\n\t\t\t\t\t\t\t\t\tid: labelId,\n\t\t\t\t\t\t\t\t\ttype: 'fixedtext',\n\t\t\t\t\t\t\t\t\ttext: snackbarData.label,\n\t\t\t\t\t\t\t\t\tlabelFor: buttonId,\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t: {\n\t\t\t\t\t\t\t\t\tid: 'label-no-action',\n\t\t\t\t\t\t\t\t\ttype: 'fixedtext',\n\t\t\t\t\t\t\t\t\ttext: snackbarData.label,\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\tsnackbarData.withDismiss\n\t\t\t\t\t\t\t? {\n\t\t\t\t\t\t\t\t\tid: 'snackbar-dismiss-button',\n\t\t\t\t\t\t\t\t\ttype: 'pushbutton',\n\t\t\t\t\t\t\t\t\ttext: _('Dismiss'),\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t: {},\n\t\t\t\t\t\tsnackbarData.hasProgress\n\t\t\t\t\t\t\t? {\n\t\t\t\t\t\t\t\t\tid: 'progress',\n\t\t\t\t\t\t\t\t\ttype: 'progressbar',\n\t\t\t\t\t\t\t\t\tvalue: 0,\n\t\t\t\t\t\t\t\t\tmaxValue: 100,\n\t\t\t\t\t\t\t\t\tinfinite: snackbarData.infinite,\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t: {},\n\t\t\t\t\t\tsnackbarData.action\n\t\t\t\t\t\t\t? {\n\t\t\t\t\t\t\t\t\tid: buttonId,\n\t\t\t\t\t\t\t\t\ttype: 'pushbutton',\n\t\t\t\t\t\t\t\t\ttext: snackbarData.action,\n\t\t\t\t\t\t\t\t\tlabelledBy: labelId,\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t: {},\n\t\t\t\t\t],\n\t\t\t\t},\n\t\t\t],\n\t\t};\n\n\t\tvar builderCallback: JSDialogCallback = (\n\t\t\tobjectType: string,\n\t\t\teventType: string,\n\t\t\tobject: any,\n\t\t\tdata: any,\n\t\t\tbuilder: JSBuilder,\n\t\t) => {\n\t\t\twindow.app.console.debug(\n\t\t\t\t\"control: '\" +\n\t\t\t\t\tobjectType +\n\t\t\t\t\t\"' id:'\" +\n\t\t\t\t\tobject.id +\n\t\t\t\t\t\"' event: '\" +\n\t\t\t\t\teventType +\n\t\t\t\t\t\"' state: '\" +\n\t\t\t\t\tdata +\n\t\t\t\t\t\"'\",\n\t\t\t);\n\n\t\t\tif (\n\t\t\t\tobject.id === buttonId &&\n\t\t\t\tobjectType === 'pushbutton' &&\n\t\t\t\teventType === 'click'\n\t\t\t) {\n\t\t\t\tif (typeof snackbarData.callback === 'function')\n\t\t\t\t\tsnackbarData.callback();\n\n\t\t\t\tthis.closeSnackbar();\n\t\t\t} else if (\n\t\t\t\tobject.id === '__POPOVER__' &&\n\t\t\t\tobjectType === 'popover' &&\n\t\t\t\teventType === 'close'\n\t\t\t) {\n\t\t\t\tthis.closeSnackbar();\n\t\t\t}\n\n\t\t\tif (\n\t\t\t\tobject.id === 'snackbar-dismiss-button' &&\n\t\t\t\tobjectType === 'pushbutton' &&\n\t\t\t\teventType === 'click'\n\t\t\t) {\n\t\t\t\tthis.closeSnackbar();\n\t\t\t}\n\t\t};\n\n\t\tapp.socket._onMessage({\n\t\t\ttextMsg: 'jsdialog: ' + JSON.stringify(json),\n\t\t\tcallback: builderCallback,\n\t\t});\n\t}\n\n\t// value should be in range 0-100\n\tpublic setSnackbarProgress(value: number, infinite: boolean) {\n\t\tif (!app.socket) return;\n\n\t\tvar json = {\n\t\t\tid: 'snackbar',\n\t\t\tjsontype: 'dialog',\n\t\t\ttype: 'snackbar',\n\t\t\taction: 'update',\n\t\t\tcontrol: {\n\t\t\t\tid: 'progress',\n\t\t\t\ttype: 'progressbar',\n\t\t\t\tvalue: value,\n\t\t\t\tmaxValue: 100,\n\t\t\t\tinfinite: infinite,\n\t\t\t},\n\t\t};\n\n\t\tapp.socket._onMessage({ textMsg: 'jsdialog: ' + JSON.stringify(json) });\n\t}\n}\n\nJSDialog.SnackbarController = new SnackbarController();\n"]}