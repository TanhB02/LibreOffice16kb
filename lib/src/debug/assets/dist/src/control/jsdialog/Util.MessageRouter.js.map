{"version":3,"file":"Util.MessageRouter.js","sourceRoot":"","sources":["../../../../../../../../../../../TanhX/online/browser/src/control/jsdialog/Util.MessageRouter.ts"],"names":[],"mappings":"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","sourcesContent":["/* -*- js-indent-level: 8 -*- */\n/*\n * Copyright the Collabora Online contributors.\n *\n * SPDX-License-Identifier: MPL-2.0\n *\n * This Source Code Form is subject to the terms of the Mozilla Public\n * License, v. 2.0. If a copy of the MPL was not distributed with this\n * file, You can obtain one at http://mozilla.org/MPL/2.0/.\n */\n\n/*\n * Util.MessageRouter - helper for routing JSDialog messages to correct components\n */\n\ndeclare var JSDialog: any;\n\nclass JSDialogMessageRouter {\n\t// show labels instead of editable fields in message boxes\n\tprivate _preProcessMessageDialog(msgData: WidgetJSON) {\n\t\tfor (var i in msgData.children) {\n\t\t\tvar child = msgData.children[i];\n\t\t\tif (child.type === 'multilineedit') child.type = 'fixedtext';\n\t\t\telse if (child.children) this._preProcessMessageDialog(child);\n\t\t}\n\t}\n\n\tpublic processMessage(msgData: JSDialogJSON, callbackFn: JSDialogCallback) {\n\t\t// update existing component\n\t\tif (msgData.action) {\n\t\t\tvar fireJSDialogEvent = function () {\n\t\t\t\tswitch (msgData.action) {\n\t\t\t\t\tcase 'update':\n\t\t\t\t\t\tapp.socket._map.fire('jsdialogupdate', { data: msgData });\n\t\t\t\t\t\treturn true;\n\n\t\t\t\t\tcase 'action':\n\t\t\t\t\t\tapp.socket._map.fire('jsdialogaction', { data: msgData });\n\t\t\t\t\t\treturn true;\n\t\t\t\t}\n\n\t\t\t\treturn false;\n\t\t\t};\n\n\t\t\tvar isNotebookbarInitialized =\n\t\t\t\tapp.socket._map.uiManager && app.socket._map.uiManager.notebookbar;\n\t\t\tif (\n\t\t\t\t(msgData.jsontype === 'notebookbar' && !isNotebookbarInitialized) ||\n\t\t\t\t(msgData.jsontype === 'addressinputfield' &&\n\t\t\t\t\t!app.socket._map.addressInputField)\n\t\t\t) {\n\t\t\t\tsetTimeout(fireJSDialogEvent, 1000);\n\t\t\t\treturn;\n\t\t\t} else if (fireJSDialogEvent() === true) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\tif (msgData.type === 'messagebox') this._preProcessMessageDialog(msgData);\n\n\t\t// appears in autofilter dropdown for hidden popups, we can ignore that\n\t\tif (msgData.jsontype === 'popup') return;\n\n\t\t// re/create component\n\t\tif (window.mode.isMobile()) {\n\t\t\t// allow to use desktop's JSDialog component to show dropdowns\n\t\t\tif (\n\t\t\t\tmsgData.type === 'dropdown' ||\n\t\t\t\tmsgData.type === 'snackbar' ||\n\t\t\t\t(msgData.type === 'modalpopup' &&\n\t\t\t\t\tmsgData.id === JSDialog.generateModalId(app.idleHandlerId))\n\t\t\t) {\n\t\t\t\tapp.socket._map.fire('jsdialog', {\n\t\t\t\t\tdata: msgData,\n\t\t\t\t\tcallback: callbackFn,\n\t\t\t\t});\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// use mobile wizard\n\t\t\tif (msgData.type == 'borderwindow') return;\n\t\t\tif (msgData.jsontype === 'formulabar') {\n\t\t\t\tapp.socket._map.fire('formulabar', { data: msgData });\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (\n\t\t\t\tmsgData.enabled ||\n\t\t\t\tmsgData.jsontype === 'dialog' ||\n\t\t\t\tmsgData.type === 'modalpopup'\n\t\t\t) {\n\t\t\t\tapp.socket._map.fire('mobilewizard', {\n\t\t\t\t\tdata: msgData,\n\t\t\t\t\tcallback: callbackFn,\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tconsole.warn(\n\t\t\t\t\t'jsdialog: unhandled jsdialog mobile message: {jsontype: \"' +\n\t\t\t\t\t\tmsgData.jsontype +\n\t\t\t\t\t\t'\", type: \"' +\n\t\t\t\t\t\tmsgData.type +\n\t\t\t\t\t\t'\" ... }',\n\t\t\t\t);\n\t\t\t}\n\t\t} else if (msgData.jsontype === 'dialog') {\n\t\t\tapp.socket._map.fire('jsdialog', { data: msgData, callback: callbackFn });\n\t\t} else if (msgData.jsontype === 'sidebar') {\n\t\t\tapp.socket._map.fire('sidebar', { data: msgData });\n\t\t} else if (msgData.jsontype === 'navigator') {\n\t\t\tapp.socket._map.fire('navigator', { data: msgData });\n\t\t} else if (msgData.jsontype === 'formulabar') {\n\t\t\tapp.socket._map.fire('formulabar', { data: msgData });\n\t\t} else if (msgData.jsontype === 'notebookbar') {\n\t\t\tif (msgData.children) {\n\t\t\t\tfor (var i = 0; i < msgData.children.length; i++) {\n\t\t\t\t\tif (msgData.children[i].type === 'control') {\n\t\t\t\t\t\tmsgData.children[i].id = msgData.id;\n\t\t\t\t\t\tapp.socket._map.fire('notebookbar', msgData.children[i]);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t} else {\n\t\t\tconsole.warn(\n\t\t\t\t'Unhandled jsdialog message: {jsontype: \"' +\n\t\t\t\t\tmsgData.jsontype +\n\t\t\t\t\t'\", type: \"' +\n\t\t\t\t\tmsgData.type +\n\t\t\t\t\t'\" ... }',\n\t\t\t);\n\t\t}\n\t}\n}\n\nJSDialog.MessageRouter = new JSDialogMessageRouter();\n"]}