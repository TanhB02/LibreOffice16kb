{"version":3,"file":"Util.FocusCycle.js","sourceRoot":"","sources":["../../../../../../../../../../../TanhX/online/browser/src/control/jsdialog/Util.FocusCycle.js"],"names":[],"mappings":"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","sourcesContent":["/* -*- js-indent-level: 8 -*- */\n/*\n * Copyright the Collabora Online contributors.\n *\n * SPDX-License-Identifier: MPL-2.0\n *\n * This Source Code Form is subject to the terms of the Mozilla Public\n * License, v. 2.0. If a copy of the MPL was not distributed with this\n * file, You can obtain one at http://mozilla.org/MPL/2.0/.\n */\n\n/*\n * JSDialog.FocusCycle - focus related functions\n */\n\n/* global app JSDialog $ cool */\n\nfunction isAnyInputFocused() {\n\tif (!app.map)\n\t\treturn false;\n\n\tif (app.map.hasFocus())\n\t\treturn false;\n\n\tvar hasTunneledDialogOpened = app.map.dialog ? app.map.dialog.hasOpenedDialog() : false;\n\tvar hasJSDialogOpened = app.map.jsdialog ? app.map.jsdialog.hasDialogOpened() : false;\n\tvar hasJSDialogFocused = L.DomUtil.hasClass(document.activeElement, 'jsdialog');\n\tvar commentHasFocus = cool.Comment.isAnyFocus();\n\tvar inputHasFocus = $('input:focus').length > 0 || $('textarea.jsdialog:focus').length > 0;\n\n\treturn hasTunneledDialogOpened || hasJSDialogOpened || hasJSDialogFocused\n\t\t|| commentHasFocus || inputHasFocus;\n}\n\nfunction getFocusableElements(container) {\n\tif (!container)\n\t\treturn null;\n\n\tvar ret = container.querySelectorAll('[tabIndex=\"0\"]:not(.jsdialog-begin-marker, .jsdialog-end-marker):not([disabled]):not(.hidden)');\n\tif (!ret.length)\n\t\tret = container.querySelectorAll('input:not([disabled]):not(.hidden)');\n\tif (!ret.length)\n\t\tret = container.querySelectorAll('textarea:not([disabled]):not(.hidden)');\n\tif (!ret.length)\n\t\tret = container.querySelectorAll('select:not([disabled]):not(.hidden)');\n\tif (!ret.length)\n\t\tret = container.querySelectorAll('button:not([disabled]):not(.hidden)');\n\treturn ret;\n}\n\n// Utility function to check if an element is focusable\n// This function different from getFocusableElements. This only checks, if the current element is focusable or not.\nfunction isFocusable(element) {\n\tif (!element) return false;\n\n\t// Check if element is focusable (e.g. input, button, link etc.)\n\tconst focusableElements = [\n\t\t'a[href]:not([disabled]):not(.hidden)',\n\t\t'button:not([disabled]):not(.hidden)',\n\t\t'textarea:not([disabled]):not(.hidden)',\n\t\t'input[type=\"text\"]:not([disabled]):not(.hidden)',\n\t\t'input[type=\"radio\"]:not([disabled]):not(.hidden)',\n\t\t'input[type=\"checkbox\"]:not([disabled]):not(.hidden)',\n\t\t'select:not([disabled]):not(.hidden)',\n\t\t'[tabindex]:not([tabindex=\"-1\"]):not(.jsdialog-begin-marker):not(.jsdialog-end-marker):not([disabled]):not(.hidden)',\n\t];\n\n\treturn focusableElements.some((selector) => element.matches(selector));\n}\n\n/// close tab focus switching in cycle inside container\nfunction makeFocusCycle(container, failedToFindFocusFunc) {\n\tvar beginMarker = L.DomUtil.create('div', 'jsdialog autofilter jsdialog-begin-marker');\n\tvar endMarker = L.DomUtil.create('div', 'jsdialog autofilter jsdialog-end-marker');\n\n\tbeginMarker.tabIndex = 0;\n\tendMarker.tabIndex = 0;\n\n\tcontainer.insertBefore(beginMarker, container.firstChild);\n\tcontainer.appendChild(endMarker);\n\n\tcontainer.addEventListener('focusin', function(event) {\n\t\tif (event.target == endMarker) {\n\t\t\tvar firstFocusElement = getFocusableElements(container);\n\t\t\tif (firstFocusElement && firstFocusElement.length) {\n\t\t\t\tfirstFocusElement[0].focus();\n\t\t\t\treturn;\n\t\t\t}\n\t\t} else if (event.target == beginMarker) {\n\t\t\tvar focusables = getFocusableElements(container);\n\t\t\tvar lastFocusElement = focusables.length ? focusables[focusables.length - 1] : null;\n\t\t\tif (lastFocusElement) {\n\t\t\t\tlastFocusElement.focus();\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\tif ((event.target == endMarker || event.target == beginMarker) && failedToFindFocusFunc)\n\t\t\tfailedToFindFocusFunc();\n\t});\n}\n\nfunction findFocusableElement(element, direction) {\n\t// check if no element present the just return null\n\tif (!element) return null;\n\n\t// Check the current element if it is focusable\n\tif (isFocusable(element)) return element;\n\n\t// Check if sibling is focusable or contains focusable elements\n\tconst focusableInSibling = findFocusableWithin(element, direction);\n\tif (focusableInSibling) return focusableInSibling;\n\n\treturn findNextFocusableSiblingElement(element, direction);\n}\n\n// Helper function to find the first focusable element within an element\nfunction findFocusableWithin(element, direction){\n\tconst focusableElements = Array.from(element.querySelectorAll('*'));\n\treturn direction === 'next'\n\t\t? (focusableElements.find(isFocusable))\n\t\t: (focusableElements.reverse().find(isFocusable));\n}\n\nfunction findNextFocusableSiblingElement(element, direction) {\n\t// Depending on the direction, find the next or previous sibling\n\tconst sibling =\n\t\tdirection === 'next'\n\t\t\t? element.nextElementSibling\n\t\t\t: element.previousElementSibling;\n\n\t// Recursively check the next or previous sibling of the current sibling is focusable\n\treturn findFocusableElement(sibling, direction);\n}\n\n// Helper function to find the current active element is a input TEXTAREA\nfunction isTextInputField(currentActiveElement){\n\treturn (currentActiveElement.tagName === 'INPUT' && currentActiveElement.type === 'text') || currentActiveElement.tagName === 'TEXTAREA';\n}\n\nJSDialog.IsAnyInputFocused = isAnyInputFocused;\nJSDialog.GetFocusableElements = getFocusableElements;\nJSDialog.MakeFocusCycle = makeFocusCycle;\nJSDialog.FindFocusableElement = findFocusableElement;\nJSDialog.FindNextFocusableSiblingElement = findNextFocusableSiblingElement;\nJSDialog.IsFocusable = isFocusable;\nJSDialog.IsTextInputField = isTextInputField;\n"]}