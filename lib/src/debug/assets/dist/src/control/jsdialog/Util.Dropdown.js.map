{"version":3,"file":"Util.Dropdown.js","sourceRoot":"","sources":["../../../../../../../../../../../TanhX/online/browser/src/control/jsdialog/Util.Dropdown.js"],"names":[],"mappings":"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","sourcesContent":["/* -*- js-indent-level: 8 -*- */\n/*\n * Copyright the Collabora Online contributors.\n *\n * SPDX-License-Identifier: MPL-2.0\n *\n * This Source Code Form is subject to the terms of the Mozilla Public\n * License, v. 2.0. If a copy of the MPL was not distributed with this\n * file, You can obtain one at http://mozilla.org/MPL/2.0/.\n */\n\n/*\n * Util.Dropdown - helper to create dropdown menus for JSDialogs\n */\n\n/* global JSDialog app */\n\nfunction _createDropdownId(id) {\n\treturn id + '-dropdown';\n}\n\nJSDialog.OpenDropdown = function (id, popupParent, entries, innerCallback, popupAnchor, isSubmenu) {\n\tvar dropdownWindowId = _createDropdownId(id);\n\tvar json = {\n\t\tid: dropdownWindowId,\n\t\ttype: 'dropdown',\n\t\tisSubmenu: isSubmenu,\n\t\tjsontype: 'dialog',\n\t\tpopupParent: popupParent,\n\t\tpopupAnchor: popupAnchor,\n\t\tgridKeyboardNavigation: false,\n\t\tcancellable: true,\n\t\tchildren: [\n\t\t\t{\n\t\t\t\tid: id + '-entries',\n\t\t\t\ttype: 'grid',\n\t\t\t\tcols: 1,\n\t\t\t\trows: entries.length,\n\t\t\t\tchildren: []\n\t\t\t}\n\t\t]\n\t};\n\n\tif (popupParent && !popupParent._onClose) {\n\t\tpopupParent._onClose = () => {\n\t\t\tpopupParent.setAttribute('aria-expanded', false);\n\t\t};\n\t}\n\tpopupParent.setAttribute('aria-expanded', true);\n\n\tvar isChecked = function (unoCommand) {\n\t\tvar items = L.Map.THIS['stateChangeHandler'];\n\t\tvar val = items.getItemValue(unoCommand);\n\n\t\tif (val && (val === true || val === 'true'))\n\t\t\treturn true;\n\t\telse\n\t\t\treturn false;\n\t};\n\n\tfor (var i in entries) {\n\t\tvar checkedValue = (entries[i].checked === undefined)\n\t\t\t? undefined : (entries[i].uno && isChecked('.uno' + entries[i].uno));\n\n\t\tvar entry;\n\n\t\tswitch (entries[i].type) {\n\t\t\tcase 'html':\n\t\t\t\tentry = {\n\t\t\t\t\tid: id + '-entry-' + i,\n\t\t\t\t\ttype: 'htmlcontent',\n\t\t\t\t\thtmlId: entries[i].htmlId,\n\t\t\t\t\tcloseCallback: function () { JSDialog.CloseDropdown(id); }\n\t\t\t\t};\n\t\t\t\tjson.gridKeyboardNavigation = true;\n\t\t\tbreak;\n\n\t\t\tcase 'colorpicker':\n\t\t\t\tentry = entries[i];\n\t\t\t\t// for color picker we have a \"KeyboardGridNavigation\" function defined separately to handle custom cases\n\t\t\t\tjson.gridKeyboardNavigation = true;\n\t\t\tbreak;\n\n\t\t\tcase 'action':\n\t\t\tcase 'menu':\n\t\t\tdefault:\n\t\t\t\tentry = {\n\t\t\t\t\tid: id + '-entry-' + i,\n\t\t\t\t\ttype: 'comboboxentry',\n\t\t\t\t\tcustomRenderer: entries[i].customRenderer,\n\t\t\t\t\tcomboboxId: id,\n\t\t\t\t\tpos: i,\n\t\t\t\t\ttext: entries[i].text,\n\t\t\t\t\thint: entries[i].hint,\n\t\t\t\t\tw2icon: entries[i].icon, // FIXME: DEPRECATED\n\t\t\t\t\ticon: entries[i].img,\n\t\t\t\t\tchecked: entries[i].checked || checkedValue,\n\t\t\t\t\tselected: entries[i].selected,\n\t\t\t\t\thasSubMenu: !!entries[i].items\n\t\t\t\t};\n\t\t\tbreak;\n\n\t\t\tcase 'separator':\n\t\t\t\tentry = {\n\t\t\t\t\tid: id + '-entry-' + i,\n\t\t\t\t\ttype: 'separator',\n\t\t\t\t\torientation: 'horizontal'\n\t\t\t\t};\n\t\t\tbreak;\n\t\t}\n\n\t\tjson.children[0].children.push(entry);\n\t}\n\n\tvar lastSubMenuOpened = null;\n\tvar generateCallback = function (targetEntries) {\n\t\treturn function(objectType, eventType, object, data) {\n\t\t\tvar pos = data ? parseInt(data.substr(0, data.indexOf(';'))) : null;\n\t\t\tvar entry = targetEntries && pos !== null ? targetEntries[pos] : null;\n\n\t\t\tif (eventType === 'selected' || eventType === 'showsubmenu') {\n\t\t\t\tif (entry.items) {\n\t\t\t\t\tif (lastSubMenuOpened) {\n\t\t\t\t\t\tvar submenu = JSDialog.GetDropdown(lastSubMenuOpened);\n\t\t\t\t\t\tif (submenu) {\n\t\t\t\t\t\t\tJSDialog.CloseDropdown(lastSubMenuOpened);\n\t\t\t\t\t\t\tlastSubMenuOpened = null;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\t// open submenu\n\t\t\t\t\tvar dropdown = JSDialog.GetDropdown(object.id);\n\t\t\t\t\tvar subMenuId = object.id + '-' + pos;\n\t\t\t\t\tvar targetEntry = dropdown.querySelectorAll('.ui-grid-cell')[pos + 1];\n\t\t\t\t\tJSDialog.OpenDropdown(subMenuId, targetEntry, entry.items,\n\t\t\t\t\t\tgenerateCallback(entry.items), 'top-end', true);\n\t\t\t\t\tlastSubMenuOpened = subMenuId;\n\n\t\t\t\t\tapp.layoutingService.appendLayoutingTask(() => {\n\t\t\t\t\t\tvar dropdown = JSDialog.GetDropdown(subMenuId);\n\t\t\t\t\t\tif (!dropdown) {\n\t\t\t\t\t\t\tconsole.debug('Dropdown: missing :' + subMenuId);\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tvar container = dropdown.querySelector('.ui-grid');\n\t\t\t\t\t\tJSDialog.MakeFocusCycle(container);\n\t\t\t\t\t\tvar focusables = JSDialog.GetFocusableElements(container);\n\t\t\t\t\t\tif (focusables && focusables.length)\n\t\t\t\t\t\t\tfocusables[0].focus();\n\t\t\t\t\t});\n\t\t\t\t} else if (eventType === 'selected' && entry.uno) {\n\t\t\t\t\tvar uno = (entry.uno.indexOf('.uno:') === 0) ? entry.uno : '.uno:' + entry.uno;\n\t\t\t\t\tL.Map.THIS.sendUnoCommand(uno);\n\t\t\t\t\tJSDialog.CloseDropdown(id);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t} else if (!lastSubMenuOpened && eventType === 'hidedropdown') {\n\t\t\t\tJSDialog.CloseDropdown(id);\n\t\t\t}\n\n\t\t\t// for multi-level menus last parameter should be used to handle event (it contains selected entry)\n\t\t\tif (innerCallback && innerCallback(objectType, eventType, object, data, entry))\n\t\t\t\treturn;\n\n\t\t\tif (eventType === 'selected')\n\t\t\t\tJSDialog.CloseDropdown(id);\n\t\t};\n\t};\n\tL.Map.THIS.fire('closepopups'); // close popups if a dropdown menu is opened\n\tL.Map.THIS.fire('jsdialog', {data: json, callback: generateCallback(entries)});\n};\n\nJSDialog.CloseDropdown = function (id) {\n\tL.Map.THIS.fire('jsdialog', {data: {\n\t\tid: _createDropdownId(id),\n\t\tjsontype: 'dialog',\n\t\taction: 'close'\n\t}});\n};\n\nJSDialog.CloseAllDropdowns = function () {\n\tL.Map.THIS.jsdialog.closeAllDropdowns();\n};\n\nJSDialog.GetDropdown = function (id) {\n\treturn document.body.querySelector('#' + _createDropdownId(id));\n};\n"]}