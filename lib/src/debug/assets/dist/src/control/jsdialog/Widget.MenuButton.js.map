{"version":3,"file":"Widget.MenuButton.js","sourceRoot":"","sources":["../../../../../../../../../../../TanhX/online/browser/src/control/jsdialog/Widget.MenuButton.js"],"names":[],"mappings":"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","sourcesContent":["/* -*- js-indent-level: 8 -*- */\n/*\n * Copyright the Collabora Online contributors.\n *\n * SPDX-License-Identifier: MPL-2.0\n *\n * This Source Code Form is subject to the terms of the Mozilla Public\n * License, v. 2.0. If a copy of the MPL was not distributed with this\n * file, You can obtain one at http://mozilla.org/MPL/2.0/.\n */\n\n/*\n * JSDialog.MenuButton - button which can trigger some action or open a menu\n *\n * Example JSON:\n * {\n *     id: 'id:MenuId', (where MenuId is custom menu id, menu is stored in the builder)\n *     type: 'menubutton',\n *     text: 'Label',\n *     image: 'base64 encoded icon',\n *     command: '.uno:Command',\n *     enabled: false\n * }\n */\n\n/* global JSDialog $ app */\n\nfunction _menubuttonControl (parentContainer, data, builder) {\n\tvar ids;\n\tvar menuId = null;\n\n\tif (data.id.includes(':')) {\n\t\tids = data.id.split(':');\n\t\tmenuId = ids[1];\n\t\tdata.id = ids[0];\n\t}\n\telse if (data.id.includes('-')) {\n\t\tids = data.id.split('-');\n\t\tmenuId = ids[1];\n\t\tdata.id = ids[0];\n\t}\n\telse\n\t\tmenuId = data.id;\n\n\t// import menu\n\tif (data.menu) {\n\t\t// command is needed to generate image\n\t\tif (!data.command)\n\t\t\tdata.command = data.id;\n\n\t\tmenuId = data.id + '-menu';\n\t\tvar builtMenu = [];\n\t\tfor (var i in data.menu)\n\t\t\tbuiltMenu.push(data.menu[i]);\n\t\tbuilder._menus.set(menuId, builtMenu);\n\t}\n\n\tvar menuEntries = menuId ? builder._menus.get(menuId) : null;\n\n\tif (menuEntries) {\n\t\tvar noLabels = builder.options.noLabelsForUnoButtons;\n\t\tbuilder.options.noLabelsForUnoButtons = data.noLabel ? data.noLabel : false;\n\n\t\t// command is needed to generate image\n\t\tif (!data.command)\n\t\t\tdata.command = menuId;\n\n\t\tvar options = {hasDropdownArrow: menuEntries.length > 1};\n\t\tvar control = builder._unoToolButton(parentContainer, data, builder, options);\n\n\t\t$(control.container).addClass('menubutton');\n\t\tcontrol.container.setAttribute('aria-haspopup', true);\n\n\t\t$(control.button).unbind('click');\n\t\t$(control.label).unbind('click');\n\n\t\tvar dropdownId = data.id;\n\t\tvar clickFunction = function () {\n\t\t\tif (control.container.hasAttribute('disabled'))\n\t\t\t\treturn;\n\n\t\t\tvar callback = function(objectType, eventType, object, data, entry) {\n\t\t\t\tif ((eventType === 'selected' && entry.items) || eventType === 'showsubmenu') {\n\t\t\t\t\treturn true;\n\t\t\t\t} else if (eventType === 'selected' && entry.uno) {\n\t\t\t\t\tvar uno = (entry.uno.indexOf('.uno:') === 0) ? entry.uno : '.uno:' + entry.uno;\n\t\t\t\t\tbuilder.map.sendUnoCommand(uno);\n\t\t\t\t\tJSDialog.CloseDropdown(dropdownId);\n\t\t\t\t\treturn true;\n\t\t\t\t} else if (eventType === 'selected' && entry.action) {\n\t\t\t\t\tapp.dispatcher.dispatch(entry.action);\n\t\t\t\t\tJSDialog.CloseDropdown(dropdownId);\n\t\t\t\t\treturn true;\n\t\t\t\t} else if (eventType === 'selected') {\n\t\t\t\t\tbuilder.callback('menubutton', 'select', control.container, entry.id, builder);\n\t\t\t\t\tJSDialog.CloseDropdown(dropdownId);\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\n\t\t\t\treturn false;\n\t\t\t};\n\n\t\t\tvar freshMenu = builder._menus.get(menuId); // refetch to apply dynamic changes\n\t\t\tif (freshMenu.length && freshMenu[0].type === 'colorpicker') {\n\t\t\t\t// make copy and fill with information to identify color command\n\t\t\t\tfreshMenu = JSON.parse(JSON.stringify(freshMenu));\n\t\t\t\tfreshMenu[0].command = data.command;\n\t\t\t\tfreshMenu[0].id = data.id;\n\t\t\t}\n\n\t\t\tif (freshMenu.length === 1) {\n\t\t\t\tcallback(null, 'selected', null, null, freshMenu[0]);\n\t\t\t} else {\n\t\t\t\tJSDialog.OpenDropdown(dropdownId, control.container, freshMenu, callback);\n\t\t\t}\n\t\t};\n\n\t\tvar isSplitButton = data.applyCallback;\n\n\t\t// make it possible to setup separate callbacks for split button\n\t\tif (isSplitButton) {\n\t\t\tJSDialog.AddOnClick(control.button, data.applyCallback);\n\t\t\tif (control.label)\n\t\t\t\tJSDialog.AddOnClick(control.label, data.applyCallback);\n\t\t\tif (control.arrow)\n\t\t\t\tcontrol.arrow.tabIndex = 0;\n\t\t} else {\n\t\t\tJSDialog.AddOnClick(control.button, clickFunction);\n\t\t\tif (control.label)\n\t\t\t\tJSDialog.AddOnClick(control.label, clickFunction);\n\t\t}\n\n\t\tif (control.arrow)\n\t\t\tJSDialog.AddOnClick(control.arrow, clickFunction);\n\n\t\tbuilder._preventDocumentLosingFocusOnClick(control.container);\n\n\t\tbuilder.options.noLabelsForUnoButtons = noLabels;\n\n\t\treturn control;\n\t} else if (data.text !== undefined || data.image) {\n\t\tvar button = L.DomUtil.create('button', 'menubutton ' + builder.options.cssClass, parentContainer);\n\t\tbutton.id = data.id;\n\t\tbutton.title = data.text;\n\t\tbutton.setAttribute('aria-haspopup', true);\n\t\tif (data.image) {\n\t\t\tvar image = L.DomUtil.create('img', '', button);\n\t\t\timage.src = data.image;\n\t\t\timage.setAttribute('alt', '');\n\t\t}\n\t\tvar label = L.DomUtil.create('span', '', button);\n\t\tlabel.innerText = data.text ? data.text : '';\n\t\tL.DomUtil.create('i', 'arrow', button);\n\n\t\t$(button).click(function () {\n\t\t\tif (!button.hasAttribute('disabled')) {\n\t\t\t\tbuilder.callback('menubutton', 'toggle', button, undefined, builder);\n\t\t\t}\n\t\t});\n\n\t\tvar enabled = Boolean(data.enabled);\n\t\tbutton.setAttribute('aria-disabled', !enabled);\n\n\t\tif (data.enabled === false)\n\t\t\tbutton.disabled = true;\n\t} else {\n\t\twindow.app.console.warn('Not found menu \"' + menuId + '\"');\n\t}\n\n\treturn false;\n}\n\nJSDialog.menubuttonControl = function (parentContainer, data, builder) {\n\tvar buildInnerData = _menubuttonControl(parentContainer, data, builder);\n\treturn buildInnerData;\n};\n"]}