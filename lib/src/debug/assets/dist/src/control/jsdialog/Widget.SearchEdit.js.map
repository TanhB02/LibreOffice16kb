{"version":3,"file":"Widget.SearchEdit.js","sourceRoot":"","sources":["../../../../../../../../../../../TanhX/online/browser/src/control/jsdialog/Widget.SearchEdit.ts"],"names":[],"mappings":"AAAA,gCAAgC;AAChC;;;;;;;;GAQG;;;;;;;;;;;;;;;;AAkBH;IAA+B,oCAAU;IACxC,0BACC,eAA4B,EAC5B,IAAoB,EACpB,OAAkB,EAClB,QAA0B;eAE1B,kBAAM,eAAe,EAAE,IAAI,EAAE,OAAO,EAAE,QAAQ,CAAC;IAChD,CAAC;IAEO,wCAAa,GAArB;QACC,IAAI,CAAC,mBAAmB,EAAE,CAAC;QAC3B,IAAI,CAAC,CAAC,GAAG,CAAC,IAAI,CAAC,UAAU,EAAE,KAAK,MAAM,EAAE;YACvC,yCAAyC;YACzC,GAAG,CAAC,aAAa,CAAC,MAAM,CACvB,IAAI,CAAC,IAAI,CAAC,KAAK,CAAC,KAAK,EACrB,KAAK,EACL,EAAE,EACF,CAAC,EACD,IAAI,CAAC,mBAAmB,CACxB,CAAC;SACF;IACF,CAAC;IAEO,0CAAe,GAAvB,UAAwB,CAAgB;QACvC,IAAI,KAAK,GAAG,IAAI,CAAC,IAAI,CAAC,KAAK,CAAC;QAC5B,IACC,CAAC,CAAC,CAAC,OAAO,KAAK,EAAE,IAAI,CAAC,CAAC,OAAO,CAAC;YAC/B,CAAC,CAAC,OAAO,KAAK,GAAG;YACjB,CAAC,CAAC,OAAO,KAAK,EAAE,EACf;YACD,IAAI,CAAC,CAAC,QAAQ,EAAE;gBACf,GAAG,CAAC,aAAa,CAAC,MAAM,CAAC,KAAK,CAAC,KAAK,EAAE,IAAI,CAAC,CAAC;aAC5C;iBAAM;gBACN,GAAG,CAAC,aAAa,CAAC,MAAM,CAAC,KAAK,CAAC,KAAK,CAAC,CAAC;aACtC;YACD,CAAC,CAAC,cAAc,EAAE,CAAC;SACnB;aAAM,IAAI,CAAC,CAAC,OAAO,IAAI,CAAC,CAAC,OAAO,KAAK,EAAE,EAAE;YACzC,KAAK,CAAC,KAAK,EAAE,CAAC;YACd,KAAK,CAAC,MAAM,EAAE,CAAC;YACf,CAAC,CAAC,cAAc,EAAE,CAAC;SACnB;aAAM,IAAI,CAAC,CAAC,OAAO,KAAK,EAAE,EAAE;YAC5B,CAAC,CAAC,GAAG,CAAC,IAAI,CAAC,YAAY,EAAE,CAAC;SAC1B;IACF,CAAC;IAEO,wCAAa,GAArB;QACC,CAAC,CAAC,GAAG,CAAC,IAAI,CAAC,IAAI,CAAC,aAAa,CAAC,CAAC;QAC/B,IAAI,CAAC,mBAAmB,EAAE,CAAC;IAC5B,CAAC;IAEO,uCAAY,GAApB;QACC,CAAC,CAAC,GAAG,CAAC,IAAI,CAAC,WAAW,EAAE,CAAC;IAC1B,CAAC;IAEO,8CAAmB,GAA3B;QACC,IAAI,OAAO,GAAI,MAAc,CAAC,IAAI,CAAC,QAAQ,EAAE;YAC5C,CAAC,CAAC,GAAG,CAAC,GAAG,CAAC,eAAe;YACzB,CAAC,CAAC,GAAG,CAAC,GAAG,CAAC,SAAS,CAAC;QACrB,IAAI,CAAC,OAAO,EAAE;YACb,OAAO,CAAC,KAAK,CAAC,wBAAwB,CAAC,CAAC;YACxC,OAAO;SACP;QAED,mEAAmE;QACnE,IAAI,IAAI,CAAC,IAAI,CAAC,KAAK,CAAC,KAAK,KAAK,EAAE,EAAE;YACjC,OAAO,CAAC,UAAU,CAAC,YAAY,EAAE,KAAK,CAAC,CAAC;YACxC,OAAO,CAAC,UAAU,CAAC,YAAY,EAAE,KAAK,CAAC,CAAC;YACxC,OAAO,CAAC,QAAQ,CAAC,cAAc,EAAE,KAAK,CAAC,CAAC;SACxC;aAAM;YACN,OAAO,CAAC,UAAU,CAAC,YAAY,EAAE,IAAI,CAAC,CAAC;YACvC,OAAO,CAAC,UAAU,CAAC,YAAY,EAAE,IAAI,CAAC,CAAC;YACvC,OAAO,CAAC,QAAQ,CAAC,cAAc,EAAE,IAAI,CAAC,CAAC;SACvC;IACF,CAAC;IAES,8CAAmB,GAA7B;QACC,iBAAM,mBAAmB,WAAE,CAAC;QAE5B,IAAI,CAAC,IAAI,CAAC,KAAK,CAAC,gBAAgB,CAAC,OAAO,EAAE,IAAI,CAAC,aAAa,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC;QACzE,IAAI,CAAC,IAAI,CAAC,KAAK,CAAC,gBAAgB,CAC/B,SAAS,EACT,IAAI,CAAC,eAAe,CAAC,IAAI,CAAC,IAAI,CAAC,CAC/B,CAAC;QACF,IAAI,CAAC,IAAI,CAAC,KAAK,CAAC,gBAAgB,CAAC,OAAO,EAAE,IAAI,CAAC,aAAa,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC;QACzE,IAAI,CAAC,IAAI,CAAC,KAAK,CAAC,gBAAgB,CAAC,MAAM,EAAE,IAAI,CAAC,YAAY,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC;IACxE,CAAC;IACF,uBAAC;AAAD,CAAC,AAvFD,CAA+B,UAAU,GAuFxC;AAED,QAAQ,CAAC,UAAU,GAAG,UACrB,eAA4B,EAC5B,IAAoB,EACpB,OAAkB,EAClB,QAA0B;IAE1B,IAAM,MAAM,GAAG,IAAI,gBAAgB,CAAC,eAAe,EAAE,IAAI,EAAE,OAAO,EAAE,QAAQ,CAAC,CAAC;IAC9E,OAAO,MAAM,CAAC,KAAK,EAAE,CAAC;AACvB,CAAC,CAAC","sourcesContent":["/* -*- js-indent-level: 8 -*- */\n/*\n * Copyright the Collabora Online contributors.\n *\n * SPDX-License-Identifier: MPL-2.0\n *\n * This Source Code Form is subject to the terms of the Mozilla Public\n * License, v. 2.0. If a copy of the MPL was not distributed with this\n * file, You can obtain one at http://mozilla.org/MPL/2.0/.\n */\n\n/*\n * JSDialog.SearchEdit - single line input field for searching inside document\n *\n * Example JSON:\n * {\n *     id: 'id',\n *     type: 'searchedit',\n *     text: 'abc',\n *     placeholder: 'this is shown when empty',\n *     changedCallback: null\n * }\n */\n\ndeclare var L: any;\ndeclare var JSDialog: any;\n\nclass SearchEditWidget extends EditWidget {\n\tconstructor(\n\t\tparentContainer: HTMLElement,\n\t\tdata: EditWidgetJSON,\n\t\tbuilder: JSBuilder,\n\t\tcallback: JSDialogCallback,\n\t) {\n\t\tsuper(parentContainer, data, builder, callback);\n\t}\n\n\tprivate onSearchInput() {\n\t\tthis.updateSearchButtons();\n\t\tif (L.Map.THIS.getDocType() === 'text') {\n\t\t\t// perform the immediate search in Writer\n\t\t\tapp.searchService.search(\n\t\t\t\tthis.edit.input.value,\n\t\t\t\tfalse,\n\t\t\t\t'',\n\t\t\t\t0,\n\t\t\t\ttrue /* expand search */,\n\t\t\t);\n\t\t}\n\t}\n\n\tprivate onSearchKeyDown(e: KeyboardEvent) {\n\t\tvar entry = this.edit.input;\n\t\tif (\n\t\t\t(e.keyCode === 71 && e.ctrlKey) ||\n\t\t\te.keyCode === 114 ||\n\t\t\te.keyCode === 13\n\t\t) {\n\t\t\tif (e.shiftKey) {\n\t\t\t\tapp.searchService.search(entry.value, true);\n\t\t\t} else {\n\t\t\t\tapp.searchService.search(entry.value);\n\t\t\t}\n\t\t\te.preventDefault();\n\t\t} else if (e.ctrlKey && e.keyCode === 70) {\n\t\t\tentry.focus();\n\t\t\tentry.select();\n\t\t\te.preventDefault();\n\t\t} else if (e.keyCode === 27) {\n\t\t\tL.Map.THIS.cancelSearch();\n\t\t}\n\t}\n\n\tprivate onSearchFocus() {\n\t\tL.Map.THIS.fire('searchstart');\n\t\tthis.updateSearchButtons();\n\t}\n\n\tprivate onSearchBlur() {\n\t\tL.Map.THIS._onGotFocus();\n\t}\n\n\tprivate updateSearchButtons() {\n\t\tvar toolbar = (window as any).mode.isMobile()\n\t\t\t? app.map.mobileSearchBar\n\t\t\t: app.map.statusBar;\n\t\tif (!toolbar) {\n\t\t\tconsole.debug('Cannot find search bar');\n\t\t\treturn;\n\t\t}\n\n\t\t// conditionally disabling until, we find a solution for tdf#108577\n\t\tif (this.edit.input.value === '') {\n\t\t\ttoolbar.enableItem('searchprev', false);\n\t\t\ttoolbar.enableItem('searchnext', false);\n\t\t\ttoolbar.showItem('cancelsearch', false);\n\t\t} else {\n\t\t\ttoolbar.enableItem('searchprev', true);\n\t\t\ttoolbar.enableItem('searchnext', true);\n\t\t\ttoolbar.showItem('cancelsearch', true);\n\t\t}\n\t}\n\n\tprotected setupEventListeners() {\n\t\tsuper.setupEventListeners();\n\n\t\tthis.edit.input.addEventListener('input', this.onSearchInput.bind(this));\n\t\tthis.edit.input.addEventListener(\n\t\t\t'keydown',\n\t\t\tthis.onSearchKeyDown.bind(this),\n\t\t);\n\t\tthis.edit.input.addEventListener('focus', this.onSearchFocus.bind(this));\n\t\tthis.edit.input.addEventListener('blur', this.onSearchBlur.bind(this));\n\t}\n}\n\nJSDialog.searchEdit = function (\n\tparentContainer: HTMLElement,\n\tdata: EditWidgetJSON,\n\tbuilder: JSBuilder,\n\tcallback: JSDialogCallback,\n) {\n\tconst widget = new SearchEditWidget(parentContainer, data, builder, callback);\n\treturn widget.build();\n};\n"]}