{"version":3,"file":"Widget.IconView.js","sourceRoot":"","sources":["../../../../../../../../../../../TanhX/online/browser/src/control/jsdialog/Widget.IconView.ts"],"names":[],"mappings":"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","sourcesContent":["/* -*- js-indent-level: 8 -*- */\n/*\n * Copyright the Collabora Online contributors.\n *\n * SPDX-License-Identifier: MPL-2.0\n *\n * This Source Code Form is subject to the terms of the Mozilla Public\n * License, v. 2.0. If a copy of the MPL was not distributed with this\n * file, You can obtain one at http://mozilla.org/MPL/2.0/.\n */\n\n/*\n * JSDialog.IconView - icon view widget\n *\n * Example JSON:\n * {\n *     id: 'id',\n *     type: 'iconview',\n *     singleclickactivate: true,\n *     entries: [\n *         { text: 'some text', tooltip: 'some tooltip', image: 'encoded png', selected: false }\n *     ]\n * }\n */\n\ndeclare var JSDialog: any;\n\nfunction _createEntryImage(\n\tparent: HTMLElement,\n\tbuilder: JSBuilder,\n\tentryData: IconViewEntry,\n\timage: string,\n) {\n\tconst img = L.DomUtil.create('img', builder.options.cssClass, parent);\n\tif (image) img.src = image;\n\n\tif (entryData.text) {\n\t\timg.alt = entryData.text;\n\t} else if (entryData.tooltip) {\n\t\timg.alt = entryData.tooltip;\n\t} else {\n\t\timg.alt = '';\n\t}\n\n\tif (entryData.tooltip) img.title = entryData.tooltip;\n\telse img.title = entryData.text;\n}\n\nfunction _createEntryText(parent: HTMLElement, entryData: IconViewEntry) {\n\t// Add text below Icon\n\tL.DomUtil.addClass(parent, 'icon-view-item-container');\n\tconst placeholder = L.DomUtil.create(\n\t\t'span',\n\t\t'ui-iconview-entry-title',\n\t\tparent,\n\t);\n\tplaceholder.innerText = entryData.text;\n}\n\nfunction _iconViewEntry(\n\tparentContainer: Element,\n\tparentData: IconViewJSON,\n\tentry: IconViewEntry,\n\tbuilder: JSBuilder,\n) {\n\tconst disabled = parentData.enabled === false;\n\tconst hasText = entry.text && parentData.textWithIconEnabled;\n\n\tif (entry.separator && entry.separator === true) {\n\t\tL.DomUtil.create(\n\t\t\t'hr',\n\t\t\tbuilder.options.cssClass + ' ui-iconview-separator',\n\t\t\tparentContainer,\n\t\t);\n\t\treturn;\n\t}\n\n\tconst entryContainer = L.DomUtil.create(\n\t\t'div',\n\t\tbuilder.options.cssClass + ' ui-iconview-entry',\n\t\tparentContainer,\n\t);\n\n\t//id is needed to find the element to regain focus after widget is updated. see updateWidget in Control.JSDialogBuilder.js\n\tentryContainer.id = parentData.id + '_' + entry.row;\n\n\t// By default `aria-presed` should be false\n\tentryContainer.setAttribute('aria-pressed', 'false');\n\n\tif (entry.selected && entry.selected === true) {\n\t\t$(entryContainer).addClass('selected');\n\t\tentryContainer.setAttribute('aria-pressed', 'true');\n\t}\n\n\tif (entry.ondemand) {\n\t\tconst placeholder = L.DomUtil.create(\n\t\t\t'span',\n\t\t\tbuilder.options.cssClass,\n\t\t\tentryContainer,\n\t\t);\n\t\tplaceholder.innerText = entry.text;\n\t\tif (entry.tooltip) placeholder.title = entry.tooltip;\n\t\telse placeholder.title = entry.text;\n\n\t\t// Add tabindex attribute for accessibility, enabling keyboard navigation in the icon preview\n\t\tentryContainer.setAttribute('tabindex', '0');\n\t\tJSDialog.OnDemandRenderer(\n\t\t\tbuilder,\n\t\t\tparentData.id,\n\t\t\t'iconview',\n\t\t\tentry.row,\n\t\t\tplaceholder,\n\t\t\tentryContainer,\n\t\t\tentry.text,\n\t\t);\n\t} else {\n\t\t_createEntryImage(entryContainer, builder, entry, entry.image);\n\t}\n\n\tif (hasText) _createEntryText(entryContainer, entry);\n\n\tif (!disabled) {\n\t\tconst singleClick = parentData.singleclickactivate === true;\n\t\t$(entryContainer).click(function () {\n\t\t\tentryContainer.setAttribute('tabindex', '0');\n\t\t\tentryContainer.focus();\n\t\t\t//avoid re-selecting already selected entry\n\t\t\tif ($(entryContainer).hasClass('selected')) return;\n\n\t\t\t$('#' + parentData.id + ' .ui-iconview-entry').removeClass('selected');\n\t\t\tbuilder.callback('iconview', 'select', parentData, entry.row, builder);\n\t\t\tif (singleClick) {\n\t\t\t\tbuilder.callback(\n\t\t\t\t\t'iconview',\n\t\t\t\t\t'activate',\n\t\t\t\t\tparentData,\n\t\t\t\t\tentry.row,\n\t\t\t\t\tbuilder,\n\t\t\t\t);\n\t\t\t}\n\t\t});\n\n\t\tentryContainer.addEventListener('contextmenu', function (e: Event) {\n\t\t\t$('#' + parentData.id + ' .ui-iconview-entry').removeClass('selected');\n\t\t\tbuilder.callback('iconview', 'select', parentData, entry.row, builder);\n\t\t\t$(entryContainer).addClass('selected');\n\t\t\tbuilder.callback(\n\t\t\t\t'iconview',\n\t\t\t\t'contextmenu',\n\t\t\t\tparentData,\n\t\t\t\tentry.row,\n\t\t\t\tbuilder,\n\t\t\t);\n\t\t\te.preventDefault();\n\t\t});\n\n\t\tif (!singleClick) {\n\t\t\t$(entryContainer).dblclick(function () {\n\t\t\t\tbuilder.callback(\n\t\t\t\t\t'iconview',\n\t\t\t\t\t'activate',\n\t\t\t\t\tparentData,\n\t\t\t\t\tentry.row,\n\t\t\t\t\tbuilder,\n\t\t\t\t);\n\t\t\t});\n\t\t}\n\t\tbuilder._preventDocumentLosingFocusOnClick(entryContainer);\n\t}\n}\n\nJSDialog.iconView = function (\n\tparentContainer: Element,\n\tdata: IconViewJSON,\n\tbuilder: JSBuilder,\n) {\n\tconst container = L.DomUtil.create(\n\t\t'div',\n\t\tbuilder.options.cssClass + ' ui-iconview',\n\t\tparentContainer,\n\t);\n\tcontainer.id = data.id;\n\n\tconst disabled = data.enabled === false;\n\tif (disabled) L.DomUtil.addClass(container, 'disabled');\n\n\tfor (const i in data.entries) {\n\t\t_iconViewEntry(container, data, data.entries[i], builder);\n\t}\n\n\tconst updateAllIndexes = () => {\n\t\t// Example: if gridTemplateColumns = \"96px 96px 96px\"\n\t\t// Step 1: Split the string by spaces:           [\"96px\", \"96px\", \"96px\"]\n\t\t// Step 2: Remove any empty entries (if any):    [\"96px\", \"96px\", \"96px\"]\n\t\t// Step 3: The length of this array is the number of columns in the grid.\n\t\tconst gridTemplateColumns = getComputedStyle(container).gridTemplateColumns;\n\t\tconst columns = gridTemplateColumns.split(' ').filter(Boolean).length;\n\n\t\tif (columns > 0) {\n\t\t\tconst entries = container.querySelectorAll('.ui-iconview-entry');\n\t\t\tentries.forEach((entry: HTMLElement, flatIndex: number) => {\n\t\t\t\tconst row = Math.floor(flatIndex / columns);\n\t\t\t\tconst column = flatIndex % columns;\n\t\t\t\tentry.setAttribute('index', row + ':' + column);\n\t\t\t});\n\t\t}\n\t};\n\n\t// update indexes on resize\n\tconst resizeObserver = new ResizeObserver(() => {\n\t\tupdateAllIndexes();\n\t});\n\tresizeObserver.observe(container);\n\n\tconst firstSelected = $(container).children('.selected').get(0);\n\tconst blockOption = JSDialog._scrollIntoViewBlockOption('nearest');\n\tif (firstSelected)\n\t\tfirstSelected.scrollIntoView({\n\t\t\tbehavior: 'smooth',\n\t\t\tblock: blockOption,\n\t\t\tinline: 'nearest',\n\t\t});\n\n\tcontainer.onSelect = (position: number) => {\n\t\t$(container).children('.selected').removeClass('selected');\n\n\t\tconst entry =\n\t\t\tcontainer.children.length > position\n\t\t\t\t? container.children[position]\n\t\t\t\t: null;\n\n\t\tif (entry) {\n\t\t\tL.DomUtil.addClass(entry, 'selected');\n\t\t\tconst blockOption = JSDialog._scrollIntoViewBlockOption('nearest');\n\t\t\tentry.scrollIntoView({\n\t\t\t\tbehavior: 'smooth',\n\t\t\t\tblock: blockOption,\n\t\t\t\tinline: 'nearest',\n\t\t\t});\n\t\t} else if (position != -1)\n\t\t\tconsole.warn(\n\t\t\t\t'not found entry: \"' + position + '\" in: \"' + container.id + '\"',\n\t\t\t);\n\t};\n\n\tcontainer.updateRenders = (pos: number) => {\n\t\tconst dropdown = container.querySelectorAll(\n\t\t\t'.ui-iconview-entry, .ui-iconview-separator',\n\t\t);\n\t\tif (dropdown[pos]) {\n\t\t\tlet container = dropdown[pos];\n\t\t\tconst entry = data.entries[pos];\n\t\t\tconst image = builder.rendersCache[data.id].images[pos];\n\t\t\tconst hasText = entry.text && data.textWithIconEnabled;\n\n\t\t\tcontainer.replaceChildren();\n\t\t\tif (hasText) {\n\t\t\t\tcontainer = L.DomUtil.create(\n\t\t\t\t\t'div',\n\t\t\t\t\tbuilder.options.cssClass,\n\t\t\t\t\tdropdown[pos],\n\t\t\t\t);\n\t\t\t}\n\n\t\t\t_createEntryImage(container, builder, entry, image);\n\t\t\tif (hasText) _createEntryText(container, entry);\n\t\t}\n\t};\n\n\tJSDialog.KeyboardGridNavigation(container);\n\tcontainer.addEventListener('keydown', function (e: KeyboardEvent) {\n\t\tif (e.key !== 'Enter' && e.key !== ' ' && e.code !== 'Space') return;\n\n\t\tconst active = document.activeElement as HTMLElement;\n\t\tif (!active || !active.classList.contains('ui-iconview-entry')) return;\n\n\t\tconst iconViewEntries = Array.from(\n\t\t\tcontainer.querySelectorAll('.ui-iconview-entry'),\n\t\t);\n\t\tconst selectedIndex = iconViewEntries.indexOf(active);\n\n\t\tif (selectedIndex === -1) return;\n\n\t\tif (e.key === ' ' || e.code === 'Space')\n\t\t\tbuilder.callback('iconview', 'select', data, selectedIndex, builder);\n\t\telse if (e.key === 'Enter')\n\t\t\tbuilder.callback('iconview', 'activate', data, selectedIndex, builder);\n\t});\n\n\treturn false;\n};\n"]}