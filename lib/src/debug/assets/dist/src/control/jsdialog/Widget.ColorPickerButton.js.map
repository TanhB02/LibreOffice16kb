{"version":3,"file":"Widget.ColorPickerButton.js","sourceRoot":"","sources":["../../../../../../../../../../../TanhX/online/browser/src/control/jsdialog/Widget.ColorPickerButton.js"],"names":[],"mappings":"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","sourcesContent":["/* -*- js-indent-level: 8 -*- */\n/*\n * Copyright the Collabora Online contributors.\n *\n * SPDX-License-Identifier: MPL-2.0\n *\n * This Source Code Form is subject to the terms of the Mozilla Public\n * License, v. 2.0. If a copy of the MPL was not distributed with this\n * file, You can obtain one at http://mozilla.org/MPL/2.0/.\n */\n\n/*\n * JSDialog.ColorPickerButton - split button with last color preview which opens color picker\n */\n\n/* global L app JSDialog */\n\nfunction parseHexColor(color) {\n\tif (color === 'transparent') return -1;\n\telse return parseInt('0x' + color);\n}\n\nfunction getDefaultColorForCommand(command) {\n\tif (command == '.uno:CharBackColor') return -1;\n\telse if (command == '.uno:BackgroundColor') return -1;\n\treturn 0;\n}\n\n/// returns string, if color is transparent we get -1\nfunction toHexColor(colorInt) {\n\tvar colorInt = parseInt(colorInt);\n\tif (colorInt < 0) return '' + colorInt;\n\n\tvar colorHex = colorInt.toString(16);\n\n\twhile (colorHex != '#' && colorHex.length < 6) colorHex = '0' + colorHex;\n\n\tif (colorHex[0] != '#') colorHex = '#' + colorHex;\n\n\treturn colorHex;\n}\n\nJSDialog.getCurrentColor = function (data, builder) {\n\tvar selectedColor = builder.map['stateChangeHandler'].getItemValue(\n\t\tdata.command,\n\t);\n\n\tif (!selectedColor || selectedColor < 0)\n\t\tselectedColor = builder._getUnoStateForItemId(data.id, builder);\n\n\tif (!selectedColor || selectedColor < 0)\n\t\tselectedColor = getDefaultColorForCommand(data.command);\n\n\treturn toHexColor(parseInt(selectedColor));\n};\n\nJSDialog.sendColorCommand = function (builder, data, color, themeData) {\n\tvar gradientItem;\n\n\t// complex color properties\n\n\tif (data.id === 'fillgrad1') {\n\t\tgradientItem =\n\t\t\tbuilder.map['stateChangeHandler'].getItemValue('.uno:FillGradient');\n\t\tgradientItem.startcolor = color;\n\t\tbuilder.map.sendUnoCommand(\n\t\t\t'.uno:FillGradient?FillGradientJSON:string=' +\n\t\t\t\tJSON.stringify(gradientItem),\n\t\t);\n\t\treturn;\n\t} else if (data.id === 'fillgrad2') {\n\t\tgradientItem =\n\t\t\tbuilder.map['stateChangeHandler'].getItemValue('.uno:FillGradient');\n\t\tgradientItem.endcolor = color;\n\t\tbuilder.map.sendUnoCommand(\n\t\t\t'.uno:FillGradient?FillGradientJSON:string=' +\n\t\t\t\tJSON.stringify(gradientItem),\n\t\t);\n\t\treturn;\n\t} else if (data.id === 'fillattr2') {\n\t\tgradientItem = builder.map['stateChangeHandler'].getItemValue(\n\t\t\t'.uno:FillPageGradient',\n\t\t);\n\t\tgradientItem.startcolor = color;\n\t\tbuilder.map.sendUnoCommand(\n\t\t\t'.uno:FillPageGradient?FillPageGradientJSON:string=' +\n\t\t\t\tJSON.stringify(gradientItem),\n\t\t);\n\t\treturn;\n\t} else if (data.id === 'fillattr3') {\n\t\tgradientItem = builder.map['stateChangeHandler'].getItemValue(\n\t\t\t'.uno:FillPageGradient',\n\t\t);\n\t\tgradientItem.endcolor = color;\n\t\tbuilder.map.sendUnoCommand(\n\t\t\t'.uno:FillPageGradient?FillPageGradientJSON:string=' +\n\t\t\t\tJSON.stringify(gradientItem),\n\t\t);\n\t\treturn;\n\t}\n\n\t// simple numeric color values\n\n\tif (data.id === 'fillattr') {\n\t\tdata.command = '.uno:FillPageColor';\n\t} else if (data.id === 'LB_GLOW_COLOR') {\n\t\tdata.id = 'GlowColor';\n\t} else if (data.id === 'LB_SHADOW_COLOR') {\n\t\tdata.command = '.uno:FillShadowColor';\n\t}\n\n\tvar params = {};\n\tvar colorParameterID = data.command.replace('.uno:', '') + '.Color';\n\tvar themeParameterID =\n\t\tdata.command.replace('.uno:', '') + '.ComplexColorJSON';\n\n\tvar parsed = parseHexColor(color);\n\n\tparams[colorParameterID] = {\n\t\ttype: 'long',\n\t\tvalue: parsed ? parsed : parseInt(color),\n\t};\n\n\tif (themeData != null) {\n\t\tparams[themeParameterID] = {\n\t\t\ttype: 'string',\n\t\t\tvalue: themeData,\n\t\t};\n\t}\n\n\tbuilder.map['stateChangeHandler'].setItemValue(\n\t\tdata.command,\n\t\tparams[colorParameterID].value,\n\t);\n\tbuilder.map.sendUnoCommand(data.command, params);\n\tapp.colorLastSelection[data.command] = color;\n};\n\nJSDialog.colorPickerButton = function (parentContainer, data, builder) {\n\tvar commandOverride =\n\t\tdata.command === '.uno:Color' && builder.map.getDocType() === 'text';\n\tif (commandOverride) data.command = '.uno:FontColor';\n\n\tvar titleOverride = builder._getTitleForControlWithId(data.id);\n\tif (titleOverride) data.text = titleOverride;\n\n\tdata.id = data.id\n\t\t? data.id\n\t\t: data.command\n\t\t\t? data.command.replace('.uno:', '')\n\t\t\t: undefined;\n\tdata.text = builder._cleanText(data.text);\n\n\tif (data.command) {\n\t\tvar applyFunction = function (event) {\n\t\t\tevent.preventDefault();\n\t\t\tevent.stopPropagation();\n\n\t\t\tvar colorToApply = app.colorLastSelection[data.command];\n\t\t\tif (!colorToApply || colorToApply === '#') return;\n\n\t\t\tvar color =\n\t\t\t\tcolorToApply.indexOf('#') === 0 ? colorToApply.substr(1) : colorToApply;\n\n\t\t\tJSDialog.sendColorCommand(builder, data, color);\n\t\t};\n\n\t\t// add menu id for dropdown\n\t\tif (data.id.indexOf(':ColorPickerMenu') === -1)\n\t\t\tdata.id = data.id + ':ColorPickerMenu';\n\t\tdata.noLabel = true;\n\n\t\t// make it a split button\n\t\tdata.applyCallback = applyFunction;\n\n\t\tvar menubutton = builder._controlHandlers['menubutton'](\n\t\t\tparentContainer,\n\t\t\tdata,\n\t\t\tbuilder,\n\t\t);\n\n\t\tif (typeof menubutton === 'object') {\n\t\t\tL.DomUtil.addClass(\n\t\t\t\tmenubutton.container,\n\t\t\t\tdata.class ? data.class + ' has-colorpicker' : 'has-colorpicker',\n\t\t\t);\n\n\t\t\tvar valueNode = L.DomUtil.create(\n\t\t\t\t'span',\n\t\t\t\t'selected-color',\n\t\t\t\tmenubutton.button,\n\t\t\t);\n\t\t\tvalueNode.addEventListener('click', applyFunction);\n\n\t\t\tvar updateFunction = function () {\n\t\t\t\tif (app.colorLastSelection[data.command] !== undefined) {\n\t\t\t\t\tvar selectedColor = app.colorLastSelection[data.command];\n\t\t\t\t} else {\n\t\t\t\t\tselectedColor = JSDialog.getCurrentColor(data, builder);\n\t\t\t\t\tapp.colorLastSelection[data.command] = selectedColor;\n\t\t\t\t}\n\n\t\t\t\tif (parseInt(selectedColor) === -1) selectedColor = 'transparent';\n\n\t\t\t\tvalueNode.style.backgroundColor =\n\t\t\t\t\tselectedColor[0] !== '#' && selectedColor !== 'transparent'\n\t\t\t\t\t\t? '#' + selectedColor\n\t\t\t\t\t\t: selectedColor;\n\n\t\t\t\t// Make sure the border around the color indicator is not too bright\n\t\t\t\t// when the color is black so to avoid weird contrast artifacts\n\t\t\t\tif (\n\t\t\t\t\tvalueNode.style.backgroundColor == '#000000' ||\n\t\t\t\t\tvalueNode.style.backgroundColor == 'rgb(0, 0, 0)'\n\t\t\t\t) {\n\t\t\t\t\tvalueNode.style.borderColor = '#6a6a6a';\n\t\t\t\t} else {\n\t\t\t\t\tvalueNode.style.borderColor = 'var(--color-border)';\n\t\t\t\t}\n\t\t\t};\n\n\t\t\tbuilder.map.on(\n\t\t\t\t'commandstatechanged',\n\t\t\t\tfunction (e) {\n\t\t\t\t\tif (e.commandName === data.command) updateFunction();\n\t\t\t\t},\n\t\t\t\tthis,\n\t\t\t);\n\n\t\t\tupdateFunction();\n\t\t}\n\t}\n\n\treturn false;\n};\n"]}