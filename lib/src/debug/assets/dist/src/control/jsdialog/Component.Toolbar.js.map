{"version":3,"file":"Component.Toolbar.js","sourceRoot":"","sources":["../../../../../../../../../../../TanhX/online/browser/src/control/jsdialog/Component.Toolbar.ts"],"names":[],"mappings":"AAAA,oBAAoB;AACpB,gCAAgC;AAChC;;;;;;;;GAQG;AAUH;IASC,iBAAY,GAAQ,EAAE,gBAAwB;QAC7C,IAAI,CAAC,GAAG,GAAG,GAAG,CAAC;QACf,IAAI,CAAC,OAAO,GAAG,GAAG,CAAC,UAAU,EAAE,CAAC;QAChC,IAAI,CAAC,WAAW,GAAG,EAAE,CAAC;QACtB,IAAI,CAAC,gBAAgB,GAAG,gBAAgB,CAAC;QAEzC,IAAI,CAAC,OAAO,GAAG,IAAI,CAAC,CAAC,OAAO,CAAC,eAAe,CAAC;YAC5C,YAAY,EAAE,IAAI;YAClB,GAAG,EAAE,IAAI,CAAC,GAAG;YACb,QAAQ,EAAE,UAAU;YACpB,qBAAqB,EAAE,IAAI;YAC3B,QAAQ,EAAE,IAAI,CAAC,QAAQ,CAAC,CAAC,CAAC,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,SAAS;SAC9D,CAAC,CAAC;QAEH,IAAI,CAAC,KAAK,EAAE,CAAC;QACb,IAAI,CAAC,MAAM,EAAE,CAAC;QACd,IAAI,CAAC,0BAA0B,CAAC,EAAE,CAAC,CAAC;IACrC,CAAC;IAED,8BAAY,GAAZ;QACC,OAAO,EAAE,CAAC;IACX,CAAC;IAED,uBAAK,GAAL;QACC,IAAI,CAAC,eAAe,GAAG,CAAC,CAAC,OAAO,CAAC,GAAG,CAAC,IAAI,CAAC,gBAAgB,CAAC,CAAC;QAE5D,8BAA8B;QAC9B,IAAI,IAAI,CAAC,eAAe;YAAE,IAAI,CAAC,eAAe,CAAC,eAAe,EAAE,CAAC;QAEjE,CAAC,CAAC,OAAO,CAAC,QAAQ,CAAC,IAAI,CAAC,eAAe,EAAE,YAAY,CAAC,CAAC;IACxD,CAAC;IAED,wBAAM,GAAN;QACC,IAAI,CAAC,KAAK,EAAE,CAAC;QAEb,IAAI,KAAK,GAAG,IAAI,CAAC,YAAY,EAAE,CAAC;QAChC,IAAI,CAAC,OAAO,CAAC,KAAK,CAAC,IAAI,CAAC,eAAe,EAAE,KAAK,EAAE,SAAS,CAAC,CAAC;QAE3D,QAAQ,CAAC,cAAc,CACtB,IAAI,CAAC,eAAe,EACpB,IAAI,CAAC,eAAe,CAAC,aAAa,CAAC,KAAK,CAAC,CACzC,CAAC;QACF,QAAQ,CAAC,kBAAkB,EAAE,CAAC;QAE9B,IAAI,IAAI,CAAC,GAAG,CAAC,gBAAgB,EAAE,EAAE;YAChC,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,KAAK,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE;gBACtC,IAAI,EAAE,GAAG,KAAK,CAAC,CAAC,CAAC,CAAC;gBAClB,IAAI,IAAI,GAAG,CAAC,CAAC,GAAG,GAAG,EAAE,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC;gBAC7B,IAAI,CAAC,GAAG,CAAC,mBAAmB,CAAC,EAAE,EAAE,IAAI,EAAE,IAAI,CAAC,CAAC;aAC7C;SACD;QAED,IAAI,IAAI,CAAC,GAAG,CAAC,YAAY,EAAE,EAAE;YAC5B,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,KAAK,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE;gBACtC,IAAI,EAAE,GAAG,KAAK,CAAC,CAAC,CAAC,CAAC;gBAClB,IAAI,IAAI,GAAG,CAAC,CAAC,GAAG,GAAG,EAAE,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC;gBAC7B,IAAI,CAAC,GAAG,CAAC,iBAAiB,CAAC,EAAE,EAAE,IAAI,EAAE,IAAI,CAAC,CAAC;aAC3C;SACD;IACF,CAAC;IAED,yBAAO,GAAP,UAAQ,EAAU;QACjB,OAAO,CACN,IAAI,CAAC,YAAY,EAAE,CAAC,MAAM,CAAC,UAAC,IAAI;YAC/B,OAAO,IAAI,CAAC,EAAE,KAAK,EAAE,CAAC;QACvB,CAAC,CAAC,CAAC,MAAM,GAAG,CAAC,CACb,CAAC;IACH,CAAC;IAED,4BAAU,GAAV,UAAW,QAAgB,EAAE,KAAyB;QACrD,IAAI,CAAC,WAAW,CAAC,IAAI,CAAC,EAAE,QAAQ,EAAE,QAAQ,EAAE,KAAK,EAAE,KAAK,EAAE,CAAC,CAAC;QAC5D,IAAI,CAAC,MAAM,EAAE,CAAC;IACf,CAAC;IAED,0BAAQ,GAAR,UAAS,OAAe,EAAE,IAAa;QACtC,IAAI,CAAC,OAAO;YAAE,OAAO;QAErB,IAAI,CAAC,OAAO,CAAC,aAAa,CAAC,IAAI,CAAC,eAAe,EAAE;YAChD,UAAU,EAAE,OAAO;YACnB,OAAO,EAAE,EAAE,EAAE,EAAE,OAAO,EAAE;YACxB,WAAW,EAAE,IAAI,CAAC,CAAC,CAAC,MAAM,CAAC,CAAC,CAAC,MAAM;SACnC,CAAC,CAAC;QAEH,QAAQ,CAAC,kBAAkB,EAAE,CAAC;IAC/B,CAAC;IAED,4BAAU,GAAV,UAAW,OAAe,EAAE,MAAe;QAC1C,IAAI,CAAC,OAAO;YAAE,OAAO;QAErB,IAAI,CAAC,OAAO,CAAC,aAAa,CAAC,IAAI,CAAC,eAAe,EAAE;YAChD,UAAU,EAAE,OAAO;YACnB,WAAW,EAAE,MAAM,CAAC,CAAC,CAAC,QAAQ,CAAC,CAAC,CAAC,SAAS;SAC1C,CAAC,CAAC;IACJ,CAAC;IAED,4BAAU,GAAV,UAAW,OAAe,EAAE,MAAe;QAC1C,IAAI,CAAC,OAAO;YAAE,OAAO;QAErB,IAAI,CAAC,OAAO,CAAC,aAAa,CAAC,IAAI,CAAC,eAAe,EAAE;YAChD,UAAU,EAAE,OAAO;YACnB,WAAW,EAAE,MAAM,CAAC,CAAC,CAAC,QAAQ,CAAC,CAAC,CAAC,UAAU;SAC3C,CAAC,CAAC;IACJ,CAAC;IAED,4BAAU,GAAV,UAAW,IAAiB;QAC3B,IAAI,CAAC,OAAO,CAAC,YAAY,CAAC,IAAI,CAAC,eAAe,EAAE,IAAI,CAAC,CAAC;QACtD,IAAI,CAAC,0BAA0B,CAAC,EAAE,CAAC,CAAC;QACpC,QAAQ,CAAC,kBAAkB,EAAE,CAAC;IAC/B,CAAC;IAED,4CAA0B,GAA1B,UAA2B,OAAe;QAA1C,iBAiDC;QAhDA,IAAM,MAAM,GAAkB,EAAE,CAAC;QACjC,IAAM,MAAM,GAAkB,EAAE,CAAC;QAEjC,IAAM,KAAK,GAAG,IAAI,CAAC,YAAY,EAAE,CAAC;QAClC,KAAK,CAAC,OAAO,CAAC,UAAC,IAAI;YAClB,IACE,MAAc,CAAC,eAAe;gBAC/B,MAAM,CAAC,IAAI,CAAC,QAAQ,EAAE;gBACtB,IAAI,CAAC,YAAY,KAAK,KAAK,EAC1B;gBACD,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,EAAE,CAAC,CAAC;aACrB;iBAAM,IACN,CAAC,CAAC,MAAM,CAAC,IAAI,CAAC,QAAQ,EAAE,IAAI,IAAI,CAAC,MAAM,KAAK,KAAK,CAAC;gBACjD,CAAC,MAAM,CAAC,IAAI,CAAC,QAAQ,EAAE,IAAI,IAAI,CAAC,MAAM,KAAK,KAAK,CAAC;gBACjD,CAAC,MAAM,CAAC,IAAI,CAAC,SAAS,EAAE,IAAI,IAAI,CAAC,OAAO,KAAK,KAAK,CAAC;gBACnD,CAAC,CAAE,MAAc,CAAC,gBAAgB;oBACjC,IAAI,CAAC,aAAa,KAAK,KAAK,CAAC,CAAC;gBAChC,CAAC,IAAI,CAAC,MAAM,EACX;gBACD,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,EAAE,CAAC,CAAC;aACrB;iBAAM,IACN,CAAC,CAAC,MAAM,CAAC,IAAI,CAAC,QAAQ,EAAE,IAAI,IAAI,CAAC,MAAM,KAAK,IAAI,CAAC;gBAChD,CAAC,MAAM,CAAC,IAAI,CAAC,QAAQ,EAAE,IAAI,IAAI,CAAC,MAAM,KAAK,IAAI,CAAC;gBAChD,CAAC,MAAM,CAAC,IAAI,CAAC,SAAS,EAAE,IAAI,IAAI,CAAC,OAAO,KAAK,IAAI,CAAC;gBAClD,CAAE,MAAc,CAAC,gBAAgB,IAAI,IAAI,CAAC,aAAa,KAAK,IAAI,CAAC,CAAC;gBACnE,IAAI,CAAC,MAAM,EACV;gBACD,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,EAAE,CAAC,CAAC;aACrB;YAED,IAAI,OAAO,IAAI,IAAI,CAAC,OAAO,EAAE;gBAC5B,IAAI,IAAI,CAAC,OAAO,CAAC,OAAO,CAAC,OAAO,CAAC,IAAI,CAAC;oBAAE,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,EAAE,CAAC,CAAC;;oBACxD,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,EAAE,CAAC,CAAC;aAC1B;iBAAM,IAAI,CAAC,OAAO,IAAI,IAAI,CAAC,OAAO,EAAE;gBACpC,IAAI,IAAI,CAAC,OAAO,CAAC,OAAO,CAAC,SAAS,CAAC,IAAI,CAAC;oBAAE,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,EAAE,CAAC,CAAC;;oBAC1D,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,EAAE,CAAC,CAAC;aAC1B;QACF,CAAC,CAAC,CAAC;QAEH,MAAM,CAAC,GAAG,CAAC,OAAO,CAAC,GAAG,CAAC,qBAAqB,GAAG,MAAM,CAAC,CAAC;QACvD,MAAM,CAAC,GAAG,CAAC,OAAO,CAAC,GAAG,CAAC,sBAAsB,GAAG,MAAM,CAAC,CAAC;QAExD,MAAM,CAAC,OAAO,CAAC,UAAC,IAAI;YACnB,KAAI,CAAC,QAAQ,CAAC,IAAI,EAAE,KAAK,CAAC,CAAC;QAC5B,CAAC,CAAC,CAAC;QACH,MAAM,CAAC,OAAO,CAAC,UAAC,IAAI;YACnB,KAAI,CAAC,QAAQ,CAAC,IAAI,EAAE,IAAI,CAAC,CAAC;QAC3B,CAAC,CAAC,CAAC;IACJ,CAAC;IACF,cAAC;AAAD,CAAC,AAzKD,IAyKC;AAED,QAAQ,CAAC,OAAO,GAAG,OAAO,CAAC","sourcesContent":["// @ts-strict-ignore\n/* -*- js-indent-level: 8 -*- */\n/*\n * Copyright the Collabora Online contributors.\n *\n * SPDX-License-Identifier: MPL-2.0\n *\n * This Source Code Form is subject to the terms of the Mozilla Public\n * License, v. 2.0. If a copy of the MPL was not distributed with this\n * file, You can obtain one at http://mozilla.org/MPL/2.0/.\n */\n\n/*\n * Component.Toolbar - base class for toolbars\n */\n\ndeclare var JSDialog: any;\n\ntype ToolbarItem = any;\n\nclass Toolbar {\n\tprotected map: any;\n\tprotected docType: string;\n\tprotected builder: JSBuilder;\n\tprotected callback: JSDialogCallback;\n\tprotected toolbarElementId: string;\n\tprotected parentContainer: Element;\n\tprotected customItems: Array<ToolbarItem>;\n\n\tconstructor(map: any, toolbarElementId: string) {\n\t\tthis.map = map;\n\t\tthis.docType = map.getDocType();\n\t\tthis.customItems = [];\n\t\tthis.toolbarElementId = toolbarElementId;\n\n\t\tthis.builder = new L.control.jsDialogBuilder({\n\t\t\tmobileWizard: this,\n\t\t\tmap: this.map,\n\t\t\tcssClass: 'jsdialog',\n\t\t\tnoLabelsForUnoButtons: true,\n\t\t\tcallback: this.callback ? this.callback.bind(this) : undefined,\n\t\t});\n\n\t\tthis.reset();\n\t\tthis.create();\n\t\tthis.updateVisibilityForToolbar('');\n\t}\n\n\tgetToolItems(): Array<ToolbarItem> {\n\t\treturn [];\n\t}\n\n\treset() {\n\t\tthis.parentContainer = L.DomUtil.get(this.toolbarElementId);\n\n\t\t// In case it contains garbage\n\t\tif (this.parentContainer) this.parentContainer.replaceChildren();\n\n\t\tL.DomUtil.addClass(this.parentContainer, 'ui-toolbar');\n\t}\n\n\tcreate() {\n\t\tthis.reset();\n\n\t\tvar items = this.getToolItems();\n\t\tthis.builder.build(this.parentContainer, items, undefined);\n\n\t\tJSDialog.MakeScrollable(\n\t\t\tthis.parentContainer,\n\t\t\tthis.parentContainer.querySelector('div'),\n\t\t);\n\t\tJSDialog.RefreshScrollables();\n\n\t\tif (this.map.isRestrictedUser()) {\n\t\t\tfor (var i = 0; i < items.length; i++) {\n\t\t\t\tvar it = items[i];\n\t\t\t\tvar item = $('#' + it.id)[0];\n\t\t\t\tthis.map.hideRestrictedItems(it, item, item);\n\t\t\t}\n\t\t}\n\n\t\tif (this.map.isLockedUser()) {\n\t\t\tfor (var i = 0; i < items.length; i++) {\n\t\t\t\tvar it = items[i];\n\t\t\t\tvar item = $('#' + it.id)[0];\n\t\t\t\tthis.map.disableLockedItem(it, item, item);\n\t\t\t}\n\t\t}\n\t}\n\n\thasItem(id: string) {\n\t\treturn (\n\t\t\tthis.getToolItems().filter((item) => {\n\t\t\t\treturn item.id === id;\n\t\t\t}).length > 0\n\t\t);\n\t}\n\n\tinsertItem(beforeId: string, items: Array<ToolbarItem>) {\n\t\tthis.customItems.push({ beforeId: beforeId, items: items });\n\t\tthis.create();\n\t}\n\n\tshowItem(command: string, show: boolean) {\n\t\tif (!command) return;\n\n\t\tthis.builder.executeAction(this.parentContainer, {\n\t\t\tcontrol_id: command,\n\t\t\tcontrol: { id: command },\n\t\t\taction_type: show ? 'show' : 'hide',\n\t\t});\n\n\t\tJSDialog.RefreshScrollables();\n\t}\n\n\tenableItem(command: string, enable: boolean) {\n\t\tif (!command) return;\n\n\t\tthis.builder.executeAction(this.parentContainer, {\n\t\t\tcontrol_id: command,\n\t\t\taction_type: enable ? 'enable' : 'disable',\n\t\t});\n\t}\n\n\tselectItem(command: string, select: boolean) {\n\t\tif (!command) return;\n\n\t\tthis.builder.executeAction(this.parentContainer, {\n\t\t\tcontrol_id: command,\n\t\t\taction_type: select ? 'select' : 'unselect',\n\t\t});\n\t}\n\n\tupdateItem(data: ToolbarItem) {\n\t\tthis.builder.updateWidget(this.parentContainer, data);\n\t\tthis.updateVisibilityForToolbar('');\n\t\tJSDialog.RefreshScrollables();\n\t}\n\n\tupdateVisibilityForToolbar(context: string) {\n\t\tconst toShow: Array<string> = [];\n\t\tconst toHide: Array<string> = [];\n\n\t\tconst items = this.getToolItems();\n\t\titems.forEach((item) => {\n\t\t\tif (\n\t\t\t\t(window as any).ThisIsTheiOSApp &&\n\t\t\t\twindow.mode.isTablet() &&\n\t\t\t\titem.iosapptablet === false\n\t\t\t) {\n\t\t\t\ttoHide.push(item.id);\n\t\t\t} else if (\n\t\t\t\t((window.mode.isMobile() && item.mobile === false) ||\n\t\t\t\t\t(window.mode.isTablet() && item.tablet === false) ||\n\t\t\t\t\t(window.mode.isDesktop() && item.desktop === false) ||\n\t\t\t\t\t(!(window as any).ThisIsAMobileApp &&\n\t\t\t\t\t\titem.mobilebrowser === false)) &&\n\t\t\t\t!item.hidden\n\t\t\t) {\n\t\t\t\ttoHide.push(item.id);\n\t\t\t} else if (\n\t\t\t\t((window.mode.isMobile() && item.mobile === true) ||\n\t\t\t\t\t(window.mode.isTablet() && item.tablet === true) ||\n\t\t\t\t\t(window.mode.isDesktop() && item.desktop === true) ||\n\t\t\t\t\t((window as any).ThisIsAMobileApp && item.mobilebrowser === true)) &&\n\t\t\t\titem.hidden\n\t\t\t) {\n\t\t\t\ttoShow.push(item.id);\n\t\t\t}\n\n\t\t\tif (context && item.context) {\n\t\t\t\tif (item.context.indexOf(context) >= 0) toShow.push(item.id);\n\t\t\t\telse toHide.push(item.id);\n\t\t\t} else if (!context && item.context) {\n\t\t\t\tif (item.context.indexOf('default') >= 0) toShow.push(item.id);\n\t\t\t\telse toHide.push(item.id);\n\t\t\t}\n\t\t});\n\n\t\twindow.app.console.log('explicitly hiding: ' + toHide);\n\t\twindow.app.console.log('explicitly showing: ' + toShow);\n\n\t\ttoHide.forEach((item) => {\n\t\t\tthis.showItem(item, false);\n\t\t});\n\t\ttoShow.forEach((item) => {\n\t\t\tthis.showItem(item, true);\n\t\t});\n\t}\n}\n\nJSDialog.Toolbar = Toolbar;\n"]}