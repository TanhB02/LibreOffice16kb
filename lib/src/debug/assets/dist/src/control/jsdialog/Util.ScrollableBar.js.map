{"version":3,"file":"Util.ScrollableBar.js","sourceRoot":"","sources":["../../../../../../../../../../../TanhX/online/browser/src/control/jsdialog/Util.ScrollableBar.ts"],"names":[],"mappings":"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","sourcesContent":["// @ts-strict-ignore\n/* -*- js-indent-level: 8 -*- */\n/*\n * Copyright the Collabora Online contributors.\n *\n * SPDX-License-Identifier: MPL-2.0\n *\n * This Source Code Form is subject to the terms of the Mozilla Public\n * License, v. 2.0. If a copy of the MPL was not distributed with this\n * file, You can obtain one at http://mozilla.org/MPL/2.0/.\n */\n\n/*\n * JSDialog.ScrollableBar - helper for creating toolbars with scrolling left/right\n */\n\n/* global JSDialog $ */\n\ndeclare var JSDialog: any;\n\nfunction createScrollButtons(parent: Element, scrollable: Element) {\n\tL.DomUtil.addClass(scrollable, 'ui-scroll-wrapper');\n\n\tconst left = L.DomUtil.create('div', 'ui-scroll-left', parent);\n\tconst right = L.DomUtil.create('div', 'ui-scroll-right', parent);\n\n\tJSDialog.AddOnClick(left, () => {\n\t\tconst scroll = $(scrollable).scrollLeft() - 300;\n\t\t$(scrollable).animate({ scrollLeft: scroll }, 300);\n\t\tsetTimeout(function () {\n\t\t\tJSDialog.RefreshScrollables();\n\t\t}, 350);\n\t});\n\n\tJSDialog.AddOnClick(right, () => {\n\t\tconst scroll = $(scrollable).scrollLeft() + 300;\n\t\t$(scrollable).animate({ scrollLeft: scroll }, 300);\n\t\tsetTimeout(function () {\n\t\t\tJSDialog.RefreshScrollables();\n\t\t}, 350);\n\t});\n}\n\nfunction showArrow(arrow: HTMLElement, show: boolean) {\n\tif (show) arrow.style.setProperty('display', 'block');\n\telse arrow.style.setProperty('display', 'none');\n}\n\nfunction setupResizeHandler(container: Element, scrollable: Element) {\n\tconst left = container.querySelector('.ui-scroll-left') as HTMLElement;\n\tconst right = container.querySelector('.ui-scroll-right') as HTMLElement;\n\tvar isRTL: boolean = document.documentElement.dir === 'rtl';\n\tvar timer: any; // for shift + mouse wheel up/down\n\n\tconst handler = function () {\n\t\tconst rootContainer = scrollable.querySelector('div');\n\t\tif (!rootContainer) return;\n\n\t\tif (rootContainer.scrollWidth > window.innerWidth) {\n\t\t\t// we have overflowed content\n\t\t\tconst direction = isRTL ? -1 : 1;\n\t\t\tif (direction * scrollable.scrollLeft > 0) {\n\t\t\t\tif (isRTL) showArrow(right, true);\n\t\t\t\telse showArrow(left, true);\n\t\t\t} else if (isRTL) showArrow(right, false);\n\t\t\telse showArrow(left, false);\n\n\t\t\tif (\n\t\t\t\tdirection * scrollable.scrollLeft <\n\t\t\t\trootContainer.scrollWidth - window.innerWidth - 1\n\t\t\t) {\n\t\t\t\tif (isRTL) showArrow(left, true);\n\t\t\t\telse showArrow(right, true);\n\t\t\t} else if (isRTL) showArrow(left, false);\n\t\t\telse showArrow(right, false);\n\t\t} else {\n\t\t\tshowArrow(left, false);\n\t\t\tshowArrow(right, false);\n\t\t}\n\t}.bind(this);\n\n\t// handler for toolbar and statusbar\n\t// runs if shift + mouse wheel up/down are used\n\tconst shiftHandler = (e: MouseEvent) => {\n\t\tconst rootContainer = scrollable.querySelector('div');\n\t\tif (!rootContainer || !e.shiftKey) return;\n\n\t\tclearTimeout(timer);\n\t\t// wait until mouse wheel stops scrolling\n\t\ttimer = setTimeout(function () {\n\t\t\tJSDialog.RefreshScrollables();\n\t\t}, 350);\n\t};\n\n\twindow.addEventListener('resize', handler);\n\twindow.addEventListener('scroll', handler);\n\tscrollable.addEventListener('wheel', shiftHandler);\n}\n\nfunction setupPriorityStatusHandler(scrollable: Element, toolItems: any[]) {\n\tconst handler = function () {\n\t\tconst rootContainer = scrollable.querySelector('div');\n\t\tif (!rootContainer) return;\n\n\t\tconst statusBarItems = Array.from(rootContainer.children) as HTMLElement[];\n\t\t// Match DOM items to toolItems by ID and set data-priority\n\t\tstatusBarItems.forEach((domItem) => {\n\t\t\tconst toolItem = toolItems.find((item) => {\n\t\t\t\tconst itemIdBase = item.id.split(':')[0]; // The base ID with a possible suffix for example 'languagestatus:LanguageStatusMenu'\n\t\t\t\treturn (\n\t\t\t\t\titemIdBase === domItem.id || item.id + '-container' === domItem.id\n\t\t\t\t);\n\t\t\t});\n\n\t\t\tif (toolItem && toolItem.dataPriority) {\n\t\t\t\tdomItem.setAttribute('data-priority', toolItem.dataPriority);\n\t\t\t} else {\n\t\t\t\tdomItem.removeAttribute('data-priority');\n\t\t\t}\n\t\t});\n\n\t\t// Reset visibility of hidden statuses\n\t\tstatusBarItems.forEach((item) => {\n\t\t\titem.classList.remove('status-hidden');\n\t\t});\n\n\t\tconst availableWidth = window.innerWidth;\n\t\tlet contentWidth = rootContainer.scrollWidth;\n\n\t\tif (contentWidth > availableWidth) {\n\t\t\t// Group items by data-priority\n\t\t\tconst itemsByPriorityLevel: { [key: string]: HTMLElement[] } = {};\n\t\t\tstatusBarItems.forEach((item) => {\n\t\t\t\tif (item.hasAttribute('data-priority')) {\n\t\t\t\t\tconst priority = item.getAttribute('data-priority') || '0';\n\t\t\t\t\tif (!itemsByPriorityLevel[priority]) {\n\t\t\t\t\t\titemsByPriorityLevel[priority] = [];\n\t\t\t\t\t}\n\t\t\t\t\titemsByPriorityLevel[priority].push(item);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tconst priorityLevels = Object.keys(itemsByPriorityLevel)\n\t\t\t\t.map(Number)\n\t\t\t\t.sort((a, b) => b - a);\n\n\t\t\tlet remainingWidthToFit = contentWidth - availableWidth;\n\t\t\t// Hide items with the same priority level\n\t\t\tfor (const priority of priorityLevels) {\n\t\t\t\tconst itemsAtPriority = itemsByPriorityLevel[priority];\n\t\t\t\tif (!itemsAtPriority) continue;\n\n\t\t\t\t// Calculate total width of the items\n\t\t\t\tconst combinedWidthAtPriority = itemsAtPriority.reduce(\n\t\t\t\t\t(sum, item) => sum + item.offsetWidth,\n\t\t\t\t\t0,\n\t\t\t\t);\n\n\t\t\t\tif (remainingWidthToFit > 0) {\n\t\t\t\t\titemsAtPriority.forEach((item) => {\n\t\t\t\t\t\titem.classList.add('status-hidden');\n\t\t\t\t\t});\n\t\t\t\t\tremainingWidthToFit -= combinedWidthAtPriority;\n\t\t\t\t\tcontentWidth -= combinedWidthAtPriority;\n\t\t\t\t} else {\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}.bind(this);\n\n\twindow.addEventListener('resize', handler);\n}\n\nJSDialog.MakeScrollable = function (parent: Element, scrollable: Element) {\n\tL.DomUtil.addClass(scrollable, 'ui-scrollable-content');\n\tcreateScrollButtons(parent, scrollable);\n\tsetupResizeHandler(parent, scrollable);\n};\n\nJSDialog.MakeStatusPriority = function (scrollable: Element, toolItems: any[]) {\n\tL.DomUtil.addClass(scrollable, 'ui-scrollable-content');\n\tsetupPriorityStatusHandler(scrollable, toolItems);\n};\n\nJSDialog.RefreshScrollables = function () {\n\twindow.dispatchEvent(new Event('resize'));\n};\n"]}