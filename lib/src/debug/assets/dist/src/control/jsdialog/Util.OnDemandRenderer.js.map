{"version":3,"file":"Util.OnDemandRenderer.js","sourceRoot":"","sources":["../../../../../../../../../../../TanhX/online/browser/src/control/jsdialog/Util.OnDemandRenderer.ts"],"names":[],"mappings":"AAAA,oBAAoB;AACpB,gCAAgC;AAChC;;;;;;;;GAQG;AAQH,SAAS,gBAAgB,CACxB,OAAkB,EAClB,SAAiB,EACjB,WAAmB,EACnB,OAAe,EACf,WAAoB,EACpB,eAAwB,EACxB,SAA6B;IAE7B,IAAM,qBAAqB,GAAG;QAC7B,IAAM,qBAAqB,GAAG,OAAO,CAAC,YAAY,CAAC,SAAS,CAAC,CAAC;QAC9D,IAAI,aAAa,GAAG,IAAI,CAAC;QAEzB,IAAI,qBAAqB,IAAI,qBAAqB,CAAC,MAAM,CAAC,OAAO,CAAC,EAAE;YACnE,CAAC,CAAC,OAAO,CAAC,MAAM,CAAC,WAAW,CAAC,CAAC;YAC9B,WAAW,GAAG,CAAC,CAAC,OAAO,CAAC,MAAM,CAAC,KAAK,EAAE,EAAE,EAAE,eAAe,CAAC,CAAC;YAC3D,IAAM,cAAc,GAAG,WAA+B,CAAC;YACvD,cAAc,CAAC,GAAG,GAAG,qBAAqB,CAAC,MAAM,CAAC,OAAO,CAAC,CAAC;YAC3D,cAAc,CAAC,GAAG,GAAG,SAAS,CAAC;YAC/B,cAAc,CAAC,KAAK,GAAG,SAAS,CAAC;YACjC,aAAa,GAAG,CAAC,qBAAqB,CAAC,UAAU,CAAC;SAClD;QAED,IAAI,aAAa,EAAE;YAClB,mBAAmB;YACnB,IAAI,cAAc,GAAG,UAAC,OAAY;gBACjC,OAAO,CAAC,OAAO,CAAC,UAAC,KAAU;oBAC1B,IAAI,KAAK,CAAC,cAAc,EAAE;wBACzB,OAAO,CAAC,QAAQ,CACf,WAAW,EACX,cAAc,EACd,EAAE,EAAE,EAAE,SAAS,EAAE,EACjB,OAAO;4BACN,GAAG;4BACH,IAAI,CAAC,KAAK,CAAC,GAAG,GAAG,MAAM,CAAC,gBAAgB,CAAC;4BACzC,GAAG;4BACH,IAAI,CAAC,KAAK,CAAC,GAAG,GAAG,MAAM,CAAC,gBAAgB,CAAC,EAC1C,OAAO,CACP,CAAC;qBACF;gBACF,CAAC,CAAC,CAAC;YACJ,CAAC,CAAC;YAEF,IAAI,QAAQ,GAAG,IAAI,oBAAoB,CAAC,cAAc,EAAE;gBACvD,IAAI,EAAE,IAAI;gBACV,SAAS,EAAE,IAAI,EAAE,6BAA6B;aAC9C,CAAC,CAAC;YAEH,QAAQ,CAAC,OAAO,CAAC,WAAW,CAAC,CAAC;SAC9B;IACF,CAAC,CAAC;IACF,IAAI,WAAW,CAAC,mBAAmB,EAAE,EAAE;QACtC,qBAAqB,EAAE,CAAC;KACxB;SAAM;QACN,uDAAuD;QACvD,WAAW,CAAC,wBAAwB,CAAC,qBAAqB,CAAC,CAAC;KAC5D;AACF,CAAC;AAED,QAAQ,CAAC,gBAAgB,GAAG,gBAAgB,CAAC","sourcesContent":["// @ts-strict-ignore\n/* -*- js-indent-level: 8 -*- */\n/*\n * Copyright the Collabora Online contributors.\n *\n * SPDX-License-Identifier: MPL-2.0\n *\n * This Source Code Form is subject to the terms of the Mozilla Public\n * License, v. 2.0. If a copy of the MPL was not distributed with this\n * file, You can obtain one at http://mozilla.org/MPL/2.0/.\n */\n\n/*\n * Util.OnDemandRenderer - helper for rendering entries on demand (when visible)\n */\n\ndeclare var JSDialog: any;\n\nfunction onDemandRenderer(\n\tbuilder: JSBuilder,\n\tcontrolId: string,\n\tcontrolType: string,\n\tentryId: number,\n\tplaceholder: Element,\n\tparentContainer: Element,\n\tentryText: string | undefined,\n) {\n\tconst setupOnDemandRenderer = () => {\n\t\tconst cachedComboboxEntries = builder.rendersCache[controlId];\n\t\tlet requestRender = true;\n\n\t\tif (cachedComboboxEntries && cachedComboboxEntries.images[entryId]) {\n\t\t\tL.DomUtil.remove(placeholder);\n\t\t\tplaceholder = L.DomUtil.create('img', '', parentContainer);\n\t\t\tconst placeholderImg = placeholder as HTMLImageElement;\n\t\t\tplaceholderImg.src = cachedComboboxEntries.images[entryId];\n\t\t\tplaceholderImg.alt = entryText;\n\t\t\tplaceholderImg.title = entryText;\n\t\t\trequestRender = !cachedComboboxEntries.persistent;\n\t\t}\n\n\t\tif (requestRender) {\n\t\t\t// render on demand\n\t\t\tvar onIntersection = (entries: any) => {\n\t\t\t\tentries.forEach((entry: any) => {\n\t\t\t\t\tif (entry.isIntersecting) {\n\t\t\t\t\t\tbuilder.callback(\n\t\t\t\t\t\t\tcontrolType,\n\t\t\t\t\t\t\t'render_entry',\n\t\t\t\t\t\t\t{ id: controlId },\n\t\t\t\t\t\t\tentryId +\n\t\t\t\t\t\t\t\t';' +\n\t\t\t\t\t\t\t\tMath.floor(100 * window.devicePixelRatio) +\n\t\t\t\t\t\t\t\t';' +\n\t\t\t\t\t\t\t\tMath.floor(100 * window.devicePixelRatio),\n\t\t\t\t\t\t\tbuilder,\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t};\n\n\t\t\tvar observer = new IntersectionObserver(onIntersection, {\n\t\t\t\troot: null,\n\t\t\t\tthreshold: 0.01, // percentage of visible area\n\t\t\t});\n\n\t\t\tobserver.observe(placeholder);\n\t\t}\n\t};\n\tif (TileManager.isReceivedFirstTile()) {\n\t\tsetupOnDemandRenderer();\n\t} else {\n\t\t// No first tile yet, delay sending the render request.\n\t\tTileManager.appendAfterFirstTileTask(setupOnDemandRenderer);\n\t}\n}\n\nJSDialog.OnDemandRenderer = onDemandRenderer;\n"]}