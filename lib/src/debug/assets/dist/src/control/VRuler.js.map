{"version":3,"file":"VRuler.js","sourceRoot":"","sources":["../../../../../../../../../../TanhX/online/browser/src/control/VRuler.ts"],"names":[],"mappings":"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","sourcesContent":["// @ts-strict-ignore\n/* -*- js-indent-level: 8; fill-column: 100 -*- */\n/*\n * Copyright the Collabora Online contributors.\n *\n * SPDX-License-Identifier: MPL-2.0\n *\n * This Source Code Form is subject to the terms of the Mozilla Public\n * License, v. 2.0. If a copy of the MPL was not distributed with this\n * file, You can obtain one at http://mozilla.org/MPL/2.0/.\n */\n/*\n * Ruler Handler\n\n * HRuler.ts\n/**\n * VRuler.ts\n *\n * Manages the vertical ruler for displaying measurements and positioning.\n * Handles user interactions like scrolling and renders grid lines/ticks.\n */\n\nclass VRuler extends Ruler {\n\t_pVerticalStartMarker: HTMLDivElement;\n\t_pVerticalEndMarker: HTMLDivElement;\n\t_rFace: HTMLDivElement;\n\t_markerHorizontalLine: HTMLDivElement;\n\t_rWrapper: HTMLDivElement;\n\t_rMarginWrapper: HTMLDivElement;\n\t_rBPWrapper: HTMLDivElement;\n\t_rBPContainer: HTMLDivElement;\n\t_rTSContainer: HTMLDivElement;\n\t_tMarginMarker: HTMLDivElement;\n\t_bMarginMarker: HTMLDivElement;\n\t_tMarginDrag: HTMLDivElement;\n\t_bMarginDrag: HTMLDivElement;\n\n\t_indentationElementId: string;\n\t_initialposition: number;\n\t_lastposition: number;\n\n\t_map: ReturnType<typeof L.map>;\n\toptions: Options;\n\n\tconstructor(map: ReturnType<typeof L.map>, options: Partial<Options>) {\n\t\tsuper(options);\n\t\tObject.assign(this.options, options);\n\t\tthis._map = map;\n\t\tthis.onAdd(); // VRuler created\n\t}\n\n\tonAdd() {\n\t\tthis._map.on('vrulerupdate', this._updateOptions, this);\n\t\tthis._map.on('scrolllimits', this._updatePaintTimer, this);\n\t\tthis._map.on('moveend', this._fixOffset, this);\n\t\tapp.events.on('updatepermission', this._changeInteractions.bind(this));\n\t\tthis._map.on(\n\t\t\t'resettopbottompagespacing',\n\t\t\tthis._resetTopBottomPageSpacing,\n\t\t\tthis,\n\t\t);\n\t\tthis._map.on('commandstatechanged', this.onCommandStateChanged, this);\n\t\tthis._map.on('rulerchanged', this._onRulerChanged, this);\n\t\tL.DomUtil.addClass(this._map.getContainer(), 'hasruler');\n\n\t\tconst container: HTMLDivElement = this._initLayout();\n\t\tconst corner: HTMLElement =\n\t\t\tthis._map._controlCorners[this.options.position];\n\n\t\tL.DomUtil.addClass(container, 'leaflet-control');\n\n\t\tif (this.options.position.indexOf('bottom') !== -1) {\n\t\t\tcorner.insertBefore(container, corner.firstChild);\n\t\t} else {\n\t\t\tcorner.appendChild(container);\n\t\t}\n\t}\n\n\tonRemove() {\n\t\tthis._map.off('vrulerupdate', this._updateOptions, this);\n\t\tthis._map.off('scrolllimits', this._updatePaintTimer, this);\n\t\tthis._map.off('moveend', this._fixOffset, this);\n\t\tapp.events.off('updatepermission', this._changeInteractions.bind(this));\n\t\tthis._map.off(\n\t\t\t'resettopbottompagespacing',\n\t\t\tthis._resetTopBottomPageSpacing,\n\t\t\tthis,\n\t\t);\n\t\tthis._map.off('commandstatechanged', this.onCommandStateChanged, this);\n\t\tthis._map.off('rulerchanged', this._onRulerChanged, this);\n\t}\n\n\t_resetTopBottomPageSpacing(e?: any) {\n\t\tthis.options.pageTopMargin = undefined;\n\t\tthis.options.pageBottomMargin = undefined;\n\t\tif (e) this.options.disableMarker = e.disableMarker;\n\t}\n\n\tonCommandStateChanged(e: any) {\n\t\t// reset Top bottom margin on style change\n\t\t// Style will change when we do focus on section like Header, Footer, Main text section\n\t\tif (e.commandName == '.uno:StyleApply') this._resetTopBottomPageSpacing();\n\t}\n\n\t_changeInteractions(e: any) {\n\t\tif (this._tMarginDrag) {\n\t\t\tif (e.detail.perm === 'edit') {\n\t\t\t\tthis._tMarginDrag.style.cursor = 'e-resize';\n\t\t\t\tthis._bMarginDrag.style.cursor = 'w-resize';\n\t\t\t} else {\n\t\t\t\tthis._tMarginDrag.style.cursor = 'default';\n\t\t\t\tthis._bMarginDrag.style.cursor = 'default';\n\t\t\t}\n\t\t}\n\t}\n\n\t_initiateIndentationMarkers() {\n\t\t// Paragraph indentation\n\t\tthis._pVerticalStartMarker = document.createElement('div');\n\t\tthis._pVerticalStartMarker.id = 'lo-vertical-pstart-marker';\n\t\tthis._pVerticalStartMarker.classList.add(\n\t\t\t'cool-ruler-indentation-marker-up',\n\t\t);\n\t\tthis._rFace.appendChild(this._pVerticalStartMarker);\n\n\t\t// Paragraph end\n\t\tthis._pVerticalEndMarker = document.createElement('div');\n\t\tthis._pVerticalEndMarker.id = 'lo-vertical-pend-marker';\n\t\tthis._pVerticalEndMarker.classList.add('cool-ruler-indentation-marker-up');\n\t\tthis._rFace.appendChild(this._pVerticalEndMarker);\n\n\t\t// While one of the markers is being dragged, a horizontal line should be visible in order to indicate the new position of the marker.\n\t\tthis._markerHorizontalLine = L.DomUtil.create(\n\t\t\t'div',\n\t\t\t'cool-ruler-horizontal-indentation-marker-center',\n\t\t);\n\t\tthis._rFace.appendChild(this._markerHorizontalLine);\n\n\t\tL.DomEvent.on(\n\t\t\tthis._pVerticalStartMarker,\n\t\t\t'mousedown',\n\t\t\t(window as typeof window & { touch: any }).touch.mouseOnly(\n\t\t\t\tthis._initiateIndentationDrag,\n\t\t\t),\n\t\t\tthis,\n\t\t);\n\t\tL.DomEvent.on(\n\t\t\tthis._pVerticalEndMarker,\n\t\t\t'mousedown',\n\t\t\t(window as typeof window & { touch: any }).touch.mouseOnly(\n\t\t\t\tthis._initiateIndentationDrag,\n\t\t\t),\n\t\t\tthis,\n\t\t);\n\t}\n\n\t_initLayout() {\n\t\tthis._rWrapper = L.DomUtil.create(\n\t\t\t'div',\n\t\t\t'cool-ruler leaflet-bar leaflet-control leaflet-control-custom',\n\t\t);\n\t\tthis._rWrapper.id = 'vertical-ruler';\n\t\tthis._rWrapper.classList.add('vruler');\n\t\tthis._rWrapper.style.visibility = 'hidden';\n\n\t\t// We start it hidden rather than not initialzing at all.\n\t\t// It is due to rulerupdate command that comes from LOK.\n\t\t// If we delay its initialization, we can't calculate its margins and have to wait for another rulerupdate message to arrive.\n\t\tif (!this.options.showruler) {\n\t\t\tL.DomUtil.setStyle(this._rWrapper, 'display', 'none');\n\t\t}\n\t\tthis._rFace = L.DomUtil.create('div', 'cool-ruler-face', this._rWrapper);\n\t\tthis._rMarginWrapper = L.DomUtil.create(\n\t\t\t'div',\n\t\t\t'cool-ruler-marginwrapper',\n\t\t\tthis._rFace,\n\t\t);\n\t\t// BP => Break Points\n\t\tthis._rBPWrapper = L.DomUtil.create(\n\t\t\t'div',\n\t\t\t'cool-ruler-breakwrapper',\n\t\t\tthis._rFace,\n\t\t);\n\t\tthis._rBPContainer = L.DomUtil.create(\n\t\t\t'div',\n\t\t\t'cool-ruler-breakcontainer',\n\t\t\tthis._rBPWrapper,\n\t\t);\n\n\t\t// Tab stops\n\t\tthis._rTSContainer = L.DomUtil.create(\n\t\t\t'div',\n\t\t\t'cool-ruler-tabstopcontainer',\n\t\t\tthis._rMarginWrapper,\n\t\t);\n\t\tthis._initiateIndentationMarkers();\n\n\t\treturn this._rWrapper;\n\t}\n\n\t_onRulerChanged() {\n\t\t// update show ruler state on rulerChange event\n\t\tthis.options.showruler = this._map.uiManager.getBooleanDocTypePref(\n\t\t\t'ShowRuler',\n\t\t\ttrue,\n\t\t);\n\t\tif (this.options.showruler) {\n\t\t\t// in case of disabled ruler at docload calculation of offset can be ignored\n\t\t\t// but after enabling the ruler we need to set the offset.\n\t\t\tthis._fixOffset();\n\t\t}\n\t}\n\n\t_updateOptions(obj: Options) {\n\t\t// window.app.console.log('===> _updateOptions');\n\t\t// Note that the values for margin1, margin2 and leftOffset are not in any sane\n\t\t// units. See the comment in SwCommentRuler::CreateJsonNotification(). The values\n\t\t// are pixels for some virtual device in core, not related to the actual device this\n\t\t// is running on at all, passed through convertTwipToMm100(), i.e. multiplied by\n\t\t// approximately 1.76. Let's call these units \"arbitrary pixelish units\" in\n\t\t// comments here.\n\t\tthis.options.margin1 = obj['margin1'];\n\t\tthis.options.margin2 = obj['margin2'];\n\t\tthis.options.leftOffset = obj['leftOffset'];\n\t\tthis.options.pageOffset = obj['pageOffset'];\n\n\t\t// pageWidth on the other hand *is* really in mm100.\n\t\tthis.options.pageWidth = obj['pageWidth'];\n\n\t\t// set top and bottom margin of page default to leftOffset.\n\t\t// this values only change based on which marker we drag on vertical ruler\n\t\tif (!this.options.pageTopMargin && !this.options.pageBottomMargin) {\n\t\t\tthis.options.pageTopMargin = this.options.leftOffset;\n\t\t\tthis.options.pageBottomMargin = this.options.leftOffset;\n\t\t}\n\n\t\tthis._rWrapper.style.visibility = '';\n\t\tthis._rWrapper.style.transform = 'rotate(90deg)';\n\t\tconst position: string =\n\t\t\tdocument.documentElement.dir === 'rtl' ? 'top right' : 'top left';\n\t\tthis._rWrapper.style.transformOrigin = position;\n\t\tthis._rWrapper.style.left = 'var(--ruler-height)';\n\t\tthis._updateBreakPoints();\n\t}\n\n\t_updateParagraphIndentations() {\n\t\t// if ruler is hidden no need to calculate the indentation of the para\n\t\tif (!this.options.showruler) return;\n\t\t// for horizontal Ruler we need to also consider height of navigation and toolbar-wrapper\n\t\tconst documentTop: number = document\n\t\t\t.getElementById('document-container')\n\t\t\t.getBoundingClientRect().top;\n\t\t// rTSContainer is the reference element.\n\t\tconst pStartPosition: number =\n\t\t\tthis._rTSContainer.getBoundingClientRect().top - documentTop;\n\t\tconst pEndPosition: number =\n\t\t\tthis._rTSContainer.getBoundingClientRect().bottom - documentTop;\n\n\t\t// We calculated the positions. Now we should move them to left in order to make their sharp edge point to the right direction..\n\t\tthis._pVerticalStartMarker.style.left =\n\t\t\tpStartPosition -\n\t\t\tthis._pVerticalStartMarker.getBoundingClientRect().width / 2 +\n\t\t\t'px';\n\t\tthis._pVerticalStartMarker.style.display = 'block';\n\t\tthis._pVerticalEndMarker.style.left =\n\t\t\tpEndPosition -\n\t\t\tthis._pVerticalEndMarker.getBoundingClientRect().width +\n\t\t\t'px';\n\t\tthis._pVerticalEndMarker.style.display = 'block';\n\n\t\t// we do similar operation as we do in Horizontal ruler\n\t\t// but this element rotated to 90deg so top of marker should be opposite to horizontal (Negative in this case)\n\t\tthis._markerHorizontalLine.style.top = '-100vw';\n\t\tthis._markerHorizontalLine.style.left =\n\t\t\tthis._pVerticalStartMarker.style.left;\n\t\tif (this.options.disableMarker) {\n\t\t\tthis._pVerticalStartMarker.style.display = 'none';\n\t\t\tthis._pVerticalEndMarker.style.display = 'none';\n\t\t}\n\t}\n\n\t_updateBreakPoints() {\n\t\tif (this.options.margin1 == null || this.options.margin2 == null) return;\n\n\t\tconst topMargin: number = this.options.leftOffset;\n\t\tconst docLayer = this._map._docLayer;\n\n\t\t// This is surely bogus. We take pageWidth, which is in mm100, and subtract a value\n\t\t// that is in \"arbitrary pixelish units\". But the only thing bottomMargin is used for is\n\t\t// to calculate the width of the part of the ruler that goes out over the right side\n\t\t// of the window anyway (see the assignments to this._bMarginMarker.style.width and\n\t\t// this._bMarginDrag.style.width near the end of this function), so presumably it\n\t\t// doesn't matter that much what bottomMargin is.\n\t\tconst bottomMargin: number =\n\t\t\tthis.options.pageWidth - (this.options.leftOffset + this.options.margin2);\n\t\tthis.options.pageBottomMargin = bottomMargin;\n\n\t\tconst scale: number = this._map.getZoomScale(this._map.getZoom(), 10);\n\t\tconst wPixel: number =\n\t\t\tdocLayer._docPixelSize.y / docLayer._pages -\n\t\t\tthis.options.tileMargin * 2 * scale;\n\n\t\tthis._fixOffset();\n\n\t\tthis.options.DraggableConvertRatio = wPixel / this.options.pageWidth;\n\t\tthis._rFace.style.width = wPixel + 'px';\n\t\tthis._rBPContainer.style.marginLeft =\n\t\t\t-1 * (this.options.DraggableConvertRatio * (500 - (topMargin % 1000))) +\n\t\t\t1 +\n\t\t\t'px';\n\n\t\tlet numCounter: number = -1 * Math.floor(topMargin / 1000);\n\n\t\tL.DomUtil.removeChildNodes(this._rBPContainer);\n\n\t\t// this.options.pageWidth is in mm100, so the code here makes one ruler division per\n\t\t// centimetre.\n\t\t//\n\t\t// FIXME: Surely this should be locale-specific, we would want to use inches at\n\t\t// least in the US. (The ruler unit to use doesn't seem to be stored in the document\n\t\t// at least for .odt?)\n\t\tfor (let num: number = 0; num <= this.options.pageWidth / 1000 + 1; num++) {\n\t\t\tconst marker = L.DomUtil.create(\n\t\t\t\t'div',\n\t\t\t\t'cool-ruler-maj',\n\t\t\t\tthis._rBPContainer,\n\t\t\t);\n\t\t\t// The - 1 is to compensate for the left and right .5px borders of\n\t\t\t// cool-ruler-maj in leaflet.css.\n\t\t\tmarker.style.width = this.options.DraggableConvertRatio * 1000 - 1 + 'px';\n\t\t\tif (this.options.displayNumber) {\n\t\t\t\tmarker.innerText = Math.abs(numCounter);\n\t\t\t\tnumCounter++;\n\t\t\t}\n\t\t}\n\n\t\tif (!this.options.marginSet) {\n\t\t\tthis.options.marginSet = true;\n\t\t\tthis._tMarginMarker = L.DomUtil.create(\n\t\t\t\t'div',\n\t\t\t\t'cool-ruler-margin cool-ruler-left',\n\t\t\t\tthis._rFace,\n\t\t\t);\n\t\t\tthis._bMarginMarker = L.DomUtil.create(\n\t\t\t\t'div',\n\t\t\t\t'cool-ruler-margin cool-ruler-right',\n\t\t\t\tthis._rFace,\n\t\t\t);\n\t\t\tthis._tMarginDrag = L.DomUtil.create(\n\t\t\t\t'div',\n\t\t\t\t'cool-ruler-drag cool-ruler-left',\n\t\t\t\tthis._rMarginWrapper,\n\t\t\t);\n\t\t\tthis._bMarginDrag = L.DomUtil.create(\n\t\t\t\t'div',\n\t\t\t\t'cool-ruler-drag cool-ruler-right',\n\t\t\t\tthis._rMarginWrapper,\n\t\t\t);\n\t\t\tconst topMarginTooltipText: string = _('Top Margin');\n\t\t\tconst bottomMarginTooltipText: string = _('Bottom Margin');\n\n\t\t\tthis._tMarginDrag.dataset.title = topMarginTooltipText;\n\t\t\tthis._bMarginDrag.dataset.title = bottomMarginTooltipText;\n\t\t}\n\n\t\tthis._tMarginMarker.style.width =\n\t\t\tthis.options.DraggableConvertRatio * topMargin + 'px';\n\t\tthis._bMarginMarker.style.width =\n\t\t\tthis.options.DraggableConvertRatio * bottomMargin + 'px';\n\t\tthis._tMarginDrag.style.width =\n\t\t\tthis.options.DraggableConvertRatio * topMargin + 'px';\n\t\tthis._bMarginDrag.style.width =\n\t\t\tthis.options.DraggableConvertRatio * bottomMargin + 'px';\n\n\t\t// Put the _rTSContainer in the right place\n\t\tthis._rTSContainer.style.left =\n\t\t\tthis.options.DraggableConvertRatio * topMargin + 'px';\n\t\tthis._rTSContainer.style.right =\n\t\t\tthis.options.DraggableConvertRatio * bottomMargin + 'px';\n\n\t\tthis._updateParagraphIndentations();\n\n\t\tif (this.options.interactive) {\n\t\t\tthis._changeInteractions({ detail: { perm: 'edit' } });\n\t\t} else {\n\t\t\tthis._changeInteractions({ detail: { perm: 'readonly' } });\n\t\t}\n\t}\n\n\t_fixOffset() {\n\t\t// in case of disabled ruler at docload or event like 'moveend' calculation of offset can be ignored\n\t\tif (!this._map.options.docBounds || !this.options.showruler) return;\n\n\t\t// we need to also consider  if there is more then 1 page then pageoffset is crucial to consider\n\t\t// i have calculated current page using pageoffset and pageWidth coming from CORE\n\t\t// based on that calculate the page offset\n\t\t// so if cursor moves to other page we will see how many pages before current page are there\n\t\t// and then add totalHeight of all those pages to our final calculation of rulerOffset\n\t\tconst currentPage: number = Math.floor(\n\t\t\tthis.options.pageOffset / this.options.pageWidth,\n\t\t);\n\t\tlet pageoffset: number = 0;\n\t\tif (this._map._docLayer._docPixelSize)\n\t\t\tpageoffset =\n\t\t\t\tcurrentPage *\n\t\t\t\t(this._map._docLayer._docPixelSize.y / this._map._docLayer._pages);\n\n\t\tconst rulerOffset: number =\n\t\t\t-app.file.viewedRectangle.cY1 +\n\t\t\tthis.options.tileMargin * app.getScale() +\n\t\t\tpageoffset;\n\n\t\tthis._rFace.style.marginInlineStart = rulerOffset + 'px';\n\n\t\tthis._updateParagraphIndentations();\n\t}\n\n\t_moveIndentation(e: any) {\n\t\tif (e.type === 'panmove') {\n\t\t\te.clientX = e.center.x;\n\t\t}\n\n\t\tconst element: HTMLElement = document.getElementById(\n\t\t\tthis._indentationElementId,\n\t\t);\n\t\t// for horizontal Ruler we need to also consider height of navigation and toolbar-wrapper\n\t\tconst documentTop = document\n\t\t\t.getElementById('document-container')\n\t\t\t.getBoundingClientRect().top;\n\n\t\t// User is moving the cursor / their finger on the screen and we are moving the marker.\n\t\tconst newLeft: number =\n\t\t\tparseInt(element.style.left.replace('px', '')) +\n\t\t\te.clientY -\n\t\t\tthis._lastposition -\n\t\t\tdocumentTop;\n\t\telement.style.left = String(newLeft) + 'px';\n\t\tthis._lastposition = e.clientY - documentTop;\n\t\t// halfWidth..\n\t\tconst halfWidth: number =\n\t\t\t(element.getBoundingClientRect().right -\n\t\t\t\telement.getBoundingClientRect().left) *\n\t\t\t0.5;\n\t\tthis._markerHorizontalLine.style.left = String(newLeft + halfWidth) + 'px';\n\t}\n\n\t_moveIndentationEnd(e: Event) {\n\t\tthis._map.rulerActive = false;\n\n\t\tif (e.type !== 'panend') {\n\t\t\tL.DomEvent.off(this._rFace, 'mousemove', this._moveIndentation, this);\n\t\t\tL.DomEvent.off(this._map, 'mouseup', this._moveIndentationEnd, this);\n\t\t}\n\n\t\t// Calculation step..\n\t\t// The new coordinate of element subject to indentation is sent as a percentage of the page width..\n\t\t// We need to calculate the percentage. Left margin (leftOffset) is not being added to the indentation (on the core part)..\n\t\t// We can use TabStopContainer's position as the reference point, as they share the same reference point..\n\t\tconst element: HTMLElement = document.getElementById(\n\t\t\tthis._indentationElementId,\n\t\t);\n\n\t\t// The halfWidth of the shape..\n\t\tconst halfWidth: number =\n\t\t\t(element.getBoundingClientRect().bottom -\n\t\t\t\telement.getBoundingClientRect().top) *\n\t\t\t0.5;\n\n\t\tconst params: Params = {};\n\t\tconst upperMargin: string = 'Space.Upper';\n\t\tconst lowerMargin: string = 'Space.Lower';\n\t\tif (\n\t\t\tthis._pVerticalStartMarker.getBoundingClientRect().top >\n\t\t\tthis._pVerticalEndMarker.getBoundingClientRect().top\n\t\t) {\n\t\t\t// do not change anything if Start marker goes beyond the end marker in that case we hold the last original postions or marker\n\t\t\tthis._fixOffset();\n\t\t} else if (element.id == 'lo-vertical-pstart-marker') {\n\t\t\tconst topMarginPX: number =\n\t\t\t\tthis._pVerticalStartMarker.getBoundingClientRect().top -\n\t\t\t\tthis._rTSContainer.getBoundingClientRect().top +\n\t\t\t\thalfWidth;\n\t\t\tconst top: number =\n\t\t\t\ttopMarginPX / this.options.DraggableConvertRatio +\n\t\t\t\tthis.options.pageTopMargin;\n\t\t\t// margin should not go above page top\n\t\t\tthis.options.pageTopMargin = top < 0 ? this.options.pageTopMargin : top;\n\t\t} else if (element.id == 'lo-vertical-pend-marker') {\n\t\t\tconst bottomMarginPX: number =\n\t\t\t\tthis._rTSContainer.getBoundingClientRect().bottom -\n\t\t\t\tthis._pVerticalEndMarker.getBoundingClientRect().bottom +\n\t\t\t\thalfWidth;\n\t\t\tconst bottom: number =\n\t\t\t\tbottomMarginPX / this.options.DraggableConvertRatio +\n\t\t\t\tthis.options.pageBottomMargin;\n\t\t\t// margin should not go below page bottom\n\t\t\tthis.options.pageBottomMargin =\n\t\t\t\tbottom < 0 ? this.options.pageBottomMargin : bottom;\n\t\t}\n\t\tparams[upperMargin] = {\n\t\t\ttype: 'long',\n\t\t\tvalue: this.options.pageTopMargin,\n\t\t};\n\t\tparams[lowerMargin] = {\n\t\t\ttype: 'long',\n\t\t\tvalue: this.options.pageBottomMargin,\n\t\t};\n\t\tthis._map.sendUnoCommand('.uno:SetLongTopBottomMargin', params);\n\n\t\tthis._indentationElementId = '';\n\t\tthis._markerHorizontalLine.style.display = 'none';\n\t}\n\n\t_initiateIndentationDrag(e: any) {\n\t\tif (\n\t\t\tthis.getWindowProperty<boolean>('ThisIsTheiOSApp') &&\n\t\t\t!this._map.isEditMode()\n\t\t)\n\t\t\treturn;\n\n\t\tthis._map.rulerActive = true;\n\n\t\tthis._indentationElementId =\n\t\t\te.target.id.trim() === '' ? e.target.parentNode.id : e.target.id;\n\n\t\tif (e.type !== 'panstart') {\n\t\t\tL.DomEvent.on(this._rFace, 'mousemove', this._moveIndentation, this);\n\t\t\tL.DomEvent.on(this._map, 'mouseup', this._moveIndentationEnd, this);\n\t\t} else {\n\t\t\te.clientX = e.center.x;\n\t\t}\n\t\t// for horizontal Ruler we need to also consider height of navigation and toolbar-wrapper\n\t\tconst documentTop: number = document\n\t\t\t.getElementById('document-container')\n\t\t\t.getBoundingClientRect().top;\n\n\t\tthis._initialposition = this._lastposition = e.clientY - documentTop;\n\t\tthis._markerHorizontalLine.style.display = 'block';\n\t\tthis._markerHorizontalLine.style.left = this._lastposition + 'px';\n\t}\n}\n"]}