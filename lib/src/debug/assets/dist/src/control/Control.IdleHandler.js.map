{"version":3,"file":"Control.IdleHandler.js","sourceRoot":"","sources":["../../../../../../../../../../TanhX/online/browser/src/control/Control.IdleHandler.ts"],"names":[],"mappings":"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","sourcesContent":["// @ts-strict-ignore\n/* -*- js-indent-level: 8 -*- */\n\n/*\n * Copyright the Collabora Online contributors.\n *\n * SPDX-License-Identifier: MPL-2.0\n *\n * This Source Code Form is subject to the terms of the Mozilla Public\n * License, v. 2.0. If a copy of the MPL was not distributed with this\n * file, You can obtain one at http://mozilla.org/MPL/2.0/.\n */\n/*\n * Class for idle handling of the view.\n */\n\n/* global app L TileManager */\n\ndeclare var mode: any;\ndeclare var ThisIsTheAndroidApp: any;\ndeclare var postMobileMessage: any;\ndeclare var idleTimeoutSecs: number;\ndeclare var outOfFocusTimeoutSecs: number;\n\n/**/\n\napp.idleHandlerId = 'inactive_user_message';\n\nclass IdleHandler {\n    _serverRecycling: boolean = false;\n    _documentIdle: boolean = false;\n\t_lastActivity: number = Date.now();\n\t_inactivityTimer: ReturnType<typeof setTimeout> = null;\n\t_outOfFocusTimer: ReturnType<typeof setTimeout> = null;\n    _active: boolean = true;\n    map: any;\n\tdimId: string = app.idleHandlerId;\n\n\tgetIdleMessage(): string {\n\t\tif (this.map['wopi'] && this.map['wopi'].DisableInactiveMessages) {\n\t\t\treturn '';\n\t\t} else if (window.mode.isDesktop()) {\n\t\t\treturn _('Idle document - please click to reload and resume editing');\n\t\t} else {\n\t\t\treturn _('Idle document - please tap to reload and resume editing');\n\t\t}\n\t}\n\n\tisDimActive(): boolean {\n\t\treturn !!document.getElementById(this.map.uiManager.generateModalId(this.dimId));\n\t}\n\n\t// time from the last activity in [s]\n\tgetElapsedFromActivity(): number {\n\t\treturn (Date.now() - this._lastActivity) / 1000;\n\t}\n\n\trefreshAnnotations() {\n\t\tvar docLayer = this.map._docLayer;\n\t\tif (docLayer.isCalc() && docLayer.options.sheetGeometryDataEnabled) {\n\t\t\tdocLayer.requestSheetGeometryData();\n\t\t}\n\t\tapp.socket.sendMessage('commandvalues command=.uno:ViewAnnotations');\n\t}\n\n\t_activate() {\n\t\twindow.app.console.debug('IdleHandler: _activate()');\n\n\t\tif (this._serverRecycling || this._documentIdle) {\n\t\t\treturn false;\n\t\t}\n\n\t\tthis._startInactiveTimer();\n\t\tthis._stopOutOfFocusTimer();\n\n\t\tif (!this._active) {\n\t\t\t// Only activate when we are connected.\n\t\t\tif (app.socket.connected()) {\n\t\t\t\tapp.socket.sendMessage('useractive');\n\t\t\t\tthis._active = true;\n\n\t\t\t\t/*\n\t\t\t\t  If we have the docLayer then refresh annotations now. If not then\n\t\t\t\t  postpone until we do have the docLayer so we know if this is calc\n\t\t\t\t  or not, because for calc we have to ensure we have the sheet\n\t\t\t\t  geometry before requesting annotations otherwise we will lack the\n\t\t\t\t  requirements to position them.\n\t\t\t\t*/\n\t\t\t\tif (this.map._docLayer) {\n\t\t\t\t\tthis.map._docLayer.allowDrawing();\n\t\t\t\t\tthis.refreshAnnotations();\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tthis.map.once('doclayerinit', this.refreshAnnotations, this);\n\t\t\t\t}\n\n\t\t\t\tif (this.isDimActive()) {\n\t\t\t\t\tthis.map.jsdialog.closeDialog(this.dimId, false);\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tthis.map.loadDocument();\n\t\t\t}\n\t\t}\n\n\t\t// Ideally instead of separate isAnyEdit check here, we could check isAnyEdit inside isAnyDialogOpen,\n\t\t// but unfortunatly that causes problem in _deactivate and unnecessary 'userinactive' message is sent\n\t\tif (window.mode.isDesktop()\n\t\t&& !this.map.uiManager.isAnyDialogOpen()\n\t\t&& !cool.Comment.isAnyEdit()\n\t\t&& (this.map.formulabar && !this.map.formulabar.hasFocus())\n\t\t&& $('input:focus').length === 0) {\n\t\t\tthis.map.focus();\n\t\t}\n\n\t\treturn false;\n\t}\n\n\t_startInactiveTimer() {\n\t\tif (this._serverRecycling || this._documentIdle || !this.map._docLoaded) {\n\t\t\treturn;\n\t\t}\n\n\t\tclearTimeout(this._inactivityTimer);\n\n\t\tthis._inactivityTimer = setTimeout(() => {\n\t\t\tthis._dimIfInactive();\n\t\t}, (L.Browser.cypressTest ? 1000 : 1 * 60 * 1000)); // Check once a minute\n\t}\n\n\t_startOutOfFocusTimer() {\n\t\tif (this._serverRecycling || this._documentIdle || !this.map._docLoaded) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis._stopOutOfFocusTimer();\n\n\t\tthis._outOfFocusTimer = setTimeout(() => {\n\t\t\tthis._dim();\n\t\t}, window.outOfFocusTimeoutSecs * 1000);\n\t}\n\n\t_stopOutOfFocusTimer() {\n\t\tclearTimeout(this._outOfFocusTimer);\n\t}\n\n\t_dimIfInactive() {\n\t\tif (this.map._docLoaded && (this.getElapsedFromActivity() >= window.idleTimeoutSecs)) {\n\t\t\tthis._dim();\n\t\t} else {\n\t\t\tthis._startInactiveTimer();\n\t\t}\n\t}\n\n\t_dim() {\n\t\tif (this.map.slideShowPresenter && this.map.slideShowPresenter._checkAlreadyPresenting())\n\t\t\treturn; // do not stop presentation\n\n\t\tthis.map.fire('closealldialogs');\n\t\tconst message = this.getIdleMessage();\n\n\t\twindow.app.console.debug('IdleHandler: _dim()');\n\n\t\tif (document.getElementById(this.dimId))\n\t\t\treturn;\n\n\t\tthis._active = false;\n\t\tvar map = this.map;\n\n\t\tvar restartConnectionFn = () => {\n\t\t\tif (app.idleHandler._documentIdle)\n\t\t\t{\n\t\t\t\twindow.app.console.debug('idleness: reactivating');\n\t\t\t\tmap.fire('postMessage', {msgId: 'User_Active'});\n\t\t\t\tapp.idleHandler._documentIdle = false;\n\t\t\t\tapp.setCursorVisibility(true);\n\t\t\t}\n\t\t\treturn app.idleHandler._activate();\n\t\t};\n\n\t\tthis.map._textInput.hideCursor();\n\n\t\tconst uiManager = this.map.uiManager;\n\t\tconst dialogId = uiManager.generateModalId(this.dimId);\n\t\tuiManager.showInfoModal(this.dimId);\n\n\t\tapp.layoutingService.appendLayoutingTask(() => {\n\t\t\tconst dimNode = document.getElementById(this.dimId);\n\t\t\tif (!dimNode)\n\t\t\t\treturn;\n\n\t\t\tdimNode.textContent = message;\n\n\t\t\tconst restartConnection = () => { restartConnectionFn(); };\n\n\t\t\tif (message === '') {\n\t\t\t\tconst dialogNode = document.getElementById(dialogId);\n\t\t\t\tif (dialogNode) dialogNode.style.display = 'none';\n\t\t\t\tapp.LOUtil.onRemoveHTMLElement(dimNode, restartConnection);\n\t\t\t} else {\n\t\t\t\tconst overlayId = dialogId + '-overlay';\n\t\t\t\tconst overlay = document.getElementById(overlayId);\n\t\t\t\tif (overlay) overlay.onmouseover = () => { restartConnection(); uiManager.closeModal(dialogId); };\n\t\t\t\tapp.LOUtil.onRemoveHTMLElement(overlay, restartConnection);\n\t\t\t}\n\t\t});\n\n\t\tthis._sendInactiveMessage();\n\n\t\tTileManager.clearPreFetch();\n\t}\n\n\tnotifyActive() {\n\t\tthis._lastActivity = Date.now();\n\n\t\tif (window.ThisIsTheAndroidApp) {\n\t\t\twindow.postMobileMessage('LIGHT_SCREEN');\n\t\t}\n\t}\n\n\t_sendInactiveMessage() {\n\t\tthis.map._doclayer && this.map._docLayer._onMessage('textselection:', null);\n\t\tthis.map.fire('postMessage', {msgId: 'User_Idle'});\n\t\tif (app.socket.connected()) {\n\t\t\tapp.socket.sendMessage('userinactive');\n\t\t}\n\t}\n\n\t_deactivate() {\n\t\twindow.app.console.debug('IdleHandler: _deactivate()');\n\n\t\tif (this._serverRecycling || this._documentIdle || !this.map._docLoaded) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (window.mode.isDesktop() && (!this._active || this.isDimActive())) {\n\t\t\t// A dialog is already dimming the screen and probably\n\t\t\t// shows an error message. Leave it alone.\n\t\t\tthis._active = false;\n\t\t\tthis._sendInactiveMessage();\n\n\t\t\treturn;\n\t\t}\n\n\t\tif (app.map && app.map.formulabar &&\n\t\t\t(app.map.formulabar.hasFocus() || app.map.formulabar.isInEditMode()))\n\t\t\tapp.dispatcher.dispatch('acceptformula'); // save data from the edited cell on exit\n\n\t\tthis._startOutOfFocusTimer();\n\t}\n}\n\n// Initiate the class.\napp.idleHandler = new IdleHandler();\n"]}