{"version":3,"file":"Control.Sidebar.js","sourceRoot":"","sources":["../../../../../../../../../../TanhX/online/browser/src/control/Control.Sidebar.ts"],"names":[],"mappings":"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","sourcesContent":["// @ts-strict-ignore\n/* -*- js-indent-level: 8 -*- */\n/*\n * Copyright the Collabora Online contributors.\n *\n * SPDX-License-Identifier: MPL-2.0\n *\n * This Source Code Form is subject to the terms of the Mozilla Public\n * License, v. 2.0. If a copy of the MPL was not distributed with this\n * file, You can obtain one at http://mozilla.org/MPL/2.0/.\n */\n/*\n * JSDialog.Sidebar\n */\n\n// /* global app */\nclass Sidebar extends SidebarBase {\n\ttargetDeckCommand: string;\n\tisUserRequest: boolean; /// automatic or user request to show the sidebar\n\n\tconstructor(\n\t\tmap: any,\n\t\toptions: SidebarOptions = {\n\t\t\tanimSpeed: 1000,\n\t\t} /* Default speed: to be used on load */,\n\t) {\n\t\tsuper(map, options, SidebarType.Sidebar);\n\t\tthis.isUserRequest = true;\n\t}\n\n\tonAdd(map: ReturnType<typeof L.map>) {\n\t\tsuper.onAdd(map);\n\t\tthis.map.on('sidebar', this.onSidebar, this);\n\t}\n\n\tonRemove() {\n\t\tsuper.onRemove();\n\t\tthis.map.off('sidebar');\n\t}\n\n\tsetAsInitialized() {\n\t\tthis.isUserRequest = false;\n\t}\n\n\tupdateSidebarPrefs(currentDeck: string) {\n\t\tconst decks = [\n\t\t\t'PropertyDeck',\n\t\t\t'SdSlideTransitionDeck',\n\t\t\t'SdCustomAnimationDeck',\n\t\t\t'SdMasterPagesDeck',\n\t\t\t'NavigatorDeck',\n\t\t\t'StyleListDeck',\n\t\t\t'A11yCheckDeck',\n\t\t];\n\n\t\tconst deckPref: { [key: string]: string } = {};\n\t\tdecks.forEach((deck: string) => {\n\t\t\tdeckPref[deck] = currentDeck === deck ? 'true' : 'false';\n\t\t});\n\t\tthis.map.uiManager.setDocTypeMultiplePrefs(deckPref);\n\t}\n\n\tcommandForDeck(deckId: string): string {\n\t\tif (deckId === 'PropertyDeck') return '.uno:SidebarDeck.PropertyDeck';\n\t\telse if (deckId === 'SdSlideTransitionDeck')\n\t\t\treturn '.uno:SlideChangeWindow';\n\t\telse if (deckId === 'SdCustomAnimationDeck') return '.uno:CustomAnimation';\n\t\telse if (deckId === 'SdMasterPagesDeck') return '.uno:MasterSlidesPanel';\n\t\telse if (deckId === 'NavigatorDeck') return '.uno:Navigator';\n\t\telse if (deckId === 'StyleListDeck')\n\t\t\treturn '.uno:SidebarDeck.StyleListDeck';\n\t\telse if (deckId === 'A11yCheckDeck')\n\t\t\treturn '.uno:SidebarDeck.A11yCheckDeck';\n\t\treturn '';\n\t}\n\n\tsetupTargetDeck(unoCommand: string) {\n\t\tthis.targetDeckCommand = unoCommand;\n\t}\n\n\tgetTargetDeck(): string {\n\t\treturn this.targetDeckCommand;\n\t}\n\n\tchangeDeck(unoCommand: string | null) {\n\t\tif (unoCommand !== null && unoCommand !== undefined)\n\t\t\tapp.socket.sendMessage('uno ' + unoCommand);\n\t\tthis.setupTargetDeck(unoCommand);\n\t}\n\n\tonSidebar(data: FireEvent) {\n\t\tvar sidebarData = data.data;\n\t\tthis.builder.setWindowId(sidebarData.id);\n\t\t$(this.container).empty();\n\n\t\tif (\n\t\t\tsidebarData.action === 'close' ||\n\t\t\twindow.app.file.disableSidebar ||\n\t\t\tthis.map.isReadOnlyMode()\n\t\t) {\n\t\t\tthis.closeSidebar();\n\t\t} else if (sidebarData.children) {\n\t\t\tfor (var i = sidebarData.children.length - 1; i >= 0; i--) {\n\t\t\t\tif (sidebarData.children[i].type !== 'deck') {\n\t\t\t\t\tsidebarData.children.splice(i, 1);\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tif (\n\t\t\t\t\ttypeof sidebarData.children[i].id === 'string' &&\n\t\t\t\t\tsidebarData.children[i].id.startsWith('Navigator')\n\t\t\t\t) {\n\t\t\t\t\tthis.markNavigatorTreeView(sidebarData);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (sidebarData.children.length) {\n\t\t\t\tthis.onResize();\n\n\t\t\t\tif (\n\t\t\t\t\tsidebarData.children &&\n\t\t\t\t\tsidebarData.children[0] &&\n\t\t\t\t\tsidebarData.children[0].id\n\t\t\t\t) {\n\t\t\t\t\tvar currentDeck = sidebarData.children[0].id;\n\t\t\t\t\tthis.updateSidebarPrefs(currentDeck);\n\t\t\t\t\tif (this.targetDeckCommand) {\n\t\t\t\t\t\tvar stateHandler = this.map['stateChangeHandler'];\n\t\t\t\t\t\tvar isCurrent = stateHandler\n\t\t\t\t\t\t\t? stateHandler.getItemValue(this.targetDeckCommand)\n\t\t\t\t\t\t\t: false;\n\t\t\t\t\t\t// just to be sure check with other method\n\t\t\t\t\t\tif (isCurrent === 'false' || !isCurrent)\n\t\t\t\t\t\t\tisCurrent =\n\t\t\t\t\t\t\t\tthis.targetDeckCommand === this.commandForDeck(currentDeck);\n\t\t\t\t\t\tif (this.targetDeckCommand && (isCurrent === 'false' || !isCurrent))\n\t\t\t\t\t\t\tthis.changeDeck(this.targetDeckCommand);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis.changeDeck(this.targetDeckCommand);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tthis.builder.build(this.container, [sidebarData]);\n\t\t\t\tif (!this.isVisible()) {\n\t\t\t\t\t$('#sidebar-dock-wrapper').addClass('visible');\n\n\t\t\t\t\t// schedule focus after animation so it will not shift the browser page\n\t\t\t\t\tif (this.isUserRequest) {\n\t\t\t\t\t\tsetTimeout(() => {\n\t\t\t\t\t\t\tapp.layoutingService.appendLayoutingTask(() => {\n\t\t\t\t\t\t\t\tconst focusables = JSDialog.GetFocusableElements(\n\t\t\t\t\t\t\t\t\tthis.container,\n\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\tif (focusables && focusables.length) {\n\t\t\t\t\t\t\t\t\tfocusables[0].focus();\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}, 250); // see animation time in #sidebar-dock-wrapper.visible\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tthis.map.uiManager.setDocTypePref('ShowSidebar', true);\n\t\t\t} else {\n\t\t\t\tthis.closeSidebar();\n\t\t\t}\n\n\t\t\tthis.isUserRequest = true;\n\t\t}\n\t}\n}\n\nJSDialog.Sidebar = function (map: any, options: SidebarOptions) {\n\treturn new Sidebar(map, options);\n};\n"]}