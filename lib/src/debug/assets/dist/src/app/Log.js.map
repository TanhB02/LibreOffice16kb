{"version":3,"file":"Log.js","sourceRoot":"","sources":["../../../../../../../../../../TanhX/online/browser/src/app/Log.ts"],"names":[],"mappings":"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","sourcesContent":["// @ts-strict-ignore\n/* -*- js-indent-level: 8 -*- */\n/*\n * Copyright the Collabora Online contributors.\n *\n * SPDX-License-Identifier: MPL-2.0\n *\n * This Source Code Form is subject to the terms of the Mozilla Public\n * License, v. 2.0. If a copy of the MPL was not distributed with this\n * file, You can obtain one at http://mozilla.org/MPL/2.0/.\n *\n * Logger contains methods for logging the activity\n */\n\ntype Direction = 'INCOMING' | 'OUTGOING';\ninterface LogMsg {\n\tmsg: string;\n\tdirection: Direction;\n\ttime: number;\n}\n\nclass Logger {\n\tprivate _logs: LogMsg[];\n\tprivate startTime: number;\n\n\tconstructor() {\n\t\tthis._logs = [];\n\t\tthis.startTime = null;\n\t}\n\n\tpublic log(msg: string, direction: Direction): void {\n\t\tconst time = Date.now();\n\t\tif (!this.startTime) this.startTime = time;\n\n\t\t// Limit memory usage of log by only keeping the latest entries\n\t\tlet maxEntries = 100;\n\t\tif ((window as any).enableDebug) maxEntries = 1000;\n\n\t\tif (time - this.startTime < 60 * 1000 /* ms */) maxEntries = 500; // enough to capture early start.\n\t\twhile (this._logs.length > maxEntries) this._logs.shift();\n\n\t\t// Limit memory usage of log by limiting length of message\n\t\tconst maxMsgLen = 128;\n\t\tif (msg.length > maxMsgLen) msg = msg.substring(0, maxMsgLen);\n\t\tmsg = msg.replace(/(\\r\\n|\\n|\\r)/gm, ' ');\n\t\tthis._logs.push({ msg: msg, direction: direction, time: time });\n\t}\n\n\tprivate _getEntries(): string {\n\t\tthis._logs.sort(function (a, b) {\n\t\t\tif (a.time < b.time) {\n\t\t\t\treturn -1;\n\t\t\t}\n\t\t\tif (a.time > b.time) {\n\t\t\t\treturn 1;\n\t\t\t}\n\t\t\treturn 0;\n\t\t});\n\t\tlet data: string = '';\n\t\tfor (let i = 0; i < this._logs.length; i++) {\n\t\t\tdata +=\n\t\t\t\tthis._logs[i].time +\n\t\t\t\t'.' +\n\t\t\t\tthis._logs[i].direction +\n\t\t\t\t'.' +\n\t\t\t\tthis._logs[i].msg;\n\t\t\tdata += '\\n';\n\t\t}\n\t\treturn data;\n\t}\n\n\tpublic print(): void {\n\t\twindow.app.console.log('Queued log messages:');\n\t\twindow.app.console.log(this._getEntries());\n\t\twindow.app.console.log('End of queued log messages:');\n\t}\n\n\tpublic save(): void {\n\t\tconst blob = new Blob([this._getEntries()], { type: 'text/csv' });\n\t\tconst a = document.createElement('a');\n\n\t\ta.download = Date.now() + '.csv';\n\t\ta.href = window.URL.createObjectURL(blob);\n\t\ta.dataset.downloadurl = ['text/csv', a.download, a.href].join(':');\n\n\t\tconst e = new MouseEvent('click', {\n\t\t\tbubbles: true,\n\t\t\tcancelable: false,\n\t\t\tview: window,\n\t\t\tdetail: 0,\n\t\t\tscreenX: 0,\n\t\t\tscreenY: 0,\n\t\t\tclientX: 0,\n\t\t\tclientY: 0,\n\t\t\tctrlKey: false,\n\t\t\taltKey: false,\n\t\t\tshiftKey: false,\n\t\t\tmetaKey: false,\n\t\t\tbutton: 0,\n\t\t\trelatedTarget: null,\n\t\t});\n\t\ta.dispatchEvent(e);\n\t}\n\n\tpublic clear(): void {\n\t\tthis._logs = [];\n\t}\n}\n\napp.Log = new Logger();\n"]}