{"version":3,"file":"SearchService.js","sourceRoot":"","sources":["../../../../../../../../../../TanhX/online/browser/src/app/SearchService.ts"],"names":[],"mappings":"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","sourcesContent":["/* -*- js-indent-level: 8; fill-column: 100 -*- */\n\n/*\n * Copyright the Collabora Online contributors.\n *\n * SPDX-License-Identifier: MPL-2.0\n *\n * This Source Code Form is subject to the terms of the Mozilla Public\n * License, v. 2.0. If a copy of the MPL was not distributed with this\n * file, You can obtain one at http://mozilla.org/MPL/2.0/.\n */\n\nclass SearchService {\n\t// TODO: avoid L.DomUtil.get(...)\n\n\tpublic searchNext() {\n\t\tthis.search(L.DomUtil.get('search-input').value, false);\n\t}\n\n\tpublic searchPrevious() {\n\t\tthis.search(L.DomUtil.get('search-input').value, true);\n\t}\n\n\tpublic search(\n\t\ttext: string,\n\t\tbackward?: boolean,\n\t\treplaceString?: string,\n\t\tcommand?: number,\n\t\texpand?: boolean,\n\t) {\n\t\tif (backward === undefined) {\n\t\t\tbackward = false;\n\t\t}\n\t\tif (command === undefined) {\n\t\t\tcommand = 0;\n\t\t}\n\t\tif (replaceString === undefined) {\n\t\t\treplaceString = '';\n\t\t}\n\t\tif (\n\t\t\tL.Map.THIS._docLayer._searchResults &&\n\t\t\ttext !== L.Map.THIS._docLayer._searchTerm\n\t\t) {\n\t\t\tL.Map.THIS._docLayer._clearSearchResults();\n\t\t}\n\n\t\tvar searchCmd = {\n\t\t\t'SearchItem.SearchString': {\n\t\t\t\ttype: 'string',\n\t\t\t\tvalue: undefined as any,\n\t\t\t},\n\t\t\t'SearchItem.ReplaceString': {\n\t\t\t\ttype: 'string',\n\t\t\t\tvalue: undefined as any,\n\t\t\t},\n\t\t\t'SearchItem.Backward': {\n\t\t\t\ttype: 'boolean',\n\t\t\t\tvalue: undefined as any,\n\t\t\t},\n\t\t\t'SearchItem.SearchStartPointX': {\n\t\t\t\ttype: 'long',\n\t\t\t\tvalue: undefined as any,\n\t\t\t},\n\t\t\t'SearchItem.SearchStartPointY': {\n\t\t\t\ttype: 'long',\n\t\t\t\tvalue: undefined as any,\n\t\t\t},\n\t\t\t'SearchItem.Command': {\n\t\t\t\ttype: 'long',\n\t\t\t\tvalue: undefined as any,\n\t\t\t},\n\t\t};\n\n\t\tL.Map.THIS.fire('clearselection');\n\n\t\tvar searchStartPointX = app.file.viewedRectangle.x1;\n\t\tvar searchStartPointY = app.file.viewedRectangle.y1;\n\t\tif (\n\t\t\tL.Map.THIS._docLayer &&\n\t\t\tL.Map.THIS._docLayer._lastSearchResult &&\n\t\t\texpand\n\t\t) {\n\t\t\tvar strTwips =\n\t\t\t\tL.Map.THIS._docLayer._lastSearchResult.twipsRectangles.match(/\\d+/g);\n\t\t\tif (strTwips != null) {\n\t\t\t\tsearchStartPointX = strTwips[0];\n\t\t\t\tsearchStartPointY = strTwips[1];\n\t\t\t}\n\t\t\tthis.resetSelection();\n\t\t}\n\n\t\tsearchCmd['SearchItem.SearchString'].value = text;\n\t\tsearchCmd['SearchItem.Backward'].value = backward;\n\t\tsearchCmd['SearchItem.ReplaceString'].value = replaceString;\n\t\tsearchCmd['SearchItem.SearchStartPointX'].value = searchStartPointX;\n\t\tsearchCmd['SearchItem.SearchStartPointY'].value = searchStartPointY;\n\t\tsearchCmd['SearchItem.Command'].value = command;\n\t\tapp.socket.sendMessage(\n\t\t\t'uno .uno:ExecuteSearch ' + JSON.stringify(searchCmd),\n\t\t);\n\t}\n\n\tpublic highlightAll(text: string) {\n\t\tif (\n\t\t\tL.Map.THIS._docLayer._searchResults &&\n\t\t\ttext === L.Map.THIS._docLayer._searchTerm\n\t\t) {\n\t\t\treturn;\n\t\t}\n\t\tthis.search(text, false, '1');\n\t}\n\n\tpublic resetSelection() {\n\t\tL.Map.THIS._docLayer._clearSearchResults();\n\t\tapp.socket.sendMessage('resetselection');\n\t}\n}\n\napp.searchService = new SearchService();\n"]}