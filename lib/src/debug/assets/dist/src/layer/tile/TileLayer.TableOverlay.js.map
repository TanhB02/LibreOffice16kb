{"version":3,"file":"TileLayer.TableOverlay.js","sourceRoot":"","sources":["../../../../../../../../../../../TanhX/online/browser/src/layer/tile/TileLayer.TableOverlay.js"],"names":[],"mappings":"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","sourcesContent":["/* -*- js-indent-level: 8 -*- */\n/*\n * Copyright the Collabora Online contributors.\n *\n * SPDX-License-Identifier: MPL-2.0\n *\n * This Source Code Form is subject to the terms of the Mozilla Public\n * License, v. 2.0. If a copy of the MPL was not distributed with this\n * file, You can obtain one at http://mozilla.org/MPL/2.0/.\n */\n/*\n * Table Overlay\n */\n\n/* global app ShapeHandleAnchorSubSection */\n\nL.CanvasTileLayer.include({\n\t_initializeTableOverlay: function () {\n\t\tthis._tableColumnMarkers = [];\n\t\tthis._tableRowMarkers = [];\n\t\tthis._tableMarkersDragged = false;\n\t\tthis._tableSelectionColumnMarkers = [];\n\t\tthis._tableSelectionRowMarkers = [];\n\t\tthis._selectionHeaderDistanceFromTable = 6;\n\t\tthis._selectionHeaderHeight = 16;\n\t},\n\t_setupTableOverlay: function() {\n\t\tthis._map.on('messagesdone', this._updateTableMarkers, this);\n\t\tthis._map.on('zoomend', this._onZoomForTableMarkers, this);\n\t},\n\t_convertPixelToTwips: function(pixel) {\n\t\tvar point = this._latLngToTwips(this._map.unproject(new L.Point(pixel, 0)));\n\t\treturn point.x;\n\t},\n\t_convertTwipsToPixels: function(twips) {\n\t\tvar point = this._twipsToLatLng(twips);\n\t\tpoint = this._map.project(point);\n\t\treturn point;\n\t},\n\thasTableSelection: function () {\n\t\tif (!this._currentTableData)\n\t\t\treturn false;\n\t\treturn this._currentTableData.rows != null || this._currentTableData.columns != null;\n\t},\n\t_setMarkerPosition: function(marker) {\n\t\tvar point = this._twipsToLatLng(marker._positionTwips, this._map.getZoom());\n\t\tpoint = this._map.project(point);\n\t\tvar markerRect = marker._icon.getBoundingClientRect();\n\n\t\tvar raiseDelta;\n\t\tvar aboveSelectionHeaders = this._selectionHeaderDistanceFromTable + this._selectionHeaderHeight;\n\t\taboveSelectionHeaders = this._convertPixelToTwips(aboveSelectionHeaders);\n\n\t\tif (marker._type.startsWith('column')) {\n\t\t\tpoint = point.subtract(new L.Point(markerRect.width / 2, markerRect.height));\n\t\t\traiseDelta = new L.Point(0, aboveSelectionHeaders);\n\t\t}\n\t\telse {\n\t\t\tpoint = point.subtract(new L.Point(markerRect.width, markerRect.height / 2));\n\t\t\traiseDelta = new L.Point(aboveSelectionHeaders, 0);\n\t\t}\n\n\t\traiseDelta = this._map.project(this._twipsToLatLng(raiseDelta, this._map.getZoom()));\n\t\tpoint = point.subtract(raiseDelta);\n\n\t\tpoint = this._map.unproject(point);\n\t\tmarker.setLatLng(point);\n\n\t\tif (marker._type.startsWith('column'))\n\t\t\tmarker.dragging.freezeY(true);\n\t\telse\n\t\t\tmarker.dragging.freezeX(true);\n\t},\n\t_createMarker: function(markerType, entry, left, right) {\n\t\tvar className;\n\t\tif (markerType === 'column')\n\t\t\tclassName = 'table-column-resize-marker';\n\t\telse\n\t\t\tclassName = 'table-row-resize-marker';\n\n\t\tvar marker = L.marker(new L.LatLng(0, 0), {\n\t\t\ticon: L.divIcon({\n\t\t\t\tclassName: className,\n\t\t\t\ticonSize: null\n\t\t\t}),\n\t\t\tdraggable: true\n\t\t});\n\t\tthis._map.addLayer(marker);\n\t\tmarker._type = markerType + '-' + entry.type;\n\t\tmarker._position = parseInt(entry.position);\n\t\tmarker._initialPosition = marker._position;\n\t\tmarker._min = parseInt(entry.min);\n\t\tmarker._max = parseInt(entry.max);\n\t\tmarker._index = parseInt(entry.index);\n\t\tif (markerType === 'column') {\n\t\t\tmarker._positionTwips = new L.Point(this._tablePositionColumnOffset + marker._position, left);\n\t\t\tmarker._topBorderPoint = new L.Point(this._tablePositionColumnOffset + marker._position, left);\n\t\t\tmarker._topBorderPoint = this._twipsToLatLng(marker._topBorderPoint, this._map.getZoom());\n\t\t\tmarker._bottomBorderPoint = new L.Point(this._tablePositionColumnOffset + marker._position, right);\n\t\t\tmarker._bottomBorderPoint = this._twipsToLatLng(marker._bottomBorderPoint, this._map.getZoom());\n\t\t}\n\t\telse {\n\t\t\tmarker._positionTwips = new L.Point(left, this._tablePositionRowOffset + marker._position);\n\t\t\tmarker._topBorderPoint = new L.Point(left, this._tablePositionRowOffset + marker._position);\n\t\t\tmarker._topBorderPoint = this._twipsToLatLng(marker._topBorderPoint, this._map.getZoom());\n\t\t\tmarker._bottomBorderPoint = new L.Point(right, this._tablePositionRowOffset + marker._position);\n\t\t\tmarker._bottomBorderPoint = this._twipsToLatLng(marker._bottomBorderPoint, this._map.getZoom());\n\t\t}\n\t\tthis._setMarkerPosition(marker);\n\t\tmarker.on('dragstart drag dragend', this._onTableBorderResizeMarkerDrag, this);\n\t\treturn marker;\n\t},\n\t_addMoveMarker() {\n\t\tlet x = parseInt(this._currentTableData.rectangle.x);\n\t\tlet y = parseInt(this._currentTableData.rectangle.y);\n\n\t\tconst anchorSize = ShapeHandleAnchorSubSection.tableAnchorIconSize;\n\n\t\tx -= Math.round(anchorSize[0] * app.pixelsToTwips);\n\t\ty -= Math.round(anchorSize[1] * app.pixelsToTwips);\n\n\t\tthis._tableAnchorSection = new app.definitions.shapeHandleAnchorSubSection(null, 'table-anchor', anchorSize, new app.definitions.simplePoint(x, y), null);\n\t\tapp.sectionContainer.addSection(this._tableAnchorSection);\n\t},\n\t_removeMoveMarker() {\n\t\tif (this._tableAnchorSection)\n\t\t\tapp.sectionContainer.removeSection(this._tableAnchorSection.name);\n\t},\n\t_clearTableMarkers: function() {\n\t\tvar markerIndex;\n\t\tfor (markerIndex = 0; markerIndex < this._tableColumnMarkers.length; markerIndex++) {\n\t\t\tthis._map.removeLayer(this._tableColumnMarkers[markerIndex]);\n\t\t}\n\t\tthis._tableColumnMarkers = [];\n\n\t\tfor (markerIndex = 0; markerIndex < this._tableRowMarkers.length; markerIndex++) {\n\t\t\tthis._map.removeLayer(this._tableRowMarkers[markerIndex]);\n\t\t}\n\t\tthis._tableRowMarkers = [];\n\n\t\tfor (markerIndex = 0; markerIndex < this._tableSelectionColumnMarkers.length; markerIndex++) {\n\t\t\tthis._map.removeLayer(this._tableSelectionColumnMarkers[markerIndex]);\n\t\t}\n\t\tthis._tableSelectionColumnMarkers = [];\n\n\t\tfor (markerIndex = 0; markerIndex < this._tableSelectionRowMarkers.length; markerIndex++) {\n\t\t\tthis._map.removeLayer(this._tableSelectionRowMarkers[markerIndex]);\n\t\t}\n\t\tthis._tableSelectionRowMarkers = [];\n\n\t\tthis._removeMoveMarker();\n\t},\n\n\t_updateTableMoveMarkerVisibility: function() {\n\t\tif (this._currentTableData\n\t\t\t&& this._currentTableMarkerJson === this._lastTableMarkerJson\n\t\t\t&& this._currentTableData.rows && this._currentTableData.columns\n\t\t\t&& this._map.getDocType() === 'presentation' && this._currentTableData.rectangle\n\t\t\t&& !this._tableAnchorSection)\n\t\t\tthis._addMoveMarker();\n\t},\n\n\t_updateTableMarkers: function() {\n\t\tif (this._currentTableData === undefined)\n\t\t\treturn; // not writer, no table selected yet etc.\n\t\tif (this._currentTableMarkerJson === this._lastTableMarkerJson) {\n\t\t\tthis._updateTableMoveMarkerVisibility(); // cursor might be shown, then it doesn't work\n\t\t\treturn; // identical table setup.\n\t\t}\n\t\tthis._lastTableMarkerJson = this._currentTableMarkerJson;\n\n\t\t// Clean-up first\n\t\tthis._clearTableMarkers();\n\n\t\t// Create markers\n\t\tif (this._currentTableData.rows && this._currentTableData.columns) {\n\t\t\tthis._tablePositionColumnOffset = parseInt(this._currentTableData.columns.tableOffset);\n\t\t\tthis._tablePositionRowOffset = parseInt(this._currentTableData.rows.tableOffset);\n\t\t\tvar firstRowPosition = parseInt(this._currentTableData.rows.left) + this._tablePositionRowOffset;\n\t\t\tvar lastRowPosition = parseInt(this._currentTableData.rows.right) + this._tablePositionRowOffset;\n\t\t\tvar firstColumnPosition = parseInt(this._currentTableData.columns.left) + this._tablePositionColumnOffset;\n\t\t\tvar lastColumnPosition = parseInt(this._currentTableData.columns.right) + this._tablePositionColumnOffset;\n\t\t\tvar markerX, i, entry;\n\n\t\t\tvar columnPositions = [];\n\t\t\tvar rowPositions = [];\n\n\t\t\tcolumnPositions.push(parseInt(this._currentTableData.columns.left));\n\t\t\tif (this._map.getDocType() !== 'presentation') {\n\t\t\t\tentry = { type: 'left', position: this._currentTableData.columns.left, index: 0 };\n\t\t\t\tmarkerX = this._createMarker('column', entry, firstRowPosition, lastRowPosition);\n\t\t\t\tthis._tableColumnMarkers.push(markerX);\n\t\t\t}\n\n\t\t\tfor (i = 0; i < this._currentTableData.columns.entries.length; i++) {\n\t\t\t\tentry = this._currentTableData.columns.entries[i];\n\t\t\t\tcolumnPositions.push(parseInt(entry.position));\n\t\t\t\tentry.type = 'middle';\n\t\t\t\tentry.index = i;\n\t\t\t\tmarkerX = this._createMarker('column', entry, firstRowPosition, lastRowPosition);\n\t\t\t\tthis._tableColumnMarkers.push(markerX);\n\t\t\t}\n\n\t\t\tcolumnPositions.push(parseInt(this._currentTableData.columns.right));\n\n\t\t\tentry = { type: 'right', position: this._currentTableData.columns.right, index: 0 };\n\t\t\tmarkerX = this._createMarker('column', entry, firstRowPosition, lastRowPosition);\n\t\t\tthis._tableColumnMarkers.push(markerX);\n\n\t\t\tthis._addSelectionMarkers('column', columnPositions, firstRowPosition, lastRowPosition);\n\n\t\t\trowPositions.push(parseInt(this._currentTableData.rows.left));\n\t\t\tfor (i = 0; i < this._currentTableData.rows.entries.length; i++) {\n\t\t\t\tentry = this._currentTableData.rows.entries[i];\n\t\t\t\trowPositions.push(parseInt(entry.position));\n\t\t\t\tentry.type = 'middle';\n\t\t\t\tentry.index = i;\n\t\t\t\tmarkerX = this._createMarker('row', entry, firstColumnPosition, lastColumnPosition);\n\t\t\t\tthis._tableRowMarkers.push(markerX);\n\t\t\t}\n\n\t\t\trowPositions.push(parseInt(this._currentTableData.rows.right));\n\t\t\tentry = { type: 'right', position: this._currentTableData.rows.right };\n\t\t\tmarkerX = this._createMarker('row', entry, firstColumnPosition, lastColumnPosition);\n\t\t\tthis._tableRowMarkers.push(markerX);\n\n\t\t\tthis._addSelectionMarkers('row', rowPositions, firstColumnPosition, lastColumnPosition);\n\n\t\t\tif (this._map.getDocType() === 'presentation' && this._currentTableData.rectangle) {\n\t\t\t\tthis._addMoveMarker();\n\t\t\t\tthis._updateTableMoveMarkerVisibility();\n\t\t\t}\n\t\t}\n\t},\n\t_onZoomForTableMarkers: function () {\n\t\tthis._lastTableMarkerJson = 'foo';\n\t\tthis._updateTableMarkers();\n\t},\n\t_onTableSelectedMsg: function (textMsg) {\n\t\tif (!this._map.isEditMode()) {\n\t\t\tthis._clearTableMarkers();\n\t\t\treturn;\n\t\t}\n\n\t\tif (this._tableMarkersDragged == true) {\n\t\t\treturn;\n\t\t}\n\t\t// Parse the message\n\t\ttextMsg = textMsg.substring('tableselected:'.length + 1);\n\t\tvar message = JSON.parse(textMsg);\n\t\tthis._currentTableMarkerJson = textMsg;\n\t\tthis._currentTableData = message;\n\t\tthis._map.fire('resettopbottompagespacing',{disableMarker:this._map._docLayer.hasTableSelection()});\n\t},\n\t_addSelectionMarkers: function (type, positions, start, end) {\n\t\tif (positions.length < 2)\n\t\t\treturn;\n\n\t\tvar startX, endX, startY, endY;\n\t\tvar point1;\n\n\t\tvar delta1 = this._convertPixelToTwips(this._selectionHeaderDistanceFromTable);\n\n\t\t// The 24 is the height and width of the .table-select-marker in cool.css\n\t\tvar height = 24;\n\t\tvar width = height;\n\t\tvar selectionMarkerNominalSize = this._convertPixelToTwips(width);\n\t\tvar classNameMarker = 'table-select-marker';\n\n\t\tfor (var i = 0; i < positions.length - 1; i++) {\n\t\t\tif (type === 'column') {\n\t\t\t\tclassNameMarker += ' table-select-marker--column';\n\t\t\t\tstartX = this._tablePositionColumnOffset + positions[i];\n\t\t\t\tendX = this._tablePositionColumnOffset + positions[i + 1];\n\t\t\t\tstartY = start;\n\t\t\t\tendY = end;\n\t\t\t\tpoint1 = this._twipsToLatLng(new L.Point(startX, startY - delta1 - selectionMarkerNominalSize),\n\t\t\t\t\t\t\t     this._map.getZoom());\n\t\t\t\twidth = this._convertTwipsToPixels(new L.Point(endX - startX, 0)).x - 2;\n\t\t\t}\n\t\t\telse {\n\t\t\t\tclassNameMarker += ' table-select-marker--row';\n\t\t\t\tstartX = start;\n\t\t\t\tendX = end;\n\t\t\t\tstartY = this._tablePositionRowOffset + positions[i];\n\t\t\t\tendY = this._tablePositionRowOffset + positions[i + 1];\n\t\t\t\tpoint1 = this._twipsToLatLng(new L.Point(startX - delta1 - selectionMarkerNominalSize, startY),\n\t\t\t\t\t\t\t     this._map.getZoom());\n\t\t\t\theight = this._convertTwipsToPixels(new L.Point(0, endY - startY)).y - 2;\n\t\t\t}\n\n\t\t\tvar selectionRectangle = L.marker(point1,\n\t\t\t\t{\n\t\t\t\t\ticon: L.divIcon({\n\t\t\t\t\t\tclassName: classNameMarker,\n\t\t\t\t\t\ticonSize: [width, height],\n\t\t\t\t\t\ticonAnchor: [0, 0],\n\t\t\t\t\t}),\n\t\t\t\t\tdraggable: true,\n\t\t\t\t});\n\n\t\t\tselectionRectangle._start = { x: startX, y: startY };\n\t\t\tselectionRectangle._end = { x: endX, y: endY };\n\n\t\t\tif (type === 'column')\n\t\t\t\tthis._tableSelectionColumnMarkers.push(selectionRectangle);\n\t\t\telse\n\t\t\t\tthis._tableSelectionRowMarkers.push(selectionRectangle);\n\n\t\t\tselectionRectangle.on('click', this._onSelectRowColumnClick, this);\n\t\t\t// We don't actually want this to be draggable of course, so use a dragstart\n\t\t\t// handler that freezes it.\n\t\t\tselectionRectangle.on('dragstart drag dragend', this._onSelectRowColumnDrag, this);\n\t\t\tthis._map.addLayer(selectionRectangle);\n\t\t}\n\t},\n\t_onSelectRowColumnClick: function(e) {\n\t\t// fake selecting a column\n\t\tthis._postSelectTextEvent('start', e.target._start.x + 5, e.target._start.y + 5);\n\t\tthis._postSelectTextEvent('end', e.target._end.x - 5, e.target._end.y - 5);\n\t},\n\t_onSelectRowColumnDrag: function(e) {\n\t\te.target.dragging.freezeX(true);\n\t\te.target.dragging.freezeY(true);\n\t},\n\n\t// Update dragged text selection.\n\t_onTableBorderResizeMarkerDrag: function (e) {\n\t\tif (e.type === 'dragstart') {\n\t\t\te.target.isDragged = true;\n\t\t\tthis._tableMarkersDragged = true;\n\t\t}\n\t\telse if (e.type === 'dragend') {\n\t\t\te.target.isDragged = false;\n\t\t\tthis._tableMarkersDragged = false;\n\t\t}\n\n\t\t// modify the mouse position - move to center of the marker\n\t\tvar aMousePosition = e.target.getLatLng();\n\t\taMousePosition = this._map.project(aMousePosition);\n\t\tvar size = e.target._icon.getBoundingClientRect();\n\t\taMousePosition = aMousePosition.add(new L.Point(size.width / 2, size.height / 2));\n\t\taMousePosition = this._map.unproject(aMousePosition);\n\t\tvar aLatLonPosition = aMousePosition;\n\t\taMousePosition = this._latLngToTwips(aMousePosition);\n\n\t\tvar newPosition;\n\t\tif (e.target._type.startsWith('column')) {\n\t\t\tnewPosition = aMousePosition.x - this._tablePositionColumnOffset;\n\t\t\te.target._topBorderPoint.lng = aLatLonPosition.lng;\n\t\t\te.target._bottomBorderPoint.lng = aLatLonPosition.lng;\n\t\t}\n\t\telse {\n\t\t\tnewPosition = aMousePosition.y - this._tablePositionRowOffset;\n\t\t\te.target._topBorderPoint.lat = aLatLonPosition.lat;\n\t\t\te.target._bottomBorderPoint.lat = aLatLonPosition.lat;\n\t\t}\n\t\te.target._position = newPosition;\n\n\t\tvar bounds = new L.LatLngBounds(e.target._topBorderPoint, e.target._bottomBorderPoint);\n\n\t\tif (e.type === 'dragstart') {\n\t\t\tthis._rectangle = new L.Rectangle(bounds);\n\t\t\tthis._map.addLayer(this._rectangle);\n\t\t}\n\t\telse if (e.type === 'drag') {\n\t\t\tthis._rectangle.setBounds(bounds);\n\t\t}\n\t\telse if (e.type === 'dragend') {\n\t\t\tthis._map.removeLayer(this._rectangle);\n\t\t\tthis._rectangle = null;\n\n\t\t\tvar offset = newPosition - e.target._initialPosition;\n\t\t\te.target._initialPosition =  e.target._position;\n\n\t\t\tvar params = {\n\t\t\t\tBorderType: {\n\t\t\t\t\ttype : 'string',\n\t\t\t\t\tvalue : e.target._type\n\t\t\t\t},\n\t\t\t\tIndex: {\n\t\t\t\t\ttype : 'uint16',\n\t\t\t\t\tvalue : e.target._index\n\t\t\t\t},\n\t\t\t\tOffset: {\n\t\t\t\t\ttype : 'int32',\n\t\t\t\t\tvalue : offset\n\t\t\t\t}\n\t\t\t};\n\n\t\t\tthis._map.sendUnoCommand('.uno:TableChangeCurrentBorderPosition', params);\n\t\t}\n\n\t\tif (e.originalEvent)\n\t\t\te.originalEvent.preventDefault();\n\t},\n});\n\n"]}