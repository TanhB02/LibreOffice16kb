{"version":3,"file":"CalcTileLayer.js","sourceRoot":"","sources":["../../../../../../../../../../../TanhX/online/browser/src/layer/tile/CalcTileLayer.js"],"names":[],"mappings":"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","sourcesContent":["/* -*- js-indent-level: 8 -*- */\n\n/*\n * Copyright the Collabora Online contributors.\n *\n * SPDX-License-Identifier: MPL-2.0\n *\n * This Source Code Form is subject to the terms of the Mozilla Public\n * License, v. 2.0. If a copy of the MPL was not distributed with this\n * file, You can obtain one at http://mozilla.org/MPL/2.0/.\n */\n/*\n * Calc tile layer is used to display a spreadsheet document\n */\n\n/* global app TileManager cool FocusCellSection SplitterLinesSection */\n\nL.CalcTileLayer = L.CanvasTileLayer.extend({\n\toptions: {\n\t\t// TODO: sync these automatically from SAL_LOK_OPTIONS\n\t\tsheetGeometryDataEnabled: true,\n\t\tprintTwipsMsgsEnabled: true,\n\t\tsyncSplits: true, // if false, the splits/freezes are not synced with other users viewing the same sheet.\n\t},\n\n\ttwipsToHMM: function (twips) {\n\t\treturn (twips * 127 + 36) / 72;\n\t},\n\n\tnewAnnotation: function (comment) {\n\t\tvar commentList = app.sectionContainer.getSectionWithName(L.CSections.CommentList.name).sectionProperties.commentList;\n\t\tvar comment = null;\n\n\t\tfor (var i = 0; i < commentList.length; i++) {\n\t\t\tif (commentList[i].sectionProperties.data.tab == this._selectedPart) {\n\t\t\t\tif (commentList[i].sectionProperties.data.cellRange.contains(app.calc.cellAddress.toArray())) {\n\t\t\t\t\tcomment = commentList[i];\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (!comment) {\n\t\t\tvar pixelStart = new L.Point(app.calc.cellCursorRectangle.pX1, app.calc.cellCursorRectangle.pY1);\n\t\t\tvar rangeStart = this.sheetGeometry.getCellFromPos(pixelStart, 'corepixels');\n\t\t\tvar pixelEnd = new L.Point(app.calc.cellCursorRectangle.pX2 - 1, app.calc.cellCursorRectangle.pY2 - 1);\n\t\t\tvar rangeEnd = this.sheetGeometry.getCellFromPos(pixelEnd, 'corepixels');\n\n\t\t\tvar newComment = {\n\t\t\t\tcellRange: new L.Bounds(rangeStart, rangeEnd),\n\t\t\t\tanchorPos: app.calc.cellCursorRectangle.toArray(),\n\t\t\t\tid: 'new',\n\t\t\t\ttab: this._selectedPart,\n\t\t\t\tdateTime: new Date().toISOString(),\n\t\t\t\tauthor: this._map.getViewName(this._viewId)\n\t\t\t};\n\n\t\t\tif (app.sectionContainer.doesSectionExist('new comment')) // If adding a new comment has failed, we need to remove the leftover.\n\t\t\t\tapp.sectionContainer.removeSection('new comment');\n\n\t\t\tcomment = app.sectionContainer.getSectionWithName(L.CSections.CommentList.name).add(newComment);\n\t\t\tcomment.positionCalcComment();\n\t\t}\n\t\tapp.sectionContainer.getSectionWithName(L.CSections.CommentList.name).modify(comment);\n\t\tcomment.focus();\n\t},\n\n\tbeforeAdd: function (map) {\n\t\tmap._addZoomLimit(this);\n\t\tmap.on('zoomend', this._onZoomRowColumns, this);\n\t\tmap.on('updateparts', this._onUpdateParts, this);\n\t\tmap.on('splitposchanged', this.setSplitCellFromPos, this);\n\t\tmap.on('commandstatechanged', this._onCommandStateChanged, this);\n\t\tmap.uiManager.initializeSpecializedUI('spreadsheet');\n\t\twindow.keyboard.hintOnscreenKeyboard(window.keyboard.guessOnscreenKeyboard());\n\t},\n\n\tonAdd: function (map) {\n\t\tmap.addControl(L.control.tabs());\n\t\tL.CanvasTileLayer.prototype.onAdd.call(this, map);\n\n\t\tmap.on('resize', function () {\n\t\t\tif (app.file.textCursor.visible) {\n\t\t\t\tthis._onUpdateCursor(true /* scroll */);\n\t\t\t}\n\t\t}.bind(this));\n\n\t\tapp.sectionContainer.addSection(new app.definitions.AutoFillMarkerSection());\n\t\tapp.sectionContainer.addSection(new SplitterLinesSection());\n\n\t\tthis.insertMode = false;\n\t\tthis._resetInternalState();\n\t\tthis._sheetSwitch = new L.SheetSwitchViewRestore(map);\n\t\tthis._sheetGrid = true;\n\n\t\tif (window.prefs.getBoolean('ColumnRowHighlightEnabled', false))\n\t\t\tFocusCellSection.addFocusCellSection();\n\t},\n\n\t_resetInternalState: function() {\n\t\tthis._cellSelections = Array(0);\n\t\tapp.calc.cellCursorVisible = false;\n\t\tthis._gotFirstCellCursor = false;\n\t\tthis._lastColumn = 0; // with data\n\t\tthis._lastRow = 0; // with data\n\t\tthis.requestCellCursor();\n\t},\n\n\t_onUpdateParts: function (e) {\n\t\tif (typeof this._prevSelectedPart === 'number' && !e.source) {\n\t\t\tthis.refreshViewData(undefined, false /* compatDataSrcOnly */, true /* sheetGeometryChanged */);\n\t\t\tthis._switchSplitPanesContext();\n\t\t}\n\t},\n\n\t_onMessage: function (textMsg, img) {\n\t\tif (textMsg.startsWith('invalidateheader: column')) {\n\t\t\tthis.refreshViewData({x: this._map._getTopLeftPoint().x, y: 0,\n\t\t\t\toffset: {x: undefined, y: 0}}, true /* compatDataSrcOnly */);\n\t\t} else if (textMsg.startsWith('invalidateheader: row')) {\n\t\t\tthis.refreshViewData({x: 0, y: this._map._getTopLeftPoint().y,\n\t\t\t\toffset: {x: 0, y: undefined}}, true /* compatDataSrcOnly */);\n\t\t} else if (textMsg.startsWith('invalidateheader: all')) {\n\t\t\tthis.refreshViewData({x: this._map._getTopLeftPoint().x, y: this._map._getTopLeftPoint().y,\n\t\t\t\toffset: {x: undefined, y: undefined}}, true /* compatDataSrcOnly */);\n\t\t} else if (this.options.sheetGeometryDataEnabled &&\n\t\t\t\ttextMsg.startsWith('invalidatesheetgeometry:')) {\n\t\t\tvar params = textMsg.substring('invalidatesheetgeometry:'.length).trim().split(' ');\n\t\t\tvar flags = {};\n\t\t\tparams.forEach(function (param) {\n\t\t\t\tflags[param] = true;\n\t\t\t});\n\t\t\tthis.requestSheetGeometryData(flags);\n\t\t} else if (textMsg.startsWith('printranges:')) {\n\t\t\tthis._onPrintRangesMsg(textMsg);\n\t\t} else {\n\t\t\tL.CanvasTileLayer.prototype._onMessage.call(this, textMsg, img);\n\t\t}\n\t},\n\n\t// This is used to read and parse printranges so that the next\n\t// canvas grid paint will show the visual indication of the print range\n\t// in the current sheet if any.\n\t_onPrintRangesMsg: function (textMsg) {\n\t\ttextMsg = textMsg.substr('printranges:'.length);\n\t\tvar msgData = JSON.parse(textMsg);\n\t\tif (!msgData['printranges'] || !Array.isArray(msgData['printranges']))\n\t\t\treturn;\n\n\t\tif (!this._printRanges) {\n\t\t\tthis._printRanges = [];\n\t\t}\n\n\t\tmsgData['printranges'].forEach(function (sheetPrintRange) {\n\t\t\tif (typeof sheetPrintRange['sheet'] !== 'number' || !Array.isArray(sheetPrintRange['ranges'])) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis._printRanges[sheetPrintRange['sheet']] = sheetPrintRange['ranges'];\n\t\t}, this);\n\t},\n\n\t_onSetPartMsg: function (textMsg) {\n\t\tvar part = parseInt(textMsg.match(/\\d+/g)[0]);\n\t\tif (!app.calc.isPartHidden(part)) {\n\t\t\tthis.refreshViewData(undefined, true /* compatDataSrcOnly */, false /* sheetGeometryChanged */);\n\t\t\tthis._replayPrintTwipsMsgAllViews('cellviewcursor');\n\t\t\tthis._replayPrintTwipsMsgAllViews('textviewselection');\n\t\t\t// Hide previous tab's shown comment (if any).\n\t\t\tapp.sectionContainer.getSectionWithName(L.CSections.CommentList.name).hideAllComments();\n\t\t\tthis._sheetSwitch.gotSetPart(part);\n\t\t\tthis._syncTileContainerSize();\n\t\t}\n\t},\n\n\t_onZoomRowColumns: function () {\n\t\tthis._sendClientZoom();\n\t\tif (this.sheetGeometry) {\n\t\t\tthis.sheetGeometry.setTileGeometryData(app.tile.size.x, app.tile.size.y,\n\t\t\t\tTileManager.tileSize);\n\t\t}\n\t\tthis._restrictDocumentSize();\n\t\tthis.setSplitPosFromCell();\n\t\tthis._map.fire('zoomchanged');\n\t\tthis.refreshViewData();\n\t\tthis._replayPrintTwipsMsgs(false);\n\t},\n\n\t_restrictDocumentSize: function () {\n\t\tif (!this.sheetGeometry || !this._lastColumn || !this._lastRow) {\n\t\t\treturn;\n\t\t}\n\n\t\tvar maxDocSize = this.sheetGeometry.getSize('tiletwips');\n\t\tvar newDocWidth = Math.min(maxDocSize.x, app.file.size.x);\n\t\tvar newDocHeight = Math.min(maxDocSize.y, app.file.size.y);\n\n\t\tvar lastCellPixel = this.sheetGeometry.getCellRect(this._lastColumn, this._lastRow);\n\t\tvar isCalcRTL = this._map._docLayer.isCalcRTL();\n\t\tlastCellPixel = isCalcRTL ? lastCellPixel.getBottomRight() : lastCellPixel.getBottomLeft();\n\t\tvar lastCellTwips = this._corePixelsToTwips(lastCellPixel);\n\t\tvar mapSizeTwips = this._pixelsToTwips(this._map.getSize());\n\t\tvar mapPosTwips = this._pixelsToTwips(this._map._getTopLeftPoint());\n\n\t\t// margin outside data area we allow to scroll\n\t\t// has to be bigger on mobile to allow scroll\n\t\t// to the next place where we extend that area\n\t\t// (allow few mobile screens down and right)\n\t\tvar limitMargin = mapSizeTwips;\n\t\tif (!window.mode.isDesktop()) {\n\t\t\tlimitMargin.x *= 8;\n\t\t\tlimitMargin.y *= 8;\n\t\t}\n\n\t\tvar limitWidth = mapPosTwips.x + mapSizeTwips.x < lastCellTwips.x && !this.widthShrinked;\n\t\tvar limitHeight = mapPosTwips.y + mapSizeTwips.y < lastCellTwips.y && !this.heightShrinked;\n\n\t\t// limit to data area only (and map size for margin)\n\t\tif (limitWidth)\n\t\t\tnewDocWidth = lastCellTwips.x + limitMargin.x;\n\n\t\tif (limitHeight)\n\t\t\tnewDocHeight = lastCellTwips.y + limitMargin.y;\n\n\t\tvar extendedLimit = false;\n\n\t\tif (!limitWidth && maxDocSize.x > app.file.size.x) {\n\t\t\tnewDocWidth = Math.min(app.file.size.x + mapSizeTwips.x, maxDocSize.x);\n\t\t\textendedLimit = true;\n\t\t}\n\n\t\tif (!limitHeight && maxDocSize.y > app.file.size.y) {\n\t\t\tnewDocHeight = Math.min(app.file.size.y + mapSizeTwips.y, maxDocSize.y);\n\t\t\textendedLimit = true;\n\t\t}\n\n\t\tvar shouldRestrict = (newDocWidth !== app.file.size.x ||\n\t\t\t\tnewDocHeight !== app.file.size.y);\n\n\t\tif (!shouldRestrict) {\n\t\t\treturn;\n\t\t}\n\n\t\t// When there will be a latlng conversion, we should use CSS pixels.\n\t\tvar newSizePx = this._twipsToPixels(new L.Point(newDocWidth, newDocHeight));\n\n\t\tvar topLeft = this._map.unproject(new L.Point(0, 0));\n\t\tvar bottomRight = this._map.unproject(newSizePx);\n\n\t\tthis._docPixelSize = newSizePx.clone();\n\t\tapp.file.size = new cool.SimplePoint(newDocWidth, newDocHeight);\n\t\tapp.view.size = app.file.size.clone();\n\n\t\tthis._map.setMaxBounds(new L.LatLngBounds(topLeft, bottomRight));\n\n\t\tthis._map.fire('scrolllimits', newSizePx.clone());\n\n\t\tif (!this._syncTileContainerSize() && (limitWidth || limitHeight || extendedLimit))\n\t\t\tapp.sectionContainer.requestReDraw();\n\t},\n\n\t_getCursorPosSize: function () {\n\t\tvar x = -1, y = -1;\n\t\tvar size = new L.Point(0, 0);\n\n\t\tif (app.calc.cellCursorVisible) {\n\t\t\tx = app.calc.cellAddress.x + 1;\n\t\t\ty = app.calc.cellAddress.y + 1;\n\n\t\t\tsize = { x: app.calc.cellCursorRectangle.width, y: app.calc.cellCursorRectangle.height };\n\t\t}\n\n\t\treturn { curX: x, curY: y, width: size.x, height: size.y };\n\t},\n\n\t_getSelectionHeaderData: function() {\n\t\tif (this._cellCSelections.empty())\n\t\t\treturn { hasSelection: false };\n\n\t\tvar bounds = this._cellCSelections.getBounds();\n\t\twindow.app.console.assert(bounds.isValid(), 'Non empty selection should have valid bounds');\n\t\treturn {\n\t\t\thasSelection: true,\n\t\t\tstart: this._corePixelsToTwips(bounds.min).add([1, 1]),\n\t\t\tend: this._corePixelsToTwips(bounds.max).subtract([1, 1]),\n\t\t};\n\t},\n\n\t_hasPartsCountOrNamesChanged(lastStatusJSON, statusJSON) {\n\t\tif (!lastStatusJSON)\n\t\t\treturn true;\n\n\t\tif (lastStatusJSON.parts.length !== statusJSON.parts.length)\n\t\t\treturn true;\n\t\telse {\n\t\t\tfor (let i = 0; i < statusJSON.parts.length; i++) {\n\t\t\t\tif (statusJSON.parts[i].name !== lastStatusJSON.parts[i].name)\n\t\t\t\t\treturn true;\n\t\t\t}\n\t\t\treturn false;\n\t\t}\n\t},\n\n\t_refreshPartNames(statusJSON) {\n\t\tthis._partNames = [];\n\n\t\tfor (let i = 0; i < statusJSON.parts.length; i++) {\n\t\t\tthis._partNames.push(statusJSON.parts[i].name);\n\t\t}\n\t},\n\n\t_refreshPartHashes(statusJSON) {\n\t\tapp.calc.partHashes = [];\n\n\t\tfor (let i = 0; i < statusJSON.parts.length; i++) {\n\t\t\tapp.calc.partHashes.push(statusJSON.parts[i].hash);\n\t\t}\n\t},\n\n\t_getMarginPropertiesForTheMap: function() {\n\t\tconst rowHeaderSection = app.sectionContainer.getSectionWithName(L.CSections.RowHeader.name);\n\t\tconst columnHeaderSection = app.sectionContainer.getSectionWithName(L.CSections.ColumnHeader.name);\n\t\tconst rowGroupSection = app.sectionContainer.getSectionWithName(L.CSections.RowGroup.name);\n\t\tconst columnGroupSection = app.sectionContainer.getSectionWithName(L.CSections.ColumnGroup.name);\n\t\tconst scrollSection = app.sectionContainer.getSectionWithName(L.CSections.Scroll.name);\n\t\tconst scrollBarThickness = scrollSection ? scrollSection.sectionProperties.scrollBarThickness : 0;\n\n\t\tconst marginLeft = (rowHeaderSection ? rowHeaderSection.size[0] : 0) + (rowGroupSection ? rowGroupSection.size[0] : 0);\n\t\tconst marginTop = (columnHeaderSection ? columnHeaderSection.size[1] : 0) + (columnGroupSection ? columnGroupSection.size[1] : 0);\n\n\t\treturn { marginLeft, marginTop, scrollBarThickness };\n\t},\n\n\t_calculateNewCanvasAndMapSizes: function(documentContainerSize, availableSpace, marginLeft, marginTop, scrollBarThickness) {\n\t\tlet newMapSize = availableSpace.slice();\n\t\tlet newCanvasSize = documentContainerSize.slice();\n\n\t\tconst fileSizePixels = app.file.size.pToArray();\n\n\t\t// If we don't need that much space.\n\t\tif (fileSizePixels[0] < availableSpace[0]) {\n\t\t\tnewMapSize[0] = fileSizePixels[0];\n\t\t\tnewCanvasSize[0] = fileSizePixels[0] + marginLeft + scrollBarThickness;\n\t\t\tthis.widthShrinked = true;\n\t\t}\n\t\telse this.widthShrinked = false;\n\n\t\tif (fileSizePixels[1] < availableSpace[1]) {\n\t\t\tnewMapSize[1] = fileSizePixels[1];\n\t\t\tnewCanvasSize[1] = fileSizePixels[1] + marginTop + scrollBarThickness;\n\t\t\tthis.heightShrinked = true;\n\t\t}\n\t\telse this.heightShrinked = false;\n\n\t\tnewMapSize = [Math.round(newMapSize[0] / app.dpiScale), Math.round(newMapSize[1] / app.dpiScale)];\n\t\tnewCanvasSize = [Math.round(newCanvasSize[0] / app.dpiScale), Math.round(newCanvasSize[1] / app.dpiScale)];\n\n\t\treturn { newMapSize, newCanvasSize };\n\t},\n\n\t_resizeMapElementAndTilesLayer: function(mapElement, marginLeft, marginTop, newMapSize) {\n\t\tmapElement.style.left = Math.round(marginLeft / app.dpiScale) + 'px';\n\t\tmapElement.style.top = Math.round(marginTop / app.dpiScale) + 'px';\n\t\tmapElement.style.width = newMapSize[0] + 'px';\n\t\tmapElement.style.height = newMapSize[1] + 'px';\n\n\t\tthis._container.style.width = newMapSize[0] + 'px';\n\t\tthis._container.style.height = newMapSize[1] + 'px';\n\t},\n\n\t_updateHeaderSections: function() {\n\t\tif (app.sectionContainer.doesSectionExist(L.CSections.RowHeader.name)) {\n\t\t\tapp.sectionContainer.getSectionWithName(L.CSections.RowHeader.name)._updateCanvas();\n\t\t\tapp.sectionContainer.getSectionWithName(L.CSections.ColumnHeader.name)._updateCanvas();\n\t\t}\n\t},\n\n\t_syncTileContainerSize: function() {\n\t\tif (!this._map) return false;\n\n\t\tif (!this._container) return false;\n\n\t\t// Document container size is up to date as of now.\n\t\tconst documentContainerSize = this._getDocumentContainerSize();\n\t\tdocumentContainerSize[0] *= app.dpiScale;\n\t\tdocumentContainerSize[1] *= app.dpiScale;\n\n\t\t// Size has changed. Our map and canvas are not resized yet.\n\t\t// But the row header, row group, column header and column group sections don't need to be resized.\n\t\t// We can get their width and height from the sections' properties.\n\t\tconst { marginLeft, marginTop, scrollBarThickness } = this._getMarginPropertiesForTheMap();\n\n\t\t// Available for tiles section.\n\t\tconst availableSpace = [documentContainerSize[0] - marginLeft - scrollBarThickness, documentContainerSize[1] - marginTop - scrollBarThickness];\n\t\tconst { newMapSize, newCanvasSize } = this._calculateNewCanvasAndMapSizes(documentContainerSize, availableSpace, marginLeft, marginTop, scrollBarThickness);\n\n\t\tconst mapElement = document.getElementById('map'); // map's size = tiles section's size.\n\t\tconst oldMapSize = [mapElement.clientWidth, mapElement.clientHeight];\n\t\tconst widthIncreased = oldMapSize[0] < newMapSize[0];\n\t\tconst heightIncreased = oldMapSize[1] < newMapSize[1];\n\t\tconst sizeChanged = oldMapSize[0] !== newMapSize[0] || oldMapSize[1] !== newMapSize[1];\n\n\t\t// Early exit. If there is no need to update the size, return here.\n\t\tif (sizeChanged) {\n\t\t\tthis._resizeMapElementAndTilesLayer(mapElement, marginLeft, marginTop, newMapSize);\n\n\t\t\tthis._map.invalidateSize(false, new L.Point(oldMapSize[0], oldMapSize[1]));\n\t\t\tapp.sectionContainer.onResize(newCanvasSize[0], newCanvasSize[1]); // Canvas's size = documentContainer's size.\n\t\t\tthis._updateHeaderSections();\n\n\t\t\tthis._mobileChecksAfterResizeEvent(heightIncreased);\n\t\t}\n\n\t\t// Center the view w.r.t the new map-pane position using the current zoom.\n\t\tthis._map.setView(this._map.getCenter());\n\n\t\tif (sizeChanged) {\n\t\t\t// We want to keep cursor visible when we show the keyboard on mobile device or tablet\n\t\t\tthis._nonDesktopChecksAfterResizeEvent(heightIncreased);\n\n\t\t\tif (heightIncreased || widthIncreased) {\n\t\t\t\tapp.sectionContainer.requestReDraw();\n\t\t\t\tthis._map.fire('sizeincreased');\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\n\t\treturn false;\n\t},\n\n\t_onStatusMsg: function (textMsg) {\n\t\tconsole.log('DEBUG: onStatusMsg: ' + textMsg);\n\n\t\tconst statusJSON = JSON.parse(textMsg.replace('status:', '').replace('statusupdate:', ''));\n\n\t\tif (statusJSON.width && statusJSON.height && this._documentInfo !== textMsg) {\n\t\t\tconst temp = this._lastStatusJSON ? Object.assign({}, this._lastStatusJSON): null;\n\t\t\tthis._lastStatusJSON = statusJSON;\n\t\t\tthis._documentInfo = textMsg;\n\n\t\t\tvar firstSelectedPart = (typeof this._selectedPart !== 'number');\n\n\t\t\tif (statusJSON.readonly) this._map.setPermission('readonly');\n\n\t\t\tapp.file.size.x = statusJSON.width;\n\t\t\tapp.file.size.y = statusJSON.height;\n\n\t\t\tapp.view.size = app.file.size.clone();\n\n\t\t\tif (app.map._docLoaded)\n\t\t\t\tthis._syncTileContainerSize();\n\n\t\t\tthis._docType = statusJSON.type;\n\t\t\tthis._parts = statusJSON.partscount;\n\n\t\t\tif (app.socket._reconnecting) {\n\t\t\t\tapp.socket.sendMessage('setclientpart part=' + this._selectedPart);\n\t\t\t\tthis._resetInternalState();\n\t\t\t\twindow.keyboard.hintOnscreenKeyboard(window.keyboard.guessOnscreenKeyboard());\n\t\t\t} else {\n\t\t\t\tthis._selectedPart = statusJSON.selectedpart;\n\t\t\t}\n\n\t\t\tthis._lastColumn = statusJSON.lastcolumn;\n\t\t\tthis._lastRow = statusJSON.lastrow;\n\t\t\tthis._selectedMode = (statusJSON.mode !== undefined) ? statusJSON.mode : 0;\n\n\t\t\tif (this.sheetGeometry && this._selectedPart != this.sheetGeometry.getPart()) {\n\t\t\t\t// Core initiated sheet switch, need to get full sheetGeometry data for the selected sheet.\n\t\t\t\tthis.requestSheetGeometryData();\n\t\t\t}\n\n\t\t\tthis._viewId = statusJSON.viewid;\n\n\t\t\tconsole.assert(this._viewId >= 0, 'Incorrect viewId received: ' + this._viewId);\n\n\t\t\tvar mapSize = this._map.getSize();\n\t\t\tvar sizePx = this._twipsToPixels(new L.Point(app.file.size.x, app.file.size.y));\n\t\t\tvar width = sizePx.x;\n\t\t\tvar height = sizePx.y;\n\n\t\t\tif (width < mapSize.x || height < mapSize.y) {\n\t\t\t\twidth = Math.max(width, mapSize.x);\n\t\t\t\theight = Math.max(height, mapSize.y);\n\t\t\t\tvar topLeft = this._map.unproject(new L.Point(0, 0));\n\t\t\t\tvar bottomRight = this._map.unproject(new L.Point(width, height));\n\t\t\t\tthis._map.setMaxBounds(new L.LatLngBounds(topLeft, bottomRight));\n\t\t\t\tthis._docPixelSize = {x: width, y: height};\n\t\t\t\tthis._map.fire('scrolllimits', {x: width, y: height});\n\t\t\t}\n\t\t\telse {\n\t\t\t\tthis._updateMaxBounds(true);\n\t\t\t}\n\n\t\t\tthis._adjustCanvasSectionsForLayoutChange();\n\n\t\t\tthis._refreshPartNames(statusJSON);\n\t\t\tthis._refreshPartHashes(statusJSON);\n\n\t\t\t// if the number of parts, or order has changed then refresh comment positions\n\t\t\tif (this._hasPartsCountOrNamesChanged(temp, statusJSON))\n\t\t\t\tapp.socket.sendMessage('commandvalues command=.uno:ViewAnnotationsPosition');\n\n\n\t\t\tthis._map.fire('updateparts', {\n\t\t\t\tselectedPart: this._selectedPart,\n\t\t\t\tparts: this._parts,\n\t\t\t\tdocType: this._docType,\n\t\t\t\tsource: 'status',\n\t\t\t\tpartNames: this._partNames\n\t\t\t});\n\n\t\t\tTileManager.resetPreFetching(true);\n\n\t\t\tif (firstSelectedPart) this._switchSplitPanesContext();\n\t\t} else {\n\t\t\tthis._adjustCanvasSectionsForLayoutChange();\n\t\t}\n\n\t\tvar scrollSection = app.sectionContainer.getSectionWithName(L.CSections.Scroll.name);\n\t\tscrollSection.stepByStepScrolling = true;\n\t},\n\n\t// This initiates a selective repainting of row/col headers and\n\t// gridlines based on the settings of coordinatesData.offset. This\n\t// should be called whenever the view area changes (scrolling, panning,\n\t// zooming, cursor moving out of view-area etc.).  Depending on the\n\t// active sheet geometry data-source, it may ask core to send current\n\t// view area's data or the global data on geometry changes.\n\trefreshViewData: function (coordinatesData, compatDataSrcOnly, sheetGeometryChanged) {\n\n\t\tif (this.options.sheetGeometryDataEnabled && compatDataSrcOnly) {\n\t\t\treturn;\n\t\t}\n\t\t// There are places that call this function with no arguments to indicate that the\n\t\t// command arguments should be the current map area coordinates.\n\t\tif (typeof coordinatesData != 'object') {\n\t\t\tcoordinatesData = {};\n\t\t}\n\n\t\tvar offset = coordinatesData.offset || {};\n\n\t\tvar topLeftPoint = new L.Point(coordinatesData.x, coordinatesData.y);\n\t\tvar sizePx = this._map.getSize();\n\n\t\tif (topLeftPoint.x === undefined) {\n\t\t\ttopLeftPoint.x = this._map._getTopLeftPoint().x;\n\t\t}\n\t\tif (topLeftPoint.y === undefined) {\n\t\t\ttopLeftPoint.y = this._map._getTopLeftPoint().y;\n\t\t}\n\n\t\tvar updateRows = true;\n\t\tvar updateCols = true;\n\n\t\tif (offset.x === 0) {\n\t\t\tupdateCols = false;\n\t\t\tif (!this.options.sheetGeometryDataEnabled) {\n\t\t\t\ttopLeftPoint.x = -1;\n\t\t\t\tsizePx.x = 0;\n\t\t\t}\n\t\t}\n\t\tif (offset.y === 0) {\n\t\t\tupdateRows = false;\n\t\t\tif (!this.options.sheetGeometryDataEnabled) {\n\t\t\t\ttopLeftPoint.y = -1;\n\t\t\t\tsizePx.y = 0;\n\t\t\t}\n\t\t}\n\n\t\tvar pos = this._pixelsToTwips(topLeftPoint);\n\t\tvar size = this._pixelsToTwips(sizePx);\n\n\t\tif (!this.options.sheetGeometryDataEnabled) {\n\t\t\tthis.requestViewRowColumnData(pos, size);\n\t\t\treturn;\n\t\t}\n\n\t\tif (sheetGeometryChanged || !this.sheetGeometry) {\n\t\t\tthis.requestSheetGeometryData(\n\t\t\t\t{columns: updateCols, rows: updateRows});\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.sheetGeometry) {\n\t\t\tthis.sheetGeometry.setViewArea(pos, size);\n\t\t\tthis._updateHeadersGridLines(undefined, updateCols, updateRows);\n\t\t}\n\t},\n\n\t// This send .uno:ViewRowColumnHeaders command to core with the new view coordinates (tile-twips).\n\trequestViewRowColumnData: function (pos, size) {\n\n\t\tvar payload = 'commandvalues command=.uno:ViewRowColumnHeaders?x=' + Math.round(pos.x) + '&y=' + Math.round(pos.y) +\n\t\t\t'&width=' + Math.round(size.x) + '&height=' + Math.round(size.y);\n\n\t\tapp.socket.sendMessage(payload);\n\t},\n\n\t// sends the .uno:SheetGeometryData command optionally with arguments.\n\trequestSheetGeometryData: function (flags) {\n\t\tif (!this.sheetGeometry) {\n\t\t\t// Suppress multiple requests at document load, till we get a response.\n\t\t\tif (this._sheetGeomFirstWait === true) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tthis._sheetGeomFirstWait = true;\n\t\t}\n\t\tvar unoCmd = '.uno:SheetGeometryData';\n\t\tvar haveArgs = (typeof flags == 'object' &&\n\t\t\t(flags.columns === true || flags.rows === true || flags.all === true));\n\t\tvar payload = 'commandvalues command=' + unoCmd;\n\n\t\tif (haveArgs) {\n\t\t\tvar argList = [];\n\t\t\tvar both = (flags.all === true);\n\t\t\tif (both || flags.columns === true) {\n\t\t\t\targList.push('columns=1');\n\t\t\t}\n\t\t\tif (both || flags.rows === true) {\n\t\t\t\targList.push('rows=1');\n\t\t\t}\n\n\t\t\tvar dataTypeFlagNames = ['sizes', 'hidden', 'filtered', 'groups'];\n\t\t\tvar dataTypesPresent = false;\n\t\t\tdataTypeFlagNames.forEach(function (name) {\n\t\t\t\tif (flags[name] === true) {\n\t\t\t\t\targList.push(name + '=1');\n\t\t\t\t\tdataTypesPresent = true;\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tif (!dataTypesPresent) {\n\t\t\t\tdataTypeFlagNames.forEach(function (name) {\n\t\t\t\t\targList.push(name + '=1');\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tpayload += '?' + argList.join('&');\n\t\t}\n\n\t\tapp.socket.sendMessage(payload);\n\t},\n\n\t// Sends a notification to the row/col header and gridline controls that\n\t// they need repainting.\n\t// viewAreaData is the parsed .uno:ViewRowColumnHeaders JSON if that source is used.\n\t// else it should be undefined.\n\t_updateHeadersGridLines: function (viewAreaData, updateCols, updateRows) {\n\t\tthis._map.fire('viewrowcolumnheaders', {\n\t\t\tdata: viewAreaData,\n\t\t\tupdaterows: updateRows,\n\t\t\tupdatecolumns: updateCols,\n\t\t\tcursor: this._getCursorPosSize(),\n\t\t\tselection: this._getSelectionHeaderData(),\n\t\t\tcontext: this\n\t\t});\n\t},\n\n\t_addRemoveGroupSections: function () {\n\t\t// If there are row and column groups at the same time, add CornerGroup section.\n\t\tif (this.sheetGeometry._rows._outlines._outlines.length > 0 && this.sheetGeometry._columns._outlines._outlines.length > 0) {\n\t\t\tif (!app.sectionContainer.doesSectionExist(L.CSections.CornerGroup.name))\n\t\t\t\tapp.sectionContainer.addSection(L.control.cornerGroup());\n\t\t}\n\t\telse { // If not, remove CornerGroup section.\n\t\t\tapp.sectionContainer.removeSection(L.CSections.CornerGroup.name);\n\t\t}\n\n\t\t// If there are row groups, add RowGroup section.\n\t\tif (this.sheetGeometry._rows._outlines._outlines.length > 0) {\n\t\t\tif (!app.sectionContainer.doesSectionExist(L.CSections.RowGroup.name))\n\t\t\t\tapp.sectionContainer.addSection(L.control.rowGroup());\n\t\t}\n\t\telse { // If not, remove RowGroup section.\n\t\t\tapp.sectionContainer.removeSection(L.CSections.RowGroup.name);\n\t\t}\n\n\t\t// If there are column groups, add ColumnGroup section.\n\t\tif (this.sheetGeometry._columns._outlines._outlines.length > 0) {\n\t\t\tif (!app.sectionContainer.doesSectionExist(L.CSections.ColumnGroup.name)) {\n\t\t\t\tapp.sectionContainer.addSection(L.control.columnGroup());\n\t\t\t\tapp.sectionContainer.canvas.style.border = '1px solid darkgrey';\n\t\t\t}\n\t\t}\n\t\telse { // If not, remove ColumnGroup section.\n\t\t\tapp.sectionContainer.removeSection(L.CSections.ColumnGroup.name);\n\t\t\tapp.sectionContainer.canvas.style.border = '0px solid darkgrey';\n\t\t}\n\t},\n\n\t_setAnchor: function(name, section, value) {\n\t\tif (!section) {\n\t\t\tconsole.debug('_setAnchor: no section found: \"' + name + '\"');\n\t\t\treturn;\n\t\t}\n\n\t\tsection.anchor = value;\n\t},\n\n\t_adjustCanvasSectionsForLayoutChange: function () {\n\t\tvar sheetIsRTL = app.calc.isRTL();\n\t\tif (sheetIsRTL && this._layoutIsRTL !== true) {\n\t\t\tconsole.log('debug: in LTR -> RTL canvas section adjustments');\n\t\t\tvar sectionContainer = app.sectionContainer;\n\n\t\t\tvar tilesSection = sectionContainer.getSectionWithName(L.CSections.Tiles.name);\n\t\t\tvar rowHeaderSection = sectionContainer.getSectionWithName(L.CSections.RowHeader.name);\n\t\t\tvar columnHeaderSection = sectionContainer.getSectionWithName(L.CSections.ColumnHeader.name);\n\t\t\tvar cornerHeaderSection = sectionContainer.getSectionWithName(L.CSections.CornerHeader.name);\n\t\t\tvar columnGroupSection = sectionContainer.getSectionWithName(L.CSections.ColumnGroup.name);\n\t\t\tvar rowGroupSection = sectionContainer.getSectionWithName(L.CSections.RowGroup.name);\n\t\t\tvar cornerGroupSection = sectionContainer.getSectionWithName(L.CSections.CornerGroup.name);\n\t\t\t// Scroll section covers the entire document area, and needs RTL adjustments internally.\n\n\t\t\tthis._setAnchor('cornerGroupSection', cornerGroupSection, ['top', 'right']);\n\n\t\t\tthis._setAnchor('rowGroupSection', rowGroupSection,\n\t\t\t\t[[L.CSections.CornerGroup.name, 'bottom', 'top'], 'right']);\n\n\t\t\tthis._setAnchor('columnGroupSection', columnGroupSection,\n\t\t\t\t['top', [L.CSections.CornerGroup.name, '-left', 'right']]);\n\n\t\t\tthis._setAnchor('cornerHeaderSection', cornerHeaderSection,\n\t\t\t\t[[L.CSections.ColumnGroup.name, 'bottom', 'top'], [L.CSections.RowGroup.name, '-left', 'right']]);\n\n\t\t\tthis._setAnchor('rowHeaderSection', rowHeaderSection,\n\t\t\t\t[[L.CSections.CornerHeader.name, 'bottom', 'top'], [L.CSections.RowGroup.name, '-left', 'right']]);\n\n\t\t\tthis._setAnchor('columnHeaderSection', columnHeaderSection,\n\t\t\t\t[[L.CSections.ColumnGroup.name, 'bottom', 'top'], [L.CSections.CornerHeader.name, '-left', 'right']]);\n\t\t\tif (columnHeaderSection) columnHeaderSection.expand = ['left'];\n\n\t\t\tthis._setAnchor('tilesSection', tilesSection,\n\t\t\t\t[[L.CSections.ColumnHeader.name, 'bottom', 'top'], [L.CSections.RowHeader.name, '-left', 'right']]);\n\n\t\t\t// Do not set layoutIsRtl to true prematurely. If set before all sections are defined\n\t\t\t// (e.g., during load with onStatusMsg), some sections may not update to their correct positions.\n\t\t\t// Ensure all sections are adjusted first, then set layoutIsRtl to true to show that they have moved.\n\t\t\tif (rowHeaderSection)\n\t\t\t\tthis._layoutIsRTL = true;\n\n\t\t\tsectionContainer.reNewAllSections(true);\n\t\t\tthis._syncTileContainerSize();\n\n\t\t} else if (!sheetIsRTL && this._layoutIsRTL === true) {\n\n\t\t\tconsole.log('debug: in RTL -> LTR canvas section adjustments');\n\t\t\tvar sectionContainer = app.sectionContainer;\n\n\t\t\tvar tilesSection = sectionContainer.getSectionWithName(L.CSections.Tiles.name);\n\t\t\tvar rowHeaderSection = sectionContainer.getSectionWithName(L.CSections.RowHeader.name);\n\t\t\tvar columnHeaderSection = sectionContainer.getSectionWithName(L.CSections.ColumnHeader.name);\n\t\t\tvar cornerHeaderSection = sectionContainer.getSectionWithName(L.CSections.CornerHeader.name);\n\t\t\tvar columnGroupSection = sectionContainer.getSectionWithName(L.CSections.ColumnGroup.name);\n\t\t\tvar rowGroupSection = sectionContainer.getSectionWithName(L.CSections.RowGroup.name);\n\t\t\tvar cornerGroupSection = sectionContainer.getSectionWithName(L.CSections.CornerGroup.name);\n\n\t\t\tif (cornerGroupSection) {\n\t\t\t\tcornerGroupSection.anchor = ['top', 'left'];\n\t\t\t}\n\n\t\t\tif (rowGroupSection) {\n\t\t\t\trowGroupSection.anchor = [[L.CSections.CornerGroup.name, 'bottom', 'top'], 'left'];\n\t\t\t}\n\n\t\t\tif (columnGroupSection) {\n\t\t\t\tcolumnGroupSection.anchor = ['top', [L.CSections.CornerGroup.name, 'right', 'left']];\n\t\t\t}\n\n\t\t\tcornerHeaderSection.anchor = [[L.CSections.ColumnGroup.name, 'bottom', 'top'], [L.CSections.RowGroup.name, 'right', 'left']];\n\n\t\t\trowHeaderSection.anchor = [[L.CSections.CornerHeader.name, 'bottom', 'top'], [L.CSections.RowGroup.name, 'right', 'left']];\n\n\t\t\tcolumnHeaderSection.anchor = [[L.CSections.ColumnGroup.name, 'bottom', 'top'], [L.CSections.CornerHeader.name, 'right', 'left']];\n\t\t\tcolumnHeaderSection.expand = ['right'];\n\n\t\t\tif (rowHeaderSection)\n\t\t\t\tthis._layoutIsRTL = false;\n\n\t\t\ttilesSection.anchor = [[L.CSections.ColumnHeader.name, 'bottom', 'top'], [L.CSections.RowHeader.name, 'right', 'left']];\n\n\t\t\tsectionContainer.reNewAllSections(true);\n\t\t\tthis._syncTileContainerSize();\n\t\t}\n\t},\n\n\t_handleSheetGeometryDataMsg: function (jsonMsgObj, differentSheet) {\n\t\tif (!this.sheetGeometry) {\n\t\t\tthis._sheetGeomFirstWait = false;\n\t\t\tthis.sheetGeometry = new L.SheetGeometry(jsonMsgObj,\n\t\t\t\tapp.tile.size.x, app.tile.size.y,\n\t\t\t\tTileManager.tileSize, this._selectedPart);\n\n\t\t\tapp.sectionContainer.addSection(L.control.cornerHeader());\n\t\t\tapp.sectionContainer.addSection(new app.definitions.rowHeader());\n\t\t\tapp.sectionContainer.addSection(new app.definitions.columnHeader());\n\t\t}\n\t\telse {\n\t\t\tthis.sheetGeometry.update(jsonMsgObj, /* checkCompleteness */ false, this._selectedPart);\n\t\t}\n\n\t\tthis._replayPrintTwipsMsgs(differentSheet);\n\n\t\tthis.sheetGeometry.setViewArea(this._pixelsToTwips(this._map._getTopLeftPoint()),\n\t\t\tthis._pixelsToTwips(this._map.getSize()));\n\n\t\tthis._addRemoveGroupSections();\n\n\t\tconsole.log('debug: got sheetGeometry: this._rtlParts = ' + this._rtlParts + ' this._selectedPart = ' + this._selectedPart);\n\n\t\tthis._adjustCanvasSectionsForLayoutChange();\n\n\t\tthis._updateHeadersGridLines(undefined, true /* updateCols */,\n\t\t\ttrue /* updateRows */);\n\n\t\tthis.dontSendSplitPosToCore = true;\n\t\tthis.setSplitPosFromCell();\n\t\tthis.dontSendSplitPosToCore = false;\n\n\t\tapp.sectionContainer.reNewAllSections(true);\n\t\tthis._syncTileContainerSize();\n\n\t\tthis._map.fire('sheetgeometrychanged');\n\t},\n\n\t// Calculates the split position in (core-pixels) from the split-cell.\n\tsetSplitPosFromCell: function (forceSplittersUpdate) {\n\t\tif (!this.sheetGeometry || !this._splitPanesContext) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis._splitPanesContext.setSplitPosFromCell(forceSplittersUpdate);\n\t},\n\n\t// Calculates the split-cell from the split position in (core-pixels).\n\tsetSplitCellFromPos: function () {\n\n\t\tif (!this.sheetGeometry || !this._splitPanesContext) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis._splitPanesContext.setSplitCellFromPos();\n\t},\n\n\t_switchSplitPanesContext: function () {\n\n\t\tif (!this.hasSplitPanesSupport()) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this._splitPaneCache) {\n\t\t\tthis._splitPaneCache = {};\n\t\t}\n\n\t\twindow.app.console.assert(typeof this._selectedPart === 'number', 'invalid selectedPart');\n\n\t\tvar spContext = this._splitPaneCache[this._selectedPart];\n\t\tif (!spContext) {\n\t\t\tspContext = new L.CalcSplitPanesContext(this);\n\t\t\tthis._splitPaneCache[this._selectedPart] = spContext;\n\t\t}\n\n\t\tthis._splitPanesContext = spContext;\n\t\tif (this.sheetGeometry) {\n\t\t\t// Force update of the splitter lines.\n\t\t\tthis.setSplitPosFromCell(true);\n\t\t}\n\t},\n\n\t_onRowColSelCount: function (state) {\n\t\tif (state.trim() !== '') {\n\t\t\tvar rowCount = parseInt(state.split(', ')[0].trim().split(' ')[0].replace(',', '').replace(',', ''));\n\t\t\tvar columnCount = parseInt(state.split(', ')[1].trim().split(' ')[0].replace(',', '').replace(',', ''));\n\t\t\tif (rowCount > 1000000)\n\t\t\t\tthis._map.wholeColumnSelected = true;\n\t\t\telse\n\t\t\t\tthis._map.wholeColumnSelected = false;\n\n\t\t\tif (columnCount === 1024)\n\t\t\t\tthis._map.wholeRowSelected = true;\n\t\t\telse\n\t\t\t\tthis._map.wholeRowSelected = false;\n\t\t}\n\t\telse {\n\t\t\tthis._map.wholeColumnSelected = false;\n\t\t\tthis._map.wholeRowSelected = false;\n\t\t}\n\t},\n\n\t_onCommandStateChanged: function (e) {\n\n\t\tif (e.commandName === '.uno:FreezePanesColumn') {\n\t\t\tthis._onSplitStateChanged(e, true /* isSplitCol */);\n\t\t}\n\t\telse if (e.commandName === '.uno:FreezePanesRow') {\n\t\t\tthis._onSplitStateChanged(e, false /* isSplitCol */);\n\t\t}\n\t\telse if (e.commandName === '.uno:RowColSelCount') {\n\t\t\t// We also call the function when state is empty, because row/column variables should be set.\n\t\t\tif (e.state.trim() === '' || e.state.startsWith('Selected'))\n\t\t\t\tthis._onRowColSelCount(e.state.replace('Selected:', '').replace('row', '').replace('column', '').replace('s', ''));\n\t\t}\n\t\telse if (e.commandName === '.uno:InsertMode') {\n\t\t\t/* If we get textselection message from core:\n\t\t\t\tWhen insertMode is active:  User is selecting some text.\n\t\t\t\tWhen insertMode is passive: User is selecting cells.\n\t\t\t*/\n\t\t\tthis.insertMode = e.state.trim() === '' ? false: true;\n\t\t\tif (!this.insertMode) {\n\t\t\t\tapp.setCursorVisibility(false);\n\t\t\t\tif (this._map._docLayer._cursorMarker)\n\t\t\t\t\tthis._map._docLayer._cursorMarker.remove();\n\t\t\t}\n\t\t}\n\t\telse if (e.commandName === '.uno:ToggleSheetGrid') {\n\t\t\tlet trimmedState = e.state.trim();\n\t\t\t// Disabled mean we don't change the sheet grid state.\n\t\t\tif (trimmedState != 'disabled') {\n\t\t\t\tlet newState = trimmedState === 'true';\n\t\t\t\tif (this._sheetGrid != newState) {\n\t\t\t\t\tthis._sheetGrid = newState;\n\t\t\t\t\tapp.sectionContainer.requestReDraw();\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t},\n\n\t_onSplitStateChanged: function (e, isSplitCol) {\n\t\tif (!this._splitPanesContext) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this._splitCellState) {\n\t\t\tthis._splitCellState = new L.Point(-1, -1);\n\t\t}\n\n\t\tif (!e.state || e.state.length === 0) {\n\t\t\twindow.app.console.warn('Empty argument for ' + e.commandName);\n\t\t\treturn;\n\t\t}\n\n\t\tvar values = e.state.split('/');\n\t\tvar newSplitIndex = Math.floor(parseInt(values[0]));\n\t\twindow.app.console.assert(!isNaN(newSplitIndex) && newSplitIndex >= 0, 'invalid argument for ' + e.commandName);\n\n\t\t// This stores the current split-cell state of core, so this should not be modified.\n\t\tthis._splitCellState[isSplitCol ? 'x' : 'y'] = newSplitIndex;\n\n\t\tif (!this.options.syncSplits) {\n\t\t\treturn;\n\t\t}\n\n\t\tvar changed = isSplitCol ? this._splitPanesContext.setSplitCol(newSplitIndex) :\n\t\t\tthis._splitPanesContext.setSplitRow(newSplitIndex);\n\n\t\tif (changed) {\n\t\t\tthis.setSplitPosFromCell();\n\t\t}\n\t},\n\n\tsendSplitIndex: function (newSplitIndex, isSplitCol) {\n\n\t\tif (!this._map.isEditMode() || !this._splitCellState || !this.options.syncSplits) {\n\t\t\treturn false;\n\t\t}\n\n\t\tvar splitColState = this._splitCellState.x;\n\t\tvar splitRowState = this._splitCellState.y;\n\t\tif (splitColState === -1 || splitRowState === -1) {\n\t\t\t// Did not get the 'first' FreezePanesColumn/FreezePanesRow messages from core yet.\n\t\t\treturn false;\n\t\t}\n\n\t\tvar currentState = isSplitCol ? splitColState : splitRowState;\n\t\tif (currentState === newSplitIndex) {\n\t\t\treturn false;\n\t\t}\n\n\t\tvar unoName = isSplitCol ? 'FreezePanesColumn' : 'FreezePanesRow';\n\t\tvar command = {};\n\t\tcommand['Index'] = {\n\t\t\ttype: 'int32',\n\t\t\tvalue: newSplitIndex\n\t\t};\n\n\t\tthis._map.sendUnoCommand('.uno:' + unoName, command);\n\t\treturn true;\n\t},\n\n\t_onCommandValuesMsg: function (textMsg) {\n\t\tvar jsonIdx = textMsg.indexOf('{');\n\t\tif (jsonIdx === -1)\n\t\t\treturn;\n\n\t\tvar values = JSON.parse(textMsg.substring(jsonIdx));\n\t\tif (!values) {\n\t\t\treturn;\n\t\t}\n\n\t\tvar comment;\n\t\tif (values.commandName === '.uno:ViewRowColumnHeaders') {\n\t\t\tthis._updateHeadersGridLines(values);\n\n\t\t} else if (values.commandName === '.uno:SheetGeometryData') {\n\t\t\tvar differentSheet = this.sheetGeometry === undefined || this._selectedPart !== this.sheetGeometry.getPart();\n\t\t\t// duplicate sheet-geometry for same sheet triggers replay of other messages that\n\t\t\t// disrupt the view restore during sheet switch.\n\t\t\tif (this._oldSheetGeomMsg === textMsg && !differentSheet)\n\t\t\t\treturn;\n\n\t\t\tthis._oldSheetGeomMsg = textMsg;\n\t\t\tthis._handleSheetGeometryDataMsg(values, differentSheet);\n\t\t\tthis._syncTileContainerSize();\n\t\t} else if (values.comments) {\n\t\t\tapp.sectionContainer.getSectionWithName(L.CSections.CommentList.name).importComments(values.comments);\n\t\t} else if (values.commentsPos) {\n\t\t\tvar section = app.sectionContainer.getSectionWithName(L.CSections.CommentList.name);\n\t\t\t// invalidate all comments\n\t\t\tsection.sectionProperties.commentList.forEach(function (comment) {\n\t\t\t\tcomment.valid = false;\n\t\t\t});\n\t\t\tfor (var index in values.commentsPos) {\n\t\t\t\tcomment = values.commentsPos[index];\n\t\t\t\tif (section)\n\t\t\t\t{\n\t\t\t\t\tvar commentObject;\n\t\t\t\t\tfor (var i = 0; i < section.sectionProperties.commentList.length; i++) {\n\t\t\t\t\t\tif (parseInt(section.sectionProperties.commentList[i].sectionProperties.data.id) === parseInt(comment.id)) {\n\t\t\t\t\t\t\tif (parseInt(section.sectionProperties.commentList[i].sectionProperties.data.tab) === parseInt(comment.tab)) {\n\t\t\t\t\t\t\t\tcommentObject = section.sectionProperties.commentList[i];\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t// tabs can be moved around and we need to update the tab because the id is still valid.\n\t\t\t\t\t\t\t\tcommentObject = section.sectionProperties.commentList[i];\n\t\t\t\t\t\t\t\tcommentObject.sectionProperties.data.tab = comment.tab;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tcommentObject.valid = true;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tif (commentObject) {\n\t\t\t\t\t\t// turn cell range string into Bounds\n\t\t\t\t\t\tcommentObject.sectionProperties.data.cellRange = this._parseCellRange(comment.cellRange);\n\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (section)\n\t\t\t\tsection.onCommentsDataUpdate();\n\n\t\t} else {\n\t\t\tL.CanvasTileLayer.prototype._onCommandValuesMsg.call(this, textMsg);\n\t\t}\n\t},\n\n\t_onTextSelectionMsg: function (textMsg) {\n\t\tL.CanvasTileLayer.prototype._onTextSelectionMsg.call(this, textMsg);\n\t\t// If this is a cellSelection message, user shouldn't be editing a cell. Below check is for ensuring that.\n\t\tif ((this.insertMode === false || app.file.textCursor.visible === false) && app.calc.cellCursorVisible) {\n\t\t\t// When insertMode is false, this is a cell selection message.\n\t\t\ttextMsg = textMsg.replace('textselection:', '');\n\t\t\tif (textMsg.trim() !== 'EMPTY' && textMsg.trim() !== '') {\n\t\t\t\tthis._cellSelections = textMsg.split(';');\n\t\t\t\tvar that = this;\n\t\t\t\tthis._cellSelections = this._cellSelections.map(function(element) {\n\t\t\t\t\telement = element.split(',');\n\t\t\t\t\tvar topLeftTwips = new L.Point(parseInt(element[0]), parseInt(element[1]));\n\t\t\t\t\tvar offset = new L.Point(parseInt(element[2]), parseInt(element[3]));\n\t\t\t\t\tvar bottomRightTwips = topLeftTwips.add(offset);\n\t\t\t\t\tvar boundsTwips = that._convertToTileTwipsSheetArea(new L.Bounds(topLeftTwips, bottomRightTwips));\n\n\t\t\t\t\telement = app.LOUtil.createRectangle(boundsTwips.min.x * app.twipsToPixels, boundsTwips.min.y * app.twipsToPixels, boundsTwips.getSize().x * app.twipsToPixels, boundsTwips.getSize().y * app.twipsToPixels);\n\t\t\t\t\treturn element;\n\t\t\t\t});\n\t\t\t}\n\t\t\telse {\n\t\t\t\tthis._cellSelections = Array(0);\n\t\t\t}\n\t\t\tthis._refreshRowColumnHeaders();\n\t\t}\n\t},\n\n\tallowDrawing: function () {\n\t\t// Drawing is disabled from CalcTileLayer construction, enable it now.\n\t\tthis._gotFirstCellCursor = true;\n\t},\n\n\t_onCellCursorMsg: function (textMsg) {\n\t\tL.CanvasTileLayer.prototype._onCellCursorMsg.call(this, textMsg);\n\t\tthis._refreshRowColumnHeaders();\n\t\tif (!this._gotFirstCellCursor) {\n\t\t\tthis.allowDrawing();\n\t\t\tTileManager.update();\n\t\t\tthis.enableDrawing();\n\t\t}\n\t},\n\n\t_getEditCursorRectangle: function (msgObj) {\n\n\t\tif (!this.options.printTwipsMsgsEnabled || !this.sheetGeometry ||\n\t\t\t!Object.prototype.hasOwnProperty.call(msgObj, 'relrect') || !Object.prototype.hasOwnProperty.call(msgObj, 'refpoint')) {\n\t\t\t// 1) non-print-twips messaging mode OR\n\t\t\t// 2) the edit-cursor belongs to draw/chart objects.\n\t\t\treturn L.CanvasTileLayer.prototype._getEditCursorRectangle.call(this, msgObj);\n\t\t}\n\n\t\tif (typeof msgObj !== 'object') {\n\t\t\twindow.app.console.error('invalid edit cursor message');\n\t\t\treturn undefined;\n\t\t}\n\n\t\tvar relrect = L.Bounds.parse(msgObj.relrect);\n\t\tvar refpoint = L.Point.parse(msgObj.refpoint);\n\t\trefpoint = this.sheetGeometry.getTileTwipsPointFromPrint(refpoint);\n\t\treturn relrect.add(refpoint);\n\t},\n\n\t_getTextSelectionRectangles: function (textMsg) {\n\n\t\tif (!this.options.printTwipsMsgsEnabled || !this.sheetGeometry) {\n\t\t\treturn L.CanvasTileLayer.prototype._getTextSelectionRectangles.call(this, textMsg);\n\t\t}\n\n\t\tif (typeof textMsg !== 'string') {\n\t\t\twindow.app.console.error('invalid text selection message');\n\t\t\treturn [];\n\t\t}\n\n\t\tvar refpointDelim = '::';\n\t\tvar delimIndex = textMsg.indexOf(refpointDelim);\n\t\tif (delimIndex === -1) {\n\t\t\t// No refpoint information available, treat it as cell-range selection rectangle.\n\t\t\tvar rangeRectArray = L.Bounds.parseArray(textMsg);\n\t\t\trangeRectArray = rangeRectArray.map(function (rect) {\n\t\t\t\treturn this._convertToTileTwipsSheetArea(rect);\n\t\t\t}, this);\n\t\t\treturn rangeRectArray;\n\t\t}\n\n\t\tvar refpoint = L.Point.parse(textMsg.substring(delimIndex + refpointDelim.length));\n\t\trefpoint = this.sheetGeometry.getTileTwipsPointFromPrint(refpoint);\n\n\t\tvar rectArray = L.Bounds.parseArray(textMsg.substring(0, delimIndex));\n\t\trectArray.forEach(function (rect) {\n\t\t\trect._add(refpoint); // compute absolute coordinates and update in-place.\n\t\t});\n\n\t\treturn rectArray;\n\t},\n\n\tgetSnapDocPosX: function (docPosX, unit) {\n\t\tif (!this.options.sheetGeometryDataEnabled) {\n\t\t\treturn docPosX;\n\t\t}\n\n\t\tunit = unit || 'corepixels';\n\n\t\treturn this.sheetGeometry.getSnapDocPosX(docPosX, unit);\n\t},\n\n\tgetSnapDocPosY: function (docPosY, unit) {\n\t\tif (!this.options.sheetGeometryDataEnabled) {\n\t\t\treturn docPosY;\n\t\t}\n\n\t\tunit = unit || 'corepixels';\n\n\t\treturn this.sheetGeometry.getSnapDocPosY(docPosY, unit);\n\t},\n\n\tgetSplitPanesContext: function () {\n\t\tif (!this.hasSplitPanesSupport()) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\treturn this._splitPanesContext;\n\t},\n\n\tgetMaxDocSize: function () {\n\n\t\tif (this.sheetGeometry) {\n\t\t\treturn this.sheetGeometry.getSize('corepixels');\n\t\t}\n\n\t\treturn this._twipsToPixels(new L.Point(app.file.size.x, app.file.size.y));\n\t},\n\n\t_calculateScrollForNewCellCursor: function () {\n\t\tvar scroll = new app.definitions.simplePoint(0, 0);\n\n\t\tif (!app.calc.cellCursorVisible) {\n\t\t\treturn scroll;\n\t\t}\n\n\t\tlet paneRectangles = app.getViewRectangles(); // SimpleRectangle array.\n\t\tlet contained = false;\n\t\tfor (let i = 0; i < paneRectangles.length; i++) {\n\t\t\tif (paneRectangles[i].containsRectangle(app.calc.cellCursorRectangle.toArray()))\n\t\t\t\tcontained = true;\n\t\t}\n\n\t\tif (contained)\n\t\t\treturn scroll; // No scroll needed.\n\n\t\tvar noSplit = !this._splitPanesContext || this._splitPanesContext.getSplitPos().equals(new L.Point(0, 0));\n\n\t\t// No split panes. Check if target cell is bigger than screen but partially visible.\n\t\tif (noSplit && app.calc.cellCursorRectangle.intersectsRectangle(paneRectangles[0].toArray())) {\n\t\t\tif (app.calc.cellCursorRectangle.width > paneRectangles[0].width || app.calc.cellCursorRectangle.height > paneRectangles[0].height)\n\t\t\t\treturn scroll; // no scroll needed.\n\t\t}\n\n\t\tlet freePane = paneRectangles[paneRectangles.length - 1]; // Last pane, this should be the scrollable - not frozen one.\n\n\t\t// Horizontal split\n\t\tif (app.calc.cellCursorRectangle.x2 > app.calc.splitCoordinate.x) {\n\t\t\tif (app.calc.cellCursorRectangle.width > freePane.width)\n\t\t\t\treturn scroll; // no scroll needed.\n\n\t\t\tif (app.calc.cellCursorRectangle.x1 < freePane.x1) {\n\t\t\t\tscroll.x = app.calc.cellCursorRectangle.x1 - freePane.x1;\n\t\t\t}\n\t\t\telse if (app.calc.cellCursorRectangle.x2 > freePane.x2) {\n\t\t\t\tscroll.x = app.calc.cellCursorRectangle.x2 - freePane.x2;\n\t\t\t}\n\t\t}\n\n\t\t// Vertical split\n\t\tif (app.calc.cellCursorRectangle.y2 > app.calc.splitCoordinate.y) {\n\t\t\tif (app.calc.cellCursorRectangle.height > freePane.height)\n\t\t\t\treturn scroll; // no scroll needed.\n\n\t\t\t// try to center in free pane the top of a cell\n\t\t\tif (app.calc.cellCursorRectangle.y1 < freePane.y1)\n\t\t\t\tscroll.y = app.calc.cellCursorRectangle.y1 - freePane.y1;\n\n\t\t\t// then check if end of a cell is visible\n\t\t\tif (app.calc.cellCursorRectangle.y2 > freePane.y2 + scroll.y)\n\t\t\t\tscroll.y = scroll.y + (app.calc.cellCursorRectangle.y2 - freePane.y2);\n\t\t}\n\n\t\treturn scroll;\n\t},\n\n\tgetSelectedPart: function () {\n\t\treturn this._selectedPart;\n\t},\n});\n"]}