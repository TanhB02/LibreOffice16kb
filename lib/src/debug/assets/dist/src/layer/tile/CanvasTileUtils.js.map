{"version":3,"file":"CanvasTileUtils.js","sourceRoot":"","sources":["../../../../../../../../../../../TanhX/online/browser/src/layer/tile/CanvasTileUtils.ts"],"names":[],"mappings":"AAWA,IAAU,IAAI,CAyDb;AAzDD,WAAU,IAAI;IACb;QAAA;QAuDA,CAAC;QApDc,qBAAK,GAAnB,UACC,IAAgB,EAChB,KAAa,EACb,MAAc,EACd,MAAkB,EAClB,YAAwB;YAAxB,6BAAA,EAAA,gBAAwB;YAExB,mBAAmB;YACnB,IAAI,MAAM,GAAG,CAAC,CAAC;YACf,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,MAAM,EAAE,EAAE,CAAC,EAAE;gBAChC,IAAI,OAAO,GAAG,IAAI,CAAC,MAAM,CAAC,GAAG,IAAI,CAAC,MAAM,GAAG,CAAC,CAAC,GAAG,GAAG,CAAC;gBACpD,MAAM,IAAI,CAAC,CAAC;gBAEZ,IAAI,OAAO,GAAG,MAAM,CAAC;gBACrB,IAAM,gBAAgB,GAAG,GAAG,GAAG,CAAC,CAAC;gBAEjC,MAAM,IAAI,gBAAgB,CAAC;gBAE3B,uDAAuD;gBACvD,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC;gBACvB,IAAI,QAAQ,GAAG,CAAC,CAAC;gBACjB,IAAI,UAAU,GAAG,GAAG,CAAC;gBACrB,IAAI,aAAa,GAAG,OAAO,CAAC;gBAE5B,IAAI,SAAS,GAAG,CAAC,GAAG,KAAK,GAAG,CAAC,GAAG,YAAY,CAAC;gBAC7C,IAAI,MAAM,GAAG,MAAM,CAAC;gBAEpB,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,KAAK,EAAE,EAAE,CAAC,EAAE;oBAC/B,IAAI,UAAU,GAAG,GAAG,EAAE;wBACrB,UAAU,GAAG,CAAC,CAAC;wBACf,QAAQ,GAAG,IAAI,CAAC,aAAa,EAAE,CAAC,CAAC;qBACjC;oBACD,IAAI,CAAC,CAAC,QAAQ,GAAG,UAAU,CAAC,EAAE;wBAC7B,iDAAiD;wBACjD,wDAAwD;wBACxD,IAAI,CAAC,SAAS,CAAC,CAAC,CAAC,GAAG,IAAI,CAAC,MAAM,CAAC,CAAC;wBACjC,IAAI,CAAC,SAAS,CAAC,CAAC,CAAC,GAAG,IAAI,CAAC,MAAM,GAAG,CAAC,CAAC,CAAC;wBACrC,IAAI,CAAC,SAAS,CAAC,CAAC,CAAC,GAAG,IAAI,CAAC,MAAM,GAAG,CAAC,CAAC,CAAC;wBACrC,IAAI,CAAC,SAAS,CAAC,CAAC,CAAC,GAAG,IAAI,CAAC,MAAM,GAAG,CAAC,CAAC,CAAC;wBACrC,MAAM,IAAI,CAAC,CAAC;qBACZ;oBACD,UAAU,GAAG,UAAU,IAAI,CAAC,CAAC;oBAE7B,MAAM,CAAC,GAAG,CAAC,IAAI,CAAC,SAAS,EAAE,SAAS,CAAC,CAAC;oBACtC,SAAS,IAAI,CAAC,CAAC;iBACf;gBAED,MAAM,IAAI,OAAO,GAAG,CAAC,CAAC;aACtB;YAED,OAAO,MAAM,CAAC;QACf,CAAC;QArDc,yBAAS,GAAG,IAAI,UAAU,CAAC,CAAC,CAAC,CAAC;QAsD9C,sBAAC;KAAA,AAvDD,IAuDC;IAvDqB,oBAAe,kBAuDpC,CAAA;AACF,CAAC,EAzDS,IAAI,KAAJ,IAAI,QAyDb,CAAC,iBAAiB;AAEnB,CAAC,CAAC,eAAe,GAAG,IAAI,CAAC,eAAe,CAAC","sourcesContent":["/*\n * Copyright the Collabora Online contributors.\n *\n * SPDX-License-Identifier: MPL-2.0\n *\n * This Source Code Form is subject to the terms of the Mozilla Public\n * License, v. 2.0. If a copy of the MPL was not distributed with this\n * file, You can obtain one at http://mozilla.org/MPL/2.0/.\n */\ndeclare var L: any;\n\nnamespace cool {\n\texport abstract class CanvasTileUtils {\n\t\tprivate static lastPixel = new Uint8Array(4);\n\n\t\tpublic static unrle(\n\t\t\tdata: Uint8Array,\n\t\t\twidth: number,\n\t\t\theight: number,\n\t\t\toutput: Uint8Array,\n\t\t\toutputOffset: number = 0,\n\t\t): number {\n\t\t\t// Byte bashing fun\n\t\t\tvar offset = 0;\n\t\t\tfor (var y = 0; y < height; ++y) {\n\t\t\t\tvar rleSize = data[offset] + data[offset + 1] * 256;\n\t\t\t\toffset += 2;\n\n\t\t\t\tvar rleMask = offset;\n\t\t\t\tconst rleMaskSizeBytes = 256 / 8;\n\n\t\t\t\toffset += rleMaskSizeBytes;\n\n\t\t\t\t// It would be rather nice to have real 64bit types [!]\n\t\t\t\tthis.lastPixel.fill(0);\n\t\t\t\tvar lastMask = 0;\n\t\t\t\tvar bitToCheck = 256;\n\t\t\t\tvar rleMaskOffset = rleMask;\n\n\t\t\t\tvar pixOffset = y * width * 4 + outputOffset;\n\t\t\t\tvar pixSrc = offset;\n\n\t\t\t\tfor (var x = 0; x < width; ++x) {\n\t\t\t\t\tif (bitToCheck > 128) {\n\t\t\t\t\t\tbitToCheck = 1;\n\t\t\t\t\t\tlastMask = data[rleMaskOffset++];\n\t\t\t\t\t}\n\t\t\t\t\tif (!(lastMask & bitToCheck)) {\n\t\t\t\t\t\t// subarray has a significant overhead on Firefox\n\t\t\t\t\t\t//this.lastPixel.set(data.subarray(pixSrc, pixSrc + 4));\n\t\t\t\t\t\tthis.lastPixel[0] = data[pixSrc];\n\t\t\t\t\t\tthis.lastPixel[1] = data[pixSrc + 1];\n\t\t\t\t\t\tthis.lastPixel[2] = data[pixSrc + 2];\n\t\t\t\t\t\tthis.lastPixel[3] = data[pixSrc + 3];\n\t\t\t\t\t\tpixSrc += 4;\n\t\t\t\t\t}\n\t\t\t\t\tbitToCheck = bitToCheck << 1;\n\n\t\t\t\t\toutput.set(this.lastPixel, pixOffset);\n\t\t\t\t\tpixOffset += 4;\n\t\t\t\t}\n\n\t\t\t\toffset += rleSize * 4;\n\t\t\t}\n\n\t\t\treturn offset;\n\t\t}\n\t}\n} // namespace cool\n\nL.CanvasTileUtils = cool.CanvasTileUtils;\n"]}