{"version":3,"file":"ImpressTileLayer.js","sourceRoot":"","sources":["../../../../../../../../../../../TanhX/online/browser/src/layer/tile/ImpressTileLayer.js"],"names":[],"mappings":"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","sourcesContent":["/* -*- js-indent-level: 8 -*- */\n/*\n * Copyright the Collabora Online contributors.\n *\n * SPDX-License-Identifier: MPL-2.0\n *\n * This Source Code Form is subject to the terms of the Mozilla Public\n * License, v. 2.0. If a copy of the MPL was not distributed with this\n * file, You can obtain one at http://mozilla.org/MPL/2.0/.\n */\n/*\n * Impress tile layer is used to display a presentation document\n */\n\n/* global app $ L cool TileManager */\n\nL.ImpressTileLayer = L.CanvasTileLayer.extend({\n\n\tinitialize: function (options) {\n\t\tL.CanvasTileLayer.prototype.initialize.call(this, options);\n\t\t// If this is mobile view, we we'll change the layout position of 'presentation-controls-wrapper'.\n\t\tif (window.mode.isMobile()) {\n\t\t\tthis._putPCWOutsideFlex();\n\t\t}\n\n\t\tthis._preview = L.control.partsPreview();\n\n\t\tif (window.mode.isMobile()) {\n\t\t\tthis._addButton = L.control.mobileSlide();\n\t\t\tL.DomUtil.addClass(L.DomUtil.get('mobile-edit-button'), 'impress');\n\t\t}\n\t\tthis._spaceBetweenParts = 300; // In twips. This is used when all parts of an Impress or Draw document is shown in one view (like a Writer file). This mode is used when document is read only.\n\n\t\t// app.file variable should exist, this is a precaution.\n\t\tif (!app.file)\n\t\t\tapp.file = {};\n\n\t\t// Before this instance is created, app.file.readOnly and app.file.editComments variables are set.\n\t\t// If document is on read only mode, we will draw all parts at once.\n\t\t// Let's call default view the \"part based view\" and new view the \"file based view\".\n\t\tif (app.file.readOnly)\n\t\t\tapp.file.fileBasedView = true;\n\t\telse\n\t\t\tapp.file.partBasedView = true; // For Writer and Calc, this one should always be \"true\".\n\n\t\tthis._partHeightTwips = 0; // Single part's height.\n\t\tthis._partWidthTwips = 0; // Single part's width. These values are equal to app.file.size.x & app.file.size.y when app.file.partBasedView is true.\n\n\t\tapp.events.on('contextchange', this._onContextChange.bind(this));\n\t},\n\n\t_onContextChange(e) {\n\t\t/*\n\t\t\tWe need to check the context content for now. Because we are using this property for both context and the page kind.\n\t\t\tWhen user modifies the content of the notes, the context is changed again. As we use context as a view mode, we shouldn't change our variable in that case.\n\t\t\tWe need to check if the context is something related to view mode or not.\n\t\t\tFor a better solution, we need to send the page kinds along with status messages. Then we will check the page kind and set the notes view toggle accordingly.\n\t\t*/\n\n\t\tconst newContext = e.detail.context;\n\t\tconst oldContext = e.detail.oldContext;\n\t\tconst isDrawOrNotesPage = ['DrawPage', 'NotesPage'].includes(newContext);\n\n\t\tif (isDrawOrNotesPage)\n\t\t\tapp.impress.notesMode = newContext === 'NotesPage';\n\n\t\tif (app.map.uiManager.getCurrentMode() === 'notebookbar' && isDrawOrNotesPage) {\n\t\t\tconst targetElement = document.getElementById('notesmode');\n\t\t\tif (!targetElement) return;\n\n\t\t\tif (newContext === 'NotesPage')\n\t\t\t\ttargetElement.classList.add('selected');\n\t\t\telse\n\t\t\t\ttargetElement.classList.remove('selected');\n\t\t}\n\n\t\tif (isDrawOrNotesPage) {\n\t\t\tthis._selectedMode = newContext === 'NotesPage' ? 2 : 0;\n\t\t\tTileManager.refreshTilesInBackground();\n\t\t\tTileManager.update();\n\t\t}\n\n\t\tif (newContext === 'MasterPage' || oldContext === 'MasterPage') {\n\t\t\tapp.socket.sendMessage('status');\n\t\t\tthis.invalidatePreviewsUponContextChange = true;\n\t\t}\n\t},\n\n\t_isPCWInsideFlex: function () {\n\t\tvar PCW = document.getElementById('main-document-content').querySelector('#presentation-controls-wrapper');\n\t\treturn PCW ? true: false;\n\t},\n\n\t_putPCWOutsideFlex: function () {\n\t\tif (this._isPCWInsideFlex()) {\n\t\t\tvar pcw = document.getElementById('presentation-controls-wrapper');\n\t\t\tif (pcw && pcw.parentNode) {\n\t\t\t\tpcw.parentNode.removeChild(pcw);  // Remove from its actual parent\n\t\t\t\tvar frc = document.getElementById('main-document-content');\n\t\t\t\tfrc.parentNode.insertBefore(pcw, frc.nextSibling);\n\t\t\t}\n\t\t}\n\t},\n\n\t_putPCWInsideFlex: function () {\n\t\tif (!this._isPCWInsideFlex()) {\n\t\t\tvar pcw = document.getElementById('presentation-controls-wrapper');\n\t\t\tif (pcw) {\n\t\t\t\tvar frc = document.getElementById('main-document-content');\n\t\t\t\tdocument.body.removeChild(pcw);\n\n\t\t\t\tdocument.getElementById('document-container').parentNode.insertBefore(pcw, frc.children[0]);\n\t\t\t}\n\t\t}\n\t},\n\n\tnewAnnotation: function (commentData) {\n\t\tlet docTopLeft = app.sectionContainer.getDocumentTopLeft();\n\t\tdocTopLeft = [docTopLeft[0] * app.pixelsToTwips, docTopLeft[1] * app.pixelsToTwips];\n\t\tcommentData.anchorPos = [docTopLeft[0], docTopLeft[1]];\n\t\tcommentData.rectangle = [docTopLeft[0], docTopLeft[1], 566, 566];\n\n\t\tcommentData.parthash = app.impress.partList[this._selectedPart].hash;\n\n\t\tconst comment = new cool.Comment(commentData, {}, app.sectionContainer.getSectionWithName(L.CSections.CommentList.name));\n\n\t\tvar annotation = app.sectionContainer.getSectionWithName(L.CSections.CommentList.name).add(comment);\n\t\tapp.sectionContainer.getSectionWithName(L.CSections.CommentList.name).modify(annotation);\n\t},\n\n\tbeforeAdd: function (map) {\n\t\tthis._map = map;\n\t\tmap.addControl(this._preview);\n\t\tmap.on('updateparts', this.onUpdateParts, this);\n\t\tapp.events.on('updatepermission', this.onUpdatePermission.bind(this));\n\n\t\tif (!map._docPreviews)\n\t\t\tmap._docPreviews = {};\n\n\t\tmap.uiManager.initializeSpecializedUI(this._docType);\n\t},\n\n\tonResizeImpress: function () {\n\t\tL.DomUtil.updateElementsOrientation(['presentation-controls-wrapper', 'document-container', 'slide-sorter']);\n\n\t\tvar mobileEditButton = document.getElementById('mobile-edit-button');\n\n\t\tif (window.mode.isMobile()) {\n\t\t\tif (L.DomUtil.isPortrait()) {\n\t\t\t\tthis._putPCWOutsideFlex();\n\t\t\t\tif (mobileEditButton)\n\t\t\t\t\tmobileEditButton.classList.add('portrait');\n\t\t\t}\n\t\t\telse {\n\t\t\t\tthis._putPCWInsideFlex();\n\t\t\t\tif (mobileEditButton)\n\t\t\t\t\tmobileEditButton.classList.remove('portrait');\n\t\t\t}\n\t\t}\n\t\telse {\n\t\t\tvar container = L.DomUtil.get('main-document-content');// consider height of document area to calculate estimated height for slide-sorter\n\t\t\tvar slideSorter = L.DomUtil.get('slide-sorter');\n\t\t\tvar navigationOptions = L.DomUtil.get('navigation-options-wrapper');\n\t\t\tif (container && slideSorter && toolbar) {\n\t\t\t\t$(slideSorter).height($(container).height() - $(navigationOptions).height());\n\t\t\t}\n\t\t}\n\t},\n\n\tonRemove: function () {\n\t\tclearTimeout(this._previewInvalidator);\n\t},\n\n\t_openMobileWizard: function(data) {\n\t\tL.CanvasTileLayer.prototype._openMobileWizard.call(this, data);\n\t},\n\n\tonUpdateParts: function () {\n\t\tif (this._map.uiManager.isAnyDialogOpen()) // Need this check else dialog loses focus\n\t\t\treturn;\n\n\t\tapp.sectionContainer.getSectionWithName(L.CSections.CommentList.name).onPartChange();\n\t},\n\n\tonUpdatePermission: function (e) {\n\t\tif (window.mode.isMobile()) {\n\t\t\tif (e.detail.perm === 'edit') {\n\t\t\t\tthis._addButton.addTo(this._map);\n\t\t\t} else {\n\t\t\t\tthis._addButton.remove();\n\t\t\t}\n\t\t}\n\t},\n\n\t_onCommandValuesMsg: function (textMsg) {\n\t\ttry {\n\t\t\tvar values = JSON.parse(textMsg.substring(textMsg.indexOf('{')));\n\t\t} catch (e) {\n\t\t\t// One such case is 'commandvalues: ' for draw documents in response to .uno:AcceptTrackedChanges\n\t\t\tvalues = null;\n\t\t}\n\n\t\tif (!values) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (values.comments) {\n\t\t\tapp.sectionContainer.getSectionWithName(L.CSections.CommentList.name).importComments(values.comments);\n\t\t} else {\n\t\t\tL.CanvasTileLayer.prototype._onCommandValuesMsg.call(this, textMsg);\n\t\t}\n\t},\n\n\t_onSetPartMsg: function (textMsg) {\n\t\tvar part = parseInt(textMsg.match(/\\d+/g)[0]);\n\t\tif (part !== this._selectedPart) {\n\t\t\tthis._map.deselectAll(); // Deselect all first. This is a single selection.\n\t\t\tthis._map.setPart(part, true);\n\t\t\tthis._map.fire('setpart', {selectedPart: this._selectedPart});\n\t\t}\n\t},\n\n\t_onStatusMsg: function (textMsg) {\n\t\tconst statusJSON = JSON.parse(textMsg.replace('status:', '').replace('statusupdate:', ''));\n\n\t\t// Since we have two status commands, remove them so we store and compare payloads only.\n\t\ttextMsg = textMsg.replace('status: ', '');\n\t\ttextMsg = textMsg.replace('statusupdate: ', '');\n\t\tif (statusJSON.width && statusJSON.height && this._documentInfo !== textMsg) {\n\t\t\tapp.file.size.x = statusJSON.width;\n\t\t\tapp.file.size.y = statusJSON.height;\n\t\t\tthis._docType = statusJSON.type;\n\t\t\tif (this._docType === 'drawing') {\n\t\t\t\tL.DomUtil.addClass(L.DomUtil.get('presentation-controls-wrapper'), 'drawing');\n\t\t\t}\n\t\t\tthis._parts = statusJSON.partscount;\n\t\t\tthis._partHeightTwips = app.file.size.y;\n\t\t\tthis._partWidthTwips = app.file.size.x;\n\n\t\t\tif (app.file.fileBasedView) {\n\t\t\t\tvar totalHeight = this._parts * app.file.size.y; // Total height in twips.\n\t\t\t\ttotalHeight += (this._parts) * this._spaceBetweenParts; // Space between parts.\n\t\t\t\tapp.file.size.y = totalHeight;\n\t\t\t}\n\n\t\t\tapp.view.size = app.file.size.clone();\n\n\t\t\tapp.impress.partList = Object.assign([], statusJSON.parts);\n\n\t\t\tthis._updateMaxBounds(true);\n\n\t\t\tthis._viewId = statusJSON.viewid;\n\t\t\tconsole.assert(this._viewId >= 0, 'Incorrect viewId received: ' + this._viewId);\n\t\t\tif (app.socket._reconnecting) {\n\t\t\t\tapp.socket.sendMessage('setclientpart part=' + this._selectedPart);\n\t\t\t} else {\n\t\t\t\tthis._selectedPart = statusJSON.selectedpart;\n\t\t\t}\n\n\t\t\tthis._selectedMode = (statusJSON.mode !== undefined) ? statusJSON.mode : (statusJSON.parts.length > 0 && statusJSON.parts[0].mode !== undefined ? statusJSON.parts[0].mode : 0);\n\t\t\tthis._map.fire('impressmodechanged', {mode: this._selectedMode});\n\n\t\t\tif (statusJSON.gridSnapEnabled === true)\n\t\t\t\tapp.map.stateChangeHandler.setItemValue('.uno:GridUse', 'true');\n\t\t\telse if (statusJSON.parts.length > 0 && statusJSON.parts[0].gridSnapEnabled === true)\n\t\t\t\tapp.map.stateChangeHandler.setItemValue('.uno:GridUse', 'true');\n\n\t\t\tif (statusJSON.gridVisible === true)\n\t\t\t\tapp.map.stateChangeHandler.setItemValue('.uno:GridVisible', 'true');\n\t\t\telse if (statusJSON.parts.length > 0 && statusJSON.parts[0].gridVisible === true)\n\t\t\t\tapp.map.stateChangeHandler.setItemValue('.uno:GridVisible', 'true');\n\n\t\t\tTileManager.resetPreFetching(true);\n\n\t\t\tvar refreshAnnotation = this._documentInfo !== textMsg;\n\n\t\t\tthis._documentInfo = textMsg;\n\n\t\t\tthis._map.fire('updateparts', {});\n\n\t\t\tif (refreshAnnotation)\n\t\t\t\tapp.socket.sendMessage('commandvalues command=.uno:ViewAnnotations');\n\t\t}\n\n\t\tif (app.file.fileBasedView)\n\t\t\tTileManager.updateFileBasedView();\n\n\t\tif (this.invalidatePreviewsUponContextChange === true) {\n\t\t\tthis._invalidateAllPreviews();\n\t\t\tthis.invalidatePreviewsUponContextChange = false;\n\t\t}\n\t},\n\n\t_invalidateAllPreviews: function () {\n\t\tL.CanvasTileLayer.prototype._invalidateAllPreviews.call(this);\n\t\tthis._map.fire('invalidateparts');\n\t}\n});\n"]}