{"version":3,"file":"TextInput.js","sourceRoot":"","sources":["../../../../../../../../../../../TanhX/online/browser/src/layer/marker/TextInput.js"],"names":[],"mappings":"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","sourcesContent":["/* -*- js-indent-level: 8; fill-column: 100 -*- */\n/*\n * Copyright the Collabora Online contributors.\n *\n * SPDX-License-Identifier: MPL-2.0\n *\n * This Source Code Form is subject to the terms of the Mozilla Public\n * License, v. 2.0. If a copy of the MPL was not distributed with this\n * file, You can obtain one at http://mozilla.org/MPL/2.0/.\n */\n/*\n * L.TextInput is the hidden textarea, which handles text input events\n *\n * This is made significantly more difficult than expected by such a\n * mess of browser, and mobile IME quirks that it is not possible to\n * follow events, but we have to re-construct input from a browser\n * text area itself.\n */\n\n/* global app _ */\n\nL.TextInput = L.Layer.extend({\n\tinitialize: function() {\n\n\t\tL.Layer.prototype.initialize.call(this);\n\n\t\tthis._className = 'TextInput';\n\n\t\t// Flag to denote the composing state, derived from\n\t\t// compositionstart/compositionend events; unused\n\t\tthis._isComposing = false;\n\n\t\t// We need to detect whether delete or backspace was\n\t\t// pressed sometimes - consider '  foo' -> ' foo'\n\t\tthis._deleteHint = ''; // or 'delete' or 'backspace'\n\n\t\t// When <enter> key is hit a <div> element is created and appended to the editable area:\n\t\t// inputType: insertParagraph. No new char is added to the editable area textContent property.\n\t\tthis._newlineHint = false;\n\n\t\t// We need to detect line break in the tunneled formula\n\t\t// input window for the multiline case.\n\t\tthis._linebreakHint = false;\n\n\t\t// Clearing the area can generate input events\n\t\tthis._ignoreInputCount = 0;\n\n\t\t// If the last focus intended to accept user input.\n\t\t// Signifies whether the keyboard is meant to be visible.\n\t\tthis._setAcceptInput(false);\n\n\t\t// Content\n\t\tthis._lastContent = []; // unicode characters\n\t\tthis._hasWorkingSelectionStart = undefined; // does it work ?\n\t\tthis._ignoreNextBackspace = false;\n\n\t\tthis._preSpaceChar = '<img id=\"pre-space\" alt=\" \" aria-hidden=\"true\">';\n\t\tthis._postSpaceChar = '<img id=\"post-space\" alt=\" \" aria-hidden=\"true\">';\n\t\tthis._initialContent = this._preSpaceChar + this._postSpaceChar;\n\n\t\t// Debug flag, used in fancyLog(). See the debug() method.\n\t\t// this._isDebugOn = true;\n\t\tthis._isDebugOn = false;\n\n\t\tthis._initLayout();\n\n\t\t// Under-caret orange marker.\n\t\tthis._cursorHandler = L.marker(new L.LatLng(0, 0), {\n\t\t\ticon: L.divIcon({\n\t\t\t\tclassName: 'leaflet-cursor-handler',\n\t\t\t\ticonSize: null\n\t\t\t}),\n\t\t\tdraggable: true\n\t\t}).on('dragend', this._onCursorHandlerDragEnd, this);\n\n\t\t// Auto-correct characters can trigger auto-correction, but\n\t\t// must be sent as key-up/down if we want correction.\n\t\t// cf. SvxAutoCorrect::IsAutoCorrectChar\n\t\tthis._autoCorrectChars = {\n\t\t\t// tab, newline - handled elsewhere\n\t\t\t' ':  [ 32, 0,      0, 1284 ],\n\t\t\t'!':  [ 33, 0,      0, 4353 ],\n\t\t\t'\"':  [ 34, 0,      0, 4353 ],\n\t\t\t'%':  [ 37, 0,      0, 4357 ],\n\t\t\t'\\'': [ 39, 0,      0,  192 ],\n\t\t\t'*':  [ 42, 0,      0, 4360 ],\n\t\t\t',':  [ 44, 0,      0, 1291 ],\n\t\t\t'-':  [ 45, 0,      0, 1288 ],\n\t\t\t'.':  [ 46, 0,      0,  190 ],\n\t\t\t'/':  [ 47, 0,      0,  191 ],\n\t\t\t':':  [ 58, 0,      0, 5413 ],\n\t\t\t';':  [ 59, 0,      0, 1317 ],\n\t\t\t'?':  [ 63, 0,      0, 4287 ],\n\t\t\t'_':  [ 95, 0,      0, 5384 ]\n\t\t};\n\n\t\t// unoKeyCode values of the digits.\n\t\tthis._unoKeyMap = {\n\t\t\t'48': 96,   // 0\n\t\t\t'49': 97,   // 1\n\t\t\t'50': 98,   // 2\n\t\t\t'51': 99,   // 3\n\t\t\t'52': 100,  // 4\n\t\t\t'53': 101,  // 5\n\t\t\t'54': 102,  // 6\n\t\t\t'55': 103,  // 7\n\t\t\t'56': 104,  // 8\n\t\t\t'57': 105   // 9\n\t\t};\n\n\t},\n\n\thasAccessibilitySupport: function() {\n\t\treturn false;\n\t},\n\n\tonAdd: function() {\n\t\tif (this._container) {\n\t\t\tthis.getPane().appendChild(this._container);\n\t\t\tthis.update();\n\t\t}\n\n\t\tif (!this.hasAccessibilitySupport()) {\n\t\t\tthis._emptyArea();\n\t\t\tthis._map.on('commandresult', this._onCommandResult, this);\n\t\t}\n\n\t\tapp.events.on('updatepermission', this._onPermission.bind(this));\n\t\tL.DomEvent.on(this._textArea, 'focus blur', this._onFocusBlur, this);\n\n\t\t// Do not wait for a 'focus' event to attach events if the\n\t\t// textarea/contenteditable is already focused (due to the autofocus\n\t\t// HTML attribute, the browser focusing it on DOM creation, or whatever)\n\t\tif (document.activeElement === this._textArea) {\n\t\t\tthis._onFocusBlur({ type: 'focus' });\n\t\t}\n\n\t\tif (window.ThisIsTheiOSApp) {\n\t\t\tvar that = this;\n\t\t\twindow.MagicToGetHWKeyboardWorking = function() {\n\t\t\t\tvar that2 = that;\n\t\t\t\twindow.MagicKeyDownHandler = function(e) {\n\t\t\t\t\tthat2._onKeyDown(e);\n\t\t\t\t};\n\t\t\t\twindow.MagicKeyUpHandler = function(e) {\n\t\t\t\t\tthat2._onKeyUp(e);\n\t\t\t\t};\n\t\t\t};\n\t\t\twindow.postMobileMessage('FOCUSIFHWKBD');\n\t\t}\n\n\t\tL.DomEvent.on(this._map.getContainer(), 'mousedown touchstart', this._abortComposition, this);\n\t},\n\n\tonRemove: function() {\n\t\twindow.MagicToGetHWKeyboardWorking = null;\n\t\twindow.MagicKeyDownHandler = null;\n\t\twindow.MagicKeyUpHandler = null;\n\n\t\tif (this._container) {\n\t\t\tthis.getPane().removeChild(this._container);\n\t\t}\n\n\t\tif (!this.hasAccessibilitySupport()) {\n\t\t\tthis._map.off('commandresult', this._onCommandResult, this);\n\t\t}\n\t\tL.DomEvent.off(this._textArea, 'focus blur', this._onFocusBlur, this);\n\t\tL.DomEvent.off(this._map.getContainer(), 'mousedown touchstart', this._abortComposition, this);\n\n\t\tthis._map.removeLayer(this._cursorHandler);\n\t},\n\n\tdisable: function () {\n\t\tthis._textArea.setAttribute('disabled', true);\n\t},\n\n\tenable: function () {\n\t\tthis._textArea.removeAttribute('disabled');\n\t},\n\n\t_onPermission: function(e) {\n\t\tif (e.detail.perm === 'edit') {\n\t\t\tthis._textArea.removeAttribute('disabled');\n\t\t} else {\n\t\t\tthis._textArea.setAttribute('disabled', true);\n\t\t}\n\t},\n\n\t_onCommandResult: function(e) {\n\t\tif (this.hasAccessibilitySupport())\n\t\t\treturn;\n\n\t\tif (e.commandName === '.uno:Undo' || e.commandName === '.uno:Redo') {\n\t\t\t//undoing something does not trigger any input method\n\t\t\t// this causes the editable area content not to be a substring\n\t\t\t// of the document text; moreover this causes problem\n\t\t\t// in mobile working with suggestions:\n\t\t\t//i.e: type \"than\" and then select \"thank\" from suggestion\n\t\t\t//now undo and then again select \"thanks\" from suggestions\n\t\t\t//final output is \"thans\"\n\t\t\t//this happens because undo doesn't change the editable area content.\n\t\t\t//So better to clean the editable area content.\n\t\t\tthis._emptyArea();\n\t\t}\n\t},\n\n\thasFocus: function() {\n\t\treturn this._textArea && this._textArea === document.activeElement;\n\t},\n\n\t_onFocusBlur: function(ev) {\n\t\tthis._fancyLog(ev.type, '');\n\t\tthis._statusLog('_onFocusBlur');\n\t\tvar onoff = (ev.type === 'focus' ? L.DomEvent.on : L.DomEvent.off).bind(L.DomEvent);\n\n\t\t// Debug - connect first for saner logging.\n\t\tonoff(\n\t\t\tthis._textArea,\n\t\t\t'copy cut compositionstart compositionupdate compositionend select keydown keypress keyup beforeinput textInput textinput input',\n\t\t\tthis._onEvent,\n\t\t\tthis\n\t\t);\n\n\t\t// we already do the same in _onBeforeInput, anyway for Safari on iOS is too late:\n\t\t// the selection is messed up, so we miss the first typed key.\n\t\t// Needed also after a Ctrl+C.\n\t\tif (ev.type === 'focus') {\n\t\t\tif (!this._isSelectionValid() || this._isCursorAtBeginning()) {\n\t\t\t\tif (this.hasAccessibilitySupport()) {\n\t\t\t\t\tthis._setSelectionRange(this._lastSelectionStart, this._lastSelectionEnd);\n\t\t\t\t} else {\n\t\t\t\t\tthis._emptyArea();\n\t\t\t\t}\n\t\t\t} else if (this.hasAccessibilitySupport()) {\n\t\t\t\tthis._updateFocusedParagraph();\n\t\t\t}\n\t\t}\n\n\t\tonoff(this._textArea, 'input', this._onInput, this);\n\t\tonoff(this._textArea, 'beforeinput', this._onBeforeInput, this);\n\t\tonoff(this._textArea, 'compositionstart', this._onCompositionStart, this);\n\t\tonoff(this._textArea, 'compositionupdate', this._onCompositionUpdate, this);\n\t\tonoff(this._textArea, 'compositionend', this._onCompositionEnd, this);\n\t\tonoff(this._textArea, 'keydown', this._onKeyDown, this);\n\t\tonoff(this._textArea, 'keyup', this._onKeyUp, this);\n\t\tonoff(this._textArea, 'copy cut paste', this._map._handleDOMEvent, this._map);\n\n\t\tapp.idleHandler.notifyActive();\n\n\t\tif (ev.type === 'blur' && this._isComposing) {\n\t\t\tthis._abortComposition(ev);\n\t\t}\n\t},\n\n\t// Focus the textarea/contenteditable\n\t// @acceptInput (only on \"mobile\" (= mobile phone) or on iOS and Android in general) true if we want to\n\t// accept key input, and show the virtual keyboard.\n\tfocus: function(acceptInput) {\n\t\t// Note that the acceptInput parameter intentionally\n\t\t// is a tri-state boolean: undefined, false, or true.\n\n\t\t// Clicking or otherwise focusing the map should focus on the clipboard\n\t\t// container in order for the user to input text (and on-screen keyboards\n\t\t// to pop-up), unless the document is read only.\n\t\tif (!this._map.isEditMode()) {\n\t\t\tthis._setAcceptInput(false);\n\t\t\t// on clicking focus is important\n\t\t\t// specially in chrome once document loses focus it never gets it back\n\t\t\t// which causes shortcuts to stop working (i.e: print, search etc...)\n\t\t\tthis._map.getContainer().focus();\n\t\t\treturn;\n\t\t}\n\n\t\t// Trick to avoid showing the software keyboard: Set the textarea\n\t\t// read-only before focus() and reset it again after the blur()\n\t\tif (!window.ThisIsTheiOSApp && navigator.platform !== 'iPhone' && !window.mode.isChromebook()) {\n\t\t\tif (window.keyboard.guessOnscreenKeyboard() && acceptInput !== true)\n\t\t\t\tthis._textArea.setAttribute('readonly', true);\n\t\t}\n\n\t\tif (!window.ThisIsTheiOSApp && navigator.platform !== 'iPhone' && !window.keyboard.guessOnscreenKeyboard()) {\n\t\t\tthis._textArea.focus();\n\t\t} else if (acceptInput === true) {\n\t\t\t// On the iPhone, only call the textarea's focus() when we get an explicit\n\t\t\t// true parameter. On the other hand, never call the textarea's blur().\n\n\t\t\t// Calling blur() leads to so confusing behaviour with the keyboard not\n\t\t\t// showing up when we want. Better to have it show up a bit too long that\n\t\t\t// strictly needed.\n\n\t\t\t// Probably whether the calls to the textarea's focus() and blur() functions\n\t\t\t// actually do anything or not might depend on whether the call stack\n\t\t\t// originates in a user input event handler or not, for security reasons.\n\n\t\t\t// To investigate, uncomment the call to console.trace() at the start of\n\t\t\t// this function, and check when the topmost slot in the stack trace is\n\t\t\t// \"(anonymous function)\" in hammer.js (an event handler), and when it is\n\t\t\t// _onMessage (the WebSocket message handler in Socket.js).\n\n\t\t\tthis._textArea.focus();\n\t\t}\n\n\t\tif (!window.ThisIsTheiOSApp && navigator.platform !== 'iPhone' && !window.mode.isChromebook()) {\n\t\t\tif (window.keyboard.guessOnscreenKeyboard() && acceptInput !== true) {\n\t\t\t\tthis._setAcceptInput(false);\n\t\t\t\tthis._textArea.blur();\n\t\t\t\tthis._textArea.removeAttribute('readonly');\n\t\t\t} else {\n\t\t\t\tthis._setAcceptInput(true);\n\t\t\t}\n\t\t} else if (acceptInput !== false) {\n\t\t\tthis._setAcceptInput(true);\n\t\t} else {\n\t\t\tthis._setAcceptInput(false);\n\t\t}\n\t},\n\n\tblur: function() {\n\t\tthis._setAcceptInput(false);\n\t\tif (!window.ThisIsTheiOSApp && navigator.platform !== 'iPhone' && !window.mode.isChromebook())\n\t\t\tthis._textArea.blur();\n\t},\n\n\t// Returns true if the last focus was to accept input.\n\t// Used to restore the keyboard.\n\tcanAcceptKeyboardInput: function() {\n\t\treturn this._acceptInput;\n\t},\n\n\t// Marks the content of the textarea/contenteditable as selected,\n\t// for system clipboard interaction.\n\tselect: function() {\n\t\tthis._setSelectionRange(0, this.getPlainTextContent().length);\n\t},\n\n\tgetValue: function() {\n\t\treturn this.getPlainTextContent();\n\t},\n\n\tgetPlainTextContent: function() {\n\t\treturn \tthis._textArea.textContent;\n\t},\n\n\tgetHTML: function() {\n\t\treturn \tthis._textArea.innerHTML;\n\t},\n\n\t_wrapContent: function(content) {\n\t\tvar wrappedContent = this.hasAccessibilitySupport()\n\t\t\t? '<span id=\"readable-content\" aria-hidden=\"false\">' + content + '</span>'\n\t\t\t: content;\n\t\treturn content.length === 0\n\t\t\t? this._initialContent\n\t\t\t: this._preSpaceChar + wrappedContent + this._postSpaceChar;\n\t},\n\n\tresetContent: function() {\n\t\tthis._textArea.innerHTML = this._initialContent;\n\t},\n\n\t// Convert an array of Unicode code points to a string of UTF-16 code units. Workaround\n\t// for String.fromCodePoint() that is missing in IE.\n\tcodePointsToString: function(codePoints) {\n\t\tvar result = '';\n\t\tfor (var i = 0; i < codePoints.length; ++i) {\n\t\t\tif (codePoints[i] <= 0xFFFF)\n\t\t\t\tresult = (result +\n\t\t\t\t\tString.fromCharCode(codePoints[i]));\n\t\t\telse\n\t\t\t\tresult = (result +\n\t\t\t\t\tString.fromCharCode(((codePoints[i] - 0x10000) >> 10) + 0xD800) +\n\t\t\t\t\tString.fromCharCode(((codePoints[i] - 0x10000) % 0x400) + 0xDC00));\n\t\t}\n\t\treturn result;\n\t},\n\n\t// As the name says, this returns this._textArea.value as an array of numbers that are\n\t// Unicode code points. *Not* UTF-16 code units.\n\tgetValueAsCodePoints: function(value) {\n\t\t// this._logCharCodeSequence(value);\n\t\tvar arr = [];\n\t\tvar code;\n\t\tfor (var i = 0; i < value.length; ++i)\n\t\t{\n\t\t\tcode = value.charCodeAt(i);\n\t\t\tarr.push(code);\n\t\t}\n\t\treturn arr;\n\t},\n\n\tupdate: function() {\n\t\tif (this._container && this._map && this._latlng) {\n\t\t\tvar position = this._map.latLngToLayerPoint(this._latlng).round();\n\t\t\tthis._setPos(position);\n\t\t}\n\t},\n\n\t_initLayout: function() {\n\t\tthis._container = L.DomUtil.create('div', 'clipboard-container');\n\t\tthis._container.id = 'doc-clipboard-container';\n\t\t// The textarea allows the keyboard to pop up and so on.\n\t\t// Note that the contents of the textarea are NOT deleted on each composed\n\t\t// word, in order to make\n\t\tthis._textArea = L.DomUtil.create('div', 'clipboard', this._container);\n\t\tthis._textArea.id = 'clipboard-area';\n\t\tthis._textArea.setAttribute('contenteditable', 'true');\n\t\tthis._textArea.setAttribute('autocapitalize', 'off');\n\t\tthis._textArea.setAttribute('autofocus', 'true');\n\t\tthis._textArea.setAttribute('autocorrect', 'off');\n\t\tthis._textArea.setAttribute('autocomplete', 'off');\n\t\tthis._textArea.setAttribute('spellcheck', 'false');\n\n\t\tthis._textAreaLabel = L.DomUtil.create('label', 'visuallyhidden', this._container);\n\t\tthis._textAreaLabel.setAttribute('for', 'clipboard-area');\n\t\tthis._textAreaLabel.innerHTML = 'clipboard area';\n\t\tif (this.hasAccessibilitySupport()) {\n\t\t\tthis._setSelectionFlag(false);\n\t\t}\n\n\t\t// Prevent automatic line breaks in the textarea. Without this,\n\t\t// chromium/blink will trigger input/insertLineBreak events by\n\t\t// just adding whitespace.\n\t\t// See https://developer.mozilla.org/en-US/docs/Web/HTML/Element/textarea#attr-wrap\n\t\tthis._textArea.setAttribute('wrap', 'off');\n\n\t\t// Prevent autofocus\n\t\tthis._textArea.setAttribute('disabled', true);\n\n\t\tif (L.Browser.cypressTest) {\n\t\t\tvar that = this;\n\t\t\tthis._textArea._hasAccessibilitySupport = function() {\n\t\t\t\treturn that.hasAccessibilitySupport();\n\t\t\t};\n\t\t\tthis._textArea._wrapContent = function(content) {\n\t\t\t\treturn that._wrapContent(content);\n\t\t\t};\n\t\t\tthis._textArea._getSelectionStart = function() {\n\t\t\t\treturn that._getSelectionStart();\n\t\t\t};\n\t\t\tthis._textArea._getSelectionEnd = function() {\n\t\t\t\treturn that._getSelectionEnd();\n\t\t\t};\n\t\t}\n\n\t\tthis._setupStyles();\n\n\t\tthis._emptyArea();\n\n\t\tif (!this.hasAccessibilitySupport()) {\n\t\t\tvar warningMessage =\n\t\t\t\t_('Screen reader support for text content is disabled. ') +\n\t\t\t\t_('You need to enable it both at server level and in the UI. ') +\n\t\t\t\t_('Look for the accessibility section in coolwsd.xml for server setting. ') +\n\t\t\t\t_('Also check the voice over toggle under {parentControl}.').replace(\n\t\t\t\t\t'{parentControl}',\n\t\t\t\t\twindow.userInterfaceMode === 'notebookbar' ? _('the Help tab') : _('the View menu')\n\t\t\t\t);\n\t\t\tthis._textArea.setAttribute('aria-description', warningMessage);\n\t\t}\n\t},\n\n\t_setupStyles: function() {\n\t\tif (this._isDebugOn) {\n\t\t\t// Style for debugging\n\t\t\tthis._container.style.opacity = 0.5;\n\t\t\tthis._textArea.style.cssText = 'border:1px solid red !important';\n\t\t\tthis._textArea.style.width = L.Browser.cypressTest ? '1px' : '120px';\n\t\t\tthis._textArea.style.height = L.Browser.cypressTest ? '1px' : '50px';\n\t\t\tthis._textArea.style.overflow = 'display';\n\n\t\t\tthis._textArea.style.fontSize = '20px';\n\t\t\tthis._textArea.style.position = 'relative';\n\t\t\tthis._textArea.style.left = '10px';\n\t\t} else {\n\t\t\tthis._container.style.opacity = 0;\n\t\t\tthis._textArea.style.width = '1px';\n\t\t\tthis._textArea.style.height = '1px';\n\t\t\tthis._textArea.style.caretColor = 'transparent';\n\t\t\tthis._textArea.style.resize = 'none';\n\t\t}\n\t\tthis._textArea.style['white-space'] = 'pre';\n\t},\n\n\tdebug: function(debugOn) {\n\t\tthis._isDebugOn = !!debugOn;\n\t\tthis._setupStyles();\n\t},\n\n\tactiveElement: function() {\n\t\treturn this._textArea;\n\t},\n\n\t// Displays the caret and the under-caret marker.\n\t// Fetches the coordinates of the caret from the map's doclayer.\n\tshowCursor: function() {\n\t\tif (!this._map._docLayer._cursorMarker || app.tile.size.x === 0) {\n\t\t\treturn;\n\t\t}\n\n\t\t// Fetch top and bottom coords of caret\n\t\tvar top = this._map._docLayer._twipsToLatLng({ x: app.file.textCursor.rectangle.x1, y: app.file.textCursor.rectangle.y1 });\n\t\tvar bottom = this._map._docLayer._twipsToLatLng({ x: app.file.textCursor.rectangle.x1, y: app.file.textCursor.rectangle.y2 });\n\n\t\tif (!this._map._docLayer._cursorMarker.isDomAttached()) {\n\t\t\t// Display caret\n\t\t\tthis._map._docLayer._cursorMarker.add();\n\t\t}\n\t\tthis._map._docLayer._cursorMarker.setMouseCursorForTextBox();\n\n\t\t// Move and display under-caret marker\n\n\t\tif (window.touch.currentlyUsingTouchscreen() && this._map._docLayer._textCSelections.empty()) {\n\t\t\tthis._cursorHandler.setLatLng(bottom).addTo(this._map);\n\t\t} else {\n\t\t\tthis._map.removeLayer(this._cursorHandler);\n\t\t}\n\n\t\t// Move the hidden text area with the cursor\n\t\tthis._latlng = L.latLng(top);\n\t\tthis.update();\n\t\t// shape handlers hidden (if selected)\n\t\tthis._map.fire('handlerstatus', {hidden: true});\n\t\tif (this._map._docLoaded && this._map.getDocType() === 'spreadsheet')\n\t\t\tthis._map.onFormulaBarFocus();\n\t},\n\n\t// Hides the caret and the under-caret marker.\n\thideCursor: function() {\n\t\tif (!this._map._docLayer._cursorMarker) {\n\t\t\treturn;\n\t\t}\n\t\tif (this._map._docLayer._cursorMarker.isDomAttached())\n\t\t\tthis._map._docLayer._cursorMarker.remove();\n\t\tthis._map.removeLayer(this._cursorHandler);\n\t\t// shape handlers visible again (if selected)\n\t\tthis._map.fire('handlerstatus', {hidden: false});\n\t},\n\n\t_setPos: function(pos) {\n\t\t// the offset is needed since we have to move away from the edited text\n\t\t// or double clicks for selecting text doesn't work properly\n\t\tif (L.Browser.cypressTest) {\n\t\t\t// Some cypress tests require for the editable area to be as near as possible\n\t\t\t// to the caret overlay when editing. In fact a synthetic mouse click on\n\t\t\t// the editable area is performed in order to make it focused and ready for the input.\n\t\t\t// However, since this click is forwarded to core, it could change the current caret\n\t\t\t// position causing a test failure.\n\t\t\tpos.x += 10;\n\t\t\tpos.y += 10;\n\t\t}\n\t\telse {\n\t\t\tpos.y += this._isDebugOn ? 50 : 200;\n\t\t}\n\t\tL.DomUtil.setPosition(this._container, pos);\n\t},\n\n\t// Generic handle attached to most text area events, just for debugging purposes.\n\t_onEvent: function(ev) {\n\t\tif (this._map.uiManager.isUIBlocked())\n\t\t\treturn;\n\t\tvar msg = {\n\t\t\tinputType: ev.inputType,\n\t\t\tdata: ev.data,\n\t\t\tkey: ev.key,\n\t\t\tisComposing: ev.isComposing\n\t\t};\n\n\t\tif ('key' in ev) {\n\t\t\tmsg.key = ev.key;\n\t\t\tmsg.keyCode = ev.keyCode;\n\t\t\tmsg.code = ev.code;\n\t\t\tmsg.which = ev.which;\n\t\t}\n\t\tthis._fancyLog(ev.type, msg);\n\t},\n\n\t_fancyLog: function(type, payload) {\n\t\t// Avoid unhelpful exceptions\n\t\tif (payload === undefined)\n\t\t\tpayload = 'undefined';\n\t\telse if (payload === null)\n\t\t\tpayload = 'null';\n\n\t\t// Pretty-print on console (but only if \"tile layer debug mode\" is active)\n\t\tif (this._isDebugOn) {\n\t\t\tvar state = this._isComposing ? 'C' : 'N';\n\t\t\tstate += this._hasWorkingSelectionStart ? 'S' : '-';\n\t\t\tstate += this._ignoreNextBackspace ? 'I' : '-';\n\t\t\tstate += ' ';\n\n\t\t\tvar textSel = this._getSelectionStart() + '!' + this._getSelectionEnd();\n\t\t\tstate += textSel + ' ';\n\n\t\t\tvar sel = window.getSelection();\n\t\t\tvar content = this.getValue();\n\t\t\tif (sel === null)\n\t\t\t\tstate += '-1';\n\t\t\telse\n\t\t\t{\n\t\t\t\tstate += sel.rangeCount;\n\n\t\t\t\tstate += ' ';\n\t\t\t\tvar cursorPos = -1;\n\t\t\t\tfor (var i = 0; i < sel.rangeCount; ++i)\n\t\t\t\t{\n\t\t\t\t\tvar range = sel.getRangeAt(i);\n\t\t\t\t\tstate += range.startOffset + '-' + range.endOffset + ' ';\n\t\t\t\t\tif (cursorPos < 0)\n\t\t\t\t\t\tcursorPos = range.startOffset;\n\t\t\t\t}\n\t\t\t\tif (sel.toString() !== '')\n\t\t\t\t\tstate += ': \"' + sel.toString() + '\" ';\n\n\t\t\t\t// inject probable cursor\n\t\t\t\tif (cursorPos >= 0)\n\t\t\t\t\tcontent = content.slice(0, cursorPos) + '|' + content.slice(cursorPos);\n\t\t\t}\n\n\t\t\tstate += '[' + this._deleteHint + '] ';\n\n\t\t\twindow.app.console.log(\n\t\t\t\t+ new Date() + ' %cINPUT%c: ' + state\n\t\t\t\t+ '\"' + content + '\" ' + type + '%c ',\n\t\t\t\t'background:#bfb;color:black',\n\t\t\t\t'color:green',\n\t\t\t\t'color:black',\n\t\t\t\tJSON.stringify(payload)\n\t\t\t);\n\t\t}\n\t},\n\n\t_handleMisplacedCursorAtBeginning: function(ev) {\n\t\t// It seems some inputs e.g. GBoard can magically move the cursor from \" | \" to \"|  \"\n\t\twindow.app.console.log('Oh dear, gboard sabotaged our cursor position, fixing');\n\t\t// But when we detect the problem only emit a delete when we have one.\n\t\tif (ev.inputType && ev.inputType === 'deleteContentBackward')\n\t\t{\n\t\t\tthis._removeTextContent(1, 0);\n\t\t\t// Having mended it we now get a real backspace on input (sometimes)\n\t\t\tthis._ignoreNextBackspace = true;\n\t\t}\n\t\telse if (this.hasAccessibilitySupport()) {\n\t\t\tthis._setCursorPosition(this._getLastCursorPosition());\n\t\t}\n\t\tif (!this.hasAccessibilitySupport()) {\n\t\t\tthis._emptyArea();\n\t\t}\n\t},\n\n\t// Backspaces and deletes at the beginning / end are filtered out, so\n\t// we get a beforeinput, but no input for them. Sometimes we can end up\n\t// in a state where we lost our leading / terminal chars and can't recover\n\t_onBeforeInput: function(ev) {\n\t\tif (this._map.uiManager.isUIBlocked())\n\t\t\treturn;\n\t\tthis._statusLog('_onBeforeInput [');\n\t\tthis._ignoreNextBackspace = false;\n\t\tif (!this._isSelectionValid()) {\n\t\t\tthis._emptyArea();\n\t\t}\n\t\telse if (this._isInitialContent() && this._isCursorAtBeginning()) {\n\t\t\tthis._handleMisplacedCursorAtBeginning(ev);\n\t\t}\n\t\t// Firefox is not able to delete the <img> post space. Since no 'input' event is generated,\n\t\t// we need to handle a <delete> at the end of the paragraph, here.\n\t\tif (L.Browser.gecko && this._isCursorAtEnd() && this._deleteHint === 'delete') {\n\t\t\tif (this._map._debug.logKeyboardEvents) {\n\t\t\t\twindow.app.console.log('Sending delete');\n\t\t\t}\n\t\t\tthis._removeTextContent(0, 1);\n\t\t\tthis._emptyArea();\n\t\t}\n\t\tthis._statusLog('_onBeforeInput ]');\n\t},\n\n\t_isDigit: function(asciiChar) {\n\t\treturn asciiChar >= 48 && asciiChar <= 57;\n\t},\n\n\t_hasFormulaBarFocus: function() {\n\t\treturn \tthis._map && this._map.formulabar && this._map.formulabar.hasFocus();\n\t},\n\n\t// Fired when text has been entered, *during* and after composing/spellchecking\n\t_onInput: function(ev) {\n\t\tif (this._map.uiManager.isUIBlocked())\n\t\t\treturn;\n\t\tthis._statusLog('_onInput [');\n\t\tapp.idleHandler.notifyActive();\n\n\t\tif (this._ignoreInputCount > 0) {\n\t\t\twindow.app.console.log('ignoring synthetic input ' + this._ignoreInputCount);\n\t\t\treturn;\n\t\t}\n\n\t\tif (this._deleteHint === '' && ev.inputType) {\n\t\t\tif (ev.inputType === 'deleteContentForward')\n\t\t\t\tthis._deleteHint = 'delete';\n\t\t\telse if (ev.inputType === 'deleteContentBackward')\n\t\t\t\tthis._deleteHint = 'backspace';\n\t\t}\n\n\t\tvar ignoreBackspace = this._ignoreNextBackspace;\n\t\tthis._ignoreNextBackspace = false;\n\n\t\tif (this._newlineHint) {\n\t\t\tthis._sendNewlineEvent();\n\t\t\treturn;\n\t\t}\n\n\t\t// We use a different leading and terminal space character\n\t\t// to differentiate backspace from delete, then replace the character.\n\t\tif (!this._hasPreSpace()) { // missing initial space\n\t\t\tif (this._map._debug.logKeyboardEvents) {\n\t\t\t\twindow.app.console.log('Sending backspace');\n\t\t\t}\n\t\t\tif (!ignoreBackspace)\n\t\t\t\tthis._removeTextContent(1, 0);\n\t\t\tthis._emptyArea();\n\t\t\treturn;\n\t\t}\n\t\tif (!this._hasPostSpace()) { // missing trailing space.\n\t\t\tif (this._map._debug.logKeyboardEvents) {\n\t\t\t\twindow.app.console.log('Sending delete');\n\t\t\t}\n\t\t\tthis._removeTextContent(0, 1);\n\t\t\tthis._emptyArea();\n\t\t\treturn;\n\t\t}\n\n\t\tvar value = this.getValue();\n\t\tvar content = this.getValueAsCodePoints(value);\n\t\t// Note that content is an array of Unicode code points\n\n\t\t// In the android keyboard when you try to erase in an empty area\n\t\t// and then enter some character,\n\t\t// The first character will likely travel with the cursor,\n\t\t// And that is caused because after entering the first character\n\t\t// cursor position is never updated by keyboard (I know it is strange)\n\t\t// so here we manually correct the position\n\t\tif (window.mode.isMobile() && content.length === 1 && this._lastContent.length === 0)\n\t\t\tthis._setCursorPosition(1);\n\n\t\tvar matchTo = 0;\n\t\tvar sharedLength = Math.min(content.length, this._lastContent.length);\n\t\twhile (matchTo < sharedLength && content[matchTo] === this._lastContent[matchTo])\n\t\t\tmatchTo++;\n\n\t\tif (this._map._debug.logKeyboardEvents) {\n\t\t\twindow.app.console.log('Comparison matchAt ' + matchTo + '\\n' +\n\t\t\t\t'\\tnew \"' + this.codePointsToString(content) + '\" (' + content.length + ')' + '\\n' +\n\t\t\t\t'\\told \"' + this.codePointsToString(this._lastContent) + '\" (' + this._lastContent.length + ')');\n\t\t}\n\n\t\tvar removeBefore = this._lastContent.length - matchTo;\n\t\tvar removeAfter = 0;\n\n\t\tif (this._lastContent.length > content.length)\n\t\t{\n\t\t\t// Pressing '<space><delete>' can delete our terminal space\n\t\t\t// such that subsequent deletes will do nothing; need to\n\t\t\t// detect and reset in this case.\n\t\t\tif (this._deleteHint === 'delete')\n\t\t\t{\n\t\t\t\tremoveBefore--;\n\t\t\t\tremoveAfter++;\n\t\t\t}\n\t\t}\n\n\t\tif (removeBefore > 0 || removeAfter > 0)\n\t\t\tthis._removeTextContent(removeBefore, removeAfter);\n\n\t\tvar newText = content;\n\t\tif (matchTo > 0)\n\t\t\tnewText = newText.slice(matchTo);\n\n\t\tthis._lastContent = content;\n\n\t\tif (newText.length > 0) {\n\t\t\tthis._sendNewText(ev, content, newText);\n\t\t}\n\n\t\t// was a 'delete' and we need to reset world.\n\t\tif (removeAfter > 0)\n\t\t\tthis._emptyArea();\n\n\t\t// special handling for formula bar\n\t\tthis._finishFormulabarEditing(content, matchTo);\n\n\t\t// special handling for mentions\n\t\tif (this._map.getDocType() === 'text') {\n\t\t\tconst contentStr = this.codePointsToString(content);\n\t\t\tconst newPara = contentStr.length === 1;\n\t\t\tthis._map.mention.handleMentionInput(ev, newPara);\n\t\t}\n\n\t\tthis._statusLog('_onInput ]');\n\t},\n\n\t_sendNewText: function (ev, content, newText) {\n\t\t// When the cell formatted as percent, to trig percentage sign addition\n\t\t// automatically we send the first digit character as KeyEvent.\n\t\tif (this._map.getDocType() === 'spreadsheet' &&\n\t\t\tcontent.length === 1 && ev.inputType === 'insertText' &&\n\t\t\tthis._isDigit(newText) && window.mode.isDesktop()) {\n\t\t\tthis._sendKeyEvent(newText, this._unoKeyMap[newText], 'input');\n\t\t}\n\t\telse {\n\t\t\tthis._sendText(this.codePointsToString(newText));\n\t\t}\n\t},\n\n\t_finishFormulabarEditing: function(content, matchTo) {\n\t\tif (this._hasFormulaBarFocus() && content.length) {\n\t\t\tvar contentString = this.codePointsToString(content);\n\t\t\tif (contentString[matchTo] === '\\n' || contentString.charCodeAt(matchTo) === 13) {\n\t\t\t\tapp.dispatcher.dispatch('acceptformula');\n\t\t\t}\n\t\t}\n\t},\n\n\t// Sends the given (UTF-8) string of text to coolwsd, as IME (text composition)\n\t// messages\n\t_sendText: function(text) {\n\t\t// this._logCharCodeSequence(text);\n\t\tthis._fancyLog('send-text-to-coolwsd', text);\n\n\t\t// MSIE/Edge cannot compare a string to \"\\n\" for whatever reason,\n\t\t// so compare charcode as well\n\t\tif (text === '\\n' || (text.length === 1 && text.charCodeAt(0) === 13)) {\n\t\t\tthis._sendNewlineEvent();\n\t\t} else {\n\t\t\t// The composition messages doesn't play well with line breaks inside\n\t\t\t// the composed word (e.g. word and a newline are queued client-side\n\t\t\t// and are sent together), therefore split and send keystrokes accordingly.\n\n\t\t\tvar parts = text.split(/[\\n\\r]/);\n\t\t\tvar l = parts.length;\n\t\t\tfor (var i = 0; i < l; i++) {\n\t\t\t\tif (i !== 0) {\n\t\t\t\t\tthis._sendKeyEvent(13, 1280);\n\t\t\t\t\tif (!this.hasAccessibilitySupport()) {\n\t\t\t\t\t\tthis._emptyArea();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (parts[i].length > 0) {\n\t\t\t\t\tthis._sendCompositionEvent(parts[i]);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t},\n\n\t// Empties the textarea / contenteditable element.\n\t// If the browser supports the 'inputType' property on 'input' events, then\n\t// add empty spaces to the textarea / contenteditable, in order to\n\t// always catch deleteContentBackward/deleteContentForward input events\n\t// (some combination of browser + input method don't fire those on an\n\t// empty contenteditable).\n\t_emptyArea: function(noSelect) {\n\t\tthis._statusLog('_emptyArea [');\n\t\tthis._fancyLog('empty-area');\n\n\t\tthis._ignoreInputCount++;\n\t\t// Note: 0xA0 is 160, which is the character code for non-breaking space:\n\t\t// https://www.fileformat.info/info/unicode/char/00a0/index.htm\n\n\t\t// Using normal spaces would make FFX/Gecko collapse them into an\n\t\t// empty string.\n\t\t// FIXME: is that true !? ...\n\n\t\t// window.app.console.log('Set old/lastContent to empty');\n\t\tthis._lastContent = [];\n\t\tif (this.hasAccessibilitySupport()) {\n\t\t\tthis._setLastCursorPosition(0);\n\t\t}\n\n\t\tthis.resetContent();\n\n\t\t// avoid setting the focus keyboard\n\t\tif (!noSelect && document.getElementById(this._textArea.id)) {\n\t\t\tthis._setCursorPosition(0);\n\t\t\tif (this._hasWorkingSelectionStart === undefined)\n\t\t\t\tthis._hasWorkingSelectionStart = (this._getSelectionStart() === 0);\n\t\t}\n\n\t\tthis._fancyLog('empty-area-end');\n\t\tthis._statusLog('_emptyArea ]');\n\t\tthis._ignoreInputCount--;\n\t},\n\n\t_onCompositionStart: function(/*ev*/) {\n\t\tthis._isComposing = true;\n\t},\n\n\t// Handled only in legacy situations ('input' events with an inputType\n\t// property are preferred).\n\t_onCompositionUpdate: function(ev) {\n\t\tapp.idleHandler.notifyActive();\n\t\tthis._onInput(ev);\n\t},\n\n\t// Chrome doesn't fire any \"input/insertCompositionText\" with \"isComposing\" set to false.\n\t// Instead , it fires non-standard \"textInput\" events, but those can be tricky\n\t// to handle since Chrome also fires \"input/insertText\" events.\n\t// The approach here is to use \"compositionend\" events *only in Chrome* to mark\n\t// the composing text as committed to the text area.\n\t_onCompositionEnd: function(ev) {\n\t\tapp.idleHandler.notifyActive();\n\t\tthis._isComposing = false;\n\t\tif (ev.data && ev.data.charCodeAt(ev.data.length-1) === 10) // 10 === charCode('\\n')\n\t\t\tthis._newlineHint = true;\n\t\tif (this.hasAccessibilitySupport()) {\n\t\t\tif (!this._isWrappedBySpan()) {\n\t\t\t\tthis._restoreSpanWrapper();\n\t\t\t}\n\t\t}\n\t\tthis._onInput(ev);\n\t\tif (this.hasAccessibilitySupport()) {\n\t\t\tthis._updateFocusedParagraph();\n\t\t}\n\t},\n\n\t// Called when the user goes back to a word to spellcheck or replace it,\n\t// on a timeout.\n\t// Very difficult to handle right now, so the strategy is to panic and\n\t// empty the text area.\n\t_abortComposition: function(ev) {\n\t\tthis._fancyLog('abort-composition', ev.type);\n\t\tif (this._isComposing)\n\t\t\tthis._isComposing = false;\n\t\tif (this.hasAccessibilitySupport()) {\n\t\t\tthis._isLeftRightArrow = 0;\n\t\t\tthis._updateFocusedParagraph();\n\t\t\tthis._requestFocusedParagraph();\n\t\t} else {\n\t\t\tthis._emptyArea(document.activeElement !== this._textArea);\n\t\t}\n\t},\n\n\t_handleKeyDownForPopup: function (ev, id) {\n\t\tvar popup = L.DomUtil.get(id);\n\t\tif (popup) {\n\t\t\tconst entries = document.querySelectorAll('#' + id + ' span.ui-treeview-cell');\n\t\t\tif (ev.key === 'ArrowDown') {\n\t\t\t\tconst initialFocusElement = entries[0];\n\t\t\t\tif (initialFocusElement) {\n\t\t\t\t\tinitialFocusElement.tabIndex = 0;\n\t\t\t\t\tinitialFocusElement.focus();\n\t\t\t\t\tev.preventDefault();\n\t\t\t\t\tev.stopPropagation();\n\t\t\t\t}\n\t\t\t} else if (ev.key === 'Enter' && entries.length === 1) {\n\t\t\t\t\tconst event = new KeyboardEvent('keydown', {\n\t\t\t\t\t\tkey: 'Enter',\n\t\t\t\t\t\tbubbles: true,\n\t\t\t\t\t\tcancelable: true,\n\t\t\t\t\t});\n\t\t\t\t\tentries[0].dispatchEvent(event);\n\t\t\t\t\tev.preventDefault();\n\t\t\t\t\tev.stopPropagation();\n\t\t\t} else if (ev.key === 'ArrowLeft' || ev.key === 'ArrowRight' ||\n\t\t\t\tev.key === 'ArrowUp' || ev.key === 'Home' ||\n\t\t\t\tev.key === 'End' || ev.key === 'PageUp' ||\n\t\t\t\tev.key === 'PageDown' || ev.key === 'Enter' ||\n\t\t\t\tev.key === 'Escape' || ev.key === 'Control' ||\n\t\t\t\tev.key === 'Tab') {\n\n\t\t\t\tif (id === 'mentionPopup')\n\t\t\t\t\tthis._map.mention.closeMentionPopup(false);\n\t\t\t\telse if (id === 'formulaautocompletePopup')\n\t\t\t\t\tthis._map.fire('closepopup');\n\t\t\t}\n\t\t}\n\t\treturn popup;\n\t},\n\n\t_onKeyDown: function(ev) {\n\t\tif (this._map.uiManager.isUIBlocked())\n\t\t\treturn;\n\n\t\tif (app.UI.notebookbarAccessibility)\n\t\t\tapp.UI.notebookbarAccessibility.onDocumentKeyDown(ev);\n\n\t\tif (ev.keyCode === 8)\n\t\t\tthis._deleteHint = 'backspace';\n\t\telse if (ev.keyCode === 46)\n\t\t\tthis._deleteHint = 'delete';\n\t\telse {\n\t\t\tthis._deleteHint = '';\n\t\t}\n\t\tthis._newlineHint = ev.keyCode === 13;\n\t\tthis._linebreakHint = this._newlineHint && ev.shiftKey;\n\n\t\t// In Firefox 117 up to 120 no copy/cut input event is emitted when CTRL+C/X is pressed\n\t\t// with no selection in a text element with contenteditable='true'. Since no copy/cut event\n\t\t// is emitted, Clipboard.copy/cut is never invoked. So we need to emit it manually.\n\t\t// To be honest it seems a Firefox bug. We need to check if they fix it in later version.\n\t\tif (!this.hasAccessibilitySupport() && !L.Browser.win &&\n\t\t\tL.Browser.gecko && L.Browser.geckoVersion >= '117.0' && L.Browser.geckoVersion <= '120.0' &&\n\t\t\tev.ctrlKey && window.getSelection().isCollapsed) {\n\t\t\tif (ev.key === 'c') {\n\t\t\t\tdocument.execCommand('copy');\n\t\t\t}\n\t\t\telse if (ev.key === 'x') {\n\t\t\t\tdocument.execCommand('cut');\n\t\t\t}\n\t\t}\n\n\t\tif (this.hasAccessibilitySupport()) {\n\t\t\tif ((this._hasAnySelection && !this._isEditingInSelection && this._map.getDocType() !== 'spreadsheet') ||\n\t\t\t\t(!this._hasAnySelection && this._map.getDocType() === 'presentation')) {\n\t\t\t\tif (!L.Browser.cypressTest) {\n\t\t\t\t\tvar allowedKeyEvent =\n\t\t\t\t\t\tthis._map.keyboard.allowedKeyCodeWhenNotEditing[ev.keyCode] ||\n\t\t\t\t\t\tev.ctrlKey ||\n\t\t\t\t\t\tev.altKey ||\n\t\t\t\t\t\t(this._newlineHint && ev.shiftKey);\n\t\t\t\t\tif (!allowedKeyEvent) {\n\t\t\t\t\t\twindow.console.log('TextInput._onKeyDown: any input default prevented since no shape editing is active.');\n\t\t\t\t\t\tev.preventDefault();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\t// In order to allow screen reader to track caret navigation properly even if there is some connection delay\n\t\t\t// default behaviour for Left/Right arrow key press is no more prevented in Map.Keyboard._handleKeyEvent,\n\t\t\t// Here we set _isLeftRightArrow flag and handle some special cases.\n\t\t\telse {\n\t\t\t\tthis._isLeftRightArrow = 0;\n\t\t\t\tif (ev.key === 'ArrowLeft') {\n\t\t\t\t\tthis._isLeftRightArrow = -1;\n\t\t\t\t} else if (ev.key === 'ArrowRight') {\n\t\t\t\t\tthis._isLeftRightArrow = 1;\n\t\t\t\t}\n\n\t\t\t\t// If we are at paragraph begin/end and left/right arrow is pressed, we need to prevent default behaviour\n\t\t\t\tif (this._isLeftRightArrow) {\n\t\t\t\t\tclearTimeout(this._onNavigationEndTimeout);\n\t\t\t\t\tif (!this._isSelectionValid() || this._isComposing ||\n\t\t\t\t\t\t(this._isLeftRightArrow > 0 && this._isCursorAtEnd()) ||\n\t\t\t\t\t\t(this._isLeftRightArrow < 0 && this._isCursorAtStart())) {\n\t\t\t\t\t\tthis._log('_onKeyDown: preventDefault');\n\t\t\t\t\t\tev.preventDefault();\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (this._isLeftRightArrow) {\n\t\t\t\t\tif (this._listPrefixLength > 0) {\n\t\t\t\t\t\tvar cursorPosition = this._getSelectionEnd();\n\t\t\t\t\t\tif (cursorPosition === this._listPrefixLength && this._isLeftRightArrow < 0) {\n\t\t\t\t\t\t\t// if caret is at begin of list entry content: \"1. |Item 1\" and shift+left arrow is pressed,\n\t\t\t\t\t\t\t// then caret is moved at the end of previous paragraph, if any; or it's not moved at all\n\t\t\t\t\t\t\t// if we are at the document beginning; so we only need to prevent default behaviour\n\t\t\t\t\t\t\tev.preventDefault();\n\t\t\t\t\t\t\tif (!ev.shiftKey) {\n\t\t\t\t\t\t\t\t// when shift is not pressed, caret is moved ahead of list prefix: \"|1. Item 1\",\n\t\t\t\t\t\t\t\t// selection is cleared, if any\n\t\t\t\t\t\t\t\tthis._updateCursorPosition(0);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\t// if caret is ahead of list prefix: \"|1. Item 1\" and right arrow is pressed, with or without shift,\n\t\t\t\t\t\t// caret is moved at begin of list entry content: \"1. |Item 1\", nothing is selected\n\t\t\t\t\t\tif (cursorPosition === 0 && this._isLeftRightArrow > 0) {\n\t\t\t\t\t\t\tev.preventDefault();\n\t\t\t\t\t\t\tthis._updateCursorPosition(this._listPrefixLength);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\t// When left/right arrow is pressed and text is selected, selection is cleared\n\t\t\t\t\t// and caret needs to be moved by one char left/right.\n\t\t\t\t\t// However, for an editable div the behaviour is different:\n\t\t\t\t\t// - when left arrow is pressed caret moves at start of previously selected text\n\t\t\t\t\t// - when right arrow is pressed caret moves at end of previously selected text\n\t\t\t\t\t// So we need to prevent default behaviour and simulate the same behaviour that occurs in LibreOffice.\n\t\t\t\t\tif (!ev.shiftKey) {\n\t\t\t\t\t\tvar selection = window.getSelection();\n\t\t\t\t\t\tif (!selection.isCollapsed) {\n\t\t\t\t\t\t\t// The case where a left arrow is pressed with caret at the beginning of a list entry content\n\t\t\t\t\t\t\t// is already handled earlier.\n\t\t\t\t\t\t\tif (!(this._listPrefixLength > 0 &&\n\t\t\t\t\t\t\t\tthis._lastCursorPosition === this._listPrefixLength && this._isLeftRightArrow < 0)) {\n\t\t\t\t\t\t\t\tthis._log('_onKeyDown: pressed left/right arrows with selected text');\n\t\t\t\t\t\t\t\tev.preventDefault();\n\t\t\t\t\t\t\t\tvar pos = this._lastCursorPosition + this._isLeftRightArrow;\n\t\t\t\t\t\t\t\t// _updateCursorPosition takes care to normalize pos value\n\t\t\t\t\t\t\t\tthis._updateCursorPosition(pos);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// We want to open drowdown menu when cursor is above a dropdown content control.\n\t\tif (ev.code === 'Space' || ev.code === 'Enter') {\n\t\t\tif (this._map['stateChangeHandler'].getItemValue('.uno:ContentControlProperties') === 'enabled') {\n\t\t\t\tif (app.sectionContainer.doesSectionExist(L.CSections.ContentControl.name)) {\n\t\t\t\t\tvar section = app.sectionContainer.getSectionWithName(L.CSections.ContentControl.name);\n\t\t\t\t\tif (section.sectionProperties.dropdownSection)\n\t\t\t\t\t\tsection.sectionProperties.dropdownSection.onClick(null, ev);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (ev.altKey && ev.code === 'KeyC') {\n\t\t\t// We want to focus on the comment menu if a comment is currently shown in Writer or Calc.\n\t\t\t// This is the key combination (Alt+C or Alt+Shift+C) for focusing on the comment menu.\n\n\t\t\t// On Calc, first press opens the comment, second press focuses on it.\n\t\t\tsection = app.sectionContainer.getSectionWithName(L.CSections.CommentList.name);\n\t\t\tif (section) {\n\t\t\t\tif (section.sectionProperties.selectedComment) {\n\t\t\t\t\tvar id = section.sectionProperties.selectedComment.sectionProperties.menu.id;\n\t\t\t\t\tvar element = document.getElementById(id);\n\t\t\t\t\tif (element)\n\t\t\t\t\t\telement.focus();\n\t\t\t\t}\n\t\t\t\telse if (this._map._docLayer._docType === 'spreadsheet') {\n\t\t\t\t\tif (section.sectionProperties.calcCurrentComment !== null)\n\t\t\t\t\t\tsection.sectionProperties.calcCurrentComment.show();\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tthis._handleKeyDownForPopup(ev, 'mentionPopup');\n\t\tthis._handleKeyDownForPopup(ev, 'formulaautocompletePopup');\n\t},\n\n\t// Check arrow keys on 'keyup' event; using 'ArrowLeft' or 'ArrowRight'\n\t// shall empty the textarea, to prevent FFX/Gecko from ever not having\n\t// whitespace around the caret.\n\t// Across browsers, arrow up/down / home / end would move the caret to\n\t// the beginning/end of the textarea/contenteditable.\n\t_onKeyUp: function(ev) {\n\t\tif (this._map.uiManager.isUIBlocked())\n\t\t\treturn;\n\n\t\tapp.idleHandler.notifyActive();\n\t\tif (!this.hasAccessibilitySupport() && !this._isComposing &&\n\t\t\t(ev.key === 'ArrowLeft' || ev.key === 'ArrowRight' ||\n\t\t\tev.key === 'ArrowUp' || ev.key === 'ArrowDown' ||\n\t\t\tev.key === 'Home' || ev.key === 'End' ||\n\t\t\tev.key === 'PageUp' || ev.key === 'PageDown' ||\n\t\t\tev.key === 'Escape')) {\n\t\t\tthis._emptyArea();\n\t\t}\n\n\t\tif (this.hasAccessibilitySupport()) {\n\t\t\tif (ev.key === 'ArrowLeft' || ev.key === 'ArrowRight') {\n\t\t\t\tclearTimeout(this._onNavigationEndTimeout);\n\t\t\t\tthis._onNavigationEndTimeout = setTimeout(function () {\n\t\t\t\t\tif (this._isLeftRightArrow) {\n\t\t\t\t\t\tthis._isLeftRightArrow = 0;\n\t\t\t\t\t\tthis._updateFocusedParagraph();\n\t\t\t\t\t}\n\t\t\t\t}.bind(this), 1000);\n\t\t\t}\n\t\t\telse if (ev.key === 'Shift') {\n\t\t\t\tif (this._isLeftRightArrow/* && this._remotePosition !== undefined*/) {\n\t\t\t\t\tthis._isLeftRightArrow = 0;\n\t\t\t\t\tthis._updateFocusedParagraph();\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (app.UI.notebookbarAccessibility)\n\t\t\tapp.UI.notebookbarAccessibility.onDocumentKeyUp(ev);\n\t},\n\n\t// Used in the deleteContentBackward for deleting multiple characters with a single\n\t// message.\n\t// Will remove characters from the queue first, if there are any.\n\t_removeTextContent: function(before, after) {\n\t\tif (this._map._debug.logKeyboardEvents) {\n\t\t\twindow.app.console.log('Remove ' + before + ' before, and ' + after + ' after');\n\t\t}\n\n\t\tthis._followMyCursor();\n\n\t\t/// TODO: rename the event to 'removetextcontent' as soon as coolwsd supports it\n\t\t/// TODO: Ask Marco about it\n\t\tapp.socket.sendMessage(\n\t\t\t'removetextcontext id=' +\n\t\t\tthis._map.getWinId() +\n\t\t\t' before=' + before +\n\t\t\t' after=' + after\n\t\t);\n\t},\n\n\t_followMyCursor: function() {\n\t\tif (this._map && this._map.userList)\n\t\tthis._map.userList.followUser(this._map._docLayer._getViewId());\n\t},\n\n\t// Tiny helper - encapsulates sending a 'textinput' websocket message.\n\t// sends a pair of \"input\" for a composition update pair with an \"end\"\n\t_sendCompositionEvent: function(text) {\n\t\t// this._logCharCodeSequence(text);\n\n\t\t// We want to trigger auto-correction, but not if we may\n\t\t// have to delete a count of characters in the future,\n\t\t// which is specific to crazy mobile keyboard / IMEs:\n\t\tif (!window.mode.isMobile() && !window.mode.isTablet() &&\n\t\t\tthis._autoCorrectChars[text])\n\t\t{\n\t\t\tlet codes;\n\n\t\t\tif (app.calc.decimalSeparator && this._map.numPadDecimalPressed) { // decimalSeparator is set only for Calc.\n\t\t\t\tthis._map.numPadDecimalPressed = false;\n\t\t\t\tcodes = this._autoCorrectChars[app.calc.decimalSeparator];\n\t\t\t}\n\t\t\telse codes = this._autoCorrectChars[text];\n\n\t\t\tthis._sendKeyEvent(codes[0], codes[1], 'input');\n\t\t\tthis._sendKeyEvent(codes[2], codes[3], 'up');\n\t\t}\n\t\telse\n\t\t{\n\t\t\tvar encodedText = encodeURIComponent(text);\n\t\t\tvar winId = this._map.getWinId();\n\t\t\tthis._followMyCursor();\n\t\t\tapp.socket.sendMessage(\n\t\t\t\t'textinput id=' + winId + ' text=' + encodedText);\n\t\t}\n\t},\n\n\t// Tiny helper - encapsulates sending a 'key' or 'windowkey' websocket message\n\t// \"type\" can be \"input\" (default) or \"up\"\n\t_sendKeyEvent: function(charCode, unoKeyCode, type) {\n\t\tthis._followMyCursor();\n\t\tif (!type) {\n\t\t\ttype = 'input';\n\t\t}\n\t\tif (this._map.editorHasFocus() || this._hasFormulaBarFocus()) {\n\t\t\tapp.socket.sendMessage(\n\t\t\t\t'key type=' + type + ' char=' + charCode + ' key=' + unoKeyCode + '\\n'\n\t\t\t);\n\t\t} else {\n\t\t\tapp.socket.sendMessage(\n\t\t\t\t'windowkey id=' +\n\t\t\t\tthis._map.getWinId() +\n\t\t\t\t' type=' +\n\t\t\t\ttype +\n\t\t\t\t' char=' +\n\t\t\t\tcharCode +\n\t\t\t\t' key=' +\n\t\t\t\tunoKeyCode +\n\t\t\t\t'\\n'\n\t\t\t);\n\t\t}\n\t},\n\n\t_sendNewlineEvent: function() {\n\t\t// The composition messages doesn't play well with just a line break,\n\t\t// therefore send a keystroke.\n\t\tvar unoKeyCode = this._linebreakHint ? 5376 : 1280;\n\t\tthis._sendKeyEvent(13, unoKeyCode);\n\t\tthis._newlineHint = false;\n\t\tif (this.hasAccessibilitySupport()) {\n\t\t\tvar pos = this._getLastCursorPosition();\n\t\t\tvar empty = this._lastContent.length === 0;\n\t\t}\n\t\tthis._emptyArea();\n\t\tif (this.hasAccessibilitySupport()) {\n\t\t\tthis._setSelectionFlag(false);\n\t\t\tif (pos === 0 && !empty)\n\t\t\t\tthis._requestFocusedParagraph();\n\t\t}\n\t},\n\n\t_onCursorHandlerDragEnd: function(ev) {\n\t\tvar cursorPos = this._map._docLayer._latLngToTwips(ev.target.getLatLng());\n\t\tthis._map._docLayer._postMouseEvent('buttondown', cursorPos.x, cursorPos.y, 1, 1, 0);\n\t\tthis._map._docLayer._postMouseEvent('buttonup', cursorPos.x, cursorPos.y, 1, 1, 0);\n\t},\n\n\t_setCursorPosition: function(pos) {\n\t\ttry {\n\t\t\tthis._setSelectionRange(pos, pos);\n\t\t} catch (err) {\n\t\t\t// old firefox throws an exception on start.\n\t\t}\n\t},\n\n\tsetSwitchedToEditMode: function() {\n\t\tif (this.hasAccessibilitySupport()) {\n\t\t\tthis._justSwitchedToEditMode = true;\n\t\t}\n\t},\n\n\t_setAcceptInput: function(accept) {\n\t\tif (L.Browser.cypressTest && this._textArea) {\n\t\t\t// This is used to track whether we *intended*\n\t\t\t// the keyboard to be visible or hidden.\n\t\t\t// There is no way track the keyboard state\n\t\t\t// programmatically, so the next best thing\n\t\t\t// is to track what we intended to do.\n\t\t\tthis._textArea.setAttribute('data-accept-input', accept);\n\t\t}\n\t\tif (!this.hasAccessibilitySupport()) {\n\t\t\tthis._acceptInput = accept;\n\t\t}\n\t\telse if (this._acceptInput !== accept) {\n\t\t\tthis._acceptInput = accept;\n\t\t\tif (this._justSwitchedToEditMode && accept && this._isInitialContent()) {\n\t\t\t\t// We need to make the paragraph at the cursor position focused in core\n\t\t\t\t// so its content is sent to the editable area.\n\t\t\t\tthis._justSwitchedToEditMode = false;\n\t\t\t\tif (this._map._docLayer && app.file.textCursor.visible) {\n\t\t\t\t\twindow.app.console.log('A11yTextInput._setAcceptInput: going to emit a synthetic click after switching to edit mode.');\n\t\t\t\t\tlet center = app.file.textCursor.rectangle.center;\n\t\t\t\t\tcenter[0] = Math.round(center[0]);\n\t\t\t\t\tcenter[1] = Math.round(center[1]);\n\t\t\t\t\tthis._map._docLayer._postMouseEvent('buttondown', center[0], center[1], 1, 1, 0);\n\t\t\t\t\tthis._map._docLayer._postMouseEvent('buttonup', center[0], center[1], 1, 1, 0);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t},\n\n\t_hasPreSpace: function() {\n\t\tvar child = this._textArea.firstChild;\n\t\treturn child && child.id === 'pre-space';\n\t},\n\n\t_hasPostSpace: function() {\n\t\tvar child = this._textArea.lastChild;\n\t\treturn child && child.id === 'post-space';\n\t},\n\n\t_isInitialContent: function() {\n\t\tvar children = this._textArea.childNodes;\n\t\treturn children.length === 2 && this._hasPreSpace() && this._hasPostSpace();\n\t},\n\n\t_isCursorAtBeginning: function() {\n\t\tvar selection = window.getSelection();\n\t\treturn selection.isCollapsed && this._getSelectionStart() === -1;\n\t},\n\n\t_isSelectionValid: function() {\n\t\treturn typeof this._getSelectionStart() === 'number' && typeof this._getSelectionEnd() === 'number';\n\t},\n\n\t_isCursorAtStart: function() {\n\t\tvar selection = window.getSelection();\n\t\treturn selection.isCollapsed && this._getSelectionStart() === 0;\n\t},\n\n\t_isCursorAtEnd: function() {\n\t\tvar selection = window.getSelection();\n\t\treturn selection.isCollapsed && this._getSelectionEnd() === this.getPlainTextContent().length;\n\t},\n\n\t// When the cursor is on a text node return the position wrt. the whole plain text content\n\t// When the cursor is on a pre- / post-space node return -1 / -2\n\t// Otherwise return undefined\n\t_getSelection: function(isStart) {\n\t\tvar selection = window.getSelection();\n\t\tvar node, offset;\n\t\tif (isStart) {\n\t\t\tnode = selection.anchorNode;\n\t\t\toffset = selection.anchorOffset;\n\t\t} else {\n\t\t\tnode = selection.focusNode;\n\t\t\toffset = selection.focusOffset;\n\t\t}\n\n\t\tif (!node)\n\t\t\treturn;\n\t\tif (node.id === 'pre-space')      // cursor position: <div><img>|</img> ... <img></img></div>\n\t\t\treturn -1;\n\t\tif (node.id === 'post-space')     // cursor position: <div><img></img> ... <img>|</img></div>\n\t\t\treturn -2;\n\t\tif (node.id === this._textArea.id) {\n\t\t\tif (this._hasPreSpace()) {\n\t\t\t\tif (offset === 0)         // cursor position: <div>|<img></img> ... <img></img></div>\n\t\t\t\t\treturn -1;\n\t\t\t\telse if (offset === 1)    // cursor position: <div><img></img>| ... <img></img></div>\n\t\t\t\t\treturn 0;\n\t\t\t} else if (this._hasPostSpace()) {\n\t\t\t\tif (offset === node.childNodes.length)    // cursor position: <div><img></img> ... <img></img>|</div>\n\t\t\t\t\treturn -2;\n\t\t\t}\n\t\t}\n\t\tif (node.nodeType !== Node.TEXT_NODE)\n\t\t\treturn;\n\n\t\tvar walker = document.createTreeWalker(this._textArea, NodeFilter.SHOW_TEXT);\n\t\tvar currentNode = walker.nextNode();\n\t\tvar pos = 0;\n\t\twhile (currentNode) {\n\t\t\tif (currentNode === node) {\n\t\t\t\treturn pos + offset;\n\t\t\t}\n\t\t\tpos += currentNode.textContent.length;\n\t\t\tcurrentNode = walker.nextNode();\n\t\t}\n\t},\n\n\t_getSelectionStart: function() {\n\t\treturn this._getSelection(true);\n\t},\n\n\t_getSelectionEnd: function() {\n\t\treturn this._getSelection(false);\n\t},\n\n\t// set the selection range\n\t// start/end refer to the string represented by the whole plain text content\n\t// it's not possible to set range start/end position at <img> delimiters\n\t_setSelectionRange: function(start, end) {\n\t\tthis._statusLog('_setSelectionRange [');\n\t\tvar selection = window.getSelection();\n\t\tselection.removeAllRanges();\n\t\tvar range = document.createRange();\n\n\t\t// at the beginning we have no text node, so set cursor between <img> delimiters\n\t\tif (this._isInitialContent()) {\n\t\t\trange.setStart(this._textArea, 1);\n\t\t\trange.setEnd(this._textArea, 1);\n\t\t\tselection.addRange(range);\n\t\t\tthis._statusLog('_setSelectionRange ]');\n\t\t\treturn;\n\t\t}\n\n\t\t// Normalize input parameters\n\t\tvar l = this.getPlainTextContent().length;\n\t\tif (start < 0)\n\t\t\tstart = 0;\n\t\tif (end < 0)\n\t\t\tend = 0;\n\t\tif (start > l)\n\t\t\tstart = l;\n\t\tif (end > l)\n\t\t\tend = l;\n\t\tif (start > end) {\n\t\t\tvar t = start;\n\t\t\tstart = end;\n\t\t\tend = t;\n\t\t}\n\t\tvar msg = '_setSelectionRange:\\n' +\n\t\t\t'    start: ' + start + ', end: ' + end +'\\n';\n\n\t\tvar startContainer = null;\n\t\tvar walker = document.createTreeWalker(this._textArea, NodeFilter.SHOW_TEXT);\n\t\tvar currentNode = walker.nextNode(); // first text node in <div>\n\t\tvar pos = 0;\n\t\t// walker iterates over text nodes only\n\t\twhile (currentNode) {\n\t\t\tmsg += '    current node: ' + currentNode + ', text content: \"' + currentNode.textContent + '\"\\n';\n\t\t\tvar len = currentNode.textContent.length;\n\t\t\tmsg += '    pos: ' + pos + ', len: ' + len +'\\n';\n\t\t\tif (!startContainer && start <= pos + len) {\n\t\t\t\tstartContainer = currentNode;\n\t\t\t\trange.setStart(currentNode, start - pos);\n\t\t\t\tmsg += '    current node set as start: offset: ' + (start - pos) + '\\n';\n\t\t\t}\n\t\t\t// The range end is set only after the range start has been set.\n\t\t\tif (startContainer && end <= pos + len) {\n\t\t\t\trange.setEnd(currentNode, end - pos);\n\t\t\t\tmsg += '    current node set as end:   offset: ' + (end - pos) + '\\n';\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tpos += len;\n\t\t\tcurrentNode = walker.nextNode();\n\t\t}\n\n\t\t// Get the selection object and add the range to it\n\t\tselection.addRange(range);\n\t\twindow.console.log(msg);\n\t\tthis._statusLog('_setSelectionRange ]');\n\t},\n\n\t_logCharCodeSequence: function(text) {\n\t\tvar s = '[';\n\t\tfor (var ii = 0; ii < text.length; ++ii) {\n\t\t\tif (ii > 0)\n\t\t\t\ts = s + ',';\n\t\t\ts = s + '0x' + text.charCodeAt(ii).toString(16);\n\t\t}\n\t\ts = s + ']';\n\t\twindow.app.console.log('L.' + this._className + '._sendText: ' + s);\n\t},\n\n\t_log: function(msg) {\n\t\tif (!this._isDebugOn)\n\t\t\treturn;\n\t\twindow.app.console.log(msg);\n\t},\n\n\t_statusLog: function(header) {\n\t\tif (!this._isDebugOn)\n\t\t\treturn;\n\n\t\tvar msg = this._className + ' ' + header + '\\n';\n\t\tmsg += '  _lastContent: ' + this._lastContent  +'\\n';\n\t\tmsg += '  _lastContent: >' + this.codePointsToString(this._lastContent) + '<\\n';\n\t\tif (this.hasAccessibilitySupport()) {\n\t\t\tmsg += '  _remotePosition: ' + this._remotePosition + '\\n';\n\t\t\tmsg += '  _lastCursorPosition: ' + this._getLastCursorPosition() + '\\n';\n\t\t\tmsg += '  _lastSelectionStart: ' + this._lastSelectionStart + '\\n';\n\t\t\tmsg += '  _lastSelectionEnd: ' + this._lastSelectionEnd + '\\n';\n\t\t\tmsg += '  _hasSelection: ' + this._hasSelection + '\\n';\n\t\t}\n\t\tmsg += '  SelectionStart: ' + this._getSelectionStart() + '\\n';\n\t\tmsg += '  SelectionEnd: ' + this._getSelectionEnd() + '\\n';\n\t\tmsg += '  active element: ' + document.activeElement +'\\n';\n\t\tmsg += '  _isComposing: ' + this._isComposing + '\\n';\n\t\tvar textArea = this._textArea;\n\t\tmsg += '  editable element: ' + '\\n';\n\t\tmsg += '    innerHTML: >' +  textArea.innerHTML + '<\\n';\n\t\tmsg += '    innerText: >' +  textArea.innerText + '<\\n';\n\t\tmsg += '    textContent: >' +  textArea.textContent + '<\\n';\n\t\tmsg += '    has focus: ' + (textArea === document.activeElement) + '\\n';\n\t\tmsg += '    has pre space: ' + this._hasPreSpace() + '\\n';\n\t\tmsg += '    has post space: ' + this._hasPostSpace() + '\\n';\n\n\t\tvar children = textArea.childNodes;\n\t\tfor (var i = 0; i < children.length; ++i) {\n\t\t\tvar child = children[i];\n\t\t\tmsg += '    child: ' + child + '\\n';\n\t\t\tif (child) {\n\t\t\t\tmsg += '      name: ' + child.nodeName + '\\n';\n\t\t\t\tmsg += '      textContent: >' + child.textContent + '<\\n';\n\t\t\t}\n\t\t}\n\n\t\tvar selection = window.getSelection();\n\t\tmsg += '  selection: \\n';\n\t\tmsg += '    content: >' + selection.toString() + '<\\n';\n\t\tmsg += '    range count: ' + selection.rangeCount + '\\n';\n\t\tmsg += '    anchorNode: ' + selection.anchorNode + '\\n';\n\t\tif (selection.anchorNode) {\n\t\t\tmsg += '      name: ' + selection.anchorNode.nodeName + '\\n';\n\t\t\tmsg += '      textContent: >' + selection.anchorNode.textContent + '<\\n';\n\t\t\tfor (i = 0; i < children.length; ++i) {\n\t\t\t\tif (children[i] === selection.anchorNode) {\n\t\t\t\t\tmsg += '      equal to child: ' + i + '\\n';\n\t\t\t\t} else if (children[i].contains(selection.anchorNode)) {\n\t\t\t\t\tmsg += '      contained in child: ' + i + '\\n';\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tmsg += '    focusNode: ' + selection.focusNode + '\\n';\n\t\tif (selection.focusNode) {\n\t\t\tmsg += '      name: ' + selection.focusNode.nodeName + '\\n';\n\t\t\tmsg += '      textContent: >' + selection.focusNode.textContent + '<\\n';\n\t\t\tfor (i = 0; i < children.length; ++i) {\n\t\t\t\tif (children[i] === selection.focusNode) {\n\t\t\t\t\tmsg += '      equal to child: ' + i + '\\n';\n\t\t\t\t} else if (children[i].contains(selection.focusNode)) {\n\t\t\t\t\tmsg += '      contained in child: ' + i + '\\n';\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tmsg += '    editable element contains anchorNode: ' + textArea.contains(selection.anchorNode) + '\\n';\n\t\tmsg += '    anchorNode == focusNode ? ' + (selection.anchorNode === selection.focusNode) + '\\n';\n\t\tmsg += '    anchorOffset: ' + selection.anchorOffset + '\\n';\n\t\tmsg += '    focusOffset: ' + selection.focusOffset + '\\n';\n\t\tmsg += '    is collapsed: ' + selection.isCollapsed + '\\n';\n\n\t\twindow.app.console.log(msg);\n\t}\n});\n\nL.textInput = function() {\n\treturn new L.TextInput();\n};\n"]}