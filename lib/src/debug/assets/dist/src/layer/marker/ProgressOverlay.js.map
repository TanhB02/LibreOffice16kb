{"version":3,"file":"ProgressOverlay.js","sourceRoot":"","sources":["../../../../../../../../../../../TanhX/online/browser/src/layer/marker/ProgressOverlay.js"],"names":[],"mappings":"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","sourcesContent":["/* -*- js-indent-level: 8 -*- */\n/*\n * L.ProgressOverlay is used to overlay progress images over the map.\n */\n\n/* global app brandProductName $ */\nL.ProgressOverlay = L.Layer.extend({\n\n\toptions: {\n\t\tspinnerSpeed: 30\n\t},\n\n\tinitialize: function (size) {\n\n\t\tL.Layer.prototype.initialize.call(this);\n\n\t\tthis._size = size;\n\t\tthis._percent = 0;\n\t\tthis._initLayout();\n\t\tthis.intervalTimer = undefined;\n\t},\n\n\t// create layout but don't add to the DOM yet\n\t_initLayout: function () {\n\t\tthis._container = L.DomUtil.create('div', 'leaflet-progress-layer');\n\t\tthis._spinner = L.DomUtil.create('div', 'leaflet-progress-spinner', this._container);\n\t\tthis._spinnerCanvas = L.DomUtil.create('canvas', 'leaflet-progress-spinner-canvas', this._spinner);\n\n\t\tvar productName;\n\t\tif (window.ThisIsAMobileApp) {\n\t\t\tproductName = window.MobileAppName;\n\t\t} else {\n\t\t\tproductName = (typeof brandProductName !== 'undefined') ? brandProductName : 'Collabora Online Development Edition (unbranded)';\n\t\t}\n\t\tthis._brandLabel = L.DomUtil.create('div', 'leaflet-progress-label brand-label', this._container);\n\t\tthis._brandLabel.innerHTML = productName;\n\n\n\t\tthis._label = L.DomUtil.create('div', 'leaflet-progress-label', this._container);\n\t\tthis._progress = L.DomUtil.create('div', 'leaflet-progress', this._container);\n\t\tthis._bar = L.DomUtil.create('span', '', this._progress);\n\t\tthis._value = L.DomUtil.create('span', '', this._bar);\n\n\t\tL.DomUtil.setStyle(this._value, 'line-height', this._size.y + 'px');\n\n\t\tthis._container.style.width  = this._size.x + 'px';\n\n\t\tL.DomEvent\n\t\t\t.disableClickPropagation(this._progress)\n\t\t\t.disableScrollPropagation(this._container);\n\t},\n\n\tshutdownTimer: function() {\n\t\tif (this.intervalTimer)\n\t\t\tclearInterval(this.intervalTimer);\n\t\tthis.intervalTimer = undefined;\n\n\t\tif (this._spinnerInterval)\n\t\t\tclearInterval(this._spinnerInterval);\n\t\tthis._spinnerInterval = undefined;\n\t},\n\n\tshowSpinner: function() {\n\t\tL.DomUtil.get('document-container').appendChild(this._container);\n\t\tthis._spinnerInterval = app.LOUtil.startSpinner(this._spinnerCanvas, this.options.spinnerSpeed);\n\t},\n\n\thideSpinner: function() {\n\t\tif (this._container)\n\t\t\t$(this._container).remove();\n\t},\n\n\t// Show the progress bar, but only if things seem slow\n\tdelayedStart: function(map, label, bar) {\n\t\tthis.setLabel(label);\n\t\tthis.setBar(false);\n\t\tthis.setValue(0);\n\n\t\tthis.shutdownTimer();\n\n\t\tvar self = this;\n\t\tself.state = 0;\n\t\tthis.intervalTimer = setInterval(\n\t\t\tfunction() {\n\t\t\t\tself.state = self.state + 1;\n\t\t\t\tswitch (self.state) {\n\t\t\t\t// 0.5s -> start the spinner\n\t\t\t\tcase 1:\n\t\t\t\t\tself.showSpinner();\n\t\t\t\t\tbreak;\n\t\t\t\t// 2s -> enable the progress bar if we have one & it's low\n\t\t\t\tcase 4:\n\t\t\t\t\tif (self._percent < 80)\n\t\t\t\t\t\tself.setBar(bar);\n\t\t\t\t\tbreak;\n\t\t\t\t// 3s -> show the bar if it's not up.\n\t\t\t\tcase 6:\n\t\t\t\t\tself.setBar(bar);\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}, 500 /* ms */);\n\t},\n\n\t// Hide ourselves if there is anything to hide\n\tend: function() {\n\t\tthis.shutdownTimer();\n\t\tthis.hideSpinner();\n\t},\n\n\tsetLabel: function (label) {\n\t\tif (this._container && this._label.innerHTML !== label) {\n\t\t\tthis._label.innerHTML = label;\n\t\t}\n\t},\n\n\tsetBar: function (bar) {\n\t\tif (this._container) {\n\t\t\tif (bar) {\n\t\t\t\tthis._progress.style.visibility = '';\n\t\t\t}\n\t\t\telse {\n\t\t\t\tthis._progress.style.visibility = 'hidden';\n\t\t\t}\n\t\t}\n\t},\n\n\tsetValue: function (value) {\n\t\tif (this._container) {\n\t\t\tthis._percent = value;\n\t\t\tthis._bar.style.width = value + '%';\n\t\t\tthis._value.innerHTML = value + '%';\n\t\t}\n\t}\n});\n\nL.progressOverlay = function (size) {\n\treturn new L.ProgressOverlay(size);\n};\n"]}