{"version":3,"file":"A11yTextInput.js","sourceRoot":"","sources":["../../../../../../../../../../../TanhX/online/browser/src/layer/marker/A11yTextInput.js"],"names":[],"mappings":"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","sourcesContent":["/* -*- js-indent-level: 8; fill-column: 100 -*- */\n/*\n * Copyright the Collabora Online contributors.\n *\n * SPDX-License-Identifier: MPL-2.0\n *\n * This Source Code Form is subject to the terms of the Mozilla Public\n * License, v. 2.0. If a copy of the MPL was not distributed with this\n * file, You can obtain one at http://mozilla.org/MPL/2.0/.\n */\n/*\n * L.A11yTextInput is the hidden textarea, which handles text input events\n *\n * This is made significantly more difficult than expected by such a\n * mess of browser, and mobile IME quirks that it is not possible to\n * follow events, but we have to re-construct input from a browser\n * text area itself.\n */\n\n/* global app _ */\n\nL.A11yTextInput = L.TextInput.extend({\n\tinitialize: function() {\n\t\tL.TextInput.prototype.initialize.call(this);\n\n\t\tthis._className = 'A11yTextInput';\n\n\t\t// Used for signaling when in a mobile device the user tapped the edit button\n\t\tthis._justSwitchedToEditMode = false;\n\n\t\t// Used when editing a shape text content.\n\t\tthis._isEditingInSelection = false;\n\t\tthis._hasAnySelection = false;\n\n\n\t\t// In core text selection exists even if it's empty and <backspace> deletes the empty selection\n\t\t// instead of the previous character.\n\t\tthis._hasSelection = false;\n\t\tthis._lastCursorPosition = 0;\n\t\tthis._lastSelectionStart = 0;\n\t\tthis._lastSelectionEnd = 0;\n\t\tthis._listPrefixLength = 0;\n\t\tthis._isLeftRightArrow = 0;\n\t},\n\n\thasAccessibilitySupport: function() {\n\t\treturn true;\n\t},\n\n\tsetHTML: function(content) {\n\t\tthis._textArea.innerHTML = this._wrapContent(content);\n\t},\n\n\t_prependSpace: function() {\n\t\tthis._textArea.innerHTML = this._preSpaceChar + this._textArea.innerHTML;\n\t},\n\n\t_appendSpace: function() {\n\t\tthis._textArea.innerHTML = this._textArea.innerHTML + this._postSpaceChar;\n\t},\n\n\t_getLastCursorPosition: function() {\n\t\treturn this._lastCursorPosition;\n\t},\n\n\t_setLastCursorPosition: function(nPos) {\n\t\tthis._lastCursorPosition = nPos;\n\t\tthis._lastSelectionStart = this._lastSelectionEnd = nPos;\n\t},\n\n\t_setLastSelection: function(nStart, nEnd) {\n\t\tthis._lastSelectionStart = nStart;\n\t\tthis._lastSelectionEnd = this._lastCursorPosition = nEnd;\n\t},\n\n\t_isLastSelectionEmpty: function() {\n\t\treturn this._lastSelectionStart === this._lastSelectionEnd;\n\t},\n\n\t_isLastSelection: function(start, end) {\n\t\treturn this._hasSelection &&  this._lastSelectionStart === start && this._lastSelectionEnd === end;\n\t},\n\n\t_updateCursorPosition: function(pos) {\n\t\tif (typeof pos !== 'number')\n\t\t\treturn;\n\t\t// Normalize input parameters\n\t\tvar l = this.getPlainTextContent().length;\n\t\tif (pos < 0)\n\t\t\tpos = 0;\n\t\tif (pos > l)\n\t\t\tpos = l;\n\n\t\tthis._setLastCursorPosition(pos);\n\t\tthis._setCursorPosition(pos);\n\t} ,\n\n\t_updateSelection: function(pos, start, end, forced) {\n\t\twindow.app.console.log('_updateSelection: pos: ' + pos + ', start: ' + start + ', end: ' + end);\n\t\tif (typeof pos !== 'number' || typeof start !== 'number' || typeof end !== 'number')\n\t\t\treturn;\n\n\t\tvar hasSelection= !(start === -1 && end === -1);\n\t\tif (!hasSelection) {\n\t\t\tthis._updateCursorPosition(pos);\n\t\t} else if (forced || !this._isLastSelection(start, end)) {\n\t\t\tif (forced || start !== end || !this._hasSelection || !this._isLastSelectionEmpty()) {\n\t\t\t\t// When the new selection is empty (start == end). the cursor position is updated\n\t\t\t\t// only if there was no previous selection, or previous selection was not empty.\n\t\t\t\t// In fact when both old and new selection are empty, it means that the old selection\n\t\t\t\t// has been moved to a new position by some typing. Anyway changing cursor position\n\t\t\t\t// while typing can mess up editable area content.\n\t\t\t\tthis._setLastSelection(start, end);\n\t\t\t\tthis._setSelectionRange(start, end);\n\t\t\t}\n\t\t}\n\t\tthis._setSelectionFlag(hasSelection);\n\t},\n\n\t_setSelectionFlag: function(flag) {\n\t\tthis._hasSelection = flag;\n\t\tif (L.Browser.cypressTest)\n\t\t\tthis._textArea.isSelectionNull = !flag;\n\t},\n\n\t_setFocusedParagraph: function(content, pos, start, end) {\n\t\twindow.app.console.log('_setFocusedParagraph:'\n\t\t\t+ '\\n    content \"' + content + '\"'\n\t\t\t+ '\\n    pos: ' + pos\n\t\t\t+ '\\n    start: ' + start + ', end: ' + end);\n\n\t\tthis._isComposing = false;\n\t\tthis._isLeftRightArrow = 0;\n\t\tif (!this._hasFormulaBarFocus()) {\n\t\t\tthis.setHTML(content);\n\t\t\tthis.updateLastContent();\n\t\t\tthis._updateSelection(pos, start, end, true);\n\t\t}\n\t},\n\n\t_updateFocusedParagraph: function() {\n\t\tthis._log('_updateFocusedParagraph');\n\t\tif (this._remoteContent !== undefined) {\n\t\t\tthis._setFocusedParagraph(this._remoteContent, this._remotePosition,\n\t\t\t\tthis._remoteSelectionStart, this._remoteSelectionEnd);\n\t\t} else if (this._remoteSelectionEnd !== undefined) {\n\t\t\tthis._updateSelection(this._remotePosition, this._remoteSelectionStart, this._remoteSelectionEnd);\n\t\t} else if (this._remotePosition !== undefined) {\n\t\t\tthis._updateCursorPosition(this._remotePosition);\n\t\t}\n\t\tthis._remoteContent = undefined;\n\t\tthis._remotePosition = undefined;\n\t\tthis._remoteSelectionStart = undefined;\n\t\tthis._remoteSelectionEnd = undefined;\n\t},\n\n\tonAccessibilityFocusChanged: function(content, pos, start, end, listPrefixLength, force) {\n\t\tthis._listPrefixLength = listPrefixLength;\n\t\tif (!this.hasFocus() || (this._isComposing && !force)) {\n\t\t\tthis._log('onAccessibilityFocusChanged: skipped updating: '\n\t\t\t\t+ '\\n  hasFocus: ' + this.hasFocus()\n\t\t\t\t+ '\\n  _isComposing: ' + this._isComposing\n\t\t\t\t+ '\\n  force: ' + force);\n\t\t\tthis._remoteContent = content;\n\t\t\tthis._remotePosition = pos;\n\t\t\tthis._remoteSelectionStart = start;\n\t\t\tthis._remoteSelectionEnd = end;\n\t\t} else {\n\t\t\tthis._setFocusedParagraph(content, pos, start, end);\n\t\t}\n\t},\n\n\tsetA11yFocusedParagraph: function(content, pos, start, end) {\n\t\tthis._setFocusedParagraph(content, pos, start, end);\n\t},\n\n\tonAccessibilityCaretChanged: function(nPos) {\n\t\tthis._log('onAccessibilityCaretChanged: \\n' +\n\t\t\t'    position: ' + nPos + '\\n' +\n\t\t\t'    _isComposing: ' + this._isComposing);\n\t\tif (this._isLeftRightArrow || !this.hasFocus() || this._isComposing) {\n\t\t\tthis._log('onAccessibilityCaretChanged: skip updating');\n\t\t\tthis._remotePosition = nPos;\n\t\t}\n\t\telse if (!this._hasFormulaBarFocus()) {\n\t\t\tthis._updateCursorPosition(nPos);\n\t\t}\n\t},\n\n\tsetA11yCaretPosition: function(nPos) {\n\t\tif (this._isLastSelectionEmpty()) {\n\t\t\tthis.onAccessibilityCaretChanged(nPos);\n\t\t}\n\t},\n\n\tonAccessibilityTextSelectionChanged: function(start, end) {\n\t\tif (this._isLeftRightArrow || !this.hasFocus() || this._isComposing) {\n\t\t\tthis._remoteSelectionStart = start;\n\t\t\tthis._remoteSelectionEnd = end;\n\t\t\tvar hasSelection = !(start === -1 && end === -1);\n\t\t\tthis._setSelectionFlag(hasSelection);\n\t\t\tif (hasSelection) {\n\t\t\t\tthis._remotePosition = end;\n\t\t\t}\n\t\t\tthis._statusLog('onAccessibilityTextSelectionChanged: skip updating');\n\t\t} else {\n\t\t\tthis._updateSelection(this._lastCursorPosition, start, end);\n\t\t}\n\t},\n\n\t_setDescription: function(text) {\n\t\tthis._log('setDescription: ' + text);\n\t\tthis._textArea.setAttribute('aria-description', text);\n\t},\n\n\t_updateTable: function(outCount, inList, row, col, rowSpan, colSpan) {\n\t\tthis._log('_updateTable: '\n\t\t\t+ '\\n outCount: ' + outCount\n\t\t\t+ '\\n inList: ' + inList.toString()\n\t\t\t+ '\\n row: ' + row + ', rowSpan: ' + rowSpan\n\t\t\t+ '\\n col: ' + col + ', colSpan: ' + colSpan\n\t\t);\n\n\t\tif (this._timeoutForA11yDescription)\n\t\t\tclearTimeout(this._timeoutForA11yDescription);\n\n\t\tvar eventDescription = '';\n\t\tif (outCount > 0 || inList.length > 0) {\n\t\t\tthis._lastRowIndex = 0;\n\t\t\tthis._lastColIndex = 0;\n\t\t\tthis._lastRowSpan = 1;\n\t\t\tthis._lastColSpan = 1;\n\t\t}\n\t\tfor (var i = 0; i < outCount; i++) {\n\t\t\teventDescription += _('Out of table') + '. ';\n\t\t}\n\t\tfor (i = 0; i < inList.length; i++) {\n\t\t\teventDescription += _('Table with {0} rows and {1} columns').replace('{0}', inList[i].rowCount).replace('{1}', inList[i].colCount) + '. ';\n\t\t}\n\t\tif (this._lastRowIndex !== row || this._lastRowSpan !== rowSpan) {\n\t\t\tthis._lastRowIndex = row;\n\t\t\tif (this._lastRowSpan !== rowSpan && rowSpan > 1) {\n\t\t\t\teventDescription += _('Row {0} through {1}').replace('{0}', row).replace('{1}', row + rowSpan - 1);\n\t\t\t}\n\t\t\telse {\n\t\t\t\teventDescription += _('Row {0}').replace('{0}', row);\n\t\t\t}\n\t\t\teventDescription += '. ';\n\t\t\tthis._lastRowSpan = rowSpan;\n\t\t}\n\t\tif (this._lastColIndex !== col || this._lastColSpan !== colSpan) {\n\t\t\tthis._lastColIndex = col;\n\t\t\tif (this._lastColSpan !== colSpan && colSpan > 1) {\n\t\t\t\teventDescription += _('Column {0} through {1}').replace('{0}', col).replace('{1}', col + colSpan - 1);\n\t\t\t}\n\t\t\telse {\n\t\t\t\teventDescription += _('Column {0}').replace('{0}', col);\n\t\t\t}\n\t\t\teventDescription += '. ';\n\t\t\tthis._lastColSpan = colSpan;\n\t\t}\n\t\tthis._setDescription(eventDescription);\n\n\t\tvar that = this;\n\t\tthis._timeoutForA11yDescription = setTimeout(function() {\n\t\t\tthat._setDescription('');\n\t\t}, 1000);\n\t},\n\n\tonAccessibilityFocusedCellChanged: function(outCount, inList, row, col, rowSpan, colSpan, paragraph) {\n\t\tthis._setFocusedParagraph(paragraph.content, parseInt(paragraph.position), parseInt(paragraph.start), parseInt(paragraph.end));\n\t\tthis._updateTable(outCount, inList, row + 1, col + 1, rowSpan, colSpan);\n\t},\n\n\tonAccessibilityEditingInSelectionState: function(cell, enabled, selectionDescr, paragraph) {\n\t\tthis._log('onAccessibilityEditingInSelectionState: cell: ' + cell + ', enabled: ' + enabled);\n\t\tif (!cell) {\n\t\t\tthis._isEditingInSelection = enabled;\n\t\t}\n\t\tif (enabled) {\n\t\t\tclearTimeout(this._timeoutForA11yDescription);\n\t\t\tvar eventDescription = '';\n\t\t\tif (typeof selectionDescr === 'string' && selectionDescr.length > 0)\n\t\t\t\teventDescription += selectionDescr + '. ';\n\t\t\teventDescription += _('Editing activated. ');\n\t\t\tif (typeof paragraph === 'string' && paragraph.length > 0)\n\t\t\t\teventDescription += paragraph;\n\t\t\tthis._setDescription(eventDescription);\n\t\t\tthis._timeoutForA11yDescription = setTimeout(function () {\n\t\t\t\tthis._setDescription('');\n\t\t\t}.bind(this), 1000);\n\t\t}\n\t},\n\n\tonAccessibilitySelectionChanged: function(cell, action, name, textContent) {\n\t\tthis._log('onAccessibilitySelectionChanged: cell: ' + cell + ', action: ' + action + ', name: ' + name);\n\t\tif (this._timeoutForA11yDescription)\n\t\t\tclearTimeout(this._timeoutForA11yDescription);\n\t\tif (!this._isFormula())\n\t\t\tthis._emptyArea();\n\t\tvar eventDescription = '';\n\t\tif (action === 'create' || action === 'add') {\n\t\t\tthis._hasAnySelection = true;\n\t\t\teventDescription =  _('{0} selected').replace('{0}', name) + '. ';\n\t\t\tif (typeof textContent === 'string' && textContent.length > 0) {\n\t\t\t\teventDescription += (cell ? '' : _('Has text: ')) + textContent;\n\t\t\t}\n\t\t}\n\t\telse if (action === 'remove') {\n\t\t\tthis._hasAnySelection = false;\n\t\t\teventDescription = _('{0} unselected').replace('{0}', name);\n\t\t}\n\t\telse if (action === 'delete') {\n\t\t\tthis._hasAnySelection = false;\n\t\t\teventDescription = _('{0} deleted').replace('{0}', name);\n\t\t}\n\t\tthis._setDescription(eventDescription);\n\t\tif (action !== 'create' && action !== 'add') {\n\t\t\tthis._timeoutForA11yDescription = setTimeout(function () {\n\t\t\t\tthis._setDescription('');\n\t\t\t}.bind(this), 1000);\n\t\t}\n\t},\n\n\t// Check if a UTF-16 pair represents a Unicode code point\n\t_isSurrogatePair: function(hi, lo) {\n\t\treturn \thi >= 0xd800 && hi <= 0xdbff && lo >= 0xdc00 && lo <= 0xdfff;\n\t},\n\n\t// Backspaces and deletes at the beginning / end are filtered out, so\n\t// we get a beforeinput, but no input for them. Sometimes we can end up\n\t// in a state where we lost our leading / terminal chars and can't recover\n\t_onBeforeInput: function(ev) {\n\t\tif (this._map.uiManager.isUIBlocked())\n\t\t\treturn;\n\t\tthis._statusLog('_onBeforeInput [');\n\t\tthis._ignoreNextBackspace = false;\n\t\tif (!this._isSelectionValid()) {\n\t\t\tthis._setCursorPosition(this._getLastCursorPosition());\n\t\t}\n\t\telse if (this._isCursorAtBeginning()) {\n\t\t\tthis._handleMisplacedCursorAtBeginning(ev);\n\t\t}\n\t\telse if (!this._isLastSelectionEmpty() && !this._hasFormulaBarFocus() && this._isFormula()) {\n\t\t\t// A cell address is selected in formula input mode,\n\t\t\t// before inserting a new input we need to clear selection\n\t\t\tthis._updateCursorPosition(this._lastSelectionEnd);\n\t\t}\n\n\t\tif (!this._isComposing && !this._isLeftRightArrow && this._remotePosition !== undefined) {\n\t\t\tthis._updateFocusedParagraph();\n\t\t}\n\n\t\t// Firefox is not able to delete the <img> post space. Since no 'input' event is generated,\n\t\t// we need to handle a <delete> at the end of the paragraph, here.\n\t\tif (L.Browser.gecko && (!this._hasSelection || this._isLastSelectionEmpty()) &&\n\t\t\tthis._getLastCursorPosition() === this.getPlainTextContent().length &&\n\t\t\tthis._deleteHint === 'delete') {\n\t\t\tif (this._map._debug.logKeyboardEvents) {\n\t\t\t\twindow.app.console.log('Sending delete');\n\t\t\t}\n\t\t\tthis._removeEmptySelectionIfAny();\n\t\t\tthis._removeTextContent(0, 1);\n\t\t}\n\t\tthis._statusLog('_onBeforeInput ]');\n\t},\n\n\tupdateLastContent: function() {\n\t\tvar value = this.getValue();\n\t\tthis._lastContent = this.getValueAsCodePoints(value);\n\t},\n\n\t_isFormula: function() {\n\t\tvar content = this.getValue();\n\t\treturn this._map._docLoaded && this._map.getDocType() === 'spreadsheet'\n\t\t\t&& content.length > 0 && content[0] === '=';\n\t},\n\n\t_requestFocusedParagraph: function() {\n\t\tapp.socket.sendMessage('geta11yfocusedparagraph');\n\t},\n\n\t_restoreSpanWrapper: function() {\n\t\tvar children = this._textArea.childNodes;\n\t\tif (children.length >= 3 && children[1].nodeName === '#text') {\n\t\t\tif (children.length === 3) {\n\t\t\t\t// When typing in an empty paragraph, we get <img>H<img>\n\t\t\t\tvar htmlContent = this.getHTML();\n\t\t\t\thtmlContent = htmlContent.slice(this._preSpaceChar.length, -this._postSpaceChar.length);\n\t\t\t\tthis.setHTML(htmlContent);\n\t\t\t}\n\t\t\telse if (children.length === 4 && children[2].id === 'readable-content') {\n\t\t\t\t// When typing, let's say 'k', at beginning of a not empty paragraph,\n\t\t\t\t// we get: <img>k<span>Hello World</span><img>\n\t\t\t\tvar newText = children[1].textContent;\n\t\t\t\tchildren[2].innerHTML = newText + children[2].innerHTML;\n\t\t\t\tthis._textArea.removeChild(children[1]);\n\t\t\t}\n\t\t}\n\t},\n\n\t// Fired when text has been inputted, *during* and after composing/spellchecking\n\t_onInput: function(ev) {\n\t\tif (this._map.uiManager.isUIBlocked())\n\t\t\treturn;\n\t\tthis._statusLog('_onInput [');\n\t\tapp.idleHandler.notifyActive();\n\n\t\tif (this._ignoreInputCount > 0) {\n\t\t\twindow.app.console.log('ignoring synthetic input ' + this._ignoreInputCount);\n\t\t\treturn;\n\t\t}\n\n\t\tif (this._deleteHint === '' && ev.inputType) {\n\t\t\tif (ev.inputType === 'deleteContentForward')\n\t\t\t\tthis._deleteHint = 'delete';\n\t\t\telse if (ev.inputType === 'deleteContentBackward')\n\t\t\t\tthis._deleteHint = 'backspace';\n\t\t}\n\n\t\tvar ignoreBackspace = this._ignoreNextBackspace;\n\t\tthis._ignoreNextBackspace = false;\n\n\t\tif (this._newlineHint) {\n\t\t\tthis._sendNewlineEvent();\n\t\t\treturn;\n\t\t}\n\n\t\t// We use a different leading and terminal space character\n\t\t// to differentiate backspace from delete, then replace the character.\n\t\tif (!this._hasPreSpace()) { // missing initial space\n\t\t\tif (this._map._debug.logKeyboardEvents) {\n\t\t\t\twindow.app.console.log('Sending backspace');\n\t\t\t}\n\t\t\tif (!ignoreBackspace) {\n\t\t\t\tthis._removeEmptySelectionIfAny();\n\t\t\t\tthis._removeTextContent(1, 0);\n\t\t\t}\n\t\t\t// Lately we receive the new paragraph == above paragraph + current paragraph,\n\t\t\t// except current paragraph is the first one.\n\t\t\t// In this last case we need to restore the pre space.\n\t\t\tthis._prependSpace();\n\t\t\tthis._updateCursorPosition(0);\n\t\t\treturn;\n\t\t}\n\t\tif (!this._hasPostSpace()) { // missing trailing space.\n\t\t\tif (this._map._debug.logKeyboardEvents) {\n\t\t\t\twindow.app.console.log('Sending delete');\n\t\t\t}\n\t\t\tthis._removeTextContent(0, this._hasSelection && this._isLastSelectionEmpty() ? 2 : 1);\n\t\t\tthis._appendSpace();\n\t\t\tvar pos = this._getLastCursorPosition();\n\t\t\tthis._updateCursorPosition(pos);\n\t\t\treturn;\n\t\t}\n\n\t\t// We assume that what is on the right of the new cursor position has not been modified\n\t\t// We also assume that lastCursorPosition is synchronized with the cursor position in core\n\t\tvar cursorPosition = this._getSelectionEnd();\n\t\tvar lastCursorPosition = this._getLastCursorPosition();\n\t\tvar value = this.getValue();\n\n\t\t// In the android keyboard when you try to erase the pre-space\n\t\t// and then enter some character,\n\t\t// The first character will likely travel with the cursor,\n\t\t// And that is caused because after entering the first character\n\t\t// cursor position is never updated by keyboard (I know it is strange)\n\t\t// so here we manually correct the position\n\t\tif (lastCursorPosition === 0 && cursorPosition < 1 && value.length - this._lastContent.length === 1) {\n\t\t\tcursorPosition = 1;\n\t\t\tif (!this._isComposing)\n\t\t\t\tthis._setCursorPosition(1);\n\t\t}\n\n\t\t// We need to take into account the case that lastCursorPosition is beyond the new cursor position.\n\t\t// For instance that can happen when after entering a word, several spaces are typed:\n\t\t// a '.' is appended automatically.\n\t\tvar contentTailLength = value.length - cursorPosition;\n\t\tvar lastContentTailLength = this._lastContent.length - lastCursorPosition;\n\t\tvar guessedBackMatchTo = Math.min(lastContentTailLength, contentTailLength);\n\t\tvar contentEnd = value.length - guessedBackMatchTo;\n\t\tvar content = this.getValueAsCodePoints(value.slice(0, contentEnd));\n\t\t// Note that content is an array of Unicode code points\n\t\tvar lastContentEnd = this._lastContent.length - guessedBackMatchTo;\n\t\tvar lastContent = this._lastContent.slice(0, lastContentEnd);\n\n\t\twindow.app.console.log('_onInput: cursorPosition: ' + cursorPosition + ', lastContentEnd: ' + lastContentEnd);\n\n\t\tvar matchTo = 0;\n\t\tvar compareUpTo = Math.min(content.length, lastContent.length);\n\t\tif (!this._isLastSelectionEmpty()) {\n\t\t\t// Selected text has always to be removed, so there is no need for comparing old and new content\n\t\t\t// over selection start. Moreover, if selection content starts with the typed key, it would lead to\n\t\t\t// an empty new content and the input would never be forwarded to core.\n\t\t\tcompareUpTo = Math.min(compareUpTo, this._lastSelectionStart);\n\t\t}\n\t\twhile (matchTo < compareUpTo && content[matchTo] === lastContent[matchTo])\n\t\t\tmatchTo++;\n\n\t\tif (this._map._debug.logKeyboardEvents) {\n\t\t\twindow.app.console.log('Comparison matchAt ' + matchTo + '\\n' +\n\t\t\t\t'\\tnew \"' + this.codePointsToString(content) + '\" (' + content.length + ')' + '\\n' +\n\t\t\t\t'\\told \"' + this.codePointsToString(lastContent) + '\" (' + lastContent.length + ')');\n\t\t}\n\n\t\t// no new content\n\t\tif (matchTo === content.length && matchTo === lastContent.length)\n\t\t\treturn;\n\n\t\t// matchTo <= lastCursorPosition <= lastContent.length\n\t\tmatchTo = Math.min(matchTo, lastCursorPosition);\n\n\t\tvar removeAfter = 0;\n\t\tvar removeBefore = 0;\n\t\tif (!this._hasSelection) {\n\t\t\tremoveAfter = lastContent.length - lastCursorPosition;\n\t\t\tremoveBefore = (lastContent.length - matchTo) - removeAfter;\n\t\t}\n\t\telse if (this._deleteHint === 'backspace') {\n\t\t\tthis._removeEmptySelectionIfAny();\n\t\t\tthis._setSelectionFlag(false);\n\t\t\tremoveBefore = 1;\n\t\t}\n\t\telse if (this._deleteHint === 'delete') {\n\t\t\t// when in core there is an empty selection the first <delete> deletes\n\t\t\t// the selection instead of the next char\n\t\t\tthis._setSelectionFlag(false);\n\t\t\tremoveAfter = this._isLastSelectionEmpty() ? 2 : 1;\n\t\t}\n\n\t\t// A browser selection range counts a surrogate UTF-16 pair as 2 chars.\n\t\t// The same occurs in core for the text cursor position reported by the caret changed accessibility event.\n\t\t// However, in core a single <backspace> or <delete> is needed for deleting a surrogate pair.\n        if (removeBefore > 1) {\n\t\t\tvar start = lastCursorPosition - removeBefore;\n\t\t\tfor (var i = start; i < lastCursorPosition; i++) {\n\t\t\t\tif (this._isSurrogatePair(lastContent[i], lastContent[i+1])) {\n\t\t\t\t\tremoveBefore--;\n\t\t\t\t\ti++;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tif (removeAfter > 1) {\n\t\t\tvar end = lastCursorPosition + removeAfter;\n\t\t\tfor (var j = lastCursorPosition; j < end; j++) {\n\t\t\t\tif (this._isSurrogatePair(lastContent[j], lastContent[j+1])) {\n\t\t\t\t\tremoveAfter--;\n\t\t\t\t\tj++;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (removeBefore > 0 || removeAfter > 0)\n\t\t\tthis._removeTextContent(removeBefore, removeAfter);\n\n\t\tvar newText = content;\n\t\tif (matchTo > 0)\n\t\t\tnewText = newText.slice(matchTo);\n\n\t\tvar head = this._lastContent.slice(0, matchTo);\n\t\tvar tail = this._lastContent.slice(lastContentEnd);\n\t\tthis._lastContent = head.concat(newText, tail);\n\t\twindow.app.console.log('_onInput: \\n'\n\t\t\t+ 'head: \"' + this.codePointsToString(head) + '\"\\n'\n\t\t\t+ 'newText: \"' + this.codePointsToString(newText) + '\"\\n'\n\t\t\t+ 'tail: \"' + this.codePointsToString(tail) + '\"');\n\n\t\tthis._setLastCursorPosition(cursorPosition);\n\n\t\tif (newText.length > 0) {\n\t\t\tif (!this._isComposing && !this._isWrappedBySpan()) {\n\t\t\t\tthis._restoreSpanWrapper();\n\t\t\t\tthis._setCursorPosition(cursorPosition);\n\t\t\t}\n\t\t\tthis._sendNewText(ev, content, newText);\n\t\t}\n\n\t\t// special handling for formula bar\n\t\tthis._finishFormulabarEditing(content, matchTo);\n\n\t\t// special handling for mentions\n\t\tif (this._map.getDocType() === 'text')\n\t\t\tthis._map.mention.handleMentionInput(ev);\n\n\t\tthis._statusLog('_onInput ]');\n\t},\n\n\t_removeEmptySelectionIfAny: function() {\n\t\tif (this._hasSelection && this._isLastSelectionEmpty()) {\n\t\t\t// when in core there is an empty selection a <backspace> or a <delete> removes\n\t\t\t// the selection instead of the previous or next char, so we send a fake <delete>\n\t\t\t// in order to remove the empty selection.\n\t\t\tthis._sendDelete();\n\t\t}\n\t},\n\n\t_sendDelete: function() {\n\t\tthis._sendKeyEvent(46, 1286, 'input');\n\t},\n\n\t_hasPreSpace: function() {\n\t\tvar child = this._textArea.firstChild;\n\t\twhile (child && child.tagName !== 'img') {\n\t\t\tif (child.id === 'pre-space')\n\t\t\t\treturn true;\n\t\t\tchild = child.firstChild;\n\t\t}\n\t\treturn false;\n\t},\n\n\t_hasPostSpace: function() {\n\t\tvar child = this._textArea.lastChild;\n\t\twhile (child) {\n\t\t\tif (child.id === 'post-space')\n\t\t\t\treturn true;\n\t\t\tchild = child.lastChild;\n\t\t}\n\t\treturn false;\n\t},\n\n\t_isWrappedBySpan: function() {\n\t\tvar children = this._textArea.childNodes;\n\t\treturn children.length === 3 && children[1].nodeName === 'SPAN';\n\t}\n});\n\nL.a11yTextInput = function() {\n\treturn new L.A11yTextInput();\n};\n"]}