{"version":3,"file":"Marker.js","sourceRoot":"","sources":["../../../../../../../../../../../TanhX/online/browser/src/layer/marker/Marker.js"],"names":[],"mappings":"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","sourcesContent":["/* -*- js-indent-level: 8 -*- */\n/*\n * L.Marker is used to display clickable/draggable icons on the map.\n */\n\nL.Marker = L.Layer.extend({\n\n\toptions: {\n\t\tpane: 'markerPane',\n\n\t\ticon: new L.Icon.Default(),\n\t\t// title: '',\n\t\t// alt: '',\n\t\tinteractive: true,\n\t\tdraggable: false,\n\t\tkeyboard: true,\n\t\tzIndexOffset: 0,\n\t\topacity: 1,\n\t\t// riseOnHover: false,\n\t\triseOffset: 250\n\t},\n\n\tinitialize: function (latlng, options) {\n\n\t\tL.Layer.prototype.initialize.call(this);\n\n\t\tL.setOptions(this, options);\n\t\tthis._latlng = L.latLng(latlng);\n\t\tthis.on('down', this.onDown);\n\t\tthis.on('up', this.onUp);\n\t},\n\n\tonAdd: function () {\n\t\tthis._initIcon();\n\t\tthis.update();\n\t},\n\n\tonRemove: function () {\n\t\tif (this.dragging && this.dragging.enabled()) {\n\t\t\tthis.dragging.removeHooks();\n\t\t}\n\n\t\tthis._removeIcon();\n\t\tthis._removeShadow();\n\t},\n\n\tonDown: function () {\n\t\tif (this._map && this._map.touchGesture) {\n\t\t\twindow.IgnorePanning = true;\n\t\t}\n\t},\n\n\tonUp: function () {\n\t\tif (this._map && this._map.touchGesture) {\n\t\t\twindow.IgnorePanning = undefined;\n\t\t}\n\t},\n\n\tgetEvents: function () {\n\t\tvar events = {viewreset: this.update};\n\n\t\tvar splitPanesPossible = this._map._docLayer.hasSplitPanesSupport();\n\t\tif (splitPanesPossible) {\n\t\t\tevents.moveend = this.update;\n\t\t\tevents.drag = this.update;\n\t\t\tevents.splitposchanged = this.update;\n\t\t}\n\n\t\treturn events;\n\t},\n\n\tgetLatLng: function () {\n\t\treturn this._latlng;\n\t},\n\n\tsetLatLng: function (latlng) {\n\t\tvar oldLatLng = this._latlng;\n\t\tthis._latlng = L.latLng(latlng);\n\t\tthis.update();\n\t\treturn this.fire('move', {oldLatLng: oldLatLng, latlng: this._latlng});\n\t},\n\n\tsetIcon: function (icon) {\n\n\t\tthis.options.icon = icon;\n\n\t\tif (this._map) {\n\t\t\tthis._initIcon();\n\t\t\tthis.update();\n\t\t}\n\n\t\treturn this;\n\t},\n\n\t_updateIconPosition: function () {\n\n\t\tif (!this._icon) {\n\t\t\treturn;\n\t\t}\n\n\t\tvar posVis = L.Layer.getLayerPositionVisibility(this._latlng,\n\t\t\tthis._icon.getBoundingClientRect(), this._map);\n\n\t\tif (this._icon.style.visibility != posVis.visibility) {\n\t\t\tthis._icon.style.visibility = posVis.visibility;\n\t\t}\n\n\t\tthis._setPos(posVis.position);\n\t},\n\n\tupdate: function () {\n\t\tthis._updateIconPosition();\n\t\treturn this;\n\t},\n\n\t_initIcon: function () {\n\t\tvar options = this.options,\n\t\t    classToAdd = 'leaflet-zoom-hide';\n\n\t\tvar icon = options.icon.createIcon(this._icon),\n\t\t    addIcon = false;\n\n\t\t// if we're not reusing the icon, remove the old one and init new one\n\t\tif (icon !== this._icon) {\n\t\t\tif (this._icon) {\n\t\t\t\tthis._removeIcon();\n\t\t\t}\n\t\t\taddIcon = true;\n\n\t\t\tif (options.title) {\n\t\t\t\ticon.title = options.title;\n\t\t\t}\n\t\t\tif (options.alt) {\n\t\t\t\ticon.alt = options.alt;\n\t\t\t}\n\t\t}\n\n\t\tL.DomUtil.addClass(icon, classToAdd);\n\n\t\tif (options.keyboard) {\n\t\t\ticon.tabIndex = '0';\n\t\t}\n\n\t\tthis._icon = icon;\n\t\tthis._initInteraction();\n\n\t\tif (options.riseOnHover) {\n\t\t\tthis.on({\n\t\t\t\tmouseover: this._bringToFront,\n\t\t\t\tmouseout: this._resetZIndex\n\t\t\t});\n\t\t}\n\n\t\tvar newShadow = options.icon.createShadow(this._shadow),\n\t\t    addShadow = false;\n\n\t\tif (newShadow !== this._shadow) {\n\t\t\tthis._removeShadow();\n\t\t\taddShadow = true;\n\t\t}\n\n\t\tif (newShadow) {\n\t\t\tL.DomUtil.addClass(newShadow, classToAdd);\n\t\t}\n\t\tthis._shadow = newShadow;\n\n\n\t\tif (options.opacity < 1) {\n\t\t\tthis._updateOpacity();\n\t\t}\n\n\n\t\tif (addIcon) {\n\t\t\tthis.getPane().appendChild(this._icon);\n\t\t}\n\t\tif (newShadow && addShadow) {\n\t\t\tthis.getPane('shadowPane').appendChild(this._shadow);\n\t\t}\n\t},\n\n\t_removeIcon: function () {\n\t\tif (this.options.riseOnHover) {\n\t\t\tthis.off({\n\t\t\t\tmouseover: this._bringToFront,\n\t\t\t\tmouseout: this._resetZIndex\n\t\t\t});\n\t\t}\n\n\t\tL.DomUtil.remove(this._icon);\n\t\tthis.removeInteractiveTarget(this._icon);\n\n\t\tthis._icon = null;\n\t},\n\n\t_removeShadow: function () {\n\t\tif (this._shadow) {\n\t\t\tL.DomUtil.remove(this._shadow);\n\t\t}\n\t\tthis._shadow = null;\n\t},\n\n\t_setPos: function (pos) {\n\t\tL.DomUtil.setPosition(this._icon, pos);\n\n\t\tif (this._shadow) {\n\t\t\tL.DomUtil.setPosition(this._shadow, pos);\n\t\t}\n\n\t\tthis._zIndex = pos.y + this.options.zIndexOffset;\n\n\t\tthis._resetZIndex();\n\t},\n\n\t_updateZIndex: function (offset) {\n\t\tthis._icon.style.zIndex = this._zIndex + offset;\n\t},\n\n\t_initInteraction: function () {\n\n\t\tif (!this.options.interactive) { return; }\n\n\t\tL.DomUtil.addClass(this._icon, 'leaflet-interactive');\n\n\t\tthis.addInteractiveTarget(this._icon);\n\n\t\tif (L.Handler.MarkerDrag) {\n\t\t\tvar draggable = this.options.draggable;\n\t\t\tif (this.dragging) {\n\t\t\t\tdraggable = this.dragging.enabled();\n\t\t\t\tthis.dragging.disable();\n\t\t\t}\n\n\t\t\tthis.dragging = new L.Handler.MarkerDrag(this);\n\n\t\t\tif (draggable) {\n\t\t\t\tthis.dragging.enable();\n\t\t\t}\n\t\t}\n\t},\n\n\tsetOpacity: function (opacity) {\n\t\tthis.options.opacity = opacity;\n\t\tif (this._map) {\n\t\t\tthis._updateOpacity();\n\t\t}\n\n\t\treturn this;\n\t},\n\n\t_updateOpacity: function () {\n\t\tvar opacity = this.options.opacity;\n\n\t\tL.DomUtil.setOpacity(this._icon, opacity);\n\n\t\tif (this._shadow) {\n\t\t\tL.DomUtil.setOpacity(this._shadow, opacity);\n\t\t}\n\t},\n\n\t_bringToFront: function () {\n\t\tthis._updateZIndex(this.options.riseOffset);\n\t},\n\n\t_resetZIndex: function () {\n\t\tthis._updateZIndex(0);\n\t}\n});\n\nL.marker = function (latlng, options) {\n\treturn new L.Marker(latlng, options);\n};\n"]}