{"version":3,"file":"CPolyUtil.js","sourceRoot":"","sources":["../../../../../../../../../../../TanhX/online/browser/src/layer/vector/CPolyUtil.ts"],"names":[],"mappings":"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","sourcesContent":["// @ts-strict-ignore\n/* -*- js-indent-level: 8 -*- */\n\n/*\n * CPolyUtil contains utility functions for polygons.\n */\n\nnamespace CPolyUtil {\n\n\texport function rectanglesToPointSet(rectangles: Array<Array<cool.Point>>, unitConverter: (point: cool.Point) => cool.Point): CPointSet {\n\t\t/* An Implementation based on O'ROURKE, Joseph. \"Uniqueness of orthogonal connect-the-dots.\"\n\t\t   Machine Intelligence and Pattern Recognition. Vol. 6. North-Holland, 1988. 97-104.\n\t\t   http://www.science.smith.edu/~jorourke/Papers/OrthoConnect.pdf\n\t\t*/\n\t\tvar eps = 20;\n\t\t// Glue rectangles if the space between them is less then eps\n\t\tfor (var i = 0; i < rectangles.length - 1; i++) {\n\t\t\tfor (var j = i + 1; j < rectangles.length; j++) {\n\t\t\t\tfor (var k = 0; k < rectangles[i].length; k++) {\n\t\t\t\t\tfor (var l = 0; l < rectangles[j].length; l++) {\n\t\t\t\t\t\tif (Math.abs(rectangles[i][k].x - rectangles[j][l].x) < eps) {\n\t\t\t\t\t\t\trectangles[j][l].x = rectangles[i][k].x;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (Math.abs(rectangles[i][k].y - rectangles[j][l].y) < eps) {\n\t\t\t\t\t\t\trectangles[j][l].y = rectangles[i][k].y;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tvar points = new Map<cool.Point, cool.Point>();\n\t\tfor (i = 0; i < rectangles.length; i++) {\n\t\t\tfor (j = 0; j < rectangles[i].length; j++) {\n\t\t\t\tif (points.has(rectangles[i][j])) {\n\t\t\t\t\tpoints.delete(rectangles[i][j]);\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tpoints.set(rectangles[i][j], rectangles[i][j]);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tfunction getKeys(points: Map<cool.Point, cool.Point>): Array<cool.Point> {\n\t\t\tvar keys: Array<cool.Point> = [];\n\t\t\tpoints.forEach((_: cool.Point, key: cool.Point) => {\n\t\t\t\tkeys.push(key);\n\t\t\t});\n\t\t\treturn keys;\n\t\t}\n\n\t\t// cool.Point comparison function for sorting a list of CPoints w.r.t x-coordinate.\n\t\t// When the points have same x-coordinate break tie based on y-coordinates.\n\t\tfunction xThenY(ap: cool.Point, bp: cool.Point): number {\n\t\t\tif (ap.x < bp.x || (ap.x === bp.x && ap.y < bp.y)) {\n\t\t\t\treturn -1;\n\t\t\t}\n\t\t\telse if (ap.x === bp.x && ap.y === bp.y) {\n\t\t\t\treturn 0;\n\t\t\t}\n\t\t\telse {\n\t\t\t\treturn 1;\n\t\t\t}\n\t\t}\n\n\t\t// cool.Point comparison function for sorting a list of CPoints w.r.t y-coordinate.\n\t\t// When the points have same y-coordinate break tie based on x-coordinates.\n\t\tfunction yThenX(ap: cool.Point, bp: cool.Point): number {\n\n\t\t\tif (ap.y < bp.y || (ap.y === bp.y && ap.x < bp.x)) {\n\t\t\t\treturn -1;\n\t\t\t}\n\t\t\telse if (ap.x === bp.x && ap.y === bp.y) {\n\t\t\t\treturn 0;\n\t\t\t}\n\t\t\telse {\n\t\t\t\treturn 1;\n\t\t\t}\n\t\t}\n\n\t\tvar sortX = getKeys(points).sort(xThenY);\n\t\tvar sortY = getKeys(points).sort(yThenX);\n\n\t\tvar edgesH = new Map<cool.Point, cool.Point>();\n\t\tvar edgesV = new Map<cool.Point, cool.Point>();\n\n\t\tvar len = getKeys(points).length;\n\t\ti = 0;\n\t\twhile (i < len) {\n\t\t\tvar currY = points.get(sortY[i]).y;\n\t\t\twhile (i < len && points.get(sortY[i]).y === currY) {\n\t\t\t\tedgesH.set(sortY[i], sortY[i + 1]);\n\t\t\t\tedgesH.set(sortY[i + 1], sortY[i]);\n\t\t\t\ti += 2;\n\t\t\t}\n\t\t}\n\n\t\ti = 0;\n\t\twhile (i < len) {\n\t\t\tvar currX = points.get(sortX[i]).x;\n\t\t\twhile (i < len && points.get(sortX[i]).x === currX) {\n\t\t\t\tedgesV.set(sortX[i], sortX[i + 1]);\n\t\t\t\tedgesV.set(sortX[i + 1], sortX[i]);\n\t\t\t\ti += 2;\n\t\t\t}\n\t\t}\n\n\t\tvar polygons = new Array<CPointSet>();\n\t\tvar edgesHKeys = getKeys(edgesH);\n\n\t\twhile (edgesHKeys.length > 0) {\n\t\t\tvar p: Array<[cool.Point, number]> = [[edgesHKeys[0], 0]];\n\t\t\twhile (true) {\n\t\t\t\tvar curr = p[p.length - 1][0];\n\t\t\t\tvar e = p[p.length - 1][1];\n\t\t\t\tif (e === 0) {\n\t\t\t\t\tvar nextVertex = edgesV.get(curr);\n\t\t\t\t\tedgesV.delete(curr);\n\t\t\t\t\tp.push([nextVertex, 1]);\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tvar nextVertex = edgesH.get(curr);\n\t\t\t\t\tedgesH.delete(curr);\n\t\t\t\t\tp.push([nextVertex, 0]);\n\t\t\t\t}\n\t\t\t\tif (p[p.length - 1][0].equals(p[0][0]) && p[p.length - 1][1] === p[0][1]) {\n\t\t\t\t\tp.pop();\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t\tvar polygon = new Array<cool.Point>();\n\t\t\tfor (i = 0; i < p.length; i++) {\n\t\t\t\tpolygon.push(unitConverter(points.get(p[i][0])));\n\t\t\t\tedgesH.delete(p[i][0]);\n\t\t\t\tedgesV.delete(p[i][0]);\n\t\t\t}\n\t\t\tpolygon.push(unitConverter(points.get(p[0][0])));\n\t\t\tedgesHKeys = getKeys(edgesH);\n\t\t\tpolygons.push(CPointSet.fromPointArray(polygon));\n\t\t}\n\t\treturn CPointSet.fromSetArray(polygons);\n\t}\n}\n"]}